{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12995328","self":"https://issues.apache.org/jira/rest/api/2/issue/12995328","key":"MAPREDUCE-6747","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-08-05T21:39:01.795+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 05 23:10:07 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6747/watchers","watchCount":3,"isWatching":false},"created":"2016-08-05T20:11:23.561+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-08-05T23:10:07.595+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"TestMapReduceJobControl#testJobControlWithKillJob seems to time out while waiting for all jobs to complete. This seems to only happen if the test is run with the other tests in the class (specifically testJobControlWithFailJob). If testJobControlWithKillJob is run by itself, the test passes.\n\nLooking into the test logs, when run with another test from the class, the test runs into an issue while setting permissions on the local file system:\n{noformat}\n2016-08-05 11:40:32,101 WARN  [Thread-100] util.Shell (Shell.java:joinThread(1023)) - Interrupted while joining on: Thread[Thread-105,5,main]\njava.lang.InterruptedException\n        at java.lang.Object.wait(Native Method)\n        at java.lang.Thread.join(Thread.java:1245)\n        at java.lang.Thread.join(Thread.java:1319)\n        at org.apache.hadoop.util.Shell.joinThread(Shell.java:1020)\n        at org.apache.hadoop.util.Shell.runCommand(Shell.java:969)\n        at org.apache.hadoop.util.Shell.run(Shell.java:878)\n        at org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:1172)\n        at org.apache.hadoop.util.Shell.execCommand(Shell.java:1266)\n        at org.apache.hadoop.util.Shell.execCommand(Shell.java:1248)\n        at org.apache.hadoop.fs.RawLocalFileSystem.setPermission(RawLocalFileSystem.java:781)\n        at org.apache.hadoop.fs.RawLocalFileSystem.mkOneDirWithMode(RawLocalFileSystem.java:526)\n        at org.apache.hadoop.fs.RawLocalFileSystem.mkdirsWithOptionalPermission(RawLocalFileSystem.java:566)\n        at org.apache.hadoop.fs.RawLocalFileSystem.mkdirs(RawLocalFileSystem.java:538)\n        at org.apache.hadoop.fs.RawLocalFileSystem.mkdirsWithOptionalPermission(RawLocalFileSystem.java:565)\n        at org.apache.hadoop.fs.RawLocalFileSystem.mkdirs(RawLocalFileSystem.java:538)\n        at org.apache.hadoop.fs.RawLocalFileSystem.mkdirsWithOptionalPermission(RawLocalFileSystem.java:565)\n        at org.apache.hadoop.fs.RawLocalFileSystem.mkdirs(RawLocalFileSystem.java:538)\n        at org.apache.hadoop.fs.ChecksumFileSystem.mkdirs(ChecksumFileSystem.java:696)\n        at org.apache.hadoop.mapreduce.lib.output.FileOutputCommitter.setupJob(FileOutputCommitter.java:343)\n        at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:541)\n{noformat}\n\nConversely, when the test is run by itself, this issue is not hit.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"TestMapReduceJobControl#testJobControlWithKillJob times out in trunk","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctrezzo","name":"ctrezzo","key":"ctrezzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Trezzo","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctrezzo","name":"ctrezzo","key":"ctrezzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Trezzo","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12995328/comment/15410119","id":"15410119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vrushalic","name":"vrushalic","key":"vrushalic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10433"},"displayName":"Vrushali C","active":true,"timeZone":"Etc/UTC"},"body":"Going to try to see if I can fix this. Will update the jira shortly. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vrushalic","name":"vrushalic","key":"vrushalic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10433"},"displayName":"Vrushali C","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-05T21:39:01.795+0000","updated":"2016-08-05T21:39:01.795+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12995328/comment/15410263","id":"15410263","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vrushalic","name":"vrushalic","key":"vrushalic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10433"},"displayName":"Vrushali C","active":true,"timeZone":"Etc/UTC"},"body":"So this is interesting. The warning messages above are not causing the timeout. I observe that if I were to put a logging statement in TestMapReduceJobControl#waitTillAllFinished as\n{code}\n  private void waitTillAllFinished(JobControl theControl) {\n    while (!theControl.allFinished()) {\n      try {\n        LOG.info(\"Sleeping..\");\n        Thread.sleep(1000);\n      } catch (Exception e) {}\n    }\n  }\n\n{code}\n\nThe tests pass for me. It appears that without this logging message, the job is stuck at map phase in the testJobControlWithKillJob test\n{code}\n2016-08-05 16:08:32,831 INFO  [pool-35-thread-1] mapred.LocalJobRunner (LocalJobRunner.java:run(353)) - Finishing task: attempt_local1592761666_0012_r_000000_0\n2016-08-05 16:08:32,831 INFO  [Thread-498] mapred.LocalJobRunner (LocalJobRunner.java:runTasks(486)) - reduce task executor complete.\n2016-08-05 16:08:38,421 INFO  [communication thread] mapred.LocalJobRunner (LocalJobRunner.java:statusUpdate(628)) - map > map\n{code}\n\nDo you see the same behavior [~ctrezzo] that all tests pass in TestMapReduceJobControl if you put a logging statement before the Thread.sleep in waitTillAllFinished? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vrushalic","name":"vrushalic","key":"vrushalic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10433"},"displayName":"Vrushali C","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-05T23:10:07.595+0000","updated":"2016-08-05T23:10:07.595+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6747/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i31zdj:"}}