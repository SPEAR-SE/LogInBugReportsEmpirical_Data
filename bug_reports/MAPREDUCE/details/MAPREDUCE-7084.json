{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13153553","self":"https://issues.apache.org/jira/rest/api/2/issue/13153553","key":"MAPREDUCE-7084","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-04-19T16:29:45.627+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Apr 23 02:42:37 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-7084/watchers","watchCount":2,"isWatching":false},"created":"2018-04-19T01:18:30.162+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326141","id":"12326141","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-04-23T02:42:37.743+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315625","id":"12315625","name":"applicationmaster"}],"timeoriginalestimate":null,"description":"My scenario as follows:\r\n 1. I kill a application by *hadoop job -kill*.\r\n 2. the *FinalStatus* is *KILLED*, but its *State* is *RUNNING*\r\n 3. the MRAppmaster process has quit in NodeManager","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12919734","id":"12919734","filename":"RM.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imstefanlee","name":"imstefanlee","key":"imstefanlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"stefanlee","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-04-19T01:32:45.170+0000","size":13034,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12919734/RM.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"MRAppmaster still running after hadoop job -kill ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imstefanlee","name":"imstefanlee","key":"imstefanlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"stefanlee","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imstefanlee","name":"imstefanlee","key":"imstefanlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"stefanlee","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153553/comment/16443432","id":"16443432","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imstefanlee","name":"imstefanlee","key":"imstefanlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"stefanlee","active":true,"timeZone":"Asia/Shanghai"},"body":"*the  last log in MRAppMaster as follows:*\r\n\r\n2018-04-18 10:10:39,328 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:40,329 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:41,330 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:42,332 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:43,333 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:44,334 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:45,336 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:46,337 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:47,338 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:48,340 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:49,341 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:50,343 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:51,344 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:52,345 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:53,346 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:54,348 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:55,350 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:56,351 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:57,353 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:58,354 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:10:59,355 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:11:00,390 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:11:01,392 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:11:02,393 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:11:03,394 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:11:04,395 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered. 2018-04-18 10:11:05,397 INFO [Thread-67] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Waiting for application to be successfully unregistered\r\n\r\n*It seems the AppMaster does not quit normally*","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imstefanlee","name":"imstefanlee","key":"imstefanlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"stefanlee","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-04-19T01:21:15.596+0000","updated":"2018-04-19T01:32:17.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153553/comment/16443443","id":"16443443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imstefanlee","name":"imstefanlee","key":"imstefanlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"stefanlee","active":true,"timeZone":"Asia/Shanghai"},"body":"The  logs in RM.[^RM.log]  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imstefanlee","name":"imstefanlee","key":"imstefanlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"stefanlee","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-04-19T01:33:04.092+0000","updated":"2018-04-19T01:33:04.092+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153553/comment/16444347","id":"16444347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Looks like the AM was not able to successfully unregister with the RM, but there's no indication as to why it would be having issues (no exception logged).  There's also no indication in the RM log as to why it was not able to process the unregistration.  A few followup questions:\r\n\r\nIs this reproducible?\r\n\r\nIs the RM log filtered for just this application or the entire log?  If it's filtered, I'm curious if there were any exceptions logged that did not contain the app ID during this time period.\r\n\r\nDid the application transition out of the RUNNING state after the 10 minute expiration?  I see it lingered for a little over 10 minutes in the FINISHING state according to the RM log, which correlates with the AM's log indicating it is having difficulty unregistering.\r\n{noformat}\r\n018-04-18 10:10:39,350 INFO org.apache.hadoop.yarn.server.resourcemanager.rmapp.RMAppImpl: application_1521543893962_10055214 State change from RUNNING to KILLING\r\n2018-04-18 10:10:39,389 INFO org.apache.hadoop.yarn.server.resourcemanager.rmapp.attempt.RMAppAttemptImpl: Updating application attempt appattempt_1521543893962_10055214_000001 with final state: FINISHING\r\n2018-04-18 10:10:39,391 INFO org.apache.hadoop.yarn.server.resourcemanager.rmapp.attempt.RMAppAttemptImpl: appattempt_1521543893962_10055214_000001 State change from RUNNING to FINAL_SAVING\r\n2018-04-18 10:10:39,471 INFO org.apache.hadoop.yarn.server.resourcemanager.rmapp.attempt.RMAppAttemptImpl: appattempt_1521543893962_10055214_000001 State change from FINAL_SAVING to FINISHING\r\n2018-04-18 10:21:55,073 INFO org.apache.hadoop.yarn.util.AbstractLivelinessMonitor: Expired:appattempt_1521543893962_10055214_000001 Timed out after 600 secs\r\n2018-04-18 10:21:55,073 INFO org.apache.hadoop.yarn.server.resourcemanager.ApplicationMasterService: Unregistering app attempt : appattempt_1521543893962_10055214_000001\r\n2018-04-18 10:21:55,073 INFO org.apache.hadoop.yarn.server.resourcemanager.rmapp.attempt.RMAppAttemptImpl: appattempt_1521543893962_10055214_000001 State change from FINISHING to FINISHED\r\n2018-04-18 10:21:55,073 INFO org.apache.hadoop.yarn.server.resourcemanager.amlauncher.AMLauncher: Cleaning master appattempt_1521543893962_10055214_000001\r\n2018-04-18 10:21:56,095 INFO org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler: Application appattempt_1521543893962_10055214_000001 is done. finalState=FINISHED\r\n2018-04-18 10:21:56,095 INFO org.apache.hadoop.yarn.server.resourcemanager.rmcontainer.RMContainerImpl: container_1521543893962_10055214_01_000004 Container Transitioned from ACQUIRED to KILLED\r\n{noformat}\r\n\r\nIs this really against Apache Hadoop 2.4.0?  If so that is a very old release, and I would highly recommend upgrading to at least 2.7 to see if it occurs there.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2018-04-19T16:29:45.627+0000","updated":"2018-04-19T16:29:45.627+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153553/comment/16447486","id":"16447486","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imstefanlee","name":"imstefanlee","key":"imstefanlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"stefanlee","active":true,"timeZone":"Asia/Shanghai"},"body":"[~jlowe]Thanks for your reply\r\n{quote}Is this reproducible\r\n{quote}\r\nit's hard to reappear\r\n{quote}Is the RM log filtered for just this application or the entire log?\r\n{quote}\r\nbecause the log in RM is too large, so it's filtered by applicationId, and i did not found any exception in RM entire log.\r\n{quote}Did the application transition out of the RUNNING state after the 10 minute expiration?\r\n{quote}\r\nyes,it seems the applicaiton can't unregister in 10 minutes and RM also can't receive its heatbeat .\r\n\r\n \r\n{quote}Is this really against Apache Hadoop 2.4.0?\r\n{quote}\r\nyes, our version is 2.4.0 , i don't know if this bug also exist in 2.7.0 .","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imstefanlee","name":"imstefanlee","key":"imstefanlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"stefanlee","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-04-23T02:42:37.743+0000","updated":"2018-04-23T02:42:37.743+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-7084/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3sqp3:"}}