{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12658675","self":"https://issues.apache.org/jira/rest/api/2/issue/12658675","key":"MAPREDUCE-5404","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325257","id":"12325257","description":"2.3.0 release","name":"2.3.0","archived":false,"released":true,"releaseDate":"2014-02-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-07-19T04:49:10.470+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jul 22 19:06:11 UTC 2013","customfield_12310420":"338869","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_309052802_*|*_1_*:*_1_*:*_14952292_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-07-22T19:06:11.449+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5404/watchers","watchCount":4,"isWatching":false},"created":"2013-07-19T01:06:06.385+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325257","id":"12325257","description":"2.3.0 release","name":"2.3.0","archived":false,"released":true,"releaseDate":"2014-02-20"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335734","id":"12335734","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"issuelinks":[{"id":"12372340","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12372340","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12648918","key":"MAPREDUCE-5265","self":"https://issues.apache.org/jira/rest/api/2/issue/12648918","fields":{"summary":"History server admin service to refresh user and superuser group mappings","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-12T18:23:39.556+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315343","id":"12315343","name":"jobhistoryserver"}],"timeoriginalestimate":null,"description":"I ran HBase trunk tests against 2.2.0-SNAPSHOT and many mapreduce jobs failed.\nHere is one example:\n{code}\norg.apache.hadoop.hbase.mapreduce.TestTableInputFormatScan2  Time elapsed: 0.001 sec  <<< ERROR!\norg.apache.hadoop.yarn.exceptions.YarnRuntimeException: org.apache.hadoop.service.ServiceStateException: java.net.BindException: Problem binding to [0.0.0.0:10033] java.net.BindException: Address already in use; For more details see:  http://wiki.apache.org/hadoop/BindException\n        at org.apache.hadoop.mapreduce.v2.MiniMRYarnCluster$JobHistoryServerWrapper.serviceStart(MiniMRYarnCluster.java:177)\n        at org.apache.hadoop.service.AbstractService.start(AbstractService.java:193)\n        at org.apache.hadoop.service.CompositeService.serviceStart(CompositeService.java:101)\n        at org.apache.hadoop.service.AbstractService.start(AbstractService.java:193)\n        at org.apache.hadoop.mapred.MiniMRClientClusterFactory.create(MiniMRClientClusterFactory.java:80)\n        at org.apache.hadoop.mapred.MiniMRCluster.<init>(MiniMRCluster.java:183)\n        at org.apache.hadoop.mapred.MiniMRCluster.<init>(MiniMRCluster.java:171)\n        at org.apache.hadoop.mapred.MiniMRCluster.<init>(MiniMRCluster.java:163)\n        at org.apache.hadoop.mapred.MiniMRCluster.<init>(MiniMRCluster.java:124)\n        at org.apache.hadoop.hbase.HBaseTestingUtility.startMiniMapReduceCluster(HBaseTestingUtility.java:1751)\n        at org.apache.hadoop.hbase.HBaseTestingUtility.startMiniMapReduceCluster(HBaseTestingUtility.java:1692)\n        at org.apache.hadoop.hbase.mapreduce.TestTableInputFormatScanBase.setUpBeforeClass(TestTableInputFormatScanBase.java:84)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)\n        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)\n        at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:24)\n        at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n        at org.junit.runners.ParentRunner.run(ParentRunner.java:309)\n        at org.junit.runners.Suite.runChild(Suite.java:127)\n        at org.junit.runners.Suite.runChild(Suite.java:26)\n        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:166)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:724)\nCaused by: org.apache.hadoop.service.ServiceStateException: java.net.BindException: Problem binding to [0.0.0.0:10033] java.net.BindException: Address already in use; For more details see:  http://wiki.apache.org/hadoop/BindException\n        at org.apache.hadoop.service.ServiceStateException.convert(ServiceStateException.java:59)\n        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:172)\n        at org.apache.hadoop.service.CompositeService.serviceInit(CompositeService.java:88)\n        at org.apache.hadoop.mapreduce.v2.hs.JobHistoryServer.serviceInit(JobHistoryServer.java:91)\n        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)\n        at org.apache.hadoop.mapreduce.v2.MiniMRYarnCluster$JobHistoryServerWrapper.serviceStart(MiniMRYarnCluster.java:161)\n        ... 30 more\nCaused by: java.net.BindException: Problem binding to [0.0.0.0:10033] java.net.BindException: Address already in use; For more details see:  http://wiki.apache.org/hadoop/BindException\n        at org.apache.hadoop.net.NetUtils.wrapException(NetUtils.java:719)\n        at org.apache.hadoop.ipc.Server.bind(Server.java:398)\n        at org.apache.hadoop.ipc.Server$Listener.<init>(Server.java:501)\n        at org.apache.hadoop.ipc.Server.<init>(Server.java:2168)\n        at org.apache.hadoop.ipc.RPC$Server.<init>(RPC.java:997)\n        at org.apache.hadoop.ipc.ProtobufRpcEngine$Server.<init>(ProtobufRpcEngine.java:505)\n        at org.apache.hadoop.ipc.ProtobufRpcEngine.getServer(ProtobufRpcEngine.java:480)\n        at org.apache.hadoop.ipc.RPC$Builder.build(RPC.java:840)\n        at org.apache.hadoop.mapreduce.v2.hs.server.HSAdminServer.serviceInit(HSAdminServer.java:93)\n        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)\n        ... 34 more\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12593137","id":"12593137","filename":"mapreduce-5404-v2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T06:44:14.153+0000","size":2638,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12593137/mapreduce-5404-v2.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12593142","id":"12593142","filename":"mapreduce-5404-v3.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T07:25:49.719+0000","size":1357,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12593142/mapreduce-5404-v3.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"339189","customfield_12312823":null,"summary":"HSAdminServer does not use ephemeral ports in minicluster mode","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13713338","id":"13713338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ozawa","name":"ozawa","key":"ozawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ozawa&avatarId=21740","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ozawa&avatarId=21740","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ozawa&avatarId=21740","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ozawa&avatarId=21740"},"displayName":"Tsuyoshi Ozawa","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for your reporting, Ted. I want to make sure the branch name you are using, because the code in branch-2 are implemented to use ephemeral ports if JHAdminConfig.MR_HISTORY_MINICLUSTER_FIXED_PORTS is false as follows:\n\n{code:java}\n  private class JobHistoryServerWrapper extends AbstractService {\n    @Override\n    public synchronized void serviceStart() throws Exception {\n      try {\n        if (!getConfig().getBoolean(\n            JHAdminConfig.MR_HISTORY_MINICLUSTER_FIXED_PORTS,\n            JHAdminConfig.DEFAULT_MR_HISTORY_MINICLUSTER_FIXED_PORTS)) {\n          // pick free random ports.\n          getConfig().set(JHAdminConfig.MR_HISTORY_ADDRESS,\n              MiniYARNCluster.getHostname() + \":0\");\n          getConfig().set(JHAdminConfig.MR_HISTORY_WEBAPP_ADDRESS,\n              MiniYARNCluster.getHostname() + \":0\");\n        }   \n        historyServer = new JobHistoryServer();\n        historyServer.init(getConfig());\n        ...\n    }\n  }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ozawa","name":"ozawa","key":"ozawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ozawa&avatarId=21740","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ozawa&avatarId=21740","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ozawa&avatarId=21740","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ozawa&avatarId=21740"},"displayName":"Tsuyoshi Ozawa","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T04:49:10.470+0000","updated":"2013-07-19T04:49:10.470+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13713346","id":"13713346","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the hint.\n\nI don't see the above code in https://issues.apache.org/jira/secure/attachment/12593038/JHS_REFRESH-13.txt\n\nBut here is the patch I come up with.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T05:14:41.071+0000","updated":"2013-07-19T05:14:41.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13713351","id":"13713351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12593132/mapreduce-5404-v1.txt\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:red}-1 javac{color:red}.  The patch appears to cause the build to fail.\n\nConsole output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3868//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-19T05:38:55.926+0000","updated":"2013-07-19T05:38:55.926+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13713394","id":"13713394","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj.k","name":"devaraj.k","key":"devaraj.k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj K","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Ted/Tsuyoshi,\n\tHere trying to access test class MiniMRYarnCluster.java in the source code HSAdminServer.java which we should not do.\n{code:xml}\n+    if (!getConfig().getBoolean(\n+      JHAdminConfig.JHS_ADMIN_FIXED_PORTS,\n+      JHAdminConfig.DEFAULT_JHS_ADMIN_FIXED_PORTS)) {\n+      // pick free random ports.\n+      getConfig().set(JHAdminConfig.JHS_ADMIN_ADDRESS,\n+        MiniYARNCluster.getHostname() + \":0\");\n+    }\n{code}\n\t\nInstead of doing in the above way, we can set ephemeral port for JHS_ADMIN_ADDRESS in MiniMRYarnCluster.JobHistoryServerWrapper.start() method as like other configs,\n\n{code:title=MiniMRYarnCluster.JobHistoryServerWrapper|borderStyle=solid}\n    @Override\n    public synchronized void serviceStart() throws Exception {\n      try {\n        if (!getConfig().getBoolean(\n            JHAdminConfig.MR_HISTORY_MINICLUSTER_FIXED_PORTS,\n            JHAdminConfig.DEFAULT_MR_HISTORY_MINICLUSTER_FIXED_PORTS)) {\n          // pick free random ports.\n          getConfig().set(JHAdminConfig.MR_HISTORY_ADDRESS,\n              MiniYARNCluster.getHostname() + \":0\");\n          getConfig().set(JHAdminConfig.MR_HISTORY_WEBAPP_ADDRESS,\n              MiniYARNCluster.getHostname() + \":0\");\n+          getConfig().set(JHAdminConfig.JHS_ADMIN_ADDRESS,\n+              MiniYARNCluster.getHostname() + \":0\");\n        }\n\t.....\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj.k","name":"devaraj.k","key":"devaraj.k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj K","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T07:10:33.305+0000","updated":"2013-07-19T07:10:33.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13713411","id":"13713411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12593137/mapreduce-5404-v2.txt\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3869//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3869//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-19T07:25:46.080+0000","updated":"2013-07-19T07:25:46.080+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13713412","id":"13713412","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the comment, Devaraj.\n\nHere is a new patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T07:25:49.721+0000","updated":"2013-07-19T07:25:49.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13713436","id":"13713436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12593142/mapreduce-5404-v3.txt\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient:\n\n                  org.apache.hadoop.mapreduce.security.TestBinaryTokenFile\n                  org.apache.hadoop.mapreduce.security.TestMRCredentials\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3870//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3870//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-19T08:23:36.182+0000","updated":"2013-07-19T08:23:36.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13714122","id":"13714122","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"This is what I did:\nbuilt tip of hadoop-2 with patch v3 using 'mvn install'\nbuilt HBase trunk code with the following change:\n{code}\n@@ -887,7 +887,7 @@\n     <buildDate>${maven.build.timestamp}</buildDate>\n     <compileSource>1.6</compileSource>\n     <!-- Dependencies -->\n-    <hadoop-two.version>2.0.5-alpha</hadoop-two.version>\n+    <hadoop-two.version>2.3.0-SNAPSHOT</hadoop-two.version>\n     <hadoop-one.version>1.1.2</hadoop-one.version>\n     <commons-cli.version>1.2</commons-cli.version>\n     <commons-codec.version>1.7</commons-codec.version>\n{code}\nran HBase test suite for hadoop 2 profile.\n\nSo far there was no test failure.\nMapreduce tests such as TestMultithreadedTableMapper passed where they used to fail with BindException.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T21:45:54.529+0000","updated":"2013-07-19T21:45:54.529+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13714128","id":"13714128","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"{code}\n[INFO] HBase ............................................. SUCCESS [1.861s]\n[INFO] HBase - Common .................................... SUCCESS [17.231s]\n[INFO] HBase - Protocol .................................. SUCCESS [0.690s]\n[INFO] HBase - Client .................................... SUCCESS [18.710s]\n[INFO] HBase - Prefix Tree ............................... SUCCESS [2.368s]\n[INFO] HBase - Hadoop Compatibility ...................... SUCCESS [5.104s]\n[INFO] HBase - Hadoop Two Compatibility .................. SUCCESS [2.064s]\n[INFO] HBase - Server .................................... SUCCESS [54:45.935s]\n[INFO] HBase - Integration Tests ......................... SUCCESS [1.668s]\n[INFO] HBase - Examples .................................. SUCCESS [5.012s]\n[INFO] HBase - Assembly .................................. SUCCESS [1.170s]\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T21:57:25.815+0000","updated":"2013-07-19T21:57:25.815+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13714922","id":"13714922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj.k","name":"devaraj.k","key":"devaraj.k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj K","active":true,"timeZone":"America/Los_Angeles"},"body":"Latest patch looks good to me, The above test failures are unrelated to this patch it seems.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj.k","name":"devaraj.k","key":"devaraj.k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj K","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-22T05:35:30.230+0000","updated":"2013-07-22T05:35:30.230+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13715482","id":"13715482","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"+1, looks good to me as well.  Both of the test failures are occurring without this patch.  I'll commit this shortly.\n\nMy apologies for missing this in the MAPREDUCE-5265 review.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2013-07-22T18:20:07.458+0000","updated":"2013-07-22T18:20:07.458+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658675/comment/13715542","id":"13715542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Thanks for the contribution, Ted, and thanks for the review, Devaraj!  I committed this to trunk and branch-2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2013-07-22T19:06:11.468+0000","updated":"2013-07-22T19:06:11.468+0000"}],"maxResults":12,"total":12,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5404/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1mg53:"}}