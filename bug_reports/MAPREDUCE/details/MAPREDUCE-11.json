{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12426539","self":"https://issues.apache.org/jira/rest/api/2/issue/12426539","key":"MAPREDUCE-11","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2009-07-09T12:59:25.188+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Oct 05 06:25:56 UTC 2009","customfield_12310420":"148418","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_11244505734_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-10-05T06:25:56.587+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-11/watchers","watchCount":4,"isWatching":false},"created":"2009-05-28T02:57:30.853+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-10-05T06:25:56.584+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"The JobTracker uses the job history files for doing job recovery upon startup. To handle cases where JobTracker goes down again while the recovered job is running, there is some logic that plays with files and it ends up having two history files for some window of time during the life of the job - actual history file, .recover file. The idea being that upon the next restart we should be able to the maximal number of events for the job. It led to performance problems in the job submission / recovery (part of which got addressed in HADOOP-4372). It also looks pretty unlikely that a running job will traverse across multiple JT restarts. Even if it did, without the .recover file, it'd only mean that we lose some tasks that got completed in a subsequent restart. I propose that we remove the .recover file logic and base the recovery on only the original job history file. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12413013","id":"12413013","filename":"MAPREDUCE-11-v1.8.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-09T12:59:25.078+0000","size":47464,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12413013/MAPREDUCE-11-v1.8.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"108476","customfield_12312823":null,"summary":"Cleanup JobHistory file naming to do with job recovery","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426539/comment/12713850","id":"12713850","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"Also, we should remove the <date> field from the job history filename format. Anyway the date is already there in the jobID and that is a part of the filename.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-05-28T03:55:40.095+0000","updated":"2009-05-28T03:55:40.095+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426539/comment/12729244","id":"12729244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"body":"Attaching a patch that simplifies the job history filename and recovery. Changes are as follows :\n# job history filename is of the format _hostname_jobid_username_jobname_\n# conf filenames are of the format _hostname_jobid_conf.xml_\n# upon every restart all the new updates will be directed to _history-file.recover_\n# once the job finishes the _history-file.recover_ file will be renamed to _history-file_\n# note that the master file ( _hostname_jobid_username_jobname_) will exist throughout the lifecycle of the job\n# if the jobtracker restart again, new updates will be lost\n# there is no searching involved in any case\n# for now the old jobhistory files are supported via web-ui\n\nTested the patch locally and so far no issues. Result of test-patch \n[exec] +1 overall.  \n     [exec] \n     [exec]     +1 @author.  The patch does not contain any @author tags.\n     [exec] \n     [exec]     +1 tests included.  The patch appears to include 9 new or modified tests.\n     [exec] \n     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.\n     [exec] \n     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n     [exec] \n     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n     [exec] \n     [exec]     +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n\nRunning ant tests now and testing in progress.\n\nThings I tested\n# submitted a job allowed it to completed. New job files move to done folder. \n# submitted a job and killed the jobtracker  while job files was empty, restarted the jobtracker and the files upon completion move to done folder\n# submitted a job and killed the jobtracker  while job files was written, restarted the jobtracker and the files upon completion move to done folder. job was also recovered\n# checked webui\n ## history shows old and new files (there is no difference between the layout)\n ## history pages for old and new jobs have functional links (check random links and conf links)\n ## search facility in history works across files ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-09T12:59:25.188+0000","updated":"2009-07-09T12:59:25.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426539/comment/12729544","id":"12729544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"body":"All mapred tests passed and all contrib tests passed except TestStreamingExitStatus and TestStreamingStderr.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-10T06:46:15.195+0000","updated":"2009-07-10T06:46:15.195+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426539/comment/12731432","id":"12731432","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyappans","name":"iyappans","key":"iyappans","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Iyappan Srinivasan","active":true,"timeZone":"Etc/UTC"},"body":"\n These are the test scenaros that are tried:\n\n1)\tSome normal jobs ( sleep and random writer) gets submitted and it gets completed successfully and goes into done folder. All web-links related to it goes smoothly including \"filter\". The contents of the job file shows success.\n2)\tSome jobs are submitted. JT is restarted to see if there is a recover file as well as the original job file. The jobs complete successfully and goes into the done folder. The contents of the job file shows success.\n3)\tSome jobs are submitted. JT goes for a restart. JT comes up back again and jobs gets resubmitted. Jobs are 20% completed. JT restarts again. Jobs gets resubmitted from the beginning instead of from the 20%. JT restarts again. Jobs are again resubmitted. The jobs complete successfully and goes into the done folder. The contents of the job file shows success.\n4)\tSome jobs are submitted. JT is stopped. After 5 minutes, it is restarted. One of the TTs gets job level blacklisted. Still, the jobs are resubmitted and passes to the \"done\" folder.\n5)\tKill job tracker as soon as some jobs starts, when they had a \"0\" file size. Restart JT. These jobs should get resubmitted and pass successfully.\n6)\tSubmit jobs, do JT restart and when jobs gets resubmitted, kill those jobs using \"job -kill\". They shd be killed properly and move to done folder with correct file contents.\n\n\nTwo issue found are :\n1) \norg.apache.hadoop.ipc.RemoteException: org.apache.hadoop.hdfs.protocol.AlreadyBeingCreatedException: failed to create file /user/hadoopqa/input3/_logs/history/servername.inktomisearch.com_job_200907151220_0003_conf.xml for DFSClient_-123 on client IPAddress because current leaseholder is trying to recreate file.\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInternal(FSNamesystem.java:888)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFile(FSNamesystem.java:821)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.create(NameNode.java:565)\n        at sun.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:508)\n        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:964)\n        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:960)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:396)\n        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:958)\n\n        at org.apache.hadoop.ipc.Client.call(Client.java:743)\n        at org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:220)\n        at $Proxy0.create(Unknown Source)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:82)\n        at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:59)\n        at $Proxy0.create(Unknown Source)\n        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.<init>(DFSClient.java:2932)\n        at org.apache.hadoop.hdfs.DFSClient.create(DFSClient.java:436)\n        at org.apache.hadoop.hdfs.DistributedFileSystem.create(DistributedFileSystem.java:206)\n        at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:529)\n        at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:503)\n        at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:484)\n        at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:391)\n        at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:383)\n        at org.apache.hadoop.mapred.JobHistory$JobInfo.logSubmitted(JobHistory.java:1082)\n        at org.apache.hadoop.mapred.JobInProgress.logToJobHistory(JobInProgress.java:589)\n\n2) 2009-07-15 11:36:31,576 ERROR org.mortbay.log: /jobdetailshistory.jsp\njava.lang.IllegalArgumentException: No enum const class org.apache.hadoop.mapred.JobHistory$RecordTypes.b0VIM\n        at java.lang.Enum.valueOf(Enum.java:192)\n        at org.apache.hadoop.mapred.JobHistory$RecordTypes.valueOf(JobHistory.java:233)\n        at org.apache.hadoop.mapred.JobHistory.parseLine(JobHistory.java:465)\n        at org.apache.hadoop.mapred.JobHistory.access$200(JobHistory.java:75)\n        at org.apache.hadoop.mapred.JobHistory$MetaInfoManager.<init>(JobHistory.java:337)\n        at org.apache.hadoop.mapred.JobHistory.parseHistoryFromFS(JobHistory.java:415)\n        at org.apache.hadoop.mapred.DefaultJobHistoryParser.parseJobTasks(DefaultJobHistoryParser.java:50)\n        at org.apache.hadoop.mapr\n\nBoth are intermittent issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyappans","name":"iyappans","key":"iyappans","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Iyappan Srinivasan","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-15T13:18:32.967+0000","updated":"2009-07-15T13:18:32.967+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426539/comment/12762097","id":"12762097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"body":"Job history is no longer used for recovery and hence this issue is no longer valid.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-05T06:25:56.474+0000","updated":"2009-10-05T06:25:56.474+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-11/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ix7z:"}}