{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12721414","self":"https://issues.apache.org/jira/rest/api/2/issue/12721414","key":"MAPREDUCE-5928","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2014-06-16T14:36:18.147+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jun 18 15:28:46 UTC 2014","customfield_12310420":"399610","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_179606276_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-06-18T15:34:43.226+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5928/watchers","watchCount":10,"isWatching":false},"created":"2014-06-16T13:41:16.989+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12389986","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12389986","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12690980","key":"YARN-1680","self":"https://issues.apache.org/jira/rest/api/2/issue/12690980","fields":{"summary":"availableResources sent to applicationMaster in heartbeat should exclude blacklistedNodes free memory.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-06-18T15:34:43.246+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"I have a small cluster consisting of 8 desktop class systems (1 master + 7 workers).\nDue to the small memory of these systems I configured yarn as follows:\n{quote}\nyarn.nodemanager.resource.memory-mb = 2200\nyarn.scheduler.minimum-allocation-mb = 250\n{quote}\nOn my client I did\n{quote}\nmapreduce.map.memory.mb = 512\nmapreduce.reduce.memory.mb = 512\n{quote}\nNow I run a job with 27 mappers and 32 reducers.\nAfter a while I saw this deadlock occur:\n-\tAll nodes had been filled to their maximum capacity with reducers.\n-\t1 Mapper was waiting for a container slot to start in.\n\nI tried killing reducer attempts but that didn't help (new reducer attempts simply took the existing container).\n\n*Workaround*:\nI set this value from my job. The default value is 0.05 (= 5%)\n{quote}\nmapreduce.job.reduce.slowstart.completedmaps = 0.99f\n{quote}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12650575","id":"12650575","filename":"AM-MR-syslog - Cleaned.txt.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T15:01:49.135+0000","size":429963,"mimeType":"application/gzip","content":"https://issues.apache.org/jira/secure/attachment/12650575/AM-MR-syslog+-+Cleaned.txt.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12650565","id":"12650565","filename":"Cluster fully loaded.png.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T13:45:22.604+0000","size":144093,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12650565/Cluster+fully+loaded.png.jpg"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12650563","id":"12650563","filename":"MR job stuck in deadlock.png.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T13:43:16.529+0000","size":63297,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12650563/MR+job+stuck+in+deadlock.png.jpg"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"399719","customfield_12312823":null,"summary":"Deadlock allocating containers for mappers and reducers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Hadoop 2.4.0 (as packaged by HortonWorks in HDP 2.1.2)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032429","id":"14032429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"NOTE: Node2 had issues so the system took it offline (0 containers). \nPerhaps this is what confused the MapReduce application?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T13:45:22.609+0000","updated":"2014-06-16T13:45:22.609+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032473","id":"14032473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"This sounds like a bug in either headroom calculation or in RMContainerAllocator where the AM decides whether to preempt reducers.  Could you look in the AM log and see what it saw for the headroom and whether it made any attempt at all to ramp down reducers?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-06-16T14:36:18.147+0000","updated":"2014-06-16T14:36:18.147+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032476","id":"14032476","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"I'm not the only one who ran into this: http://hortonworks.com/community/forums/topic/mapreduce-race-condition-big-job/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T14:38:13.253+0000","updated":"2014-06-16T14:38:13.253+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032496","id":"14032496","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"body":"I think this is a case of task preemption not working since the headroom calculation is not correct. Can you verify you are using the capacity scheduler.\n\nYARN-1198","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"created":"2014-06-16T14:52:57.280+0000","updated":"2014-06-16T14:52:57.280+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032503","id":"14032503","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"I'm wondering if the fact that the nodemanger memory has a fractional remainder when it's \"full\" triggers the issue.  With tasks all being 512MB that means each node will have 152MB remaining.  I'm guessing that with enough nodes those remainders will add up to appear to be enough space to run another task but in reality that task cannot be scheduled since the memory being reported is fragmented.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-06-16T14:57:55.174+0000","updated":"2014-06-16T14:57:55.174+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032507","id":"14032507","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"I downloaded the Application Master log and attached it to this issue. (I changed the domainname of the nodes) ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T15:01:49.140+0000","updated":"2014-06-16T15:01:49.140+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032516","id":"14032516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"I have not actively configured any scheduling.\nSo I guess it is running the 'default' setting ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T15:06:23.765+0000","updated":"2014-06-16T15:06:23.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032545","id":"14032545","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"I'm pretty sure you're using the CapacityScheduler since that's been the default in Apache Hadoop for some time now.  I'm not positive about the HDP release, but I suspect it, too, is configured to use the CapacityScheduler by default.\n\nAfter a quick examination of the AM log, it looks like a couple of things are going on.  The AM is blacklisting one of the nodes, and we can see that node not being used in the cluster picture.  There's a known issue with headroom calculation not taking into account blacklisted nodes.  See YARN-1680. \n\nThe node ends up being blacklisted because the NM shot a number of the tasks for being over container limits.  It looks like the containers are being allocated as using 500MB but the JVM heap sizes are set to 512MB.  Note that the container size includes the size of the entire process tree for the task.  That's not just the heap, so it needs to also include thread stacks, JVM data, JVM code, any subprocesses launched (e.g.: hadoop streaming) etc.  If you really need a 512MB heap then I'd allocate 768MB or maybe even 1024MB containers, depending on what the tasks are doing.\n\nIt does look like some fractional memory shenanigans could be involved here, as the picture shows most of the nodes having only 200MB free.  It'd be interesting to know if you still hit the deadlock after fixing the cause of the blacklisting.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-06-16T15:23:00.216+0000","updated":"2014-06-16T15:23:00.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032564","id":"14032564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"I took the 'dead' node (node2) offline (completely stopped all hadoop/yarn related deamons) and ran the same job again after it had disappeared in all overviews.\nNow it does complete all mappers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T15:35:55.692+0000","updated":"2014-06-16T15:35:55.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032766","id":"14032766","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"Where/how can I determine for sure if the capacity scheduler is used?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T18:47:39.177+0000","updated":"2014-06-16T18:47:39.177+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032802","id":"14032802","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"You can click on the Tools->Configuration link on the UI and verify yarn.resourcemanager.scheduler.class is org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler or look for capacityscheduler in the RM logs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-06-16T19:10:01.720+0000","updated":"2014-06-16T19:10:01.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14032831","id":"14032831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"Confirmed It is using the CapacityScheduler:\n{code}\n<property>\n    <name>yarn.resourcemanager.scheduler.class</name>\n    <value>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler</value>\n    <source>yarn-default.xml</source>\n</property>\n{code}\n\nI'm going to fiddle with the memory setting tomorrow.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-16T19:36:37.702+0000","updated":"2014-06-16T19:36:37.702+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14033614","id":"14033614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"I have trouble finding the spot where this 500MB per container is defined.\nCan you give me some input where this is specified?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-17T09:38:01.831+0000","updated":"2014-06-17T09:38:01.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14033798","id":"14033798","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"The container size for maps, reduces, and the MR ApplicationMaster are specified in mapreduce.map.memory.mb, mapreduce.reduce.memory.mb, and yarn.app.mapreduce.am.resource.mb, respectively.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-06-17T13:51:03.556+0000","updated":"2014-06-17T13:51:03.556+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14035604","id":"14035604","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"I changed some of the memory settings and now the job completes successfully.\nThis was with the mapreduce.job.reduce.slowstart.completedmaps at it's default value of 0.05 (5%)\nApparently without the blacklisted node it works fine and the fractional memory shenanigans doesn't impact the job.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-18T11:40:54.498+0000","updated":"2014-06-18T11:40:54.498+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14035694","id":"14035694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Shall we mark this a duplicate of YARN-1680 then?  Sounds like if the memory of the blacklisted node had been removed from the reported headroom the AM would have acted appropriately.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-06-18T13:49:05.618+0000","updated":"2014-06-18T13:49:05.618+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721414/comment/14035819","id":"14035819","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"body":"Reading through the description of YARN-1680 sure seems like the root cause of my problem.\nSo yes, go ahead and mark this one as a duplicate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nielsbasjes","name":"nielsbasjes","key":"nielsbasjes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nielsbasjes&avatarId=26763","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nielsbasjes&avatarId=26763","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nielsbasjes&avatarId=26763","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nielsbasjes&avatarId=26763"},"displayName":"Niels Basjes","active":true,"timeZone":"Europe/Amsterdam"},"created":"2014-06-18T15:28:46.347+0000","updated":"2014-06-18T15:28:46.347+0000"}],"maxResults":17,"total":17,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5928/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1wsj3:"}}