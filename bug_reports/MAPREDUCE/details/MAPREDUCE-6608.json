{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12848899","self":"https://issues.apache.org/jira/rest/api/2/issue/12848899","key":"MAPREDUCE-6608","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-01-18T13:01:06.727+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jun 07 15:13:49 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6608/watchers","watchCount":25,"isWatching":false},"created":"2015-07-24T13:40:40.695+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12459261","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12459261","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12932181","key":"YARN-4602","self":"https://issues.apache.org/jira/rest/api/2/issue/12932181","fields":{"summary":"Simple and Scalable Message Service for YARN application","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}},{"id":"12454311","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12454311","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12683932","key":"YARN-1489","self":"https://issues.apache.org/jira/rest/api/2/issue/12683932","fields":{"summary":"[Umbrella] Work-preserving ApplicationMaster restart","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12459329","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12459329","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12946685","key":"YARN-4758","self":"https://issues.apache.org/jira/rest/api/2/issue/12946685","fields":{"summary":"Enable discovery of AMs by containers","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}},{"id":"12464088","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12464088","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"outwardIssue":{"id":"12665916","key":"MAPREDUCE-5485","self":"https://issues.apache.org/jira/rest/api/2/issue/12665916","fields":{"summary":"Allow repeating job commit by extending OutputCommitter API","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12464089","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12464089","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"outwardIssue":{"id":"12617132","key":"MAPREDUCE-4815","self":"https://issues.apache.org/jira/rest/api/2/issue/12617132","fields":{"summary":"Speed up FileOutputCommitter#commitJob for many output files","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-06-07T15:17:15.208+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"Providing a framework for work preserving AM is achieved in [YARN-1489|https://issues.apache.org/jira/browse/YARN-1489].  We would like to take advantage of this for MapReduce(MR) applications.  There are some challenges which have been described in the attached document and few options discussed.  We solicit feedback from the community.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12336050","id":"12336050","description":"MAPREDUCE-6608 branch","name":"MAPREDUCE-6608","archived":false,"released":false}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12786705","id":"12786705","filename":"Patch1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-07T14:25:00.444+0000","size":112621,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12786705/Patch1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12747025","id":"12747025","filename":"WorkPreservingMRAppMaster.pdf","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-24T13:43:03.222+0000","size":111930,"mimeType":"application/pdf","content":"https://issues.apache.org/jira/secure/attachment/12747025/WorkPreservingMRAppMaster.pdf"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12785818","id":"12785818","filename":"WorkPreservingMRAppMaster-1.pdf","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-02T18:53:48.946+0000","size":115596,"mimeType":"application/pdf","content":"https://issues.apache.org/jira/secure/attachment/12785818/WorkPreservingMRAppMaster-1.pdf"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12786706","id":"12786706","filename":"WorkPreservingMRAppMaster-2.pdf","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-07T14:36:00.816+0000","size":129389,"mimeType":"application/pdf","content":"https://issues.apache.org/jira/secure/attachment/12786706/WorkPreservingMRAppMaster-2.pdf"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Work Preserving AM Restart for MapReduce","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12982579","key":"MAPREDUCE-6726","self":"https://issues.apache.org/jira/rest/api/2/issue/12982579","fields":{"summary":"YARN Registry based AM discovery with retry and in-flight task persistent via JHS","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}},{"id":"12996862","key":"MAPREDUCE-6754","self":"https://issues.apache.org/jira/rest/api/2/issue/12996862","fields":{"summary":"Container Ids for an yarn application should be monotonically increasing in the scope of the application","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/14710927","id":"14710927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"body":"Upon discussing with [~vvasudev] exploring using Yarn Service Registry for Containers to locate the MR AppMaster.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2015-08-25T08:58:35.456+0000","updated":"2015-08-25T08:58:35.456+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15105251","id":"15105251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"Move it to MAPREDUCE project given most work in YARN (YARN-1489) has been done.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-01-18T13:01:06.727+0000","updated":"2016-01-18T13:01:06.727+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15105267","id":"15105267","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks [~srikanth.sampath] and [~raju.bairishetti] for proposing this JIRA and upload a design document. This work could be a significant improvement to our MapReduce framework reliability. \nGo through the current design doc, I think store new attempt address for MR AM in zookeeper could have scalability issues in case MR job has massive running tasks (ten thousands or more). I think it could be better to store/get new MR AM location from HDFS which has better scalability. \nAlso, in my understanding, Yarn Service Registry may not best fit for this case. CC [~stevel@apache.org] who is author of YSR.\nI could propose another version of design with more details in next few days in case we haven't started the development work yet.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-01-18T13:16:52.064+0000","updated":"2016-01-18T13:16:52.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15106081","id":"15106081","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raju.bairishetti","name":"raju.bairishetti","key":"raju.bairishetti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raju Bairishetti","active":true,"timeZone":"Etc/UTC"},"body":"[~djp] Thanks for your views on this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raju.bairishetti","name":"raju.bairishetti","key":"raju.bairishetti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raju Bairishetti","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-19T01:29:11.974+0000","updated":"2016-01-19T01:29:11.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15106086","id":"15106086","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raju.bairishetti","name":"raju.bairishetti","key":"raju.bairishetti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raju Bairishetti","active":true,"timeZone":"Etc/UTC"},"body":"I agree that storing state in zookeeper may have scalability issues. I am just thinking that will it be ended up having too many small files in hdfs if we are planning to store AM information in HDFS.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raju.bairishetti","name":"raju.bairishetti","key":"raju.bairishetti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raju Bairishetti","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-19T01:34:43.866+0000","updated":"2016-01-19T01:34:43.866+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15106139","id":"15106139","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"bq. I am just thinking that will it be ended up having too many small files in hdfs if we are planning to store AM information in HDFS.\nIt shouldn't be a problem if we cleanup this file when job get completed (like hookup in job commit stage).\n\n[~srikanth.sampath], I think there are still many details need to be taken care besides new attempt AM address. I noticed this JIRA hasn't been updated for any patch work for a while. Is this work a high priority for you in the short term? If not, do you mind I take it and move it forward? Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-01-19T02:28:39.108+0000","updated":"2016-01-19T02:28:39.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15106254","id":"15106254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~djp] for your comments.  Yes indeed there are more issues with it, I have a working version of it which uses the registry.  I have been in discussion with [~vvasudev].  There are some loose ends, which I will tie up and upload a patch and an updated design next week.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-19T05:09:49.374+0000","updated":"2016-01-19T05:09:49.374+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15128777","id":"15128777","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"body":"High Level Approach ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-02T18:53:48.951+0000","updated":"2016-02-02T18:53:48.951+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15128785","id":"15128785","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"body":"I have attached the high level approach used in the solution that is in the works.  I will update with a design patch and a detailed design soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-02T18:55:23.549+0000","updated":"2016-02-02T18:55:23.549+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15136272","id":"15136272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"body":"Updated high level design","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-07T14:36:00.821+0000","updated":"2016-02-07T14:36:00.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15136279","id":"15136279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"body":"I have attached a design patch - [Patch1|https://issues.apache.org/jira/secure/attachment/12786705/Patch1.patch] that gives a high level approach on the implementation.  The [Design|https://issues.apache.org/jira/secure/attachment/12786706/WorkPreservingMRAppMaster-2.pdf] document gives the high level design.\n\n*Notes:*\n1. This is a patch against Apache 2.6.1\n2. It works for the example hadoop sleep job - where I have killed the  AM randomly and the inflight tasks continue.\n3. SS_DEBUG in the patch indicates a debug statement that helps me. Some of these will be removed eventually.\n4. SS_FIXME in the patch is a tag for me to fix some known issues that I have commented on.  I will clean these up before the next submission.\n\nI solicit comments on the high level design and the approach I have taken in the patch.\n\n*Next Steps:*\n1. I will iron out the known issues (all SS_FIXME), clean up the interfaces,  make the code compliant with apache coding standards, rebase the code against trunk, and test it thoroughly.  I will factor in the comments and suggestions that are made with the design doc and design patch.\n2. Identify the components and issues involved and raise sub tasks.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-07T14:58:10.350+0000","updated":"2016-02-07T14:58:10.350+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15143761","id":"15143761","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I agree that storing state in zookeeper may have scalability issues. I am just thinking that will it be ended up having too many small files in hdfs if we are planning to store AM information in HDFS.\nA solution for this is already given at YARN-1489 by [~bikassaha]. See this comment: https://issues.apache.org/jira/browse/YARN-1489?focusedCommentId=13862359&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13862359.\n\nThe solution is essentially a combination of registry with YARN acting as a distributed readers solution: Registry owns the write path and storage, RM/NMs take care of providing scalable reads.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-02-12T00:16:56.739+0000","updated":"2016-02-12T00:16:56.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15159319","id":"15159319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks [~srikanth.sampath] for updating the design doc and uploading an outstanding demo patch!\nSorry for reply a little late as just come back from a vacation... Finally, I got chance to review the latest document and the demo patch. \n\n+1 on Vinod's proposal of separating write and read path. This solution is even better than my proposal (HDFS way) above as no single point access means better scalability. The only problem here is the implementation is more complicated as it involves new RPC service in NM (client side is task) and more payload between NM-RM heartbeat, so we should separate it out a dedicated YARN JIRA to track the work.\n\nOther quick comments on the design doc:\n\nbq.  The work preserving feature of an MR Application can be set at an application level, when the application is submitted.\nSounds good. We can involve a new MR config to switch on/off this feature (off by default). However, I didn't see any implementation on this in demo patch and I think we should add it in the beginning as we want to keep old behavior (code path) unchanged in case feature is off.\n\nbq. When the AM starts up, the registry operations is started as a service. An AM creates a service record id being the JobId and persistence being at the application level. It then stores the address(host, port) as an internal endpoint.\nBeside we need to replace the read path of registry service, another point is we don't necessary to keep the first attempt AM info which could saving most of overhead we are adding here as most applications are expected to end with single attempt. Isn't it?\n\nbq. Currently, YarnChild uses positional arguments as parameters. This will be enhanced to use named arguments as parameters. For work preserving jobs, the path to the service record is passed as the parameter to determine the address of the AM.\nAgree that named argument sounds better. However, this way has work for a long time for MapReduce project and we won't prefer to change unless we find some issue or bug. For path to service record, we need keep consistent with our decision on read path.\n\nbq. Thus UmbilicalWithRetries is a wrapper over Umbilical with retries implemented. Depending on whether the AM is workpreserving or not, a factory method creates either a vanilla umbilical or one with retries.\nUmbilicalWithRetries should follow other existing practice (for RPC client retry during service down time) that to create a RetryProxy with FailoverProxyProvider (may be call it as MRAMProxy) for task attempt to contact with new attempt instance for AM. \n\nTaskManagement part look good to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-02-23T17:59:54.880+0000","updated":"2016-02-23T17:59:54.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15162887","id":"15162887","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"body":"Thanks much [~djp] for your review and comments.  Appreciate it very much. \n\n*Issue 1*\n{quote}+1 on Vinod's proposal of separating write and read path.{quote}\nI agree and will log a separate YARN JIRA.  Do you think that effort should be linked to this work or can be done separately and later incorporated.  Given your suggestion for optimizing - using the service record for other attempts (not the first one) the read paths will be much fewer.  \n\n*Issue 2*\n{quote} We can involve a new MR config to switch on/off this feature (off by default). However, I didn't see any implementation on this in demo patch {quote}\nYes, not in the demo patch.  I will add it in the next version and also maintain the old code path when the configuration is off (the default).\n\n{quote} Beside we need to replace the read path of registry service, another point is we don't necessary to keep the first attempt AM info which could saving most of overhead we are adding here as most applications are expected to end with single attempt. Isn't it? {quote}\nYes.  That's correct.  Very good suggestion.\n\n{quote}Agree that named argument sounds better. However, this way has work for a long time for MapReduce project and we won't prefer to change unless we find some issue or bug. For path to service record, we need keep consistent with our decision on read path. {quote}\nI think named arguments are better.  If we end up changing the interface of YarnChild, I think we should do it.  It depends on what we decide on *Issue 1*\n\n{quote}UmbilicalWithRetries should follow other existing practice (for RPC client retry during service down time) that to create a RetryProxy with FailoverProxyProvider (may be call it as MRAMProxy) for task attempt to contact with new attempt instance for AM.{quote}\nThanks much for this very useful suggestion.  I will incorporate it.\n\nPlease let me know your recommendation on *Issue 1*","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-24T12:03:02.236+0000","updated":"2016-02-24T12:03:02.236+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15163297","id":"15163297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"bq. Please let me know your recommendation on Issue 1\nEven with optimization, it still sounds risky for AM failure on a large MR job (with 10-100 thousands of tasks could be) for ZK based reader way. So I think we need a separate JIRA to track YARN issue as this one is MAPREDUCE jira which track changes for MR project.\nPer my comments in YARN-1489, we already have YARN-4602 to track a generic message passing-by problem between containers for YARN. Please check if that one fit into our cases here. If so, we can think to work in parallel on this (based on some hacked/faked read path first until we have a real one later). Thoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-02-24T16:38:29.165+0000","updated":"2016-02-24T16:38:29.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15167140","id":"15167140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~djp].  Few points:\n1. The reads will only be for the inflight tasks out of the large MR job.  That said, it is possible for it to be large - for example multiple AMs fail.\n\n2. The read path in this case is required for communication between the task containers and the AM (not between task containers).  So indeed it is a subset of the cases addressed in [YARN-4602|https://issues.apache.org/jira/browse/YARN-4602].\n\n3. We need more details on how [YARN-4602|https://issues.apache.org/jira/browse/YARN-4602] will be addressed.  What's the latency for the payload to make it from the new AM to the registry (RM) and then to the NMs.  How will the task containers fetch the new address. Should we still have the registry based read path work as a fallback.\n\nI will be very happy to work with you in parallel on this.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-25T12:23:38.909+0000","updated":"2016-02-25T12:23:38.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15243948","id":"15243948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"[~srikanth.sampath] / [~djp],\n\nGot around to reading the design doc attached - there are a few important details that aren't covered in the doc, besides the AM discovery problem itself\n\nh4. Output Commit of previous tasks\nThe new AM needs to make sure that output of previously running containers can be safely committed. IIRC, with today's FileOutputCommitter, new AM will only promote task-outputs that are present in $jobOutput/_temporary/$currentAttemptID/\n\nSimilar changes may be needed for other OutputCommitters out there.\n\nh4. Task Output Commit races\n\nIt doesn't look like we record task-commit in JobHistory, so it is possible that the previous AM gave a commit go-ahead to a taskAttempt which is either (a) in the process of committing output or (b) committed the output but fails to report to either of the AMs. In this case, two taskAttempts can be committing at the same time!\n\nIn the same line, without recording the success of a commit after a task finishes committing, we will run into issues.\n\nh4. Conflicting TaskAttemptIDs\n\nToday, we launch containers first and then record it in JobHistory. Because of this, if the previous AM started a TaskAttempt but crashed before recording it in JobHistory, and this oldTaskAttempt somehow cannot get reconnected to the new AM due to network issues, the new AM generates the same TaskAttemptID for a newer attempt and they both will collide on HDFS and/or the local NM output directories if they both happen to run on the same machine.\n\nThe above problem will be worse when speculative tasks are involved.\n\nh4. Security\nAM should use the same job-token as the previous incarnation otherwise the old running tasks will get authentication failures. I quickly checked and it seems like the AM itself generates the token, which means the second AM will generate a different one and all running tasks will fail to sync back!\n\nh4. Others\nbq. In the WP case, upon a loss of connection to the AM the tasks will try and reestablish the connection with the new AM.\nThis will not suffice. It is possible even today, but when a network partition occurs and two AMs end up running at the same time and give commit-go permission to two TaskAttempts of the same task, they will collide on the output-commit.\n\nh4. General comments\nThis stuff is hard. Even if we forget about the AM discovery problem, I am sure others will find a bunch of other design considerations you may be missing now.\n\nI'd suggest spending more time on the design, atleast on some of the areas I pointed above and then create a branch, create sub-tasks, do some prototypes etc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-16T02:13:09.793+0000","updated":"2016-04-16T02:13:09.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15244727","id":"15244727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~vinodkv] for your comments.  I will dig deeper into these and respond.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikanth.sampath","name":"srikanth.sampath","key":"srikanth.sampath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srikanth.sampath&avatarId=26120","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srikanth.sampath&avatarId=26120","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srikanth.sampath&avatarId=26120","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srikanth.sampath&avatarId=26120"},"displayName":"Srikanth Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-17T17:00:37.240+0000","updated":"2016-04-17T17:00:37.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15248151","id":"15248151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"[~vinodkv], thanks for review and comments. I think most your points here are solid, however, the comments about \"Output Commit of previous tasks\" is a bit stale.\n\nbq. The new AM needs to make sure that output of previously running containers can be safely committed. IIRC, with today's FileOutputCommitter, new AM will only promote task-outputs that are present in $jobOutput/_temporary/$currentAttemptID/\nThis is true before YARN-4815. However, after YARN-4815, most task-output commit to job final output is handled by {{FileOutputCommitter.commitTask()}} instead of {{FileOutputCommitter.commitJob()}}. So the commitJob() only left work of cleanup $jobOutput/_temporary. So there is nothing need to do here except we make sure \"mapreduce.fileoutputcommitter.algorithm.version\" is set to 2. \nThis is also an assumption setting for work of MAPREDUCE-5485 which is a prerequisite for feature here - or AM will failed directly in case previous AM ends in job committing.\n\nInvestigating on rest of issues and will bring some possible proposals later.  \n\n\nbq. I'd suggest spending more time on the design, atleast on some of the areas I pointed above and then create a branch, create sub-tasks, do some prototypes etc.\n+1. This feature work could be a bit over my expectation before. I agree we could need a separated branch for developing this in parallel. Will create a branch once we finalize our design work. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-04-19T16:45:36.039+0000","updated":"2016-04-19T16:46:54.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12848899/comment/15318652","id":"15318652","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"I have create branch MAPREDUCE-6608 for this development work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-06-07T15:13:49.897+0000","updated":"2016-06-07T15:13:49.897+0000"}],"maxResults":20,"total":20,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6608/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2hwav:"}}