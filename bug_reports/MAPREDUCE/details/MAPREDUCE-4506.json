{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12601191","self":"https://issues.apache.org/jira/rest/api/2/issue/12601191","key":"MAPREDUCE-4506","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2012-08-02T10:00:08.032+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat May 02 04:21:13 UTC 2015","customfield_12310420":"239694","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-4506/watchers","watchCount":4,"isWatching":false},"created":"2012-08-02T09:29:38.579+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":["BB2015-05-TBR"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320250","id":"12320250","description":"maintenance release on branch-1.0","name":"1.0.3","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-06T03:31:09.111+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[],"timeoriginalestimate":null,"description":"When running complex mapreduce jobs with many mappers and reducers (e.g. 8 mappers, 8 reducers on a 8 core machine), sometimes the following exceptions pop up in the logs during the shuffle phase:\n\n{noformat}\nWARN [570516323@qtp-2060060479-164] 2012-07-19 02:50:21,229 TaskTracker.java (line 3894) getMapOutput(attempt_201207161621_0217_m_000071_0,0) failed :\norg.mortbay.jetty.EofException\n        at org.mortbay.jetty.HttpGenerator.flush(HttpGenerator.java:787)\n        at org.mortbay.jetty.AbstractGenerator$Output.flush(AbstractGenerator.java:568)\n        at org.mortbay.jetty.HttpConnection$Output.flush(HttpConnection.java:1005)\n        at org.mortbay.jetty.AbstractGenerator$Output.write(AbstractGenerator.java:648)\n        at org.mortbay.jetty.AbstractGenerator$Output.write(AbstractGenerator.java:579)\n        at org.apache.hadoop.mapred.TaskTracker$MapOutputServlet.doGet(TaskTracker.java:3872)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:820)\n        at org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:511)\n        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1166)\n        at org.apache.hadoop.http.HttpServer$QuotingInputFilter.doFilter(HttpServer.java:835)\n        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\n        at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:388)\n        at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\n        at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182)\n        at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765)\n        at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:418)\n        at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)\n        at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\n        at org.mortbay.jetty.Server.handle(Server.java:326)\n        at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\n        at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:923)\n        at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:547)\n        at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)\n        at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\n        at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)\n        at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\nCaused by: java.io.IOException: Connection reset by peer\n        at sun.nio.ch.FileDispatcher.write0(Native Method)\n        at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:29)\n        at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:72)\n        at sun.nio.ch.IOUtil.write(IOUtil.java:43)\n        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:334)\n        at org.mortbay.io.nio.ChannelEndPoint.flush(ChannelEndPoint.java:169)\n        at org.mortbay.io.nio.SelectChannelEndPoint.flush(SelectChannelEndPoint.java:221)\n        at org.mortbay.jetty.HttpGenerator.flush(HttpGenerator.java:721)\n{noformat}\n\nThe problem looks like some network problems at first, however it turns out that hadoop shuffleInMemory sometimes deliberately closes map-output-copy connections just to reopen them a few milliseconds later, because of temporary unavailability of free memory. Because the sending side does not expect this, an exception is thrown. Additionally this leads to wasting resources on the sender side, which does more work than required serving additional requests. \n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12538888","id":"12538888","filename":"RamManager.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","key":"pkolaczk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Kołaczkowski","active":true,"timeZone":"Europe/Berlin"},"created":"2012-08-02T09:34:18.634+0000","size":966,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12538888/RamManager.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12538889","id":"12538889","filename":"ReduceTask.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","key":"pkolaczk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Kołaczkowski","active":true,"timeZone":"Europe/Berlin"},"created":"2012-08-02T09:34:18.653+0000","size":11546,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12538889/ReduceTask.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"2553","customfield_12312823":null,"summary":"EofException / 'connection reset by peer' while copying map output ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","key":"pkolaczk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Kołaczkowski","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","key":"pkolaczk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Kołaczkowski","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Ubuntu Linux 12.04 LTS, 64-bit, Java 6 update 33","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601191/comment/13427202","id":"13427202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","key":"pkolaczk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Kołaczkowski","active":true,"timeZone":"Europe/Berlin"},"body":"Patch fixing the EofExceptions in shuffleInMemory. Additionally, map output copy connections are taken into try-finally block to assure they are closed properly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","key":"pkolaczk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Kołaczkowski","active":true,"timeZone":"Europe/Berlin"},"created":"2012-08-02T09:34:18.694+0000","updated":"2012-08-02T09:34:18.694+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601191/comment/13427203","id":"13427203","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","key":"pkolaczk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Kołaczkowski","active":true,"timeZone":"Europe/Berlin"},"body":"I attach a patch disabling the 'break connection' feature.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","key":"pkolaczk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Kołaczkowski","active":true,"timeZone":"Europe/Berlin"},"created":"2012-08-02T09:35:06.603+0000","updated":"2012-08-02T09:35:06.603+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601191/comment/13427221","id":"13427221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12538889/ReduceTask.patch\n  against trunk revision .\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/2699//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-02T10:00:08.032+0000","updated":"2012-08-02T10:00:08.032+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601191/comment/13427310","id":"13427310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Piotr,\n\nI agree that it is ugly to see the exception come out, but I am not really sure that your fix is the right one for 1.0.  Making the memory manager blocking means that the jetty thread on the task tracker will not be able to serve up results to others.  This could potentially slow down processing for very large jobs.  I think it would be a lot better to do something like that on trunk, where the problem also exists, but the node manager uses netty instead of jetty so it is not a full thread that is blocked but just some memory and a file descriptor.  Assuming that we have a timeout on how long the thread waits for memory to become available.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2012-08-02T13:27:30.537+0000","updated":"2012-08-02T13:27:30.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601191/comment/14524557","id":"14524557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12538889/ReduceTask.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / f1a152c |\n| Console output | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5494/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-02T04:21:13.341+0000","updated":"2015-05-02T04:21:13.341+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-4506/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i00siv:"}}