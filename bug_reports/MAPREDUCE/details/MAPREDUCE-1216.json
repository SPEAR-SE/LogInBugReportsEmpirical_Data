{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12440840","self":"https://issues.apache.org/jira/rest/api/2/issue/12440840","key":"MAPREDUCE-1216","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2009-11-28T00:42:47.868+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Nov 28 00:42:47 UTC 2009","customfield_12310420":"149359","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_971787598_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-11-28T00:42:56.413+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-1216/watchers","watchCount":5,"isWatching":false},"created":"2009-11-16T18:46:28.815+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":10800,"aggregatetimeoriginalestimate":10800,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314047","id":"12314047","description":"","name":"0.20.1","archived":false,"released":true,"releaseDate":"2009-09-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-11-28T00:42:56.389+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":10800,"description":"MRUnit should sort the input for a reduce task, the same way hadoop does.\nThis is useful if you have a reduce task that, for instance, removes duplicate key value pairs.\n\nexample:\n{code:java}\nclass BadReducer extends Reducer{\npublic void reduce(...){\n Text last = new Text();\n for(Text text: values){\n   if(!text.equals(last)){\n     context.write(key, text);\n     last.set(text);\n    }\n  }\n }\n}\n{code}\n\n{code:java}\nReduceDriver driver = new ReduceDriver()\ndriver.setInputKey(\"foo\");\ndriver.addInputValue(\"bar\");\ndriver.addInputValue(\"bar\");\ndriver.addInputValue(\"foo\");\n{code}\nproduces different results than \n{code:java}\nReduceDriver driver = new ReduceDriver()\ndriver.setInputKey(\"foo\");\ndriver.addInputValue(\"bar\");\ndriver.addInputValue(\"foo\");\ndriver.addInputValue(\"bar\");\n{code}","customfield_10010":null,"timetracking":{"originalEstimate":"3h","remainingEstimate":"3h","originalEstimateSeconds":10800,"remainingEstimateSeconds":10800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":10800,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"111532","customfield_12312823":null,"summary":"MRUnit Should Sort Reduce Input","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekohlwey","name":"ekohlwey","key":"ekohlwey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekohlwey&avatarId=15046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekohlwey&avatarId=15046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekohlwey&avatarId=15046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekohlwey&avatarId=15046"},"displayName":"Ed Kohlwey","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekohlwey","name":"ekohlwey","key":"ekohlwey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekohlwey&avatarId=15046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekohlwey&avatarId=15046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekohlwey&avatarId=15046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekohlwey&avatarId=15046"},"displayName":"Ed Kohlwey","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":10800,"percent":0},"customfield_12311024":null,"environment":"Cloudera Distribution for Hadoop 0.20.1 + 133","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":10800,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440840/comment/12783190","id":"12783190","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kimballa","name":"kimballa","key":"kimballa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Kimball","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm not sure I follow your logic. The values associated with a key do not have a well-defined sort order. Therefore, neither should MRUnit. However, the keys associated with a reducer are sorted. \n\nIn MRUnit a ReduceDriver can only handle a single input key, but the MapReduceDriver will allow you to pass an arbitrary set of key-value pairs (bounded by memory) from the mapper to the reducer. The keys forwarded from the mapper to the reducer via this driver will be sorted.\n\nIf you want to test Hadoop's sorting semantics yourself, create two files. Put the letters 'a' through 'z' in one file, one-per-line, in ascending order. In the other file, put the same lines in descending order ('z' down to 'a').\n\nThen run this program:\n\n{code}\npublic class Foo {\n  public static void main(String [] args) throws Exception {\n    Job job = new Job();\n    job.setJarByClass(Foo.class);\n    FileInputFormat.addInputPath(job, new Path(\"in\"));\n    FileOutputFormat.setOutputPath(job, new Path(\"out\"));\n    job.setNumReduceTasks(1);\n    job.waitForCompletion(true);\n  }\n}\n{code}\n\nThis will use the identity mapper and reducer.\n\nA fragment of the output I get is:\n{code}\n44\td\n44\tw\n46\tx\n46\tc\n{code}\n\n.. demonstrating that the values are not necessarily sorted within a key.\n\nI think that MRUnit has helped you catch a bug in your deduplication reducer :)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kimballa","name":"kimballa","key":"kimballa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Kimball","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-11-28T00:42:47.868+0000","updated":"2009-11-28T00:42:47.868+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-1216/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jg27:"}}