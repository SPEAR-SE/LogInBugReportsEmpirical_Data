{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12491971","self":"https://issues.apache.org/jira/rest/api/2/issue/12491971","key":"MAPREDUCE-2209","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2010-12-03T18:15:02.597+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jul 07 13:09:08 UTC 2012","customfield_12310420":"35680","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-2209/watchers","watchCount":7,"isWatching":false},"created":"2010-12-03T09:15:43.896+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315570","id":"12315570","description":"","name":"0.23.0","archived":false,"released":true,"releaseDate":"2011-11-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-07T13:09:09.047+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"If a job's jar file is very large, e.g 200m+, the TaskTracker's heartbeat hang for several minutes when localizing the job. The jstack of related threads are as follows:\n{code:borderStyle=solid}\n\"TaskLauncher for task\" daemon prio=10 tid=0x0000002b05ee5000 nid=0x1adf runnable [0x0000000042e56000]\n   java.lang.Thread.State: RUNNABLE\n        at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)\n        at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:215)\n        at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:65)\n        at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:69)\n        - locked <0x0000002afc892ec8> (a sun.nio.ch.Util$1)\n        - locked <0x0000002afc892eb0> (a java.util.Collections$UnmodifiableSet)\n        - locked <0x0000002afc8927d8> (a sun.nio.ch.EPollSelectorImpl)\n        at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:80)\n        at org.apache.hadoop.net.SocketIOWithTimeout$SelectorPool.select(SocketIOWithTimeout.java:260)\n        at org.apache.hadoop.net.SocketIOWithTimeout.doIO(SocketIOWithTimeout.java:155)\n        at org.apache.hadoop.net.SocketInputStream.read(SocketInputStream.java:150)\n        at org.apache.hadoop.net.SocketInputStream.read(SocketInputStream.java:123)\n        at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)\n        at java.io.BufferedInputStream.read(BufferedInputStream.java:237)\n        - locked <0x0000002afce26158> (a java.io.BufferedInputStream)\n        at java.io.DataInputStream.readShort(DataInputStream.java:295)\n        at org.apache.hadoop.hdfs.DFSClient$BlockReader.newBlockReader(DFSClient.java:1304)\n        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.blockSeekTo(DFSClient.java:1556)\n        - locked <0x0000002afce26218> (a org.apache.hadoop.hdfs.DFSClient$DFSInputStream)\n        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.read(DFSClient.java:1673)\n        - locked <0x0000002afce26218> (a org.apache.hadoop.hdfs.DFSClient$DFSInputStream)\n        at java.io.DataInputStream.read(DataInputStream.java:83)\n        at org.apache.hadoop.io.IOUtils.copyBytes(IOUtils.java:47)\n        at org.apache.hadoop.io.IOUtils.copyBytes(IOUtils.java:85)\n        at org.apache.hadoop.fs.FileUtil.copy(FileUtil.java:209)\n        at org.apache.hadoop.fs.FileUtil.copy(FileUtil.java:142)\n        at org.apache.hadoop.fs.FileSystem.copyToLocalFile(FileSystem.java:1214)\n        at org.apache.hadoop.fs.FileSystem.copyToLocalFile(FileSystem.java:1195)\n        at org.apache.hadoop.mapred.TaskTracker.localizeJob(TaskTracker.java:824)\n        - locked <0x0000002afce2d260> (a org.apache.hadoop.mapred.TaskTracker$RunningJob)\n        at org.apache.hadoop.mapred.TaskTracker.startNewTask(TaskTracker.java:1745)\n        at org.apache.hadoop.mapred.TaskTracker.access$1200(TaskTracker.java:103)\n        at org.apache.hadoop.mapred.TaskTracker$TaskLauncher.run(TaskTracker.java:1710)\n\n\"Map-events fetcher for all reduce tasks on tracker_r01a08025:localhost/127.0.0.1:50050\" daemon prio=10 tid=0x0000002b05ef8000 \nnid=0x1ada waiting for monitor entry [0x0000000042d55000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n        at org.apache.hadoop.mapred.TaskTracker$MapEventsFetcherThread.reducesInShuffle(TaskTracker.java:582)\n        - waiting to lock <0x0000002afce2d260> (a org.apache.hadoop.mapred.TaskTracker$RunningJob)\n        at org.apache.hadoop.mapred.TaskTracker$MapEventsFetcherThread.run(TaskTracker.java:617)\n        - locked <0x0000002a9eefe1f8> (a java.util.TreeMap)\n\n\n\"IPC Server handler 2 on 50050\" daemon prio=10 tid=0x0000002b050eb000 nid=0x1ab0 waiting for monitor entry [0x000000004234b000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n        at org.apache.hadoop.mapred.TaskTracker.getMapCompletionEvents(TaskTracker.java:2684)\n        - waiting to lock <0x0000002a9eefe1f8> (a java.util.TreeMap)\n        - locked <0x0000002a9eac1de8> (a org.apache.hadoop.mapred.TaskTracker)\n        at sun.reflect.GeneratedMethodAccessor5.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:481)\n        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:894)\n\n\"main\" prio=10 tid=0x0000000040113800 nid=0x197d waiting for monitor entry [0x000000004022a000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n        at org.apache.hadoop.mapred.TaskTracker.transmitHeartBeat(TaskTracker.java:1196)\n        - waiting to lock <0x0000002a9eac1de8> (a org.apache.hadoop.mapred.TaskTracker)\n        at org.apache.hadoop.mapred.TaskTracker.offerService(TaskTracker.java:1068)\n        at org.apache.hadoop.mapred.TaskTracker.run(TaskTracker.java:1799)\n        at org.apache.hadoop.mapred.TaskTracker.main(TaskTracker.java:2898)\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12488372","id":"12488372","filename":"2209-1.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2011-08-01T06:20:24.256+0000","size":1069,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12488372/2209-1.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12489154","id":"12489154","filename":"MAPREDUCE-2209.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"created":"2011-08-03T03:43:48.870+0000","size":1654,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12489154/MAPREDUCE-2209.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"111928","customfield_12312823":null,"summary":"TaskTracker's heartbeat hang for several minutes when copying large job.jar from HDFS","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"hadoop version: 0.19.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/12966606","id":"12966606","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"I noticed you marked this as Affects 0.19.1. Do you have reason to believe this is still an issue in trunk? 0.19 is >2 years old at this point.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-12-03T18:15:02.597+0000","updated":"2010-12-03T18:15:02.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/12969238","id":"12969238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"body":"I setup a cluster with the latest version 0.21.0.  To simulate the large job.jar problem, let TaskLauncher thread sleep 100 seconds just before download job.jar in localizeJobJarFile function.  Then the heartbeat of some TT will hang for almost 100 seconds. Basically, the jstack is the same with 0.19:\n{code:borderStyle=solid}\n\"TaskLauncher for MAP tasks\" daemon prio=10 tid=0x00002aab3145a800 nid=0x3fe8 waiting on condition [0x00000000440b3000..0x00000000440b3a10]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n        at java.lang.Thread.sleep(Native Method)\n        at org.apache.hadoop.mapred.TaskTracker.localizeJobJarFile(TaskTracker.java:1150)\n        at org.apache.hadoop.mapred.TaskTracker.localizeJobFiles(TaskTracker.java:1074)\n        at org.apache.hadoop.mapred.TaskTracker.localizeJob(TaskTracker.java:977)\n        - locked <0x00002aaab3a86f10> (a org.apache.hadoop.mapred.TaskTracker$RunningJob)\n        at org.apache.hadoop.mapred.TaskTracker.startNewTask(TaskTracker.java:2248)\n        at org.apache.hadoop.mapred.TaskTracker$TaskLauncher.run(TaskTracker.java:2213)\n\n\"Map-events fetcher for all reduce tasks on tracker_hd2:localhost.localdomain/127.0.0.1:36128\" daemon prio=10 tid=0x00002aab\n31451c00 nid=0x3fde waiting for monitor entry [0x0000000041a40000..0x0000000041a40d90]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n        at org.apache.hadoop.mapred.TaskTracker$MapEventsFetcherThread.reducesInShuffle(TaskTracker.java:800)\n        - waiting to lock <0x00002aaab3a86f10> (a org.apache.hadoop.mapred.TaskTracker$RunningJob)\n        at org.apache.hadoop.mapred.TaskTracker$MapEventsFetcherThread.run(TaskTracker.java:834)\n        - locked <0x00002aaab38ee1b8> (a java.util.TreeMap)\n\n\"IPC Server handler 0 on 36128\" daemon prio=10 tid=0x000000004368ac00 nid=0x3fc8 waiting for monitor entry [0x00000000425f6000..0x00000000425\nf7c90]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n        at org.apache.hadoop.mapred.TaskTracker.getMapCompletionEvents(TaskTracker.java:3254)\n        - waiting to lock <0x00002aaab38ee1b8> (a java.util.TreeMap)\n        - locked <0x00002aaab37f1708> (a org.apache.hadoop.mapred.TaskTracker)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.hadoop.ipc.WritableRpcEngine$Server.call(WritableRpcEngine.java:342)\n        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1350)\n        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1346)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:396)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:742)\n        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:1344)\n\n\"main\" prio=10 tid=0x0000000042fff400 nid=0x3f91 waiting for monitor entry [0x0000000041ef0000..0x0000000041ef0ed0]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n        at org.apache.hadoop.mapred.TaskTracker.transmitHeartBeat(TaskTracker.java:1535)\n        - waiting to lock <0x00002aaab37f1708> (a org.apache.hadoop.mapred.TaskTracker)\n        at org.apache.hadoop.mapred.TaskTracker.offerService(TaskTracker.java:1433)\n        at org.apache.hadoop.mapred.TaskTracker.run(TaskTracker.java:2330)\n        at org.apache.hadoop.mapred.TaskTracker.main(TaskTracker.java:3462)\n{code}\nlock order of relative threads:\nTaskLauncher(localizeJobJarFile):                         locked RunningJob\nMap-events fetcher:                                                    locked runningJobs   waiting to lock RunningJob\nIPC Server handler(getMapCompletionEvents):  locked TaskTracker   waiting to lock runningJobs\nmain(transmitHeartBeat):                                         waiting to lock TaskTracker   \nSo, TaskTracker is locked indirectly when downloading job.jar.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2010-12-08T08:00:25.967+0000","updated":"2010-12-08T08:00:25.967+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/12970536","id":"12970536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"body":"Hi Liyin,\nYour analysis is correct. The locking order (indirect) is causing the heartbeat to block. The main cause of this issue is a DFS call inside a lock. We removed lot of such cases in JobTracker by removing DFS calls from under locks. One such way to do it would be to queue up the DFS requests. This will help in this case because TaskLauncher is running as a thread  and hence starting a new task isn't inline, i.e its asynchronous.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-11T22:54:38.885+0000","updated":"2010-12-11T22:54:38.885+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/13073441","id":"13073441","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Amar,\n\nThe order of locking:\n||Thread Name||State||Locked||Waiting to Lock||\n|TaskLauncher(TaskLauncher.run  localizeJob())|Runnable(Downloading the jar file)|*rjob* 0x0000002afce2d260|   |\n|Map-events(MapEventsFetcherThread.run()  reducesInShuffle())|Blocked|*runningJobs* 0x0000002a9eefe1f8|Waiting to lock 0x0000002afce2d260 which is held in previous row|\n|IPC Server handler(GetMapEventsThread.run()  getMapCompletionEvents()  TaskUmbilicalProtocol.getMapCompletionEvents())|Blocked|*TaskTracker* 0x0000002a9eac1de8|Waiting to Lock 0x0000002a9eefe1f8 which is held in previous row|\n|Main Thread (TaskTracker.offerService())|Blocked|  |Waiting to Lock 0x0000002a9eac1de8 which is held in previous row|\n\nAs per my understanding the lock on *rjob* in the method *void org.apache.hadoop.mapred.TaskTracker.localizeJob(TaskInProgress tip) throws IOException* is aquired to make sure that no two task of same job try to localize the job.\nI think making the download of HDFS resources asynchrounus (in a queue) will not solve the purpose as before the Task Execution starts, the said resources should be available in Local File System.\n\nInstead to aquiring the lock on *rjob*, we can aquire the lock on more granular object say *\"rjob.localized\"*(changing localized to Object from primitive). This will solve the purpose of aquiring lock and at the same time we will not block the other threads.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"created":"2011-08-01T05:56:21.111+0000","updated":"2011-08-01T05:56:21.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/13073442","id":"13073442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"body":"Hi Subroto，\n  In fact，we have fixed this issuethrough reducing the lock of _TaskTracker::getMapCompletionEvents()_. And it works well in our 1500 nodes product cluster.I will attach a diff file for 0.19.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2011-08-01T06:19:10.986+0000","updated":"2011-08-01T06:19:10.986+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/13076182","id":"13076182","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"body":"The solution of reducing the lock will ensure the task tracker will keep on breathing.\nReducing the lock level in the method *TaskTracker::getMapCompletionEvents* will not target the thread blocking *MapEventsFetcherThread* and *GetMapEventsThread*. The threads will be still blocked.\n\nAttaching a patch for the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"created":"2011-08-02T13:10:16.420+0000","updated":"2011-08-02T13:10:16.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/13080715","id":"13080715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"body":"Hi Subroto,\nYour analysis is great and your patch looks good to me. However, I found another issue MAPREDUCE-2364 which is duplicated with this one. What's more, their solution is mostly the same with your patch. I think one of them should be close as duplicate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liangly","name":"liangly","key":"liangly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=liangly&avatarId=10105","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=liangly&avatarId=10105","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=liangly&avatarId=10105","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=liangly&avatarId=10105"},"displayName":"Liyin Liang","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2011-08-08T01:58:55.070+0000","updated":"2011-08-08T01:58:55.070+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/13080743","id":"13080743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"body":"Thankx Liyin for pointing out the issue MAPREDUCE-2364","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"created":"2011-08-08T04:48:04.509+0000","updated":"2011-08-08T04:48:04.509+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/13081084","id":"13081084","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"Subroto/Liyin - In general the community is moving forward with a complete re-architecture of Hadoop MapReduce from 0.23 onwards: MAPREDUCE-279 for more details.\n\nThus, you might be better off focussing your efforts either on hadoop-0.20.203 and beyond (the classic mapreduce) or, better yet, helping out with MAPREDUCE-279 (new mapreduce). Given your valuable experience on 'classic' mapreduce, your help on MAPREDUCE-279 would be very welcome. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-08T17:46:39.167+0000","updated":"2011-08-08T17:46:39.167+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/13098707","id":"13098707","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"Sorry to come in late, the patch has gone stale. Can you please rebase? Thanks.\n\nGiven this is not an issue with MRv2 should we still commit this? I'm happy to, but not sure it's useful. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-07T08:10:09.549+0000","updated":"2011-09-07T08:10:09.549+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12491971/comment/13408663","id":"13408663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"body":"(This isn't a blocker, resetting severity)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-07-07T13:09:08.922+0000","updated":"2012-07-07T13:09:08.922+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-2209/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jii7:"}}