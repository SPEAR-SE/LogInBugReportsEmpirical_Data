{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12960488","self":"https://issues.apache.org/jira/rest/api/2/issue/12960488","key":"MAPREDUCE-6684","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329060","id":"12329060","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335734","id":"12335734","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-04-21T02:07:45.074+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue May 10 16:51:54 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_2_*:*_1034172754_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_2_*:*_675370070","customfield_12312321":null,"resolutiondate":"2016-05-10T16:17:53.890+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6684/watchers","watchCount":9,"isWatching":false},"created":"2016-04-20T21:25:31.188+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327586","id":"12327586","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"issuelinks":[{"id":"12466733","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12466733","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12922231","key":"MAPREDUCE-6573","self":"https://issues.apache.org/jira/rest/api/2/issue/12922231","fields":{"summary":"Reduce the time of calling scanIntermediateDirectory in getFileInfo","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12466732","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12466732","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12845801","key":"MAPREDUCE-6436","self":"https://issues.apache.org/jira/rest/api/2/issue/12845801","fields":{"summary":"JobHistory cache issue","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12483550","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12483550","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13013483","key":"MAPREDUCE-6797","self":"https://issues.apache.org/jira/rest/api/2/issue/13013483","fields":{"summary":"Job history server scans can become blocked on a single, slow entry","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12466723","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12466723","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12970210","key":"MAPREDUCE-6698","self":"https://issues.apache.org/jira/rest/api/2/issue/12970210","fields":{"summary":"Increase timeout on TestUnnecessaryBlockingOnHistoryFileInfo.testTwoThreadsQueryingDifferentJobOfSameUser","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-10-19T11:50:31.604+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315343","id":"12315343","name":"jobhistoryserver"}],"timeoriginalestimate":null,"description":"HistoryFileManager.scanIntermediateDirectory() in JHS acquires a lock on each user directory it tries to scan (move or delete files under the user directory as necessary). This method is called in a thread in JobHistory that performs periodical scanning of intermediate directory, and can also be called by web server threads for each Web API call made by a JHS client. In cases where there are many concurrent Web API calls/connections to JHS, all but one thread are blocked on the lock on the user directory. Eventually, client connects will time out, but the threads in JHS will not be killed and leave a lot of TCP connections in CLOSE_WAIT state. \n\n{noformat}\n[systest@vb1120 ~]$ sudo netstat -nap | grep 63729 | sort -k 4\ntcp        0      0 10.17.202.19:10020          0.0.0.0:*                   LISTEN      63729/java          \ntcp        0      0 10.17.202.19:10020          10.17.198.30:33010          ESTABLISHED 63729/java          \ntcp        0      0 10.17.202.19:10020          10.17.200.30:33980          ESTABLISHED 63729/java          \ntcp        0      0 10.17.202.19:10020          10.17.202.10:59625          ESTABLISHED 63729/java          \ntcp        0      0 10.17.202.19:10020          10.17.202.13:35765          ESTABLISHED 63729/java          \ntcp        0      0 10.17.202.19:10033          0.0.0.0:*                   LISTEN      63729/java          \ntcp        0      0 10.17.202.19:19888          0.0.0.0:*                   LISTEN      63729/java          \ntcp        0      0 10.17.202.19:19888          10.17.198.30:35103          ESTABLISHED 63729/java          \ntcp      277      0 10.17.202.19:19888          10.17.198.30:43670          ESTABLISHED 63729/java          \ntcp        0      0 10.17.202.19:19888          10.17.198.30:45453          ESTABLISHED 63729/java          \ntcp      277      0 10.17.202.19:19888          10.17.198.30:49184          ESTABLISHED 63729/java          \ntcp        1      0 10.17.202.19:19888          10.17.202.13:49992          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:52703          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52707          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52708          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52710          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52714          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52723          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52726          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52727          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52739          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:52749          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52753          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52757          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52760          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52820          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52827          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52829          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52831          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52833          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52836          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52839          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52841          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:52843          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52850          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52860          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52876          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52879          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52881          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52884          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52886          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52888          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52891          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52893          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52896          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52898          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:52899          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52902          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52909          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52910          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52912          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52923          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52925          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52927          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:52930          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52937          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52939          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52945          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52947          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52969          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:52972          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:52975          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53004          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53007          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53009          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53011          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53052          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53058          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53059          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53063          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:53071          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53084          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53093          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53095          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53097          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53101          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53104          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53106          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53108          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53110          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53112          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53114          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:53115          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53117          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53121          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53123          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53125          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53127          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53129          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53131          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53134          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53138          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53140          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:53153          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53155          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53157          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53159          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:53173          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53176          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53177          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53178          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53179          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53181          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53183          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53201          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53204          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:53218          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53267          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53270          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53275          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53278          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53280          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53283          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53293          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53296          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:53299          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53309          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53312          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53314          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53317          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53320          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53322          CLOSE_WAIT  63729/java          \ntcp      256      0 10.17.202.19:19888          10.17.202.13:53338          CLOSE_WAIT  63729/java          \ntcp      261      0 10.17.202.19:19888          10.17.202.13:53340          CLOSE_WAIT  63729/java          \ntcp      255      0 10.17.202.19:19888          10.17.202.13:53364          ESTABLISHED 63729/java          \ntcp      255      0 10.17.202.19:19888          10.17.202.13:53366          ESTABLISHED 63729/java          \ntcp      260      0 10.17.202.19:19888          10.17.202.13:53367          ESTABLISHED 63729/java          \ntcp      255      0 10.17.202.19:19888          10.17.202.13:53380          ESTABLISHED 63729/java          \ntcp      255      0 10.17.202.19:19888          10.17.202.13:53382          ESTABLISHED 63729/java          \ntcp      255      0 10.17.202.19:19888          10.17.202.13:53386          ESTABLISHED 63729/java          \ntcp      255      0 10.17.202.19:19888          10.17.202.13:53390          ESTABLISHED 63729/java          \ntcp      255      0 10.17.202.19:19888          10.17.202.13:53392          ESTABLISHED 63729/java          \ntcp     1278      0 10.17.202.19:19888          10.17.202.18:45301          CLOSE_WAIT  63729/java          \ntcp     1278      0 10.17.202.19:19888          10.17.202.18:45303          CLOSE_WAIT  63729/java          \ntcp     1277      0 10.17.202.19:19888          10.17.202.18:45306          ESTABLISHED 63729/java \n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329060","id":"12329060","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12799844","id":"12799844","filename":"jhs-jstacks-service-monitor-running.tar.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-20T22:05:30.505+0000","size":417549,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12799844/jhs-jstacks-service-monitor-running.tar.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12799845","id":"12799845","filename":"jhs-jstacks-service-monitor-stopped.tar.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-20T22:05:30.510+0000","size":379783,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12799845/jhs-jstacks-service-monitor-stopped.tar.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12801818","id":"12801818","filename":"mapreduce6684.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-02T20:38:57.252+0000","size":18176,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12801818/mapreduce6684.001.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12803018","id":"12803018","filename":"mapreduce6684.002.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-09T16:59:57.316+0000","size":18179,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12803018/mapreduce6684.002.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12803034","id":"12803034","filename":"mapreduce6684.003.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-09T18:14:21.874+0000","size":18185,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12803034/mapreduce6684.003.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"High contention on scanning of user directory under immediate_done in Job History Server","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15250809","id":"15250809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Attaching the jstack logs","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-20T22:05:30.515+0000","updated":"2016-04-20T22:05:30.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15250827","id":"15250827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Most web API calls tend to invoke HistoryFileManager.getFileInfo(JobId) that looks up the job history files in the intermediate directory first before in the done directory. If jobs are already in done directory in most cases, we could scan the done directory first then intermediate directory and therefore reduce the contention on the intermediate user directories.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-20T22:16:49.780+0000","updated":"2016-04-20T22:16:49.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15251110","id":"15251110","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"Was looking into this along with [~haibochen]. The two tarballs of jstacks attached here correspond to a monitoring process turned on/off; the monitoring process has threads connecting to the JHS and asking for details about a job. We have seen a few problems:\n# JHS continues to process a request (scan directories and fetch file) even after the requesting connection has terminated. \n# As Haibo mentioned, each thread scans the intermediate directory (and moves any available files to done dir). This scan is protected by a lock on the intermediate directory. When there are multiple threads, all threads but one are blocked. Couple of problems with this:\n## Threads that are trying to load a file that is already in the done_dir also seem to be blocked on scanning the intermediate dir\n## Even though a thread with the lock might process files required by other threads, those threads redo the scan (potentially moving other files they don't need) leading to longer turn-around-time per thread and maxing out the number of threads (default of 256). ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-21T02:07:45.074+0000","updated":"2016-04-21T02:07:45.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15251116","id":"15251116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"Is it okay to scan the done directory first as Haibo suggested? \n\nIn addition to that, I wonder if there should be a single thread (with sleeps) moving files from intermediate to done. Other threads needing a particular job's jhist file could wake this moving thread and register for updates for that file. Once a file is moved, the moving thread could notify these other waiting threads. That way, we ensure serving threads wait only as long as required. \n\n[~jlowe], [~revans2] - what do you think? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-21T02:14:53.082+0000","updated":"2016-04-21T02:14:53.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15251961","id":"15251961","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"It has been a while since I did anything with this (2013 from the edit logs).  As such I don't remember too much about the code so feel free to take my advice or leave it, as I could be wrong.  Now that I finished with the all the disclaimers I believe that the reason we scan the intermediate directory first is to not drop any files that might be in the middle of being moved from intermediate_done to done.  So if you look in the older directory first you might miss some files that are in the middle of being moved, and then when you scan intermediate_done you wouldn't see those files because they have already been moved.  So if you think there is a high probability that you will find the files you want in the done dir then you would need to \n\nscan the done dir\nif not found scan intermediate_done\n//Because something might have been in flight\nif still not found scan the done dir again.\n\nFrom our experience the majority of the hits to the history server for a job/application happen right after the application finishes.  So at least for our usage pattern this would not help much, and would probably add a lot more load to the namenode, something that we are much more concerned about.\n\nHaving the scanner be on a background thread would help, but you would need some synchronization that is a bit more complex then just a waking the thread up and then waiting for a notification that it was done.  From the clients perspective if a history file was placed in the intermediate_done dir and then they made a call to the history server it had better pick up that file and return a result.  So we need to be sure that the waiting thread will only be woken up in the case where nothing was found if the scan started after the request was made.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2016-04-21T14:25:40.160+0000","updated":"2016-04-21T14:25:40.160+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15254314","id":"15254314","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks a lot for your insight on why intermediated directory is scanned before done directory and potential name node issue, [~revans2]. That makes a lot of sense. Per offline discussion with [~karthik.jayaprakasham@ldc.lu.se], we'd like to propose three approaches. \n\n1. For web API requests for individual jobs, the intermediate directory is still scanned first, but inside scanIntermediateDir(), we could add checking of existence of the jhst files of the associated job (), and only when the files do exist do we move files in intermediate directory to done directory. The assumption is that file existence is not expensive, and if the files do not exist in intermediate directory, we only acquire the lock on the user directory for a short period of time.\n\n2. For web API requests of individual jobs, when intermediate directory is scanned, check the existence of the job files, and only files of the job associated with the request are moved from intermediate directory to done directory.  This reduces the time for which each job web request thread blocks, but may have much smaller overall throughput  that the previous approach when file moving is done in batch.\n\n3. Have a dedicated thread to scan the intermediate directory and other threads to wait on a monitor associated with a particular job. When the dedicated thread finishes, threads waiting on the monitors will be notified. By having a single writer, the contention on the user directory lock can be reduced. But it does have the problem of conflicting with clients' expectation as [~revans2] pointed out in previous comment.\n\nCan you please share some of your thoughts on them, [~revans2], [~jlowe]?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-22T17:51:05.374+0000","updated":"2016-04-22T17:51:05.374+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15258190","id":"15258190","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"We need to get to the bottom of why the lock is being held so long. The move itself is done via an executor pool so that shouldn't be slow.\n\nAccording to the jstacks, every single one has this stacktrace for the thread that has the lock on the user's intermediate directory:\n{noformat}\n   java.lang.Thread.State: BLOCKED (on object monitor)\n        at org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager$HistoryFileInfo.didMoveFail(HistoryFileManager.java:356)\n        - waiting to lock <0x000000056106dd80> (a org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager$HistoryFileInfo)\n        at org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager.scanIntermediateDirectory(HistoryFileManager.java:873)\n        at org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager.access$200(HistoryFileManager.java:82)\n        at org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager$UserLogDir.scanIfNeeded(HistoryFileManager.java:315)\n        - locked <0x00000004fae96ee0> (a org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager$UserLogDir)\n        at org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager.scanIntermediateDirectory(HistoryFileManager.java:839)\n        at org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager.getFileInfo(HistoryFileManager.java:978)\n        at org.apache.hadoop.mapreduce.v2.hs.CachedHistoryStorage.loadJob(CachedHistoryStorage.java:174)\n[...]\n{noformat}\n\nSo the thread has the lock, but it's waiting a long time on some other thread which isn't ideal.  Every jstack shows the other thread doing this:\n{noformat}\n\"473394034@qtp-1617102129-245\" daemon prio=10 tid=0x00007f66c8185000 nid=0x6437 runnable [0x00007f6693b6c000]\n   java.lang.Thread.State: RUNNABLE\n      at java.util.HashMap.put(HashMap.java:494)\n      at org.apache.avro.util.WeakIdentityHashMap.put(WeakIdentityHashMap.java:108)\n      at org.apache.avro.LogicalTypes.fromSchemaIgnoreInvalid(LogicalTypes.java:62)\n      at org.apache.avro.Schema.parse(Schema.java:1318)\n      at org.apache.avro.Schema.parse(Schema.java:1260)\n      at org.apache.avro.Schema.parse(Schema.java:1331)\n      at org.apache.avro.Schema.parse(Schema.java:1260)\n      at org.apache.avro.Schema$Parser.parse(Schema.java:1024)\n      at org.apache.avro.Schema$Parser.parse(Schema.java:1012)\n      at org.apache.avro.Schema.parse(Schema.java:1064)\n      at org.apache.hadoop.mapreduce.jobhistory.EventReader.<init>(EventReader.java:71)\n      at org.apache.hadoop.mapreduce.jobhistory.JobHistoryParser.parse(JobHistoryParser.java:139)\n      - locked <0x00000005a05fd4e8> (a org.apache.hadoop.mapreduce.jobhistory.JobHistoryParser)\n      at org.apache.hadoop.mapreduce.v2.hs.CompletedJob.loadFullHistoryData(CompletedJob.java:339)\n      - locked <0x0000000577bd9b98> (a org.apache.hadoop.mapreduce.v2.hs.CompletedJob)\n      at org.apache.hadoop.mapreduce.v2.hs.CompletedJob.<init>(CompletedJob.java:101)\n      at org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager$HistoryFileInfo.loadJob(HistoryFileManager.java:451)\n      - locked <0x000000056106dd80> (a org.apache.hadoop.mapreduce.v2.hs.HistoryFileManager$HistoryFileInfo)\n[...]\n{noformat}\n\nSo I don't think any of the above three proposals will fix the issue completely.  The core issue is the scan being held up for an arbitrarily long jhist parse.  I suspect things will get a _lot_ better if we can decouple these two processes.  I haven't gone through all the race conditions, but I'm wondering if we can simply make the state field volatile and allow the didMoveFail and isMovePending methods to avoid grabbing the lock.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-04-26T14:42:07.604+0000","updated":"2016-04-26T14:42:07.604+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15259429","id":"15259429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jlowe] - thanks for the suggestion, looks like that should do the trick and is definitely a lot simpler and less risky than the options proposed earlier. \n\n[~revans2] - thanks for pointing out the load on NN, we hadn't considered that either. \n\nUnrelated, the code surrounding moving the files is pretty complex. Do you think there is any value in cleaning it up at all? The code seems to work fine. And, if we are going to make any changes, I guess we would probably just want to use ATS v2 when that is ready. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-27T02:38:18.273+0000","updated":"2016-04-27T02:38:18.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15260092","id":"15260092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Yes, the move logic is not ideal, and it would be nice if it were cleaner.  Because it is complex with lots of race conditions to work through I worry we can introduce new subtle bugs when it's rewritten.  If ATSv2 is going to completely replace the JHS in a reasonable timeframe then I'm thinking it's probably not worth the rewrite.  However if the JHS is going to live for quite a while longer then it could be a worthwhile effort if done carefully.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-04-27T13:04:06.981+0000","updated":"2016-04-27T13:04:06.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15260149","id":"15260149","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"I agree with Jason.  The code is complex and there are a lot of races in there.  Making the code simpler and still solving the problem would be great.  But I think a lot of the races are inherent in the problem, some users are trying to read data and get a consistent view of it while at the same time the data is moving from one place to another.  In many cases making something have less lock contention inherently makes the code more complex.  Although I am happy to be proven wrong so if you have some specific suggestions on what and how to clean it up that would be helpful in understanding if it is worth the risk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2016-04-27T13:35:16.350+0000","updated":"2016-04-27T13:35:16.350+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15260817","id":"15260817","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. If ATSv2 is going to completely replace the JHS\nWhile the need for writing out and copying/parsing jhist files might be replaced by accesses to ATS, I would think the JHS itself would stick around to provide MR-specific UI it does today. Not sure if ATS would be able to expose the right abstractions for each framework to plugin the appropriate UI. \n\nbq. Because it is complex with lots of race conditions to work through I worry we can introduce new subtle bugs when it's rewritten.\nbq. But I think a lot of the races are inherent in the problem, some users are trying to read data and get a consistent view of it while at the same time the data is moving from one place to another. \nAgree with you both. Given it is mostly stable barring the occasional inefficiency, we should probably just leave it alone. If we run into more issues around this, may be we could revisit cleaning it up. \n\nIn terms of potential cleanups:\n# When fetching information regarding one job, we scan the entire intermediate directory potentially triggering other moves. Instead, it would be nice if it looks only for that specific job. And, if that very file is being moved, wait for the move to complete. That way, we don't have to think about a read thread accessing files corresponding to other jobs. \n# HistoryFileManager is rather long - moving out some of the inner classes might make for cleaner abstractions and more explicit locking where needed for readability. \n# I keep thinking about doing the move in a separate class/thread and some way for the read threads to communicate with this move thread, but that might just result in more complicated code. I will have to poke around to figure out which way is simpler; don't think I can get it to anytime soon though. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-27T19:51:27.650+0000","updated":"2016-04-27T19:51:27.650+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15267466","id":"15267466","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks a lot for you all's comments. Uploading a patch according to the solution suggested by Jason. Will come to this discussion if future improvement of HistoryFileManager is necessarily needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-02T20:41:31.729+0000","updated":"2016-05-02T20:41:31.729+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15267823","id":"15267823","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (/) *{color:green}+1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 10s {color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 1 new or modified test files. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 7m 1s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 17s {color} | {color:green} trunk passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 17s {color} | {color:green} trunk passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 14s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 0m 23s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 12s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 0m 33s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 14s {color} | {color:green} trunk passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 15s {color} | {color:green} trunk passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 0m 18s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 15s {color} | {color:green} the patch passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 0m 15s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 16s {color} | {color:green} the patch passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 0m 16s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 11s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 0m 21s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 11s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 0m 41s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 10s {color} | {color:green} the patch passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 12s {color} | {color:green} the patch passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 5m 52s {color} | {color:green} hadoop-mapreduce-client-hs in the patch passed with JDK v1.8.0_91. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 9s {color} | {color:green} hadoop-mapreduce-client-hs in the patch passed with JDK v1.7.0_95. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 0m 19s {color} | {color:green} Patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 25m 28s {color} | {color:black} {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:cf2ee45 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12801818/mapreduce6684.001.patch |\n| JIRA Issue | MAPREDUCE-6684 |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux 4ccdab9d0c8d 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / 9e8411d |\n| Default Java | 1.7.0_95 |\n| Multi-JDK versions |  /usr/lib/jvm/java-8-oracle:1.8.0_91 /usr/lib/jvm/java-7-openjdk-amd64:1.7.0_95 |\n| findbugs | v3.0.0 |\n| JDK v1.7.0_95  Test Results | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/6479/testReport/ |\n| modules | C: hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs U: hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs |\n| Console output | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/6479/console |\n| Powered by | Apache Yetus 0.2.0   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-03T00:43:43.443+0000","updated":"2016-05-03T00:43:43.443+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15274292","id":"15274292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Thanks for the patch, Haibo!  Looks good to me other than one nit: createMove2DoneThreadPool is inconsistent with the rest of the code.  We should be consistent with 'moveToDone' vs. 'move2Done'.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-05-06T16:16:08.951+0000","updated":"2016-05-06T16:16:08.951+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15276619","id":"15276619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks a lot for your review, Jason!  Patch updated according to your comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-09T17:00:56.542+0000","updated":"2016-05-09T17:00:56.542+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15276712","id":"15276712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 17s {color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 1 new or modified test files. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 8m 39s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 21s {color} | {color:green} trunk passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 20s {color} | {color:green} trunk passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 18s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 0m 28s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 15s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 0m 40s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 17s {color} | {color:green} trunk passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 19s {color} | {color:green} trunk passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 0m 22s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 19s {color} | {color:green} the patch passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 0m 19s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 19s {color} | {color:green} the patch passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 0m 19s {color} | {color:green} the patch passed {color} |\n| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red} 0m 15s {color} | {color:red} hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs: patch generated 10 new + 16 unchanged - 0 fixed = 26 total (was 16) {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 0m 25s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 13s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 0m 52s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 15s {color} | {color:green} the patch passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 16s {color} | {color:green} the patch passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 48s {color} | {color:green} hadoop-mapreduce-client-hs in the patch passed with JDK v1.8.0_91. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 51s {color} | {color:green} hadoop-mapreduce-client-hs in the patch passed with JDK v1.7.0_95. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 0m 22s {color} | {color:green} Patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 30m 22s {color} | {color:black} {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:cf2ee45 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12803018/mapreduce6684.002.patch |\n| JIRA Issue | MAPREDUCE-6684 |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux 9a2156e55760 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / 411fb4b |\n| Default Java | 1.7.0_95 |\n| Multi-JDK versions |  /usr/lib/jvm/java-8-oracle:1.8.0_91 /usr/lib/jvm/java-7-openjdk-amd64:1.7.0_95 |\n| findbugs | v3.0.0 |\n| checkstyle | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/6486/artifact/patchprocess/diff-checkstyle-hadoop-mapreduce-project_hadoop-mapreduce-client_hadoop-mapreduce-client-hs.txt |\n| JDK v1.7.0_95  Test Results | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/6486/testReport/ |\n| modules | C: hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs U: hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs |\n| Console output | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/6486/console |\n| Powered by | Apache Yetus 0.2.0   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-09T17:52:23.782+0000","updated":"2016-05-09T17:52:23.782+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15276739","id":"15276739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Updated the patch to fix checkstyle issues. Not sure why Jenkin did not catch this in this first run.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-09T18:14:21.878+0000","updated":"2016-05-09T18:14:21.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15276900","id":"15276900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (/) *{color:green}+1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 13s {color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 1 new or modified test files. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 6m 57s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 15s {color} | {color:green} trunk passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 17s {color} | {color:green} trunk passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 13s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 0m 22s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 13s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 0m 33s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 14s {color} | {color:green} trunk passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 15s {color} | {color:green} trunk passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 0m 18s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 13s {color} | {color:green} the patch passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 0m 13s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 15s {color} | {color:green} the patch passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 0m 15s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 12s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 0m 22s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 10s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 0m 43s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 12s {color} | {color:green} the patch passed with JDK v1.8.0_91 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 13s {color} | {color:green} the patch passed with JDK v1.7.0_95 {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 5m 50s {color} | {color:green} hadoop-mapreduce-client-hs in the patch passed with JDK v1.8.0_91. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 9s {color} | {color:green} hadoop-mapreduce-client-hs in the patch passed with JDK v1.7.0_95. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 0m 19s {color} | {color:green} Patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 25m 26s {color} | {color:black} {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:cf2ee45 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12803034/mapreduce6684.003.patch |\n| JIRA Issue | MAPREDUCE-6684 |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux 0dc6564cc107 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / 411fb4b |\n| Default Java | 1.7.0_95 |\n| Multi-JDK versions |  /usr/lib/jvm/java-8-oracle:1.8.0_91 /usr/lib/jvm/java-7-openjdk-amd64:1.7.0_95 |\n| findbugs | v3.0.0 |\n| JDK v1.7.0_95  Test Results | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/6488/testReport/ |\n| modules | C: hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs U: hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs |\n| Console output | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/6488/console |\n| Powered by | Apache Yetus 0.2.0   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-09T19:54:04.884+0000","updated":"2016-05-09T19:54:04.884+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15278342","id":"15278342","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"+1 lgtm.  Committing this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-05-10T16:02:20.679+0000","updated":"2016-05-10T16:02:20.679+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15278382","id":"15278382","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Thanks, [~haibochen]!  I committed this to trunk, branch-2, and branch-2.8.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-05-10T16:17:53.952+0000","updated":"2016-05-10T16:17:53.952+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12960488/comment/15278439","id":"15278439","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-trunk-Commit #9739 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/9739/])\nMAPREDUCE-6684. High contention on scanning of user directory under (jlowe: rev 5ffb54694b52657f3b7de4560474ab740734e1b2)\n* hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs/src/test/java/org/apache/hadoop/mapreduce/v2/hs/TestUnnecessaryBlockingOnHistoryFileInfo.java\n* hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-hs/src/main/java/org/apache/hadoop/mapreduce/v2/hs/HistoryFileManager.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-10T16:51:54.693+0000","updated":"2016-05-10T16:51:54.693+0000"}],"maxResults":21,"total":21,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6684/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2wel3:"}}