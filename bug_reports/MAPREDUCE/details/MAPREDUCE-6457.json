{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12857278","self":"https://issues.apache.org/jira/rest/api/2/issue/12857278","key":"MAPREDUCE-6457","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-08-19T17:37:58.189+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 19 19:04:46 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6457/watchers","watchCount":1,"isWatching":false},"created":"2015-08-19T17:20:56.886+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":86400,"aggregatetimeoriginalestimate":86400,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327180","id":"12327180","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12331978","id":"12331978","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-08-19T19:04:46.405+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315625","id":"12315625","name":"applicationmaster"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12314301","id":"12314301","name":"mrv2","description":"MR-279: Map Reduce Next."}],"timeoriginalestimate":86400,"description":"I happned to find this bug. When I am doing some development based on Hadoop-2.6.0.  I happend to send to T_KILL signal to one of maptask before this task is register to TaskAttemptListener. Because the attempt is not assigned with a container yet. It may lead to a lot of errors.","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327180","id":"12327180","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12327586","id":"12327586","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":86400,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"kill task before the task is truely runing on a slave node","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cxcw","name":"cxcw","key":"cxcw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Chen","active":true,"timeZone":"America/Denver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cxcw","name":"cxcw","key":"cxcw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Chen","active":true,"timeZone":"America/Denver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":86400,"percent":0},"customfield_12311024":null,"environment":"regular environment","customfield_12313520":null,"customfield_12311020":null,"duedate":"2015-08-19","customfield_12310250":null,"progress":{"progress":0,"total":86400,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12857278/comment/14703430","id":"14703430","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"Could you share more details on the kinds of errors you saw. If were working on MR internals, may be a test case to demonstrate the issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-08-19T17:37:58.189+0000","updated":"2015-08-19T17:37:58.189+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12857278/comment/14703579","id":"14703579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cxcw","name":"cxcw","key":"cxcw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Chen","active":true,"timeZone":"America/Denver"},"body":"2015-08-19 11:52:27,982 INFO [AsyncDispatcher event handler]\norg.apache.hadoop.mapreduce.v2.app.job.impl.TaskImpl: receive kill\ncommandtask_1440006609204_0002_m_000002\n2015-08-19 11:52:27,982 INFO [AsyncDispatcher event handler]\norg.apache.hadoop.mapreduce.v2.app.job.impl.TaskImpl:2 Task Transitioned\nfrom SCHEDULED to KILL_WAIT\n2015-08-19 11:52:27,982 INFO [ContainerLauncher #2]\norg.apache.hadoop.mapreduce.v2.app.launcher.ContainerLauncherImpl:\nProcessing the event EventType: CONTAINER_REMOTE_LAUNCH for container\ncontainer_1440006609204_0002_01_000003 taskAttempt\nattempt_1440006609204_0002_m_000001_0\n2015-08-19 11:52:27,982 INFO [ContainerLauncher #2]\norg.apache.hadoop.mapreduce.v2.app.launcher.ContainerLauncherImpl:\nLaunching attempt_1440006609204_0002_m_000001_0\n2015-08-19 11:52:27,982 INFO [ContainerLauncher #2]\norg.apache.hadoop.yarn.client.api.impl.ContainerManagementProtocolProxy:\nOpening proxy : jassion-OptiPlex-780:33640\n2015-08-19 11:52:27,983 INFO [ContainerLauncher #2]\norg.apache.hadoop.mapreduce.v2.app.launcher.ContainerLauncherImpl: launch\nremote task\nonjassion-OptiPlex-780:33640fromattempt_1440006609204_0002_m_000001_0\n2015-08-19 11:52:28,277 INFO [RMCommunicator Allocator]\norg.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: one time for\nrequest containers\n2015-08-19 11:52:28,278 INFO [RMCommunicator Allocator]\norg.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: container\non*priority:20number of containers0\n2015-08-19 11:52:28,278 INFO [RMCommunicator Allocator]\norg.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: container\non/default-rackpriority:20number of containers0\n2015-08-19 11:52:28,278 INFO [RMCommunicator Allocator]\norg.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: container\nonjassion-OptiPlex-780priority:20number of containers0\n2015-08-19 11:52:28,278 INFO [RMCommunicator Allocator]\norg.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: getResources()\nfor application_1440006609204_0002: ask=3 release= 0 newContainers=0\nfinishedContainers=0 resourcelimit=<memory:4096, vCores:-2> knownNMs=1\n2015-08-19 11:52:28,312 INFO [ContainerLauncher #2]\norg.apache.hadoop.mapreduce.v2.app.launcher.ContainerLauncherImpl: Shuffle\nport returned by ContainerManager for attempt_1440006609204_0002_m_000001_0\n: 13562\n2015-08-19 11:52:28,358 FATAL [AsyncDispatcher event handler]\norg.apache.hadoop.yarn.event.AsyncDispatcher: Error in dispatcher thread\njava.lang.NullPointerException\n        at\njava.util.concurrent.ConcurrentHashMap.hash(ConcurrentHashMap.java:333)\n        at\njava.util.concurrent.ConcurrentHashMap.containsKey(ConcurrentHashMap.java:1016)\n        at java.util.Collections$SetFromMap.contains(Collections.java:3901)\n        at\norg.apache.hadoop.mapred.TaskAttemptListenerImpl.unregister(TaskAttemptListenerImpl.java:500)\n        at\norg.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl$CleanupContainerTransition.transition(TaskAttemptImpl.java:1966)\n        at\norg.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl$CleanupContainerTransition.transition(TaskAttemptImpl.java:1958)\n        at\norg.apache.hadoop.yarn.state.StateMachineFactory$SingleInternalArc.doTransition(StateMachineFactory.java:362)\n        at\norg.apache.hadoop.yarn.state.StateMachineFactory.doTransition(StateMachineFactory.java:302)\n        at\norg.apache.hadoop.yarn.state.StateMachineFactory.access$300(StateMachineFactory.java:46)\n        at\norg.apache.hadoop.yarn.state.StateMachineFactory$InternalStateMachine.doTransition(StateMachineFactory.java:448)\n        at\norg.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl.handle(TaskAttemptImpl.java:1073)\n        at\norg.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl.handle(TaskAttemptImpl.java:148)\n        at\norg.apache.hadoop.mapreduce.v2.app.MRAppMaster$TaskAttemptEventDispatcher.handle(MRAppMaster.java:1311)\n        at\norg.apache.hadoop.mapreduce.v2.app.MRAppMaster$TaskAttemptEventDispatcher.handle(MRAppMaster.java:1303)\n        at\norg.apache.hadoop.yarn.event.AsyncDispatcher.dispatch(AsyncDispatcher.java:173)\n        at\norg.apache.hadoop.yarn.event.AsyncDispatcher$1.run(AsyncDispatcher.java:106)\n        at java.lang.Thread.run(Thread.java:745)\n2015-08-19 11:52:28,853 INFO [AsyncDispatcher event handler]\norg.apache.hadoop.yarn.event.AsyncDispatcher: Exiting, bbye..\n\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\nThese are the log files I got.  I just try to kill one task\ntask_1440006609204_0002_m_000002,  this task is just during  SCHED phase\nnot RUN yet.  After it's killed, then come to the exception.\n\nThe problem maybe due to the task is trying unregister from\nTaskAttemptListenerImpl while it's not register witl\nTaskAttemptListenerImpl yet.\n\n\n\nOn Wed, Aug 19, 2015 at 11:38 AM, Karthik Kambatla (JIRA) <jira@apache.org>\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cxcw","name":"cxcw","key":"cxcw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Chen","active":true,"timeZone":"America/Denver"},"created":"2015-08-19T19:04:40.600+0000","updated":"2015-08-19T19:04:40.600+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12857278/comment/14703580","id":"14703580","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cxcw","name":"cxcw","key":"cxcw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Chen","active":true,"timeZone":"America/Denver"},"body":"2015-08-19 11:52:27,982 INFO [AsyncDispatcher event handler] org.apache.hadoop.mapreduce.v2.app.job.impl.TaskImpl: receive kill commandtask_1440006609204_0002_m_000002\n2015-08-19 11:52:27,982 INFO [AsyncDispatcher event handler] org.apache.hadoop.mapreduce.v2.app.job.impl.TaskImpl:2 Task Transitioned from SCHEDULED to KILL_WAIT\n2015-08-19 11:52:27,982 INFO [ContainerLauncher #2] org.apache.hadoop.mapreduce.v2.app.launcher.ContainerLauncherImpl: Processing the event EventType: CONTAINER_REMOTE_LAUNCH for container container_1440006609204_0002_01_000003 taskAttempt attempt_1440006609204_0002_m_000001_0\n2015-08-19 11:52:27,982 INFO [ContainerLauncher #2] org.apache.hadoop.mapreduce.v2.app.launcher.ContainerLauncherImpl: Launching attempt_1440006609204_0002_m_000001_0\n2015-08-19 11:52:27,982 INFO [ContainerLauncher #2] org.apache.hadoop.yarn.client.api.impl.ContainerManagementProtocolProxy: Opening proxy : jassion-OptiPlex-780:33640\n2015-08-19 11:52:27,983 INFO [ContainerLauncher #2] org.apache.hadoop.mapreduce.v2.app.launcher.ContainerLauncherImpl: launch remote task onjassion-OptiPlex-780:33640fromattempt_1440006609204_0002_m_000001_0\n2015-08-19 11:52:28,277 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: one time for request containers\n2015-08-19 11:52:28,278 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: container on*priority:20number of containers0\n2015-08-19 11:52:28,278 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: container on/default-rackpriority:20number of containers0\n2015-08-19 11:52:28,278 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: container onjassion-OptiPlex-780priority:20number of containers0\n2015-08-19 11:52:28,278 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerRequestor: getResources() for application_1440006609204_0002: ask=3 release= 0 newContainers=0 finishedContainers=0 resourcelimit=<memory:4096, vCores:-2> knownNMs=1\n2015-08-19 11:52:28,312 INFO [ContainerLauncher #2] org.apache.hadoop.mapreduce.v2.app.launcher.ContainerLauncherImpl: Shuffle port returned by ContainerManager for attempt_1440006609204_0002_m_000001_0 : 13562\n2015-08-19 11:52:28,358 FATAL [AsyncDispatcher event handler] org.apache.hadoop.yarn.event.AsyncDispatcher: Error in dispatcher thread\njava.lang.NullPointerException\n        at java.util.concurrent.ConcurrentHashMap.hash(ConcurrentHashMap.java:333)\n        at java.util.concurrent.ConcurrentHashMap.containsKey(ConcurrentHashMap.java:1016)\n        at java.util.Collections$SetFromMap.contains(Collections.java:3901)\n        at org.apache.hadoop.mapred.TaskAttemptListenerImpl.unregister(TaskAttemptListenerImpl.java:500)\n        at org.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl$CleanupContainerTransition.transition(TaskAttemptImpl.java:1966)\n        at org.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl$CleanupContainerTransition.transition(TaskAttemptImpl.java:1958)\n        at org.apache.hadoop.yarn.state.StateMachineFactory$SingleInternalArc.doTransition(StateMachineFactory.java:362)\n        at org.apache.hadoop.yarn.state.StateMachineFactory.doTransition(StateMachineFactory.java:302)\n        at org.apache.hadoop.yarn.state.StateMachineFactory.access$300(StateMachineFactory.java:46)\n        at org.apache.hadoop.yarn.state.StateMachineFactory$InternalStateMachine.doTransition(StateMachineFactory.java:448)\n        at org.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl.handle(TaskAttemptImpl.java:1073)\n        at org.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl.handle(TaskAttemptImpl.java:148)\n        at org.apache.hadoop.mapreduce.v2.app.MRAppMaster$TaskAttemptEventDispatcher.handle(MRAppMaster.java:1311)\n        at org.apache.hadoop.mapreduce.v2.app.MRAppMaster$TaskAttemptEventDispatcher.handle(MRAppMaster.java:1303)\n        at org.apache.hadoop.yarn.event.AsyncDispatcher.dispatch(AsyncDispatcher.java:173)\n        at org.apache.hadoop.yarn.event.AsyncDispatcher$1.run(AsyncDispatcher.java:106)\n        at java.lang.Thread.run(Thread.java:745)\n2015-08-19 11:52:28,853 INFO [AsyncDispatcher event handler] org.apache.hadoop.yarn.event.AsyncDispatcher: Exiting, bbye..\n\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\nThese are the log files I got.  I just try to kill one task  task_1440006609204_0002_m_000002,  this task is just during  SCHED phase not RUN yet.  After it's killed, then come to the exception.\n\nThe problem maybe due to the task is trying unregister from TaskAttemptListenerImpl while it's not register witl TaskAttemptListenerImpl yet.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cxcw","name":"cxcw","key":"cxcw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Chen","active":true,"timeZone":"America/Denver"},"created":"2015-08-19T19:04:46.405+0000","updated":"2015-08-19T19:04:46.405+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6457/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2j453:"}}