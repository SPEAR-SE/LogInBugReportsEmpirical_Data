{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12530535","self":"https://issues.apache.org/jira/rest/api/2/issue/12530535","key":"MAPREDUCE-3362","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2011-12-06T12:07:49.429+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Dec 13 08:24:24 UTC 2011","customfield_12310420":"216273","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-3362/watchers","watchCount":4,"isWatching":false},"created":"2011-11-07T06:59:28.130+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["jobtracker"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314205","id":"12314205","description":"","name":"0.20.2","archived":false,"released":true,"releaseDate":"2010-02-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-10T21:27:08.457+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315343","id":"12315343","name":"jobhistoryserver"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312907","id":"12312907","name":"jobtracker"}],"timeoriginalestimate":null,"description":"Our jobs are always keeping at 'pending' status several days. We checked jobtracker log and found that one task(attemp) failed due to failure to store job history to HDFS. \n\nThe issue begins from the business that another job remove the folder that this job is being written with history log. In this case, there has 'ConcurrentModificationException' at JobHistory#log(ArrayList<PrintWriter> writers, RecordTypes recordType, Keys[] keys, String[] values, JobID id). One thread checked if there has any output error and removed output with history folder at HDFS has been removed, another thread got 'ConcurrentModificationException' at current 'writers' is blank.\n\nUnfortunately, no one want to catch this exception and it go thought to TaskTracker(it jump over the calculating part to add 'finishedMapTask'). Then, another task(attemp) runs from 'failedMap' successfully, but the total 'finishedMapTask' number is not the all finishedMapTask. JobCleanupTask cannot startup and job always stay at 'pending' status.\n\nThe root cause:\nFirst task(attemp) failed with exception and this task add to 'failedMap' with decrease the 'finishedMap' counter. Next task(attemp) runs successfully and increase one for 'finishedMap'. Due to failure the total 'finishedMap' is less that actual finishedMap counter, so the cleanup task cannot runs. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314205","id":"12314205","description":"","name":"0.20.2","archived":false,"released":true,"releaseDate":"2010-02-16"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"80837","customfield_12312823":null,"summary":"Job always stay at 'Pending' status and cannot finish several days","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennyy","name":"dennyy","key":"dennyy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denny Ye","active":true,"timeZone":"Asia/Harbin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennyy","name":"dennyy","key":"dennyy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denny Ye","active":true,"timeZone":"Asia/Harbin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530535/comment/13163548","id":"13163548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Denny,\n\nBy any chance are you falling into this scenario:\nhttps://issues.apache.org/jira/browse/MAPREDUCE-2129?focusedCommentId=13081564&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13081564","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"created":"2011-12-06T12:07:49.429+0000","updated":"2011-12-06T12:07:49.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530535/comment/13168220","id":"13168220","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mac.hadoop%40gmail.com","name":"mac.hadoop@gmail.com","key":"mac.hadoop@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mac Fang","active":true,"timeZone":"Etc/UTC"},"body":"I think the 2 scenarios are different. \n\nThe scenario in this issue is the Map/Reduce tasks in this job are done, but the job still stay pending. The root cause is the ConcurrentModificationException, if the exception happen, the counter is wrong.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mac.hadoop%40gmail.com","name":"mac.hadoop@gmail.com","key":"mac.hadoop@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mac Fang","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-13T08:24:24.245+0000","updated":"2011-12-13T08:24:24.245+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-3362/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0e6mv:"}}