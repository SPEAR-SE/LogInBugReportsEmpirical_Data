{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12909104","self":"https://issues.apache.org/jira/rest/api/2/issue/12909104","key":"MAPREDUCE-6530","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-10-30T06:22:13.404+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 27 11:10:52 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6530/watchers","watchCount":3,"isWatching":false},"created":"2015-10-30T03:48:27.624+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324149","id":"12324149","description":"maintenance release on branch-1.2","name":"1.2.1","archived":false,"released":true,"releaseDate":"2013-08-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-11-27T11:16:33.778+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"JobTracker is slow when there are huge number of Jobs running and 30\nconnections were established to info port to view Job status and counters.\n\nhadoop job -list took 4m22.412s\n\nWe took Jstack traces and found most of the server threads waiting on JobTracker object and the thread which has the lock on JobTracker waits for ResourceBundle object.\n\n        \"retireJobs\" prio=10 tid=0x00007f2345200800 nid=0x11c1 waiting for\nmonitor entry [0x00007f22e3499000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n        at\norg.apache.hadoop.mapreduce.util.ResourceBundles.getValue(ResourceBundles.java:56)\n        - waiting to lock <0x0000000197cc6218> (a java.lang.Class for\norg.apache.hadoop.mapreduce.util.ResourceBundles)\n        at\norg.apache.hadoop.mapreduce.util.ResourceBundles.getCounterName(ResourceBundles.java:89)\n        at\norg.apache.hadoop.mapreduce.counters.FrameworkCounterGroup.localizeCounterName(FrameworkCounterGroup.java:135)\n        at\norg.apache.hadoop.mapreduce.counters.FrameworkCounterGroup.access$000(FrameworkCounterGroup.java:47)\n        at\norg.apache.hadoop.mapreduce.counters.FrameworkCounterGroup$FrameworkCounter.getDisplayName(FrameworkCounterGroup.java:75)\n        at\norg.apache.hadoop.mapred.Counters$Counter.getDisplayName(Counters.java:130)\n        at org.apache.hadoop.mapred.Counters.incrAllCounters(Counters.java:534)\n        - locked <0x00000007f8411608> (a org.apache.hadoop.mapred.Counters)\n        at\norg.apache.hadoop.mapred.JobInProgress.incrementTaskCounters(JobInProgress.java:1728)\n        at\norg.apache.hadoop.mapred.JobInProgress.getMapCounters(JobInProgress.java:1669)\n        at\norg.apache.hadoop.mapred.JobTracker$RetireJobs.addToCache(JobTracker.java:657)\n        - locked <0x000000009644ae08> (a\norg.apache.hadoop.mapred.JobTracker$RetireJobs)\n        at\norg.apache.hadoop.mapred.JobTracker$RetireJobs.run(JobTracker.java:769)\n        - locked <0x00000000964c5550> (a\norg.apache.hadoop.mapred.FairScheduler)\n        - locked <0x000000009644a9d0> (a java.util.Collections$SynchronizedMap)\n        - locked <0x00000000962ac660> (a org.apache.hadoop.mapred.JobTracker)\n        at java.lang.Thread.run(Thread.java:745)\n\n\nThe ResourceBundle object is locked most of the time by JT GUI jobtracker_jsp and does getMapCounters().\n\n\n\"926410165@qtp-1732070199-56\" daemon prio=10 tid=0x00007f232c4df000 nid=0x27c0\nrunnable [0x00007f22db7bf000]\n   java.lang.Thread.State: RUNNABLE\n        at java.lang.Throwable.fillInStackTrace(Native Method)\n        at java.lang.Throwable.fillInStackTrace(Throwable.java:783)\n        - locked <0x000000061a49ede0> (a java.util.MissingResourceException)\n        at java.lang.Throwable.<init>(Throwable.java:287)\n        at java.lang.Exception.<init>(Exception.java:84)\n        at java.lang.RuntimeException.<init>(RuntimeException.java:80)\n        at\njava.util.MissingResourceException.<init>(MissingResourceException.java:85)\n        at\njava.util.ResourceBundle.throwMissingResourceException(ResourceBundle.java:1499)\n        at java.util.ResourceBundle.getBundleImpl(ResourceBundle.java:1322)\n        at java.util.ResourceBundle.getBundle(ResourceBundle.java:1028)\n        at\norg.apache.hadoop.mapreduce.util.ResourceBundles.getBundle(ResourceBundles.java:37)\n        at\norg.apache.hadoop.mapreduce.util.ResourceBundles.getValue(ResourceBundles.java:56)\n        - locked <0x0000000197cc6218> (a java.lang.Class for\norg.apache.hadoop.mapreduce.util.ResourceBundles)\n        at\norg.apache.hadoop.mapreduce.util.ResourceBundles.getCounterName(ResourceBundles.java:89)\n        at\norg.apache.hadoop.mapreduce.counters.FrameworkCounterGroup.localizeCounterName(FrameworkCounterGroup.java:135)\n        at\norg.apache.hadoop.mapreduce.counters.FrameworkCounterGroup.access$000(FrameworkCounterGroup.java:47)\n        at\norg.apache.hadoop.mapreduce.counters.FrameworkCounterGroup$FrameworkCounter.getDisplayName(FrameworkCounterGroup.java:75)\n        at\norg.apache.hadoop.mapred.Counters$Counter.getDisplayName(Counters.java:130)\n        at org.apache.hadoop.mapred.Counters.incrAllCounters(Counters.java:534)\n        - locked <0x00000007ed1024b8> (a org.apache.hadoop.mapred.Counters)\n        at\norg.apache.hadoop.mapred.JobInProgress.incrementTaskCounters(JobInProgress.java:1728)\n        at\norg.apache.hadoop.mapred.JobInProgress.getMapCounters(JobInProgress.java:1669)\n        at org.apache.hadoop.mapred.JSPUtil.generateJobTable(JSPUtil.java:436)\n        at\norg.apache.hadoop.mapred.jobtracker_jsp._jspService(jobtracker_jsp.java:202)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:98)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:820)\n\n\nEvery job updates their counters and all 30 UI clients reading the frequently updated counters leading to JT slowness.\n\nWith no JT UI requests, hadoop job -list completes in seconds.\n\nHow to fix JT slowness when there are 30 sessions wants to know the Job status and counters of huge number of Jobs running at a time.\n\nIs there any workaround like JT UI caching or offloading some part in JT UI frontpage when load is heavy.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Jobtracker is slow when more JT UI requests","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909104/comment/14981978","id":"14981978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"This must be a 1.x.y release, since it is MR1. Please note that there might not be another release in the 1.x line. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-30T06:22:13.404+0000","updated":"2015-10-30T06:22:13.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909104/comment/14982031","id":"14982031","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"body":"[~kasha] It is MR1 Hadoop 2.5.1. I entered Wrong version.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-30T07:18:09.678+0000","updated":"2015-10-30T07:18:09.678+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909104/comment/14990324","id":"14990324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"Hadoop 2.0 have only MR2 running on Yarn. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-04T20:20:04.274+0000","updated":"2015-11-04T20:20:04.274+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909104/comment/15029769","id":"15029769","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"body":"JSPUtil is the one takes lot of time holding ResourceBundles lock by calling getMapCounters  and getReduceCounters.\n\nAssume we have 150 Jobs Running at a time with 7000 total tasks. Each Task has two counter groups FileSystemCounter and TaskCounter and total 14 counters under them.\n\nFor Each refresh on JT UI page, the JSPUtil#generateJobtable() is called, which for each 150 jobs, calls JobInProgress#getMapCounters(), which for each tasks of that Job, calls\nCounters#incrAllCounters(), which does INCREMENT for two groups and total 14 counters\n\nBut Finally JT UI displays only PHYSICAL_MEMORY_BYTES and CPU_MILLISECONDS out of 14 counters on the front page.\n\nThe getMapCounters method is the one causing too much slowness because of waiting for the lock on ResourceBundles. So We need to refactor the code in such a way, \nIt does Increment only for those two counters instead of all the counters.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-27T11:10:52.194+0000","updated":"2015-11-27T11:10:52.194+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6530/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2nq47:"}}