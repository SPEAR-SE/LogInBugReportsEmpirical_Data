{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12993427","self":"https://issues.apache.org/jira/rest/api/2/issue/12993427","key":"MAPREDUCE-6745","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-07-29T02:23:52.716+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 01 11:51:25 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6745/watchers","watchCount":9,"isWatching":false},"created":"2016-07-29T02:13:56.300+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332954","id":"12332954","description":"2.7.2 release","name":"2.7.2","archived":false,"released":true,"releaseDate":"2016-01-25"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-09-01T11:51:25.440+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315342","id":"12315342","name":"mr-am"}],"timeoriginalestimate":null,"description":"If MapReduce client set mapreduce.task.files.preserve.failedtasks=true, temporary job directory will not be deleted in staging directory /tmp/hadoop-yarn/staging.\nAs time goes by, the job files are more and more, eventually lead to below exeception:\n\norg.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdfs.protocol.FSLimitException$MaxDirectoryItemExceededException):\nThe directory item limit of /tmp/hadoop-yarn/staging/username/.staging is exceeded: limit=1048576 items=1048576\n\t\tat org.apache.hadoop.hdfs.server.namenode.FSDirectory.verifyMaxDirItems(FSDirectory.java:936)\n\t\tat org.apache.hadoop.hdfs.server.namenode.FSDirectory.addLastINode(FSDirectory.java:981)\n\t\tat org.apache.hadoop.hdfs.server.namenode.FSDirMkdirOp.unprotectedMkdir(FSDirMkdirOp.java:237)\n\t\tat org.apache.hadoop.hdfs.server.namenode.FSDirMkdirOp.createSingleDirectory(FSDirMkdirOp.java:191)\n\t\tat org.apache.hadoop.hdfs.server.namenode.FSDirMkdirOp.createChildrenDirectories(FSDirMkdirOp.java:166)\n\t\tat org.apache.hadoop.hdfs.server.namenode.FSDirMkdirOp.mkdirs(FSDirMkdirOp.java:97)\n\t\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.mkdirs(FSNamesystem.java:3788)\n\t\tat org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.mkdirs(NameNodeRpcServer.java:986)\n\t\tat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.mkdirs(ClientNamenodeProtocolServerSideTranslatorPB.java:624)\n\t\tat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolProtos.$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java:624)\n\t\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:616)\n\t\tat org.apache.hadoop.ipc.RPC$Server.call(RPC.java:973)\n\t\tat org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2088)\n\t\tat org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2084)\n\t\tat java.security.auth.Subject.doAs(Subject.java:422)\n\t\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1672)\n\t\tat org.apache.hadoop.ipc.Server$Handler.run(Server.java:2082)\n\t\t\n\t\t\nThe official instructions for the configuration mapreduce.task.files.preserve.failedtasks is below:\n    Should the files for failed tasks be kept. This should only be used on jobs that are failing, because the storage is never reclaimed. \n    It also prevents the map outputs from being erased from the reduce directory as they are consumed.\n\t\nAccording to the instructions, I think the temporary files for successful tasks shouldn't be kept.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Job directories should be clean in staging directorg /tmp/hadoop-yarn/staging after MapReduce job finish successfully","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaoping","name":"xiaoping","key":"xiaoping","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liuxiaoping","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaoping","name":"xiaoping","key":"xiaoping","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liuxiaoping","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Suse 11 sp3","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12993427/comment/15398603","id":"15398603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mujunchao","name":"mujunchao","key":"mujunchao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mujunchao","active":true,"timeZone":"Etc/UTC"},"body":"Nice Catch!\nAs \"/tmp/hadoop-yarn/staging/username/.staging\" is exceeded, all JOB failed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mujunchao","name":"mujunchao","key":"mujunchao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mujunchao","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-29T02:23:52.716+0000","updated":"2016-07-29T02:23:52.716+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12993427/comment/15405191","id":"15405191","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajisakaa","name":"ajisakaa","key":"ajisakaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ajisakaa&avatarId=17238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ajisakaa&avatarId=17238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ajisakaa&avatarId=17238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ajisakaa&avatarId=17238"},"displayName":"Akira Ajisaka","active":true,"timeZone":"Asia/Tokyo"},"body":"Probably MAPREDUCE-6607 is related. As I commented [there|https://issues.apache.org/jira/browse/MAPREDUCE-6607?focusedCommentId=15140967&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15140967], if the parameter is set, the files for failed tasks are kept. However, the files in .staging can be used for all tasks, so it's difficult to search what is the files in .staging of the failed tasks. That's why if the parameter is set, all the files in .staging are preserved for now.\nTherefore you need to set the parameter to true only for the failing jobs to avoid the issue. I'm thinking this is what the document want to say.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajisakaa","name":"ajisakaa","key":"ajisakaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ajisakaa&avatarId=17238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ajisakaa&avatarId=17238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ajisakaa&avatarId=17238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ajisakaa&avatarId=17238"},"displayName":"Akira Ajisaka","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-08-03T02:26:00.731+0000","updated":"2016-08-03T02:26:00.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12993427/comment/15405195","id":"15405195","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajisakaa","name":"ajisakaa","key":"ajisakaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ajisakaa&avatarId=17238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ajisakaa&avatarId=17238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ajisakaa&avatarId=17238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ajisakaa&avatarId=17238"},"displayName":"Akira Ajisaka","active":true,"timeZone":"Asia/Tokyo"},"body":"However, the document is confusing for me. I'd like to add a parameter \"mapreduce.tasks.files.preserve.failedjobs\" for keep the .staging dir only for the failing jobs. What do you think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajisakaa","name":"ajisakaa","key":"ajisakaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ajisakaa&avatarId=17238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ajisakaa&avatarId=17238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ajisakaa&avatarId=17238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ajisakaa&avatarId=17238"},"displayName":"Akira Ajisaka","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-08-03T02:30:07.212+0000","updated":"2016-08-03T02:30:07.212+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12993427/comment/15405252","id":"15405252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mujunchao","name":"mujunchao","key":"mujunchao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mujunchao","active":true,"timeZone":"Etc/UTC"},"body":"We will move the .staging dir away while Job finished or failed. As the Job is not alive, i think no need to keep the .staging dir at that time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mujunchao","name":"mujunchao","key":"mujunchao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mujunchao","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-03T03:40:34.953+0000","updated":"2016-08-03T03:40:34.953+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12993427/comment/15455156","id":"15455156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaoping","name":"xiaoping","key":"xiaoping","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liuxiaoping","active":true,"timeZone":"Etc/UTC"},"body":"When task failure but job is successful, that .staging dir shouldn't be keept. I think that is good idea to add a parameter \"mapreduce.tasks.files.preserve.failedjobs\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaoping","name":"xiaoping","key":"xiaoping","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liuxiaoping","active":true,"timeZone":"Etc/UTC"},"created":"2016-09-01T11:51:25.367+0000","updated":"2016-09-01T11:51:25.367+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6745/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i31nnb:"}}