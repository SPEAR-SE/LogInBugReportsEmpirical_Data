{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12544252","self":"https://issues.apache.org/jira/rest/api/2/issue/12544252","key":"MAPREDUCE-3926","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2012-02-27T15:35:01.678+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Feb 28 10:29:49 UTC 2012","customfield_12310420":"229489","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-3926/watchers","watchCount":1,"isWatching":false},"created":"2012-02-27T13:11:12.637+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316391","id":"12316391","description":"Merge append/sync support with security","name":"0.20.205.0","archived":false,"released":true,"releaseDate":"2011-10-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-02-28T10:29:49.912+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312907","id":"12312907","name":"jobtracker"}],"timeoriginalestimate":null,"description":"No information of unfinished map task in Job History, if all attempts of another map task fail.\n\nFor example, \n1. The first map task's first attempt m_000000_0 was making progress\n\n2. The second map task failed 4 times, before completion of first map task attempt.\n\n3. Hence, a job cleanup task was launched and completed, before completion of first map task attempt.\n\n4. After job cleanup task, runningMapCache is cleaned\n{noformat}\ncompletedTask() -> jobComplete() -> garbageCollect() ->  this.runningMapCache = null;\n           |-----> retireMap() -> if (runningMapCache == null) \"Running cache for maps missing!! Job details are missing.\"\n{noformat}\n\n5. Hence, \"Running cache for maps missing!! Job details are missing.\" error comes\n(from retireMap() which is called after jobComplete() ) and no information is\nadded further to Job History. Therefore, first map task's information is\nmissing from Job History page.\n\n\nI have created a sample streaming MR job, to reproduce this issue.\n\n{code:title=mapper.sh}\n#!/bin/bash\nread line\nif [[ \"$line\" == \"sleep\" ]]\nthen\n    for i in 1 2 3\n    do\n        echo \"Sleeping\" >&2\n        sleep 5\n    done\n    exit 0\nelse\n    echo \"Exiting\" >&2\n    exit -1\nfi\n{code}\n\nInput file: in1.txt is for long running map task (here first map task)\n{code:title=/user/mitesh/input/in1.txt}\nsleep\n{code}\n\nInput file: in2.txt is for failing map task (here second map task)\n{code:title=/user/mitesh/input/in2.txt}\nexit\n{code}\n\n\nRunning the sample streaming MR job.\n{noformat}\n$ hadoop fs -rmr -skipTrash xyz\n$ hadoop jar $HADOOP_INSTALL/hadoop-streaming.jar -Dmapred.map.max.attempts=2 -Dmapred.min.split.size=7 -Dmapred.map.tasks=2 -mapper \"mapper.sh\" -file mapper.sh -reducer NONE -input /user/mitesh/input/in1.txt -input /user/mitesh/input/in2.txt -output xyz\n{noformat}\n\nJob History web UI\n{noformat}\nHadoop Job job_201201310454_542302 on History Viewer\nUser: mitesh\nJobName: streamjob7439640883203077520.jar\nJobConf: hdfs://nn:port/user/mitesh/.staging/job_201201310454_542302/job.xml\nJob-ACLs:\n    mapreduce.job.acl-view-job: No users are allowed\n    mapreduce.job.acl-modify-job: No users are allowed\nSubmitted At: 27-Feb-2012 12:56:02\nLaunched At: 27-Feb-2012 12:56:11 (8sec)\nFinished At: 27-Feb-2012 12:56:31 (20sec)\nStatus: FAILED\nFailure Info: # of failed Map Tasks exceeded allowed limit. FailedCount: 1. LastFailedTask: task_201201310454_542302_m_000001\nAnalyse This Job\nKind\tTotal Tasks(successful+failed+killed)\tSuccessful tasks\tFailed tasks\tKilled tasks\tStart Time\tFinish Time\nSetup \t1 \t1 \t0 \t0 \t27-Feb-2012 12:56:12 \t27-Feb-2012 12:56:16 (4sec)\nMap \t2 \t0 \t2 \t0 \t27-Feb-2012 12:56:16 \t27-Feb-2012 12:56:26 (10sec)\nReduce \t0 \t0 \t0 \t0 \t\t\nCleanup \t1 \t1 \t0 \t0 \t27-Feb-2012 12:56:26 \t27-Feb-2012 12:56:31 (4sec)\n{noformat}\n\nAbove it shows, only 2 failed tasks (belong to second map task).\nOnly from JT logs, the task tracker of first map task can be found.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"112771","customfield_12312823":null,"summary":"No information of unfinished map task in Job History, if all attempts of another map task fail.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miteshsjat","name":"miteshsjat","key":"miteshsjat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mitesh Singh Jat","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miteshsjat","name":"miteshsjat","key":"miteshsjat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mitesh Singh Jat","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544252/comment/13217228","id":"13217228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"body":"Mitesh,\nI guess adding this to 0.20.205 might involve a lot of change. Also, the JT has no information about the running tasks i.e they could in fact be RUNNING, KILLED, FAILED, PENDING etc.\n\nNote that this can happen for SUCCESSFUL jobs too. The job can still complete/finish while the speculative tasks are running. In such cases, there is no information about the speculative tasks logged in the job history.\n\nThis can surely be fixed in trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-27T15:35:01.678+0000","updated":"2012-02-27T15:35:01.678+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544252/comment/13218050","id":"13218050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miteshsjat","name":"miteshsjat","key":"miteshsjat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mitesh Singh Jat","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi Amar,\n\nIn Hadoop 0.23, in the Job History file, the task tracker information of unfinished map task is stored in TASK_STARTED and MAP_ATTEMPT_STARTED.\n\nRegards,\nMitesh","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miteshsjat","name":"miteshsjat","key":"miteshsjat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mitesh Singh Jat","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-02-28T10:29:49.822+0000","updated":"2012-02-28T10:29:49.822+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-3926/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jnpj:"}}