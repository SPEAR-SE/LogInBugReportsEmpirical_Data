{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12434326","self":"https://issues.apache.org/jira/rest/api/2/issue/12434326","key":"MAPREDUCE-935","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2009-08-28T21:16:50.119+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 28 21:30:50 UTC 2009","customfield_12310420":"149152","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-935/watchers","watchCount":0,"isWatching":false},"created":"2009-08-28T21:15:43.153+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314045","id":"12314045","description":"","name":"0.21.0","archived":false,"released":true,"releaseDate":"2010-08-23"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-04-29T08:08:18.419+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312906","id":"12312906","name":"tasktracker"}],"timeoriginalestimate":null,"description":"Exponential backoff may be good for dealing with troublesome hosts, but not if you only have one host in the entire system. From the log of {{TestNodeRefresh}}, which for some reason is blocking in the reduce phase, I can see it doesn't take much for the backoff to kick in so rapidly that the reducer is waiting for longer than the test\n{code}\n2009-08-28 21:39:16,788 WARN  mapred.ReduceTask (ReduceTask.java:fetchOutputs(2192)) - attempt_20090828213826033_0001_r_000000_0 adding host localhost to penalty box, next contact in 150 seconds\n{code}\nThe result of this backoff process is that the reduce process ends up appearing to hang, getting killed from above. \n\nNote that this isn't the root cause of the problem, but it certainly amplifies things. \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"111396","customfield_12312823":null,"summary":"There's little to be gained by putting a host into the penaltybox at reduce time, if its the only host you have","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434326/comment/12748983","id":"12748983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"Thread dump of the killed process\n{code}\n2009-08-28 21:40:39,572 INFO  mapred.Task (ReflectionUtils.java:logThreadInfo(204)) - Process Thread Dump: Communication exception\n14 active threads\nThread 26 (Thread for polling Map Completion Events):\n  State: TIMED_WAITING\n  Blocked count: 25\n  Waited count: 117\n  Stack:\n    java.lang.Thread.sleep(Native Method)\n    org.apache.hadoop.ipc.Client$Connection.handleConnectionFailure(Client.java:392)\n    org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:334)\n    org.apache.hadoop.ipc.Client$Connection.access$1800(Client.java:197)\n    org.apache.hadoop.ipc.Client.getConnection(Client.java:886)\n    org.apache.hadoop.ipc.Client.call(Client.java:746)\n    org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:223)\n    org.apache.hadoop.mapred.$Proxy0.getMapCompletionEvents(Unknown Source)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$GetMapEventsThread.getMapCompletionEvents(ReduceTask.java:2725)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$GetMapEventsThread.run(ReduceTask.java:2692)\nThread 25 (Thread for merging in memory files):\n  State: WAITING\n  Blocked count: 12\n  Waited count: 13\n  Waiting on java.lang.Object@500ab58d\n  Stack:\n    java.lang.Object.wait(Native Method)\n    java.lang.Object.wait(Object.java:485)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$ShuffleRamManager.waitForDataToMerge(ReduceTask.java:1092)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$InMemFSMergeThread.run(ReduceTask.java:2590)\nThread 24 (Thread for merging on-disk files):\n  State: WAITING\n  Blocked count: 0\n  Waited count: 1\n  Waiting on java.util.TreeSet@659c2931\n  Stack:\n    java.lang.Object.wait(Native Method)\n    java.lang.Object.wait(Object.java:485)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$LocalFSMerger.run(ReduceTask.java:2493)\nThread 23 (MapOutputCopier attempt_20090828213826033_0001_r_000000_0.4):\n  State: WAITING\n  Blocked count: 267\n  Waited count: 266\n  Waiting on java.util.ArrayList@15ab7626\n  Stack:\n    java.lang.Object.wait(Native Method)\n    java.lang.Object.wait(Object.java:485)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.run(ReduceTask.java:1219)\nThread 22 (MapOutputCopier attempt_20090828213826033_0001_r_000000_0.3):\n  State: WAITING\n  Blocked count: 273\n  Waited count: 270\n  Waiting on java.util.ArrayList@15ab7626\n  Stack:\n    java.lang.Object.wait(Native Method)\n    java.lang.Object.wait(Object.java:485)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.run(ReduceTask.java:1219)\nThread 21 (MapOutputCopier attempt_20090828213826033_0001_r_000000_0.2):\n  State: WAITING\n  Blocked count: 274\n  Waited count: 275\n  Waiting on java.util.ArrayList@15ab7626\n  Stack:\n    java.lang.Object.wait(Native Method)\n    java.lang.Object.wait(Object.java:485)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.run(ReduceTask.java:1219)\nThread 20 (MapOutputCopier attempt_20090828213826033_0001_r_000000_0.1):\n  State: WAITING\n  Blocked count: 257\n  Waited count: 257\n  Waiting on java.util.ArrayList@15ab7626\n  Stack:\n    java.lang.Object.wait(Native Method)\n    java.lang.Object.wait(Object.java:485)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.run(ReduceTask.java:1219)\nThread 19 (MapOutputCopier attempt_20090828213826033_0001_r_000000_0.0):\n  State: WAITING\n  Blocked count: 77\n  Waited count: 72\n  Waiting on java.util.ArrayList@15ab7626\n  Stack:\n    java.lang.Object.wait(Native Method)\n    java.lang.Object.wait(Object.java:485)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.run(ReduceTask.java:1219)\nThread 18 (communication thread):\n  State: RUNNABLE\n  Blocked count: 16\n  Waited count: 34\n  Stack:\n    sun.management.ThreadImpl.getThreadInfo0(Native Method)\n    sun.management.ThreadImpl.getThreadInfo(ThreadImpl.java:147)\n    sun.management.ThreadImpl.getThreadInfo(ThreadImpl.java:123)\n    org.apache.hadoop.util.ReflectionUtils.printThreadInfo(ReflectionUtils.java:149)\n    org.apache.hadoop.util.ReflectionUtils.logThreadInfo(ReflectionUtils.java:203)\n    org.apache.hadoop.mapred.Task$TaskReporter.run(Task.java:532)\n    java.lang.Thread.run(Thread.java:637)\nThread 15 (Thread for syncLogs):\n  State: TIMED_WAITING\n  Blocked count: 0\n  Waited count: 24\n  Stack:\n    java.lang.Thread.sleep(Native Method)\n    org.apache.hadoop.mapred.Child$2.run(Child.java:88)\nThread 5 (Signal Dispatcher):\n  State: RUNNABLE\n  Blocked count: 0\n  Waited count: 0\n  Stack:\nThread 3 (Finalizer):\n  State: WAITING\n  Blocked count: 5\n  Waited count: 6\n  Waiting on java.lang.ref.ReferenceQueue$Lock@21e30857\n  Stack:\n    java.lang.Object.wait(Native Method)\n    java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:116)\n    java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:132)\n    java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\nThread 2 (Reference Handler):\n  State: WAITING\n  Blocked count: 7\n  Waited count: 6\n  Waiting on java.lang.ref.Reference$Lock@43cda81e\n  Stack:\n    java.lang.Object.wait(Native Method)\n    java.lang.Object.wait(Object.java:485)\n    java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)\nThread 1 (main):\n  State: TIMED_WAITING\n  Blocked count: 16\n  Waited count: 26\n  Stack:\n    java.lang.Thread.sleep(Native Method)\n    org.apache.hadoop.mapred.ReduceTask$ReduceCopier.fetchOutputs(ReduceTask.java:2027)\n    org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:374)\n    org.apache.hadoop.mapred.Child.main(Child.java:162)\n\n\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-28T21:16:50.119+0000","updated":"2009-08-28T21:16:50.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434326/comment/12748984","id":"12748984","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"Looking at the thread dump, it also looks like the exponential backoff feature in the {{Client.handleConnectFailure()}} is interfering with heartbeats. A failure to connect to the server is triggering backoff, stopping progress from being reported. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-28T21:20:12.547+0000","updated":"2009-08-28T21:20:12.547+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434326/comment/12748989","id":"12748989","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"looking closer the client backoff thread is not related to the problem, but the penalty box is possibly causing needless suffering. Though I suspect that local task tracker has stopped listening for RPC calls, which is the root cause of trouble. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-28T21:30:50.657+0000","updated":"2009-08-28T21:30:50.657+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-935/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jf7z:"}}