{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12512430","self":"https://issues.apache.org/jira/rest/api/2/issue/12512430","key":"MAPREDUCE-2635","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2011-07-01T12:25:21.182+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jul 07 13:03:06 UTC 2012","customfield_12310420":"66653","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_32165639135_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-07-07T13:03:06.165+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-2635/watchers","watchCount":3,"isWatching":false},"created":"2011-07-01T06:09:07.211+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314047","id":"12314047","description":"","name":"0.20.1","archived":false,"released":true,"releaseDate":"2009-09-01"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314205","id":"12314205","description":"","name":"0.20.2","archived":false,"released":true,"releaseDate":"2010-02-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-07T13:03:06.341+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312907","id":"12312907","name":"jobtracker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313272","id":"12313272","name":"task-controller","description":"TaskController"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312906","id":"12312906","name":"tasktracker"}],"timeoriginalestimate":null,"description":"Running the following example hangs the child job indefinitely.\n\npublic class HaltCluster\n{\n\n  public static void main(String[] args) throws IOException\n  {\n    JobConf jobConf = new JobConf();\n    prepareConf(jobConf);\n    if (args != null && args.length > 0)\n    {\n      jobConf.set(\"callonceagain\", args[0]);\n      jobConf.setMaxMapAttempts(1);\n      jobConf.setJobName(\"ParentJob\");\n\n    }\n    JobClient.runJob(jobConf);\n\n  }\n\n  public static void prepareConf(JobConf jobConf)\n  {\n    jobConf.setJarByClass(HaltCluster.class);\n    jobConf.set(\"mapred.job.tracker\", \"<<jobtracker>>\");\n    jobConf.set(\"fs.default.name\", \"<<hdfs>>\");\n    MultipleInputs.addInputPath(jobConf, new Path(\"/ignore\" + System.currentTimeMillis()), MyInputFormat.class);\n    jobConf.setJobName(\"ChildJob\");\n    jobConf.setMapperClass(MyMapper.class);\n    jobConf.setOutputFormat(NullOutputFormat.class);\n    jobConf.setNumReduceTasks(0);\n  }\n\n}\n\npublic class MyMapper implements Mapper<IntWritable, Text, NullWritable, NullWritable>\n{\n  JobConf myConf = null;\n\n  @Override\n  public void map(IntWritable arg0, Text arg1, OutputCollector<NullWritable, NullWritable> arg2, Reporter arg3) throws IOException\n  {\n    if (myConf != null && \"true\".equals(myConf.get(\"callonceagain\")))\n    {\n      startBackGroundReporting(arg3);\n      HaltCluster.main(new String[] {});\n    }\n\n    throw new RuntimeException(\"Throwing exception\");\n  }\n\n  private void startBackGroundReporting(final Reporter arg3)\n  {\n    Thread t = new Thread()\n    {\n      @Override\n      public void run()\n      {\n        while (true)\n        {\n          arg3.setStatus(\"Reporting to be alive at \" + System.currentTimeMillis());\n        }\n      }\n    };\n    t.setDaemon(true);\n    t.start();\n  }\n\n  @Override\n  public void configure(JobConf arg0)\n  {\n    myConf = arg0;\n\n  }\n\n  @Override\n  public void close() throws IOException\n  {\n    // TODO Auto-generated method stub\n\n  }\n\n}\n\nrun using the following command\n\njava -cp <<classpath>> HaltCluster true\n\nBut if only one job is triggered as java -cp <<classpath>> HaltCluster\nit fails to max number of attempts and quits as expected.\n\n\nAlso, when the jobs hang, running the child job once again, makes it come out of deadlock and completes the three jobs.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"46367","customfield_12312823":null,"summary":"Jobs hang indefinitely on failure.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sudhan65","name":"sudhan65","key":"sudhan65","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sudharsan Sampath","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sudhan65","name":"sudhan65","key":"sudhan65","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sudharsan Sampath","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Suse Linux cluster with 2 nodes. One running a jobtracker, namenode, datanode, tasktracker. Other running tasktracker, datanode.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12512430/comment/13058520","id":"13058520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"body":"Please add in your node's basic JT/TT configurations and your input format used.\n\nI tried to replicate this in my single node instance with my own inputformat added along (emptysplit like thing, with no location preference, and with a single rounded dummy record reader), but wasn't able to. Both jobs launch normally and everything fails as expected (2 tt slots).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-07-01T12:25:21.182+0000","updated":"2011-07-01T12:25:21.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12512430/comment/13058526","id":"13058526","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sudhan65","name":"sudhan65","key":"sudhan65","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sudharsan Sampath","active":true,"timeZone":"Etc/UTC"},"body":"Harsh,\n\nSorry I forgot to mention. Yes. This does not occur in a single node\ncluster. we have the max map and reduce tasks to be 20 and reuse jvm set to\ntrue.\n\nThe input format is in the code sepcified as MyINputFormat.java\n\n-Sudhan S\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sudhan65","name":"sudhan65","key":"sudhan65","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sudharsan Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2011-07-01T12:38:28.641+0000","updated":"2011-07-01T12:38:28.641+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12512430/comment/13072844","id":"13072844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj.k","name":"devaraj.k","key":"devaraj.k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj K","active":true,"timeZone":"America/Los_Angeles"},"body":"Harsh, Sudharshan,\n\n    This occurs irrespective of single/multiple nodes when the cluster capacity is less than the number of the maps of the parent job. \nIn the mapreduce application given, the parent Job is spanning child jobs for each map input and waiting for those child jobs to complete. When the parent job map waiting for the child job to complete, it is updating the status also. \n\nWhen the cluster capacity is less than the number of the maps of the parent job, all the slots in the cluster occupies by the parent job mappers and these mappers internally spans the child jobs, these child jobs will be waiting for the map slots to get free and parent jobs will be waiting for the child jobs to complete. This will never happen and waiting forever.  \nHere the problem is with the application logic, it needs to be corrected in the application itself. There is no problem with mapreduce respective to this.\n\nIf the cluster capacity is greater than the number of the maps of the parent job, tasks are failing and finally Job is failing.\n\nThis issue can be invalidated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj.k","name":"devaraj.k","key":"devaraj.k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj K","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-29T14:32:58.527+0000","updated":"2011-07-29T14:32:58.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12512430/comment/13072942","id":"13072942","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sudhan65","name":"sudhan65","key":"sudhan65","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sudharsan Sampath","active":true,"timeZone":"Etc/UTC"},"body":"Hi Devaraj,\n\nYou are right in saying the jobs will hang indefinitely due to slot\nunavailability with cyclic jobs.\n\nBut the issue here is different. The issue occurs even on clusters with\nhigher slot capacity. The set up I have spans 2 slaves with 20 map slots in\neach.\n\nAnother update is that while the jobs on the initial submit are hanging, if\nI trigger this set another time all the four jobs complete\nimmediately(actually fail as I throw an explicit exception)\n\nHence, my opinion is that we should keep this open till we get to know the\nreal reason.\n\nThanks\nSudharsan S\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sudhan65","name":"sudhan65","key":"sudhan65","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sudharsan Sampath","active":true,"timeZone":"Etc/UTC"},"created":"2011-07-29T17:45:11.049+0000","updated":"2011-07-29T17:45:11.049+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12512430/comment/13408660","id":"13408660","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"body":"I'm still unable to reproduce this. And Oozie does similar things, but never have we run into such a situation. At best, this was probably a local issue. If we run into this again someday and have logs, we can reopen it.\n\nThanks all!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-07-07T13:03:06.277+0000","updated":"2012-07-07T13:03:06.277+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-2635/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i08awv:"}}