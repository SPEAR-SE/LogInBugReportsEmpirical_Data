{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13098596","self":"https://issues.apache.org/jira/rest/api/2/issue/13098596","key":"MAPREDUCE-6948","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2017-12-15T22:38:42.931+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 17 17:28:25 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_27738369996_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-07-17T17:28:25.047+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6948/watchers","watchCount":4,"isWatching":false},"created":"2017-08-30T16:22:15.085+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["unit-test"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12339181","id":"12339181","name":"3.0.0-alpha4","archived":false,"released":true,"releaseDate":"2017-07-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Jim_Brennan","name":"Jim_Brennan","key":"jim_brennan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10440","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10440","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10440","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10440"},"displayName":"Jim Brennan","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-17T17:28:25.078+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"*Error Message*\nexpected:<SUCCEEDED> but was:<ERROR>\n\n*Stacktrace*\njava.lang.AssertionError: expected:<SUCCEEDED> but was:<ERROR>\n\tat org.junit.Assert.fail(Assert.java:88)\n\tat org.junit.Assert.failNotEquals(Assert.java:743)\n\tat org.junit.Assert.assertEquals(Assert.java:118)\n\tat org.junit.Assert.assertEquals(Assert.java:144)\n\tat org.apache.hadoop.mapreduce.v2.app.job.impl.TestJobImpl.assertJobState(TestJobImpl.java:1041)\n\tat org.apache.hadoop.mapreduce.v2.app.job.impl.TestJobImpl.testUnusableNodeTransition(TestJobImpl.java:615)\n\n\n*Standard out*\n{code}\n2017-08-30 10:12:21,928 INFO  [Thread-49] event.AsyncDispatcher (AsyncDispatcher.java:register(209)) - Registering class org.apache.hadoop.mapreduce.v2.app.commit.CommitterEventType for class org.apache.hadoop.mapreduce.v2.app.commit.CommitterEventHandler\n2017-08-30 10:12:21,939 INFO  [Thread-49] event.AsyncDispatcher (AsyncDispatcher.java:register(209)) - Registering class org.apache.hadoop.mapreduce.v2.app.job.event.JobEventType for class org.apache.hadoop.mapreduce.v2.app.job.impl.TestJobImpl$StubbedJob\n2017-08-30 10:12:21,940 INFO  [Thread-49] event.AsyncDispatcher (AsyncDispatcher.java:register(209)) - Registering class org.apache.hadoop.mapreduce.v2.app.job.event.TaskEventType for class org.apache.hadoop.yarn.event.EventHandler$$EnhancerByMockitoWithCGLIB$$79f96ebf\n2017-08-30 10:12:21,940 INFO  [Thread-49] event.AsyncDispatcher (AsyncDispatcher.java:register(209)) - Registering class org.apache.hadoop.mapreduce.jobhistory.EventType for class org.apache.hadoop.yarn.event.EventHandler$$EnhancerByMockitoWithCGLIB$$79f96ebf\n2017-08-30 10:12:21,940 INFO  [Thread-49] event.AsyncDispatcher (AsyncDispatcher.java:register(209)) - Registering class org.apache.hadoop.mapreduce.v2.app.job.event.JobFinishEvent$Type for class org.apache.hadoop.yarn.event.EventHandler$$EnhancerByMockitoWithCGLIB$$79f96ebf\n2017-08-30 10:12:21,941 INFO  [Thread-49] impl.JobImpl (JobImpl.java:setup(1534)) - Adding job token for job_1234567890000_0001 to jobTokenSecretManager\n2017-08-30 10:12:21,941 WARN  [Thread-49] impl.JobImpl (JobImpl.java:setup(1540)) - Shuffle secret key missing from job credentials. Using job token secret as shuffle secret.\n2017-08-30 10:12:21,944 INFO  [Thread-49] impl.JobImpl (JobImpl.java:makeUberDecision(1305)) - Not uberizing job_1234567890000_0001 because: not enabled;\n2017-08-30 10:12:21,944 INFO  [Thread-49] impl.JobImpl (JobImpl.java:createMapTasks(1562)) - Input size for job job_1234567890000_0001 = 0. Number of splits = 2\n2017-08-30 10:12:21,945 INFO  [Thread-49] impl.JobImpl (JobImpl.java:createReduceTasks(1579)) - Number of reduces for job job_1234567890000_0001 = 1\n2017-08-30 10:12:21,945 INFO  [Thread-49] impl.JobImpl (JobImpl.java:handle(1017)) - job_1234567890000_0001Job Transitioned from NEW to INITED\n2017-08-30 10:12:21,946 INFO  [Thread-49] impl.JobImpl (JobImpl.java:handle(1017)) - job_1234567890000_0001Job Transitioned from INITED to SETUP\n2017-08-30 10:12:21,954 INFO  [CommitterEvent Processor #0] commit.CommitterEventHandler (CommitterEventHandler.java:run(231)) - Processing the event EventType: JOB_SETUP\n2017-08-30 10:12:21,978 INFO  [AsyncDispatcher event handler] impl.JobImpl (JobImpl.java:handle(1017)) - job_1234567890000_0001Job Transitioned from SETUP to RUNNING\n2017-08-30 10:12:21,983 INFO  [Thread-49] event.AsyncDispatcher (AsyncDispatcher.java:register(209)) - Registering class org.apache.hadoop.mapreduce.v2.app.job.event.TaskAttemptEventType for class org.apache.hadoop.mapreduce.v2.app.job.impl.TestJobImpl$5\n2017-08-30 10:12:22,000 INFO  [Thread-49] impl.JobImpl (JobImpl.java:transition(1953)) - Num completed Tasks: 1\n2017-08-30 10:12:22,029 INFO  [Thread-49] impl.JobImpl (JobImpl.java:transition(1953)) - Num completed Tasks: 2\n2017-08-30 10:12:22,032 INFO  [Thread-49] impl.JobImpl (JobImpl.java:actOnUnusableNode(1354)) - TaskAttempt killed because it ran on unusable node Mock for NodeId, hashCode: 1280187896. AttemptId:attempt_1234567890000_0001_m_000000_0\n2017-08-30 10:12:22,032 INFO  [Thread-49] impl.JobImpl (JobImpl.java:transition(1953)) - Num completed Tasks: 3\n2017-08-30 10:12:22,032 INFO  [Thread-49] impl.JobImpl (JobImpl.java:handle(1017)) - job_1234567890000_0001Job Transitioned from RUNNING to COMMITTING\n2017-08-30 10:12:22,032 ERROR [Thread-49] impl.JobImpl (JobImpl.java:handle(1009)) - Can't handle this event at current state\norg.apache.hadoop.yarn.state.InvalidStateTransitonException: Invalid event: JOB_TASK_COMPLETED at COMMITTING\n\tat org.apache.hadoop.yarn.state.StateMachineFactory.doTransition(StateMachineFactory.java:305)\n\tat org.apache.hadoop.yarn.state.StateMachineFactory.access$300(StateMachineFactory.java:46)\n\tat org.apache.hadoop.yarn.state.StateMachineFactory$InternalStateMachine.doTransition(StateMachineFactory.java:448)\n\tat org.apache.hadoop.mapreduce.v2.app.job.impl.JobImpl.handle(JobImpl.java:1007)\n\tat org.apache.hadoop.mapreduce.v2.app.job.impl.TestJobImpl.testUnusableNodeTransition(TestJobImpl.java:609)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)\n2017-08-30 10:12:22,035 INFO  [AsyncDispatcher event handler] impl.JobImpl (JobImpl.java:handle(1017)) - job_1234567890000_0001Job Transitioned from COMMITTING to ERROR\n2017-08-30 10:12:22,039 INFO  [CommitterEvent Processor #1] commit.CommitterEventHandler (CommitterEventHandler.java:run(231)) - Processing the event EventType: JOB_COMMIT\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"TestJobImpl.testUnusableNodeTransition failed","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13098596/comment/16293374","id":"16293374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Jim_Brennan","name":"Jim_Brennan","key":"jim_brennan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10440","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10440","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10440","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10440"},"displayName":"Jim Brennan","active":true,"timeZone":"America/Chicago"},"body":"I have been unable to reproduce this problem in trunk, nor in branch-2.8.   I have been able to repro in branch-2.7, but only by adding a sleep to exacerbate the race condition.\r\n\r\nAnalysis:\r\nThe key point in the failure case is here:\r\n{{2017-08-30 10:12:22,000 INFO  [Thread-49] impl.JobImpl (JobImpl.java:transition(1953)) - Num completed Tasks: 1\r\n2017-08-30 10:12:22,029 INFO  [Thread-49] impl.JobImpl (JobImpl.java:transition(1953)) - Num completed Tasks: 2\r\n2017-08-30 10:12:22,032 INFO  [Thread-49] impl.JobImpl (JobImpl.java:actOnUnusableNode(1354)) - TaskAttempt killed because it ran on unusable node Mock for NodeId, hashCode: 1280187896. AttemptId:attempt_1234567890000_0001_m_000000_0\r\n2017-08-30 10:12:22,032 INFO  [Thread-49] impl.JobImpl (JobImpl.java:transition(1953)) - Num completed Tasks: 3\r\n}}\r\nAt this point Num completed tasks should be 2.  Since it is 3, we start moving to the COMMITTED state too early and trip the failure.\r\nIn the successful case, the log looks like this:\r\n{{2017-12-15 16:16:54,253 INFO  [Thread-0] impl.JobImpl (JobImpl.java:transition(1979)) - Num completed Tasks: 1\r\n2017-12-15 16:16:54,258 INFO  [Thread-0] impl.JobImpl (JobImpl.java:transition(1979)) - Num completed Tasks: 2\r\n2017-12-15 16:16:54,260 INFO  [Thread-0] impl.JobImpl (JobImpl.java:actOnUnusableNode(1359)) - TaskAttempt killed because it ran on unusable node Mock for NodeId, hashCode: 131679889. AttemptId:attempt_1234567890000_0001_m_000000_0\r\n2017-12-15 16:16:54,261 INFO  [Thread-0] impl.JobImpl (JobImpl.java:transition(1979)) - Num completed Tasks: 2\r\n2017-12-15 16:16:54,262 INFO  [Thread-0] impl.JobImpl (JobImpl.java:checkReadyForCompletionWhenAllReducersDone(2103)) - Killing map task task_1234567890000_0001_m_000000\r\n2017-12-15 16:16:54,263 INFO  [Thread-0] impl.JobImpl (JobImpl.java:checkReadyForCompletionWhenAllReducersDone(2103)) - Killing map task task_1234567890000_0001_m_000001\r\n2017-12-15 16:16:54,263 INFO  [Thread-0] impl.JobImpl (JobImpl.java:transition(1979)) - Num completed Tasks: 3}}\r\n\r\nThe second Num Completed Tasks:2 line corresponds to when we mark the Reducer task as SUCCEEDED.  At this point, the count of succeeded map tasks should be 1, because it was just decremented due to the unusable node.  It is incremented to 2 before printing.\r\n\r\nThe difference between branch-2.7, which fails, and trunk/branch-2.8 is the fix in MAPREDUCE-6675, which switched it to use a DrainDispatcher and added a dispatcher.await() call before we complete the reducer.\r\n\r\nAnother possible factor is YARN-5436, which fixed a very similar race in DrainDispatcher.  That one is present in trunk, but not in branch-2.8.  So it may account for intermittent failures in branch-2.8, but I was not able to reproduce it.\r\n\r\nSo as far as I can tell, this appears to be fixed already.\r\n\r\n[~haibo.chen], can you provide any insight?  Any chance this failure was seen on branch-2.8 or branch-2.7?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Jim_Brennan","name":"Jim_Brennan","key":"jim_brennan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10440","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10440","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10440","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10440"},"displayName":"Jim Brennan","active":true,"timeZone":"America/Chicago"},"created":"2017-12-15T22:38:42.931+0000","updated":"2017-12-15T22:38:42.931+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13098596/comment/16408630","id":"16408630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Jim_Brennan","name":"Jim_Brennan","key":"jim_brennan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10440","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10440","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10440","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10440"},"displayName":"Jim Brennan","active":true,"timeZone":"America/Chicago"},"body":"Propose we close this.\r\n\r\n[~jlowe], [~haibochen], do you agree?\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Jim_Brennan","name":"Jim_Brennan","key":"jim_brennan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10440","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10440","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10440","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10440"},"displayName":"Jim Brennan","active":true,"timeZone":"America/Chicago"},"created":"2018-03-21T21:47:56.096+0000","updated":"2018-03-21T21:47:56.096+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13098596/comment/16408655","id":"16408655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"It looks like this was reported against 3.0.0-alpha4.  All of the proposed fixes for this would also be in 3.0.0-alpha4, so if Haibo can confirm this occurred on alpha4 then it could still be a valid issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2018-03-21T22:05:21.399+0000","updated":"2018-03-21T22:05:21.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13098596/comment/16408722","id":"16408722","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"This was observed in alpha4, so I suspect there is another race condition.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-03-21T22:46:29.173+0000","updated":"2018-03-21T22:46:29.173+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13098596/comment/16459808","id":"16459808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Jim_Brennan","name":"Jim_Brennan","key":"jim_brennan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10440","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10440","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10440","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10440"},"displayName":"Jim Brennan","active":true,"timeZone":"America/Chicago"},"body":"[~jlowe], [~haibochen], I tried to reproduce this again in branch-2.7 and branch-3.0.   I ran this test in a loop for more than an hour on each, and was not able to get it to fail.\r\n\r\nIn branch-2.7, I can get it to fail as reported by inserting a sleep into the taskAttemptEventHandler right before it decrements the succeededMapperCount().   If I do the same thing in branch-3.0, it does not fail (due to the aforementioned fixes in [MAPREDUCE-6675]).\r\n\r\nI searched for this test in apache issues, and the only reference I found was this comment by [~haibochen] in [MAPREDUCE-6937]:\r\n\r\n{quote}\r\n+1 on the branch-2.7-v5 patch. I have filed MAPREDUCE-6948 for the unit test failure TestJobImpl.testUnusableNodeTransition. \r\n{quote}\r\n\r\nThat comment looks like it is in response to branch-2.7 test failures.  hadoop.mapreduce.v2.app.job.impl.TestJobImpl is only listed as failing in the branch-2.7 tests.\r\n\r\n[~haibochen], did you reproduce the failure on 3.0.0-alpha4?  Is it possible this was intended to be filed against branch 2.7 as a result of the test failures from [MAPREDUCE-6937]?\r\n\r\nThe race does still appear to exist on branch 2.7, so we may want to consider pulling [MAPREDUCE-6675] back to that branch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Jim_Brennan","name":"Jim_Brennan","key":"jim_brennan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10440","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10440","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10440","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10440"},"displayName":"Jim Brennan","active":true,"timeZone":"America/Chicago"},"created":"2018-05-01T16:14:10.651+0000","updated":"2018-05-01T16:14:10.651+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13098596/comment/16546675","id":"16546675","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Jim_Brennan","name":"Jim_Brennan","key":"jim_brennan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10440","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10440","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10440","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10440"},"displayName":"Jim Brennan","active":true,"timeZone":"America/Chicago"},"body":"[~haibochen], [~jlowe], based on my last comment from May, I propose we close this and re-open if it recurs.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Jim_Brennan","name":"Jim_Brennan","key":"jim_brennan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10440","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10440","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10440","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10440"},"displayName":"Jim Brennan","active":true,"timeZone":"America/Chicago"},"created":"2018-07-17T14:13:10.643+0000","updated":"2018-07-17T14:13:10.643+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13098596/comment/16546895","id":"16546895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"I am okay with closing this for now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haibochen","name":"haibochen","key":"haibochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haibo Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-07-17T17:04:38.333+0000","updated":"2018-07-17T17:04:38.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13098596/comment/16546913","id":"16546913","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"I agree as well.  I have not seen any recent precommit failures on 3.x releases for this unit test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2018-07-17T17:28:25.073+0000","updated":"2018-07-17T17:28:25.073+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6948/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3jgif:"}}