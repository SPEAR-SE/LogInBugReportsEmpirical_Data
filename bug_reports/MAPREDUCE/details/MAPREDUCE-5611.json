{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12677942","self":"https://issues.apache.org/jira/rest/api/2/issue/12677942","key":"MAPREDUCE-5611","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-11-20T10:21:57.771+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat May 02 04:41:01 UTC 2015","customfield_12310420":"357317","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5611/watchers","watchCount":9,"isWatching":false},"created":"2013-11-07T06:57:14.020+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["BB2015-05-TBR"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324149","id":"12324149","description":"maintenance release on branch-1.2","name":"1.2.1","archived":false,"released":true,"releaseDate":"2013-08-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-06T03:32:50.780+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[],"timeoriginalestimate":null,"description":"I have come across an issue with CombineFileInputFormat. Actually I ran a hive query on approx 1.2 GB data with CombineHiveInputFormat which internally uses CombineFileInputFormat. My cluster size is 9 datanodes and max.split.size is 256 MB\nWhen I ran this query with replication factor 9, hive consistently creates all 6 rack-local tasks and with replication factor 3 it creates 5 rack-local and 1 data local tasks. \n\n When replication factor is 9 (equal to cluster size), all the tasks should be data-local as each datanode contains all the replicas of the input data, but that is not happening i.e all the tasks are rack-local. \n\nWhen I dug into CombineFileInputFormat.java code in getMoreSplits method, I found the issue with the following snippet (specially in case of higher replication factor)\n\n{code:title=CombineFileInputFormat.java|borderStyle=solid}\nfor (Iterator<Map.Entry<String,\n         List<OneBlockInfo>>> iter = nodeToBlocks.entrySet().iterator();\n         iter.hasNext();) {\n       Map.Entry<String, List<OneBlockInfo>> one = iter.next();\n      nodes.add(one.getKey());\n      List<OneBlockInfo> blocksInNode = one.getValue();\n\n      // for each block, copy it into validBlocks. Delete it from\n      // blockToNodes so that the same block does not appear in\n      // two different splits.\n      for (OneBlockInfo oneblock : blocksInNode) {\n        if (blockToNodes.containsKey(oneblock)) {\n          validBlocks.add(oneblock);\n          blockToNodes.remove(oneblock);\n          curSplitSize += oneblock.length;\n\n          // if the accumulated split size exceeds the maximum, then\n          // create this split.\n          if (maxSize != 0 && curSplitSize >= maxSize) {\n            // create an input split and add it to the splits array\n            addCreatedSplit(splits, nodes, validBlocks);\n            curSplitSize = 0;\n            validBlocks.clear();\n          }\n        }\n      }\n{code}\n\nFirst node in the map nodeToBlocks has all the replicas of input file, so the above code creates 6 splits all with only one location. Now if JT doesn't schedule these tasks on that node, all the tasks will be rack-local, even though all the other datanodes have all the other replicas.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324153","id":"12324153","description":"1.3.0 release","name":"1.3.0","archived":false,"released":false}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12613866","id":"12613866","filename":"CombineFileInputFormat-trunk.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-14T16:29:47.486+0000","size":555,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12613866/CombineFileInputFormat-trunk.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"357607","customfield_12312823":null,"summary":"CombineFileInputFormat only requests a single location per split when more could be optimal","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13815716","id":"13815716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"body":"I am suggesting following small patch for this issue. Patched line is in *bold*\n\n{code:title=CombineFileInputFormat.java|borderStyle=solid}\nfor (OneBlockInfo oneblock : blocksInNode) {\n        if (blockToNodes.containsKey(oneblock)) {\n          *nodes.addAll(Arrays.asList(blockToNodes.get(oneblock)));*\n          validBlocks.add(oneblock);\n          blockToNodes.remove(oneblock);\n          curSplitSize += oneblock.length;\n\n          // if the accumulated split size exceeds the maximum, then\n          // create this split.\n          if (maxSize != 0 && curSplitSize >= maxSize) {\n            // create an input split and add it to the splits array\n            addCreatedSplit(splits, nodes, validBlocks);\n            curSplitSize = 0;\n            validBlocks.clear();\n          }\n        }\n      }\n{code}\n\nThis will include all the nodes on which the replica lies in the location hash set, so that whichever node JT schedules the tasks it finds all the replicas local to that node (in case of replication = cluster size). This patch even helps in 3 replication factor, this fact is evident with the following numbers in my cluster\n\n9 replicas without patch  (all 6 tasks are rack-local)\n9 replicas with patch  (5 tasks are data-local and 1 rack-local)\n\n3 replicas without patch  (1 data-local and 5 rack-local)\n3 replicas with patch  (2 data-local and 4 rack-local)\n\nPlease let me know, if I can submit the above patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-07T07:00:54.803+0000","updated":"2013-11-07T07:00:54.803+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13815723","id":"13815723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"body":"following is the newly added line (since it is not clear from above code block)\n\n*nodes.addAll(Arrays.asList(blockToNodes.get(oneblock)));*","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-07T07:15:45.045+0000","updated":"2013-11-07T07:15:45.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13822574","id":"13822574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"body":"attaching patch against trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-14T16:29:47.493+0000","updated":"2013-11-14T16:29:47.493+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13827515","id":"13827515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12613866/CombineFileInputFormat-trunk.patch\n  against trunk revision .\n\n    {color:red}-1 patch{color}.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/4219//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-20T10:21:57.771+0000","updated":"2013-11-20T10:21:57.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13835199","id":"13835199","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"body":"\nThanks Chandra.  This is a good perf patch.  Here are the data locality numbers which can be useful to analyze the perf improvement.\n\n\nWithout Patch:\nJob Counters \tLaunched map tasks\t0\t0\t335\nData-local map tasks\t0\t0\t179\nRack-local map tasks\t0\t0\t81\n\nWith Patch:\nJob Counters \tLaunched map tasks\t0\t0\t335\nData-local map tasks\t0\t0\t279\nRack-local map tasks\t0\t0\t47\n\nThe data locality improves a lot with this patch in Hive queries.  \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-11-29T06:24:28.332+0000","updated":"2013-11-29T06:24:28.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13835200","id":"13835200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"body":"Just wanted to add the response times as well\n\nWithout Patch : 289 seconds\nWith Patch: 219 seconds\n\nThis testing was carried out with with Hive 0.10","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-11-29T06:31:14.351+0000","updated":"2013-11-29T06:31:14.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13847999","id":"13847999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandyr","name":"sandyr","key":"sandyr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandy Ryza","active":true,"timeZone":"America/Los_Angeles"},"body":"If I understand correctly, the issue is that, even when the blocks referred to by a split refer reside on multiple nodes, CombineFileInputFormat only creates the split with its locations referring to a single node.  The proposed fix is to create the split with all nodes that are replicas for any of the blocks included in the split.  This would allow the scheduler to prefer placing the tasks on those nodes.\n\nHowever, the proposed change could cause performance regressions in situations when we are combining many small files.  Imagine a 1000-node cluster and and we have created a split composed of 1000 small files that all have a replica on a single node.  The other replicas for these files are likely spread out on nodes all over the cluster.  If we go with the proposed approach then we would end up requesting every node on the cluster, even though we are really only likely to get a data-local performance speedup if the task gets placed on the node where all the files are together.\n\nA fix that would not have this performance implication would be to create a split with all the nodes that are in the *intersection* of nodes that blocks in the split reside on.  So if a split contains a two blocks, one that resides on node1, node2, and node3, and another that resides on node2, node3, and node4, we would set the split's locations to node2 and node3.\n\nIf we choose to go with the second route, it would be good to do some quick back-of-the-envelope math to support that the time spent computing these intersections is worth the data-local speedup we could get.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandyr","name":"sandyr","key":"sandyr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandy Ryza","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-13T22:29:51.599+0000","updated":"2013-12-13T22:29:51.599+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13848164","id":"13848164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"body":"Agreed, ideal will be to compute and have the *intersection* of the nodes in the split information.  We will modify the patch to accommodate this and post the details.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-12-14T02:12:11.509+0000","updated":"2013-12-14T02:12:11.509+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13861418","id":"13861418","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"body":"Agreed, common nodes (intersection) should be placed in the beginning of the locations set, but I feel having all the locations of all the blocks in locations set will help scheduling and data locality. Two concerns\n\n1.  In your example, one node having all the 1000 replicas. What if, JT is not able to schedule tasks on this node (slot limitation etc). Then it will pick any random node and schedule the task (having all the blocks non local).\n\n2. What if there is no intersection i.e common nodes for blocks in a split?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cpbhagtani","name":"cpbhagtani","key":"cpbhagtani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chandra Prakash Bhagtani","active":true,"timeZone":"Etc/UTC"},"created":"2014-01-03T10:53:05.678+0000","updated":"2014-01-03T10:53:05.678+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/13863446","id":"13863446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandyr","name":"sandyr","key":"sandyr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandy Ryza","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. What if, JT is not able to schedule tasks on this node (slot limitation etc). Then it will pick any random node and schedule the task (having all the blocks non local).\nThat's right.  However, picking a node with a small fraction of the input data is not much better than picking a node without any of the input data.  It is only useful to place a task on a node if the majority of the data is on that node.  There may be more optimal approaches to this that take into account the number of bytes on each node, but I think using the intersection is a good start that we know will not cause perf regressions.\n\nbq. What if there is no intersection i.e common nodes for blocks in a split?\nThe change was proposed to affect the code where we are building splits out of the nodeToBlocks map.  In this part of the split creation process, there will always be an intersection because the blocks are all chosen from a specific node.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandyr","name":"sandyr","key":"sandyr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandy Ryza","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-01-06T21:32:02.528+0000","updated":"2014-01-06T21:32:02.528+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/14524745","id":"14524745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12613866/CombineFileInputFormat-trunk.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / f1a152c |\n| Console output | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5536/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-02T04:35:30.502+0000","updated":"2015-05-02T04:35:30.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677942/comment/14524808","id":"14524808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12613866/CombineFileInputFormat-trunk.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / f1a152c |\n| Console output | https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5545/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-02T04:41:01.442+0000","updated":"2015-05-02T04:41:01.442+0000"}],"maxResults":12,"total":12,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5611/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1pljj:"}}