{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12668777","self":"https://issues.apache.org/jira/rest/api/2/issue/12668777","key":"MAPREDUCE-5510","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Sep 23 03:05:33 UTC 2013","customfield_12310420":"348711","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5510/watchers","watchCount":2,"isWatching":false},"created":"2013-09-16T14:26:33.317+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324812","id":"12324812","description":"2.0.6-alpha bug-fix release","name":"2.0.6-alpha","archived":false,"released":true,"releaseDate":"2013-08-22"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-09-23T03:05:33.465+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315625","id":"12315625","name":"applicationmaster"}],"timeoriginalestimate":null,"description":"when it hadppen, I notice reduces were not preempt\n\n2013-09-15 10:32:26,608 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Got allocated containers 1\n2013-09-15 10:32:26,608 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Assigned to reduce\n2013-09-15 10:32:26,608 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Assigned container container_1377833725640_158209_01_004100 to attempt_1377833725640_158209_r_000258_0\n2013-09-15 10:32:26,608 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Recalculating schedule, headroom=582656\n2013-09-15 10:32:26,608 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: completedMapPercent 0.9940104 totalMemLimit:2548736 finalMapMemLimit:70656 finalReduceMemLimit:2478080 netScheduledMapMem:70656 netScheduledReduceMem:2460672\n2013-09-15 10:32:26,608 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Ramping up 1\n2013-09-15 10:32:26,608 INFO [RMCommunicator Allocator] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: After Scheduling: PendingReds:212 ScheduledMaps:22 ScheduledReds:55 AssignedMaps:1 AssignedReds:213 CompletedMaps:3817 CompletedReds:0 ContAlloc:4031 ContRel:0 HostLocal:0 RackLocal:0\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"349008","customfield_12312823":null,"summary":"Root queue is full,  leads to a job hung, it's reduces started,but some maps is pending","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanbin","name":"wanbin","key":"wanbin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wanbin","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanbin","name":"wanbin","key":"wanbin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wanbin","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12668777/comment/13768363","id":"13768363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanbin","name":"wanbin","key":"wanbin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wanbin","active":true,"timeZone":"Etc/UTC"},"body":"  private void preemptReducesIfNeeded() {\n    if (reduceResourceReqt == 0) {\n      return; //no reduces\n    }\n    //check if reduces have taken over the whole cluster and there are \n    //unassigned maps\n    if (scheduledRequests.maps.size() > 0) {\n      int memLimit = getMemLimit();\n      int availableMemForMap = memLimit - ((assignedRequests.reduces.size() -\n          assignedRequests.preemptionWaitingReduces.size()) * reduceResourceReqt);\n      //availableMemForMap must be sufficient to run atleast 1 map\n      if (availableMemForMap < mapResourceReqt) {\n\n\nI consider availableMemForMap should get rid of scheduledRequests.maps.size()*mapResourceReqt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanbin","name":"wanbin","key":"wanbin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wanbin","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-16T14:36:00.242+0000","updated":"2013-09-16T14:36:00.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12668777/comment/13774263","id":"13774263","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanbin","name":"wanbin","key":"wanbin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wanbin","active":true,"timeZone":"Etc/UTC"},"body":"I have analyzed seriously again. At that time. these two big mapreduce jobs were runing meanwhile. these where belong to two queue respectively. As a result root queue was full, because of over-capacity. But one queue was not full. because cluster's resource exhaust and numbers  of reduce had occupied resource in advance. Final map task had hung. I know yarn has a rule when there aren't enough resource to assign, map task will trigger to preempt reduce task. kill some reduce task, to guarantee map task success. But why no effect at that time? \nI research the AM and ResourceManager log, discover that to trigger preemption must leaf queue resource is not enough, it isn't care of parent queue or root queue resource usage rate. Therefore there appear that  cluster's resource exhaust,but don't trigger preemption still.\nSo I think when ResourceManager is calculating  leaf queue's headroom value, it need computes its parent queue usage rate. if its parent queue is full, jobs inside leaf queue need consider whether trigger preemption.\nI will provide a patch later. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanbin","name":"wanbin","key":"wanbin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wanbin","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-23T03:05:33.465+0000","updated":"2013-09-23T03:05:33.465+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5510/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1o4mn:"}}