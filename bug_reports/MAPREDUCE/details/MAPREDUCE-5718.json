{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12688364","self":"https://issues.apache.org/jira/rest/api/2/issue/12688364","key":"MAPREDUCE-5718","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-01-13T17:54:15.767+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jan 11 17:38:42 UTC 2016","customfield_12310420":"367383","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5718/watchers","watchCount":9,"isWatching":false},"created":"2014-01-11T00:41:13.888+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327180","id":"12327180","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"issuelinks":[{"id":"12384676","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12384676","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12701310","key":"MAPREDUCE-5795","self":"https://issues.apache.org/jira/rest/api/2/issue/12701310","fields":{"summary":"Job should be marked as Failed if it is recovered from commit.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-01-11T17:38:42.425+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315342","id":"12315342","name":"mr-am"}],"timeoriginalestimate":null,"description":"when any of this happens:\n* While testing RM HA, if the RM fails over while an MR AM is in the middle of a commit, \n* When testing preempting, if the MR AM fails over during the middle of a commit\n\nthe subsequent AM gets spawned but dies with a diagnostic message - \"We crashed durring a commit\". ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12694551","id":"12694551","filename":"MAPREDUCE-5718.v2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-01-26T13:50:24.818+0000","size":2260,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12694551/MAPREDUCE-5718.v2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12622897","id":"12622897","filename":"mr-5718-0.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-01-14T17:43:39.502+0000","size":1664,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12622897/mr-5718-0.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"367692","customfield_12312823":null,"summary":"MR job will fail after commit fail","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/13869750","id":"13869750","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"body":"The failure comes from the following snippet. If the previous AM has started the commit, but has not succeeded or failed, we assume it is an error state. \n{code}\n        if (commitSuccess) {\n          shutDownMessage = \"We crashed after successfully committing. Recovering.\";\n          forcedState = JobStateInternal.SUCCEEDED;\n        } else if (commitFailure) {\n          shutDownMessage = \"We crashed after a commit failure.\";\n          forcedState = JobStateInternal.FAILED;\n        } else {\n          //The commit is still pending, commit error\n          shutDownMessage = \"We crashed durring a commit\";\n          forcedState = JobStateInternal.ERROR;\n        }\n{code}\n\nTo fix this, we can do either of\n# Treat the lack of success/failure file as an artifact of the previous commit failing due to RM restart and re-attempt the commit. The only downside to this seems to be when the commit itself is buggy - we ll end up trying to commit upto the number of attempts allowed. \n# Make sure the AM deletes the commit file before failing. Given the RM/ NM kill the containers, making sure we delete the commit file before dying can be a little more involved.\n\n[~revans2] - do you think it is reasonable to go with the first option? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-01-13T17:54:15.767+0000","updated":"2014-01-13T17:54:15.767+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/13869864","id":"13869864","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"This was by design to handle racing AMs in the presence of partitions. Reducing priority.\n\nThis will go away once we have work-preserving RM restart.\n\nFor the shorter term, I think it makes sense to have the AM delete the file before failing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-01-13T19:29:58.383+0000","updated":"2014-01-13T19:29:58.383+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/13870953","id":"13870953","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"body":"First-cut patch that deletes the startCommitFile if the commit is interrupted. \n\nHowever, in case of two AMs running during a partition, this can lead to one AM deleting the startCommitFile created by another AM. To avoid races in case of a partition, we might have to complicate this a little more. \n\nHow about adding a .host.pid suffix to the name of the commit file? Each AM would write its own. When a subsequent AM comes up and verifies the state of commit from previous AMs, it would look for any? [~vinodkv], [~revans2] - thoughts? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-01-14T17:43:39.507+0000","updated":"2014-01-14T17:43:39.507+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/13872189","id":"13872189","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"This is closely related to MAPREDUCE-5485.  The problem here is that the output committer is user-pluggable code, and we can't assume what it does or if it can be safely restarted after crashing mid-way through the commit.  This is one of the reasons job commits are not retried by the AM, and by extension we can't assume it's safe to retry in another AM attempt.  That's why the AM goes out of its way to indicate via a file that it's starting to do the job commit and avoids repeating it on an AM restart if that file is still present.  Whether the retry is because the AM crash or the AM was restarted due to RM restart, the end effect is the same -- it's not safe to retry a job commit in the general case.\n\nIf we had an API by which the output committer could tell the AM if it's safe to retry a job commit that would help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-01-15T15:36:37.487+0000","updated":"2014-01-15T15:36:37.487+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/13872340","id":"13872340","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"body":"Thanks for chiming in, Jason. \n\nPlease correct me if I am wrong. Not being able to tolerate node failures (slaves/master) seems like a major regression from MR1 which tolerates slave failures. I am wondering if there is a way to solve the crashed commits issue not just for all jobs. For MR, what do you think of committing to an intermediate location, and renaming it to the output location? If the output location is missing, the commit can be retried.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-01-15T18:07:14.650+0000","updated":"2014-01-15T18:07:14.650+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/13872366","id":"13872366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. If we had an API by which the output committer could tell the AM if it's safe to retry a job commit that would help.\nJason, we already have the recover API in OutputCommitter. That should be enough right?\n\nbq. Please correct me if I am wrong. Not being able to tolerate node failures (slaves/master) seems like a major regression from MR1 which tolerates slave failures.\nThis isn't a regression. More of an artifact of the new architecture. MR1 doesn't tolerate the master failures. AM failure is akin to the master-failure, except the master is distributed now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-01-15T18:22:36.467+0000","updated":"2014-01-15T18:22:36.467+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/13872419","id":"13872419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"As I understand it, we have a task-level output recovery API in OutputCommitter but not a job-level output recovery API.  I'm not sure it's safe to assume that if an output committer supports task recovery that it also supports recovering from a partial job output commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-01-15T18:53:08.569+0000","updated":"2014-01-15T18:53:08.569+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14164499","id":"14164499","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"body":"With work-preserving RM/NM restart, one can run into this only when the AM dies or the node running the AM dies. This is no longer a regression when moving from MR1 to MR2. \n\nClosing this as \"Won't Fix\" for now. Please re-open if needed. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-10-09T01:00:27.947+0000","updated":"2014-10-09T01:00:27.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14291542","id":"14291542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"body":"This will also happen when the AM is preempted","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-01-26T07:40:35.135+0000","updated":"2015-01-26T07:40:35.135+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14291543","id":"14291543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"body":"This will also happen when the AM is preempted","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-01-26T07:40:38.032+0000","updated":"2015-01-26T07:40:38.032+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14291550","id":"14291550","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"body":"Yes, it appears when we test preempting, and the job fails for \"We crashed durring a commit\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-01-26T07:56:01.225+0000","updated":"2015-01-26T07:56:01.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14291561","id":"14291561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"body":"if crashed during a commit and if an api comes out to check if the job can fail over, then the problem will be fixed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-01-26T08:20:43.105+0000","updated":"2015-01-26T08:20:43.105+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14291827","id":"14291827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"body":"I think we can delete the commit tmp file at init stage","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-01-26T13:50:24.828+0000","updated":"2015-01-26T13:50:24.828+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14303369","id":"14303369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12694551/MAPREDUCE-5718.v2.patch\n  against trunk revision 8cb4731.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app:\n\n                  org.apache.hadoop.mapreduce.v2.app.TestMRAppMaster\n\nTest results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5147//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5147//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-02-03T14:53:00.570+0000","updated":"2015-02-03T14:53:00.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14304041","id":"14304041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yanghaogn] - initially, I was also trying to delete the startCommitFile if there is not corresponding endFile. However, we can't do that for reasons Jason described here - https://issues.apache.org/jira/browse/MAPREDUCE-5718?focusedCommentId=13872189&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13872189","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-03T21:31:09.803+0000","updated":"2015-02-03T21:31:09.803+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14305035","id":"14305035","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi, I have read the comment twice. It may not be safe to recover under this situation. \n\nI'm wondering whether you are worring about missing data. But during the recovery, task output data will be moved to the new output dir, just as the normal AM failover does, then it's safe to recover\n\nOur cluster will add this feature. Can you give more specific information on the unsafe situation? Thanks a lot","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-02-04T12:51:48.508+0000","updated":"2015-02-04T12:51:48.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14305036","id":"14305036","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi, I have read the comment twice. It may not be safe to recover under this situation. \n\nI'm wondering whether you are worring about missing data. But during the recovery, task output data will be moved to the new output dir, just as the normal AM failover does, then it's safe to recover\n\nOur cluster will add this feature. Can you give more specific information on the unsafe situation? Thanks a lot","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanghaogn","name":"yanghaogn","key":"yanghaogn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yanghaogn&avatarId=32436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yanghaogn&avatarId=32436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yanghaogn&avatarId=32436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yanghaogn&avatarId=32436"},"displayName":"Yang Hao","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-02-04T12:51:53.332+0000","updated":"2015-02-04T12:51:53.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14305180","id":"14305180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"The issue is that the OutputCommitter is user-specified code.  It may not be doing filesystem operations at all during the commit (e.g.: committing to a database, a REST API, etc.), and that procedure may not be restartable without the chance of corrupting or losing data.  Yes, FileOutputCommitter's commit procedure is something that can be restarted, but jobs are not required to use FileOutputCommitter nor dump their output in a file at all.  That's why MAPREDUCE-5485 was filed, because to do this safely the framework needs an indication from the output committer whether or not commit is a restartable procedure.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2015-02-04T14:47:19.908+0000","updated":"2015-02-04T14:47:19.908+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/14307931","id":"14307931","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yanghaogn] we follow the convention of setting the fix-version only at the time of commit by a committer. Dropping fix-version for now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-05T20:29:15.602+0000","updated":"2015-02-05T20:29:15.602+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688364/comment/15092352","id":"15092352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"Given MAPREDUCE-5485 is already commit in, shall we mark this JIRA as duplicated?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-01-11T17:38:42.425+0000","updated":"2016-01-11T17:38:42.425+0000"}],"maxResults":20,"total":20,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-5718/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1rbqn:"}}