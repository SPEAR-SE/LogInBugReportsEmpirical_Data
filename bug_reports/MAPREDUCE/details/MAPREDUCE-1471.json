{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12455776","self":"https://issues.apache.org/jira/rest/api/2/issue/12455776","key":"MAPREDUCE-1471","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2010-02-09T17:14:16.885+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Apr 23 13:47:16 UTC 2012","customfield_12310420":"149534","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_69343964601_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-04-22T05:37:21.324+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-1471/watchers","watchCount":9,"isWatching":false},"created":"2010-02-09T15:24:39.209+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":"FileOutputCommitter ","customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":14400,"aggregatetimeoriginalestimate":14400,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314047","id":"12314047","description":"","name":"0.20.1","archived":false,"released":true,"releaseDate":"2009-09-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-04-23T13:47:16.707+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":14400,"description":"When the FileOutputCommitter cleans up during it's cleanupJob method, it potentially deletes the temporary files of other concurrent jobs.\n\nSince all the temporary files for all concurrent jobs are written to working_path/_temporary/ any concurrent tasks that have the same working_path will remove all currently executing jobs when it removes working_path/_temporary during job cleanup.\n\nIf the file name output is guaranteed by the client application to be unique, the temporary files/directories should also be guaranteed to be unique to avoid this problem. Suggest modifying cleanupJob to only remove files that it created itself.","customfield_10010":null,"timetracking":{"originalEstimate":"4h","remainingEstimate":"4h","originalEstimateSeconds":14400,"remainingEstimateSeconds":14400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":14400,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"111635","customfield_12312823":null,"summary":"FileOutputCommitter does not safely clean up it's temporary files","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfinnessy","name":"jfinnessy","key":"jfinnessy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jim Finnessy","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfinnessy","name":"jfinnessy","key":"jfinnessy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jim Finnessy","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":14400,"percent":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":14400,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455776/comment/12831546","id":"12831546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"Jim, all file-based output-formats check to ensure that their output-directory is *not* present when they start i.e. 'working_path' is owned by one and only one job, hence this behaviour is correct.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-02-09T17:14:16.885+0000","updated":"2010-02-09T17:14:16.885+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455776/comment/12832199","id":"12832199","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfinnessy","name":"jfinnessy","key":"jfinnessy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jim Finnessy","active":true,"timeZone":"Etc/UTC"},"body":"It is a pretty common use case for me, and I'm guessing others, to write a number of files to the same output directory from concurrent jobs. \n\nFor instance counting the number of occurrences of a daily event for a entire month\n\nSetting up the directory structure:\n.../2008/07/\n\nWith all of the count files for that month ending up in that directory.\n\nWhen running concurrent jobs 1 and 2, hadoop creates the following temporary directories/files with a modified version of SequenceFileOutputFormat, that allows me name the file what I desire and run with the same working path for multiple jobs.\n.../2008/07/_temporary/_attempt_local_0001_r_000000_0\n.../2008/07/_temporary/_attempt_local_0002_r_000000_0\n\nWhen the job 1 completes, in order to clean up it's temporary files, it removes\n.../2008/07/_temporary/\n\nThis then blows away the temporary files for job 2.\n\nI would say that normally this is not a hadoop problem because of the way the I extended SequenceFileOutputFormat to allow for mutliple jobs to have the same working path so long as the output file name is unique (which it is). However, it is the cleanupJob in FileOutputCommitter that causes the problem, and since the committer in FileOutputFormat is private, I cannot extend and replace the FileOutputCommitter with my own. Currently I have overidden the getOutputCommiter(context) method in my out FileOutputFormat to work around this, but if the class ever starts accessing the committer without going through that method, I'm in trouble again.\n\nSo....I'd really appreciate it if the commiter in FIleOutputCommitter is protected rather than private in FileOutputFormat so that it can be overridden for client applications or the jobs only cleanup the temporary files that they create rather than recursively deleting the highest level directory (_temporary).\n\nThanks,\nJim\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfinnessy","name":"jfinnessy","key":"jfinnessy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jim Finnessy","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-10T21:12:53.267+0000","updated":"2010-02-10T21:12:53.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455776/comment/12832391","id":"12832391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"bq. If the file name output is guaranteed by the client application to be unique, the temporary files/directories should also be guaranteed to be unique to avoid this problem\nI like this idea. But, this should be done in your own custom OutputFormat/OutputCommitter. \nWe cannot change FileOutputFormat/Committer for the following reason:\nCurrently the output file names are part-m-00000 or part-r-00000 for tasks m_00000 and r_00000 irrespective of the jobid. Unless user changes these file names to be different for different jobs, user can not run concurrent jobs with same output path. If he runs without considering final output file names, output is unpredictable; One job will replace the output files from the other job. i.e. part-m-00000 is the output of either job1 or job2 and the other output is lost! \nSo, FileOutputFormat makes sure that output directory does not exist already. If user has made sure that the output file names are unique for each job by overriding FileOutputFormat, then i would say he can write his own OutputCommitter for running concurrent jobs.\n\nbq. Currently I have overidden the getOutputCommiter(context) method in my out FileOutputFormat to work around this.\nThis is the correct way to plug your custom OutputCommitter.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-02-11T06:14:28.072+0000","updated":"2010-02-11T06:14:28.072+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455776/comment/13259006","id":"13259006","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"body":"The resolution here was that the dev ought to implement a custom OC for such needs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-04-22T05:37:22.947+0000","updated":"2012-04-22T05:37:22.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455776/comment/13259603","id":"13259603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Jim, it should not be too difficult for you to take the existing FileOutputCommitter and modify it to do what you want.  Be aware though that going to the 2.0 line FileOutputCommitter has changed so that if an application master crashes it can recover and start over without needing to rerun anything that finished successfully before.  Just be aware that the directory structure is different and when upmerging to trunk/2.0 you will probably need to modify your code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2012-04-23T13:47:16.618+0000","updated":"2012-04-23T13:47:16.618+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-1471/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jgp3:"}}