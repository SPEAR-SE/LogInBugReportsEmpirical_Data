{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12990701","self":"https://issues.apache.org/jira/rest/api/2/issue/12990701","key":"MAPREDUCE-6735","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-07-19T14:16:48.209+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 20 16:25:19 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6735/watchers","watchCount":10,"isWatching":false},"created":"2016-07-19T09:03:35.726+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12475399","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12475399","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12839261","key":"HADOOP-12107","self":"https://issues.apache.org/jira/rest/api/2/issue/12839261","fields":{"summary":"long running apps may have a huge number of StatisticsData instances under FileSystem","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12475400","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12475400","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12635029","key":"MAPREDUCE-5465","self":"https://issues.apache.org/jira/rest/api/2/issue/12635029","fields":{"summary":"Tasks are often killed before they exit on their own","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-07-20T16:25:19.974+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"Two commits, MAPREDUCE-5465 and HADOOP-12107 are making Terasort on YARN 10% slower.\n\nReduce phase with those commits ~5 mins\nReduce phase without ~3.5 mins\n\nAverage Reduce is taking 4mins, 16sec with those commits compared to 3mins, 48sec without.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Performance degradation caused by MAPREDUCE-5465 and HADOOP-12107","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexbalitsky","name":"alexbalitsky","key":"alexbalitsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexandr Balitsky","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexbalitsky","name":"alexbalitsky","key":"alexbalitsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexandr Balitsky","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990701/comment/15384200","id":"15384200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Thanks for the report, Alexandr!\n\nMAPREDUCE-5465 would be expected to make things slightly slower, since the whole point of that JIRA is to let tasks finish on their own rather than proactively killing them.  Before that change the AM was trying to kill tasks as soon as they said they were done, and that was causing problems when the task had things to do afterwards like dumping JVM stats for performance or profiling.  Letting the tasks complete on their own means it will take a little longer sometimes for the container to complete, and that prevents another task from using the cluster resources associated with that container.  Essentially the change was a tradeoff of performance for correctness -- we were running \"too fast\" sometimes. ;-)\n\nDo you have any details on how HADOOP-12107 is impacting things?  If you just put that one in on its own, do you see a similar impact?  Also note that HADOOP-12107 has a very important followup fix at HADOOP-12706.  It would be interesting to know if HADOOP-12107 really does impact on its own whether adding HADOOP-12706 changes that in any way.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-07-19T14:16:48.209+0000","updated":"2016-07-19T14:16:48.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990701/comment/15384265","id":"15384265","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexbalitsky","name":"alexbalitsky","key":"alexbalitsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexandr Balitsky","active":true,"timeZone":"Etc/UTC"},"body":"Unfortunately, I don't know how HADOOP-12107 is impacting things, but there is ~1min increase coming from commit HADOOP-12107.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexbalitsky","name":"alexbalitsky","key":"alexbalitsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexandr Balitsky","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-19T14:47:35.010+0000","updated":"2016-07-19T14:47:35.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990701/comment/15384286","id":"15384286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"What happens when HADOOP-12107 and HADOOP_12706 are pulled in together?  We did see some cases where the former without the latter was causing some extra GC overhead, although I'd be a bit surprised it would be significant in a terasort test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-07-19T14:56:50.864+0000","updated":"2016-07-19T14:56:50.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990701/comment/15384298","id":"15384298","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Oops I apologize, I'm referencing the wrong JIRA.  HADOOP-12958 is the one that fixed the phantom references in HADOOP-12107, not HADOOP-12706.  So everywhere above that I've been calling out HADOOP-12706 I really meant HADOOP-12958.  That's the JIRA that changed the PhantomReferences introduced in HADOOP-12107 into weak references, and that ended up being a significant fix for container reuse in Tez.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-07-19T15:00:45.403+0000","updated":"2016-07-19T15:00:45.403+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990701/comment/15384344","id":"15384344","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexbalitsky","name":"alexbalitsky","key":"alexbalitsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexandr Balitsky","active":true,"timeZone":"Etc/UTC"},"body":"Yes, but when applying HADOOP-12107 and tickets that are broken by HADOOP-12107 (i.e. HADOOP-12706, HADOOP-12958) the performance degradation happens too in the same ratio. So even when HADOOP-12958 is applied it does not fix performance degradation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexbalitsky","name":"alexbalitsky","key":"alexbalitsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexandr Balitsky","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-19T15:23:02.803+0000","updated":"2016-07-19T15:23:02.803+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990701/comment/15384866","id":"15384866","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"It is certainly surprising that HADOOP-12107 is making a difference on terasort. What version of hadoop are you using for your test? Java version? Is it repeatable (i.e. the gap shows up consistently)?\n\nFYI, the nature of HADOOP-12107 has to do with *when* to clean up a certain data ( {{allData}} ) inside the {{FileSystem.Statistics}} objects. Before this change, it would get cleaned up when the owner thread gets garbage collected *and* a read operation is done on the {{Statistics}} object. By read operations I mean methods such as {{getBytesRead()}} and so on.\n\nAfter this change, the timing of this clean-up no longer depends on the read operations, and it will be done promptly when the thread is garbage collected. So in a sense, the change first ensures there is clean-up no matter what, and also moves up the timing of the clean-up.\n\nThe worst-case scenario in which this can have a negative impact on performance is if the use case *never* reads the statistics. Prior to the change, as long as the heap can contain these objects, no clean-up will be done. With the change now we do perform additional clean-up on threads garbage collection.\n\nA subsequent observation is that the impact of the clean-up is greater if there is a *high degree of thread churn* within the JVM. If we're talking about only a handful of threads or long-lived threads, there should really be no difference.\n\nI would greatly appreciate it if you could dig a little deeper via logging or low overhead profiling to pinpoint the correlation. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-19T21:13:23.308+0000","updated":"2016-07-19T21:13:23.308+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990701/comment/15386142","id":"15386142","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"It would also be good to know more details on the baseline being used when these commits are added/removed so we know what other changes are present/absent.  Is this a 2.8 baseline with reverts on these two commits or something else?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-07-20T16:25:19.974+0000","updated":"2016-07-20T16:25:19.974+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6735/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i316tr:"}}