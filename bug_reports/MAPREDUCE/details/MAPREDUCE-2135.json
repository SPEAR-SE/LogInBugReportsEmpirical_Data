{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12477334","self":"https://issues.apache.org/jira/rest/api/2/issue/12477334","key":"MAPREDUCE-2135","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2010-10-21T17:44:09.879+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 26 07:51:48 UTC 2010","customfield_12310420":"150014","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-2135/watchers","watchCount":3,"isWatching":false},"created":"2010-10-14T09:20:56.095+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-10-26T07:51:48.646+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312920","id":"12312920","name":"task","description":"The code that runs in the child task process."}],"timeoriginalestimate":null,"description":"With MapReduce trunk,\n The FileSystem counter FILE_BYTES_WRITTEN is a lot less than \"Map output bytes\" counter even when map output compression is OFF. I think this FILE_BYTES_WRITTEN signifies the bytes written to local file system. So it should be more than map output bytes(in the counters shown below, 210 Vs 19200000). Right ?\n\nHere are some counters from map task of wordcount example:\n\n\nCounters for attempt_201010141448_0001_m_000000_0\n\nFileInputFormatCounters\n\tBYTES_READ \t9,600,000\n\nFileSystemCounters\n\tFILE_BYTES_READ \t92\n\tFILE_BYTES_WRITTEN \t210\n\tHDFS_BYTES_READ \t9,600,107\n\nMap-Reduce Framework\n\tCombine input records \t2,400,000\n\tCombine output records \t8\n\tCPU_MILLISECONDS \t4,810\n\tFailed Shuffles \t0\n\tGC time elapsed (ms) \t73\n\tMap input records \t600,000\n\tMap output bytes \t19,200,000\n\tMap output records \t2,400,000\n\tMerged Map outputs \t0\n\tPHYSICAL_MEMORY_BYTES \t131,518,464\n\tSpilled Records \t16\n\tSPLIT_RAW_BYTES \t107\n\tVIRTUAL_MEMORY_BYTES \t581,021,696","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"81051","customfield_12312823":null,"summary":"Need a counter for map task output file size","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477334/comment/12923383","id":"12923383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"body":"Ah! I see that the map output bytes and map output records shown are the counters that represent the values before the combiner. Combine input records and Combine output records are shown in the counters.\nMay be it would be better to have counter for combine output bytes also, because that is the size of the intermediate file generated by map task ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-21T09:37:58.236+0000","updated":"2010-10-21T09:37:58.236+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477334/comment/12923543","id":"12923543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"FILE_BYTES_WRITTEN is correct then. Combiner output bytes would be nice if we have code paths that make it different from FILE_BYTES_WRITTEN. Before that the counter would be redundant.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-10-21T17:44:09.879+0000","updated":"2010-10-21T17:44:09.879+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477334/comment/12923762","id":"12923762","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"body":"In map task, if multiple spills happen and multiple merges happen on those spills, then the FILE_BYTES_WRITTEN will include all those records again and again. No ?\n\nSo the actual map task's output file(i.e. the intermediate file) content could be of size (FILE_BYTES_WRITTEN - SpilledRecords) bytes ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-22T05:39:47.051+0000","updated":"2010-10-22T05:39:47.051+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477334/comment/12923767","id":"12923767","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"body":"Ah! Thats wrong. Since SpilledRecords counter gives number of records(and not bytes), it is not just difference of FILE_BYTES_WRITTEN and SpilledRecords.\nSince we don't have the number of bytes written during spills(i.e. the bytes corresponding to SpilledRecords), it seems difficult to get the actual mapoutputFileSize from the existing counters. Right ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-22T06:07:01.567+0000","updated":"2010-10-22T06:07:01.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477334/comment/12923807","id":"12923807","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"body":"Updated Title/Summary to reflect the actual issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-22T09:41:05.721+0000","updated":"2010-10-22T09:41:05.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477334/comment/12924873","id":"12924873","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"body":"Ravi,\nShouldn't _'Combine output records'_ counter value correspond to _HDFS_BYTES_WRITTEN_ counter value (num-reducers == 0) or _FILE_BYTES_WRITTEN_  counter value (num-reducers > 0). So from your example, 210 bytes written via 8 records. Can you kindly check if the spill logic directly uses _File_ objects instead of using _LocalFileSystem_? If the spill logic uses _File_ objects, then multiple spills shouldn't affect the final bytes written, right?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-26T07:25:50.371+0000","updated":"2010-10-26T07:25:50.371+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477334/comment/12924880","id":"12924880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"body":"Unfortunately, spill file is created using FileSystemObject.create() method. So spills are contributing to File_BYTES_WRITTEN counter.\n\nHere are the counters of map task of wordcount example for the same input data(1 map task, 1 reduce task in both jobs) with 2 different values of io.sort.mb:\n\n(1) io.sort.mb=50\n\nFileSystemCounters\n\tFILE_BYTES_READ \t39,268,167\n\tFILE_BYTES_WRITTEN \t78,536,360\n\tHDFS_BYTES_READ \t20,971,627\n\nMap-Reduce Framework\n\tCombine input records \t402,994\n\tCombine output records \t383,997\n\tCPU_MILLISECONDS \t7,190\n\tFailed Shuffles \t0\n\tGC time elapsed (ms) \t62\n\tMap input records \t163,676\n\tMap output bytes \t38,559,489\n\tMap output records \t402,994\n\tMerged Map outputs \t0\n\tPHYSICAL_MEMORY_BYTES \t123,650,048\n\tSpilled Records \t767,994\n\tSPLIT_RAW_BYTES \t107\n\tVIRTUAL_MEMORY_BYTES \t582,451,200\n\n(2) io.sort.mb=1\n\nFileSystemCounters\n\tFILE_BYTES_READ \t75,090,212\n\tFILE_BYTES_WRITTEN \t114,350,720\n\tHDFS_BYTES_READ \t20,971,627\n\nMap-Reduce Framework\n\tCombine input records \t796,792\n\tCombine output records \t777,203\n\tCPU_MILLISECONDS \t9,990\n\tFailed Shuffles \t0\n\tGC time elapsed (ms) \t72\n\tMap input records \t163,676\n\tMap output bytes \t38,559,489\n\tMap output records \t402,994\n\tMerged Map outputs \t0\n\tPHYSICAL_MEMORY_BYTES \t76,664,832\n\tSpilled Records \t1,134,831\n\tSPLIT_RAW_BYTES \t107\n\tVIRTUAL_MEMORY_BYTES \t595,406,848\n\nIt seems combiner also gets called many times when multiple merges happen. So combine output records is also not the correct value of map-task-output-records.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravidotg","name":"ravidotg","key":"ravidotg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Gummadi","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-26T07:51:48.545+0000","updated":"2010-10-26T07:51:48.545+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-2135/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0e7yf:"}}