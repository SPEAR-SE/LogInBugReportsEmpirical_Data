{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12825630","self":"https://issues.apache.org/jira/rest/api/2/issue/12825630","key":"MAPREDUCE-6344","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-04-28T21:20:13.903+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Nov 17 22:38:14 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6344/watchers","watchCount":11,"isWatching":false},"created":"2015-04-28T18:51:16.949+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326265","id":"12326265","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12327180","id":"12327180","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12327586","id":"12327586","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12327747","id":"12327747","description":"2.5.1 release","name":"2.5.1","archived":false,"released":true,"releaseDate":"2014-09-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12328971","id":"12328971","description":"2.5.2 release","name":"2.5.2","archived":false,"released":true,"releaseDate":"2014-11-19"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-11-17T22:38:14.590+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[],"timeoriginalestimate":null,"description":"We recently upgraded to MRv2 on YARN and have been noticing very inconsistent classloading between the job submission client and the tasks as they start up. \n\nI've tracked the issue to this method:\n\nhttps://github.com/apache/hadoop/blob/release-2.5.0/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common/src/main/java/org/apache/hadoop/mapreduce/v2/util/MRApps.java#L264\n\nIt appears that the classpath is simply \"wild carded\".  According the javase 7&8 docs, the order of enumeration is not specified and may differ from moment to moment [1][2].  This is a problem for applications that rely on strict ordering, which the MRv1 DistributedCache used to provide.\n\nI'm unable to track down all the things that are linked or landed into the $PWD of the container, but assuming we can't account for all these things, a simple solution could be to explicitly enumerate the files in DistributedCache - similar to the \"non jar\" case [3] - and then add the \"*\" for passivity.  \n\n[1] http://docs.oracle.com/javase/7/docs/technotes/tools/windows/classpath.htm\n[2] http://docs.oracle.com/javase/8/docs/technotes/tools/windows/classpath.html#A1100762\n[3] https://github.com/apache/hadoop/blob/release-2.5.0/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common/src/main/java/org/apache/hadoop/mapreduce/v2/util/MRApps.java#L270\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12755762","id":"12755762","filename":"MAPREDUCE-6344.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pk020157","name":"pk020157","key":"pk020157","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Preston Koprivica","active":true,"timeZone":"America/Chicago"},"created":"2015-09-14T16:05:48.441+0000","size":5696,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12755762/MAPREDUCE-6344.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Inconsistent classpath/classloading from DistributedCache archives","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pk020157","name":"pk020157","key":"pk020157","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Preston Koprivica","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pk020157","name":"pk020157","key":"pk020157","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Preston Koprivica","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12825630/comment/14518092","id":"14518092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"I understand this is a change of behavior from MRv1, but I'm not convinced that this is a bug. As you noted, java makes no promise with regards to the order of enumeration. Furthermore, if your code depends on the ordering of jars, I would definitely consider that a bug. It implies there are multiple copies of the same class sitting in your classpath, and relying on the ordering to get it right is futile.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-28T21:20:13.903+0000","updated":"2015-04-28T21:20:13.903+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12825630/comment/14518200","id":"14518200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pk020157","name":"pk020157","key":"pk020157","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Preston Koprivica","active":true,"timeZone":"America/Chicago"},"body":"I'm absolutely fine demoting this to an improvement - I'll defer to the experts what they think the severity and type of issue this is.  \n\nHowever, I do think that determinism is important in this instance and should warrant at least a minor change.  In general, I agree that we should not be packaging the same class multiple times, but I disagree that the effort of ordering is futile.  In fact, hadoop does this quite often - and it even allows users to inject new ordering when they desire (think:  MRJobConfig.MAPREDUCE_JOB_USER_CLASSPATH_FIRST).\n\nCorrect me if I'm wrong, but it appears that ordering is already preserved with \"non jar\" files.  This would just be asking that ordering is also preserved for *all* files in DistributedCache and not just \"non jars\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pk020157","name":"pk020157","key":"pk020157","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Preston Koprivica","active":true,"timeZone":"America/Chicago"},"created":"2015-04-28T22:10:07.070+0000","updated":"2015-04-28T22:10:07.070+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12825630/comment/14743738","id":"14743738","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pk020157","name":"pk020157","key":"pk020157","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Preston Koprivica","active":true,"timeZone":"America/Chicago"},"body":"I have attached a proposed fix for this issue.   The basic approach was to: \n\n* Modify the addToClassPathIfNotJar method to simply be: addToClassPath.  This should retain the order of both archives and non-archives when pulling from distributed cache.\n\n* Moved the \"glob\" to be the last thing appended to the appended to the classpath.  (This is only needed to ensure a non-breaking change.  This will catch anything that was put in the container but not explicitly enumerated).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pk020157","name":"pk020157","key":"pk020157","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Preston Koprivica","active":true,"timeZone":"America/Chicago"},"created":"2015-09-14T16:05:48.449+0000","updated":"2015-09-14T16:05:48.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12825630/comment/14743809","id":"14743809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pk020157","name":"pk020157","key":"pk020157","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Preston Koprivica","active":true,"timeZone":"America/Chicago"},"body":"Just an FYI, the patch was created off the release-2.5.0 branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pk020157","name":"pk020157","key":"pk020157","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Preston Koprivica","active":true,"timeZone":"America/Chicago"},"created":"2015-09-14T16:53:52.932+0000","updated":"2015-09-14T16:53:52.932+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12825630/comment/15002554","id":"15002554","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"To get attention for your patch, you have to click the \"Patch Submitted\" button.  I'll go do that for you now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-12T18:10:59.361+0000","updated":"2015-11-12T18:10:59.361+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12825630/comment/15009742","id":"15009742","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"[~pk020157], in the comment explaining what you're doing, let's leave the JIRA line out of it.  Folks can get that from git if they want to know.  Other than that, it looks good to me.  I haven't done any testing, however.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-17T22:38:14.590+0000","updated":"2015-11-17T22:38:14.590+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6344/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2e10v:"}}