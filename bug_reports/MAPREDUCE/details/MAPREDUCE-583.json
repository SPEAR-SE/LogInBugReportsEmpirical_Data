{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12393222","self":"https://issues.apache.org/jira/rest/api/2/issue/12393222","key":"MAPREDUCE-583","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2008-04-07T16:28:42.035+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 06 11:17:28 UTC 2010","customfield_12310420":"148912","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_71029976872_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-07-06T11:17:28.393+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-583/watchers","watchCount":2,"isWatching":false},"created":"2008-04-05T08:44:31.521+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-07-06T11:17:28.307+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312905","id":"12312905","name":"contrib/streaming"}],"timeoriginalestimate":null,"description":"there's a flush on the buffered output streams in mapper/reducer for every row of data.\n\n      // 2/4 Hadoop to Tool                                                                                                                   \n      if (numExceptions_ == 0) {\n        if (!this.ignoreKey) {\n          write(key);\n          clientOut_.write('\\t');\n        }\n        write(value);\n        if(!this.skipNewline) {\n            clientOut_.write('\\n');\n        }\n        clientOut_.flush();\n      } else {\n        numRecSkipped_++;\n      }\n\ntried to measure impact of removing this. number of context switches reported by vmstat shows marked decline. \n\nwith flush (10 second intervals):\n r  b   swpd   free   buff  cache   si   so    bi    bo   in    cs us sy id wa\n 4  2    784  23140  83352 3114648    0    0  4819 32397 1175 13220 59 11 13 17\n 1  2    784 129724  80704 3075696    0    0  4614 27196 1156 14797 49 11 19 21\n 4  0    784  24160  83440 3174880    0    0    96 36070 1337 10976 67 11  9 12\n 5  0    784 155872  84400 3158840    0    0   125 44084 1280 11044 68 14 10  8\n 2  1    784 365128  87048 2892032    0    0   119 38472 1317 11610 69 14 10  7\n\nwithout flush:\n 5  0    784  24652  56056 3217864    0    0   310 29499 1379  7603 76  9  7  8\n 5  3    784 118456  54568 3209992    0    0  3249 33426 1173  6828 63 11 12 14\n 0  2    784 227628  54820 3198560    0    0  7840 30063 1146  8899 60 10 15 15\n 3  1    784  25608  55048 3313512    0    0  3251 36276 1194  7915 60 10 15 15\n 1  2    784 197324  49968 3194572    0    0  4714 35479 1281  8204 62 13 12 13\n\ncs goes down by about 20-30%. but having trouble measuring overall speed improvement (too many variables due to spec. execution etc. - need better benchmark).\n\ncan't hurt.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"107858","customfield_12312823":null,"summary":"get rid of excessive flushes from PipeMapper/Reducer","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393222/comment/12586457","id":"12586457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"body":"I think the purpose of these flushes is to signal activity to the parent process, so that the streaming task is not killed for inactivity.  Removing the flushes, while more efficient, changes this contract.  Perhaps we need something like a timer-based flush running in a separate thread?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-04-07T16:28:42.035+0000","updated":"2008-04-07T16:28:42.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393222/comment/12586493","id":"12586493","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"body":"sorry - don't understand.\n\nthe Pipe mapper and the reducer classes are consuming data -isn't that signal enough to the trackers that the task is making progress?\n\nif the data is buffered - it seems that the worst that can happen is that script output is delayed - but this seems a common pattern anyway - since reduce scripts will frequently consume huge-amounts/all of data before emitting anything.\n\ni have checked in a patch to our local production environment to see if we observe any weirdness ..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-04-07T18:45:28.676+0000","updated":"2008-04-07T18:45:28.676+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393222/comment/12586511","id":"12586511","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"body":"> mapper and the reducer classes are consuming data -isn't that signal enough [...]?\n\nWe currently count both consumption and generation of data as activity.  Some mappers might, e.g., take lists of file names, and not consume new input lines very often.  Noticing progress on output is important for some applications.\n\nI'm not arguing that this is the only or even the ideal way to handle progress notification for streaming, but rather that it is the way that things currently work, and that simply eliminating these flushes has the potential to break applications which rely on them for prompt progress reports.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-04-07T19:42:41.450+0000","updated":"2008-04-07T19:42:41.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393222/comment/12586532","id":"12586532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"body":"understood. we can make the flush timer driven as suggested.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-04-07T20:58:45.319+0000","updated":"2008-04-07T20:58:45.319+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393222/comment/12587084","id":"12587084","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"body":"Actually, there were so many problems with tracking progress on streaming that it was disabled by default. \n\n{code}\n    // All streaming jobs have, by default, no time-out for tasks\n    jobConf_.setLong(\"mapred.task.timeout\", 0);\n{code}\n\nI think it is ok to remove the flushes. The only downside that I can see is if you have your input format doing slow low-volumne fetching, you'll increase the latency of the map.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-04-09T08:05:56.564+0000","updated":"2008-04-09T08:05:56.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393222/comment/12587267","id":"12587267","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rickcox","name":"rickcox","key":"rickcox","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Cox","active":true,"timeZone":"Etc/UTC"},"body":"Task timeouts and progress reporting do function correctly in current releases of streaming, so, while the scenarios where these flushes are necessary seem a bit far fetched (some kind of low but non-zero rate input), that doesn't mean nobody is depending on them.\n\nFor jobs with task timeouts enabled, it seems reasonable to promise a flush at least every {{mapred.task.timeout/2}} interval.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rickcox","name":"rickcox","key":"rickcox","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Cox","active":true,"timeZone":"Etc/UTC"},"created":"2008-04-09T17:00:06.223+0000","updated":"2008-04-09T17:00:06.223+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393222/comment/12885500","id":"12885500","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Fixed by HADOOP-3429","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-07-06T11:17:28.270+0000","updated":"2010-07-06T11:17:28.270+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-583/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0iten:"}}