{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12458005","self":"https://issues.apache.org/jira/rest/api/2/issue/12458005","key":"MAPREDUCE-1555","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2010-03-03T17:40:08.120+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Apr 05 06:15:55 UTC 2010","customfield_12310420":"149596","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-1555/watchers","watchCount":5,"isWatching":false},"created":"2010-03-03T17:18:56.377+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-04-15T07:36:32.563+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312920","id":"12312920","name":"task","description":"The code that runs in the child task process."}],"timeoriginalestimate":null,"description":"Maybe some code of MapTask is wrong.\n\n{code:title=MapTask.java|borderStyle=solid}\n\n  public void write(DataOutput out) throws IOException {\n    super.write(out);\n    if (isMapOrReduce()) {\n      splitMetaInfo.write(out);\n      splitMetaInfo = null;  // HERE:  why set null ??????\n    }\n  }\n\n{code} \n\nIn above code, if the splitMetaInfo is set null, Second Serialization (will invoke write) will throw NullPointerException. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"81241","customfield_12312823":null,"summary":"tasktracker heartbeat hang","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458005/comment/12840751","id":"12840751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"Ruyue - this is poorly documented, but mostly right. If I remember right, this was done so that the MapTask object in JobTracker doesn't have a reference to the input-split. This will not cause a problem because a single MapTask object on the JobTracker is never re-used i.e. a new one is created, serialized to the TaskTracker during scheduling and it's splitMetaInfo is never needed again.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-03T17:40:08.120+0000","updated":"2010-03-03T17:40:08.120+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458005/comment/12840992","id":"12840992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"body":"1.  The NullPointerException is throwed in our cluster. It causes the hang of tasktracker's heartbeat.\n\n2. If the HeartbeatResponse is not sent successfully,  it will resend in the next heartbeat. The MapTask is not recreated. It uses the old MapTask object.  The code is: \n\n{code:title=JobTracker.java|borderStyle=solid}\n  public synchronized HeartbeatResponse heartbeat(TaskTrackerStatus status, \n                                                  boolean restarted,\n                                                  boolean initialContact,\n                                                  boolean acceptNewTasks, \n                                                  short responseId) \n    throws IOException {\n    if (LOG.isDebugEnabled()) {\n      LOG.debug(\"Got heartbeat from: \" + status.getTrackerName() + \n                \" (restarted: \" + restarted + \n                \" initialContact: \" + initialContact + \n                \" acceptNewTasks: \" + acceptNewTasks + \")\" +\n                \" with responseId: \" + responseId);\n    }\n\n    // Make sure heartbeat is from a tasktracker allowed by the jobtracker.\n    if (!acceptTaskTracker(status)) {\n      throw new DisallowedTaskTrackerException(status);\n    }\n\n    // First check if the last heartbeat response got through\n    String trackerName = status.getTrackerName();\n    long now = clock.getTime();\n    boolean isBlacklisted = false;\n    if (restarted) {\n      faultyTrackers.markTrackerHealthy(status.getHost());\n    } else {\n      isBlacklisted = \n        faultyTrackers.shouldAssignTasksToTracker(status.getHost(), now);\n    }\n    \n    HeartbeatResponse prevHeartbeatResponse =\n      trackerToHeartbeatResponseMap.get(trackerName);\n\n    if (initialContact != true) {\n      // If this isn't the 'initial contact' from the tasktracker,\n      // there is something seriously wrong if the JobTracker has\n      // no record of the 'previous heartbeat'; if so, ask the \n      // tasktracker to re-initialize itself.\n      if (prevHeartbeatResponse == null) {\n        // This is the first heartbeat from the old tracker to the newly \n        // started JobTracker\n        \n        // Jobtracker might have restarted but no recovery is needed\n        // otherwise this code should not be reached\n        LOG.warn(\"Serious problem, cannot find record of 'previous' \" +\n                 \"heartbeat for '\" + trackerName + \n                 \"'; reinitializing the tasktracker\");\n        return new HeartbeatResponse(responseId, \n            new TaskTrackerAction[] {new ReinitTrackerAction()});\n      \n      } else {\n                \n        // It is completely safe to not process a 'duplicate' heartbeat from a \n        // {@link TaskTracker} since it resends the heartbeat when rpcs are \n        // lost see {@link TaskTracker.transmitHeartbeat()};\n        // acknowledge it by re-sending the previous response to let the \n        // {@link TaskTracker} go forward. \n        if (prevHeartbeatResponse.getResponseId() != responseId) {\n          LOG.info(\"Ignoring 'duplicate' heartbeat from '\" + \n              trackerName + \"'; resending the previous 'lost' response\");\n          return prevHeartbeatResponse;                   // HERE !!!!!!!!!!!!!!!!!\n        }\n      }\n    }\n\n{code} ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-04T01:45:57.514+0000","updated":"2010-03-04T01:45:57.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458005/comment/12840995","id":"12840995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"body":"@ Arun C Murthy: so that MapTask object in JobTracker doesn't have a reference to the input-split.\n\nWhy? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-04T01:49:51.399+0000","updated":"2010-03-04T01:49:51.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458005/comment/12850797","id":"12850797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"body":"After resolving this bug, our cluster is stable. The hang of tasktracker's heartbeat hasn't been found.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-29T06:18:33.444+0000","updated":"2010-03-29T06:18:33.444+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458005/comment/12852770","id":"12852770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"body":"To: Arun C Murthy \n\nWho will give me an explanation?  This bug will often cause tasktracker hang. If I comment \"splitMetaInfo = null; \", anything will be ok.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-02T09:45:34.940+0000","updated":"2010-04-02T09:45:34.940+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458005/comment/12853314","id":"12853314","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"bq. so that MapTask object in JobTracker doesn't have a reference to the input-split. Why? \n\nThis is to save memory on JobTracker. We have seen scenarios where the input split size so huge which causes OOM on JT.  See HADOOP-3670\n\nIf we have to remove the nullification in serialization to avoid NPE, we should nullify the splitMetaInfo either after the task completion or after the first update from the map task.\nThoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-04-05T05:55:28.328+0000","updated":"2010-04-05T05:55:28.328+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458005/comment/12853315","id":"12853315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"body":"To: Amareshwari Sriramadasu \n\nOur solution is the same with yours.\n\nWe nullify the splitMetaInfo until we ensure that the HeartbeatResponse is not re-sent.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mry.maillist","name":"mry.maillist","key":"mry.maillist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruyue Ma","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-05T06:03:59.252+0000","updated":"2010-04-05T06:03:59.252+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458005/comment/12853319","id":"12853319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"bq. We nullify the splitMetaInfo until we ensure that the HeartbeatResponse is not re-sent.\nGreat! Can you please upload the patch here so that it can be part apache source?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-04-05T06:15:55.665+0000","updated":"2010-04-05T06:15:55.665+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-1555/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0e94n:"}}