{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12519430","self":"https://issues.apache.org/jira/rest/api/2/issue/12519430","key":"MAPREDUCE-2862","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2011-08-19T18:09:18.750+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Dec 23 17:37:50 UTC 2011","customfield_12310420":"64181","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-2862/watchers","watchCount":5,"isWatching":false},"created":"2011-08-19T16:55:45.783+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-23T17:37:50.350+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"Hi, we met the infinite loop on CombineFileInputFormat#getMoreSplits().\n\nAt first, we lost some blocks by mis-operation :-(. Then, one job tried to use these missing blocks. At that time getMoreSplits() goes into the infinite loop.\n\nFrom our investigation, this List could be an empty array.\n> https://github.com/apache/hadoop-mapreduce/blob/trunk/src/java/org/apache/hadoop/mapreduce/lib/input/CombineFileInputFormat.java#L363\n\nThen 'for' loop just after that line does nothing, and entry is not removed from 'blockToNodes'.\n\nFinally this line goes into the infinite loop.\n> https://github.com/apache/hadoop-mapreduce/blob/trunk/src/java/org/apache/hadoop/mapreduce/lib/input/CombineFileInputFormat.java#L348\n\nWe're now creating the patch against this problem...","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12490975","id":"12490975","filename":"MAPREDUCE-2862-warn-and-ignore-corrupted-blocks.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frsyuki","name":"frsyuki","key":"frsyuki","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sadayuki Furuhashi","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-19T18:09:18.692+0000","size":2115,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12490975/MAPREDUCE-2862-warn-and-ignore-corrupted-blocks.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"80904","customfield_12312823":null,"summary":"Infinite loop in CombineFileInputFormat#getMoreSplits(), with missing blocks","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzk","name":"kzk","key":"kzk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kazuki Ohta","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzk","name":"kzk","key":"kzk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kazuki Ohta","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519430/comment/13087814","id":"13087814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzk","name":"kzk","key":"kzk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kazuki Ohta","active":true,"timeZone":"Etc/UTC"},"body":"Would be some options...\n\n* cause an error\n* add option to ignore these errors (log missing blocks in Warning level)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzk","name":"kzk","key":"kzk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kazuki Ohta","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-19T17:28:12.086+0000","updated":"2011-08-19T17:28:12.086+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519430/comment/13087843","id":"13087843","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frsyuki","name":"frsyuki","key":"frsyuki","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sadayuki Furuhashi","active":true,"timeZone":"Etc/UTC"},"body":"Breaks infinite loop in CombineFileInputFormat.getMoreSplits by ignoring corrupted blocks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frsyuki","name":"frsyuki","key":"frsyuki","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sadayuki Furuhashi","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-19T18:09:18.750+0000","updated":"2011-08-19T18:09:18.750+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519430/comment/13087844","id":"13087844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frsyuki","name":"frsyuki","key":"frsyuki","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sadayuki Furuhashi","active":true,"timeZone":"Etc/UTC"},"body":"I attached a patch for the git HEAD. It shows error messages and ignores corrupted blocks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frsyuki","name":"frsyuki","key":"frsyuki","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sadayuki Furuhashi","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-19T18:09:48.046+0000","updated":"2011-08-19T18:09:48.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519430/comment/13088022","id":"13088022","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Hey Sadayuki. Good to see you here on JIRA :) I think the patch you've attached is against the 0.20 branch. Can you please provide a patch against trunk as well? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2011-08-19T22:19:48.047+0000","updated":"2011-08-19T22:19:48.047+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519430/comment/13088783","id":"13088783","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Sadayuki, thank you for submitting a patch on this.  I've been bitten by this one too.\n\nThis patch would log warnings about \"corrupted files\".  Is it really true that this indicates corruption?  My experience has been that I've seen this happen when CombineFileInputFormat tries to read newly written files that have not yet had their first block flushed.  This isn't really corruption, so I'm wondering if logging warnings about corrupt files would give a user the wrong impression that the cluster is suffering from corruption.\n\nTo workaround this, I've been running my jobs with a private patch of CombineFileInputFormat that adds this to the constructor for OneFileInfo:\n\n    // Bail out if the block has no locations.  This guards against an\n    // infinite loop in getMoreSplits.  This change is not present in open\n    // source Hadoop.\n    if (oneblock.length <= 0)\n      continue;\n\nThat prevents these blocks from ever entering the getMoreSplits logic in the first place.  If you're interested in that approach instead, let me know, and I'll put the patch together.  I'd still need to add a unit test for it too.\n\nThanks again,\n--Chris\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-22T16:01:03.012+0000","updated":"2011-08-22T16:01:03.012+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519430/comment/13175513","id":"13175513","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"body":"@Kazuki\nAre you hitting to same problem as MAPREDUCE-2185?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subrotosanyal","name":"subrotosanyal","key":"subrotosanyal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Subroto Sanyal","active":true,"timeZone":"Europe/Berlin"},"created":"2011-12-23T17:37:50.323+0000","updated":"2011-12-23T17:37:50.323+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-2862/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0e71r:"}}