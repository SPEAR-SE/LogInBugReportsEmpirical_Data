{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12862292","self":"https://issues.apache.org/jira/rest/api/2/issue/12862292","key":"MAPREDUCE-6470","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310941","id":"12310941","key":"MAPREDUCE","name":"Hadoop Map/Reduce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310941&avatarId=10096","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310941&avatarId=10096","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310941&avatarId=10096","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310941&avatarId=10096"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-09-08T02:43:43.080+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 08 02:43:43 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6470/watchers","watchCount":6,"isWatching":false},"created":"2015-09-08T01:58:17.713+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331978","id":"12331978","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"issuelinks":[{"id":"12436722","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12436722","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12862297","key":"YARN-4125","self":"https://issues.apache.org/jira/rest/api/2/issue/12862297","fields":{"summary":"In addition to aggregate availability for an app, headroom should provide information on largest container that can be allcoated","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-09-08T02:49:41.554+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315625","id":"12315625","name":"applicationmaster"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12315340","id":"12315340","name":"resourcemanager"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12315345","id":"12315345","name":"scheduler"}],"timeoriginalestimate":null,"description":"In my hadoop cluster the nodemanagers have different resource capacity. \nRecently, when the yarn cluster ran out of resources and there are some big jobs running, the AM cannot preempt reduce task. \n\nThe scenario could be simplified as below:\nSay, there are 5 nodemanagers in my hadoop cluster with FairScheduler strategy enabled.\n\nNodeManager Capacity :\n\nnamenode1 <1024 memory, 1 cpu-vcores>\nnamenode1 <4096 memory, 1 cpu-vcores>\nnamenode1 <4096 memory, 1 cpu-vcores>\nnamenode1 <1024 memory, 4 cpu-vcores>\nnamenode1 <1024 memory, 4 cpu-vcores>\n\nStart one job including 10 maps and 10 reduces with following conf :\nyarn.app.mapreduce.am.resource.mb=1024m\nyarn.app.mapreduce.am.resource.cpu-vcores=1\nmapreduce.map.memory.mb=1024m\nmapreduce.reduce.memory.mb=1024m\nmapreduce.map.cpu.vcores=1\nmapreduce.reduce.cpu.vcores=1\n\nAfter some map tasks finished, 4 reduce tasks started, but there are still some map tasks in scheduledRequests.\nAt this time, the 5 nodemanagers resource usage is blow.\nNodeManager, Memory Used, Vcores Used, Memory Avail, Vcore Abail\nnamenode1,     1024m,          1,          0,           0\nnamenode2,     1024m,          1,          3072m,       0\nnamenode3,     1024m,          1,          3072m,       0\nnamenode4,     1024m,          1,          0,           3\nnamenode5,     1024m,          1,          0,           3\n\nSo AM try to start the rest map tasks.\n\nIn RMContainerAllocator the availableResources got from ApplicationMasterService is <6144m, 6 cpu-vcores>.\nThen RMContainerAllocator thinks there is enough resource to start one map task, so it will not try to preempt the reduce task. But in fact there isn't any single nodemanager has enough resource available to run one map task. In this case, AM will fail to obtain the container to start the rest map tasks. And since reduce tasks will not be preempted, the resource will never been released, then the job hangs forever.\n\nI think the problem is that the overall resource headroom is not enough to help AM made the right decision on whether to preempt the reduce task or not. We need to provide more information to AM, e.g. adds a new api in AllocateResponse to get available resource list on all nodemanagers. But this approaching might cost too much overhead. \n\nAny ideas?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ApplicationMaster may fail to preempt Reduce task","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iceberg565","name":"iceberg565","key":"iceberg565","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"NING DING","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iceberg565","name":"iceberg565","key":"iceberg565","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"NING DING","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12862292/comment/14734129","id":"14734129","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iceberg565","name":"iceberg565","key":"iceberg565","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"NING DING","active":true,"timeZone":"Asia/Shanghai"},"body":"[~kasha@cloudera.com] would you kindly help to take a look on this issue? ;)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iceberg565","name":"iceberg565","key":"iceberg565","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"NING DING","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-09-08T02:02:52.866+0000","updated":"2015-09-08T02:02:52.866+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12862292/comment/14734155","id":"14734155","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"Interesting issue. To summarize for others: the headroom is an aggregate across all nodes in the cluster, and provides no information about the largest container that can be allocated on the cluster. \n\nMAPREDUCE-6302 should address this issue reactively for MapReduce. However, there will be a delay which we should try and avoid. Let me create a Yarn JIRA to discuss/track inclusion of a new API.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-08T02:43:43.080+0000","updated":"2015-09-08T02:43:43.080+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAPREDUCE-6470/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2jv9z:"}}