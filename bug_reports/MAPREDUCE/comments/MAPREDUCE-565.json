[This patch pulls out the partitioner into the MapTask and splits on whether it is a new or old style Mapper. It also moves the test case over to a distributed test case so that it runs with 2 reduces and can detect this problem. 

We *really* need to fix local test runner to handle multiple reduces., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12407400/h5750.patch
  against trunk revision 772960.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/308/console

This message is automatically generated., +1 Patch looks good., Please update the patch to trunk., A simple git rebase fixed the patch. Git rocks. *smile*, Forgot the --no-prefix. *sigh*, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12408525/h5750.patch
  against trunk revision 777594.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/379/console

This message is automatically generated., Patch needs regenerating following the project split., Merged with trunk, {noformat}
     [exec] +1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 6 new or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec] 
     [exec]     +1 release audit.  The applied patch does not increase the total number of release audit warnings.
{noformat}, Last patch introduced javac warnings not caught by test-patch; this resolves them., Looking more closely at the patch, it shouldn't call the partitioner for map-only jobs., This uses a trivial Partitioner for map-only jobs. Verified no javac warnings

{noformat}
     [exec] +1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 6 new or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec] 
     [exec]     +1 release audit.  The applied patch does not increase the total number of release audit warnings.
{noformat}, All unit tests passed, save TestStreamingExitStatus, which is known-bad. MAPREDUCE-587, Added some documentation. No code changes., I committed this. Thanks, Owen!, Integrated in Hadoop-Mapreduce-trunk #23 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-Mapreduce-trunk/23/])
    . Fix partitioner to work with new API. Contributed by Owen O'Malley
]