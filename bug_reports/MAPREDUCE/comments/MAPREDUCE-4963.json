[The patch fixes the problem by keeping a separate counter for each set of buckets and checking the length of the buckets.  I also added a test that does something similar to the above example.  , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12566603/MAPREDUCE-4963.patch
  against trunk revision .

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3277//console

This message is automatically generated., +1, Thanks Robert. Committed to branch-1., Closed upon release of Hadoop 1.2.0.]