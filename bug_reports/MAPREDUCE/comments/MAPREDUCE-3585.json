[If the NMs have been configured to use static ports, we can store the lost NMs information by their NodeID and hence RM can detect the NM's comeback.
I *think* there should be a mechanism, even if the NMs have been configured to use ephemeral ports., What are your actual observations when you tried to restart an NM? Few bugs were fixed in the recent past that should have fixed this., Downgrading priority till we get more details., Marking this as a duplicate of MAPREDUCE-3363.  The core issue in both is that the RM is unable to differentiate between a new NM adding to the cluster and a lost NM rejoining the cluster when ephemeral ports are configured.
]