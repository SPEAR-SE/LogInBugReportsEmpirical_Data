[2009-09-15 06:50:41,794 WARN org.apache.hadoop.mapred.LinuxTaskController: Exit code from INITIALIZE_JOB is : 15
2009-09-15 06:50:41,796 WARN org.apache.hadoop.mapred.LinuxTaskController: Exception thrown by INITIALIZE_JOB : org.apache.hadoop.util.Shell$ExitCodeException:
        at org.apache.hadoop.util.Shell.runCommand(Shell.java:243)
        at org.apache.hadoop.util.Shell.run(Shell.java:170)
        at org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:363)
        at org.apache.hadoop.mapred.LinuxTaskController.runCommand(LinuxTaskController.java:169)
        at org.apache.hadoop.mapred.LinuxTaskController.initializeJob(LinuxTaskController.java:381)
        at org.apache.hadoop.mapred.TaskTracker.localizeJob(TaskTracker.java:855)
        at org.apache.hadoop.mapred.TaskTracker.startNewTask(TaskTracker.java:1828)
        at org.apache.hadoop.mapred.TaskTracker.access$1200(TaskTracker.java:102)
        at org.apache.hadoop.mapred.TaskTracker$TaskLauncher.run(TaskTracker.java:1793)

2009-09-15 06:50:41,796 INFO org.apache.hadoop.mapred.LinuxTaskController: Output from LinuxTaskController's INITIALIZE_JOB follows:
2009-09-15 06:50:41,796 INFO org.apache.hadoop.mapred.LinuxTaskController: main : command provided 1
2009-09-15 06:50:41,796 INFO org.apache.hadoop.mapred.LinuxTaskController: main : user is username
2009-09-15 06:50:41,796 INFO org.apache.hadoop.mapred.LinuxTaskController: Invalid file path. <job.xml> not user/group owned by the tasktracker.
2009-09-15 06:50:41,796 INFO org.apache.hadoop.mapred.LinuxTaskController: Failed to secure the job_dir <job-dir>
2009-09-15 06:50:41,796 WARN org.apache.hadoop.mapred.TaskTracker: Error initializing attempt_200909150645_0002_r_000008_1:
java.io.IOException: org.apache.hadoop.util.Shell$ExitCodeException:
        at org.apache.hadoop.mapred.LinuxTaskController.runCommand(LinuxTaskController.java:178)
        at org.apache.hadoop.mapred.LinuxTaskController.initializeJob(LinuxTaskController.java:381)
        at org.apache.hadoop.mapred.TaskTracker.localizeJob(TaskTracker.java:855)
        at org.apache.hadoop.mapred.TaskTracker.startNewTask(TaskTracker.java:1828)
        at org.apache.hadoop.mapred.TaskTracker.access$1200(TaskTracker.java:102)
        at org.apache.hadoop.mapred.TaskTracker$TaskLauncher.run(TaskTracker.java:1793)
Caused by: org.apache.hadoop.util.Shell$ExitCodeException:
        at org.apache.hadoop.util.Shell.runCommand(Shell.java:243)
        at org.apache.hadoop.util.Shell.run(Shell.java:170)
        at org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:363)
        at org.apache.hadoop.mapred.LinuxTaskController.runCommand(LinuxTaskController.java:169)
        ... 5 more

2009-09-15 06:50:41,797 INFO org.apache.hadoop.mapred.TaskTracker: addFreeSlot : current free slots : 2
2009-09-15 06:50:42,288 WARN org.mortbay.log: /tasklog: java.io.IOException: Closed
2009-09-15 06:50:42,291 WARN org.mortbay.log: /tasklog: java.io.IOException: Closed
2009-09-15 06:50:45,307 WARN org.mortbay.log: /tasklog: java.io.IOException: Closed
2009-09-15 06:50:45,309 WARN org.mortbay.log: /tasklog: java.io.IOException: Closed
2009-09-15 06:50:56,665 INFO org.apache.hadoop.mapred.TaskTracker: Received 'KillJobAction' for job: job_200909150645_0002
2009-09-15 06:50:56,665 INFO org.apache.hadoop.mapred.IndexCache: Map ID attempt_200909150645_0002_m_000016_1 not found in cache
2009-09-15 06:50:56,665 WARN org.apache.hadoop.mapred.TaskTracker: java.lang.NullPointerException
        at org.apache.hadoop.mapred.TaskTracker.purgeJob(TaskTracker.java:1508)
        at org.apache.hadoop.mapred.TaskTracker.access$100(TaskTracker.java:102)
        at org.apache.hadoop.mapred.TaskTracker$1.run(TaskTracker.java:349)
        at java.lang.Thread.run(Thread.java:619)



, This issue should not happen after MAPREDUCE-899. We should check it after MAPREDUCE-899 commit and close this one as duplicate., Whenever INITIALIZE_JOB fails, purgeJob would get NullPointerException in the following line:
{code}
          removeJobFiles(rjob.jobConf.getUser(), rjob.getJobID().toString());
{code}

So, the issue is not fixed by MAPREDUCE-899., Patch for review, Changed purgeJob to get the user from runningJob.ugi, instead of storing username separately in RunningJob as in earlier patch. I'm passing the ugi to RunningJob constructor itself, since creating it after copying the files (as in trunk) is too late.  , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12436552/patch-981-1.txt
  against trunk revision 912471.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 9 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    -1 contrib tests.  The patch failed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h6.grid.sp2.yahoo.net/473/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h6.grid.sp2.yahoo.net/473/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h6.grid.sp2.yahoo.net/473/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h6.grid.sp2.yahoo.net/473/console

This message is automatically generated., Few comments
1) Instead of adding UGI as a constructor parameter to RunningJob, why not do something like 
{code}
rJob = new RunningJob(jobId);
rjob.ugi = UserGroupInformation.createRemoteUser(tip.getTask().getUser());
{code}

2) It would be nice to have a getUser() method in RunningJob which might internally return 'getUGI().getShortUserName()'. Given a UGI, which username to use might be confusing.
3) Using UtilsForTests.InlineCleanupQueue, the wait for cleanup can be avoided., Patch updated to trunk and incorporating Amar's comments., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12438383/patch-981-2.txt
  against trunk revision 921230.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    -1 contrib tests.  The patch failed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h4.grid.sp2.yahoo.net/30/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h4.grid.sp2.yahoo.net/30/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h4.grid.sp2.yahoo.net/30/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h4.grid.sp2.yahoo.net/30/console

This message is automatically generated., bq. -1 contrib tests.
TestStreamingBadRecords failed because of ZipException. The same test passed on my machine., Patch updated to trunk, +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12443822/patch-981-3.txt
  against trunk revision 941564.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h4.grid.sp2.yahoo.net/171/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h4.grid.sp2.yahoo.net/171/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h4.grid.sp2.yahoo.net/171/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h4.grid.sp2.yahoo.net/171/console

This message is automatically generated., +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12443822/patch-981-3.txt
  against trunk revision 941564.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h6.grid.sp2.yahoo.net/534/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h6.grid.sp2.yahoo.net/534/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h6.grid.sp2.yahoo.net/534/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Mapreduce-Patch-h6.grid.sp2.yahoo.net/534/console

This message is automatically generated., The current patch is old and doesn't match.  Created a new patch (same code).  , Ant test and test-patch passed.

     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 6 new or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec] 
     [exec]     +1 release audit. The applied patch does not increase the total number of release audit warnings.
     [exec] 
     [exec]     +1 system test framework.  The patch passed system test framework compile.
, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12469242/patch-981-4.txt
  against trunk revision 1075216.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    -1 contrib tests.  The patch failed contrib unit tests.

    +1 system test framework.  The patch passed system test framework compile.

Test results: https://hudson.apache.org/hudson/job/PreCommit-MAPREDUCE-Build/96//testReport/
Findbugs warnings: https://hudson.apache.org/hudson/job/PreCommit-MAPREDUCE-Build/96//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://hudson.apache.org/hudson/job/PreCommit-MAPREDUCE-Build/96//console

This message is automatically generated., Sorry to come in late, the patch has gone stale. Can you please rebase? Thanks.

Given this is not an issue with MRv2 should we still commit this? I'm happy to, but not sure it's useful. Thanks.]