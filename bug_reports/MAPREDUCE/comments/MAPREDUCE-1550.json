[This fixes the problem. The problem is that, in a secure env, the FileSystem.get() would require user's credentials to talk to the NameNode if the get() was done within a UGI.doAs. Removing the doAs would mean that the JobTracker's credentials would be used which is the right thing to do since the JobHistory files are owned by the JobTracker anyway.., I should add that at the point where the ugi for the remote user is constructed, the JobTracker doesn't have the tokens to add to it. In contrast, during job submission (in the JobInProgress constructor), the remote user's credentials are available and the ugi created there is populated with it. That ugi is then used to talk to the namenode. , This patch fixes a bug to do with getting the right user for the authorization check., Fixes a bug in the earlier patch (assumes the earlier patch), This bug is there not on trunk but on the ydist branch for which patch was attached at MAPREDUCE-1455. Closing this as invalid., ugi.doAs() is there JSPUtil.getJobInfo() in current trunk also. So this fix needs to go into trunk also., Attaching patch for trunk.
 This is forward port of merge of 1550-2.patch and 1550-2.1.patch to trunk. A small change needed to TestJobRetire because JSPUtil.getJobInfo() is used there., Ravi and I sat together to see if it is really valid on trunk. And we reached the conclusion that it isn't after an elaborate analysis of the order of patches that went into trunk and yahoo distribution.]