[Perhaps we're not using internal resolvers or publishing the right common artifact?, I'll dig into this.  I think it may be related to recent change to move the token renewer into common because I seem to recall it changed method signatures., OK I was able to reproduce the issue, and resolvers=internal appears to be working.

{noformat}
mvn clean install -DskipTests
cd hadoop-mapreduce-project/
ant -Dresolvers=internal jar
ant -Dresolvers=internal test
{noformat}

The line that changed inside TokenCache.java appears to have come from MAPREDUCE-4148, Both Daryn and I approved it but it looks like Tom White did the original change, so I am adding him in as a watcher., Well that being said I fixed the test:
{noformat}
Index: src/test/mapred/org/apache/hadoop/mapreduce/security/TestTokenCache.java
===================================================================
--- src/test/mapred/org/apache/hadoop/mapreduce/security/TestTokenCache.java    (revision 1346388)
+++ src/test/mapred/org/apache/hadoop/mapreduce/security/TestTokenCache.java    (working copy)
@@ -289,7 +289,7 @@
     // this token is keyed by hostname:port key.
     String fs_addr = 
       SecurityUtil.buildDTServiceName(p1.toUri(), NameNode.DEFAULT_PORT);
-    Token<DelegationTokenIdentifier> nnt = TokenCache.getDelegationToken(
+    Token<DelegationTokenIdentifier> nnt = (Token<DelegationTokenIdentifier>)TokenCache.getDelegationToken(
         credentials, fs_addr);
     System.out.println("dt for " + p1 + "(" + fs_addr + ")" + " = " +  nnt);
     assertNotNull("Token for nn is null", nnt);
{noformat}

But now I get a different error
{noformat}
BUILD FAILED
/home/evans/src/commit/trunk/hadoop-mapreduce-project/build.xml:782: The following error occurred while executing this line:
/home/evans/src/commit/trunk/hadoop-mapreduce-project/build.xml:744: The following error occurred while executing this line:
/home/evans/src/commit/trunk/hadoop-mapreduce-project/build.xml:639: hadoop-mapreduce-project/src/test/system/test does not exist.
{noformat}

which if I remember correctly was also removed recently.  We are almost to the point that I would say we shut off the ant build.  Mavinization is almost done, and most if not all of our downstream projects should be off of the MRMiniCluster., Oh and doing the mkdir for the missing directory fixes the issue and the tests start to run again.  If someone wants to +1 the above "patch" I am happy to check in the fix, although I still think that turning off ant is a direction we should be going in., +1. lgtm to make it compile. I'm not sure why we have jenkins running the ant part on trunk right now anyway., I checked the small fix into branch-2, and trunk.  These are the two places that the other change went in that broke this., Integrated in Hadoop-Common-trunk-Commit #2323 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2323/])
    MAPREDUCE-4313. TestTokenCache doesn't compile due TokenCache.getDelegationToken compilation error (bobby) (Revision 1346406)

     Result = SUCCESS
bobby : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1346406
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/mapred/org/apache/hadoop/mapreduce/security/TestTokenCache.java
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system/test
, Integrated in Hadoop-Hdfs-trunk-Commit #2396 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2396/])
    MAPREDUCE-4313. TestTokenCache doesn't compile due TokenCache.getDelegationToken compilation error (bobby) (Revision 1346406)

     Result = SUCCESS
bobby : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1346406
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/mapred/org/apache/hadoop/mapreduce/security/TestTokenCache.java
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system/test
, Integrated in Hadoop-Mapreduce-trunk-Commit #2342 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2342/])
    MAPREDUCE-4313. TestTokenCache doesn't compile due TokenCache.getDelegationToken compilation error (bobby) (Revision 1346406)

     Result = SUCCESS
bobby : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1346406
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/mapred/org/apache/hadoop/mapreduce/security/TestTokenCache.java
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system/test
, Integrated in Hadoop-Hdfs-trunk #1069 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1069/])
    MAPREDUCE-4313. TestTokenCache doesn't compile due TokenCache.getDelegationToken compilation error (bobby) (Revision 1346406)

     Result = SUCCESS
bobby : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1346406
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/mapred/org/apache/hadoop/mapreduce/security/TestTokenCache.java
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system/test
, Integrated in Hadoop-Mapreduce-trunk #1102 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1102/])
    MAPREDUCE-4313. TestTokenCache doesn't compile due TokenCache.getDelegationToken compilation error (bobby) (Revision 1346406)

     Result = SUCCESS
bobby : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1346406
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/mapred/org/apache/hadoop/mapreduce/security/TestTokenCache.java
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system
* /hadoop/common/trunk/hadoop-mapreduce-project/src/test/system/test
]