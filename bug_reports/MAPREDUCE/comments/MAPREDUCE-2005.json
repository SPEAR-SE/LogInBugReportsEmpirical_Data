[for previous version, not for commit
I've also updated some comments and debug lines]