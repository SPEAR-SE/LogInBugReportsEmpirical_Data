[Adding in a patch to fix the issue (Just changed HashMap to ConcurrentHashMap).  

I also added in a test, but I don't really like the test that much.  It tries to brute force reproduce the problem.  On my box it takes about 1.8 sec to run so it should not be too big of an issue right now.

However, when trying to run without the fix I have seen it reproduce the problem, but I have also seen it essentially get into a living deadlock where all of the cores are pegged at 100% utilization, and sometimes only a kill -9 stops it form running.  I am fine with removing the test, because I don't think it adds much value, but I am also fine with leaving it in., +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12507389/MR-3531.txt
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 2 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed unit tests in .

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/1449//testReport/
Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/1449//console

This message is automatically generated., The change looks good to me. I'd prefer removing the test case if it can't reproduce the problem each time., Bobby, could you please upload another patch without the unit test., This patch does not have the test in it., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12507428/MR-3531.txt
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed unit tests in .

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/1452//testReport/
Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/1452//console

This message is automatically generated., +! for the fix as is. Atleast we could use that brute-force test to reproduce it sometimes, validating the fix is mostly the correct one., Committed to trunk and branch-0.23. Thanks Bobby., Integrated in Hadoop-Common-trunk-Commit #1435 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/1435/])
    MAPREDUCE-3531. Fixed a race in ContainerTokenSecretManager. (Contributed by Robert Joseph Evans)

sseth : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1214593
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/security/ContainerTokenSecretManager.java
, Integrated in Hadoop-Hdfs-trunk-Commit #1508 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1508/])
    MAPREDUCE-3531. Fixed a race in ContainerTokenSecretManager. (Contributed by Robert Joseph Evans)

sseth : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1214593
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/security/ContainerTokenSecretManager.java
, Integrated in Hadoop-Hdfs-0.23-Commit #281 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Commit/281/])
    merge MAPREDUCE-3531 from trunk

sseth : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1214595
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/security/ContainerTokenSecretManager.java
, Integrated in Hadoop-Mapreduce-trunk-Commit #1459 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/1459/])
    MAPREDUCE-3531. Fixed a race in ContainerTokenSecretManager. (Contributed by Robert Joseph Evans)

sseth : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1214593
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/security/ContainerTokenSecretManager.java
, Integrated in Hadoop-Common-0.23-Commit #291 (See [https://builds.apache.org/job/Hadoop-Common-0.23-Commit/291/])
    merge MAPREDUCE-3531 from trunk

sseth : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1214595
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/security/ContainerTokenSecretManager.java
, Integrated in Hadoop-Mapreduce-0.23-Commit #303 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Commit/303/])
    merge MAPREDUCE-3531 from trunk

sseth : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1214595
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/security/ContainerTokenSecretManager.java
, Integrated in Hadoop-Mapreduce-0.23-Build #128 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Build/128/])
    merge MAPREDUCE-3531 from trunk

sseth : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1214595
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/security/ContainerTokenSecretManager.java
, Integrated in Hadoop-Hdfs-0.23-Build #108 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/108/])
    merge MAPREDUCE-3531 from trunk

sseth : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1214595
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/security/ContainerTokenSecretManager.java
, Integrated in Hadoop-Mapreduce-trunk #928 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/928/])
    MAPREDUCE-3531. Fixed a race in ContainerTokenSecretManager. (Contributed by Robert Joseph Evans)

sseth : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1214593
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/security/ContainerTokenSecretManager.java
]