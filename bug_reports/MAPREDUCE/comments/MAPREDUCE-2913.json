[Running TestMRJobs.testFailingMapper with code changed as describe in description without the .FAILED

$ mvn -Dtest=TestMRJobs#testFailingMapper test

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.apache.hadoop.mapreduce.v2.TestMRJobs
Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 32.51 sec <<< FAILURE!

Results :

Failed tests:   testFailingMapper(org.apache.hadoop.mapreduce.v2.TestMRJobs): expected:<FAILED> but was:<TIPFAILED>

Tests run: 1, Failures: 1, Errors: 0, Skipped: 0
, If a task status is failed, JobInProgress will change the status to TIPFAILED if the TaskInProgress is failed. This behavior is consistent in mrv2 as well as branch-20-security. Correct course of action is to change the test to expect getStatus() to be TIPFAILED., In this test, the max task attempts is set to 2. As each map task attempt fails, this sets the first task attempt to FAILED, but sets the second map task attempt to TIPFAILED since it also fails the TaskInProgress since it is the last map task attempt., Have you run this multiple times?  is there any possibility of a race condition between the different tasks so that they switch status? , 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/2214/
-----------------------------------------------------------

Review request for Tom Graves, Robert Evans, Ravi Prakash, Mark Holderbaugh, and Anupam Seth.


Summary
-------

In this test, the max task attempts is set to 2. As each map task attempt fails, this sets the first task attempt to FAILED, but sets the second map task attempt to TIPFAILED since it also fails the TaskInProgress since it is the last map task attempt.


This addresses bug MAPREDUCE-2913.
    http://issues.apache.org/jira/browse/MAPREDUCE-2913


Diffs
-----

  hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java aa832aa 

Diff: https://reviews.apache.org/r/2214/diff


Testing
-------

Ran test for test with incorrect assertion

mvn -Dtest=TestMRJobs#testFailingMapper test

and verify success


Thanks,

Jonathan

, 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/2214/#review2348
-----------------------------------------------------------

Ship it!


+1 it looks good to me.

- Robert


On 2011-10-05 16:10:53, Jonathan Eagles wrote:
bq.  
bq.  -----------------------------------------------------------
bq.  This is an automatically generated e-mail. To reply, visit:
bq.  https://reviews.apache.org/r/2214/
bq.  -----------------------------------------------------------
bq.  
bq.  (Updated 2011-10-05 16:10:53)
bq.  
bq.  
bq.  Review request for Tom Graves, Robert Evans, Ravi Prakash, Mark Holderbaugh, and Anupam Seth.
bq.  
bq.  
bq.  Summary
bq.  -------
bq.  
bq.  In this test, the max task attempts is set to 2. As each map task attempt fails, this sets the first task attempt to FAILED, but sets the second map task attempt to TIPFAILED since it also fails the TaskInProgress since it is the last map task attempt.
bq.  
bq.  
bq.  This addresses bug MAPREDUCE-2913.
bq.      http://issues.apache.org/jira/browse/MAPREDUCE-2913
bq.  
bq.  
bq.  Diffs
bq.  -----
bq.  
bq.    hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java aa832aa 
bq.  
bq.  Diff: https://reviews.apache.org/r/2214/diff
bq.  
bq.  
bq.  Testing
bq.  -------
bq.  
bq.  Ran test for test with incorrect assertion
bq.  
bq.  mvn -Dtest=TestMRJobs#testFailingMapper test
bq.  
bq.  and verify success
bq.  
bq.  
bq.  Thanks,
bq.  
bq.  Jonathan
bq.  
bq.

, 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/2214/#review2349
-----------------------------------------------------------

Ship it!


Looks fine.

- Mark


On 2011-10-05 16:10:53, Jonathan Eagles wrote:
bq.  
bq.  -----------------------------------------------------------
bq.  This is an automatically generated e-mail. To reply, visit:
bq.  https://reviews.apache.org/r/2214/
bq.  -----------------------------------------------------------
bq.  
bq.  (Updated 2011-10-05 16:10:53)
bq.  
bq.  
bq.  Review request for Tom Graves, Robert Evans, Ravi Prakash, Mark Holderbaugh, and Anupam Seth.
bq.  
bq.  
bq.  Summary
bq.  -------
bq.  
bq.  In this test, the max task attempts is set to 2. As each map task attempt fails, this sets the first task attempt to FAILED, but sets the second map task attempt to TIPFAILED since it also fails the TaskInProgress since it is the last map task attempt.
bq.  
bq.  
bq.  This addresses bug MAPREDUCE-2913.
bq.      http://issues.apache.org/jira/browse/MAPREDUCE-2913
bq.  
bq.  
bq.  Diffs
bq.  -----
bq.  
bq.    hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java aa832aa 
bq.  
bq.  Diff: https://reviews.apache.org/r/2214/diff
bq.  
bq.  
bq.  Testing
bq.  -------
bq.  
bq.  Ran test for test with incorrect assertion
bq.  
bq.  mvn -Dtest=TestMRJobs#testFailingMapper test
bq.  
bq.  and verify success
bq.  
bq.  
bq.  Thanks,
bq.  
bq.  Jonathan
bq.  
bq.

, OK after thinking about the fix, there should really be no issue with them being switched unless speculative execution is enabled and something very odd happens.  So Jon you can probably ignore my previous comment., bq. Have you run this multiple times? is there any possibility of a race condition between the different tasks so that they switch status? 

Great question to ask. The getTaskCompletionEvents API return the events in chronological order. Both task events fail in this test. The code ensures that the last failing task will cause the TaskInProgress to fail which will upgrad the last event status to TIPFAILED as return by getTaskCompletionEvents. 

I have run this test 10 times consecutively to verify my understanding of the code lines up with the expected results., +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12497804/MAPREDUCE-2913.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed unit tests in .

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/951//testReport/
Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/951//console

This message is automatically generated., +1. Your understanding of the code related to completion-events is correct :)

I just committed this to trunk and branch-0.23. Thanks Jonathan!, Integrated in Hadoop-Common-trunk-Commit #1023 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/1023/])
    MAPREDUCE-2913. Fixed TestMRJobs.testFailingMapper to assert the correct TaskCompletionEventStatus. Contributed by Jonathan Eagles.

vinodkv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1179319
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java
, Integrated in Hadoop-Hdfs-trunk-Commit #1101 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1101/])
    MAPREDUCE-2913. Fixed TestMRJobs.testFailingMapper to assert the correct TaskCompletionEventStatus. Contributed by Jonathan Eagles.

vinodkv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1179319
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java
, Integrated in Hadoop-Mapreduce-trunk-Commit #1039 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/1039/])
    MAPREDUCE-2913. Fixed TestMRJobs.testFailingMapper to assert the correct TaskCompletionEventStatus. Contributed by Jonathan Eagles.

vinodkv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1179319
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java
, Integrated in Hadoop-Hdfs-0.23-Build #31 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/31/])
    MAPREDUCE-2913. svn merge -c r1179319 --ignore-ancestry ../../trunk/

vinodkv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1179326
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java
, Integrated in Hadoop-Mapreduce-0.23-Build #38 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Build/38/])
    MAPREDUCE-2913. svn merge -c r1179319 --ignore-ancestry ../../trunk/

vinodkv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1179326
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java
, Integrated in Hadoop-Hdfs-trunk #822 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/822/])
    MAPREDUCE-2913. Fixed TestMRJobs.testFailingMapper to assert the correct TaskCompletionEventStatus. Contributed by Jonathan Eagles.

vinodkv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1179319
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java
, Integrated in Hadoop-Mapreduce-trunk #852 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/852/])
    MAPREDUCE-2913. Fixed TestMRJobs.testFailingMapper to assert the correct TaskCompletionEventStatus. Contributed by Jonathan Eagles.

vinodkv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1179319
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java
]