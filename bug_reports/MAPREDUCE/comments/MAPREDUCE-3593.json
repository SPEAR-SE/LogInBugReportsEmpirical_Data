[In Hadoop 22 when we try to submit job using proxy users, while proxy user tries to impersonate other users based on core-site.xml configuration, It is failing due to permission issues for the staging directory. The problem is job is submitted using proxy user, it is not able to impersonate as the actual user., The problem was while submission of the job , job client was not using the reference of the UGI which is been created while creation of the client object however it was defaulting UGI of the proxy user. So we need to first open the API for getting the UGI of the cluster object which is getting created at the time of creation of the jobclient object and then use that to actual do the doas on behalf of the actual user., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12508784/MAPREDUCE-3593.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/1517//console

This message is automatically generated., Please ignore the above comment by Hadoop QA as this patch is only for 22, +1 The patch looks good to me. 
Mayank could you please comment on the status of test run. I will commit it if everything passed., All tests are passed for 22 branch., I just committed this. Thank you Mayank., Integrated in Hadoop-Mapreduce-22-branch #97 (See [https://builds.apache.org/job/Hadoop-Mapreduce-22-branch/97/])
    MAPREDUCE-3593. Fix user impersonation. Contributed by Mayank Bansal.

shv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1229749
Files : 
* /hadoop/common/branches/branch-0.22/mapreduce/CHANGES.txt
* /hadoop/common/branches/branch-0.22/mapreduce/src/java/org/apache/hadoop/mapreduce/Cluster.java
* /hadoop/common/branches/branch-0.22/mapreduce/src/java/org/apache/hadoop/mapreduce/Job.java
]