[Patch which returns multiple tasks from getSetupAndCleanupTasks, Tested the patch manually.
Ran gridmix and MRReliability with the patch., cancelling patch...  found a nit in the patch, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12400099/patch-5165.txt
  against trunk revision 743996.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3843/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3843/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3843/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3843/console

This message is automatically generated., Modified patch.
, What was the manual testing you performed?  Please outline the steps., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12400169/patch-5165-1.txt
  against trunk revision 744406.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3857/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3857/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3857/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3857/console

This message is automatically generated., For testing multiple setup tasks, I tested on it single node, suspended the TaskTracker and submitted 2 jobs simultaneously sothat both of will get initialized and will wait for setup tasks to be launched. And verified both the setup tasks are launched on TaskTracker in one heartbeat.

Since gridmix has multiple simultaneous jobs, ran gridmix and verified from the logs that multiple job setup tasks and job cleanup tasks are given to tracker in single heartbeat.
Ran MRReliability test and Verified from logs multiple task cleanup tasks are assigned in single heartbeat., Some observations:
 - There are now six iterations(!!) over the list of all jobs for getting setup and cleanup tasks. The code can be re-factored to get this count down to three, for e.g., by combining JobInProgress.obtainJobCleanupTask with map and reduce slots into a single loop.
 - With this patch, even after the above refactoring, we go through the list of jobs multiple times in all cases while without this patch, we do it only in the worst case. Though this may quicken the launching of job-setup, job-cleanup and task-cleanup tasks, it will affect all the heartbeats. I am just curious how the grid-mix numbers have turned out with this patch., Patch incorporating Vinod's comments. 
gridmix run on 400 nodes finished in 2834sec with latest patch. (same as trunk runs), -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12400386/patch-5165-2.txt
  against trunk revision 745268.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3875/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3875/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3875/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3875/console

This message is automatically generated., Test failure (timeout for TestQueueManager) is not related to the patch. I raised HADOOP-5283 for the failure., patch doesnt apply anymore, I'm must going to close this as stale.]