[Attaching patch for trunk(and for 0.21) with the fix., Test-case? Agreed originally it wasn't there, but it's good time we add one :), Attaching patch with unit test for the fix added.

Manually tested that stderr and stdout of tasks are truncated(when mapreduce.task.userlog.limit.kb is set) properly with this fix.

Please review and provide your comments., We should have a test that actually runs a child JVM that tries to log beyond the limit and then we should verify that only the last N kb of log file is retained., I tried adding a test that runs child JVM that tries to log beyond the specified limit, but it is not working because the index file log.index is created before stdout and stderr are written to(by "tail -c <limit>" command). stdout and stderr are of correct size when I manually checked. But because the content of log.index file is wrong, logs are not useful. This new issue will be addressed in MAPREDUCE-1025., Sorry. The new issue will be addressed in MAPREDUCE-1100 (not MAPREDUCE-1025)., bq. The new issue will be addressed in MAPREDUCE-1100
Though one can argue both ways, MAPREDUCE-1100 is more of adding more features and may or may not make it to 0.21. On the other hand, this issue is a bug in the existing feature and was introduced by jvm-reuse in 0.19. So this issue has to be fixed separately from MAPREDUCE-1100.]