[Attaching MR part of YARN-926 on Jian's behalf. Reviewing and committing this as part of YARN-926., Committed this together with YARN-926. Closing.]