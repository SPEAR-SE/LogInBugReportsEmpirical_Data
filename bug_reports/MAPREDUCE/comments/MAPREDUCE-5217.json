[{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12582093/MAPREDUCE-5217.patch
  against trunk revision .

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3579//console

This message is automatically generated., Uploading trunk patch
, The same issue is in trunk, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12582170/MAPREDUCE-5217-trunk.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:red}-1 javac{color:red}.  The patch appears to cause the build to fail.

Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3581//console

This message is automatically generated., Uploaded wrong patch, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12582196/MAPREDUCE-5217-trunk.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-tools/hadoop-distcp.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3582//testReport/
Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3582//console

This message is automatically generated., This patch checks an environment variable and sets the mapreduce.job.credentials.binary property.   It has been validated by running oozie distcp action on a secure cluster, Patch for branch-1, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12582240/MAPREDUCE-5217-branch-1.patch
  against trunk revision .

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3586//console

This message is automatically generated., 1. Please use the LOG object for logging instead of System.out.
2. Minor: 'delegationToken' variable name should be renamed to tokenFile, because it actually represents the file name that contains tokens, and could also contain tokens other than delegation tokens., Also, the job conf is being set twice., Thanks for the comments Jitendra.   I have modified the patch with all the comments and uploaded  a new patch, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12582343/MAPREDUCE-5217-trunk.patch.2
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-tools/hadoop-distcp.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3596//testReport/
Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3596//console

This message is automatically generated., This fix has been manually test with a secure cluster with branch-1, branch-1 patch after addressing Jitendra's comments, +1, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12582358/MAPREDUCE-5217-branch-1.patch.2
  against trunk revision .

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3597//console

This message is automatically generated., Venkat, the patch looks good. Couple of minor nits though.
- In the trunk patch, the credentials constant can refer to MRJobConfig.MAPREDUCE_JOB_CREDENTIALS_BINARY
- Rename delegationTokenFiles to delegationTokenFile, Thanks [~sseth].   I have updated the trunk patch as you suggested and also changed the variable name to tokenFile as suggested by [~jnp].

I am uploading the trunk patch first and will upload the branch-1 patch with new variable name after precommit tests with trunk patch are done, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12582389/MAPREDUCE-5217-trunk.patch.3
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-tools/hadoop-distcp.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3600//testReport/
Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3600//console

This message is automatically generated., Patch for branch1, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12582430/MAPREDUCE-5217-branch-1.patch.3
  against trunk revision .

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/3603//console

This message is automatically generated., Venkat, Oozie works with distcp on secure clusters. Please check OOZIE-611 which is adding the missing documentation for it. Please check if this solves your problem., Alejandro, I have the proxy setup as mentioned in the docs.  But when I tried to run distcp action in a secure cluster, it failed until I modified distcp.  With this modification in distcp, I could run it successfully.   Also, the following email chain recommends similar approach for Java actions for a secure cluster.  http://bit.ly/YInpZ6.  But for DistCp, we have to change DistCp.

, Alejandro, does Oozie work on secure clusters with both branch-1 and branch-2 ?
Looking at the code, it looks like branch-2 will work - since credentials are copied over from the current ugi by the Job class in branch-2 (Job(JobConf conf)). However, branch-1 is missing this code. 
I'm in favour of committing this to branch-1, rather than making changes to branch-1 client code - since there's a reasonable difference between the client code on the two branches, and this isn't necessarily the correct behaviour - if Jobs are trying to control their token set. Will create a separate jira for this., Sidd, you are correct, the patch for branch-1 is needed (as branch-1 has distcp v1), for branch-2 it is not needed. THX, Boilerplate code like this is _wrong_, at least for versions later than 1.x.

It's unreasonable to expect every tool that might be run within the context of a job to be aware of the internal implementation details of both the UGI (its env var) and mapreduce.job.credentials.binary.  I'd personally like to see the conf key removed.

If a tools wants to control its token set, my opinion is it should create a new UGI for the submission.  The vast majority of tools, like distcp, have no need for special logic just in case its running within a job., [~daryn], yep this is for hadoop 1, in Hadoop 2 distcp works just fine., +1 for the branch-1 patch. Committing based on the comments. Thanks Venkat for the patch, and Akejandro, Daryn and Jitendra for taking a look., Committed to branch-1.]