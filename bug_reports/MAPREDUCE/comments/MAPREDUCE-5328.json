[Committed together with YARN-610 to trunk, branch-2 and branch-2.1.]