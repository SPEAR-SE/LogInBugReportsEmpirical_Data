{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Gary Tully",
            "key": "gtully",
            "name": "gtully",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=gtully",
            "timeZone": "Etc/UTC"
        },
        "components": [{
            "id": "12313895",
            "name": "Message Store",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313895"
        }],
        "created": "2010-06-28T11:00:35.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Adrian Trenaman",
            "key": "adrian.trenaman",
            "name": "adrian.trenaman",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=adrian.trenaman",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2010-06-28T11:14:13.073+0000",
        "customfield_12310222": "1_*:*_1_*:*_877070957_*|*_5_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310420": "74794",
        "customfield_12310920": "159944",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i0rqjj:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Jul 08 14:38:26 UTC 2010",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "Am doing some failover testing of ActiveMQ, sending 10,000 messages to the broker with a live consumer; the producer and consumer are transactional, and the broker is configured to use KahaDB. On failover of the broker, I see log warnings like this: \n\n{code}\n WARN | Duplicate message add attempt rejected. Message id: ID:Ade's-54024-1277715585703-0:29:1:1:240\n WARN | Duplicate message add attempt rejected. Message id: ID:Ade's-54024-1277715585703-0:24:1:1:241\n WARN | Duplicate message add attempt rejected. Message id: ID:Ade's-54024-1277715585703-0:23:1:1:242\n WARN | Duplicate message add attempt rejected. Message id: ID:Ade's-54024-1277715585703-0:0:1:1:237\n{code}\n\nWhen the test has run its course, I discover that there are no messages lost - all my messages have gone through successfully. However, I notice that there are in fact a number of 'zombie' messages on the queue: by 'zombie' I mean that the messages are in the store, and the JMX queueSize says they're there. However, if you browse the queue you don't see them, and, if you have a consumer on the queue, you won't receive them either. \n\nLooking into the code, in {{org.apache.activemq.store.kahadb.MessageDatabase}} you can see the following very interesting comments concerning the log warning:\n\n{code}\n               // If the message ID as indexed, then the broker asked us to store a DUP\n                // message.  Bad BOY!  Don't do it, and log a warning.\n                LOG.warn(\"Duplicate message add attempt rejected. Message id: \"+command.getMessageId());\n                // TODO: consider just rolling back the tx.\n                sd.messageIdIndex.put(tx, command.getMessageId(), previous);\n{code} \n\nSo. It seems to me that while we're detecting the condition of the broker trying to reinsert a message that's already in the KahaDB correctly, we're not handling this case very well. The outcome is that while we do not get any message loss, we do get worrying warning messages *and* we get erroneous reporting of the queueSize in JMX which will mislead and create the perception of undelivered messages.\n\n\n",
        "duedate": null,
        "environment": null,
        "fixVersions": [{
            "archived": false,
            "description": "version 5 feature complete",
            "id": "12315623",
            "name": "5.4.0",
            "releaseDate": "2010-08-17",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315623"
        }],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Adrian Trenaman",
            "key": "adrian.trenaman",
            "name": "adrian.trenaman",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=adrian.trenaman",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2010-07-08T14:38:26.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [{
            "fields": {
                "issuetype": {
                    "avatarId": 21140,
                    "description": "An improvement or enhancement to an existing feature or task.",
                    "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                    "id": "4",
                    "name": "Improvement",
                    "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                    "subtask": false
                },
                "priority": {
                    "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                    "id": "3",
                    "name": "Major",
                    "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
                },
                "status": {
                    "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                    "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                    "id": "5",
                    "name": "Resolved",
                    "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                    "statusCategory": {
                        "colorName": "green",
                        "id": 3,
                        "key": "done",
                        "name": "Done",
                        "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
                    }
                },
                "summary": "Tidy up store duplicate suppression from failover recovery - consistent store implementation with help from transportConnection"
            },
            "id": "12482853",
            "key": "AMQ-2542",
            "self": "https://issues.apache.org/jira/rest/api/2/issue/12482853"
        }],
        "summary": "'Zombie' messages created in KahaDB after failover, with warning 'Duplicate message add attempt rejected.'",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2010-07-08T14:38:26.000+0000",
        "versions": [{
            "archived": false,
            "description": "",
            "id": "12315622",
            "name": "5.3.2",
            "releaseDate": "2010-05-11",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315622"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-2803/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-2803/watchers",
            "watchCount": 0
        },
        "workratio": -1
    },
    "id": "12483932",
    "key": "AMQ-2803",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12483932"
}