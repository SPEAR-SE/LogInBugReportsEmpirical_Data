[fix and test in http://git-wip-us.apache.org/repos/asf/activemq/commit/7d98b320]