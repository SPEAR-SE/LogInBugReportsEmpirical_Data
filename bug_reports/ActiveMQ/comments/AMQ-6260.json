[As you have pointed out this error means there are too many open files and needs to be fixed with ulimits and permissions.  There's really nothing that can be done in the code as far as I am aware.

I'm not entirely sure why it's giving the error if you are showing the total file counts lower than the set ulimit but I would suggest researching it a bit. I do know that ulimits can be set in several locations in Linux so may there's a system level configuration conflicting with something., We have ActiveMQ running on other envs. Those servers has similar ulimits and file counts, and they are running fine.

After couple of restarts, it is not showing "too many open files" now but memory is reaching to 100% in around 30 mins.]