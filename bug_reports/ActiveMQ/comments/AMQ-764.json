[Another thing, I am running ActiveMQ with 800m heap size (which I increased from 512m after memory errors) and message size is 1K., Can you try using 4.0.1 please and see if you can reproduce?

http://incubator.apache.org/activemq/activemq-401-release.html, I tried 4.0.1 and am no longer see out-of-memory. Can you explain what was changed between 4.0-RC2 and 4.0.1 to fix this.]