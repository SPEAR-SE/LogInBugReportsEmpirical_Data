[Unit test that can be run against the unpatched AMQ trunk to demonstrate how long moving a message from a queue can take.  The same unit test can be used to verify that the patch improves performance of this operation by a considerable amount., Patch that changes Queue#moveMatchingMessagesTo to use HashSet rather than CopyOnWriteArraySet, This appears to also affect the methods, copyMatchingMessages and removeMatchingMessages.  In each case the Thread locality of the set object in use is limited to one thread so I don't see why a CopyOnWriteArraySet is needed for any of these methods.

, Fixed, patch applied along with fixing the other two methods that had this same issue.  Test updated to cover all three.]