[thanks for the test case, The problem is a delivery ack that is not conditional on the consumer calling acknowledge and that combined with a prefetch=1 causes that pending delivery ack to be sent immediately, resulting in the broker error looking for a message that has already been acked.
However the messages are being acked individually just fine. 
The fix looks trivial enough, will commit once a full test run completes., resolved in r883458 - delivery acks are only needed for unacked messages to update prefetch and expiry. When message is acked, they should be suppressed as they now are as they will result in this exception due to not found in the dispatch list., I've verified and the issue seems to be fixed. Thanks a lot.
]