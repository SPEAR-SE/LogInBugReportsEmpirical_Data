[In the case of the first code snippet it appears to be a client issue, the broker is registering the disconnect, but the client doesn't seem to reset itself to a usable state as the second connect call never reaches the broker.

In the second snippet there appears to be a bug on the Broker side. , Fixed, client's weren't getting unregistered from the Broker. Still will see issues with your first case since its on the client end, but the second case should be better now. , Fixed on trunk, will be in the next nightly. , I could be wrong about this, but don't you need to do the same in onTransportError() as well?

onTransportError() called from the inactivity monitor would also not unregister from the broker properly. right?, If you believe that there are lingering issues then the way to determine is with a test cause that validates your assumptions.  ]