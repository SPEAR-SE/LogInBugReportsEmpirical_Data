[The karaf tests passes on trunk now, This test fails on trunk. I wonder what resolved it last time?, seems it fails with jdk7 and works with jdk6, not sure what was wrong  - but all is good now.
pulling in pax exam 3.4 to remove some deprecated usage., This camel (both embedded and external) itests fail on trunk with "BundleContext null" problem.

If camel-osgi does not get to install its bean processor, the use of the bundle context is avoided and it works.
There is some ordering or extra dependency related problem but I have not been able to track it down.
It fails all the time with  karaf 4.2.1 so the test has an @Ignore, I gonna take a look (sorry I forgot)., JB thanks - there are two strange things with the itests at the moment. that point to something being wrong in the way pax exam is setting up the container (i think). I guess it is being misconfigured - but I can't see the problem after comparing to karaf/camel/fabric8 etc ;-)
 a) feature add war fails (needed by the broker web dependency) - but works on a vanilla karaf distro
    the workaround is to manually install the bundles that it requires. That does not seem right to me.
   see: https://github.com/apache/activemq/blob/trunk/activemq-karaf-itest/src/test/java/org/apache/activemq/karaf/itest/ObrFeatureTest.java#L42

b) for the camel route dropped into the deploy folder - it does not get deployed for some reason
 see: https://github.com/apache/activemq/blob/trunk/activemq-karaf-itest/src/test/java/org/apache/activemq/karaf/itest/ActiveMQBrokerNdExternalCamelFeatureTest.java#L47

For the embedded camel case, this bundlecontext issue. My hope is that there is some correlation between these, but that may not be the case. hope this helps :-), the embedded case now works ok with the use of OsgiBundleXmlApplicationContext from the karaf service factory.
Why the external test case fails is still in the wind, Old ticket, create new ticket with newer versions of ActiveMQ if you can reproduce any kind of this]