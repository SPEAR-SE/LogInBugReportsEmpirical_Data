[fix and test in  http://svn.apache.org/viewvc?rev=1179999&view=rev]