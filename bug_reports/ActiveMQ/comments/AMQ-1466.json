[What version of the broker did you test against??  I just tested using ruby 1.8.2 on OS X and WIndows against the trunk version of the broker and I code above always connected fine.]