[These are the data files:

-rw-rw-r-- 1 activemq activemq 33554432  3月 23 11:46 db-13.log
-rw-rw-r-- 1 activemq activemq 33554432  3月 23 11:46 db-1.log
-rw-rw-r-- 1 activemq activemq 33554432  3月 23 11:46 db-2.log
-rw-rw-r-- 1 activemq activemq 33554432  3月 23 11:46 db-4.log
-rw-rw-r-- 1 activemq activemq 33554432  3月 23 11:46 db-5.log
-rw-rw-r-- 1 activemq activemq 33554454  3月 23 11:46 db-7.log
-rw-rw-r-- 1 activemq activemq    32768  3月 23 12:18 db.data
-rw-rw-r-- 1 activemq activemq    28720  3月 23 11:46 db.redo

 

db-7.log is larger than the maxFileLength = DEFAULT_MAX_FILE_LENGTH=33554432

 , I'm not sure if it is allowed that the file size is greater than the maxFileLength. If it is allowed, then this might should be changed:

          
{code:java}
else if (cur.getType() == 0){                 
// eof - jump to next datafile                 
cur.setOffset(maxFileLength);     //=> change to: cur.setOffset(dataFile.getLength());            
 }
{code}
 

With the change above, my activemq instance can start up., That was resolved via: https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=blobdiff;f=activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/disk/journal/Journal.java;h=182a3d7757541627d67b8bf4f539836dc259bc0b;hp=da0d5b432d2eb0783b7eee686a2cb1c087124f85;hb=62bdbb0;hpb=3c342ffce43546667f59bb16db373061724e1b0f

https://issues.apache.org/jira/browse/AMQ-5603
, OK, that's nice, thanks!]