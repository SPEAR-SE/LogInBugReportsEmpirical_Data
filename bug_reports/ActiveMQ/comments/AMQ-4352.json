[based on AMQ 5.6, The problem here is when the message arrives at the connection over the VM transport its properties aren't marshaled so the original expiration property gets filtered. , Rewrite the test case to allow graceful shutdown and try to provide a patch for the issue., Not sure why the message gets copied twice when it passes through the connection and consumer., Can you retest against a 5.9 SNAPSHOT and confirm if this is still an issue, just testing here and it seems to be working now. , The test is working against trunk.  Please reopen if you find that this is not resolved. ]