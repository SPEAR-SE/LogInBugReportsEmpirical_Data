[variant of patch added with test in r918381 thanks. Can you validate against your use case to ensure it still does what you want?, applied to 5.3.1 branch]