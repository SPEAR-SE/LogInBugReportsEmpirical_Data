[Improved the connection error handling and added test.]