[I reproduce the same crash using new URI() in a test program. Looking at the RFC an underscore is in fact an invalid character in a host name. However, Linux lets you name a machine with underscores in the host name, so whether or not ActiveMQ should gracefully handle this case is still a relevant question. Also, the config file used to generate this issue was using localhost not the host name but the connector initialization code would still resolve it to the fully qualified host name of the machine resulting in the stack trace above., FWIW a workaround is probably to use the IP address in the config file (its only when using the localhost that we try and resolve it).

I've added a fix to trunk to work around this where if the URI is invalid we try to use the IP address in the URI instead. Let us know if that doesn't fix it and we can reopen this issue]