[Attaching a patch which fixes this issue and adds a unit test to ensure its correctness in the future., Fixed applied in SVN revision 685832]