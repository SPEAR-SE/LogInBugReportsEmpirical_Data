[Unit test that fails prior to patch, and passes after patch., This seems sensible.  Nice catch., Patch applied tests all passing locally. , Thanks for the fast turnaround, Timothy.  I linked AMQ-4159 and AMQ-4160 together as they are related (at least the symptoms were observed during the same test that we were running).  Now that I think about it, the fix for AMQ-4160 relies on AMQ-4159 (i.e., one-to-one relationship between DiscoveryEvent and a bridge creation attempt).  It would be great if AMQ-4160 could also be fixed for AMQ 5.8.0., test org.apache.activemq.bugs.AMQ4159Test hangs on trunk from nov 6, I will look into this.  We run a local AMQ build on our build server and experienced the same hanging on AMQ4159Test.  Initial diagnosis indicates a timing issue between stopping the network connector and start it again --- it appears the restart is happening before the connections from the original bridge are fully-closed., AMQ-4159 stops the network connector and restarts it.  I just patched AMQ-4160 to address an issue where activeEvents was not being cleared on DiscoveryNetworkConnector.handleStop --- as a result, the restart would be ignored.  This could have caused the hanging test, although I believe it occurred prior to the change for AMQ-4160 that would have caused the restart to be ignored.

I've periodically seen bridge formation stop when the network connector is stopped and restarted in quick succession.  I'm continuing to investigate., The issue described here seems to have been fully resolved.  The test isn't really showing much so I removed it from the build.  If you run into more problems along this line I'd recommend trying to get a test working and reopen or create a new issue]