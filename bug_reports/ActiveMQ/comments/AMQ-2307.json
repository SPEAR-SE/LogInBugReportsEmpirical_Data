[unit test and fix applied in [r788646|http://svn.apache.org/viewvc?view=rev&revision=788646]]