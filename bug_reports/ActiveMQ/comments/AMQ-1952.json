[I think we may need to extend the wire protocol a bit to gracefully handle this. When the consumer closes, it should let the broker know the last message id that was delivered to the client. That way the broker can mark all the messages between the last one acked and the last one delivered to the client as being redelivered and the rest would not get marked as being redelivered.

But even without the wire protocol change, this case should work today if the prefetch is set to 0. , Commit rev 698719 should fix it so that it works for prefetch size 0, reopening so that this gets on the radar for 6.0 - add the additional attribute to the close message so a grace full close will not result in a redelivery increment., we can update the wireformat for 6.0 to support a fix for this., resolved by https://issues.apache.org/activemq/browse/AMQ-2087]