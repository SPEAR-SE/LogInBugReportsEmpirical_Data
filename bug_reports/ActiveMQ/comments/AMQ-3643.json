[Attaching JUnit test that reproduces the bug., I guess this has always been the case with the vm transport? 

What should it do if it his a memory usage limit?, Correct, the VM transport has never bothered to check for available memory before adding messages. To fix this bug, the {{VMPendingMessageCursor}} needs to be refactored to utilize the methods for this in the {{AbstractPendingMessageCursor}} so that it obeys the {{memoryUsageHighWaterMark}} property. , Yeah maybe we should get the AMQ people to see if they think its a good idea to have this baked into the vm cursor. Its been like this for a long time, so maybe the change looks good at first, but maybe not.

Let me post on @dev to get their attention. , the whole point of limits is to avoid oom, so this may need some work. I think the destination limits may be ignored but the system limits should not be.]