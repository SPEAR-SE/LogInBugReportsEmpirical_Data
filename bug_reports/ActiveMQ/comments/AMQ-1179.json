[Several fixes were recently done in the 4.1 branch to make connection shutdown more robust:

Send the ShutdownInfo message in a async thread so that the operation can timeout if the connection fails while doing that:
http://svn.apache.org/viewvc?view=rev&rev=511090
http://svn.apache.org/viewvc?view=rev&rev=511091 
http://svn.apache.org/viewvc?view=rev&rev=511089
http://svn.apache.org/viewvc?view=rev&rev=511083
, AMQ-1052 was also cause problem properly shutting down a connection, Need to port all the previously posted revisions to trunk., ported fix to trunk : r514734]