[Test Class for reference., committed your test in r953739
It works fine on trunk. Have a peek to see if you can make it break or if there is something missing.]