[Added your great test updates on trunk, did a few tweaks to make the test to reproduce the same consistently for easier debugging.  , Things will work if the Messages are produced with the ActiveMQ JMS client, however when receiving from the QPid JMS client the message has a MessageID that's not compatible with ActiveMQ so we don't correctly process the Ack.  We need to figure out how to ensure that the MessageId is set to an ActiveMQ compatible version on receive.  , This seems to be KahaDB specific.  The test case passes when run against LevelDB., Yeah, we sort of backed ourselves into a corner by relying on MessageID to be formatted a specific way.  Without the right values in their things like producer audit and such break.  We should probably maintain an original value in the MessageID when and resend that on dispatch as opposed to overwriting the vendor supplied one with out own. , fixed.  Its not ideal to have to set the store version as its not very intuitive but at least now we can support the various use cases, If the sending client uses a Message ID format that can be parsed into the basic ActiveMQ message id format this bug reappears.  We need to always create our own Message Id and store off the external ID in the new instance as the TextView for later reuse.  , Fixed in: da07a11760e18edb52035129495edc97193e3fe3]