[hiram fixed this in trunk revision 472345.

I've just back ported it to 4.0.x in revision: 472423]