[Attached patch fix the issue. I create this new children ActiveMQMessageAuditWithDestination.java because it will be used only in TransactionBroker.java for a slave. Other code use is using the original ActiveMQMessageAudit.java

Please review and refactor when you see fit. Thanks, I added a test case to try and understand this issue and reproduce but I am missing some information. In a pure master slave setup, how can you have a producer connected to brokerA and consumers connected to brokerB at the same time?

Can you modify the test case: activemq-core/src/test/java/org/apache/activemq/bugs/AMQ2183Test.java to demonstrate the problem?, hi, Gary,

we have a setup of 4 master/slave broker pair( totally 8 brokers), each pair is a pure master/slave. All masters are multicast discovered and bridged. However only the master's url are exposed to the client, we only use slave for data replication. 
in my previous comments, brokerA and brokerB all refers to a master in a network of brokers. hope this clears things. I will see whether i have time after work to modify the test., pushing this out to 5.4 pending a test case that can demonstrate the problem. Don't think this can block the 5.3 release, downgrade to major. , Fixed with svn revision 938353.

The order of TransactionBroker and CompositeDestinationBroker interceptor should be enough to fix this.]