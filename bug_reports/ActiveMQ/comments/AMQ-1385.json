[The following throws an exception:
{code}
URI uri = new URI("vm://localhost/?broker.dataDirectory=C:/Documents%20and%20Settings/foo/bar");
new ActiveMQConnectionFactory(uri).createConnection().close();
{code}

The test works when one line in URISupport.parseComposite() is changed: use getRawSchemeSpecificPart() instead of getSchemeSpecificPart().
{code}
String ssp = stripPrefix(uri.getSchemeSpecificPart().trim(), "//").trim(); // crashes
String ssp = stripPrefix(uri.getRawSchemeSpecificPart().trim(), "//").trim(); // works
{code}
This makes sense because the scheme specific part is later passed to the constructor URI(String), which expects an escaped ('raw') string.
, As a workaround, I use _double_ URI encoding, i.e. a space becomes {{%2520}}.
This works:
{code}
URI uri = new URI("vm://localhost/?broker.dataDirectory=C:/Documents%2520and%2520Settings/foo/bar");
new ActiveMQConnectionFactory(uri).createConnection().close();
{code}
, Fixed by SVN  revision 905978]