[Here is the log when create ACTIVEMQ_MSGS failed, it would be great to know what the problem is for MS SQL 2008.

2009-11-18 09:08:32,080 INFO  [STDOUT] 2009-11-18 09:08:32,080 [ActiveMQ Broker] WARN  DefaultJDBCAdapter             - Could not create JDBC tables; they could already exist. Failure was: CREATE TABLE ACTIVEMQ_MSGS(ID BIGINT NOT NULL, CONTAINER VARCHAR(250), MSGID_PROD VARCHAR(250), MSGID_SEQ BIGINT, EXPIRATION BIGINT, MSG BLOB, PRIMARY KEY ( ID ) ) Message: Column, parameter, or variable #6: Cannot find data type BLOB. SQLState: S0007 Vendor code: 2715
2009-11-18 09:08:32,314 INFO  [STDOUT] 2009-11-18 09:08:32,314 [ActiveMQ Broker] WARN  DefaultJDBCAdapter             - Could not create JDBC tables; they could already exist. Failure was: CREATE INDEX ACTIVEMQ_MSGS_MIDX ON ACTIVEMQ_MSGS (MSGID_PROD,MSGID_SEQ) Message: Cannot find the object "ACTIVEMQ_MSGS" because it does not exist or you do not have permissions. SQLState: S00012 Vendor code: 1088
2009-11-18 09:08:32,580 INFO  [STDOUT] 2009-11-18 09:08:32,580 [ActiveMQ Broker] WARN  DefaultJDBCAdapter             - Could not create JDBC tables; they could already exist. Failure was: CREATE INDEX ACTIVEMQ_MSGS_CIDX ON ACTIVEMQ_MSGS (CONTAINER) Message: Cannot find the object "ACTIVEMQ_MSGS" because it does not exist or you do not have permissions. SQLState: S00012 Vendor code: 1088
2009-11-18 09:08:32,830 INFO  [STDOUT] 2009-11-18 09:08:32,830 [ActiveMQ Broker] WARN  DefaultJDBCAdapter             - Could not create JDBC tables; they could already exist. Failure was: CREATE INDEX ACTIVEMQ_MSGS_EIDX ON ACTIVEMQ_MSGS (EXPIRATION) Message: Cannot find the object "ACTIVEMQ_MSGS" because it does not exist or you do not have permissions. SQLState: S00012 Vendor code: 1088
, Issue is that for column ACTIVEMQ_MSGS.MSG  type given as BLOB instead of IMAGE., Looks like image should be the preferred data type (for BLOB)  for all SQLServer instances post 2000

Note: "Binary Data" section of http://technet.microsoft.com/en-us/library/bb497065.aspx
and
http://technet.microsoft.com/en-us/library/cc917636.aspx
, Actually, it looks like the bug is that the correct JDBC Adapter isn't being used. You can fix this by specifying it manually in activemq.xml.

A simple example:

{code:XML|title=Excerpt from activemq.xml}
<persistenceAdapter>
    <jdbcPersistenceAdapter  dataSource="#mssql-ds">
        <adapter><transact-jdbc-adapter/></adapter>
    </jdbcPersistenceAdapter>
</persistenceAdapter>
{code}

Once you do this, it will use the Image type.

, But your configuration is not for journaledJDBC.

Will this work for journaledJDBC?

<persistenceAdapter>
<journaledJDBC journalLogFiles="5" dataDirectory="${jboss.server.data.dir}/activemq" dataSource="#my-ds" useDatabaseLock="false" />
<adapter><transact-jdbc-adapter/></adapter>
</journaledJDBC 
</persistenceAdapter>



, should do, those attributes are exposed and they delegate to the underlying persistence adapter., After making the above change, it does create all the tables for MSSQL2008, basically this issue was seen for all sql versions where sqljdbc4.jar is used.

Now the issue is resolved for MSSQL, with the config change we are having a regression and none of the tables are getting created for ORACLE with the config change.

2010-05-13 14:25:02,826 INFO [STDOUT] 2010-05-13 14:25:02,826 [ActiveMQ Broker] WARN DefaultJDBCAdapter - Could not create JDBC tables; they could already exist. Failure was: CREATE TABLE ACTIVEMQ_MSGS(ID BIGINT NOT NULL, CONTAINER VARCHAR(250), MSGID_PROD VARCHAR(250), MSGID_SEQ BIGINT, EXPIRATION BIGINT, MSG IMAGE, PRIMARY KEY ( ID ) ) Message: ORA-00902: invalid datatype 
 SQLState: 42000 Vendor code: 902 

BIGINT is not a valid colum type in oracle.

We will have to revert the above config change and live with workaround of manually creating tables for MSSQL2008.

Is theren't a solution yet on this?, Can someone advice on this issue?  Adviced config change in broker-config.xml only solves the problem for MSSQL, it created a regression in ORACLE now., in the short term can you treat these as two different configurations? The issue is differences in SLQ dialect, no?, Its not just between ORACLE and MSSQL, we need to support any database for our application.  We can't have different configurations based on databases., Same issue is seen with DB2 as well., The discovery mechanism is very simple, the org.apache.activemq.store.jdbc.JDBCPersistenceAdapter#loadAdapter method of http://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/store/jdbc/JDBCPersistenceAdapter.java?view=markup
generates a properties file name from the driver name to load from:
http://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/main/resources/META-INF/services/org/apache/activemq/store/jdbc/

so it is a case of a string match. It may already be covered by microsoft_sql_server_jdbc_driver_3_0. Or that file can be copied to a matching name.
There is a warning and info message of the form: "driver override not found for" that will identify what the name needs to be for MSSQL 2008.

, downgrading till we find the driver name for mssql 2008, Gary,

The microsoft driver name is com.microsoft.sqlserver.jdbc.SQLServerDriver.

You can download the jdbc drivers for mssql 2008 is located at:

http://www.microsoft.com/downloads/en/details.aspx?FamilyID=a737000d-68d0-4531-b65d-da0f2a735707&displaylang=en
, Claudio, thanks for the link. It looks like that driver has a default name of Microsoft SQL Server JDBC Driver 3.0 which will match the existing microsoft_sql_server_jdbc_driver_3_0 properties file. Without a working mysql server I cannot determine if the runtime metadata from a new connection is any different.
Can you verify with a current 5.5-SNAPSHOT and mssql 2008?, The fix for https://issues.apache.org/jira/browse/AMQ-3134 seems to sort this., Gary, unfortunately I cannot verify this because I do not have windows machine available.  I might be able to get one setup. I'll let you know.]