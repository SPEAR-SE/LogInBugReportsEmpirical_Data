[Patch with unit test and proposed fix. , Patch looks good to me - applied in SVN 818762]