[Update 0.0.2:

- added a stand-alone test
- delete the temporary queue and close its (locally created) session


The problem on the slave persists.

To run the test do something like:

java -cp conf:lib/log4j-1.2.14.jar:lib/activemq-all-5.2-SNAPSHOT.jar:lib/activemqjee-0.0.2.jar org.activemq.jms.StandaloneApp

With libraries in "lib" and "log4j.xml" and "jndi.properties" in "conf".

"jndi.properties" contains the fail-over URL:

  java.naming.provider.url=failover:(tcp://masterhost:61616,tcp://slavehost:61616)


BTW: Pure master/slave does not work with 5.1.0, so I cannot test that one. ( see AMQ-1585 )

, Everytime it happens, I get a ClassCastException in "data/activemq.log" on the slave host:

2008-07-10 11:48:33,907 [t: vm://slavehost#1] ERROR Queue                          - Failed to page in more queue messages 
java.lang.ClassCastException: org.apache.activemq.command.ActiveMQTextMessage cannot be cast to org.apache.activemq.broker.region.QueueMessageReference
        at org.apache.activemq.broker.region.Queue.messageExpired(Queue.java:1045)
        at org.apache.activemq.broker.region.Queue.messageExpired(Queue.java:1037)
        at org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1117)
        at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1196)
        at org.apache.activemq.broker.region.Queue.iterate(Queue.java:951)
        at org.apache.activemq.broker.region.Queue.wakeup(Queue.java:1077)
        at org.apache.activemq.broker.region.Queue.sendMessage(Queue.java:1072)
        at org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:470)
        at org.apache.activemq.broker.region.Queue.send(Queue.java:413)
        at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:350)
        at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:437)
        at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:224)
        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:126)
        at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:95)
        at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:133)
        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:437)
        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:624)
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)
        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:104)
        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)
        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:205)
        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)
        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)
, Deployed build 675511 from svn: the exception is gone, but the number of threads on the slave still increases every time I send a message.

Tested both with the stand-alone client and with the TextMDB., Tried 680628 yesterday, but the issue is still there.

Any ideas where it fails? Can I do something?, temp queues are now cleaned up in the slave., That's good news!

I'll test it, monday.
, The test with the attached "activemqjee-0.0.2" worked fine.]