[Given the description it sounds like a timing issue where the broker is still reading the last bit of data when the socket is closed.  If you have a test case to reproduce please attach and reopen the issue.]