[I forgot that when using the VM transport the message is supposed to be copied on dispatch inside ActiveMQConnection so this may not be the exact issue, I need to look at it a bit more., I removed my attached test as that isn't the issue because the messages are copied on dispatch and something else is going on so this will need to be debugged more to see where the issue is., Seems to be related to https://issues.apache.org/jira/browse/AMQ-5857
 
Specifically, this commit: https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=blobdiff;f=activemq-client/src/main/java/org/apache/activemq/command/ActiveMQTextMessage.java;h=cca09be21bfb877213a4a506415929f1f81a1902;hp=347db78da559bf57b049574c96cd3a8e08681dae;hb=84ec047;hpb=de86f473f776fe3a8ca32d7f929ecec7993c458b, Based on the storeContentAndClear() being the issue (because text is nulled) it would seem that when using the VM transport something isn't quite thread safe somewhere.  The message is supposed to be copied so there shouldn't be two threads at the same time trying to marshall/unmarshall the data but based on the behavior seen either something in the test case or the broker is causing a race condition here]