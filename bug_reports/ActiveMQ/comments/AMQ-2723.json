[Unit test demonstrating the leaking of VMTransport connections., Patch to address issue., Patched VMTransport.java file (i.e., AMQ 5.3.1 version with VMTransport.patch applied)., Hi,

this looks like a duplicate of https://issues.apache.org/activemq/browse/AMQ-2448

Can you test the latest SNAPSHOT and confirm if the bug is still there?, Indeed, this issue has been fixed by r932403 on the trunk.

I had to modify the mock object in the unit test to accept twice the number of serviceFailed calls (inconsequential) and it's now passing on the May 5 instance of apache-activemq-5.4-SNAPSHOT.

I compared the change checked in to VMTransport.java with the patch and they're virtually the same, so all is good., Thanks for verifying. Resolving the issue now.]