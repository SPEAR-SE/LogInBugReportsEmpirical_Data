[A good course of action here would be to create a JUnit test case that shows the issue and a patch that resolves it, this will ensure it stays fixed into the future. , The attached file "PrefetchSubscription.patch" contains a tentative fix for this issue., I'll try to create a reasonable unit test, but first I have to do some further investigation in order to emulate environment and communication correctly., Find attached the following two tests demonstrating the issue:

# "PrefetchSubscriptionTest.java" contains a unit test which re-plays the interaction with the "DurableTopicSubscription" which leads to the issue with undispatched messages. Collaborating classes are partly mocked and simplified (e.g. transactions).
# "TestClient.java" is implemented as JUnit TestCase, but not a unit test and requires an ActiveMQ server to be running at "tcp://localhost:61616". It shows the issue from JMS API level., Updated the TestClient test app to a JUnit based test case and applied the fix, good catch.]