[This issue seems like it could occur in a few places because AbstractRegion and VirtualDestinationInterceptor can be called in a different order in the chain of method calls depending on the action (removing a destination, adding a consumer, etc).   This can lead to the locks owned by each one (the destinationsLocks and the intrinsic lock on VirtualDestinationInterceptor) not being acquired in the same order, leading to a deadlock.  This exact deadlock no longer occurs in 5.12-SNAPSHOT because the broker.getDestinations() calls in the create method of VirtualTopic has been removed but this situation could occur in other cases.

I'm not sure of the best way to handle this without having to refactor a bunch of code.  Maybe when acquiring the destinationsLock in AbstractRegion we should use tryLock() and set a timeout value so that if the lock can't be acquired we can try again and avoid a deadlock., I also met the same problem at 5.10 / 5.11 / 5.12 in linux
TIMED_WAITING thread was not disappear.
But I did not meet the BLOCKED thread



"ActiveMQ VMTransport: vm://localhost#632-1" daemon prio=10 tid=0xa470a800 nid=0x7da5 waiting on conditi
on [0xa0c8a000]
   java.lang.Thread.State: TIMED_WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  <0xe7b26430> (a java.util.concurrent.SynchronousQueue$TransferStack)
        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)
        at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
        at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:359)
        at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:942)
        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1068)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:724)]