[Hi,

I've provided a patch which blocks the session for the time of the redelivery. It honours the isNonBlockingRedelivery flag of the connection so it can be turned off. As blocking redelivery is the default this should not be a problem.

Cheers,

Tamas, Ive reviewed your patch Tamas and it looks fine, i'll get it committed with a couple of tests ive added, fixed with https://github.com/apache/activemq/commit/c9a3202bc3b526bdf65f239dad68f555d7b83df1, a typo in the new redelivery guard has introduced a static - stopping parallel delivery., Commit c85c7c14720dffeb44633547db540533796a8388 in activemq's branch refs/heads/master from [~gtully]
[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=c85c7c1 ]

AMQ-5400 - rework to remove static lock - impacted parallel delivery and hense performance. Fix and additional tet
]