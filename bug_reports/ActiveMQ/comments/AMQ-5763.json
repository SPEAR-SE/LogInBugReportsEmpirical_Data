[I've added a test based on your work to capture this in the unit test suite.  , I took an initial look at this and the logs thus far don't really point at the broker, it could very well be an issue on the client side. Will need to investigate more., Ok, I need to take that back, I figured out the reason and whilst the client isn't handling it particularly well the core problem is on the broker, which isn't replenishing the transaction controllers link credit. As a result it is unable to begin the 501st transaction due to using the given initial 1000 credits to declare and discharge the previous 500 transactions.

Fixed in commit https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=commit;h=fa81c1ff732fd50312ba349c8226c2d84345ad1d]