[Attached git diff and unit test.  See comments in unit test source code for how this was run with maven to reproduce., This has already been fixed on trunk.  ]