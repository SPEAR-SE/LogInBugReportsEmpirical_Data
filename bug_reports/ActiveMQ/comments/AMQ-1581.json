[I've included a patch built against a recent 5.1-SNAPSHOT source (svn rev 618082)

The file ConnectionPool.java, contains part of my fix for this issue.
The file FailoverTransport.java, includes fixes for 4 issues, including part of my fix for this issue.

The other issues that this patch includes fixes for are:

AMQ-1116
AMQ-1575
AMQ-1577
AMQ-1581

I've added comments in the code that clearly indicate which sections apply to which issue, so you can easily take edit to include only the fixes you want specifically.

Jason, Fixed by svn revision 619336]