[attached a patch which contains a unit test to demonstrate the issue. Patch created on version 1291465, added timeout to ensure consumer.receive() does not hang indefinitely, fix in http://svn.apache.org/viewvc?rev=1301565&view=rev

thanks for the great test case, makes a fix so much easier :-)]