[When I added synchronization in my JVM so that I only send one message at a time from the JVM, then the locking issue did not occur, so it is probably a locking issue in the sending part., It did not help 100%. It appears that it is still locking, also when it is reading and sending ack messages. Attaching anthoer thread dump.


"Attach Listener" daemon prio=9 tid=7fa5ad2c6000 nid=0x10ddec000 waiting on condition [00000000]
   java.lang.Thread.State: RUNNABLE

"InactivityMonitor Async Task: java.util.concurrent.ThreadPoolExecutor$Worker@2477cd9c" daemon prio=5 tid=7fa5b4bb9000 nid=0x10dce9000 waiting on condition [10dce8000]
   java.lang.Thread.State: TIMED_WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait for  <7f4f7c1f8> (a java.util.concurrent.SynchronousQueue$TransferStack)
	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:196)
	at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:424)
	at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:323)
	at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:874)
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:945)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
	at java.lang.Thread.run(Thread.java:680)

"QueueListener-10" prio=5 tid=7fa5b0038800 nid=0x10fc7e000 waiting for monitor entry [10fc7d000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)
	- waiting to lock <7f4e6d038> (a java.lang.Object)
	at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)
	at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1265)
	at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1259)
	at org.apache.activemq.ActiveMQSession.asyncSendPacket(ActiveMQSession.java:1863)
	at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2029)
	at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2024)
	at org.apache.activemq.ActiveMQMessageConsumer.acknowledge(ActiveMQMessageConsumer.java:996)
	- locked <7f51d3b30> (a java.util.LinkedList)
	at org.apache.activemq.ActiveMQMessageConsumer$5.beforeEnd(ActiveMQMessageConsumer.java:925)
	at org.apache.activemq.TransactionContext.beforeEnd(TransactionContext.java:179)
	at org.apache.activemq.TransactionContext.commit(TransactionContext.java:281)
	at org.apache.activemq.ActiveMQSession.commit(ActiveMQSession.java:560)
	at org.springframework.jms.support.JmsUtils.commitIfNecessary(JmsUtils.java:217)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.commitIfNecessary(AbstractMessageListenerContainer.java:575)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:481)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"QueueListener-9" prio=5 tid=7fa5ac34e000 nid=0x10fb7b000 waiting for monitor entry [10fb7a000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at no.nsb.kundemaster.biz.jms.JMSSendCacheUpdateMessage.sendUpdateCacheMessage(JMSSendCacheUpdateMessage.java:29)
	- waiting to lock <7f4e7f990> (a java.lang.Object)
	at no.nsb.kundemaster.biz.grind.KMGrinder$1.doInTransactionWithoutResult(KMGrinder.java:44)
	at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:130)
	at no.nsb.kundemaster.biz.grind.KMGrinder.updateKMDatabase(KMGrinder.java:39)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:41)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:20)
	at org.springframework.jms.listener.adapter.MessageListenerAdapter.onMessage(MessageListenerAdapter.java:330)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:535)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:495)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"QueueListener-8" prio=5 tid=7fa5aa98e800 nid=0x10fa78000 waiting for monitor entry [10fa77000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at no.nsb.kundemaster.biz.jms.JMSSendCacheUpdateMessage.sendUpdateCacheMessage(JMSSendCacheUpdateMessage.java:29)
	- waiting to lock <7f4e7f990> (a java.lang.Object)
	at no.nsb.kundemaster.biz.grind.KMGrinder$1.doInTransactionWithoutResult(KMGrinder.java:44)
	at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:130)
	at no.nsb.kundemaster.biz.grind.KMGrinder.updateKMDatabase(KMGrinder.java:39)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:41)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:20)
	at org.springframework.jms.listener.adapter.MessageListenerAdapter.onMessage(MessageListenerAdapter.java:330)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:535)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:495)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"QueueListener-7" prio=5 tid=7fa5ac4f1800 nid=0x10f975000 waiting for monitor entry [10f974000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at no.nsb.kundemaster.biz.jms.JMSSendCacheUpdateMessage.sendUpdateCacheMessage(JMSSendCacheUpdateMessage.java:29)
	- waiting to lock <7f4e7f990> (a java.lang.Object)
	at no.nsb.kundemaster.biz.grind.KMGrinder$1.doInTransactionWithoutResult(KMGrinder.java:44)
	at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:130)
	at no.nsb.kundemaster.biz.grind.KMGrinder.updateKMDatabase(KMGrinder.java:39)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:41)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:20)
	at org.springframework.jms.listener.adapter.MessageListenerAdapter.onMessage(MessageListenerAdapter.java:330)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:535)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:495)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"QueueListener-6" prio=5 tid=7fa5b3822000 nid=0x10e43b000 waiting for monitor entry [10e43a000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)
	- waiting to lock <7f4e6d038> (a java.lang.Object)
	at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)
	at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1265)
	at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1259)
	at org.apache.activemq.ActiveMQSession.asyncSendPacket(ActiveMQSession.java:1863)
	at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2029)
	at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2024)
	at org.apache.activemq.ActiveMQMessageConsumer.acknowledge(ActiveMQMessageConsumer.java:996)
	- locked <7f5040ff0> (a java.util.LinkedList)
	at org.apache.activemq.ActiveMQMessageConsumer$5.beforeEnd(ActiveMQMessageConsumer.java:925)
	at org.apache.activemq.TransactionContext.beforeEnd(TransactionContext.java:179)
	at org.apache.activemq.TransactionContext.commit(TransactionContext.java:281)
	at org.apache.activemq.ActiveMQSession.commit(ActiveMQSession.java:560)
	at org.springframework.jms.support.JmsUtils.commitIfNecessary(JmsUtils.java:217)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.commitIfNecessary(AbstractMessageListenerContainer.java:575)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:481)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"QueueListener-5" prio=5 tid=7fa5ac619800 nid=0x10f872000 waiting for monitor entry [10f871000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)
	- waiting to lock <7f4e6d038> (a java.lang.Object)
	at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)
	at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1265)
	at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1259)
	at org.apache.activemq.ActiveMQSession.asyncSendPacket(ActiveMQSession.java:1863)
	at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2029)
	at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2024)
	at org.apache.activemq.ActiveMQMessageConsumer.acknowledge(ActiveMQMessageConsumer.java:996)
	- locked <7f5042070> (a java.util.LinkedList)
	at org.apache.activemq.ActiveMQMessageConsumer$5.beforeEnd(ActiveMQMessageConsumer.java:925)
	at org.apache.activemq.TransactionContext.beforeEnd(TransactionContext.java:179)
	at org.apache.activemq.TransactionContext.commit(TransactionContext.java:281)
	at org.apache.activemq.ActiveMQSession.commit(ActiveMQSession.java:560)
	at org.springframework.jms.support.JmsUtils.commitIfNecessary(JmsUtils.java:217)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.commitIfNecessary(AbstractMessageListenerContainer.java:575)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:481)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"QueueListener-4" prio=5 tid=7fa5aabc9000 nid=0x10f76f000 waiting for monitor entry [10f76e000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)
	- waiting to lock <7f4e6d038> (a java.lang.Object)
	at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)
	at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1265)
	at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1259)
	at org.apache.activemq.ActiveMQSession.asyncSendPacket(ActiveMQSession.java:1863)
	at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2029)
	at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2024)
	at org.apache.activemq.ActiveMQMessageConsumer.acknowledge(ActiveMQMessageConsumer.java:996)
	- locked <7f514f1a0> (a java.util.LinkedList)
	at org.apache.activemq.ActiveMQMessageConsumer$5.beforeEnd(ActiveMQMessageConsumer.java:925)
	at org.apache.activemq.TransactionContext.beforeEnd(TransactionContext.java:179)
	at org.apache.activemq.TransactionContext.commit(TransactionContext.java:281)
	at org.apache.activemq.ActiveMQSession.commit(ActiveMQSession.java:560)
	at org.springframework.jms.support.JmsUtils.commitIfNecessary(JmsUtils.java:217)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.commitIfNecessary(AbstractMessageListenerContainer.java:575)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:481)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"QueueListener-3" prio=5 tid=7fa5ad3e2800 nid=0x10f66c000 runnable [10f66a000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketOutputStream.socketWrite0(Native Method)
	at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
	at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
	at org.apache.activemq.transport.tcp.TcpBufferedOutputStream.write(TcpBufferedOutputStream.java:96)
	at java.io.DataOutputStream.write(DataOutputStream.java:90)
	- locked <7f5099de0> (a java.io.DataOutputStream)
	at org.apache.activemq.openwire.v7.BaseDataStreamMarshaller.tightMarshalByteSequence2(BaseDataStreamMarshaller.java:431)
	at org.apache.activemq.openwire.v7.MessageMarshaller.tightMarshal2(MessageMarshaller.java:180)
	at org.apache.activemq.openwire.v7.ActiveMQMessageMarshaller.tightMarshal2(ActiveMQMessageMarshaller.java:89)
	at org.apache.activemq.openwire.v7.ActiveMQTextMessageMarshaller.tightMarshal2(ActiveMQTextMessageMarshaller.java:89)
	at org.apache.activemq.openwire.OpenWireFormat.marshal(OpenWireFormat.java:237)
	- locked <7f4f9dba8> (a org.apache.activemq.openwire.OpenWireFormat)
	at org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:181)
	at org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:254)
	- locked <7f4e6d0c8> (a java.util.concurrent.atomic.AtomicBoolean)
	at org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:85)
	at org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:104)
	at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)
	- locked <7f4e6d038> (a java.lang.Object)
	at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)
	at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1265)
	at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1259)
	at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1744)
	- locked <7f4e50c90> (a java.lang.Object)
	at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:231)
	at org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:241)
	at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:592)
	at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:569)
	at org.springframework.jms.core.JmsTemplate$4.doInJms(JmsTemplate.java:546)
	at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:466)
	at org.springframework.jms.core.JmsTemplate.send(JmsTemplate.java:543)
	at org.springframework.jms.core.JmsTemplate.convertAndSend(JmsTemplate.java:620)
	at no.nsb.kundemaster.biz.jms.JMSSendCacheUpdateMessage.sendUpdateCacheMessage(JMSSendCacheUpdateMessage.java:29)
	- locked <7f4e7f990> (a java.lang.Object)
	at no.nsb.kundemaster.biz.grind.KMGrinder$1.doInTransactionWithoutResult(KMGrinder.java:44)
	at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:130)
	at no.nsb.kundemaster.biz.grind.KMGrinder.updateKMDatabase(KMGrinder.java:39)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:41)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:20)
	at org.springframework.jms.listener.adapter.MessageListenerAdapter.onMessage(MessageListenerAdapter.java:330)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:535)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:495)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"http-8080-Acceptor-0" daemon prio=5 tid=7fa5ae526800 nid=0x10f569000 runnable [10f568000]
   java.lang.Thread.State: RUNNABLE
	at java.net.PlainSocketImpl.socketAccept(Native Method)
	at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:408)
	- locked <7f4dd1a68> (a java.net.SocksSocketImpl)
	at java.net.ServerSocket.implAccept(ServerSocket.java:462)
	at java.net.ServerSocket.accept(ServerSocket.java:430)
	at org.apache.tomcat.util.net.DefaultServerSocketFactory.acceptSocket(DefaultServerSocketFactory.java:61)
	at org.apache.tomcat.util.net.JIoEndpoint$Acceptor.run(JIoEndpoint.java:352)
	at java.lang.Thread.run(Thread.java:680)

"ContainerBackgroundProcessor[StandardEngine[localEngine]]" daemon prio=5 tid=7fa5ae1b6800 nid=0x10f466000 waiting on condition [10f465000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
	at java.lang.Thread.sleep(Native Method)
	at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1579)
	at java.lang.Thread.run(Thread.java:680)

"QueueListener-2" prio=5 tid=7fa5ad3d2000 nid=0x10f260000 waiting for monitor entry [10f25f000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at no.nsb.kundemaster.biz.jms.JMSSendCacheUpdateMessage.sendUpdateCacheMessage(JMSSendCacheUpdateMessage.java:29)
	- waiting to lock <7f4e7f990> (a java.lang.Object)
	at no.nsb.kundemaster.biz.grind.KMGrinder$1.doInTransactionWithoutResult(KMGrinder.java:44)
	at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:130)
	at no.nsb.kundemaster.biz.grind.KMGrinder.updateKMDatabase(KMGrinder.java:39)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:41)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:20)
	at org.springframework.jms.listener.adapter.MessageListenerAdapter.onMessage(MessageListenerAdapter.java:330)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:535)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:495)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"QueueListenerTest-1" prio=5 tid=7fa5ac758800 nid=0x10ec63000 in Object.wait() [10ec62000]
   java.lang.Thread.State: TIMED_WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <7f4f91bd0> (a java.lang.Object)
	at org.apache.activemq.SimplePriorityMessageDispatchChannel.dequeue(SimplePriorityMessageDispatchChannel.java:89)
	- locked <7f4f91bd0> (a java.lang.Object)
	at org.apache.activemq.ActiveMQMessageConsumer.dequeue(ActiveMQMessageConsumer.java:452)
	at org.apache.activemq.ActiveMQMessageConsumer.receive(ActiveMQMessageConsumer.java:577)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveMessage(AbstractPollingMessageListenerContainer.java:429)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:310)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"ActiveMQ Transport: tcp://localhost/127.0.0.1:61616" prio=5 tid=7fa5ac544000 nid=0x10eb60000 runnable [10eb5f000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(SocketInputStream.java:129)
	at org.apache.activemq.transport.tcp.TcpBufferedInputStream.fill(TcpBufferedInputStream.java:50)
	at org.apache.activemq.transport.tcp.TcpTransport$2.fill(TcpTransport.java:576)
	at org.apache.activemq.transport.tcp.TcpBufferedInputStream.read(TcpBufferedInputStream.java:58)
	at org.apache.activemq.transport.tcp.TcpTransport$2.read(TcpTransport.java:561)
	at java.io.DataInputStream.readInt(DataInputStream.java:370)
	at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:269)
	at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:227)
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:219)
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:202)
	at java.lang.Thread.run(Thread.java:680)

"ActiveMQConnection[ID:Knut-Erik-Borgens-MacBook-Pro.local-61735-1322227882119-0:2] Scheduler" daemon prio=5 tid=7fa5ae149000 nid=0x10e8f1000 in Object.wait() [10e8f0000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <7f4f57ac0> (a java.util.TaskQueue)
	at java.lang.Object.wait(Object.java:485)
	at java.util.TimerThread.mainLoop(Timer.java:483)
	- locked <7f4f57ac0> (a java.util.TaskQueue)
	at java.util.TimerThread.run(Timer.java:462)

"InactivityMonitor WriteCheck" daemon prio=5 tid=7fa5ac543800 nid=0x10e7ee000 in Object.wait() [10e7ed000]
   java.lang.Thread.State: TIMED_WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <7f4fa1ac8> (a java.util.TaskQueue)
	at java.util.TimerThread.mainLoop(Timer.java:509)
	- locked <7f4fa1ac8> (a java.util.TaskQueue)
	at java.util.TimerThread.run(Timer.java:462)

"InactivityMonitor ReadCheck" daemon prio=5 tid=7fa5ac77e800 nid=0x10e6eb000 in Object.wait() [10e6ea000]
   java.lang.Thread.State: TIMED_WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <7f4dc2430> (a java.util.TaskQueue)
	at java.util.TimerThread.mainLoop(Timer.java:509)
	- locked <7f4dc2430> (a java.util.TaskQueue)
	at java.util.TimerThread.run(Timer.java:462)

"QueueListener-1" prio=5 tid=7fa5b3884000 nid=0x10e5e8000 waiting for monitor entry [10e5e7000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at no.nsb.kundemaster.biz.jms.JMSSendCacheUpdateMessage.sendUpdateCacheMessage(JMSSendCacheUpdateMessage.java:29)
	- waiting to lock <7f4e7f990> (a java.lang.Object)
	at no.nsb.kundemaster.biz.grind.KMGrinder$1.doInTransactionWithoutResult(KMGrinder.java:44)
	at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:130)
	at no.nsb.kundemaster.biz.grind.KMGrinder.updateKMDatabase(KMGrinder.java:39)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:41)
	at no.nsb.kundemaster.biz.jms.QueueListenerBiz.onMessage(QueueListenerBiz.java:20)
	at org.springframework.jms.listener.adapter.MessageListenerAdapter.onMessage(MessageListenerAdapter.java:330)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:535)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:495)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)
	at java.lang.Thread.run(Thread.java:680)

"ActiveMQ Transport: tcp://localhost/127.0.0.1:61616" prio=5 tid=7fa5b3883000 nid=0x10e28a000 runnable [10e289000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(SocketInputStream.java:129)
	at org.apache.activemq.transport.tcp.TcpBufferedInputStream.fill(TcpBufferedInputStream.java:50)
	at org.apache.activemq.transport.tcp.TcpTransport$2.fill(TcpTransport.java:576)
	at org.apache.activemq.transport.tcp.TcpBufferedInputStream.read(TcpBufferedInputStream.java:58)
	at org.apache.activemq.transport.tcp.TcpTransport$2.read(TcpTransport.java:561)
	at java.io.DataInputStream.readInt(DataInputStream.java:370)
	at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:269)
	at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:227)
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:219)
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:202)
	at java.lang.Thread.run(Thread.java:680)

"ActiveMQConnection[ID:Knut-Erik-Borgens-MacBook-Pro.local-61735-1322227882119-0:1] Scheduler" daemon prio=5 tid=7fa5aadec800 nid=0x10dbe6000 in Object.wait() [10dbe5000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <7f4f286c0> (a java.util.TaskQueue)
	at java.lang.Object.wait(Object.java:485)
	at java.util.TimerThread.mainLoop(Timer.java:483)
	- locked <7f4f286c0> (a java.util.TaskQueue)
	at java.util.TimerThread.run(Timer.java:462)

"Poller SunPKCS11-Darwin" daemon prio=1 tid=7fa5ae4c0800 nid=0x10df59000 waiting on condition [10df58000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
	at java.lang.Thread.sleep(Native Method)
	at sun.security.pkcs11.SunPKCS11$TokenPoller.run(SunPKCS11.java:692)
	at java.lang.Thread.run(Thread.java:680)

"com.google.inject.internal.util.$Finalizer" daemon prio=5 tid=7fa5aa916000 nid=0x10d9bf000 in Object.wait() [10d9be000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <7f44e1278> (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)
	- locked <7f44e1278> (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)
	at com.google.inject.internal.util.$Finalizer.run(Finalizer.java:144)
	at java.lang.Thread.run(Thread.java:680)

"Low Memory Detector" daemon prio=5 tid=7fa5ae00b800 nid=0x10d499000 runnable [00000000]
   java.lang.Thread.State: RUNNABLE

"C2 CompilerThread1" daemon prio=9 tid=7fa5ae00a800 nid=0x10d396000 waiting on condition [00000000]
   java.lang.Thread.State: RUNNABLE

"C2 CompilerThread0" daemon prio=9 tid=7fa5ae00a000 nid=0x10d293000 waiting on condition [00000000]
   java.lang.Thread.State: RUNNABLE

"Signal Dispatcher" daemon prio=9 tid=7fa5ae009000 nid=0x10d190000 runnable [00000000]
   java.lang.Thread.State: RUNNABLE

"Surrogate Locker Thread (Concurrent GC)" daemon prio=5 tid=7fa5ae008000 nid=0x10d08d000 waiting on condition [00000000]
   java.lang.Thread.State: RUNNABLE

"Finalizer" daemon prio=8 tid=7fa5ac13f000 nid=0x10cdc9000 in Object.wait() [10cdc8000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <7f44e18f8> (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)
	- locked <7f44e18f8> (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)
	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)

"Reference Handler" daemon prio=10 tid=7fa5ac13e000 nid=0x10ccc6000 in Object.wait() [10ccc5000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <7f44e12a8> (a java.lang.ref.Reference$Lock)
	at java.lang.Object.wait(Object.java:485)
	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)
	- locked <7f44e12a8> (a java.lang.ref.Reference$Lock)

"main" prio=5 tid=7fa5ac000800 nid=0x104f4e000 in Object.wait() [104f4c000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <7f50df3e8> (a java.lang.Object)
	at java.lang.Object.wait(Object.java:485)
	at org.codehaus.mojo.tomcat.AbstractRunMojo.waitIndefinitely(AbstractRunMojo.java:622)
	- locked <7f50df3e8> (a java.lang.Object)
	at org.codehaus.mojo.tomcat.AbstractRunMojo.execute(AbstractRunMojo.java:258)
	at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:101)
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:209)
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153)
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145)
	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:84)
	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:59)
	at org.apache.maven.lifecycle.internal.LifecycleStarter.singleThreadedBuild(LifecycleStarter.java:183)
	at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:161)
	at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:319)
	at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:156)
	at org.apache.maven.cli.MavenCli.execute(MavenCli.java:537)
	at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:196)
	at org.apache.maven.cli.MavenCli.main(MavenCli.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:290)
	at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:230)
	at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:409)
	at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:352)

"VM Thread" prio=9 tid=7fa5ac139800 nid=0x10cbc3000 runnable 

"Gang worker#0 (Parallel GC Threads)" prio=9 tid=7fa5ac002000 nid=0x108287000 runnable 

"Gang worker#1 (Parallel GC Threads)" prio=9 tid=7fa5ac002800 nid=0x10838a000 runnable 

"Gang worker#2 (Parallel GC Threads)" prio=9 tid=7fa5ac003000 nid=0x10848d000 runnable 

"Gang worker#3 (Parallel GC Threads)" prio=9 tid=7fa5ac004000 nid=0x108590000 runnable 

"Gang worker#4 (Parallel GC Threads)" prio=9 tid=7fa5ac004800 nid=0x108693000 runnable 

"Gang worker#5 (Parallel GC Threads)" prio=9 tid=7fa5ac005000 nid=0x108796000 runnable 

"Gang worker#6 (Parallel GC Threads)" prio=9 tid=7fa5ac005800 nid=0x108899000 runnable 

"Gang worker#7 (Parallel GC Threads)" prio=9 tid=7fa5ac006800 nid=0x10899c000 runnable 

"Concurrent Mark-Sweep GC Thread" prio=9 tid=7fa5ac0e3800 nid=0x10c868000 runnable 
"Gang worker#0 (Parallel CMS Threads)" prio=9 tid=7fa5ac0e2800 nid=0x10be62000 runnable 

"Gang worker#1 (Parallel CMS Threads)" prio=9 tid=7fa5ac0e3000 nid=0x10bf65000 runnable 

"VM Periodic Task Thread" prio=10 tid=7fa5ae01d000 nid=0x10d59c000 waiting on condition 

"Exception Catcher Thread" prio=10 tid=7fa5ac001800 nid=0x1050b0000 runnable 
, It was my home directory that became full. ActiveMQ kept waiting for space to be released., I may have been a bit quick to state that my disk was full. It is not. It looks full as the df command gives me this:

Filesystem                        512-blocks      Used Available Capacity  Mounted on
/dev/disk0s2                       488555536 139163104 348880432    29%    /
devfs                                    368       368         0   100%    /dev
map -hosts                                 0         0         0   100%    /net
map auto_home                              0         0         0   100%    /home
localhost:/6w3-eOUytccxowd7SVDFIE  488555536 488555536         0   100%    /Volumes/MobileBackups

...but this is mac os fooling me. If I actually do:

Knut-Erik-Borgens-MacBook-Pro:kode knutbo$ df .
Filesystem   512-blocks      Used Available Capacity  Mounted on
/dev/disk0s2  488555536 139163104 348880432    29%    /

I see that I have plenty of disk space left. So this must be some other issue after all., Memory limits are working as expected. Some more detail in http://activemq.apache.org/producer-flow-control.html]