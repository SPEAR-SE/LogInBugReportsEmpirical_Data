[This test will create two brokers in a shared filesystem/Master-Slave configuration. A connection is established to the master broker. The master broker is then stopped. The client reconnects to the slave. However, no messages will be delivered to the MessageEndpoint., This issue looks similar to AMQ-2743 that is filed against 5.3.1 that did not exist in 5.3.0. , Interesting. Thanks Bruce.

By the way, you need to clear out the message log (e.g. 'rm -rf activemq-data/'), if you're running this test multiple times. Otherwise, an undelivered message in the message log is delivered to the client (prior to the failover). Is there a programatic way to clear the log during Junit setup?, I ran my test on 5.3.0 and 5.3.1. I see the same behavior that Bruce describes. Works on 5.3.0. Does not work on 5.3.1., resolved in r954972
same issue as https://issues.apache.org/activemq/browse/AMQ-2772 just that the fix needed a rework such that connectionConsumers can have their prefetch reinstated.

There may be a need to do some interruption processing on the RA connection consumers, in the same way that a regular consumer needs to deal with the duplicate checker. We can cross that bridge when we come to it. For the moment, the connectionConsumers just allow immediate redelivery without doing any additional work, btw, thanks for the good test., Works great. Thanks Gary!]