[Any idea how to resolve the issue? Maybe there is some workaround? Switching to KahaDB is not an option in my case., Any chance you can replicate the usage pattern in some test code or maybe with trace=true on the transport connector broker side such that every command will be logged.

This looks maybe like some contention between add and prepare. Are there multiple connections involved in a single XA transaction. The TM(aries) will treat them as a single resource based on the broker id but maybe there is some ordering issue. There is an option to have each connection represent a separate resource - maybe that would workaround - use "tcp://host:port?jms.rmIdFromConnectionId=true" on the broker url for your connection factory, Thank you for your answer, I'll try and test the workaround as the setting hasn't be used., It seams that the workaround has helped.]