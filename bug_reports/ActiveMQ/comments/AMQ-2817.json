[Patch against trunk to clean up the header along with a unit test, Patch applied (svn revision 962512) with thanks!]