[Test attached, thanks for the test case. I made some mods as the override of min message size is only relevant to the broker. The size is calculated on demand for consumers.
committed in r904585, one more thing, just for completeness, the properties were not marshaled by default with the vm transport so they did not appear in the size calculation. adding marshall=true to the vm url ensured they were part of the calculation.]