[Updated version of BrokerXmlConfigStartTest, Patch looks good.  Applied it, lets see how the next run goes. , Hi Tim,

Unfortunately this just failed again on the Fuse Hudson.  Is there anyway to definitively know shutdown has completed after calling broker.stop(), or should I just try writing a retry loop around broker.start?

Kevin



, I just added a call to broker.waitUntilStopped() to trunk.  Its a bit tricky because those ports need to be freed and back into a reusable state.  , The issue seems to be that the WebappContext created for the Webconsole isn't getting shutdown all the time or at least not in a timely fashion when the broker is stopped.  Haven't found a simple way to enforce that from the unit test.  , I *think* I've found the problem.  activemq-stomp.xml did not have a shutdown hook for Jetty.  I'll attach a patch.
, Adds a shutdown hook for jetty to activemq-stomp.xml
, Yep, that's probably it.  Patch applied, thanks!, Fixed now on both my test platforms, was failing on both previously. ]