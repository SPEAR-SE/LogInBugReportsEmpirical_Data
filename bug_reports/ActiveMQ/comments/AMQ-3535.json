[I think that ack should always be an individual ack, not one that matches all preceding messages. So MessageAck.INDIVIDUAL_ACK_TYPE. Can you validate that?

Any chance that you have a test case?

note: when you provide a patch, you need to attach the patch file and tick the check box to license grant on the file upload form. Otherwise we can't commit it., I will attach a better patch.  What you say makes sense, and I will test only using MessageAck.INDIVIDUAL_ACK_TYPE.  I have just discovered this and am not sure how to reproduce in a test case.  I found it in a integration test that has multiple processes.  I'll see what I can do.  This occurs after a master/slave failover.  Do you want the patch without the test case or would you rather wait?, removing (incomplete) patch that was in description, A patch with a junit test would be ideal :-) Thanks for the contribution, much appreciated.

Have a peek at org.apache.activemq.transport.failover.FailoverTransactionTest for some inspiration.
In any event I think you found a bug, but I am interested to understand how the inflight and dequeue counts get out of sync., Ok.  I will work on a test.  BTW, what I meant about the counts being wrong is that they don't reflect the reality of what has occurred (at least from the client point of view).  , Fix by AMQ-3568 from what I can tell.  No test case on this issue to confirm it solves all the reporters issues. ]