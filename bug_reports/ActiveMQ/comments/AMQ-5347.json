[Attached a proposed patch against the latest code on github for the persistJMSRedelivered issue.

Also, attached a new unit test that passes when run from activemq-unit-tests after the fix is applied., thanks for the test case and patch. I decided to keep the broker interface as is b/c lots of folks have their own plugins so the exception is propagated via a runtime exception. The exception kills the connection and hence the consumer and the delivery failure is properly accounted for.
A variant of your test where the broker remains alive exposed another issue with the redelivery flag and dispatch ordering. That is also sorted with
http://git-wip-us.apache.org/repos/asf/activemq/commit/52e1a05a , Great thanks.  Killing the connection was the important thing and the runtime exception looks like it accomplishes that.  Originally, I looked at a way to sneak the exception through the interface since changing would impact so many files/plugins but ended up just submitting the patch so that the intent was clear.  Glad you were able to get this in.]