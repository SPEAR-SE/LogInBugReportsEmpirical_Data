[These issues are now resolved apart from this one remaining issue; that ACKs rolled back in a transaction do not cause the messages to be redispatched; as the default in 4.x is for the client side to do this, tests are all working now. I added client side redelivery of ACK'd messages on rollback (abort in the ruby client)]