[patch applied to r953696 with an additional test case. We may need some additional MDB tests that validate transaction semantics in the event of failover and no redelivery but the existing rollback logic with a timeout should suffice.
In any event, this change will prevent the block with was just plain wrong. nice catch, thanks.]