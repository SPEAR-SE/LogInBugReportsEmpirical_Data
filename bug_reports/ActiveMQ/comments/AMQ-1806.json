[We also have this issue, using ActiveMQ 5.1.0 and 5.2-SNAPSHOT-20080619 on Windows.
Both as embedded and using the default runtime environment, 
using both Kaha and Jdbc(DB2) persistence,
using a single or multple consumers.

This works fine with ActiveMQ 5.0.0.

To reproduce, put the following in a queue:
  100 messages matching your selector
  100 messages not matching your selector
  100 messages matching your selector

The consumers only retrieve the first 100 messages.

Using 98 instead of 100 messages above seems to always work correctly.
With 99 messages we have mixed results.
, Hi,  when will be fix coming for this bug??, Issue lacks a test case to validate that a problem exists.]