[fix and test added on trunk. ]