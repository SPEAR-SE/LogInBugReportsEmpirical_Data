[The patch is no longer applicable to the current code as much has changed in this class.  ]