[This is the brokers log with level="DEBUG" for 10:57 to 11:13 today. We managed to reproduce the bug in error.queue at approximately 11:12 when we moved 29 messages from the queue foo.bar to error.queue. At the time, error.queue had 2 messages. These are still reachable. The other 29 are in the database, but not reachable. Neither foo.bar or error.queue has consumers, both are viewed only through the use of QueueViewMBeans., Moving the retrievable messages to a different queue seemed to resolve the problem in this case - once the retrievable messages were moved, the missing messages became visible on the queue. Could this be related to caching in some way? , This seems to be manifesting in two different ways. I was able to create a situtation in which a queue reported to having -219 messages. I did this by starting 3 jobs simultaneously that tried to move the same 400 messages from one queue to another by calling QueueViewMBean.moveMessageTo. All 400 messages were moved, but afterwards the queue had very different enqueuecount and dequeuecount. Neither queue had consumers aside from these jobs. Sending messages to the broken queue resulted in the amount of messages in the queue increasing, but they were not visible through the use of QueueViewMBean.browse. Using QueueViewMBean.getMessage, I was able to obtain the messages by JMSMessageID. After sending 13 messages to the queue, I found a log entry saying toPageIn=13 for this queue.

Thinking I had a workaround for the issue by fetching the message ids from the broker database, I did a quick experiment with another broken queue. I was not able to extract messages from this one, using the same method. In this case, both dequeuecount and enqueuecount were 0. toPageIn=200 for this queue.]