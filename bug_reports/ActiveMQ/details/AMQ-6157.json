{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12936727","self":"https://issues.apache.org/jira/rest/api/2/issue/12936727","key":"AMQ-6157","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2016-02-04T14:43:03.152+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Feb 05 13:30:42 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_86326761_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-02-05T13:30:41.977+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6157/watchers","watchCount":2,"isWatching":false},"created":"2016-02-04T13:31:55.252+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-02-05T13:30:42.011+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have configured several brokers and sometimes one of them is not available when the application server is started.\nWhen left running the amount of threads slowly builds up, depending how often reconnect fails, and consumes more and more memory\n\nTo reproduce I have deliberately configured failover with a host that is not reachable \n{code}\nfailover:(tcp://host.not.found:1234?keepAlive=true&amp;wireFormat.maxInactivityDuration=0&amp;daemon=true)?maxReconnectAttempts=2&amp;startupMaxReconnectAttempts=1)\n{code}\n\nWhen I start Tomee, AMQ is not able to connect as expected\n{code}\nFeb 04, 2016 1:13:27 PM org.apache.activemq.transport.failover.FailoverTransport doReconnect\nSEVERE: Failed to connect to [tcp://host.not.found:6523?keepAlive=true&wireFormat.maxInactivityDuration=0&daemon=true] after: 1 attempt(s)\n{code}\n\n\nFor each reconnect attempt a new thread is created and left waiting for a lock. These threads seem to wait indefinately\n{code}\n\"ActiveMQ Connection Executor: unconnected\" #75 daemon prio=5 os_prio=0 tid=0x00007f083c040000 nid=0xfaa waiting on condition [0x00007f0824fc1000]\n   java.lang.Thread.State: WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0x00000000c080aa78> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)\n        at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)\n        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n{code}\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12786254","id":"12786254","filename":"broker-config.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-04T13:35:31.981+0000","size":1458,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12786254/broker-config.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12786253","id":"12786253","filename":"jstack.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-04T13:35:08.495+0000","size":48770,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12786253/jstack.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12786257","id":"12786257","filename":"tomee.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-04T13:36:48.114+0000","size":372,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12786257/tomee.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Thread leak when failover fails to connect at startup","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Tomee plus 1.7.2 which includes ActiveMQ 5.10.0\n\nLinux tomee 3.13.0-49-generic #83-Ubuntu SMP Fri Apr 10 20:11:33 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n\njava version \"1.8.0_66\"\nJava(TM) SE Runtime Environment (build 1.8.0_66-b17)\nJava HotSpot(TM) 64-Bit Server VM (build 25.66-b17, mixed mode)\n\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12936727/comment/15132333","id":"15132333","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"body":"Attached by ActiveMQ configuration and full dump from jstack","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-04T13:38:01.810+0000","updated":"2016-02-04T13:38:01.810+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12936727/comment/15132405","id":"15132405","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"This seems to be the result of you not closing failed connections.  Since you've set the maxReconnectAttempts=2 the transport will only try to connect twice before giving up, at which point you need to handle the exception from the connection failure and close the connection. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-02-04T14:43:03.152+0000","updated":"2016-02-04T14:43:03.152+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12936727/comment/15132472","id":"15132472","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"body":"At this point I haven't deployed any of my code, only a clean installation of Tomee plus with some jars added for spring bean support, and with the configuration attached","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-04T15:47:59.223+0000","updated":"2016-02-04T15:47:59.223+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12936727/comment/15133070","id":"15133070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I see, you are using the failover transport bits with the JMS Bridge.  The bridge has it's own reconnection logic so you don't actually need to use failover here, and I'd guess there's some side effect that is causing the bridge to malfunction because of the use of the failover transport.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-02-04T21:29:27.798+0000","updated":"2016-02-04T21:29:27.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12936727/comment/15133392","id":"15133392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I did some trivial testing and cannot reproduce this using the latest codebase, try moving from 5.10.0 to something more current and see how it goes.  If you can create a JUnit test that reproduces that problem I'm happy to look into it more.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-02-05T00:17:51.513+0000","updated":"2016-02-05T00:17:51.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12936727/comment/15134170","id":"15134170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"body":"You are right, the problem is not in the failover but in the JMS bridge, or the use of both in combination. Since failover is not needed here it does not seem like a real problem.\n\nThanks for your help\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Astron","name":"Astron","key":"astron","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-05T13:30:42.004+0000","updated":"2016-02-05T13:30:42.004+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6157/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2sf8v:"}}