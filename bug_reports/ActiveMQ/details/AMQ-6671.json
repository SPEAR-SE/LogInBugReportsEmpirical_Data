{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13069893","self":"https://issues.apache.org/jira/rest/api/2/issue/13069893","key":"AMQ-6671","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/10004","id":"10004","description":"Not A Bug","name":"Not A Bug"},"customfield_12312322":null,"customfield_12310220":"2017-05-08T13:22:35.071+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu May 11 05:05:37 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_250787175_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-05-11T05:06:15.390+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6671/watchers","watchCount":3,"isWatching":false},"created":"2017-05-08T07:26:28.254+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-05-11T05:06:15.421+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12324803","id":"12324803","name":"JDBC"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Using ActiveMQv5.11.1 \n\nI ran a test case where a durable subscriber was listening from a topic and a publisher is publishing persistent messages. I observed that the messages were stored in the DB (ACTIVEMQ_MSGS table) but even after successful consumption by the consumer, these messages were not deleted from the backend DB. However I have seen that this doesn't happen in case of queue. Persistent messages sent to a queue are automatically deleted from the DB once successfully consumed by the consumer. \n\nMore details: \n\n1. 1 producer 1 durable subscriber. Subscriber is in auto_ack mode. \n2. Producer sent 100 persistent messages to consumer \n3. Consumer successfully consumed them. \n4. DB still has those messages. \n5. Stop producer and consumer both, but messages are still there. \n6. Even after restarting broker, message does not get deleted. \n\n\nThis is a very generic use case which should never happen. It is also reproducible.\n\nThanks, \nAnuj","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":" ActiveMQ with PostgreSQL: Not deleting persistent messages sent to a topic","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal90","name":"anujkhandelwal90","key":"anujkhandelwal90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal90","name":"anujkhandelwal90","key":"anujkhandelwal90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069893/comment/16000720","id":"16000720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You need to test against the latest release 5.14.5 as this release is quite old and not supported any longer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-05-08T13:22:35.071+0000","updated":"2017-05-08T13:22:35.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069893/comment/16000848","id":"16000848","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal90","name":"anujkhandelwal90","key":"anujkhandelwal90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"body":"I have tested against 5.14.5 and still the same issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal90","name":"anujkhandelwal90","key":"anujkhandelwal90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-08T14:45:47.559+0000","updated":"2017-05-08T14:45:47.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069893/comment/16002708","id":"16002708","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal90","name":"anujkhandelwal90","key":"anujkhandelwal90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"body":"Any plans to fix this as this is a major bug for anyone who is using JDBC (postgreSQL).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal90","name":"anujkhandelwal90","key":"anujkhandelwal90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-09T13:49:52.142+0000","updated":"2017-05-09T13:49:52.142+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069893/comment/16002721","id":"16002721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The best way (and probably fastest) to get it fixed is to do it yourself.  The code is open and you can dive in with a debugger and see what's going on for your case.  Most folks don't have access to a running PostgreSQL instance and aren't going to be able to investigate where you can, so dive in.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-05-09T13:56:38.522+0000","updated":"2017-05-09T13:56:38.522+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069893/comment/16002772","id":"16002772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~anujkhandelwal90] it may be that the cleanup task needs to run a few times. messages for durable subs that are unreferenced are deleted periodically with the cleanupPeriod which defaults to 5mins. Then there is an iteration per each priority 1-10, messages with default priority 4 may take 20mins to clear by default\n\nsee: https://github.com/apache/activemq/blob/57795bafcea290c6879bb288822435c480a9212d/activemq-jdbc-store/src/main/java/org/apache/activemq/store/jdbc/adapter/DefaultJDBCAdapter.java#L829","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-09T14:27:35.568+0000","updated":"2017-05-09T14:28:43.478+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069893/comment/16005891","id":"16005891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal90","name":"anujkhandelwal90","key":"anujkhandelwal90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"body":"[~gtully] Thanks for sharing this info. Indeed , this was the reason. \n\nI didn't ran the broker for required time and keep stopping it in between, that's why those messages were not getting cleared, I retested it and ran it for long time, it was automatically cleaning up the data. \n\nThanks again for your help Gary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal90","name":"anujkhandelwal90","key":"anujkhandelwal90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-11T05:05:37.194+0000","updated":"2017-05-11T05:05:37.194+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6671/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3em93:"}}