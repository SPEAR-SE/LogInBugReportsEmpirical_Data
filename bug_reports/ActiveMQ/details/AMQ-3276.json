{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12503739","self":"https://issues.apache.org/jira/rest/api/2/issue/12503739","key":"AMQ-3276","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-04-08T16:21:59.519+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Aug 16 13:31:36 UTC 2011","customfield_12310420":"14624","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_9276140_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-04-08T16:21:59.510+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3276/watchers","watchCount":1,"isWatching":false},"created":"2011-04-08T13:47:23.387+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-09-20T10:42:06.912+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We just migrated from ActiveMQ 5.4.2 to ActiveMQ 5.5.0.  So far so good, with one exception (pun not intended).  In one case where we have an embedded broker, we're seeing this exception get logged on occasion:\n\nWARNING; 08-Apr-2011 11:11:41; tid:45931; TransportConnection stopAsync; cannot create async transport stopper thread.. not waiting for stop to complete, reason:\njava.util.ConcurrentModificationException\n        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)\n        at java.util.HashMap$EntryIterator.next(HashMap.java:834)\n        at java.util.HashMap$EntryIterator.next(HashMap.java:832)\n        at java.util.HashMap.putAllForCreate(HashMap.java:435)\n        at java.util.HashMap.<init>(HashMap.java:225)\n        at org.slf4j.helpers.BasicMDCAdapter.getCopyOfContextMap(BasicMDCAdapter.java:130)\n        at org.slf4j.MDC.getCopyOfContextMap(MDC.java:182)\n        at org.apache.activemq.util.MDCHelper.getCopyOfContextMap(MDCHelper.java:30)\n        at org.apache.activemq.broker.TransportConnection.stopAsync(TransportConnection.java:946)\n        at org.apache.activemq.broker.TransportConnection.processShutdown(TransportConnection.java:353)\n        at org.apache.activemq.command.ShutdownInfo.visit(ShutdownInfo.java:35)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:306)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:218)\n        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:127)\n        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:48)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:662)\n\nUp until this morning, I had only seen that logged during shutdown of the app context.  But just now, it popped out independently, out of the blue.\n\nFor what it's worth, here's the app context config:\n\n \n  <broker xmlns=\"http://activemq.apache.org/schema/core\"\n          id=\"embeddedActivemqBroker\"\n          useJmx=\"true\"\n          persistent=\"true\"\n          schedulerSupport=\"false\"\n          advisorySupport=\"false\"\n          enableStatistics=\"true\">\n    <destinationPolicy>\n      <policyMap>\n        <policyEntries>\n          <policyEntry queue=\">\" producerFlowControl=\"false\" memoryLimit=\"20mb\"/>\n        </policyEntries>\n      </policyMap>\n    </destinationPolicy>\n    <persistenceAdapter>\n      <kahaDB directory=\"${EmbeddedBroker.dataDirectory}\"\n              concurrentStoreAndDispatchQueues=\"false\"/>\n    </persistenceAdapter>\n  </broker>\n\nHas anybody else seen this ConcurrentModificationException happening with 5.5.0 (or otherwise)?  Any ideas?\n\nI suppose I should also mention that we're using slf4j 1.6.1.  Not sure if that has anything to do with this, since the stack trace does show it happening in slf4j land...\n\n    <dependency>\n      <groupId>org.slf4j</groupId>\n      <artifactId>slf4j-api</artifactId>\n      <version>1.6.1</version>\n      <scope>runtime</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.slf4j</groupId>\n      <artifactId>slf4j-jdk14</artifactId>\n      <version>1.6.1</version>\n      <scope>runtime</scope>\n    </dependency> ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59439","customfield_12312823":null,"summary":"ConcurrentModificationException in embedded 5.5.0 broker","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dcheckoway","name":"dcheckoway","key":"dcheckoway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Checkoway","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dcheckoway","name":"dcheckoway","key":"dcheckoway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Checkoway","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"jdk 1.6.0_24, Spring 3.0.5, ActiveMQ 5.5.0, Camel 2.7.0, slf4j 1.6.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12503739/comment/13017517","id":"13017517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"reverted the explicit copy/set of the MDC context on thread creation as the underlying mdc impl used an inherited thread local for the context which makes the copy unnecessary and can cause contention. \nthe changes in http://svn.apache.org/viewvc?view=revision&revision=1090320 should resolve the concurrent mod exception. I kicked off a new 5.6-SNAPSHOT deploy so if you get a chance please validate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-08T16:21:59.519+0000","updated":"2011-04-08T16:21:59.519+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12503739/comment/13017561","id":"13017561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dcheckoway","name":"dcheckoway","key":"dcheckoway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Checkoway","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for the very quick turnaround, Gary.  Unfortnately, the only place we've seen this issue is in our loaded production environment.  SNAPSHOTs are all but off limits, sad to say.\n\nI'm guessing 5.6.0 will be a while?  Do you think there will be a 5.5.1 release in the near term?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dcheckoway","name":"dcheckoway","key":"dcheckoway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Checkoway","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-08T17:30:12.962+0000","updated":"2011-04-08T17:30:12.962+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12503739/comment/13017640","id":"13017640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"body":"\nJust a note that while testing CXF with 5.5.0, I also run into this occasionally.   The CXF test suite will need to remain on 5.4.2 for now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"created":"2011-04-08T20:59:31.644+0000","updated":"2011-04-08T20:59:31.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12503739/comment/13032919","id":"13032919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=famod","name":"famod","key":"famod","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=famod&avatarId=32703","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=famod&avatarId=32703","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=famod&avatarId=32703","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=famod&avatarId=32703"},"displayName":"Falko Modler","active":true,"timeZone":"Etc/UTC"},"body":"Dan Checkoway wrote:\n\"I'm guessing 5.6.0 will be a while? Do you think there will be a 5.5.1 release in the near term?\"\n\nSame questions here!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=famod","name":"famod","key":"famod","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=famod&avatarId=32703","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=famod&avatarId=32703","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=famod&avatarId=32703","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=famod&avatarId=32703"},"displayName":"Falko Modler","active":true,"timeZone":"Etc/UTC"},"created":"2011-05-13T09:03:10.008+0000","updated":"2011-05-13T09:03:10.008+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12503739/comment/13085690","id":"13085690","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hondong","name":"hondong","key":"hondong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hondong","active":true,"timeZone":"Etc/UTC"},"body":"Hi, have a look at Fuse 5.5.0 00.43: http://fusesource.com/wiki/display/ProdInfo/FUSE+Message+Broker+v5.5.0-fuse+Release+Notes\nThis Issue seems to be fixed there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hondong","name":"hondong","key":"hondong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hondong","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-16T13:30:54.800+0000","updated":"2011-08-16T13:30:54.800+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12503739/comment/13085692","id":"13085692","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hondong","name":"hondong","key":"hondong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hondong","active":true,"timeZone":"Etc/UTC"},"body":"You can download it here: http://repo.fusesource.com/nexus/content/repositories/releases/org/apache/activemq/apache-activemq/5.5.0-fuse-00-43/\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hondong","name":"hondong","key":"hondong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hondong","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-16T13:31:36.475+0000","updated":"2011-08-16T13:31:36.475+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3276/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ajjj:"}}