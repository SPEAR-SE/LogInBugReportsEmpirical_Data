{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483342","self":"https://issues.apache.org/jira/rest/api/2/issue/12483342","key":"AMQ-1126","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2007-08-14T11:45:16.935+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Jul 17 01:00:40 UTC 2016","customfield_12310420":"43790","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1126/watchers","watchCount":10,"isWatching":false},"created":"2007-01-12T18:51:28.565+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315611","id":"12315611","description":"","name":"4.0.1","archived":false,"released":true,"releaseDate":"2006-06-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-07-17T01:00:40.649+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313898","id":"12313898","name":"JCA Container"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Integrate AMQ into JBoss using the data source, and resource adapter.  Create an outbound queue and an MDB with a pool size of 100.  Dispatch several messages to the outbound queue, setting the JMSXGroupID property on the message to be the same value each time.  In the MDB's onMessage method print out the MDBs toString (don't override toString) and you should see something that looks like:\n\nOutQueueProcessorBean@19a7266\n\nObserve two things:\n\na) Many messages are processed in parallel\nb) Many different values will occur after the @ in the above message, denoting that more than on MDB instance is being handed messages.\n\nThe correct behavior would be to dispatch messages with the same group id to the same MDB instance in sequence.  This would allow messages from different groups to be processed in parallel, but messages in any one group would be processed serially, in the order in which they were placed into the queue.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12575661","id":"12575661","filename":"amq_reproducer.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jshepher","name":"jshepher","key":"jshepher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Shepherd","active":true,"timeZone":"Australia/Brisbane"},"created":"2013-03-27T05:14:48.362+0000","size":18729,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12575661/amq_reproducer.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461242","id":"12461242","filename":"msg-group-test.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skomarla","name":"skomarla","key":"skomarla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sharath Komarla","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-21T18:54:35.355+0000","size":9085,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461242/msg-group-test.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59864","customfield_12312823":null,"summary":"The Resource Adapter ignores the JMSXGroupID when dispatching to MDBs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jrobinson","name":"jrobinson","key":"jrobinson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Robinson","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jrobinson","name":"jrobinson","key":"jrobinson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Robinson","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Java 1.4.2_08\nJBoss 4.0.4\nActiveMQ 4.0.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/12937166","id":"12937166","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishpathadan","name":"anishpathadan","key":"anishpathadan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Pathadan","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n    In this case the Message Listener is the MDB container not the individual MDB instances. MDB container is free to select any mdb instance to process the message it received.So I think  the JMSXGroupID has no significance here. I feel this is not a bug and can be closed. \n\nWhat is the opinion of others?.\n\nBest Regards,\nAnish Pathadan","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishpathadan","name":"anishpathadan","key":"anishpathadan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Pathadan","active":true,"timeZone":"Etc/UTC"},"created":"2007-08-14T11:45:16.935+0000","updated":"2007-08-14T11:45:16.935+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/12938984","id":"12938984","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jrobinson","name":"jrobinson","key":"jrobinson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Robinson","active":true,"timeZone":"Etc/UTC"},"body":"Page 31, section 3.5.9 of the JMS Specification states:\n\nJMSXGroupID and JMSXGroupSeq are standard properties clients should use if\nthey want to group messages. All providers must support them.\n\nSo I guess the real question is, what does it mean to support it?\n\nI agree that the MDB container is the listener, and that it is free to dispatch messages to to which ever MDB instance it chooses.\n\nHowever, what I think is broken is that it is dispatching them in parallel.  That is, it should, in my opinion, be handing out one message at a time, and not handing out another one until the first message is acknowledged, or its transaction is committed, for example.  In other words, it should finish one before sending another.\n\nIf it does not do this, then grouping has no semantic meaning or purpose with MDBs, at least that I can divine.\n\nI would further point out that, in my opinion, the container is free to dispatch any one message, without respect to order, so long as the sequence number was not set.  If the sequence number and the group number are set, then the container should be handing a single MDB a single message for that group in the order defined by the sequence number.\n\nRight now, when grouping and sequence numbers are used with MDBs, the messages are dispatched in sequence, but because the container does not wait for the first one to finish before dispatching the second one, the messages end up being processed simultaneously, and thread/execution priority determines which one finish first.  \n\nFor example, if you have a message that takes a long time to process (call it message A) and a message that takes a short amount of time to process (call it message B), and you group them and sequence them so that A is first and B is second, then with MDBs it is quite likely that B (the shorter one) will finish first.  I think, based on my understanding, that the container should dispatch message A, wait until it is 'complete', and then dispatch message B.\n\nWhether they go to the same, or a different, MDB instances is really moot, and shouldn't matter a whit.\n\nIn my opinion part of the problem is that the spec is very vague on what, exactly, is meant by 'support' with respect to these two attributes.\n\nI would love to hear from others on this subject.\n\n-John\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jrobinson","name":"jrobinson","key":"jrobinson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Robinson","active":true,"timeZone":"Etc/UTC"},"created":"2007-08-14T13:24:25.093+0000","updated":"2007-08-14T13:24:25.093+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/12940512","id":"12940512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skomarla","name":"skomarla","key":"skomarla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sharath Komarla","active":true,"timeZone":"Etc/UTC"},"body":"Man.. I'm so glad I stumbled on this issue. I've been pulling my hair out over this.  I use JBoss 4.2.2 with the 5.1.0 activemq rar and I see that the RA completely ignores the group id.  we are using spring's jms:listener-container and not MDB's, but I see the exact same behavior.  I even have a unit test that exhibits this behavior using an vm://localhost broker on 5.1.0 and RC3 of 5.2.0\n\nBased on the last comment from John,  I agree that the MDB container/spring container is real endoint of the queue and I don't care which MDB instance the message is delagated to, but the container should respect the grouping!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skomarla","name":"skomarla","key":"skomarla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sharath Komarla","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-20T23:48:44.562+0000","updated":"2008-11-20T23:48:44.562+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/12940515","id":"12940515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Sharath, If you can, please attach (see Attach File) your Junit test. thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-21T11:47:22.571+0000","updated":"2008-11-21T11:47:22.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/12940498","id":"12940498","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skomarla","name":"skomarla","key":"skomarla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sharath Komarla","active":true,"timeZone":"Etc/UTC"},"body":"Gary, I mispoke slightly.  The unit test I have does not use the RA, but a simple test with logging to show the group the message belongs to. I will attach that anyways, but not sure if that should be tied to this JIRA issue.  let me just clean it up a little since it is slightly cluttered at the moment.. should be attached in an hour or so","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skomarla","name":"skomarla","key":"skomarla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sharath Komarla","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-21T17:06:49.960+0000","updated":"2008-11-21T17:06:49.960+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/12940504","id":"12940504","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skomarla","name":"skomarla","key":"skomarla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sharath Komarla","active":true,"timeZone":"Etc/UTC"},"body":"Here is a zip of a mvn project using spring.  It has a junit test with two tests in it.  \n\nBoth tests start out with sending some message to a same queue split across three different group ids (20 to group A, 10 to group B, 5 to group C).  My understanding of message groups leads me to believe that the messages within a group are delivered sequentially, but across the groups they are delivered in parallel.\n\nIf you look at the output of the unit tests, it does not seem to be the case. in many cases, it seems the messages get delivered in FIFO order ignoring groups entirely... in the listeners, I have setup various sleeps to simulate slow consumers.. When the message is from group C, the sleep time is small, and thus all 5 messages from group C should be delivered before the second message from group is delivered.. it does not seem to be the case\n\n1 test uses the connection factory directly to setup message consumers, and another uses spring's listener container.  Neither seem to do what I expect. Maybe I just have something setup horribly incorrectly, but I've seen the exact same bahaviour using the RA.\n\nsome sample output...  (Sorry for the poorly configured logging)\n\n{noformat} \n-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning com.test.MessageSenderServiceTest\nNov 21, 2008 1:58:01 PM org.apache.activemq.broker.BrokerService start\nINFO: Using Persistence Adapter: AMQPersistenceAdapter(activemq-data\\localhost)\nNov 21, 2008 1:58:02 PM org.apache.activemq.broker.BrokerService getBroker\nINFO: ActiveMQ 5.1.0 JMS Message Broker (localhost) is starting\nNov 21, 2008 1:58:02 PM org.apache.activemq.broker.BrokerService getBroker\nINFO: For help or more information please see: http://activemq.apache.org/\nNov 21, 2008 1:58:02 PM org.apache.activemq.store.amq.AMQPersistenceAdapter start\nINFO: AMQStore starting using directory: activemq-data\\localhost\nNov 21, 2008 1:58:02 PM org.apache.activemq.broker.jmx.ManagementContext$1 run\nINFO: JMX consoles can connect to service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi\nNov 21, 2008 1:58:02 PM org.apache.activemq.kaha.impl.KahaStore initialize\nINFO: Kaha Store using data directory activemq-data\\localhost\\kr-store\\state\nNov 21, 2008 1:58:02 PM org.apache.activemq.store.amq.AMQPersistenceAdapter start\nINFO: Active data files: []\nNov 21, 2008 1:58:02 PM org.apache.activemq.kaha.impl.KahaStore initialize\nINFO: Kaha Store using data directory activemq-data\\localhost\\kr-store\\data\nNov 21, 2008 1:58:02 PM org.apache.activemq.broker.TransportConnector start\nINFO: Connector vm://localhost Started\nNov 21, 2008 1:58:02 PM org.apache.activemq.broker.BrokerService start\nINFO: ActiveMQ JMS Message Broker (localhost, ID:skomarla-2752-1227293882509-0:0) started\nNov 21, 2008 1:58:02 PM org.springframework.context.support.AbstractApplicationContext prepareRefresh\nINFO: Refreshing org.springframework.context.support.ClassPathXmlApplicationContext@1be0f0a: display name [org.springframework.context.support.ClassPathXmlA\ni Nov 21 13:58:02 EST 2008]; root of context hierarchy\nNov 21, 2008 1:58:03 PM org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions\nINFO: Loading XML bean definitions from file [C:\\workspace\\msg-group-test\\target\\classes\\META-INF\\springcontext-jms-listener.xml]\nNov 21, 2008 1:58:04 PM org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions\nINFO: Loading XML bean definitions from file [C:\\workspace\\msg-group-test\\target\\classes\\META-INF\\springcontext-jms-sender.xml]\nNov 21, 2008 1:58:04 PM org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions\nINFO: Loading XML bean definitions from file [C:\\workspace\\msg-group-test\\target\\classes\\META-INF\\springcontext-jms.xml]\nNov 21, 2008 1:58:04 PM org.springframework.context.support.AbstractApplicationContext obtainFreshBeanFactory\nINFO: Bean factory for application context [org.springframework.context.support.ClassPathXmlApplicationContext@1be0f0a]: org.springframework.beans.factory.s\nNov 21, 2008 1:58:04 PM org.springframework.beans.factory.support.DefaultListableBeanFactory preInstantiateSingletons\nINFO: Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@16f144c: defining beans [org.springframework.jms.\nestListener,jmsTemplate,messageSenderService,jmsFactory]; root of factory hierarchy\nNov 21, 2008 1:58:05 PM com.test.MessageSenderServiceTest testDirectConnection\nINFO: 20 messages sent to group A\nNov 21, 2008 1:58:05 PM com.test.MessageSenderServiceTest testDirectConnection\nINFO: 10 messages sent to group B\nNov 21, 2008 1:58:05 PM com.test.MessageSenderServiceTest testDirectConnection\nINFO: 5 messages sent to group C\nNov 21, 2008 1:58:05 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg A remaining 17\nNov 21, 2008 1:58:05 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker1 received msg A remaining 19\nNov 21, 2008 1:58:05 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker2 received msg A remaining 18\nNov 21, 2008 1:58:10 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker2 received msg A remaining 16\nNov 21, 2008 1:58:10 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker1 received msg A remaining 15\nNov 21, 2008 1:58:10 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg A remaining 14\nNov 21, 2008 1:58:15 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker2 received msg A remaining 13\nNov 21, 2008 1:58:15 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker1 received msg A remaining 12\nNov 21, 2008 1:58:15 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg A remaining 11\nNov 21, 2008 1:58:20 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker2 received msg A remaining 10\nNov 21, 2008 1:58:20 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg A remaining 9\nNov 21, 2008 1:58:20 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker1 received msg A remaining 8\nNov 21, 2008 1:58:25 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker2 received msg A remaining 7\nNov 21, 2008 1:58:25 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker1 received msg A remaining 6\nNov 21, 2008 1:58:25 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg A remaining 5\nNov 21, 2008 1:58:30 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker2 received msg A remaining 4\nNov 21, 2008 1:58:30 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker1 received msg A remaining 3\nNov 21, 2008 1:58:30 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg A remaining 2\nNov 21, 2008 1:58:35 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker2 received msg A remaining 1\nNov 21, 2008 1:58:35 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker1 received msg A remaining 0\nNov 21, 2008 1:58:35 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg B remaining 9\nNov 21, 2008 1:58:36 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg B remaining 8\nNov 21, 2008 1:58:37 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg B remaining 7\nNov 21, 2008 1:58:38 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg B remaining 6\nNov 21, 2008 1:58:39 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg B remaining 5\nNov 21, 2008 1:58:40 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker2 received msg B remaining 4\nNov 21, 2008 1:58:40 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker1 received msg B remaining 3\nNov 21, 2008 1:58:40 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker3 received msg B remaining 2\nNov 21, 2008 1:58:41 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker2 received msg B remaining 1\nNov 21, 2008 1:58:41 PM com.test.MessageSenderServiceTest$Worker run\nINFO: worker1 received msg B remaining 0\nNov 21, 2008 1:58:41 PM com.test.MessageSenderServiceTest$Worker run\nworker3 received msg C remaining 4\nINFO: 100\nNov 21, 2008 1:58:41 PM com.test.MessageSenderServiceTest$Worker run\nworker3 received msg C remaining 3\nINFO: 100\nNov 21, 2008 1:58:41 PM com.test.MessageSenderServiceTest$Worker run\nworker3 received msg C remaining 2\nINFO: 100\nworker2 received msg C remaining 1\nNov 21, 2008 1:58:42 PM com.test.MessageSenderServiceTest$Worker run\nINFO: 100\nworker1 received msg C remaining 0\nNov 21, 2008 1:58:42 PM com.test.MessageSenderServiceTest$Worker run\nINFO: 100\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.MessageSenderServiceTest testSpringListenerContainer\nINFO: 20 messages sent to group A\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.MessageSenderServiceTest testSpringListenerContainer\nINFO: 10 messages sent to group B\nNov 21, 2008 1:58:42 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:42 EST 2008 group: A\nNov 21, 2008 1:58:42 PM com.test.MessageSenderServiceTest testSpringListenerContainer\nINFO: 5 messages sent to group C\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:47 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:47 EST 2008 group: A\nNov 21, 2008 1:58:52 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:52 EST 2008 group: B\nNov 21, 2008 1:58:52 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:52 EST 2008 group: C\nNov 21, 2008 1:58:52 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:52 EST 2008 group: B\nNov 21, 2008 1:58:52 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:52 EST 2008 group: B\nNov 21, 2008 1:58:52 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:52 EST 2008 group: B\nNov 21, 2008 1:58:52 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:52 EST 2008 group: C\nNov 21, 2008 1:58:52 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:52 EST 2008 group: C\nNov 21, 2008 1:58:52 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:52 EST 2008 group: C\nNov 21, 2008 1:58:52 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:52 EST 2008 group: C\nNov 21, 2008 1:58:53 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:53 EST 2008 group: B\nNov 21, 2008 1:58:53 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:53 EST 2008 group: B\nNov 21, 2008 1:58:53 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:53 EST 2008 group: B\nNov 21, 2008 1:58:54 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:54 EST 2008 group: B\nNov 21, 2008 1:58:54 PM com.test.impl.TestListenerImpl onMessage\nINFO: Fri Nov 21 13:58:54 EST 2008 group: B\n\nand on and on ....\n{noformat} \n\nIf I get the time today, I'll try to set something up that uses the RA directly (using the junit tests under activemq-ra as inspiration) to see if i can recreate a unit test dirctly using the RA code that exhibits the problem.\n\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skomarla","name":"skomarla","key":"skomarla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sharath Komarla","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-21T18:54:35.414+0000","updated":"2008-11-21T19:02:27.618+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/12940502","id":"12940502","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skomarla","name":"skomarla","key":"skomarla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sharath Komarla","active":true,"timeZone":"Etc/UTC"},"body":"After further research, I no longer believe this to be RA specific.  A colleague of mine has filed issue 2016, and I believe that to be the root cause of what I was seeing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skomarla","name":"skomarla","key":"skomarla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sharath Komarla","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-26T20:42:56.171+0000","updated":"2008-11-26T20:42:56.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/12941169","id":"12941169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rchristy","name":"rchristy","key":"rchristy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rich Christy","active":true,"timeZone":"Etc/UTC"},"body":"I don't believe this is fixed with issue 2016.  I have downloaded the latest SNAPSHOT of 5.3 specifically for that issue since it was fixed in that release.  I was able to see using a simple producer/consumer, that message groups did work as advertised.  My consumer created 10 threads much like JBoss would do by default and create 10 instances of an MDB.  It just seems that message groups aren't working with JBoss 4.2.2 at least, I have tried any other version of JBoss.  I even noticed that the workaround discussed in issue 2016 doesn't work either (starting the consumers before any messages on the queue).  The workaround worked fine for the simple producer/consumer case, but just doesn't work with JBoss.  Has anyone looked into this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rchristy","name":"rchristy","key":"rchristy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rich Christy","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-12T19:06:14.851+0000","updated":"2009-08-12T19:06:14.851+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/13198446","id":"13198446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mpindyala","name":"mpindyala","key":"mpindyala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mohan pindyala","active":true,"timeZone":"Etc/UTC"},"body":"we are in a similar situation .\n\nwe have network of brokers\n\nProducers send to Broker 1,2 and 3\nBrokers 1,2,3 forward messages to Broker 4\n\nWe are using apachemq 5.5 and Spring DMLC for listeners .\nBroker 1,2,3 are hosted within tomcat container\n\nConsumers consume from Broker 4\n\nwe have three consumers each receiving only a specific groupId using message selector expressions\nJMSXGroupID='0' for consumer1\nJMSXGroupID='1' for consumer2\nJMSXGroupID='2' for consumer3\n\nProducers tag these messages with JMSXGroupID and forward that to broker 4.\n\nIssue is we are seeing  messages tagged with JMSXGroupID '0' are ending up in consumer2 or cosumer3,or JMSXGroupID '1' endign up in consumer 0 or 3\n\nwhen we cut down our consumers to 2 and tag messages with 0 or 1 it works like a charm.\n\nCan any help us with this issue?\n\n\n\n\n\n\n\n\n\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mpindyala","name":"mpindyala","key":"mpindyala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mohan pindyala","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-02T01:38:09.924+0000","updated":"2012-02-02T01:39:22.162+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/13205474","id":"13205474","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=farheen","name":"farheen","key":"farheen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"farheen","active":true,"timeZone":"Etc/UTC"},"body":"I too am facing the same issue with implementing message grouping with JBoss 4.0.3 and ActiveMQ 5.4.3. I have  addded the JMSXGroupID to the JMS mesage being sent from the producer. Also added below line in the broker-config.xml \n\n<policyEntry queue=\">\" consumersBeforeDispatchStarts=\"5\" timeBeforeDispatchStarts=\"5000\" prioritizedMessages=\"true\"/>   \n\nBut when i try to send 2 groups of messages each group haing 5 messages each from a client, I find that the messages are consumed by differernt consumers(COnsumer in my case is an MDB  deployed in JBoss server. ActiveMQ started when JBoss starts). There are differernt instances of MDBs created for each message and all are processed in parallel. \n\nAltho' I expected that the messages in 1 group be processed by one particular consumer .i.e. one instance of MDB. \n\nCan you please help me out. I cant understand what I might be doing incorrectly here \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=farheen","name":"farheen","key":"farheen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"farheen","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-10T14:26:14.034+0000","updated":"2012-02-10T14:26:14.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/13207553","id":"13207553","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=farheen","name":"farheen","key":"farheen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"farheen","active":true,"timeZone":"Etc/UTC"},"body":"Hi Rich,\n\nIm stuck with a similar situation. Did u get any fix or alternate way for this issue?\n\nFarheen","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=farheen","name":"farheen","key":"farheen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"farheen","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-14T07:22:31.579+0000","updated":"2012-02-14T07:22:31.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/13207681","id":"13207681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rchristy","name":"rchristy","key":"rchristy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rich Christy","active":true,"timeZone":"Etc/UTC"},"body":"No we actually stopped using ActiveMQ so basically my problem went away.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rchristy","name":"rchristy","key":"rchristy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rich Christy","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-14T12:50:59.906+0000","updated":"2012-02-14T12:50:59.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/13458651","id":"13458651","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Anyone care to try with the 5.6.0 or 5.7-SNAPSHOT release (5.7 is on the way soon). \n\nWould be nice to know the status of this in the latest release. If its still an issue we can put it on the roadmap to get fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-19T12:45:33.019+0000","updated":"2012-09-19T12:45:33.019+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/13613539","id":"13613539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jshepher","name":"jshepher","key":"jshepher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Shepherd","active":true,"timeZone":"Australia/Brisbane"},"body":"This does still exist in the latest release RAR 5.8.0. However a workaround, or possible solution, is to create an MDB for each group. \n\nWe found that when you have more than MDB listening to the same queue, each MDB pool acts as a unique consumer for message grouping. That is once an instance from the MDB pool picks up a message from group 1, all subsequent messages for group 1 are picked up by an instance in the same pool.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jshepher","name":"jshepher","key":"jshepher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Shepherd","active":true,"timeZone":"Australia/Brisbane"},"created":"2013-03-26T06:10:33.720+0000","updated":"2013-03-26T06:10:33.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/13614947","id":"13614947","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jshepher","name":"jshepher","key":"jshepher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Shepherd","active":true,"timeZone":"Australia/Brisbane"},"body":"We found that message sequencing is not working correctly when using the above approach. Therefore we suggest that there is a bug still in the Resource Adapter.\n\nWe tested using:\nJBoss EAP 6.0.1\nActiveMQ RAR 5.8.0\n\nI have attached a test case (amq_reproducer.zip) which demonstrates the issue in that environment. Here is how it works:\n\n\n    amq_reproducer.zip:\n        test_amq.jar\n        test_amq_web.war\n    activemq-rar-5.8.0.rar 1\n    Changes required in standalone-full.xml for registering activemq resource adapter\n\n{code:xml}\n\n <subsystem xmlns=\"urn:jboss:domain:resource-adapters:1.0\">\n            <resource-adapters>\n                <resource-adapter>\n                    <archive>\n                        activemq-rar-5.8.0.rar\n                    </archive>\n                    <transaction-support>XATransaction</transaction-support>\n                    <config-property name=\"UseInboundSession\">\n                        false\n                    </config-property>\n                    <config-property name=\"Password\">\n                        defaultPassword\n                    </config-property>\n                    <config-property name=\"UserName\">\n                        defaultUser\n                    </config-property>\n                    <config-property name=\"ServerUrl\">\n                        vm://localhost\n                    </config-property>\n                    <connection-definitions>\n                        <connection-definition class-name=\"org.apache.activemq.ra.ActiveMQManagedConnectionFactory\" \njndi-name=\"java:jboss/ConnectionFactory\" enabled=\"true\" pool-name=\"ConnectionFactory\">\n                            <xa-pool>\n                                <min-pool-size>1</min-pool-size>\n                                <max-pool-size>20</max-pool-size>\n                            </xa-pool>\n                        </connection-definition>\n                    </connection-definitions>\n                    <admin-objects>\n                        <admin-object class-name=\"org.apache.activemq.command.ActiveMQQueue\" \njndi-name=\"java:jboss/queue/MyActiveMQQueue\" use-java-context=\"true\" pool-name=\"MyActiveMQQueue\">\n                            <config-property name=\"PhysicalName\">\n                                QueuePhysicalName\n                            </config-property>\n                        </admin-object>\n                    </admin-objects>\n                </resource-adapter>\n            </resource-adapters>\n        </subsystem>\n{code}\ntest_amq.jar\nThis jar contains two group of MDBs. Three MDBs (AMQTestMDB*) are consumer for AMQ queue QueuePhysicalName (defined in standalone-ha.xml). The other three MDBs (HornetQTestMDB*) are consumer for HornetQ (default implementation) queue queue/HornetQMDBQueue (defined in war's hornetq-jms.xml).\n\nThe onMessage method call following simple logic\n{code:borderStyle=solid}\n\npublic void handleMessage(String id, TextMessage tm) {\n        try {\n            String logMsg = id + \" Testing MDB : \" + tm.getText()\n                    + \", \" + this.toString();\n            System.out.println(logMsg);\n            if (tm.getText().startsWith(\"Hello\")) {\n                // simulate heavy processing of first message\n                long sec = 5;\n                System.out.println(logMsg + \" - Heavy processing for \" + sec\n                        + \" seconds. \" + tm.getText() + \", \" + this.toString());\n                Random r = new Random();\n                for (long stop = System.nanoTime()\n                        + TimeUnit.SECONDS.toNanos(5); stop > System.nanoTime();) {\n                    r.nextDouble();\n                }\n                System.out.println(logMsg + \" Done!\");\n            }\n\n        } catch (JMSException e) {\n            e.printStackTrace();\n        }\n    }\n{code}\ntest_amq_web.war\nThis war contains clients for the test queues. /test tests AMQ. /test2 tests HornetQ. Following is the logic used:\n{code:borderStyle=solid}\n    for (int i = 0; i < 5; i++) {\n        msg.setText(\"Hello \" + i + \"[\" + groupName + \"]\");\n        msg2.setText(\"World \" + i + \"[\" + groupName + \"]\");\n\n        if (useGroup) {\n            msg.setStringProperty(\"JMSXGroupID\", groupName);\n            msg2.setStringProperty(\"JMSXGroupID\", groupName);\n        }\n\n        qsender.send(msg);\n        qsender.send(msg2);\n    }\n{code}\nEach servlet creates 5 threads. Each thread creates two text messages and sends it out 5 times.\n\nExecuting test cases\n- ActiveMQ test: http://localhost:8080/test_amq_web/test\n- ActiveMQ test without JMSXGroupID: http://localhost:8080/test_amq_web/test?group=false\n- HornetQ test: http://localhost:8080/test_amq_web/test2\n- HornetQ test without JMSXGroupID: http://localhost:8080/test_amq_web/test2?group=false\n\nResults:\n\nWhen invoking the test_amq_web/test we can see that messages using the same message group are not being processed sequentially. In the logs we get messages in this order:\n{code}\n15:00:47,031 INFO  [stdout] (default-threads - 7) Consume-AMQ3 Testing MDB : Hello 0[Group-1], com.redhat.gss.test.HandleMessage@53e59730\n15:00:47,032 INFO  [stdout] (default-threads - 7) Consume-AMQ3 Testing MDB : Hello 0[Group-1], com.redhat.gss.test.HandleMessage@53e59730 - Heavy processing for 5 seconds. Hello 0[Group-1], com.redhat.gss.test.HandleMessage@53e59730\n...\n15:00:47,066 INFO  [stdout] (default-threads - 12) Consume-AMQ3 Testing MDB : World 0[Group-1], com.redhat.gss.test.HandleMessage@5418f143\n...\n15:00:52,035 INFO  [stdout] (default-threads - 7) Consume-AMQ3 Testing MDB : Hello 0[Group-1], com.redhat.gss.test.HandleMessage@53e59730 Done!\n{code}\nHowever when invoking test_amq_web/test2 (which uses HornetQ) we can see that the message are being processed sequentially:\n{code}\n15:08:35,740 INFO  [stdout] (Thread-1 (HornetQ-client-global-threads-1277578712)) Consume-HQ1 Testing MDB : Hello 0[Group-0], com.redhat.gss.test.HandleMessage@67092e88\n15:08:35,744 INFO  [stdout] (Thread-1 (HornetQ-client-global-threads-1277578712)) Consume-HQ1 Testing MDB : Hello 0[Group-0], com.redhat.gss.test.HandleMessage@67092e88 - Heavy processing for 5 seconds. Hello 0[Group-0], com.redhat.gss.test.HandleMessage@67092e88\n...\n15:08:40,784 INFO  [stdout] (Thread-0 (HornetQ-client-global-threads-1277578712)) Consume-HQ3 Testing MDB : Hello 0[Group-3], com.redhat.gss.test.HandleMessage@bce1791 Done!\n15:08:40,788 INFO  [stdout] (Thread-0 (HornetQ-client-global-threads-1277578712)) Consume-HQ3 Testing MDB : World 0[Group-3], com.redhat.gss.test.HandleMessage@5e8ace0e\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jshepher","name":"jshepher","key":"jshepher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Shepherd","active":true,"timeZone":"Australia/Brisbane"},"created":"2013-03-27T05:19:22.385+0000","updated":"2013-03-27T06:41:15.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/13675484","id":"13675484","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jshepher","name":"jshepher","key":"jshepher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Shepherd","active":true,"timeZone":"Australia/Brisbane"},"body":"Reported on Enterprise MQ 7.1.0 \n\nhttps://fusesource.com/issues/browse/ENTMQ-261","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jshepher","name":"jshepher","key":"jshepher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Shepherd","active":true,"timeZone":"Australia/Brisbane"},"created":"2013-06-05T00:51:13.455+0000","updated":"2013-06-05T00:51:44.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/14186769","id":"14186769","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smil","name":"smil","key":"smil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tamas Cserveny","active":true,"timeZone":"Etc/UTC"},"body":"I was able to get this running 5.10 RAR using maxSessions=1 and creating the desired amount of MDBs. (Prefetch can be set to higher than 1.)\n\nStill the grouping is not honoured in case of errors, in order to solve that, you need the solution for this: AMQ-5400","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smil","name":"smil","key":"smil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tamas Cserveny","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-28T12:46:49.010+0000","updated":"2014-10-28T12:49:32.595+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483342/comment/15381013","id":"15381013","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Marco+de+Abreu","name":"Marco de Abreu","key":"marco de abreu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marco de Abreu","active":true,"timeZone":"Etc/UTC"},"body":"So is there any progress on this matter?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Marco+de+Abreu","name":"Marco de Abreu","key":"marco de abreu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marco de Abreu","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-17T01:00:40.649+0000","updated":"2016-07-17T01:00:40.649+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1126/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0am5z:"}}