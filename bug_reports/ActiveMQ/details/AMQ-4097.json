{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12610846","self":"https://issues.apache.org/jira/rest/api/2/issue/12610846","key":"AMQ-4097","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2012-11-15T19:44:32.190+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jul 13 08:06:23 UTC 2015","customfield_12310420":"245592","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4097/watchers","watchCount":10,"isWatching":false},"created":"2012-10-08T17:25:48.747+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321258","id":"12321258","description":"Next v5 maintenance release","name":"5.7.0","archived":false,"released":true,"releaseDate":"2012-10-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-07-13T08:06:23.423+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The situation is as follows:\n\n- an external broker A connects\n- time passes\n- a lot of external brokers disconnect including A\n- A reconnects (as well as all the other external brokers)\n- wrong message about duplicate name is generated\n\nIn the log it looks like this:\n{code}\n2012-10-08 17:11:19,835 INFO  .DemandForwardingBridgeSupport - Network connection between vm://c04ptec#278 and tcp:///127.0.0.1:54191(cbox-56BU902442) has been established. [StartLocalBridge: localBroker=vm://c04ptec#278]\n\n...\n\n... a lot more of the following with different ports\n2012-10-08 17:37:01,958 WARN  .DemandForwardingBridgeSupport - Network connection between vm://c04ptec#278 and tcp:///127.0.0.1:54191 shutdown due to a remote error: java.io.EOFException [ActiveMQ NIO Worker 193]\n... more of these\n\n2012-10-08 17:37:03,438 INFO  emq.broker.TransportConnection - Started responder end of duplex bridge cBox 56BU902442 to cBox Proxy@ID:P013SPWMK1WN-39320-1349704902319-0:1 [ActiveMQ NIO Worker 215]\n\n...\n\n2012-10-08 17:37:03,922 WARN  emq.broker.TransportConnection - Failed to add Connection ID:c04ptec-51799-1349706422094-242:2, reason: javax.jms.InvalidClientIDException: Broker: c04ptec - Client: cBox 56BU902442 to cBox Proxy_cbox-56BU902442_inbound_c04ptec already connected from vm://c04ptec#278 [StartLocalBridge: localBroker=vm://c04ptec#478]\n2012-10-08 17:37:03,923 INFO  .DemandForwardingBridgeSupport - Network connection between vm://c04ptec#478 and tcp:///127.0.0.1:56529 shutdown due to a local error: javax.jms.InvalidClientIDException: Broker: c04ptec - Client: cBox 56BU902442 to cBox Proxy_cbox-56BU902442_inbound_c04ptec already connected from vm://c04ptec#278 [StartLocalBridge: localBroker=vm://c04ptec#478]\n\n...\n\n2012-10-08 17:37:04,036 INFO  .DemandForwardingBridgeSupport - c04ptec bridge to cbox-56BU902442 stopped [ActiveMQ Task-182]\n\n...\n\n2012-10-08 17:37:06,540 INFO  emq.broker.TransportConnection - Started responder end of duplex bridge cBox 56BU902442 to cBox Proxy@ID:P013SPWMK1WN-39320-1349704902319-0:1 [ActiveMQ NIO Worker 207]\n\n...\n\n2012-10-08 17:37:06,548 WARN  emq.broker.TransportConnection - Failed to add Connection ID:c04ptec-51799-1349706422094-292:1, reason: javax.jms.InvalidClientIDException: Broker: c04ptec - Client: cBox 56BU902442 to cBox Proxy_cbox-56BU902442_inbound_c04ptec already connected from vm://c04ptec#278 [StartLocalBridge: localBroker=vm://c04ptec#570]\n2012-10-08 17:37:06,548 INFO  .DemandForwardingBridgeSupport - Network connection between vm://c04ptec#570 and tcp:///127.0.0.1:56576 shutdown due to a local error: javax.jms.InvalidClientIDException: Broker: c04ptec - Client: cBox 56BU902442 to cBox Proxy_cbox-56BU902442_inbound_c04ptec already connected from vm://c04ptec#278 [StartLocalBridge: localBroker=vm://c04ptec#570]\n...\n2012-10-08 17:37:06,559 INFO  .DemandForwardingBridgeSupport - c04ptec bridge to cbox-56BU902442 stopped [ActiveMQ Task-204]\n\n...\n\n2012-10-08 17:37:24,417 INFO  .DemandForwardingBridgeSupport - c04ptec bridge to cbox-56BU902442 stopped [ActiveMQ Task-73]\n\n...\n\n2012-10-08 17:37:25,103 INFO  emq.broker.TransportConnection - Started responder end of duplex bridge cBox 56BU902442 to cBox Proxy@ID:P013SPWMK1WN-39320-1349704902319-0:1 [ActiveMQ NIO Worker 268]\n\n...\n\n2012-10-08 17:37:29,110 INFO  .DemandForwardingBridgeSupport - Network connection between vm://c04ptec#594 and tcp:///127.0.0.1:56656(cbox-56BU902442) has been established. [StartLocalBridge: localBroker=vm://c04ptec#594]\n\n...\n\n2012-10-08 17:37:59,669 WARN  .DemandForwardingBridgeSupport - Network connection between vm://c04ptec#594 and tcp:///127.0.0.1:56656(cbox-56BU902442) was interrupted during establishment. [StartLocalBridge: localBroker=vm://c04ptec#594]\n\n...\n\n2012-10-08 17:38:09,005 INFO  .DemandForwardingBridgeSupport - c04ptec bridge to cbox-56BU902442 stopped [ActiveMQ Task-228]\n\n...\n\n2012-10-08 17:38:18,681 INFO  emq.broker.TransportConnection - Started responder end of duplex bridge cBox 56BU902442 to cBox Proxy@ID:P013SPWMK1WN-39320-1349704902319-0:1 [ActiveMQ NIO Worker 292]\n2012-10-08 17:38:18,681 WARN  emq.broker.TransportConnection - Failed to add Connection ID:P013SPWMK1WN-39320-1349704902319-152:1, reason: javax.jms.InvalidClientIDException: Broker: c04ptec - Client: cBox 56BU902442 to cBox Proxy_cbox-56BU902442_outbound already connected from vm://c04ptec#594 [ActiveMQ NIO Worker 292]\n2012-10-08 17:38:18,682 WARN  er.TransportConnection.Service - Async error occurred: javax.jms.InvalidClientIDException: Broker: c04ptec - Client: cBox 56BU902442 to cBox Proxy_cbox-56BU902442_outbound already connected from vm://c04ptec#594 [ActiveMQ NIO Worker 292]\njavax.jms.InvalidClientIDException: Broker: c04ptec - Client: cBox 56BU902442 to cBox Proxy_cbox-56BU902442_outbound already connected from vm://c04ptec#594\n        at org.apache.activemq.broker.region.RegionBroker.addConnection(RegionBroker.java:222) ~[activemq-core-5.7-SNAPSHOT.jar:5.7-SNAPSHOT]\n\n{code}\n\nThis repeats until the external broker is stopped and started manually.\n\nI assume there is a race condition which shows up under high load preventing the information about the disconnected client to be removed before the same client reconnects.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"34864","customfield_12312823":null,"summary":"Broker-to-Broker Reconnect fails wrongly due to duplicate name","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"A central broker to which a lot (50+) of external brokers connect with a duplex bridge. A special routing/firewall is used which can affect timing but not order of TCP packets. This can be simulated by using socat.\nActually we are using 5.7-SNAPSHOT of 2012-08-31.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13498277","id":"13498277","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"We also encountered this error in our load testing lab when we had an actual network disruption.  We repeated the scenario by disconnecting and reconnecting the network cable.  If we had a long break between the disconnection and reconnection, our network of brokers establish connections just fine.  If we had a very short break (less than a minute) between the disconnection and reconnection while the load is high, we encountered this issue.  Below is the error in the log.\n\n2012-11-15 08:37:08,953 WARN   [ActiveMQ Transport: tcp://n4-perform70/10.40.100.17:61613] [DemandForwardingBridgeSupport:363] (   ) Network connection between vm://local-amq-broker#68046 and tcp://n4-perform70/10.40.100.17:61613 shutdown due to a remote error: javax.jms.InvalidClientIDException: Broker: amq-broker - Client: center-to-amq-broker_outbound already connected from tcp://10.47.103.25:51353\n\nWe are not using the duplex connection.  We're using ActiveMQ 5.6.0.\nregards.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-15T19:44:32.190+0000","updated":"2012-11-15T19:44:32.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13663838","id":"13663838","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Ron,\nWe still encountered the same issue after upgrading to ActiveMQ 5.7.0.  You mentioned about \"A special routing/firewall is used which can affect timing but not order of TCP packets\".  Could you elaborate on that?  Did you run socat as the special router/firewall?  How did you affect the timing of the TCP packets?  I'm interested in reproducing the issue in a controlled environment.  Also, did you find out more about this issue?\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-22T06:21:32.680+0000","updated":"2013-05-22T06:27:18.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13664030","id":"13664030","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Edwin,\n\nthe problem is still there with ActiveMQ 5.8.0.\n\nWe are using something a little bit more powerful than socat, but from a network point of view it is just two socats in a row with some additional routing based on the IP of the connecting broker.\n\nI made some extensive tests and I found that the error is actually correct. Under load the broker is just too slow to tear down the previous connection if the disconnect and connect happen very fast. Sometimes it could take the broker minutes to completely tear down a connection.\n\nUnfortunately the code around creating and destroying connections is a quite complicated beast of threads, singletons, per-connection objects, per-configured-bridge objects and shared state that I don't think there is an easy solution to our problem.\n\nTo solve my problem I added a connection delay into my \"socat\", so that there needs to be a 30 second delay after each connect or disconnect before a new connection can be tried.\n\nRegards,\nRon","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"created":"2013-05-22T11:48:06.930+0000","updated":"2013-05-22T11:48:06.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13664612","id":"13664612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Ron,\nThank you very much for sharing your findings.  Do you think \"initialReconnectDelay\" attribute on the network connector(in static discovery) would help, instead of introduce the delay in the \"socat\"?\nThanks again!\n-Edwin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-22T22:21:07.795+0000","updated":"2013-05-22T22:21:07.795+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13665049","id":"13665049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Edwin,\n\"initialReconnectDelay\" may work if you have only one broker connecting. We have more than 40 brokers connecting to a central broker, so unless they have all different \"initialReconnectDelay\" settings several brokers will reconnect at the same time causing high load and there slowing down the connection teardown.\nRegards,\nRon","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"created":"2013-05-23T10:10:12.390+0000","updated":"2013-05-23T10:10:12.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13721132","id":"13721132","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=enzeal","name":"enzeal","key":"enzeal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vee","active":true,"timeZone":"Etc/UTC"},"body":"Hi Ron,\n\nI am also facing the same issue in 5.6.0.\nyou said you solved the problem set the property for socat, i did not find this property anywhere can you please\ntell me where I can set up the socat value to reconnect the client again with Broker\n \"To solve my problem I added a connection delay into my \"socat\"\n\nThanks,\nVee","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=enzeal","name":"enzeal","key":"enzeal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vee","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-26T19:47:42.322+0000","updated":"2013-07-26T19:47:42.322+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13722285","id":"13722285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Vee,\n\nI'm not using the actual socat but only something like socat, which was developed by myself. As this is company property I can't disclose it. You may be able to duplicate it by looking into the proxy example of netty.\n\nRegards,\nRon","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-29T09:15:36.581+0000","updated":"2013-07-29T09:15:36.581+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13729623","id":"13729623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello,\nI just want to respond to my earlier question.  I applied the \"initialReconnectDelay\" attribute.  Our production system has been running ok for more than two months now.  We don't have that many brokers to connect to a central broker at the same time.  When the network outage happens, it's usually between two brokers.  Hope the information helps for others.\nRegards.\n-Edwin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-05T16:30:32.846+0000","updated":"2013-08-05T16:30:32.846+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13827509","id":"13827509","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amineo","name":"amineo","key":"amineo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amine","active":true,"timeZone":"Europe/Berlin"},"body":"Hi,\n\nTo resolve this, the network connector name between your broker must be different. Example :\n<networkConnector name=\"main-nc_$\\{hostname\\}\" ...\n\nWith this configuration, i don't have this error message.\n\nRegards\nAmine","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amineo","name":"amineo","key":"amineo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amine","active":true,"timeZone":"Europe/Berlin"},"created":"2013-11-20T10:12:39.413+0000","updated":"2013-11-20T11:21:36.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13827665","id":"13827665","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Amine,\n\nwhat you wrote is probably a prerequisite to get it working at all. We are usually encoding source and destination hostnames in the network-connector name to be on the safe side.\n\nAnyway, the problem also occurs under heavy load with distinct network connector names.\n\nRegards,\nRon","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"created":"2013-11-20T13:50:03.471+0000","updated":"2013-11-20T13:50:03.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13828622","id":"13828622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amineo","name":"amineo","key":"amineo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amine","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Ron\n\n??Also occurs under heavy load??\n\nWhat do you mean by \"heavy load\" ? A lot of amq broker or a lot of message (the rate) ? or both ?\n\nRegards,\nAmine","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amineo","name":"amineo","key":"amineo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amine","active":true,"timeZone":"Europe/Berlin"},"created":"2013-11-21T09:12:38.194+0000","updated":"2013-11-21T10:34:29.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/13828815","id":"13828815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Amine,\n\nusually that meant, that the broker has a lot of things to do. Especially broker logins/logouts seem to be quite critical. We have one environment with about 50 connected remote brokers which have about 10000 consumers shared among them. These are all connected over one leased line, so when that line breaks down, all remote brokers are disconnected due to missing keepalive. That causes a cascade of teardowns which can take minutes, especially if the line comes back and the remote brokers try to login again.\n\nWe do not have problems with a high number of messages to be sent in either direction or one logout/login.\n\nRegards,\nRon","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ron.koerner","name":"ron.koerner","key":"ron.koerner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ron Koerner","active":true,"timeZone":"Europe/Berlin"},"created":"2013-11-21T10:53:40.514+0000","updated":"2013-11-21T10:53:40.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/14268016","id":"14268016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rodrigo.cortes","name":"rodrigo.cortes","key":"rodrigo.cortes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rodrigo Côrtes","active":true,"timeZone":"Etc/UTC"},"body":"Hi Ron,\n\nWhat about the \"allowLinkStealing\" option (recently added) for the TransportConnector? Don't you think it can solve this problem?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rodrigo.cortes","name":"rodrigo.cortes","key":"rodrigo.cortes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rodrigo Côrtes","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-07T18:59:47.493+0000","updated":"2015-01-07T18:59:47.493+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/14614786","id":"14614786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=MLab","name":"MLab","key":"mlab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Labusquiere","active":true,"timeZone":"Etc/UTC"},"body":"Hi Ron, everyone,\n\nI meet the same problem here, and thinking use allowLinkStealing option. \nDo you have any feedback about this solution ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=MLab","name":"MLab","key":"mlab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Labusquiere","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-06T09:41:03.563+0000","updated":"2015-07-06T09:41:03.563+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610846/comment/14624343","id":"14624343","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fenghao0038","name":"fenghao0038","key":"fenghao0038","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hao Feng","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks for Edwin's experience and solution! \nI encountered the same problem as you did . AMQ 5.8 and usually two brokers(bridge type) using. I will apply the \"initialReconnectDelay\" attribute to my conf. Hopes everything works well later. \n\nRegards, \nHao","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fenghao0038","name":"fenghao0038","key":"fenghao0038","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hao Feng","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-07-13T08:06:23.423+0000","updated":"2015-07-13T08:06:23.423+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4097/votes","votes":4,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06bx3:"}}