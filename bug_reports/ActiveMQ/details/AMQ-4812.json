{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12674315","self":"https://issues.apache.org/jira/rest/api/2/issue/12674315","key":"AMQ-4812","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2013-11-15T16:38:05.845+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jun 03 14:21:27 UTC 2014","customfield_12310420":"353937","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_19787834466_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-06-03T14:21:27.206+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4812/watchers","watchCount":4,"isWatching":false},"created":"2013-10-17T13:44:12.795+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-06-03T14:21:27.254+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Two brokers networked.\nTransport connectors configured on both with:\nrebalanceClusterClients=\"true\" updateClusterClients=\"true\" updateClusterClientsOnRemove=\"true\"\nClients configured with only Broker 1 in Failover string.\nClients all connect to 1st Broker when starting up.\nWhen first broker is stopped all clients fail over to 2nd Broker.\nWhen 1st Broker is brought back up all clients remain on 2nd Broker.\nConfig files from both Brokers and one sample client config attached.\n\nRelated issue - queued messages on 1st Broker that were passed from 2nd broker initially are not consumed after 1st Broker is brought back up as rules prevent them from being passed back to 2nd Broker where client consumers are attached.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12608931","id":"12608931","filename":"(Example)IsecStateConsumer.properties","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waydena","name":"waydena","key":"waydena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wayne Evans","active":true,"timeZone":"America/New_York"},"created":"2013-10-17T13:56:03.014+0000","size":349,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12608931/%28Example%29IsecStateConsumer.properties"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12608932","id":"12608932","filename":"Broker1_activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waydena","name":"waydena","key":"waydena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wayne Evans","active":true,"timeZone":"America/New_York"},"created":"2013-10-17T13:56:03.018+0000","size":2648,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12608932/Broker1_activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12608933","id":"12608933","filename":"Broker2_activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waydena","name":"waydena","key":"waydena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wayne Evans","active":true,"timeZone":"America/New_York"},"created":"2013-10-17T13:56:03.022+0000","size":2648,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12608933/Broker2_activemq.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"354229","customfield_12312823":null,"summary":"Rebalance not working on 5.8.0","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waydena","name":"waydena","key":"waydena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wayne Evans","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waydena","name":"waydena","key":"waydena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wayne Evans","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674315/comment/13823790","id":"13823790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparso","name":"sparso","key":"sparso","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sam Parsons","active":true,"timeZone":"Etc/UTC"},"body":"I've experienced the same issue. Looking at the code, in FailoverTransport.java doReconnect() it does this:\n\n{code}\n                     if (doRebalance) {\n                         if (connectedToPriority || compareURIs(connectList.get(0), connectedTransportURI)) {\n                             // already connected to first in the list, no need to rebalance\n                             doRebalance = false;\n                             return false;\n                        } else {\n{code}\n\nSo if your client is connected to the first broker in the list then it is never rebalanced. \n\nAdditionally, when a new broker is added to the network, it is appended to the end of the list. This means that everything on the first broker stays connected, everything else is rebalanced (possibly to the first broker). Now if you add another broker, everything gets rebalanced except clients connected to the first broker, which just receives more connections.\n\nIn my opinion that check should be removed, because it results in uneven rebalancing across a broker network.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparso","name":"sparso","key":"sparso","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sam Parsons","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-15T16:38:05.845+0000","updated":"2013-11-15T16:38:05.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674315/comment/13986544","id":"13986544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waydena","name":"waydena","key":"waydena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wayne Evans","active":true,"timeZone":"America/New_York"},"body":"Does anyone know if this issue has been resolved in the latest revision?\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waydena","name":"waydena","key":"waydena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wayne Evans","active":true,"timeZone":"America/New_York"},"created":"2014-05-01T12:44:50.092+0000","updated":"2014-05-01T12:44:50.092+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674315/comment/13986565","id":"13986565","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"It may be sorted with https://issues.apache.org/jira/browse/AMQ-4505\n\nThe idea of sticking with the first in the updated list is because that ordered list is provided by the broker, and will be different for each connection, allowing the broker to dictate the rebalance.\n\nMaybe make a variant of https://github.com/apache/activemq/blob/20f384ce59b758a0f3c1b0e0620e2efd58ca230a/activemq-unit-tests/src/test/java/org/apache/activemq/transport/failover/FailoverComplexClusterTest.java to check your usecase.\n\nOn the rule that does not allow a message to replay back to the broker where it came from. there is a policy that can control that\nsee: http://activemq.apache.org/networks-of-brokers.html - conditionalNetworkBridgeFilterFactory\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2014-05-01T13:32:21.335+0000","updated":"2014-05-01T13:32:21.335+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12674315/comment/14016548","id":"14016548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"No test case provided that demonstrates an actual issue with this functionality.  The unit tests show things are currently working as expected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-06-03T14:21:27.244+0000","updated":"2014-06-03T14:21:27.244+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4812/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1p0rb:"}}