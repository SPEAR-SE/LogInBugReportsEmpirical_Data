{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12666575","self":"https://issues.apache.org/jira/rest/api/2/issue/12666575","key":"AMQ-4710","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316331","id":"12316331","description":"Next unplanned v5 maintenance release","name":"5.x","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-09-03T21:05:39.541+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Aug 27 17:19:22 UTC 2018","customfield_12310420":"346513","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4710/watchers","watchCount":6,"isWatching":false},"created":"2013-09-02T12:21:57.244+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-27T17:19:22.614+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315706","id":"12315706","name":"stomp"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"After ActiveMQ sends a stomp frame, it may not send a heart-beat for up to almost 2x the negotiated interval.\n\nThe following test should illustrate the problem:\n\n{code}\nimport org.junit.Test;\n\nimport static org.junit.Assert.*;\n\npublic class ActiveMqHeartbeatTests {\n\n\t@Test\n\tpublic void heartbeats() throws Exception {\n\t\tBrokerService broker = createAndStartBroker();\n\t\tSocket socket = null;\n\t\ttry {\n\t\t\tsocket = new Socket(\"localhost\", 61613);\n\t\t\tbyte[] connectFrame = \"CONNECT\\nheart-beat:0,10000\\naccept-version:1.2\\n\\n\\0\".getBytes();\n\t\t\tsocket.getOutputStream().write(connectFrame);\n\t\t\tbyte[] buffer = new byte[4096];\n\n\t\t\tlong lastReadTime = System.currentTimeMillis();\n\n\t\t\twhile (true) {\n\t\t\t\tint read = socket.getInputStream().read(buffer);\n\t\t\t\tbyte[] frame = Arrays.copyOf(buffer, read);\n\t\t\t\tlong now = System.currentTimeMillis();\n\t\t\t\tlong timeSinceLastRead = now - lastReadTime;\n\t\t\t\tlastReadTime = now;\n\t\t\t\tSystem.out.println(new String(frame));\n\t\t\t\tSystem.out.println(\"Time since last read: \" + timeSinceLastRead + \"ms\");\n\t\t\t\tif (timeSinceLastRead > 15000) {\n\t\t\t\t\tfail(\"Data not received for \" + timeSinceLastRead + \"ms\");\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tif (socket != null) {\n\t\t\t\tsocket.close();\n\t\t\t}\n\t\t\tbroker.stop();\n\t\t}\n\t}\n\n\tprivate BrokerService createAndStartBroker() throws Exception {\n\t\tBrokerService broker = new BrokerService();\n\t\tbroker.addConnector(\"stomp://localhost:61613\");\n\t\tbroker.setStartAsync(false);\n\t\tbroker.setDeleteAllMessagesOnStartup(true);\n\t\tbroker.start();\n\n\t\treturn broker;\n\t}\n\n}\n{code}\n\nFor the initial read of the CONNECTED frame I see:\n\n{noformat}\nTime since last read: 49ms\n{noformat}\n\nHowever, it's then almost 20 seconds before a heart-beat's sent:\n\n{noformat}\nTime since last read: 19994ms\n{noformat}\n\nIf I comment out the fail(…) line in the test, after the first heartbeat taking almost 20000ms to be sent, things settle down and a heartbeat's received every 10000ms.\n\nIt looks like the write checker wakes up every 10000ms. The first time it wakes up, it notices that the CONNECTED frame was sent and does nothing. It then sleeps for a further 10000ms before checking again. As the CONNECTED frame was sent very early in the first 10000ms window, this leads to it taking almost 20000ms for the first heart-beat to be sent. From this point, as no further data frames are sent, the write checker wakes up and sends a heart-beat every 10000ms.\n\nIn short, I don't think ActiveMQ is adhering to the requirement that \"the sender MUST send new data over the network connection at least every <n> milliseconds\".","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12602339","id":"12602339","filename":"amq-4710.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"created":"2013-09-10T13:56:11.973+0000","size":10844,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12602339/amq-4710.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12929778","id":"12929778","filename":"AMQ-4710-double-heartbeat-frequency.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbarrett","name":"lbarrett","key":"lbarrett","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbarrett&avatarId=36073","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbarrett&avatarId=36073","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbarrett&avatarId=36073","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbarrett&avatarId=36073"},"displayName":"Leon Barrett","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-29T22:05:00.878+0000","size":4711,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12929778/AMQ-4710-double-heartbeat-frequency.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"346814","customfield_12312823":null,"summary":"The first heart-beat after a connection becomes idle isn't sent as quickly as it should be","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awilkinson","name":"awilkinson","key":"awilkinson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Wilkinson","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awilkinson","name":"awilkinson","key":"awilkinson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Wilkinson","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13757072","id":"13757072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"body":"This problem doesn't just happen on startup. \n\nI've been able to induce this behavior in the broker. I modified the test to periodically send a frame to the broker containing a receipt header. This forces the broker to respond with a RECEIPT frame. After sending the RECEIPT frame the broker waits another 10000ms (in this case) before issuing another write check.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"created":"2013-09-03T21:05:39.541+0000","updated":"2013-09-03T21:05:39.541+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13757082","id":"13757082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Sending a frame is sending data on the wire so the send of the RECEIPT frame prempts any need to send a KEEPALIVE frame.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-09-03T21:10:32.193+0000","updated":"2013-09-03T21:10:32.193+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13757189","id":"13757189","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"body":"I believe the fix for this condition is as follows. I've tested it and it appears to work. However, feedback is welcome if there's a better way to handle this.\n\n{code}\n    private final Runnable writeChecker = new Runnable() {\n        long lastRunTime;\n\n        @Override\n        public void run() {\n            long now = System.currentTimeMillis();\n            long sleepTime = now - lastRunTime;\n\n            if (lastRunTime != 0 && LOG.isDebugEnabled()) {\n                LOG.debug(this + \" \" + sleepTime + \" ms elapsed since last write check.\");\n            }\n\n            if (commandSent.get() && sleepTime >= getWriteCheckTime()) {\n              LOG.trace(\"Resetting to prevent double sleep !!\");\n              commandSent.set(false);\n            }\n\n            lastRunTime = now;\n            writeCheck();\n        }\n\n        @Override\n        public String toString() {\n            return \"WriteChecker\";\n        }\n    };\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"created":"2013-09-03T22:47:44.135+0000","updated":"2013-09-03T22:47:44.135+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13757200","id":"13757200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You'd need to submit the change as a patch, can't tell what's changed above.  Also tests to show there's an issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-09-03T22:55:08.881+0000","updated":"2013-09-03T22:55:08.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13758350","id":"13758350","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"body":"Patch file containing test and fix for this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"created":"2013-09-04T21:07:53.949+0000","updated":"2013-09-04T21:07:53.949+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13758353","id":"13758353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"body":">Sending a frame is sending data on the wire so the send of the RECEIPT frame prempts any need to send a KEEPALIVE frame. \n\nAgreed. However, once data has been sent in lieu of a KEEPALIVE frame the write checker timer should be adjusted accordingly, otherwise it will sleep for twice its configured interval. \n\nI have attached a patch file containing a failing unit test (of sorts) and a fix. The test is not the prettiest so adjust as necessary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"created":"2013-09-04T21:08:29.029+0000","updated":"2013-09-04T21:08:29.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13761872","id":"13761872","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"body":"Unit test and patch to fix this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"created":"2013-09-09T14:12:52.817+0000","updated":"2013-09-09T14:12:52.817+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13761912","id":"13761912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"body":"Just realized I should have used a StompConnection object in the test. Trying again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"created":"2013-09-09T15:07:07.384+0000","updated":"2013-09-09T15:07:07.384+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13763052","id":"13763052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"body":"Latest greatest, and hopefully final, version of test and fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"created":"2013-09-10T13:56:11.975+0000","updated":"2013-09-10T13:56:11.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13765545","id":"13765545","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"body":"Any movement on this? I'd like to know whether this patch is going to be accepted or if other feedback is available.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulgale","name":"paulgale","key":"paulgale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Gale","active":true,"timeZone":"America/New_York"},"created":"2013-09-12T15:44:38.905+0000","updated":"2013-09-12T15:44:38.905+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/13772248","id":"13772248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Not sure this fix is really the way to go, on a busy system we could be canceling and rescheduling the timer quite a bit which introduces more overhead than I think is good here.  Would need to look at it more.  Probably won't make it into a v5.9.0 release. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-09-19T20:18:51.417+0000","updated":"2013-09-19T20:18:51.417+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/16519686","id":"16519686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elliotbc","name":"elliotbc","key":"elliotbc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Elliott","active":true,"timeZone":"America/Denver"},"body":"Admittedly I haven't looked at the code or thought about this very long. However having said that: since then problem is that the heartbeat interval may be 2x as long as desired, couldn't you set the timer to half the desired interval? Then each time the timer expires, check to see if the last heartbeat went out on timer expiration, and if not send a heart beat message? I believe such an approach would allow you to have a reasonable timer interrupt interval, avoid the resetting in a busy system, and ensure that heartbeats are sent out on time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elliotbc","name":"elliotbc","key":"elliotbc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Elliott","active":true,"timeZone":"America/Denver"},"created":"2018-06-21T18:57:24.973+0000","updated":"2018-06-21T18:57:24.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/16528317","id":"16528317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbarrett","name":"lbarrett","key":"lbarrett","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbarrett&avatarId=36073","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbarrett&avatarId=36073","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbarrett&avatarId=36073","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbarrett&avatarId=36073"},"displayName":"Leon Barrett","active":true,"timeZone":"America/Los_Angeles"},"body":"I ran into this issue also just now.\r\n\r\nThis breaks heartbeats in a number of clients, including the go and python STOMP clients linked from [the cross-language client page|http://activemq.apache.org/cross-language-clients.html]. It's really easy to test–enable heartbeats, connect and stay idle for a heartbeat cycle, and the client immediately has a heartbeat error.\r\n\r\nI agree that [~elliotbc]'s proposal (send heartbeats at twice the frequency) sounds best and simplest. It satisfies the STOMP spec (\"the sender MUST send new data over the network connection at least every {{<n>}} milliseconds\") and is quite simple to implement–basically a 3-line fix.\r\n\r\nI have attached a patch that implements that strategy and adds a test for that initial heartbeat issue. It would be great if this could be fixed–it would really improve ActiveMQ's cross-language compatibility. Let me know if there's anything I can do to help get this fix merged.\r\n\r\n[^AMQ-4710-double-heartbeat-frequency.patch]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbarrett","name":"lbarrett","key":"lbarrett","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbarrett&avatarId=36073","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbarrett&avatarId=36073","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbarrett&avatarId=36073","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbarrett&avatarId=36073"},"displayName":"Leon Barrett","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-29T22:13:54.863+0000","updated":"2018-06-29T22:13:54.863+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/16537477","id":"16537477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbarrett","name":"lbarrett","key":"lbarrett","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbarrett&avatarId=36073","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbarrett&avatarId=36073","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbarrett&avatarId=36073","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbarrett&avatarId=36073"},"displayName":"Leon Barrett","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi, any news? Do you need me to change anything in that patch? I am really quite interested in getting this bug fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbarrett","name":"lbarrett","key":"lbarrett","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbarrett&avatarId=36073","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbarrett&avatarId=36073","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbarrett&avatarId=36073","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbarrett&avatarId=36073"},"displayName":"Leon Barrett","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-07-09T19:53:04.358+0000","updated":"2018-07-09T19:53:04.358+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/16552988","id":"16552988","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbarrett","name":"lbarrett","key":"lbarrett","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbarrett&avatarId=36073","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbarrett&avatarId=36073","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbarrett&avatarId=36073","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbarrett&avatarId=36073"},"displayName":"Leon Barrett","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi, any news? I'm still available to help fix this bug, and I still think the general direction of this patch is a good one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbarrett","name":"lbarrett","key":"lbarrett","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbarrett&avatarId=36073","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbarrett&avatarId=36073","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbarrett&avatarId=36073","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbarrett&avatarId=36073"},"displayName":"Leon Barrett","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-07-23T15:23:12.429+0000","updated":"2018-07-23T15:23:12.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666575/comment/16593975","id":"16593975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbarrett","name":"lbarrett","key":"lbarrett","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbarrett&avatarId=36073","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbarrett&avatarId=36073","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbarrett&avatarId=36073","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbarrett&avatarId=36073"},"displayName":"Leon Barrett","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm still available to help merge this patch to fix this bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbarrett","name":"lbarrett","key":"lbarrett","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbarrett&avatarId=36073","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbarrett&avatarId=36073","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbarrett&avatarId=36073","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbarrett&avatarId=36073"},"displayName":"Leon Barrett","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-08-27T17:19:22.614+0000","updated":"2018-08-27T17:19:22.614+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4710/votes","votes":4,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1nr47:"}}