{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483855","self":"https://issues.apache.org/jira/rest/api/2/issue/12483855","key":"AMQ-2764","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"parent":{"id":"12483840","key":"AMQ-3021","self":"https://issues.apache.org/jira/rest/api/2/issue/12483840","fields":{"summary":"HttpTunnelServlet leaks BlockingQueueTransport objects, causing eventual OOM on heap space","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315624","id":"12315624","description":"Maintenance release for 5.4.0","name":"5.4.1","archived":false,"released":true,"releaseDate":"2010-09-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-07-12T13:47:25.368+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 06 13:44:44 UTC 2010","customfield_12310420":"14842","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_7233899388_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-08-27T11:58:10.252+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2764/watchers","watchCount":1,"isWatching":false},"created":"2010-06-04T18:33:10.864+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315621","id":"12315621","description":"","name":"5.3.1","archived":false,"released":true,"releaseDate":"2010-03-23"}],"issuelinks":[{"id":"12335024","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335024","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12483467","key":"AMQ-2831","self":"https://issues.apache.org/jira/rest/api/2/issue/12483467","fields":{"summary":"Set ClientID - InvalidClientIDException with http transport","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12335039","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335039","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12483475","key":"AMQ-2894","self":"https://issues.apache.org/jira/rest/api/2/issue/12483475","fields":{"summary":"Configuration error using '&' in transportConnector configuration ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-11-05T23:04:43.842+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have two AMQ setup.  And they use duplex network connection between.   After I restart one ActiveMQ which initiates the connection,  half of the message are missing.    In order to avoid this problem,  I have restart the other ActiveMQ.   And this  happens when I use \"staticallyIncludedDestinations\" or \"dynamicallyIncludedDestinations\" config in broker.\n\n1 SETUP:\na) SCA server has a network connector to remote server114.  In order to repeat this problem, you have to use \"staticallyIncludedDestinations\".\n\n<networkConnector name=\"SCA\" uri=\"static://(https://192.168.3.114:61617)\" duplex=\"true\">\n               <staticallyIncludedDestinations>\n                              <queue physicalName=\"R\"/>\n               </staticallyIncludedDestinations>\n</networkConnector>\n\nb) SCA server has a java code consumer listening on queue R:\n\nc)  Remote server114 is listening on 61617, see config below;\n<transportConnectors> \n           <transportConnector name=\"openwire\" uri=\"tcp://0.0.0.0:61616\"/> \n           <transportConnector name=\"https\" uri=\"https://0.0.0.0:61617?needClientAuth=true\"/> \n</transportConnectors> \n(See attached picture \"Remote-Console1.jpg\".)\n\n2. Restart activemq on SCA server and restart consumer application listening on queue R on SCA too.  Remote server114 activemq admin console shows there are two consumers on R. \n(See attached picture \"Remote-Console2.jpg\")\n\n3 Start a producer on remote server114 to send 10 messages to R.  On SCA server, consumer on R  only receives 5 messages.\n(See attached picture \"SCA-consumer1.JPG\")\n\n4. On remote server114 activemq admin console, these 10 messages are divided by these two consumers.\n(See attached picture \"Remote-Console3.jpg\")\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461725","id":"12461725","filename":"Remote-Console1.JPG","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qingyi","name":"qingyi","key":"qingyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qingyi Gu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-04T18:34:45.974+0000","size":57083,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12461725/Remote-Console1.JPG"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461726","id":"12461726","filename":"Remote-Console2.JPG","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qingyi","name":"qingyi","key":"qingyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qingyi Gu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-04T18:34:46.089+0000","size":58419,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12461726/Remote-Console2.JPG"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461727","id":"12461727","filename":"Remote-Console3.JPG","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qingyi","name":"qingyi","key":"qingyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qingyi Gu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-04T18:34:46.143+0000","size":58176,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12461727/Remote-Console3.JPG"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461728","id":"12461728","filename":"SCA-consumer1.JPG","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qingyi","name":"qingyi","key":"qingyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qingyi Gu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-04T18:35:09.202+0000","size":43171,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12461728/SCA-consumer1.JPG"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461681","id":"12461681","filename":"test-case.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-08-24T20:58:30.555+0000","size":14850,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461681/test-case.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461674","id":"12461674","filename":"test-case.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-08-23T20:48:03.638+0000","size":9428,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461674/test-case.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"63729","customfield_12312823":null,"summary":"For \"duplex\" network connection,  after restart one ActiveMQ,  message is missing.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qingyi","name":"qingyi","key":"qingyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qingyi Gu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qingyi","name":"qingyi","key":"qingyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qingyi Gu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows2k3,  AMQ 5.3.1, ","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483855/comment/12942478","id":"12942478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lcurry","name":"lcurry","key":"lcurry","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lowry Curry","active":true,"timeZone":"Etc/UTC"},"body":"Steps to reproduce the issue\n----------------------------------\nTo reproduce this issue I installed apache-activemq-5.3.2 in two separate locations. The scenario simulates a hub and spoke architecture in which the hub (Broker1) will be connected (via a networkConnector) to Broker2. The network connector uses \"http\" rather than \"tcp\" for connection between brokers. This is a requirement for customer because customer  broker connection must traverse distinct networks. Note the problem does not seem to occur when \"tcp\" is used. The networkConnector also defines a \"staticallyIncludedDestination\".\n\nThe problem happens when Broker1 is shutdown and restarted. After that, the networkConnector (store and forward)\nmechanism seems to break. Messages that should be available to a consumer in queue on Broker1 are not sent to consumer\nand appear to be lost.  \n\nThe actual config details are given below. Also attached are the activemq.xml files for Broker1 and Broker2.\n\n1)\tUpdate activemq.xml for Broker1.\nThe changes to the default configuration for Broker1 include the following: \n•\tChange the broker name from localhost to Broker1\n•\tAdd networkConnector to Broker2.\n\n    <broker xmlns=\"http://activemq.apache.org/schema/core\" useJmx=\"true\" brokerName=\"BROKER1\" dataDirectory=\"${activemq.base}\n/data\" destroyApplicationContextOnStop=\"true\" >\n\n...\n...\n      <networkConnectors>\n              <networkConnector name=\"SCA\" uri=\"static://(http://localhost:61617)\" duplex=\"true\">\n                      <staticallyIncludedDestinations>\n                      <queue physicalName=\"R\"/>\n                      </staticallyIncludedDestinations>\n              </networkConnector>\n      </networkConnectors>\n\n\n2)\tUpdate the activemq.xml for Broker2\nThe changes to the default configuration for Broker2 include the following:\n•\tChange the broker name from localhost to Broker2\n•\tChange the default transport connector (tcp) to listen on 61618 (to avoid conflict with Broker1's tcp port)\n•\tAdd an transport connector (http) for port 61617. This is the port that will be connected to by Broker1.\n\n    <broker xmlns=\"http://activemq.apache.org/schema/core\" useJmx=\"true\" brokerName=\"BROKER2\" dataDirectory=\"${activemq.base}\n/data\" destroyApplicationContextOnStop=\"true\">\n...\n...\n       <transportConnectors>\n           <transportConnector name=\"openwire\" uri=\"tcp://0.0.0.0:61618\"/>\n           <transportConnector name=\"http\" uri=\"http://0.0.0.0:61617\"/>\n       </transportConnectors>\n\n\n\n3)\tStart Broker2 using the activemq.bat script in Broker2's installation /bin directory.\n4)\tStart Broker1 using the activemq.bat script in Broker1's installation /bin directory.\n\n\n5)\tRun simple producer/consumer scenarios.\na)\tRun consumer against 61616 (Broker1).\n Go to Broker1's example directory:\nE.g.\nC:\\Progress\\apache-activemq-5.3.2\\example\nRun the following:\n\n\tant consumer -Durl=tcp://localhost:61616 -Dmax=100 -Dsubject=R\nThe above command will connect to Broker1 and listen for 100 messages on queue R on Broker1\n\nb)\tNext in another window - same directory - run the following:\n\tant producer -Durl=tcp://localhost:61616 -Dmax=10 -Dsubject=R\nThe above command will connect to Broker1 and send 10 messages to queue R on Broker1\n\nYou should see the consumer will receive the 10 messages.\nc)\tNext, Run producer to send messages to Broker2:\n\tant producer -Durl=tcp://localhost:61618 -Dmax=10 -Dsubject=R\nBecause of the networkConnector set up for queue R between Broker1->Broker2, the consumer (that was already running and connected to Broker1) should also receive these 10 messages that were sent to queue R on Broker2.\n\n6)\tShutdown Broker1 and restart.\n\n7)\tRun step 5 again. You will see when you run the producer the second time (step 5c) that not all the messages get to the consumer connected to queue R on Broker1. Only every other message arrive at consumer. \n\nYou can shutdown Broker1 and repeat step 5 over and over and each time you will see fewer and fewer messages arrive at consumer connected to queue R on Broker1.  Where do these messages go?\n\nInformation from jconsole\n-------------------------------\nWhile running this test case, start jconsole and attach to each of the brokers.\nOn Broker2 open the MBeans tab and expand activemq->BROKER2->Subscription->Non-Durable->Queue->R->NC_BROKER1_inbound_BROKER2\nThis will show the subscription created on Broker2 by the networkConnector.\nEach time you shutdown Broker1 and restart, jconsole will show a new Subscription created in Broker2.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lcurry","name":"lcurry","key":"lcurry","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lowry Curry","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-12T13:47:25.368+0000","updated":"2010-07-12T13:47:25.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483855/comment/12937720","id":"12937720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"body":"I've put together a test case (attached test-case.txt) similar to the NetworkReconnectTest that specifically goes through the steps in Lowry's description but I can't seem to reproduce this on trunk.  Have you tried this on the 5.4 release or on the latest snapshot?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-08-23T20:48:03.732+0000","updated":"2010-08-23T20:57:01.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483855/comment/12936737","id":"12936737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qingyi","name":"qingyi","key":"qingyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qingyi Gu","active":true,"timeZone":"Etc/UTC"},"body":"I just tested with AMQ5.4.0 release,  the problem still exists.  I looked at your activemq config in your test case.  I think you have broker1 and broker2 reversed based on Lowry's description.   There is one little typo in Lowry's comment.   In his first step \"1) Update activemq.xml for Broker1.\",  it should be \"Add networkConnector to Broker1\", not  \"Add networkConnector to Broker2.\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qingyi","name":"qingyi","key":"qingyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qingyi Gu","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-24T13:03:53.439+0000","updated":"2010-08-24T13:03:53.439+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483855/comment/12936422","id":"12936422","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"body":"Thanks for that, have re-worked the test case and it does reproduce the issue now, have attached an update.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-08-24T20:58:30.692+0000","updated":"2010-08-24T20:58:30.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483855/comment/12937216","id":"12937216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"it looks like due to http being async the bridge does not get torn down when the remote broker shutsdown as is the case with a tcp connection. With tcp there is always an outstanding read that will fail. It looks like the failed read is is being retried in the http case.\nIt may be a case of configuring retry semantics for http client but I think it may need some duplicate detection of network connectors based on name or something. need to research it a bit.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-25T11:46:41.774+0000","updated":"2010-08-25T11:46:41.774+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483855/comment/12942762","id":"12942762","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"fix in r990107\n\nInactivityMonitor added to http transport by default. May be disabled via query parameters useInactivityMonitor=false for clients and transport.useInactivityMonitor=false on the broker side.\nThe default 30second timeout can be configured via url query params:\n{code}\"http://localhost:61617?transport.readCheckTime=4000&amp;transport.initialDelayTime=4000\"{code} For a duplex network connector, these are applied to the target broker http listener so that they apply to the return network connector transport connection.\ntest case included, was a great help, thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-27T11:58:10.220+0000","updated":"2010-08-27T11:58:10.220+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483855/comment/12942996","id":"12942996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"An additional fix that enables transport options to persist connector restart has been committed with svn revision 1005033 and will be available in 5.5.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-06T13:44:44.065+0000","updated":"2010-10-06T13:44:44.065+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2764/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0b9zb:"}}