{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482065","self":"https://issues.apache.org/jira/rest/api/2/issue/12482065","key":"AMQ-1322","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315615","id":"12315615","description":"","name":"4.1.2","archived":false,"released":true,"releaseDate":"2008-04-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2007-07-24T12:32:37.956+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 24 12:32:37 UTC 2007","customfield_12310420":"38753","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_954765080_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2007-07-24T14:03:27.393+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1322/watchers","watchCount":0,"isWatching":false},"created":"2007-07-13T12:50:42.313+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315614","id":"12315614","description":"","name":"4.1.1","archived":false,"released":true,"releaseDate":"2007-06-08"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlim","name":"jlim","key":"jlim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonas Lim","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-07-24T14:03:27.337+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Consider the following situation:\n - The AdvisoryBroker sends a message to a non existent yet advisory topic. (a producer advisory, for example).\n - The RegionBroker sends the request to the TopicRegion.\n - The TopicRegion automatically creates the new topic, sending:\n    context.getBroker().addDestination(context,  destination);\n- This eventually reaches again the AdvisoryBroker that adds the destination to its destination map.\n\nNow, when the queue that triggered the creation of the advisory topic is deleted, the AdvisoryBroker attempts to delete the consumer and producer related topics, but doesn't clear them from its own destination map.\n\nI'm attaching a proposed fix for the 4.1 branch, where:\n\n- The AdvisoryBroker tries to delete those producer and consumer advisories from top of the broker.\n- This is only made if the incoming destination is not a temporary itself, to avoid improper attempts to delete advisories of advisories.\n\nIn the trunk , the situation is different. \n- The TopicRegion (actually in AbstracRegion code) creates the 'on demand' topics internally, without advising the RegionBroker.\n- So, since the RegionBroker is not aware of these newly created topics, AdvisoryBroker attempts to delete the producer and consumer advisory topics are futile.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460838","id":"12460838","filename":"ASF.LICENSE.NOT.GRANTED--AdvisoryBroker.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2007-07-13T12:50:42.481+0000","size":4377,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12460838/ASF.LICENSE.NOT.GRANTED--AdvisoryBroker.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"255029","customfield_12312823":null,"summary":"AdvisoryBroker leaks destinations created \"from top\" by the RegionBroker","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"activemq svn branch 4.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482065/comment/12936348","id":"12936348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlim","name":"jlim","key":"jlim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonas Lim","active":true,"timeZone":"Etc/UTC"},"body":"patch applied in 4.1 branch r559023","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlim","name":"jlim","key":"jlim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonas Lim","active":true,"timeZone":"Etc/UTC"},"created":"2007-07-24T12:32:37.956+0000","updated":"2007-07-24T12:32:37.956+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1322/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i181ef:"}}