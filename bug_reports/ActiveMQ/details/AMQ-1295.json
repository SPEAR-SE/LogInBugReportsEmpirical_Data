{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483321","self":"https://issues.apache.org/jira/rest/api/2/issue/12483321","key":"AMQ-1295","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2007-06-26 14:25:15.795","customfield_12310420":"68693","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_127291761359_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-08T21:14:37.141+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1295/watchers","watchCount":2,"isWatching":false},"created":"2007-06-26T14:25:15.795+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-07-08T21:14:37.150+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Not sure about the exact conditions triggering this bug, but I was able to reproduce it multiple times using the attached client. What the client does is:\n-Opens a connection.\n-Creates a configurable number of threads to play the role of consumers in a given queue.\n    -The consumer creates a transacted session and fetches messages using a JMSConsumer.\n-Creates a configurable number of threads to play the role of producers in the given queue.\n    -Every consumer sends a given amount of messages to the queue, opening a AUTO_ACKNOWLEDGE session and a JMSProducer to send them.\n\nThe bug was detected running two clients simultaneously, with the configuration:\n- 1 Producer\n- 10 Consumers\n- 1000 Messages\n\nSometimes one or two messages weren't delivered to the consumers. Running a new client on the same queue didn't help. The only way to get the \"frozen\" messages delivered was restarting the browser.\nOn other situations, some message was delivered twice. This was seen as the JMX console reported a queuesize = -2, and dequeuecount = enqueuecount + 2. Also, a counter in the client  updated for every received message shown the wrong count of messages.รง\n\nThe situation is hard or imposible to reproduce if:\n- You disable completely persistence.\n- You add some synchronized code in the client, between the lines:\nmsg = consumer.receive(2000),\nsession.commit();\n\nlike the commented statement incrConsumedCount(), perhaps shortening the probability of a race condition.\n\n- You run only a client at once (perhaps the problem only happens with consumers from different connections simultaneously)\n- If you don't use multicast to connect to the broker. I'm using, as jndi.properties:\njava.naming.provider.url = discovery:(multicast://planb.llu.xxxx)\n\nand the same discoveryUri in a openwire connector in the broker. I'm attaching the client I've used and the configuration to reproduce the problem.\n\n- I was not able to reproduce it using 4.1.1\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460875","id":"12460875","filename":"ASF.LICENSE.NOT.GRANTED--JMSTestCP.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-26T14:25:15.886+0000","size":5600,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12460875/ASF.LICENSE.NOT.GRANTED--JMSTestCP.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460804","id":"12460804","filename":"ASF.LICENSE.NOT.GRANTED--planb.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-26T14:25:15.920+0000","size":1153,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12460804/ASF.LICENSE.NOT.GRANTED--planb.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59856","customfield_12312823":null,"summary":"Message lost and duplication with multiple consumers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Standalone broker, Oracle JDBC, no journal persistence.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1295/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0am47:"}}