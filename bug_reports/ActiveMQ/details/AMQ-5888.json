{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12845246","self":"https://issues.apache.org/jira/rest/api/2/issue/12845246","key":"AMQ-5888","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329258","id":"12329258","name":"5.12.0","archived":false,"released":true,"releaseDate":"2015-08-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-07-15T14:28:44.762+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jul 16 11:18:47 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_81600921_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-07-16T11:18:47.842+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5888/watchers","watchCount":4,"isWatching":false},"created":"2015-07-15T12:38:46.950+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-07-16T11:18:47.866+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Closing an ActiveMQConnection by calling the close() method caused the following warning message to show in the log\n\n17:59:05,384 | WARN  | org.apache.activemq.broker.TransportConnection:245 Transport Connection to: tcp://127.0.0.1:41062 failed: java.io.EOFException\n\nThis exception is harmless but this WARN message appears repeatedly in the logs which is a source of false alarm.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12745468","id":"12745468","filename":"AMQ-5888-GMURTHY-NEW-PATCH.TXT","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ganeshmurthy","name":"ganeshmurthy","key":"ganeshmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ganeshmurthy&avatarId=25271","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ganeshmurthy&avatarId=25271","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ganeshmurthy&avatarId=25271","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ganeshmurthy&avatarId=25271"},"displayName":"Ganesh Murthy","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-15T15:52:04.481+0000","size":5478,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12745468/AMQ-5888-GMURTHY-NEW-PATCH.TXT"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12745439","id":"12745439","filename":"AMQ-5888-GMURTHY-PATCH.TXT","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ganeshmurthy","name":"ganeshmurthy","key":"ganeshmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ganeshmurthy&avatarId=25271","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ganeshmurthy&avatarId=25271","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ganeshmurthy&avatarId=25271","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ganeshmurthy&avatarId=25271"},"displayName":"Ganesh Murthy","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-15T13:10:31.253+0000","size":1088,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12745439/AMQ-5888-GMURTHY-PATCH.TXT"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12745440","id":"12745440","filename":"TcpTransportCloseConnectionTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ganeshmurthy","name":"ganeshmurthy","key":"ganeshmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ganeshmurthy&avatarId=25271","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ganeshmurthy&avatarId=25271","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ganeshmurthy&avatarId=25271","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ganeshmurthy&avatarId=25271"},"displayName":"Ganesh Murthy","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-15T13:12:14.103+0000","size":3907,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12745440/TcpTransportCloseConnectionTest.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Transport Connection to: tcp://127.0.0.1:41062 failed: java.io.EOFException shows up in log when closing connection normally","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ganeshmurthy","name":"ganeshmurthy","key":"ganeshmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ganeshmurthy&avatarId=25271","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ganeshmurthy&avatarId=25271","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ganeshmurthy&avatarId=25271","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ganeshmurthy&avatarId=25271"},"displayName":"Ganesh Murthy","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ganeshmurthy","name":"ganeshmurthy","key":"ganeshmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ganeshmurthy&avatarId=25271","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ganeshmurthy&avatarId=25271","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ganeshmurthy&avatarId=25271","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ganeshmurthy&avatarId=25271"},"displayName":"Ganesh Murthy","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845246/comment/14628027","id":"14628027","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ganeshmurthy","name":"ganeshmurthy","key":"ganeshmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ganeshmurthy&avatarId=25271","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ganeshmurthy&avatarId=25271","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ganeshmurthy&avatarId=25271","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ganeshmurthy&avatarId=25271"},"displayName":"Ganesh Murthy","active":true,"timeZone":"Etc/UTC"},"body":"The log message is output from the public void serviceTransportException(IOException e) method of the org.apache.activemq.broker.TransportConnection class only if the stopping and the pendingStop flags have not been already set before the serviceTransportException(IOException e)  is called as seen from the following code snippet - \n\n        if (!stopping.get() && !pendingStop) {\n            transportException.set(e);\n            if (TRANSPORTLOG.isDebugEnabled()) {\n                TRANSPORTLOG.debug(this + \" failed: \" + e, e);\n            } else if (TRANSPORTLOG.isWarnEnabled() && !expected(e)) {\n                TRANSPORTLOG.warn(this + \" failed: \" + e);   //--> This is where the WARN is written to the log.\n            }\n            stopAsync(e);\n        }\n\nSequence of events - \n1. The close() method on the ActiveMQConnection sends a ShutdownInfo to the server and immediately closes the socket from the client side. \n2. The broker's TcpTransportConnection is handling this ShutdownInfo but it so happens that the Inactivity monitor also fires off a write to the closed socket and fails with an EOFException or SocketException.\n3. The public void stopAsync() in the org.apache.activemq.broker.jmx.ManagedTransportConnection makes a call to unregister the MBeans and then sets the  stopping flag. The latency involved in unregistering the beans is causing the stopping flag to not be set in time, so the WARN message is caused. \n\nMoving the stopping flag to be set before the unregister bean call should set the stopping flag to be set and prevent the WARN message from being written to the log.\n\nI have attached a patch a test.\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ganeshmurthy","name":"ganeshmurthy","key":"ganeshmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ganeshmurthy&avatarId=25271","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ganeshmurthy&avatarId=25271","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ganeshmurthy&avatarId=25271","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ganeshmurthy&avatarId=25271"},"displayName":"Ganesh Murthy","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-15T13:09:01.218+0000","updated":"2015-07-15T13:09:01.218+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845246/comment/14628132","id":"14628132","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~ganeshmurthy]  peeking at the patch - it looks like the mbeans won't get unregistered b/c the stopping flag will be flipped by the super stopAsync.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-15T14:28:44.762+0000","updated":"2015-07-15T14:28:44.762+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845246/comment/14628209","id":"14628209","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ganeshmurthy","name":"ganeshmurthy","key":"ganeshmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ganeshmurthy&avatarId=25271","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ganeshmurthy&avatarId=25271","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ganeshmurthy&avatarId=25271","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ganeshmurthy&avatarId=25271"},"displayName":"Ganesh Murthy","active":true,"timeZone":"Etc/UTC"},"body":"Good catch Gary. Gosh, I introduced a regression. I have attached a new patch after doing some testing. I removed the if(!isStopping()) conditional. The unregister now gets called.\n\nPlease see patch AMQ-5888-GMURTHY-NEW-PATCH.TXT  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ganeshmurthy","name":"ganeshmurthy","key":"ganeshmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ganeshmurthy&avatarId=25271","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ganeshmurthy&avatarId=25271","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ganeshmurthy&avatarId=25271","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ganeshmurthy&avatarId=25271"},"displayName":"Ganesh Murthy","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-15T15:15:05.513+0000","updated":"2015-07-15T15:15:05.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845246/comment/14629576","id":"14629576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 2b5b890db9810ff282479d7688c36e3c78e32c73 in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2b5b890 ]\n\nAMQ-5888 add patch from GMURTHY with thanks - fix and test\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-16T11:16:51.966+0000","updated":"2015-07-16T11:16:51.966+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845246/comment/14629579","id":"14629579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"fix and test applied via patch with thanks to Ganesh Murthy\n\nhttps://git1-us-west.apache.org/repos/asf/activemq/repo?p=activemq.git;a=commit;h=2b5b890db9810ff282479d7688c36e3c78e32c73 ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-16T11:18:47.862+0000","updated":"2015-07-16T11:18:47.862+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5888/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ha4n:"}}