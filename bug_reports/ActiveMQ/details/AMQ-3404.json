{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12514469","self":"https://issues.apache.org/jira/rest/api/2/issue/12514469","key":"AMQ-3404","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-07-21T10:08:55.631+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Dec 16 11:41:22 UTC 2011","customfield_12310420":"60053","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_233830731_*|*_6_*:*_2_*:*_12171804155_*|*_5_*:*_2_*:*_462741456_*|*_4_*:*_2_*:*_158201549","customfield_12312321":null,"resolutiondate":"2011-12-16T11:41:22.682+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3404/watchers","watchCount":3,"isWatching":false},"created":"2011-07-18T17:11:44.920+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-16T11:41:22.807+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The admin purge command does not work with a message selector.\nA patch is forth coming, there is some cleanup, and compliance to be vetted before I can attach the patch.\n\n(1) Browse with no arguments:\n\nuser@activemq-master:~/activemq$ activemq-admin browse --amqurl tcp://localhost:61616  --view JMSTimestamp queue.FOO.BAR\n\nJava Runtime: Sun Microsystems Inc. 1.6.0_22\n/home/y/libexec/jdk1.6.0/jre\n   Heap sizes: current=60800k  free=58531k  max=902976k\n     JVM args: -Dactivemq.classpath=\"\" \n     -Djavax.net.ssl.trustStoreType=JKS\n\nACTIVEMQ_HOME: /home/y/libexec/activemq\nACTIVEMQ_BASE: /home/y/libexec/activemq\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608108263\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608108740\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608109283\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608109790\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608110324\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608110831\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608111374\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608111872\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608112415\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608113005\n\n\n\n(2) Browse with msgsel\n\nuser@activemq-master:~/activemq$ activemq-admin browse --amqurl tcp://localhost:61616  --view JMSTimestamp --msgsel 'JMSTimestamp<1310608110324' queue.FOO.BAR\n\nJava Runtime: Sun Microsystems Inc. 1.6.0_22\n/home/y/libexec/jdk1.6.0/jre\n   Heap sizes: current=60800k  free=58535k  max=902976k\n     JVM args: -Dactivemq.classpath=\"\"\n     -Djavax.net.ssl.trustStoreType=JKS\n\nACTIVEMQ_HOME: /home/y/libexec/activemq\nACTIVEMQ_BASE: /home/y/libexec/activemq\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608108263\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608108740\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608109283\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608109790\n\n(3) Purge with msgsel: - Not Working -  (what I wanted here was to use only those\nmatching my criteria)\n\nuser@activemq-master:~/activemq$ activemq-admin purge --msgsel 'JMSTimestamp<1310608110324' queue.FOO.BAR\n\nJava Runtime: Sun Microsystems Inc. 1.6.0_22\n/home/y/libexec/jdk1.6.0/jre\n   Heap sizes: current=60800k  free=58531k  max=902976k\n     JVM args: -Dactivemq.classpath=\"\" \n     -Djavax.net.ssl.trustStoreType=JKS\n\nACTIVEMQ_HOME: /home/y/libexec/activemq\nACTIVEMQ_BASE: /home/y/libexec/activemq\n\nConnecting to JMX URL:\nservice:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:1\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:2\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:3\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:4\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:5\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:6\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:7\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:8\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:9\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:32:1:1:10\nfrom queue: queue.FOO.BAR\n\n\n(4) Purge with msgsel working with a patch:\n\nuser@activemq-master:~/activemq$ activemq-admin browse --amqurl tcp://localhost:61616  --view JMSTimestamp --msgsel 'JMSTimestamp<1310608391914' queue.FOO.BAR\n\nJava Runtime: Sun Microsystems Inc. 1.6.0_22\n/home/y/libexec/jdk1.6.0/jre\n   Heap sizes: current=60800k  free=58535k  max=902976k\n     JVM args: -Dactivemq.classpath=\"\" \n     -Djavax.net.ssl.trustStoreType=JKS\n\nACTIVEMQ_HOME: /home/y/libexec/activemq\nACTIVEMQ_BASE: /home/y/libexec/activemq\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608389116\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608389607\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608390266\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608390781\n\nJMS_HEADER_FIELD:JMSTimestamp = 1310608391390\n\n\n\nuser@activemq-master:~/activemq$ ./activemq-admin purge  --msgsel 'JMSTimestamp<1310608391914'  queue.FOO.BAR \n\nJava Runtime: Sun Microsystems Inc. 1.6.0_22\n/home/y/libexec/jdk1.6.0/jre\n   Heap sizes: current=60800k  free=58575k  max=902976k\n     JVM args: -Dactivemq.classpath=\"\" \n\n     -Djavax.net.ssl.trustStoreType=JKS\n\nACTIVEMQ_HOME: /home/y/libexec/activemq\nACTIVEMQ_BASE: /home/y/libexec/activemq\n\nConnecting to JMX URL:\nservice:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi\nINFO: Addobjects is :[JMSTimestamp<1310608391914]\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:33:1:1:1\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:33:1:1:2\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:33:1:1:3\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:33:1:1:4\nfrom queue: queue.FOO.BAR\nINFO: Removing message:\nID:activemq-master-55970-1309958858075-2:33:1:1:5\nfrom queue: queue.FOO.BAR\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12507370","id":"12507370","filename":"AMQ-3404.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2011-12-14T15:51:17.257+0000","size":13552,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12507370/AMQ-3404.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12487233","id":"12487233","filename":"PurgeCommand.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"created":"2011-07-20T23:27:54.884+0000","size":15802,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12487233/PurgeCommand.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"59382","customfield_12312823":null,"summary":"Purge command does not accept message selectors","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13068432","id":"13068432","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"body":"The correct fix is to use a QueryViewMbean:\n\n//                        List messages = JmxMBeansUtil.createMessageQueryFilter(createJmxConnection(), queueName).query(queryAddObjects);\n//                        purgeMessages(queueName, messages);\n\t\t\t\t\t\tQueueViewMBean proxy = (QueueViewMBean) MBeanServerInvocationHandler\n\t\t\t\t\t\t\t\t.newProxyInstance(createJmxConnection(),\n\t\t\t\t\t\t\t\t\t\tqueueName, QueueViewMBean.class, true);\n\t\t\t\t\t\tint removed = 0;\n\t\t\t\t\t\tfor (String remove : queryAddObjects) {\n\t\t\t\t\t\t\tremoved = proxy.removeMatchingMessages(remove);\n\t\t\t\t\t\t\tcontext.printInfo(\"Removed: \" + removed\n\t\t\t\t\t\t\t\t\t+ \" messages for msgsel\" + remove);\n\t\t\t\t\t\t}\n                    }\nA patch and test is forthcoming, but -xmsgsel will not work with this patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"created":"2011-07-20T15:20:49.382+0000","updated":"2011-07-20T15:20:49.382+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13068711","id":"13068711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"body":"Patch to fix this issue, with a test cases that fails before and passes afterwards.\n\nLicense on test code comes from copying other test code, specifically org.apache.activemq.network.jms.QueueBridgeTest","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"created":"2011-07-20T23:27:54.902+0000","updated":"2011-07-20T23:27:54.902+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13068885","id":"13068885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Patch applied with svn revision 1149095. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2011-07-21T10:08:55.631+0000","updated":"2011-07-21T10:08:55.631+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13071272","id":"13071272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"body":"This works for me, and is complete.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"created":"2011-07-26T18:41:17.104+0000","updated":"2011-07-26T18:41:17.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13108512","id":"13108512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"reopen to set fix version to 5.6","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-20T10:56:09.193+0000","updated":"2011-09-20T10:56:09.193+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13108557","id":"13108557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"closing again with correct fix version","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-20T11:01:35.331+0000","updated":"2011-09-20T11:01:35.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13169457","id":"13169457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"body":"I need to reopen this bug.\n\nThe proposed fix has a problem. When multiple message selector criteria are specified using a comma separated list, as in \n{code}\n--msgsel \"JMSMessageID='*:10',JMSPriority>5\"\n{code}\n\nthen the current fix maps the criteria using an OR logical operator as this code shows:\n\n{code:title=PurgeCommand.java}\nprotected void runTask(List<String> tokens) throws Exception {\n  ...\n  for (String remove : queryAddObjects) {\n\tremoved = proxy.removeMatchingMessages(remove);\n\tcontext.printInfo(\"Removed: \" + removed\n\t\t+ \" messages for msgsel\" + remove);\n  }\n  ...\n}\n{code}\nThis code iterates through each message selector criteria and removes the messages that matches each criteria individually.\n\nInstead comma separated selector criteria should be treated as an AND operator. The usage output for activem-admin purge -help and activemq-admin browse -help suggests this and its also the way how activemq-admin browse behaves. \n\n\nProposing a new fix including an updated TestPurgeCommand.java test.\n\nThis fix works with the ActiveMQ specific message selector syntax, e.g. \n{code}\n   --msgsel \"JMSMessageID='*:10',JMSPriority>5\"\n{code}\nbut also with an SQL92 syntax specified on command line, e.g. \n{code} \n   --msgsel \"(JMSMessageID='*:10') AND (JMSPriority>5)\"\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2011-12-14T15:50:07.349+0000","updated":"2011-12-14T15:50:07.349+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13169458","id":"13169458","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"body":"Attaching a possible fix in AMQ-3404.patch and would like to get some confirmation that this solution is good before I commit this fix.\n\nAny feedback appreciated.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2011-12-14T15:51:17.325+0000","updated":"2011-12-14T15:51:17.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13170148","id":"13170148","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"This patch looks OK to me","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2011-12-15T12:01:39.206+0000","updated":"2011-12-15T12:01:39.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13170324","id":"13170324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"body":"Looks good to me.  I missed the sql92, and the , operator when I first did this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=areese","name":"areese","key":"areese","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Reese","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-15T16:17:22.854+0000","updated":"2011-12-15T16:17:22.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514469/comment/13170920","id":"13170920","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"body":"Fixed in revision 1215056.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2011-12-16T11:41:22.705+0000","updated":"2011-12-16T11:41:22.705+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3404/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0aj6v:"}}