{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483744","self":"https://issues.apache.org/jira/rest/api/2/issue/12483744","key":"AMQ-2743","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"parent":{"id":"12482973","key":"AMQ-2765","self":"https://issues.apache.org/jira/rest/api/2/issue/12482973","fields":{"summary":"After failover, messages will not be delivered to MessageEndpoint","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-04-07T21:07:58.211+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 28 08:04:02 UTC 2011","customfield_12310420":"44142","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_45458264285_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-10-28T08:04:02.811+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2743/watchers","watchCount":2,"isWatching":false},"created":"2010-05-20T04:46:18.635+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315621","id":"12315621","description":"","name":"5.3.1","archived":false,"released":true,"releaseDate":"2010-03-23"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-10-28T08:04:02.901+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When using a pure/master slave configuration in ActiveMQ 5.3.1 and the master is killed, the failover to the slave never takes place. \n\nBelow is a description of the topology being used: \n\n* The producer sends messages to brokerA \n* BrokerA has a uni-directional network connection using the failover transport to brokerB-master and brokerB-slave \n* BrokerB-master and brokerB-slave each have a uni-directional network connection using failover to brokerA \n* The consumer uses a failover connection to brokerB-master and brokerB-slave \n\nBelow are the steps to reproduce the problem: \n# In terminal one, start up brokerA \n# In terminal two, start up brokerB-master \n# In terminal three, start up brokerB-slave \n# In terminal four, start up the consumer that connects to brokerB-master and brokerB-slave  \n# In terminal five, startup the producer that connects to brokerA to send messages \n# In terminal two, kill brokerB-master \n# Notice that the producer will continue sending messages until producer flow control kicks in and blocks the send operation, but brokerB-slave never takes over \n\nI copied the same exact configuration files over to instances of ActiveMQ 5.3.0 and it works without a problem. There must be something in ActiveMQ 5.3.1 that is causing this issue. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461701","id":"12461701","filename":"activemq-brokerA.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2010-05-20T04:47:15.316+0000","size":3839,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461701/activemq-brokerA.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461702","id":"12461702","filename":"activemq-brokerB-master.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2010-05-20T04:47:15.363+0000","size":3887,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461702/activemq-brokerB-master.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461703","id":"12461703","filename":"activemq-brokerB-slave.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2010-05-20T04:47:15.407+0000","size":4016,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461703/activemq-brokerB-slave.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59027","customfield_12312823":null,"summary":"Pure master/slave configuration will not failover to slave when master fails ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483744/comment/12942697","id":"12942697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"body":"Attaching the three config files needed to reproduce the problem. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2010-05-20T04:47:15.484+0000","updated":"2010-05-20T04:47:15.484+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483744/comment/13017147","id":"13017147","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scotte","name":"scotte","key":"scotte","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Emmons","active":true,"timeZone":"Etc/UTC"},"body":"We have seen this same thing. Everything was fine in 5.3.0, but unable to failover to slave in 5.4.2. This is a serious issue - we cannot rollback to 5.3.0 due to other bugs, fixed in later versions - and we can not deploy a fault-tolerant configuration on a newer version, because of this bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scotte","name":"scotte","key":"scotte","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Emmons","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-07T21:07:58.211+0000","updated":"2011-04-07T21:07:58.211+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483744/comment/13017362","id":"13017362","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"NetworkConnectors and the failover transport can work against each other as they both do retries to reconnect on failure.\nWhen failover is used with a network connector, the failover transport needs to propagate a failure such that the network bridge can be recreated. To achieve this you need to provide maxReconnectAttempts=1. In this way, failover is used to choose the uri to connect to, but when it fails it lets the network connector know such that it can retry creating the bridge.\n\nTo determine if this is the problem, replace the use of network connector with failover (uri1, uri2) with two network connectors, one to uri1 and the other to uri2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-08T09:41:36.120+0000","updated":"2011-04-08T09:41:36.120+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483744/comment/13017587","id":"13017587","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scotte","name":"scotte","key":"scotte","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Emmons","active":true,"timeZone":"Etc/UTC"},"body":"Interesting, and very useful information, thank you!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scotte","name":"scotte","key":"scotte","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Emmons","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-08T18:25:03.748+0000","updated":"2011-04-08T18:25:03.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483744/comment/13019133","id":"13019133","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scotte","name":"scotte","key":"scotte","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Emmons","active":true,"timeZone":"Etc/UTC"},"body":"For what it's worth we carefully retested our failover scenarios after carefully checking configurations in 5.4.2 and can not reproduce the issue any longer. Our current configuration has two bridged AMQ networks. The configuration that seems to work for us is primary/backup with shared disk in each network. Our bridges use a static: connector with both uplink AMQ servers listed (note *not* failover: as that does not work properly). Since only the primary or the backup server is alive at any given time, this works. Our clients all use a failover: connector with ?updateURIsSupported=false to make sure they only talk to their proper network. We didn't do anything with maxReconnectAttempts...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scotte","name":"scotte","key":"scotte","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Emmons","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-13T00:25:11.301+0000","updated":"2011-04-13T00:25:11.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483744/comment/13138158","id":"13138158","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"The updates in AMQ-3542 identify the only supported use case where failover: and static: discovery work together.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-28T08:04:02.879+0000","updated":"2011-10-28T08:04:02.879+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2743/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0agzz:"}}