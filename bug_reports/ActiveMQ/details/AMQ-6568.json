{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13035846","self":"https://issues.apache.org/jira/rest/api/2/issue/13035846","key":"AMQ-6568","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-01-18T14:41:59.740+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Feb 27 11:39:25 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6568/watchers","watchCount":3,"isWatching":false},"created":"2017-01-18T10:36:22.621+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338329","id":"12338329","name":"5.14.2","archived":false,"released":true,"releaseDate":"2016-12-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-02-27T11:39:25.321+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We are working on a fairly large distributed project using ActiveMQ as our JMS backend. \nCurrently we are using Version 5.14.2. \n\nThe application consists of many containers communicating over AMQ.\nAll JMS communication endpoints are implemented with Camel 2.17.3. \n\nThe container itself is an OSGi container on top of Apache Felix, all implemented in Scala.\nThe production version is based on Scala 2.10 / JDK 7. The next version will be Scala 2.11 / JDK 8. \nWe are not using Karaf, but have our own bundles to implement container configuration \nand distribution.\n\nThe overall install base is roughly 2500 containers in as many local site connected to the \ncentral data center. The data center does not run AMQ, but a different JMS provider. All local \ncontainers use AMQ und bridge into the data center. \n\n\nOur problem is that we observe in ~1% of our containers that messages are not being delivered \nfrom AMQ. The Queue Size is > 0 and the consuming Camel Route is started, but no message \nis dispatched. Message producers can still produce messages, but none are dispatched. \n\nIn such a scenario no messages are dispatched to any consumers. Restating the route bundles \ndoes not have an effect, only restarting the containers rectifies the problem. \n\nOur investigation so far has not given any hints what might be special regarding the circumstances \nwhen we encounter the problem. We have taken thread dumps from containers in that state, but \nhave not been able to spot the problem. \n\n\nThe initial question is whether someone in the community could provide us a hint how we could \nnarrow down the problem. \n\nFor today I am attaching our AMQ configuration file and also one of latest thread dumps. \n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12848041","id":"12848041","filename":"broker.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-18T10:38:21.999+0000","size":6866,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12848041/broker.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12848044","id":"12848044","filename":"ThreadDump.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-18T10:44:13.132+0000","size":155589,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12848044/ThreadDump.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12848059","id":"12848059","filename":"UnDamaged_ThreadDump.txt.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-18T13:42:21.257+0000","size":10100,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12848059/UnDamaged_ThreadDump.txt.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Consumers stop consuming ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"CentOS 6.5, Java 7, 64-bit","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13035846/comment/15828066","id":"15828066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"body":"For comparison I am adding a thread dump of a container that is operating as expected. \n\nWe were unable to spot a (the) diffirence. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-18T13:42:21.263+0000","updated":"2017-01-18T13:42:21.263+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13035846/comment/15828185","id":"15828185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~andreasgies] hope all is well :-)\n\nOne thought is to check the memory limits - shared and per destination to ensure there is memory available to page in the messages if they are not in the cursor.\nAlso - possibly enable selective trace logging and check for differences in behaviour.\nUltimately a heap dump would be the way to see the state of the queue that is not dispatching to see where the messages are. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-18T14:41:59.740+0000","updated":"2017-01-18T14:41:59.740+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13035846/comment/15828205","id":"15828205","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary, \n\nthanks - everything is fine as usual. Guess whatt app we are doing ;) - I see you are still in AMQ land .... \n\nI will pass on the request for a heap dump as this to be taken from production and update the ticket a.s.a.p.\nI will dig into the memory limits - any suggestions what I should be tracing ? - Should I see something in the logs if the limits are insufficient ?\n\n\nThanks for the quick answer - I know I am doing something stupid here \nAndreas","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-18T14:48:32.932+0000","updated":"2017-01-18T14:48:32.932+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13035846/comment/15885623","id":"15885623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"body":"I have provided the heapdumps of two affected containers here:\n\nhttps://www.dropbox.com/sh/p7nnaz5qyqhabkn/AADFA2AqtBhsiQPhBuLzxDtSa?dl=0\n\nThe size of the heap dumps was just too big to attach to JIRA. I hope that way of sharing is ok. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreasgies","name":"andreasgies","key":"andreasgies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Gies","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-27T11:39:25.321+0000","updated":"2017-02-27T11:39:25.321+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6568/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i38vbj:"}}