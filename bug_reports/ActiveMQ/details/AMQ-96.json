{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481259","self":"https://issues.apache.org/jira/rest/api/2/issue/12481259","key":"AMQ-96","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315593","id":"12315593","name":"1.1","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2004-09-29T14:52:39.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 30 11:05:21 UTC 2004","customfield_12310420":"48835","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_90045000_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2004-09-30T15:24:54.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-96/watchers","watchCount":1,"isWatching":false},"created":"2004-09-29T14:24:09.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315593","id":"12315593","name":"1.1","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stewie","name":"stewie","key":"stewie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stewie","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2004-09-30T15:24:54.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When sockets are initialised in TcpTransportChannel their timeout is set to SO_TIMEOUT (5000 millis). In the read loop in run(), it seems like this timeout is supposed to be set to infinite once the connection is established. This is reasonable since clients can subscribe to an empty destination for days without any traffic and there's no ping in the protocol. The timeout will be changed if the changeTimeout flag is set but there is no code setting this flag anywhere. \n\nThis means that all connections idle more than 5 seconds will time out. This in combination with AMQ-95 will render all connections (even HA) unusable after as they will time out and never be reused. :)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161872","customfield_12312823":null,"summary":"TcpTransportChannels will always time out on receive after 5 seconds","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daggerrz","name":"daggerrz","key":"daggerrz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dag Liodden","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daggerrz","name":"daggerrz","key":"daggerrz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dag Liodden","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481259/comment/12937065","id":"12937065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"Fancy taking a stab at this? Maybe we need a ping protocol?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2004-09-29T14:52:39.000+0000","updated":"2004-09-29T14:52:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481259/comment/12937165","id":"12937165","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daggerrz","name":"daggerrz","key":"daggerrz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dag Liodden","active":true,"timeZone":"Etc/UTC"},"body":"Sure, I'll take a look. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daggerrz","name":"daggerrz","key":"daggerrz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dag Liodden","active":true,"timeZone":"Etc/UTC"},"created":"2004-09-30T10:06:47.000+0000","updated":"2004-09-30T10:06:47.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481259/comment/12937066","id":"12937066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stewie","name":"stewie","key":"stewie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stewie","active":true,"timeZone":"Etc/UTC"},"body":"The problem isn't the timeout per say - it's the fact the exception is dispatched to the BrokerClient which then assumes it's a genuine transport error - and closes ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stewie","name":"stewie","key":"stewie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stewie","active":true,"timeZone":"Etc/UTC"},"created":"2004-09-30T10:43:31.000+0000","updated":"2004-09-30T10:43:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481259/comment/12937193","id":"12937193","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daggerrz","name":"daggerrz","key":"daggerrz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dag Liodden","active":true,"timeZone":"Etc/UTC"},"body":"I realise that comment probably was for Stewie, but I have some thoughts on this matter too. :)\n\n1. Is a ping protocol necessary?\nI think so. If something in the receive thread breaks and leaves the socket open or if something goes wrong on one end of a NATted / port forwarded connection it won't be detected - at least not while there's no other activity. Pinging will proactively ensure that the application level is working.\n\n2. Which component's concern is pinging?\nThe concept of \"pinging\" is probably not a common concern for all transport channels (e.g mutlicast and jgroups?) and even if it seems logical to let ReliableTransportChannel take care of managing the keep-alive, I think it will be much easier to implement this on the TcpTransportChannel level. It will just be a matter of sending a ping packet the first time the socket read times out and fail if the second read also times out. \n\nReceiving a ping response packet over a WireFormat will require changes in the current WireFormat implementations and the Packet class as a new Packet type will be required. Perhaps adding a simple WIRE_SPECIFIC_PACKET type with unparsed binary content could future proof other link specific needs?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daggerrz","name":"daggerrz","key":"daggerrz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dag Liodden","active":true,"timeZone":"Etc/UTC"},"created":"2004-09-30T11:05:21.000+0000","updated":"2004-09-30T11:05:21.000+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-96/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s2fz:"}}