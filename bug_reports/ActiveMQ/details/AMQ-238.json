{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481068","self":"https://issues.apache.org/jira/rest/api/2/issue/12481068","key":"AMQ-238","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315601","id":"12315601","name":"3.1","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2005-07-07T17:33:16.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jul 07 17:33:16 UTC 2005","customfield_12310420":"48961","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_7386541000_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2005-07-07T17:33:16.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-238/watchers","watchCount":0,"isWatching":false},"created":"2005-04-13T05:44:15.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315600","id":"12315600","name":"3.0","archived":false,"released":true}],"issuelinks":[{"id":"12334940","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334940","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12481264","key":"AMQ-273","self":"https://issues.apache.org/jira/rest/api/2/issue/12481264","fields":{"summary":"Memory leak in wire format","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2005-07-11T09:57:13.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We are using a Requestor for JMS RPC using a temporary queue.\n\nWe have a small number of clients, but each client potentially makes thousands of requests, and each request creates its own temporary queue.\n\nWe were seeing memory growth in 2.1 related to connections, this seems to be fixed in 3.0.\n\nHowever, we now see memory growth in a different place.  YourKit shows 70% of the 240mb (currently) memory used, is in o.a.service.boundedvm.TransientQueueBoundedMessageManager.destinationMap (1 million objects), there are around 10,000 objects in TransientQueueBoundedMessageManager.destinations and TransientQueueBoundedMessageManager.containers.\n\nWe are opening and closing a connection for each Requestor, so the temporary queue, should be closing, and there is also a queue.delete() as in o.a.bean.Requestor.\n\nIf you want a YourKit snapshot, let me know, and I'll attach one.\n\nWe are looking at using a single topic with selectors as a workaround, but that complicates the logic, in order not to miss the response, before you start listening.  i.e. another thread is required.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"235796","customfield_12312823":null,"summary":"Broker Memory Leak","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows 2000 (YourKit Profiler enabled)\nJava 1.4.2_06","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481068/comment/12936934","id":"12936934","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"body":"As discussed with James on irc, we are going to try the Multithreaded Requestor from lingo.  It seems that creating an unbounded number of  connections and/or temporary queues, is something that activemq doesn't handle well, even when clients are closing resources properly.  This could be related to long lived servers, but my understanding of JMS is that temporary queues should by garbage collected when the connection is closed. \n\nIt might be good to deprecate o.a.bean.Requestor.  Its not great for performance, and also needlessly ties your app to ActiveMQ when  other alternatives are available.\n\nBut I'm OK with you guys closing this issue.  I can see we are being bad JMS citizens.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"created":"2005-04-18T01:06:38.000+0000","updated":"2005-04-18T01:06:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481068/comment/12937218","id":"12937218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"body":"Using the MultiplexingRequestor from lingo seems to have stabilised memory usage.  It hasn't gotten above 17MB yet (started at 14MB).\n\nPerformance seems better, but no concrete figures to back it up.  But it wouldn't be unexpected. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"created":"2005-04-19T01:24:42.000+0000","updated":"2005-04-19T01:24:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481068/comment/12936648","id":"12936648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"This is now fixed - we can handle many many producers being created & closed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2005-07-07T17:33:16.000+0000","updated":"2005-07-07T17:33:16.000+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-238/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i14qqf:"}}