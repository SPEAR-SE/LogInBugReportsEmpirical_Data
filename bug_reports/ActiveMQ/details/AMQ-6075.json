{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12919981","self":"https://issues.apache.org/jira/rest/api/2/issue/12919981","key":"AMQ-6075","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-01-07T17:08:44.679+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Feb 23 12:22:47 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6075/watchers","watchCount":9,"isWatching":false},"created":"2015-12-08T07:27:51.364+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12333269","id":"12333269","name":"5.12.1","archived":false,"released":true,"releaseDate":"2015-10-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-02-23T12:22:47.799+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319603","id":"12319603","name":"activemq-pool","description":"The ActiveMQ Connection Pool"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have a two node network brokers set up. it can work fine two or three days. Suddenly, every broker will try to create connection to each other, but because \nThere are already has connected to each other, so it will throw a “javax.jms.InvalidClientIDException”.The brokers will retry after 6 second, and the same exception will happened. \n\nactivemq.log\n\n1:02:54,925 | INFO  | Establishing network connection from vm://MQServer1?async=false to tcp://MQServer-2:61618 | org.apache.activemq.network.DiscoveryNetworkConnector | Notifier-MulticastDiscoveryAgent-listener:DiscoveryNetworkConnector:NC:BrokerService[MQServer1]\n1:02:55,097 | WARN  | Failed to add Connection MQServer1->MQServer2-123456-123456788990-123:1 due to javax.jms.InvalidClientIDException: Broker: MQServer1 - Client: NC_MQServer2_inbound_MQServer1 already connected from vm://MQServer1#2 | org.apache.activemq.broker.TransportConnection | triggerStartAsyncNetworkBridgeCreation: remoteBroker=tcp://MQServer-2/190.100.100.11:61618@56430, localBroker= vm://MQServer1#4\n1:02:55,097 | INFO  | Network connection between vm://MQServer1#4 and tcp://MQServer-2/190.100.100.11:61618@56430 shutdown due to a local error: javax.jms.InvalidClientIDException: Broker: MQServer1 - Client: NC_MQServer2_inbound_MQServer1 already connected from vm://MQServer1#2 | org.apache.activemq.network.DemandForwardingBridgeSupport | triggerStartAsyncNetworkBridgeCreation: remoteBroker=tcp://MQServer-2/190.100.100.11:61618@56430, localBroker= vm://MQServer1#4\n1:02:55,144 | INFO  | MQServer1 bridge to MQServer2 stopped | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ BrokerService[MQServer1] Task-2043\n\nwrapper.log\n\nINFO   | jvm 1    | 1:02:55 |  INFO | Establishing network connection from vm://MQServer1?async=false to tcp://MQServer-2:61618\nINFO   | jvm 1    | 1:02:55 |  WARN | Failed to add Connection MQServer1->MQServer2-123456-123456788990-123:1 due to javax.jms.InvalidClientIDException: Broker: MQServer1 - Client: NC_MQServer2_inbound_MQServer1 already connected from vm://MQServer1#2\nINFO   | jvm 1    | 1:02:55 |  INFO | Network connection between vm://MQServer1#4 and tcp://MQServer-2/190.100.100.11:61618@56430 shutdown due to a local error: javax.jms.InvalidClientIDException: Broker: MQServer1 - Client: NC_MQServer2_inbound_MQServer1 already connected from vm://MQServer1#2\nINFO   | jvm 1    | 1:02:55 |  INFO | MQServer1 bridge to MQServer2 stopped\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"javax.jms.InvalidClientIDException: Broker:… already connected","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qa","name":"qa","key":"qa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mq","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qa","name":"qa","key":"qa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mq","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"OS：Windows Server 2012","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12919981/comment/15087709","id":"15087709","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kudi","name":"kudi","key":"kudi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ehud Kleers","active":true,"timeZone":"Etc/UTC"},"body":"This exception is thrown from TransportConnection.java, from the function processAddConnection():\n\n///\n     try {\n            broker.addConnection(context, info);\n        } catch (Exception e) {\n//\n\nTo resolve it we can just check if the connection is already added to the broker before adding it again :)\n\nMore proper solution would be to fix the call to processAddConnection() and avoid calling if the connection already established.\n\n \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kudi","name":"kudi","key":"kudi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ehud Kleers","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-07T17:08:44.679+0000","updated":"2016-01-07T17:08:44.679+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12919981/comment/15088109","id":"15088109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kudi","name":"kudi","key":"kudi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ehud Kleers","active":true,"timeZone":"Etc/UTC"},"body":"This might work to resolve the problem but needs to be verified - \n\ntry {\n\n        \t//////\n        \tCopyOnWriteArrayList<TransportConnection> connList = connector.getConnections();\n        \tfor (TransportConnection transConn : connList) {\n        \t\t\n        \t\tString connId = transConn.getConnectionId();\n        \t\t\n        \t\tif (connId.equals(info.getConnectionId().toString())) {\n        \t\t\treturn null;\n        \t\t}\n        \t\t\n        \t}\n        \t/////\n            broker.addConnection(context, info);\n        } catch (Exception e) {\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kudi","name":"kudi","key":"kudi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ehud Kleers","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-07T21:05:30.568+0000","updated":"2016-01-07T21:05:30.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12919981/comment/16374284","id":"16374284","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=RajeshMalla","name":"RajeshMalla","key":"rajeshmalla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Malla","active":true,"timeZone":"Etc/UTC"},"body":"Can anybody suggest whether there is fix available for this InvalidClientIDException ? We are using activemq 5.12.3 version and facing same exception.\r\n\r\nCan we apply above solution provided by E[~kudi].\r\n\r\nThank you","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=RajeshMalla","name":"RajeshMalla","key":"rajeshmalla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Malla","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-23T12:22:47.799+0000","updated":"2018-02-23T12:22:47.799+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6075/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2pl0v:"}}