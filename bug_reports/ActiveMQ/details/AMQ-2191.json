{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483097","self":"https://issues.apache.org/jira/rest/api/2/issue/12483097","key":"AMQ-2191","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329848","id":"12329848","name":"5.13.0","archived":false,"released":true,"releaseDate":"2015-12-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-09-11T17:16:29.582+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 31 13:47:19 UTC 2018","customfield_12310420":"75033","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_14093851239_*|*_4_*:*_2_*:*_844182029_*|*_5_*:*_3_*:*_195095381990","customfield_12312321":null,"resolutiondate":"2015-11-27T12:55:53.565+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2191/watchers","watchCount":6,"isWatching":false},"created":"2009-04-01T14:18:58.388+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[{"id":"12450334","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12450334","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12527550","key":"AMQ-3547","self":"https://issues.apache.org/jira/rest/api/2/issue/12527550","fields":{"summary":"Calling Connection.close() on interrupted thread generates InterruptedIOException and leaks Connection","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-31T13:48:45.442+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have a process framework that sends interruptions to threads that should be stopped or paused. Some of these threads interact with ActiveMQ, so interruptions can occur inside ActiveMQ at different points.\nA problem occurs if the interruption is detected in ActiveMQConnection.syncSendPacket during commit or rollback of a transaction. ActiveMQ then throws a JMSException so that it appears to Bitronix as if the XA transaction is in an inconsistent state (see stacktrace in the attached file).\n\nIn our opinion, the interruption should be ignored by ActiveMQ during the critical commit or rollback phase. It is not mandatory that an interruption has an immediate effect. Especially such a non-interruptable step as rollback or commit should be performed even though an interruption occurs.\n\nI created a patch for the class TransactionContext which, in case of an interruption, resets the interruption state of the thread, retries the syncSendPacket method call and restores the thread's interruption state afterwards. In this manner, no inconsistent state exceptions occur in the transaction manager any longer and interruption is deferred until the commit/rollback has succeeded.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461465","id":"12461465","filename":"activemq_interruption_fix.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgottschalk","name":"mgottschalk","key":"mgottschalk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Gottschalk","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-01T14:21:02.719+0000","size":4725,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461465/activemq_interruption_fix.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461655","id":"12461655","filename":"ACTIVEMQ-PATCH","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfamm","name":"ralfamm","key":"ralfamm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ralf Menzel","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-10T17:07:29.771+0000","size":1012,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461655/ACTIVEMQ-PATCH"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461464","id":"12461464","filename":"xa-jms-exception.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgottschalk","name":"mgottschalk","key":"mgottschalk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Gottschalk","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-01T14:21:02.651+0000","size":9117,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461464/xa-jms-exception.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"159835","customfield_12312823":null,"summary":"Incorrect handling of interruptions during commit or rollback of a transaction","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgottschalk","name":"mgottschalk","key":"mgottschalk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Gottschalk","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgottschalk","name":"mgottschalk","key":"mgottschalk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Gottschalk","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Java 1.6.0_02\nKubuntu Linux  2.6.24-22\nBitronix Transaction Manager 1.3.2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/12941102","id":"12941102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgottschalk","name":"mgottschalk","key":"mgottschalk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Gottschalk","active":true,"timeZone":"Etc/UTC"},"body":"Added attachments: the exception that occurs in case of interruption during commit/rollback and the patch that fixes the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgottschalk","name":"mgottschalk","key":"mgottschalk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Gottschalk","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-01T14:21:02.722+0000","updated":"2009-04-01T14:21:02.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/12941571","id":"12941571","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed by SVN revision 813927","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-11T17:16:29.582+0000","updated":"2009-09-11T17:16:29.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/12942322","id":"12942322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfamm","name":"ralfamm","key":"ralfamm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ralf Menzel","active":true,"timeZone":"Europe/Berlin"},"body":"We use ActiveMQ in a similar scenario as pictured above. (Our transaction manager is Atomikos TransactionEssentials, but that is probably unimportant.) One major difference in our use case is that we use an embedded broker and thus the VM transport.\n\nWhen the oneway method of the class VMTransport is interrupted it doesn't throw an InterruptedIOException but just an IOException.\nTherefore the interrupt handling code in TransactionContext.syncSendPacketWithInterruptionHandling isn't used when the VM transport is used.\n\nI have a small patch that has VMTransport throw an InterruptedIOException when it is interrupted. Tests show that this patch seems to help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfamm","name":"ralfamm","key":"ralfamm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ralf Menzel","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-10T17:05:25.916+0000","updated":"2010-03-10T17:05:25.916+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/12942321","id":"12942321","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfamm","name":"ralfamm","key":"ralfamm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ralf Menzel","active":true,"timeZone":"Europe/Berlin"},"body":"This patch seems to fix the problem for me when using the VM transport.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfamm","name":"ralfamm","key":"ralfamm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ralf Menzel","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-10T17:07:29.775+0000","updated":"2010-03-10T17:07:29.775+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/12942332","id":"12942332","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed on 5.4 by revision 921822 and on 5.3.1 vy SVN revision 921844","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-11T13:36:55.974+0000","updated":"2010-03-11T13:36:55.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/15011129","id":"15011129","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I have come across a similar issue, different TM but that is incidental.\nIn my case, it is an ack as part of commit that sees the first interrupt. This causes a beforecompletion error. However on the rollback, the ack is done/gone and the broker side acks are missing so even after the client side rollback, the messages remain inflight to the consumer. \nFrom what I can see, it is not safe to assume a retry of a commit/rollback op is sufficient.\nI think that an InterruptedIOException in the XA case should be reported to the exception listener and allow the connection to close, forcing a rollback broker side and forcing a rollback client side also.\n{code}\n2015-08-19 10:17:03,827 WARN [com.arjuna.ats.arjuna] (Transaction Reaper) ARJUNA012117: TransactionReaper::check timeout for TX 0:ffff650182a8:58549259:55d38674:22df0 in state RUN\n2015-08-19 10:17:04,065 WARN [com.arjuna.ats.arjuna] (Transaction Reaper) ARJUNA012117: TransactionReaper::check timeout for TX 0:ffff650182a8:58549259:55d38674:22dec in state CANCEL\n2015-08-19 10:17:04,328 WARN [com.arjuna.ats.arjuna] (Transaction Reaper) ARJUNA012117: TransactionReaper::check timeout for TX 0:ffff650182a8:58549259:55d38674:22df0 in state SCHEDULE_CANCEL\n2015-08-19 10:17:04,488 WARN [com.arjuna.ats.jta] (Transaction Reaper Worker 0) ARJUNA016045: attempted rollback of < formatId=131077, gtrid_length=29, bqual_length=36, tx_uid=0:ffff650182a8:58549259:55d38674:22dec, node_name=1, branch_uid=0:ffff650182a8:58549259:55d38674:22ded, subordinatenodename=null, eis_name=unknown eis name > (org.apache.activemq.ra.LocalAndXATransaction@3de1f429) failed with exception code XAException.XAER_RMFAIL: javax.transaction.xa.XAException: java.io.InterruptedIOException\nat org.apache.activemq.TransactionContext.toXAException(TransactionContext.java:805)\nat org.apache.activemq.TransactionContext.rollback(TransactionContext.java:532)\nat org.apache.activemq.ra.LocalAndXATransaction.rollback(LocalAndXATransaction.java:141)\nat com.arjuna.ats.internal.jta.resources.arjunacore.XAResourceRecord.topLevelAbort(XAResourceRecord.java:358) [jbossjts-jacorb-4.17.7.Final-redhat-4-bz-1023562.jar:4.17.7.Final-redhat-1]\nat com.arjuna.ats.arjuna.coordinator.BasicAction.doAbort(BasicAction.java:2853) [jbossjts-jacorb-4.17.7.Final-redhat-4-bz-1023562.jar:4.17.7.Final-redhat-1]\nat com.arjuna.ats.arjuna.coordinator.BasicAction.doAbort(BasicAction.java:2832) [jbossjts-jacorb-4.17.7.Final-redhat-4-bz-1023562.jar:4.17.7.Final-redhat-1]\nat com.arjuna.ats.arjuna.coordinator.BasicAction.Abort(BasicAction.java:1625) [jbossjts-jacorb-4.17.7.Final-redhat-4-bz-1023562.jar:4.17.7.Final-redhat-1]\nat com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.cancel(TwoPhaseCoordinator.java:118) [jbossjts-jacorb-4.17.7.Final-redhat-4-bz-1023562.jar:4.17.7.Final-redhat-1]\nat com.arjuna.ats.arjuna.AtomicAction.cancel(AtomicAction.java:215) [jbossjts-jacorb-4.17.7.Final-redhat-4-bz-1023562.jar:4.17.7.Final-redhat-1]\nat com.arjuna.ats.arjuna.coordinator.TransactionReaper.doCancellations(TransactionReaper.java:370) [jbossjts-jacorb-4.17.7.Final-redhat-4-bz-1023562.jar:4.17.7.Final-redhat-1]\nat com.arjuna.ats.internal.arjuna.coordinator.ReaperWorkerThread.run(ReaperWorkerThread.java:78) [jbossjts-jacorb-4.17.7.Final-redhat-4-bz-1023562.jar:4.17.7.Final-redhat-1]\nCaused by: javax.jms.JMSException: java.io.InterruptedIOException\nat org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:72)\nat org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1323)\nat org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1315)\nat org.apache.activemq.ActiveMQSession.asyncSendPacket(ActiveMQSession.java:1972)\nat org.apache.activemq.ActiveMQSession$5.afterRollback(ActiveMQSession.java:948)\nat org.apache.activemq.TransactionContext.afterRollback(TransactionContext.java:161)\nat org.apache.activemq.TransactionContext.rollback(TransactionContext.java:527)\n... 9 more\nCaused by: java.io.InterruptedIOException\nat org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:102)\nat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)\nat org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\nat org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1321)\n... 14 more\n2015-08-19 10:17:04,493 WARN [com.arjuna.ats.arjuna] (Transaction Reaper Worker 0) ARJUNA012091: Top-level abort of action 0:ffff650182a8:58549259:55d38674:22dec received TwoPhaseOutcome.FINISH_ERROR from com.arjuna.ats.internal.jta.resources.arjunacore.XAResourceRecord\n2015-08-19 10:17:15,361 WARN [com.arjuna.ats.arjuna] (default-threads - 46) ARJUNA012077: Abort called on already aborted atomic action 0:ffff650182a8:58549259:55d38674:22dec{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-18T14:57:41.674+0000","updated":"2015-11-18T14:57:41.674+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/15029828","id":"15029828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 0a12bcb928f151b5ace9a0cffc34ec717b6a8e9c in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=0a12bcb ]\n\nhttps://issues.apache.org/jira/browse/AMQ-2191 https://issues.apache.org/jira/browse/AMQ-3529 - rework fixes to remove uncertanty from dealing with intettuptedexception. Sync requests will trap interrupts that ocurr while waiting for responses and fail the connection with an interruptedioexception. Interrupts pending before requests will be suppressed, allowing possible clean shutdown. It is not safe to replay openwire ops b/c they are not idempotent, the only safe option is to have a teardown of the broker side state from a close\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-27T12:36:04.267+0000","updated":"2015-11-27T12:36:04.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/15029848","id":"15029848","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"rework of this issue to make interruption of an inprogress request an error and allowing pending interrupts to be ignored for subsequent requests avoids the need to wrap close at a higher level. AMQ-3547","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-27T12:52:31.560+0000","updated":"2015-11-27T12:52:31.560+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/15029851","id":"15029851","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"removed the uncertainty around dealing with interruption.\n\nIn essence, interrupting a pending request will be fatal to the connection, like any IOException. Interrupts are suspended and resumed for subsequent requests till the connection is closed.\n\nThis is the case b/c it is not safe to replay operations and it is not possible to know if the request got to the broker.\nThe typical use case for interrupt is to terminate gracefully but this can only be done safely with a close.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-27T12:55:53.592+0000","updated":"2015-11-27T12:55:53.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483097/comment/16563692","id":"16563692","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=diptesh2007","name":"diptesh2007","key":"diptesh2007","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Diptesh Chakraborty","active":true,"timeZone":"Etc/UTC"},"body":"I am still getting this exception with 5.13 on the following scenario:\r\n\r\n1) We have a producer template which writes messages to queue without using transaction.\r\n\r\n2) When the queue depth reaches around 75000, we are getting the same exception which is mentioned below. \r\n\r\n3) When @Transaction is applied on the producerTemplate.send() , everything works fine.\r\n\r\n \r\n Exception in thread \"Thread-10\" org.apache.camel.CamelExecutionException: Exception occurred during execution on the exchange: Exchange[ID-*****][Message: CB occured during JMS processing; nested exception is javax.jms.JMSException: java.io.InterruptedIOException\r\n at org.springframework.jms.support.JmsUtils.convertJmsAccessException(JmsUtils.java:316)\r\n at org.springframework.jms.support.JmsAccessor.convertJmsAccessException(JmsAccessor.java:169)\r\n at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:497)\r\n at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.send(JmsConfiguration.java:245)\r\n at org.apache.camel.component.jms.JmsProducer.doSend(JmsProducer.java:413)\r\n at org.apache.camel.component.jms.JmsProducer.processInOnly(JmsProducer.java:367)\r\n at org.apache.camel.component.jms.JmsProducer.process(JmsProducer.java:153)\r\n at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:190)\r\n at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:109)\r\n at org.apache.camel.processor.UnitOfWorkProducer.process(UnitOfWorkProducer.java:68)\r\n at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:412)\r\n at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:380)\r\n at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:270)\r\n at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:380)\r\n at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:221)\r\n at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:124)\r\n at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeaders(DefaultProducerTemplate.java:233)\r\n ... 2 more\r\n Caused by: javax.jms.JMSException: java.io.InterruptedIOException\r\n at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:62)\r\n at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1292)\r\n at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1284)\r\n at org.apache.activemq.TransactionContext.begin(TransactionContext.java:237)\r\n at org.apache.activemq.ActiveMQSession.doStartTransaction(ActiveMQSession.java:1809)\r\n at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1735)\r\n at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:277)\r\n at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:212)\r\n at org.apache.activemq.pool.PooledProducer.send(PooledProducer.java:79)\r\n at org.apache.activemq.pool.PooledProducer.send(PooledProducer.java:62)\r\n at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:636)\r\n at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.doSend(JmsConfiguration.java:353)\r\n at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.doSendToDestination(JmsConfiguration.java:292)\r\n at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.access$100(JmsConfiguration.java:234)\r\n at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate$1.doInJms(JmsConfiguration.java:248)\r\n at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:494)\r\n ... 16 more\r\n Caused by: java.io.InterruptedIOException\r\n at org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:102)\r\n at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)\r\n at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\r\n at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1290)\r\n  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=diptesh2007","name":"diptesh2007","key":"diptesh2007","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Diptesh Chakraborty","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-31T13:47:19.584+0000","updated":"2018-07-31T13:48:45.430+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2191/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rpvb:"}}