{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12655167","self":"https://issues.apache.org/jira/rest/api/2/issue/12655167","key":"AMQ-4608","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2013-07-08T19:57:18.285+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 10 20:41:40 UTC 2013","customfield_12310420":"335444","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1141634833_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-07-10T20:41:40.300+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4608/watchers","watchCount":2,"isWatching":false},"created":"2013-06-27T15:34:25.482+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-10T20:41:40.314+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Hello,\n\nplease consider this store and forward network of broker scenario:\n\n-------- activemq.xml snippet ----------\n\nIf you're using a multicast discovery in your network of broker you may have a scenario like this one:\n\n\n<!-- Transport protocol -->\n\t<transportConnectors>\n\t\t<transportConnector name=\"openwire\" uri=\"nio://host:port?useQueueForAccept=false\" discoveryUri=\"multicast://default\" />\t\t\t\n\t</transportConnectors>\n\n\t<!-- Broker network connectors -->\t\n\t<networkConnectors>\n\t\t<networkConnector name=\"bridgeConnector\" uri=\"multicast://default\" \t\t\n\t\t\tdecreaseNetworkConsumerPriority=\"true\" \n\t\t\tuserName=\"system\" password=\"manager\" \n\t\t\tsuppressDuplicateTopicSubscriptions=\"true\" suppressDuplicateQueueSubscriptions=\"true\">\t\t\t\t\n\t\t\t<excludedDestinations>\n\t\t\t\t<queue physicalName=\">\"/>\n\t\t\t</excludedDestinations>\n\t\t</networkConnector>\n\t</networkConnectors>\n\n--------------------------------------\n\nWhen adding network connectors using multicast discovery, ActiveMQ is actually checking if you're not connecting to the local broker itself (in order to avoid loops).\nThis is implemented in the BrokerService class\n\n------------------- BrokerService.java extract ---------------------\n connector.setLocalUri(uri);\n        // Set a connection filter so that the connector does not establish loop\n        // back connections.\n        connector.setConnectionFilter(new ConnectionFilter() {\n            public boolean connectTo(URI location) {\n                List<TransportConnector> transportConnectors = getTransportConnectors();\n                for (Iterator<TransportConnector> iter = transportConnectors.iterator(); iter.hasNext();) {\n                    try {\n                        TransportConnector tc = iter.next();\n                        if (location.equals(tc.getConnectUri())) {   \n                            return false;\n                        }\n                    } catch (Throwable e) {\n                    }\n                }\n                return true;\n            }\n        });\n        networkConnectors.add(connector);\n\n-------------------------------------------------------------\n\nNow, if the connector uri (tc.getConnectUri()) contains parameters as showed above (?useQueueForAccept=true) you will have a comparison between the URI without parameter coming from the multicast discovery and the one with parameter coming from the connector configuration.\n\nFollowing the configuration example below you will compare \"nio://host:port\" with \"nio://host:port?useQueueForAccept=false\".\n\nThis obviously won't work and you will open a network connection with the broker itself, resulting having duplicate messages.\n\nOne idea to fix the bug is to compare URIs without parameters.\n\nCould you please take this bug into account and propose a fix?\n\nThanks in advance\n\nAndrea","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12590009","id":"12590009","filename":"patch.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrea.marziali","name":"andrea.marziali","key":"andrea.marziali","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrea Marziali","active":true,"timeZone":"Europe/Berlin"},"created":"2013-06-28T08:51:01.349+0000","size":981,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12590009/patch.diff"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"335768","customfield_12312823":null,"summary":"Network discovery creates looping connections to local broker","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrea.marziali","name":"andrea.marziali","key":"andrea.marziali","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrea Marziali","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrea.marziali","name":"andrea.marziali","key":"andrea.marziali","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrea Marziali","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12655167/comment/13695320","id":"13695320","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrea.marziali","name":"andrea.marziali","key":"andrea.marziali","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrea Marziali","active":true,"timeZone":"Europe/Berlin"},"body":"Diff against AMQ trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrea.marziali","name":"andrea.marziali","key":"andrea.marziali","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrea Marziali","active":true,"timeZone":"Europe/Berlin"},"created":"2013-06-28T08:51:01.351+0000","updated":"2013-06-28T08:51:01.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12655167/comment/13702347","id":"13702347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Have you tested a recent SNAPSHOT build, this appears to be a duplicate of AMQ-4408.  If you still have an issue please attach a unit test to reproduce.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-07-08T19:57:18.285+0000","updated":"2013-07-08T19:57:18.285+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12655167/comment/13705041","id":"13705041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Using the provided configuration info I could not reproduce this problem the loop is detected and stopped. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-07-10T20:41:40.312+0000","updated":"2013-07-10T20:41:40.312+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4608/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1lv1z:"}}