{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12504957","self":"https://issues.apache.org/jira/rest/api/2/issue/12504957","key":"AMQ-3290","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2011-06-29T18:51:23.529+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Nov 02 07:09:42 UTC 2011","customfield_12310420":"49782","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_7648720199_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-19T21:01:39.848+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3290/watchers","watchCount":1,"isWatching":false},"created":"2011-04-22T08:22:59.678+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":["connection","did","failed","format","negotiation","not","peer","send","timeout","wire"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":86400,"aggregatetimeoriginalestimate":86400,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-11-02T07:09:43.002+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":86400,"customfield_12310080":null,"description":"I have two client application written on Java. Each of them has consumers to ActiveMQ (maven dependancy 'activemq-core' version 5.3.2).\nAlso there are three applications written on C# (two windows services and one ASP.NET application) which use Apache.NMS 1.5 to connect to ActiveMQ server.\n\nDuring some time everything's fine (e.g. today this period has been about 4 hours). But since some moment .NET started throw the following exception:\n\nWire format negotiation timeout: peer did not send his wire format.\nApache.NMS.ActiveMQ.IOException: Wire format negotiation timeout: peer did not send his wire format.\n   at Apache.NMS.ActiveMQ.Connection.SyncRequest(Command command) in c:\\dev\\NMS.ActiveMQ\\src\\main\\csharp\\Connection.cs:line 628\n   at Apache.NMS.ActiveMQ.Connection.CheckConnected() in c:\\dev\\NMS.ActiveMQ\\src\\main\\csharp\\Connection.cs:line 712\n   at Apache.NMS.ActiveMQ.Connection.CreateAtiveMQSession(AcknowledgementMode ackMode) in c:\\dev\\NMS.ActiveMQ\\src\\main\\csharp\\Connection.cs:line 467\n   at Apache.NMS.ActiveMQ.Connection.CreateSession() in c:\\dev\\NMS.ActiveMQ\\src\\main\\csharp\\Connection.cs:line 454\n\nActually Java consumers also don't work though there are no errors in their part. But I can see via ActiveMQ web console that no one Query has consumers (for each Query column 'Number Of Consumers' value equals 0).\nSo actually nothing works (not Java, not C#) since some moment. I can see the error in .NET but can't see in Java.\n\nAlso this problem appears after restarting operation system. Not always but it happens occasionally.\n\nPS For Java application I use org.apache.activemq.ActiveMQConnectionFactory and Mule ESB jms:activemq-connector. And this part doesn't show error when it happens.\nFor C# applications I use Apache.NMS.ActiveMQ.ConnectionFactory and every time when I think we can face to problem I'm trying to get new connection with the following code lines:\n\nif ((connection == null) || !connection.IsStarted)\n{\n\tconnection = factory.CreateConnection();\n\tISession session = connection.CreateSession();\n\tIDestination dest = session.GetDestination(Queue);\n\tproducer = session.CreateProducer(dest);\n}\n\nbut unfortunately it doesn't help.","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12477250","id":"12477250","filename":"hs_err_pid24632.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=csbubbles","name":"csbubbles","key":"csbubbles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=csbubbles&avatarId=19456","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=csbubbles&avatarId=19456","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=csbubbles&avatarId=19456","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=csbubbles&avatarId=19456"},"displayName":"Maxim Novikov","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-04-24T18:29:49.061+0000","size":334421,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12477250/hs_err_pid24632.log"}],"aggregatetimeestimate":86400,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172292","customfield_12312823":null,"summary":"Wire format negotiation timeout: peer did not send his wire format","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=csbubbles","name":"csbubbles","key":"csbubbles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=csbubbles&avatarId=19456","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=csbubbles&avatarId=19456","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=csbubbles&avatarId=19456","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=csbubbles&avatarId=19456"},"displayName":"Maxim Novikov","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=csbubbles","name":"csbubbles","key":"csbubbles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=csbubbles&avatarId=19456","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=csbubbles&avatarId=19456","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=csbubbles&avatarId=19456","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=csbubbles&avatarId=19456"},"displayName":"Maxim Novikov","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":86400,"percent":0},"customfield_12311024":null,"environment":"MS Windows 7 Home Premium x64 Intel Core i5 M 460 RAM 6GB","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":86400,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504957/comment/13024659","id":"13024659","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=csbubbles","name":"csbubbles","key":"csbubbles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=csbubbles&avatarId=19456","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=csbubbles&avatarId=19456","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=csbubbles&avatarId=19456","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=csbubbles&avatarId=19456"},"displayName":"Maxim Novikov","active":true,"timeZone":"America/Los_Angeles"},"body":"JVM crash log.\n\nActiveMQ creates more than 2000 (!!!) threads!..\nIt happens when producer (one (?) producer) sends about 60 messages per seconds. And it took about 5 seconds to kill ActiveMQ.\nIt would appear that on each new incoming message ActiveMQ creates new thread and they continue to live forever.\nLooks like great leaks take place (?)...\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=csbubbles","name":"csbubbles","key":"csbubbles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=csbubbles&avatarId=19456","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=csbubbles&avatarId=19456","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=csbubbles&avatarId=19456","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=csbubbles&avatarId=19456"},"displayName":"Maxim Novikov","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-04-24T18:29:49.116+0000","updated":"2011-04-24T20:04:27.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504957/comment/13024660","id":"13024660","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=csbubbles","name":"csbubbles","key":"csbubbles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=csbubbles&avatarId=19456","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=csbubbles&avatarId=19456","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=csbubbles&avatarId=19456","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=csbubbles&avatarId=19456"},"displayName":"Maxim Novikov","active":true,"timeZone":"America/Los_Angeles"},"body":"JVM crashed today, so I added its log file (hs_err_pid24632.log).\n\nAnd quite often before problems occur I can see in wrapper.log the following error:\n\nINFO   | jvm 1    | 2011/04/24 22:24:18 | Exception in thread \"ActiveMQ Transport Server Thread Handler: tcp://0.0.0.0:61616\" java.lang.OutOfMemoryError: unable to create new native thread\nINFO   | jvm 1    | 2011/04/24 22:24:18 | \tat java.lang.Thread.start0(Native Method)\nINFO   | jvm 1    | 2011/04/24 22:24:18 | \tat java.lang.Thread.start(Unknown Source)\nINFO   | jvm 1    | 2011/04/24 22:24:18 | \tat org.apache.activemq.thread.TaskRunnerFactory.execute(TaskRunnerFactory.java:92)\nINFO   | jvm 1    | 2011/04/24 22:24:18 | \tat org.apache.activemq.thread.TaskRunnerFactory.execute(TaskRunnerFactory.java:85)\nINFO   | jvm 1    | 2011/04/24 22:24:18 | \tat org.apache.activemq.broker.TransportConnector$1.onAccept(TransportConnector.java:209)\nINFO   | jvm 1    | 2011/04/24 22:24:18 | \tat org.apache.activemq.transport.tcp.TcpTransportServer.handleSocket(TcpTransportServer.java:428)\nINFO   | jvm 1    | 2011/04/24 22:24:18 | \tat org.apache.activemq.transport.tcp.TcpTransportServer$1.run(TcpTransportServer.java:354)\nINFO   | jvm 1    | 2011/04/24 22:24:18 | \tat java.lang.Thread.run(Unknown Source)\n\nI run ActiveMQ as service. \n\nConfiguration of memory usage:\n\n        <systemUsage>\n            <systemUsage>\n                <memoryUsage>\n                    <memoryUsage limit=\"500 mb\"/>\n                </memoryUsage>\n                <storeUsage>\n                    <storeUsage limit=\"5 gb\"/>\n                </storeUsage>\n                <tempUsage>\n                    <tempUsage limit=\"1 gb\"/>\n                </tempUsage>\n            </systemUsage>\n        </systemUsage>\n\n'memoryLimit' parameter for consumers and producers doesn't affect anything.\n\nMaximum Java Heap size of Tanuki wrapper - wrapper.java.maxmemory=1024.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=csbubbles","name":"csbubbles","key":"csbubbles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=csbubbles&avatarId=19456","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=csbubbles&avatarId=19456","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=csbubbles&avatarId=19456","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=csbubbles&avatarId=19456"},"displayName":"Maxim Novikov","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-04-24T18:35:42.124+0000","updated":"2011-04-24T19:22:03.103+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504957/comment/13057397","id":"13057397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You should attempt to create a test case to demonstrate the issue.  Problems like this usually appear when the number of connections to the broker exceeds the number of open file descriptors that the OS allows.  It would be helpful to see what your code is doing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-06-29T18:51:23.529+0000","updated":"2011-06-29T18:51:23.529+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504957/comment/13067964","id":"13067964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"From the logs it appears that the client is opening a connection for each send and eventually the broker exhausts all available heap space and cannot allocate more resources which is what would be expected in this scenario.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-07-19T21:01:39.867+0000","updated":"2011-07-19T21:01:39.867+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504957/comment/13122244","id":"13122244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rws_urbancode","name":"rws_urbancode","key":"rws_urbancode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Smith","active":true,"timeZone":"Etc/UTC"},"body":"\"java.lang.OutOfMemoryError: unable to create new native thread\" does not occur from a lack of heap. It occurs from not enough memory left when you take all of the server's RAM and subtract the heap. The system is probably 32-bit as well. I have never seen the error on 64-bit. The error indicates you have too many threads and no more can be created. This error will kill the thread that pulls new sockets off the queue and will prevent any new connections from working. You will eventually get a true heap memory error if client continue to connect as the unbounded socket queue will pile up. Either the process needs to be restarted or you may be able to restart the broker using a TransportAcceptListener that is notified by onAcceptError.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rws_urbancode","name":"rws_urbancode","key":"rws_urbancode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Smith","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-06T20:21:16.016+0000","updated":"2011-10-06T20:21:16.016+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504957/comment/13141975","id":"13141975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hick+hayes","name":"hick hayes","key":"hick hayes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hick+hayes&avatarId=12430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hick+hayes&avatarId=12430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hick+hayes&avatarId=12430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hick+hayes&avatarId=12430"},"displayName":"Michael Hayes","active":true,"timeZone":"Etc/UTC"},"body":"JVM memory, not server RAM.\nHeap + Non-Heap + Native is less than 2^^32 with e.g. hotspot 32-bit jvm. \n-Xss controls the Stack Space (this is Native space) per new thread.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hick+hayes","name":"hick hayes","key":"hick hayes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hick+hayes&avatarId=12430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hick+hayes&avatarId=12430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hick+hayes&avatarId=12430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hick+hayes&avatarId=12430"},"displayName":"Michael Hayes","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-02T07:09:42.944+0000","updated":"2011-11-02T07:09:42.944+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3290/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0turb:"}}