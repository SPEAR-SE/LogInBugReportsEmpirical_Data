{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12770519","self":"https://issues.apache.org/jira/rest/api/2/issue/12770519","key":"AMQ-5543","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2015-02-05T20:00:14.289+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jul 30 17:03:50 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_47480715635_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-07-30T12:20:42.708+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5543/watchers","watchCount":8,"isWatching":false},"created":"2015-01-27T23:15:27.749+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[{"id":"12476458","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12476458","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12724276","key":"AMQ-5251","self":"https://issues.apache.org/jira/rest/api/2/issue/12724276","fields":{"summary":"Scheduler missing some synchronization","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-07-30T17:03:50.834+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"One of our brokers running 5.10.0 spewed over 1 million of the following exceptions to the log over a 2-hour period:\n\nTransport Connection to: tcp://127.0.0.1:xxxxx failed: java.io.IOException: Unexpected error occurred: java.lang.IllegalStateException: Timer already cancelled.\n\nClients were observed to hang on startup (which we believe means they were unable to connect to the broker) until it was rebooted, after which we haven't seen the exception again.\n\nOnce the exceptions started, there were no stack traces or other log lines that would indicate anything else about the cause, just those messages repeating.  The problems started immediately (a few milliseconds) after an EOFException in the broker logs; we see those EOFExceptions pretty often and they've never before resulted in \"Timer already cancelled\" exceptions, so that might indicate what got us into a bad state but then again it might be entirely unrelated.\n\nI searched JIRA and the mailing list archives for similar issues, and although there are a lot of incidences of \"Timer already cancelled\" exceptions, none of them exactly match our situation.\n* http://activemq.2283324.n4.nabble.com/Producer-connections-keep-breaking-td4671152.html describes repeated copies of the line in the logs and is the closest parallel I've found, but it sounded like messages were still getting passed, albeit more slowly than normal, whereas the developer on my team who hit this said he didn't think any messages were getting sent.  But it's the closest match of the group.\n* AMQ-5508 has a detailed investigation into the root cause of the problem that Pero Atanasov saw, but his scenario occurred only on broker shutdown, whereas our broker was not shutting down at the time, and it wasn't clear that the log line repeated for him.\n* http://activemq.2283324.n4.nabble.com/Timer-already-cancelled-and-KahaDB-Recovering-checkpoint-thread-after-death-td4676684.html has repeated messages like I'm seeing, but appears to be specific to KahaDB which I'm not using (we use non-persistent messages only).\n* AMQ-4805 has the same inner exception but not the full log line, and it shows a full stack trace whereas I only see the one line without the stack trace.\n* http://activemq.2283324.n4.nabble.com/can-t-send-message-Timer-already-cancelled-td4680175.html appears to see the exception on the producer when sending rather than on the broker.\n\nThe only thing that we observed that might be related was that earlier in the broker's uptime, the developer who was running it ran up against his maxProc limit and wasn't able to create new native threads.  That didn't result in any issues in the broker logs at the time (we only hit these issues several hours later), so I'm skeptical that it's related given that there are lots of other things that cause \"Timer already cancelled\" exceptions as evidenced by the partial list above, but it could be.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Broker logs show repeated \"java.lang.IllegalStâ€‹ateException: Timer already cancelled.\" lines","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tbain98","name":"tbain98","key":"tbain98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim Bain","active":true,"timeZone":"America/Denver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tbain98","name":"tbain98","key":"tbain98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim Bain","active":true,"timeZone":"America/Denver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/14307880","id":"14307880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jchristner","name":"jchristner","key":"jchristner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jay Christner","active":true,"timeZone":"America/Chicago"},"body":"Commenting that we just saw the same thing with 5.10.0 and was indeed driven by hitting the max process limit and the inability to create new native threads.   It manifested as an OutOfMemory error (which was confusing during our troubleshooting process) and then was followed up by the behavior you describe of extremely high volume of the \"Timer already cancelled\" errors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jchristner","name":"jchristner","key":"jchristner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jay Christner","active":true,"timeZone":"America/Chicago"},"created":"2015-02-05T20:00:14.289+0000","updated":"2015-02-05T20:00:14.289+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/14335690","id":"14335690","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tbain98","name":"tbain98","key":"tbain98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim Bain","active":true,"timeZone":"America/Denver"},"body":"[~jchristner], thanks for confirming the sequence of events that led to the issue.  \n\nI think the broker should be more resilient in the face of running out of threads (which is usually a transient problem that will eventually clear itself up), but I think the priority for making that happen is probably pretty low, so I don't expect this to be implemented anytime soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tbain98","name":"tbain98","key":"tbain98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim Bain","active":true,"timeZone":"America/Denver"},"created":"2015-02-24T23:56:33.491+0000","updated":"2015-02-24T23:56:33.491+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/14554314","id":"14554314","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"body":"Just faced same problem on 5.11.1.\n\nLogs are full of:\nXXXX-XX-XX XX:XX:32,416 | WARN  | Transport Connection to: tcp://127.0.0.1:49807 failed: java.io.IOException: Timer already cancelled. | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ NIO Worker 92939\n\nBefore it happened we've seen in logs:\n\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:21 |  WARN | Transport Connection to: tcp://XXXXXXXXXXXX:35328 failed: java.io.IOException: unable to create new native thread\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:24 | Exception in thread \"ActiveMQ InactivityMonitor WriteCheckTimer\" java.lang.OutOfMemoryError: unable to create new native thread\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:24 |       at java.lang.Thread.start0(Native Method)\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:24 |       at java.lang.Thread.start(Thread.java:714)\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:24 |       at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:949)\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:24 |       at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1371)\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:25 |       at org.apache.activemq.transport.AbstractInactivityMonitor.writeCheck(AbstractInactivityMonitor.java:158)\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:25 |       at org.apache.activemq.transport.AbstractInactivityMonitor$2.run(AbstractInactivityMonitor.java:122)\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:25 |       at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:25 |       at java.util.TimerThread.mainLoop(Timer.java:555)\n        INFO   | jvm 1    | XXXXXXXXXXXXXXX:25 |       at java.util.TimerThread.run(Timer.java:505)\n\nThen only \"Timer already cancelled\".\n\nAnyway it is quite strange we run out of native threads as we have set: org.apache.activemq.UseDedicatedTaskRunner=false which I believe should optimise the number of threads.\n\nWe are using about 300-700 parallel connections.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"created":"2015-05-21T14:05:15.166+0000","updated":"2015-05-21T14:10:46.231+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/14554326","id":"14554326","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tbain98","name":"tbain98","key":"tbain98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim Bain","active":true,"timeZone":"America/Denver"},"body":"[~nannou9] What's your current thread limit?  Even with org.apache.activemq.UseDedicatedTaskRunner=false, you're still going to use one thread per connection, so if your OS has the default value of 1024 set, I'm not at all surprised that you're hitting this even with org.apache.activemq.UseDedicatedTaskRunner=false.  Increase the max thread count for the user and you should be fine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tbain98","name":"tbain98","key":"tbain98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim Bain","active":true,"timeZone":"America/Denver"},"created":"2015-05-21T14:13:58.874+0000","updated":"2015-05-21T14:13:58.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/14554349","id":"14554349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"body":"Indeed, good spot. VM/OS was not preconfigured with that property.\n\nThanks Tim!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"created":"2015-05-21T14:31:37.665+0000","updated":"2015-05-21T14:31:37.665+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/14580607","id":"14580607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=volkerk","name":"volkerk","key":"volkerk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Volker Kleinschmidt","active":true,"timeZone":"America/Chicago"},"body":"We've seen this very same issue. Unable to create native thread due to ulimit setting, then broker gets into bad state and sulks for hours, slamming the door in the face of every client that's trying to connect. On the client this is witnessed by sockets being closed from the remote end, which looks like potential external interference at first, but when you look at the broker log it's clear that it's the broker resetting these sockets.\n\nI vote for making the broker more resilient against this type of problem, since hitting a ulimit and thus not being able to create a new pool worker or some such shouldn't throw the entire broker into the abyss. Here's the original OOM reported in the JVM's stdout.log:\n{noformat}\nINFO   | jvm 1    | 2015/06/08 05:30:26 | WARNING: RMI TCP Accept-0: accept loop for ServerSocket[addr=localhost/127.0.0.1,localport=42882] throws\nINFO   | jvm 1    | 2015/06/08 05:30:26 | java.lang.OutOfMemoryError: unable to create new native thread\nINFO   | jvm 1    | 2015/06/08 05:30:26 | \tat java.lang.Thread.start0(Native Method)\nINFO   | jvm 1    | 2015/06/08 05:30:26 | \tat java.lang.Thread.start(Thread.java:714)\nINFO   | jvm 1    | 2015/06/08 05:30:26 | \tat java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:949)\nINFO   | jvm 1    | 2015/06/08 05:30:26 | \tat java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1371)\nINFO   | jvm 1    | 2015/06/08 05:30:26 | \tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:414)\nINFO   | jvm 1    | 2015/06/08 05:30:26 | \tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:371)\nINFO   | jvm 1    | 2015/06/08 05:30:26 | \tat java.lang.Thread.run(Thread.java:745)\n{noformat}\nAnd this next OOM is what starts the \"timer already cancelled\" messages in the activeMQ log:\n{noformat}\nINFO   | jvm 1    | 2015/06/08 05:39:34 | Exception in thread \"ActiveMQ InactivityMonitor WriteCheckTimer\" java.lang.OutOfMemoryError: unable to create new native thread\nINFO   | jvm 1    | 2015/06/08 05:39:34 | \tat java.lang.Thread.start0(Native Method)\nINFO   | jvm 1    | 2015/06/08 05:39:34 | \tat java.lang.Thread.start(Thread.java:714)\nINFO   | jvm 1    | 2015/06/08 05:39:34 | \tat java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:949)\nINFO   | jvm 1    | 2015/06/08 05:39:34 | \tat java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1371)\nINFO   | jvm 1    | 2015/06/08 05:39:34 | \tat org.apache.activemq.transport.AbstractInactivityMonitor.writeCheck(AbstractInactivityMonitor.java:158)\nINFO   | jvm 1    | 2015/06/08 05:39:34 | \tat org.apache.activemq.transport.AbstractInactivityMonitor$2.run(AbstractInactivityMonitor.java:122)\nINFO   | jvm 1    | 2015/06/08 05:39:34 | \tat org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\nINFO   | jvm 1    | 2015/06/08 05:39:34 | \tat java.util.TimerThread.mainLoop(Timer.java:555)\nINFO   | jvm 1    | 2015/06/08 05:39:34 | \tat java.util.TimerThread.run(Timer.java:505)\n{noformat}\n\nSo basically it's the InactivityMonitor getting into a bad state. If that fails to create a new thread we should just disable the monitor entirely - there's certainly no stability to be gained by locking everyone out! At minimum if the broker gets into such a bad state it needs to shut itself down and either restart or relinquish its lock, so another broker can start somewhere else.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=volkerk","name":"volkerk","key":"volkerk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Volker Kleinschmidt","active":true,"timeZone":"America/Chicago"},"created":"2015-06-10T14:56:26.950+0000","updated":"2015-08-06T14:41:56.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/14739295","id":"14739295","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vavega720","name":"vavega720","key":"vavega720","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Valerie Vega","active":true,"timeZone":"Etc/UTC"},"body":"We've seen this issue in 5.9.1 and had to implement the workaround by increasing the thread limit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vavega720","name":"vavega720","key":"vavega720","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Valerie Vega","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-10T18:25:17.626+0000","updated":"2015-09-10T18:25:17.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/14739631","id":"14739631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"body":"In general increasing Thread Limit is a bad idea.\nIn big deployments most of threads can be taken by connections, when you use CACHE_NONE, which sometimes is default value for AMQ connection cache.\nJust try to use CACHE_CONSUMER (non-XA) or CACHE_CONNECTION (XA) altogether with SingleConneectionPool.\nSo now you can have 10 concurrent consumers with 10 destinations, using max 1 connection instead of max 100 + publishers.\nIn case of XA environment, please make sure your transaction manager supports CACHE_CONNECTION.\n\nApache Aries (open source) and Atomikos Extreme Transactions (commercial) both support them very well.\nBut don't even try to use CACHE_CONNECTION with Atomikos Essentials (open source)- it will fail ugly.\n\nThanks to above i've noticed huge reduction in amount of connections from about 500 to about 25 and started threads, improving significantly environment stability.\nNumber of started threads/day dropped from tens of millions a day to tens of thousands.\n\nEverybody who are experiencing problems as in this issue, should try above approach 1st before increasing os limits.\nThere is nothing good in having so many threads.\n\nCheers","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"created":"2015-09-10T21:27:13.247+0000","updated":"2015-09-10T21:32:57.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/14741305","id":"14741305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vavega720","name":"vavega720","key":"vavega720","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Valerie Vega","active":true,"timeZone":"Etc/UTC"},"body":"Are there any risks associated with using the CACHE_CONSUMER with the Single Connection Pool?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vavega720","name":"vavega720","key":"vavega720","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Valerie Vega","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-11T18:31:57.063+0000","updated":"2015-09-11T18:31:57.063+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/15400656","id":"15400656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"AMQ-5251 fixes the issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-07-30T12:20:42.976+0000","updated":"2016-07-30T12:20:42.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12770519/comment/15400743","id":"15400743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=volkerk","name":"volkerk","key":"volkerk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Volker Kleinschmidt","active":true,"timeZone":"America/Chicago"},"body":"Hmm, while that's nice to hear it's very non-obvious that the two issues are even related.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=volkerk","name":"volkerk","key":"volkerk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Volker Kleinschmidt","active":true,"timeZone":"America/Chicago"},"created":"2016-07-30T17:03:50.834+0000","updated":"2016-07-30T17:03:50.834+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5543/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i24vdr:"}}