{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483937","self":"https://issues.apache.org/jira/rest/api/2/issue/12483937","key":"AMQ-1551","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/9","id":"9","description":"Unresolved","name":"Unresolved"},"customfield_12312322":null,"customfield_12310220":"2008-05-16T17:37:12.221+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jul 12 18:40:00 UTC 2008","customfield_12310420":"65041","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_112772565965_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-08-14T13:57:50.030+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1551/watchers","watchCount":2,"isWatching":false},"created":"2008-01-17T08:15:04.101+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315614","id":"12315614","description":"","name":"4.1.1","archived":false,"released":true,"releaseDate":"2007-06-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-08-14T13:57:50.038+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"During evaluation of ActiveMQ we found incompatibiltiesÂ´of MQ with BEA WLS 8.1 and WLS 10. We contacted the BEA support - they where investigating and pinpointed the problem:\n\nHello ,\n\nThis is regarding your support case ABCDEF titled Need help in configuring message bridge with ActiveMQ. Here I am with the response from the next level of support team on the following NullPointerException that I am getting while configuring a message bridge with WLS. It is observed that even other customers are also observing the same exception while configuring a message bridge with ActiveMQ.\n\n<AdminServer> <[ACTIVE] ExecuteThread: '0' for queue: 'weblogic.kernel.Default (self-tuning)'> <<anonymous>> <> <> <1197983909603> <BEA-000000> <Exception:\njavax.jms.JMSException: java.lang.NullPointerException\nat org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:46)\nat org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1181)\nat org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1551)\nat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:465)\nat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:356)\nat weblogic.jms.adapter.JMSBaseConnection.sendInternal(JMSBaseConnection.java:794)\nat weblogic.jms.adapter.JMSBaseConnection.access$200(JMSBaseConnection.java:84)\nat weblogic.jms.adapter.JMSBaseConnection$6.run(JMSBaseConnection.java:707)\nat weblogic.security.acl.internal.AuthenticatedSubject.doAs(AuthenticatedSubject.java:363)\nat weblogic.security.service.SecurityManager.runAs(Unknown Source)\nat weblogic.jms.adapter.JMSBaseConnection.send(JMSBaseConnection.java:704)\n\n\nIt is confirmed that this is not an issue with WLS, but Active MQ not setting the JMS Destination after the message is sent. As per the JMS specification, it states that the JMSDestination should be set AFTER the message is sent. In the case of a client contacting weblogic, this should be the wlclient.jar classes, as these are used to handle the connection; in the case of wls -> wls via messaging bridge, it will still be the same classes, although these will embedded within the JMS server.\n\nIn the case of WLS -> ActiveMQ via a messaging bridge, the messaging bridge will create a connection to ActiveMQ using the ActiveMQ client classes. The messaging bridge won't be able to set the JMSDestination, because it can't be done after the message is sent. It can be done by either the ActiveMQ client classes or the ActiveMQ JMS server, becasue these will handle the post send method methods.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172478","customfield_12312823":null,"summary":"ActiveMQ as foreign JMS provider to BEA WLS 8.1/10","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cbu","name":"cbu","key":"cbu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Burger","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cbu","name":"cbu","key":"cbu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Burger","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"BEA WLS 8.1/10\nSuSE SLES 9","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483937/comment/12939682","id":"12939682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Just took a quick peek at what 5.1.0 does and it does set the destination on the message by the time the send() method returns.  But I'm pretty sure we also did that for 4.1\n\nCould you attach a junit test case demonstrating the failure your reporting.  Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2008-05-16T17:37:12.221+0000","updated":"2008-05-16T17:37:12.221+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483937/comment/12939976","id":"12939976","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=guy.veraghtert","name":"guy.veraghtert","key":"guy.veraghtert","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guy Veraghtert","active":true,"timeZone":"Etc/UTC"},"body":"My findings after some debugging:\n\nThe send method in ActiveMQSession sets the incoming ActiveMQDestination on the incoming javax.jms.Message, in my case this message was of type weblogic.jms.common.TextMessageImpl. The imlementation of the setJMSDestination() method on this class (in fact on the superclass weblogic.jms.common.MessageImpl) doesn't set the destination if it isn't an instance of a implementation specific weblogic Destination. So after executing the setJMSDestination(), getJMSDestination() on the incoming message still returns null.\n\nLater on in the send method, the weblogic specific message is transformed into an ActiveMQMessage via ActiveMQMessageTransformation.transformMessage(message, connection); This static method uses getJMSDestination() (returning null) on the orginal weblogic message to create an activemq version of the destination: activeMessage.setJMSDestination(transformDestination(message.getJMSDestination()));\n\nA simple fix to support (amongst others) WLS bridging would be to set the destination after the message was transformed:\n\nActiveMQMessage msg = ActiveMQMessageTransformation.transformMessage(message, connection);\n//for WebLogic\nif(msg.getJMSDestination() == null) {\n msg.setJMSDestination(destination);\n}\n\nProbably this would also solve issue: https://issues.apache.org/activemq/browse/AMQ-1217\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=guy.veraghtert","name":"guy.veraghtert","key":"guy.veraghtert","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guy Veraghtert","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-12T18:40:00.896+0000","updated":"2008-07-12T18:40:00.896+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1551/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tvwn:"}}