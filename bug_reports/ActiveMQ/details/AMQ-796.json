{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483294","self":"https://issues.apache.org/jira/rest/api/2/issue/12483294","key":"AMQ-796","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315629","id":"12315629","description":"","name":"4.0.3","archived":true,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-09T09:58:13.320+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Oct 22 15:20:21 UTC 2018","customfield_12310420":"84328","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_41015328802_*|*_5_*:*_2_*:*_74982068615_*|*_4_*:*_1_*:*_66617693273","customfield_12312321":null,"resolutiondate":"2012-04-18T10:53:06.565+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-796/watchers","watchCount":11,"isWatching":false},"created":"2006-07-05T20:28:16.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315610","id":"12315610","name":"4.0","archived":false,"released":true},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-10-22T15:20:21.490+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Dejan Reported on the User lists:\n\nHi,\n\nafter some experiments I found that this problem only exists if there are no\nother threads in the application. It seems like connection thread dies\nbefore it manages to reconnect. By starting another thread in the\napplication, it succeeds to recover from master failure and reconnect to the\nslave broker. So I have a workaround for now, but it would be nice to make\nthis work even for simple (single-threaded) clients.\n\nRegards,\nDejan","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461686","id":"12461686","filename":"AMQ-796.cmd","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garyw","name":"garyw","key":"garyw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Watson","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-29T00:01:25.242+0000","size":1336,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461686/AMQ-796.cmd"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12536809","id":"12536809","filename":"jstack_amq_5.6.0","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-17T12:23:33.892+0000","size":20325,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12536809/jstack_amq_5.6.0"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12607348","id":"12607348","filename":"jstack_v5.8.0","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-08T11:35:33.184+0000","size":7121,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12607348/jstack_v5.8.0"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12846507","id":"12846507","filename":"Sender.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=TuoDi","name":"TuoDi","key":"tuodi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"TuoDi","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-10T07:05:20.184+0000","size":2188,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12846507/Sender.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12846506","id":"12846506","filename":"threadDump.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=TuoDi","name":"TuoDi","key":"tuodi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"TuoDi","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-10T07:05:20.166+0000","size":30589,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12846506/threadDump.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59663","customfield_12312823":null,"summary":"Client may shtudown when failover connection is reconnecting.  We need to maintain at least 1 non-daemon thread alive.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/12939189","id":"12939189","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Fix in rev 587504\n\n   The threads associated with the session are now setup to be non-daemon so that if you \n   setup a MessageListener and let the main thread exit, your program will not terminate\n   if there are no active transport threads which is the case when the failover transport\n   is in the middle of reconnecting to a broker.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2007-10-23T13:37:04.759+0000","updated":"2007-10-23T13:37:04.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/12942311","id":"12942311","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"This issue occurs again on the trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-09T09:58:13.320+0000","updated":"2010-03-09T09:58:13.320+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/12942552","id":"12942552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garyw","name":"garyw","key":"garyw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Watson","active":true,"timeZone":"Etc/UTC"},"body":"This is a Windows cmd script that uses 2 instances of the ProducerTool sample app to create 2 embedded brokers, and the single-threaded ConsumerTool with a failover URI to demonstrate the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garyw","name":"garyw","key":"garyw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Watson","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-29T00:01:25.330+0000","updated":"2010-04-29T00:01:25.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/12943317","id":"12943317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jim_mccabe","name":"jim_mccabe","key":"jim_mccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jim McCabe","active":true,"timeZone":"Etc/UTC"},"body":"The solution to this should be simple - just make sure the thread that performs the failover logic does NOT call setDaemon(true).\n\nSince this bug was fixed three years ago and came back to life, it would be nice if the code took more steps to prevent this from happening in the future, for example:\n\n- Override setDaemon(boolean) on that thread so that it never allows itself to be flagged as a daemon.  If it is called in that way, output a stack trace with a message specifically refering to this bug (AMQ-796).\n\n- Add unit tests that would fail if another part of the code set the failover thread as a daemon.  This seems like it would be a lot harder than the override approach above, but would be nice if it were possible.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jim_mccabe","name":"jim_mccabe","key":"jim_mccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jim McCabe","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-06T15:23:31.549+0000","updated":"2010-05-06T15:23:31.549+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13256433","id":"13256433","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed by Subversion: Committed revision 1327443","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-18T10:53:06.657+0000","updated":"2012-04-18T10:53:06.657+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13416134","id":"13416134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"body":"This issue still persists. attaching the jstack on broker. It still doesn't show any non-daemon thread which would have fixed the issue i guess.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-17T12:24:37.839+0000","updated":"2012-07-17T12:24:37.839+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13540358","id":"13540358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kimmking","name":"kimmking","key":"kimmking","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"kimm king","active":true,"timeZone":"Asia/Shanghai"},"body":"This issue occurs again on the trunk and Version 5.7.0.\nUsing:\n1. start a broker in command line\n2. create and run a connection with a consumer and TransportListener(for track reconnecting) in eclipse\n3. stop the broker and restart the broker\n4. then we can see client transportInterupted and transportResumed\n5. stop the broker again \n6. the client process will quit!!!\n\nThe early fix for this bug is to remove daemon=true on ActiveMQ Connection Executor,\nbut sometimes this executor does not create new thread.\n\nThe solution is to make the reconnectTask thread is non-daemon:\n// FailoverTransport.java row: 132 \nreconnectTaskFactory = new TaskRunnerFactory();\nreconnectTaskFactory.setDaemon(false); // to set daemon=false by kimmking\nreconnectTaskFactory.init();\n\nAfter the fix, the reconnecting of this client works well during broker's stop for many times.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kimmking","name":"kimmking","key":"kimmking","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"kimm king","active":true,"timeZone":"Asia/Shanghai"},"created":"2012-12-28T06:29:26.136+0000","updated":"2012-12-28T06:29:26.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13540366","id":"13540366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"body":"We just found that non-daemon thread for the executor in the connection may not fix this issue.\nThe executor in the connection is used to async take action when internal exceptions occur.\nIf no internal exceptions the executor will not be initiated by filling up with non-daemon threads.\nIn this case client still can shutdown when failover connection is reconnecting \nbecause non-daemon threads do not exist in JVM .\nOne simple solution is to keep the thread attached with the reconnectTask non-daemon.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2012-12-28T06:36:44.977+0000","updated":"2012-12-28T06:36:44.977+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13540371","id":"13540371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kimmking","name":"kimmking","key":"kimmking","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"kimm king","active":true,"timeZone":"Asia/Shanghai"},"body":"Another suggestion, named the reconnectTask thread：\nreconnectTaskFactory = new TaskRunnerFactory();\nin FailoverTransport.java line 132 is modified to \nreconnectTaskFactory = new TaskRunnerFactory(\"FailoverTransport-ReconnectTask\");","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kimmking","name":"kimmking","key":"kimmking","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"kimm king","active":true,"timeZone":"Asia/Shanghai"},"created":"2012-12-28T06:52:47.515+0000","updated":"2012-12-28T06:52:47.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13543778","id":"13543778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fdegir","name":"fdegir","key":"fdegir","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fdegir","active":true,"timeZone":"Europe/Berlin"},"body":"We see same behaviour with our simple producer/consumer with 5.7.0. If we attach TransportListener to consumer then things work fine.\nPoducer doesn't have issues as noted by others.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fdegir","name":"fdegir","key":"fdegir","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fdegir","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-04T10:44:40.738+0000","updated":"2013-01-04T10:45:37.239+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13789122","id":"13789122","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"body":"Still an issue with ActiveMQ v5.8 !!  Can somebody resolve this please...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-08T11:27:56.937+0000","updated":"2013-10-08T11:27:56.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13789133","id":"13789133","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"body":"Attaching the jstack output for v5.8. The only non-daemon thread is the main thread which I stopped from exiting only for the purpose of taking a jstack snapshot.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-08T11:35:33.206+0000","updated":"2013-10-08T11:35:33.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13789264","id":"13789264","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnbing","name":"johnbing","key":"johnbing","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Bing","active":true,"timeZone":"Etc/UTC"},"body":"This is really very strange since the creation time for this issue is 2006. Is it really this tough to make the relevant thread non-daemon?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnbing","name":"johnbing","key":"johnbing","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Bing","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-08T15:01:26.741+0000","updated":"2013-10-08T15:01:26.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13790377","id":"13790377","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"body":"Ping! Any updates here ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xbhanu","name":"xbhanu","key":"xbhanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Bhanu","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-09T14:16:00.577+0000","updated":"2013-10-09T14:16:00.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/13790387","id":"13790387","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Use a 5.9-SNAPSHOT, should get you sorted. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-10-09T14:25:38.690+0000","updated":"2013-10-09T14:25:38.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/15445717","id":"15445717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=babramson","name":"babramson","key":"babramson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Björn Abramson","active":true,"timeZone":"Etc/UTC"},"body":"This issue still seem to exists with client version 5.14.0 using a MessageListener and single threaded application. The reconnect tasks are still daemon threads.\n\nThread output:\n\n\"ActiveMQ Task-2\" #14 daemon prio=5 os_prio=0 tid=0x000000001e616000 nid=0x11b4 waiting on condition [0x000000001f5cf000]\n\"ActiveMQ Task-1\" #11 daemon prio=5 os_prio=0 tid=0x000000001e3df000 nid=0x7cc waiting on condition [0x000000001ef8e000]\n\nCause:\n\nWhen the FailoverTransport is created the associated task runner will have daemon = true set. Code path:\n\nFailoverTransport.java: \n\n 136         reconnectTaskFactory = new TaskRunnerFactory();\n 137         reconnectTaskFactory.init();\n\n\nTaskRunnerFactory.java:\n\n  58     public TaskRunnerFactory() {\n  59         this(\"ActiveMQ Task\");\n  60     }\n  61 \n  62     public TaskRunnerFactory(String name) {\n  63         this(name, Thread.NORM_PRIORITY, true, 1000);\n  64     }\n\nThe third parameter (daemon = true) is the culpit. \n\nIt seems that the simplest solution is what has been suggested previously, explicitly setting daemon = false on the reconnect factory:\n\nreconnectTaskFactory.setDaemon(false);\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=babramson","name":"babramson","key":"babramson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Björn Abramson","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-29T12:25:29.394+0000","updated":"2016-08-29T12:25:52.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/15814130","id":"15814130","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=TuoDi","name":"TuoDi","key":"tuodi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"TuoDi","active":true,"timeZone":"Etc/UTC"},"body":"Yes,we have the some problem in activemq 5.10.0 and 5.13.4. we use failover tcp protocol like:\nfailover://(tcp://127.0.0.1:61624,tcp://127.0.0.1:61626)?nested.wireFormat.maxInactivityDuration=3000&nested.connectionTimeout=2000&maxReconnectAttempts=2&timeout=2000&randomize=false&initialReconnectDelay=50&startupMaxReconnectAttempts=2&maxReconnectDelay=100\n\nfirst keep all Mq server up\nthen shutdown one of the server\nsee the log keep create a new connection on the up server and then closed the new connection and the recreate a new connection on the up server ...... dead loop....\n\nthreaddump the thread and see the threadDump.txt and the test code Sender.java in the attach file.\n\n\"ActiveMQ Task-1\" daemon prio=6 tid=0x000000000d5c3800 nid=0x2bc8 waiting on condition [0x000000000dc2e000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x00000000db305ec8> (a java.util.concurrent.CountDownLatch$Sync)\n\tat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedNanos(AbstractQueuedSynchronizer.java:1033)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.tryAcquireSharedNanos(AbstractQueuedSynchronizer.java:1326)\n\tat java.util.concurrent.CountDownLatch.await(CountDownLatch.java:282)\n\tat org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:97)\n\tat org.apache.activemq.transport.failover.FailoverTransport.restoreTransport(FailoverTransport.java:841)\n\tat org.apache.activemq.transport.failover.FailoverTransport.doReconnect(FailoverTransport.java:1020)\n\t- locked <0x0000000090c6a228> (a java.lang.Object)\n\tat org.apache.activemq.transport.failover.FailoverTransport$2.iterate(FailoverTransport.java:148)\n\t- locked <0x0000000090c6a238> (a java.lang.Object)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:133)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:48)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:745)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=TuoDi","name":"TuoDi","key":"tuodi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"TuoDi","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-10T07:01:46.825+0000","updated":"2017-01-10T07:11:39.643+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483294/comment/16659079","id":"16659079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=siick","name":"siick","key":"siick","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=siick&avatarId=37091","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=siick&avatarId=37091","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=siick&avatarId=37091","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=siick&avatarId=37091"},"displayName":"Scarciello","active":true,"timeZone":"Etc/UTC"},"body":"Just a small reminder to tells that this issue is still in 5.12.1.\r\n\r\nAdding these in FailoverTransport.class fix the issue like [~kimmking] said before..\r\n{code:java}\r\nreconnectTaskFactory = new TaskRunnerFactory();\r\nreconnectTaskFactory.setDaemon(false); // to set daemon=false by kimmking\r\nreconnectTaskFactory.init();\r\n{code}\r\nIf i look that Jira this issue is solved from 5.6.0 but we are a lot here to explain that it is not corrected because we have to edit FailoverTRansport.class by ourselves. So he's it the only workaround for now or maybe is resolved in the last version?\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=siick","name":"siick","key":"siick","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=siick&avatarId=37091","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=siick&avatarId=37091","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=siick&avatarId=37091","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=siick&avatarId=37091"},"displayName":"Scarciello","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-22T15:20:21.490+0000","updated":"2018-10-22T15:20:21.490+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-796/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0akxb:"}}