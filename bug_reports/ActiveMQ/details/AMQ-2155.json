{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482902","self":"https://issues.apache.org/jira/rest/api/2/issue/12482902","key":"AMQ-2155","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri May 29 05:16:15 UTC 2009","customfield_12310420":"75049","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_16014747230_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-09-12T07:00:33.465+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2155/watchers","watchCount":2,"isWatching":false},"created":"2009-03-10T22:28:06.235+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-09-12T07:00:33.455+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Using the stock ActiveMQ 5.2.0 install, with a very small producer and consumer (see source code here: http://groups.google.com/group/activemessaging-discuss/browse_thread/thread/0b45ae6f030a13af#) , using client :ack mode;\nAdding additional consumers to a queue results has no affect on message distribution -- only the originally connected consumers receive the messages UNTIL the queue is empty, or the original message consumes disconnect. One would LIKE to be able to add additional consumers for a queue, and have the broker distrubute messages to those consumers -- this does NOT happen in 5.1.0 and 5.2.0.  \n\nALSO, when there are multiple consumers attached to the broker, performance can degrade so that only one or two consumers are being sent messages. THIS may be related, perhaps not.\n\nATTACHED is a dump of the STOMP TRANSPORT trace. \n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461390","id":"12461390","filename":"stomplog-1.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-10T22:37:48.622+0000","size":175861,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461390/stomplog-1.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161472","customfield_12312823":null,"summary":"ActiveMQ with STOMP producer, multiple consumers -- ActiveMQ doesn't distribute correct messages to additional consumer AND Delivers messages out of order to newly connecting consumer.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"mac osx; rails 2.1.1; ruby 1.8.6;","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482902/comment/12940943","id":"12940943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"body":"Note that there two consumers initially connected, denoted by port - 55213, 55218. \nThey process a number of messages, until 15:03:01,555 when 55305 connects/subscribes followed by 55309 then 55312, 55315,55318, 55324, etc.\n\nNO messages are processed by any of the new consumers until the queue empties at 15:06:34.\n\nA new batch of messages is queued at 15:20:13; this new set is distributed among the waiting consumers.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-10T22:37:48.663+0000","updated":"2009-03-10T22:37:48.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482902/comment/12940484","id":"12940484","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"body":"This is affecting a production environment now.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-22T05:50:03.686+0000","updated":"2009-04-22T05:50:03.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482902/comment/12941216","id":"12941216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"body":"This appears to be related to the activemq.prefetchSize. Messages are also being dispatched out of order.\n\nWith the default prefetchSize (set to 1000 if the online docs are correct), using the code provided in this report, I do the following:\n1) Clear the queues\n2) Start one consumer\n3) Queue 200 messages, 1 second delay (TestModel(200,1) in the example)\n4) Start the 2nd consumer\n5)  --- I observe that the 2nd consumer sees NO messages while the first consumer continues to process messages. EXPECTED BEHAVIOR: 2nd consumer should see messages\n6) Queue 50 messages, 2 second delay(TestModel(50,2) in the example)\n7) --- I observe that the 1st consumer is working on the original set of messages. The 2nd consumer starts to process the newly-queued 2-second messages- processing the Messages out of order. It only processes 1/2 of the messages that were queued (this 1/2 ratio of processed to queued was observed repeated for various #'s of queued messages\n8) When the 2nd consumer stops, queue 4 messages of 3 second delay \n9) Observe that the 2nd consumer processes 2 of the 3 second delay messages, then stops. Also observe that consumer #1 is still processing 1 second messages: A listing of the messages in the queue shows gaps in the message sequences where messages have been removed and processed.\nID:shine.local-54798-1240240213473-4:11:-1:1:1432 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:56:46:037 PDT \t\t Delete\nID:shine.local-54798-1240240213473-4:11:-1:1:1433 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:56:46:039 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1434 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:533 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1436 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:535 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1438 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:536 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1440 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:541 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1442 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:542 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1444 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:582 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1446 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:582 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1448 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:582 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1450 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:583 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1452 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:583 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1454 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:596 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1456 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:597 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1458 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:598 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1460 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:600 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1462 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:600 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1464 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:601 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1466 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:605 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1468 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:605 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1470 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:605 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1472 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:606 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1474 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:606 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1476 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:606 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1478 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:614 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1480 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:615 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1482 \t\tPersistent \t0 \tfalse \t\t2009-04-23 09:57:30:616 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1484 \t\tPersistent \t0 \tfalse \t\t2009-04-23 10:00:21:369 PDT \t\tDelete\nID:shine.local-54798-1240240213473-4:11:-1:1:1486 \t\tPersistent \t0 \tfalse \t\t2009-04-23 10:00:21:373 PDT \t\tDelete\n\n10) Observe that Consumer 1 eventually processes the remaining 2 second and 3 second messages.\n\n\n\n\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-23T17:06:13.352+0000","updated":"2009-04-23T17:06:13.352+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482902/comment/12941212","id":"12941212","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"body":"Tried various pre-fetch sizes.\n\nprefetchsize of zero - NO messages delivered to initial or subsequent connecting consumers.\n\nprefetchsize of 1 - subsequently connecting consumers get messages immediately, no issues with out of order messages.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-23T17:08:07.665+0000","updated":"2009-04-23T17:50:03.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482902/comment/12941408","id":"12941408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"body":"We're working around this issue by limiting prefetch, using client_ack, and restarting the broker periodically.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmoran","name":"bmoran","key":"bmoran","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Moran","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-29T05:16:15.311+0000","updated":"2009-05-29T05:16:15.311+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2155/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rzz3:"}}