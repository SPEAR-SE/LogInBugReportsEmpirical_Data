{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13128386","self":"https://issues.apache.org/jira/rest/api/2/issue/13128386","key":"AMQ-6881","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-01-08T16:01:30.442+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jan 11 02:43:53 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6881/watchers","watchCount":2,"isWatching":false},"created":"2018-01-04T02:06:09.940+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-01-11T02:44:00.784+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12321807","id":"12321807","name":"AMQP","description":"AcitveMQ's AMQP Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I'm not sure whether this will be considered a bug, but I figured I'd at least let you know.\r\n\r\nI ran across this issue while testing my Go AMQP implementation against ActiveMQ. When attempting to send messages to ActiveMQ the connection would be terminated an error like `AmqpProtocolException: Could not decode AMQP frame: hex: ...`. I eventually tracked this down to my client not including initial-delivery-count in the attach. The spec is clear that the field \"MUST NOT be null if role is sender,\" so it was an oversight on my part.\r\n\r\nI was surprised that the failure occurred when the first transfer frame was sent rather than the malformed attach. Though my Java knowledge is very limited, the stack trace I was able to get (by removing some of the handling) implies that the delivery-count in ActiveMQ/Proton was not initialized during the attach and then caused a NullPointerException when the delivery-count was incremented while processing the transfer.\r\n\r\n```\r\njava.lang.NullPointerException\r\n\tat org.apache.qpid.proton.engine.impl.TransportLink.incrementDeliveryCount(TransportLink.java:202)\r\n\tat org.apache.qpid.proton.engine.impl.TransportSession.handleTransfer(TransportSession.java:326)\r\n\tat org.apache.qpid.proton.engine.impl.TransportImpl.handleTransfer(TransportImpl.java:1266)\r\n\tat org.apache.qpid.proton.engine.impl.TransportImpl.handleTransfer(TransportImpl.java:66)\r\n\tat org.apache.qpid.proton.amqp.transport.Transfer.invoke(Transfer.java:160)\r\n\tat org.apache.qpid.proton.engine.impl.TransportImpl.handleFrame(TransportImpl.java:1384)\r\n\tat org.apache.qpid.proton.engine.impl.FrameParser.input(FrameParser.java:418)\r\n\tat org.apache.qpid.proton.engine.impl.FrameParser.process(FrameParser.java:527)\r\n\tat org.apache.qpid.proton.engine.impl.SaslImpl$SaslTransportWrapper.reallyProcessInput(SaslImpl.java:658)\r\n\tat org.apache.qpid.proton.engine.impl.SaslImpl$SaslTransportWrapper.process(SaslImpl.java:607)\r\n\tat org.apache.qpid.proton.engine.impl.HandshakeSniffingTransportWrapper.process(HandshakeSniffingTransportWrapper.java:101)\r\n\tat org.apache.qpid.proton.engine.impl.TransportImpl.process(TransportImpl.java:1495)\r\n\tat org.apache.qpid.proton.engine.impl.TransportImpl.processInput(TransportImpl.java:1453)\r\n\tat org.apache.qpid.proton.engine.impl.TransportImpl.input(TransportImpl.java:298)\r\n\tat org.apache.activemq.transport.amqp.protocol.AmqpConnection.onAMQPData(AmqpConnection.java:373)\r\n\tat org.apache.activemq.transport.amqp.AmqpTransportFilter.onCommand(AmqpTransportFilter.java:109)\r\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\r\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:233)\r\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215)\r\n\tat java.base/java.lang.Thread.run(Thread.java:844)\r\n```","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Error during transfer when sender doesn't include initial-delivery-count in attach","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kalebksp","name":"kalebksp","key":"kalebksp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kale Blankenship","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kalebksp","name":"kalebksp","key":"kalebksp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kale Blankenship","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13128386/comment/16316531","id":"16316531","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"This appears to be a issue more so with the Proton-J library which isn't validating the attach and providing a suitable error to the broker so it has no idea that the attach is not valid.  I'd recommend creating an issue on the [Qpid Proton JIRA|https://issues.apache.org/jira/browse/PROTON] tracker for this as that's where it'd need to be addressed.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2018-01-08T16:01:30.442+0000","updated":"2018-01-08T16:01:30.442+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13128386/comment/16321602","id":"16321602","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kalebksp","name":"kalebksp","key":"kalebksp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kale Blankenship","active":true,"timeZone":"America/Los_Angeles"},"body":"Thank you. I've opened PROTON-1740. Would you like me to go ahead and close this issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kalebksp","name":"kalebksp","key":"kalebksp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kale Blankenship","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-11T02:43:53.325+0000","updated":"2018-01-11T02:44:00.773+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6881/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3oho7:"}}