{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12500006","self":"https://issues.apache.org/jira/rest/api/2/issue/12500006","key":"AMQ-3194","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2011-03-01T11:10:08.410+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 11 15:22:28 UTC 2011","customfield_12310420":"65456","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_14119521133_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-08-11T15:22:28.899+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3194/watchers","watchCount":2,"isWatching":false},"created":"2011-03-01T05:17:07.804+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-08-11T15:22:28.933+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Here is the setup:\n \nActiveMQ 5.4.2 using JDBC persistence (MSSQLServerExpress DB)... (just one server connect - no \"master/slave cluster\"...)\n \n1000 simulated clients send persistent messages every 10 seconds - 10 messages each\n \nso in total they enqueue 10000 messages into INBOUND queue (via a virtual destination 'MDT.INBOUND' that does a bit of \"forking\")\n<compositeQueue name=\"MDT.INBOUND\" forwardOnly=\"true\">\n<forwardTo>\n                                                <queue physicalName=\"INBOUND\" />\n                                                <queue physicalName=\"ARCHIVING-DST\" />\n                        </forwardTo>\n \n \nSo within a minute or so - I can see 10000 messages all in 'INBOUND' via SQL Server queries \nmessages TTL is set to 5 mins, so within 5 mins messages start expiriring...\n \nBUT only some messages would end up in ActiveMQ.DLQ, whilst the others seem to disappear in thin air (!!)\n \ninterestingly, the JMX counters (e.g. via jConsole) will actually show the missing number of messages as being in the 'INBOUND' queue\nbut as a matter of fact they are NOT there (which can be confirmed by SQL queries as well)\n \nthis happens sporadically... i.e. sometimes it would actually work ok - as expected - all expired messages ending up in DLQ,\nbut other times always about a hundred or so messages were missing\n \n \nFor example I just ran this 5 times - 2 times then restarted ActiveMQ (very \"gently\" - via the 'stop' command in jConsole) and ran again twice\n \nHere are the numbers (see attached xls as well)\n \n\t\t\t\t\t\tAfter ActiveMQ RESTART\t\t\t\t\n\t\tAfter 1st run\t\tAfter 2nd run\t\tand 3rd run\t\tafter 4th run\t\tafter 5th run\n\t\t\t\t\t\t\t\t\t\t\nJMX\tArchiving-Q' QueueSize\t10000\t\t20000\t\t30000\t\t40000\t\t50000\n\tActiveMQ.DLQ 'QueueSize\t10000\t\t19589\t\t29589\t\t39589\t\t48848\n\tINBOUND' QueueSize\t0\t\t411\t??\t0\thm... were did those 411 go?!!\t0\t\t741\n\tINBOUND' EnqueCount\t10000\t\t20000\t\t10000\t\t20000\t\t30000\n\tINBOUND' DequeCount\t10000\t\t19589\t\t10000\t\t20000\t\t29259\n\tINBOUND' ExpiredCpount\t10000\t\t19589\t\t10000\t\t20000\t\t29259\n\t\t\t\t\t\t\t\t\t\t\nDB\tArchiving-Q\t10000\t\t20000\t\t30000\t\t40000\t\t50000\n\tActiveMQ.DLQ\t10000\t\t19589\t\t29589\t\t39589\t\t48848\n\tINBOUND\t0\t\t0\t\t0\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\n \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172237","customfield_12312823":null,"summary":"persistent messages disappear (lost!!) upon expiry rather than ending up in a DLQ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Java 1.6, Sun Solaris","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500006/comment/13000726","id":"13000726","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"body":"this feels slightly similar to https://issues.apache.org/jira/browse/AMQ-2756 \nbut it is substantially different\nhowever, chances are it might be caused by the same underlying \"audit\" and \"composite destinations\" complications...\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-01T05:23:56.646+0000","updated":"2011-03-01T05:23:56.646+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500006/comment/13000827","id":"13000827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"can you attach some of the broker logs for this scenario, there may be some insight in there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-01T11:10:08.410+0000","updated":"2011-03-01T11:10:08.410+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500006/comment/13083161","id":"13083161","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"No logs or test case provided to gain insight into the issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-08-11T15:22:28.922+0000","updated":"2011-08-11T15:22:28.922+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3194/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tuf3:"}}