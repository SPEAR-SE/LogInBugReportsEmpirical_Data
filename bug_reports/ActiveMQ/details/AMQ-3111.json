{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12494539","self":"https://issues.apache.org/jira/rest/api/2/issue/12494539","key":"AMQ-3111","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2013-11-06T19:40:02.433+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 19 22:22:23 UTC 2016","customfield_12310420":"74732","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_89671681964_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-11-06T19:40:02.410+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3111/watchers","watchCount":4,"isWatching":false},"created":"2011-01-03T22:52:00.476+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"issuelinks":[{"id":"12408316","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12408316","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12654707","key":"AMQ-4598","self":"https://issues.apache.org/jira/rest/api/2/issue/12654707","fields":{"summary":"Negative JMX QueueSize attribute in due to purging a queue","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-07-19T22:22:23.025+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When a queue connection redelivery policy's max redelivery time  is set to -1, and the bad message which is failing constantly needs to be moved to exception queue manually (JMX JConsole, ActiveMQ WebConsole), then dequeue is accounted twice for the same message.\n\nSay at time T0 queue is empty\nqueue has a registered listener\nT1 => message gets put on the queue => enqueue = 1, dequeue = 0, pending = 1\nT2 .. T3 .. T4..T5 this message is constantly failing because of some runtime exception\n\nUsing ActiveMQ webconsole, we move this to exception queue...and have logic in the consumer to commit the session if this is a redelivered message that does not exist on the queue, Refer AMQ 3110\n\nThen,\n\nat T6\nenqueue count = 1, dequeue count = 2, pending count = -1\n\nAttached is the unit test showing this issue.\n\nPlease refer the log pasted below.\n\n-------------------------\n\n0 [JMX connector] INFO org.mortbay.log - Logging to org.slf4j.impl.SimpleLogger(org.mortbay.log) via org.mortbay.log.Slf4jLog\n2011-01-03 16:49:17,036 INFO  (BrokerService) - Using Persistence Adapter: MemoryPersistenceAdapter\n2011-01-03 16:49:17,036 INFO  (ManagementContext) - JMX consoles can connect to service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi\n2011-01-03 16:49:17,036 INFO  (BrokerService) - ActiveMQ 5.4.0 JMS Message Broker (localhost) is starting\n2011-01-03 16:49:17,036 INFO  (BrokerService) - For help or more information please see: http://activemq.apache.org/\n2011-01-03 16:49:17,317 INFO  (SchedulerBroker) - Scheduler using directory: activemq-data\\scheduler\n2011-01-03 16:49:17,364 INFO  (BrokerService) - ActiveMQ JMS Message Broker (localhost, ID:akuntamukkala-2412-1294094957083-0:0) started\n2011-01-03 16:49:17,411 INFO  (TransportConnector) - Connector vm://localhost Started\ntest.exception.queue\nMon Jan 03 16:49:17 CST 2011 : Number of messages in test.exception.queue =  1\nMon Jan 03 16:49:17 CST 2011 : Number of messages in test.queue = 1\nMon Jan 03 16:49:17 CST 2011 : test.queue : enqueue = 1, dequeue count = 0\nMon Jan 03 16:49:17 CST 2011 - Message received by consumer = ID:akuntamukkala-2412-1294094957083-3:1:1:2:1\nMon Jan 03 16:49:18 CST 2011 - Message received by consumer = ID:akuntamukkala-2412-1294094957083-3:1:1:2:1\nMon Jan 03 16:49:18 CST 2011 - Message received by consumer = ID:akuntamukkala-2412-1294094957083-3:1:1:2:1\nMon Jan 03 16:49:19 CST 2011 : test.queue : enqueue = 1, dequeue count = 0\nMon Jan 03 16:49:19 CST 2011 - Message received by consumer = ID:akuntamukkala-2412-1294094957083-3:1:1:2:1\nMon Jan 03 16:49:19 CST 2011 - Message received by consumer = ID:akuntamukkala-2412-1294094957083-3:1:1:2:1\nMon Jan 03 16:49:20 CST 2011 - Message received by consumer = ID:akuntamukkala-2412-1294094957083-3:1:1:2:1\nMon Jan 03 16:49:20 CST 2011 : Number of messages in test.queue after MOVE = 0\nMon Jan 03 16:49:20 CST 2011 : Number of messages in test.exception.queue after MOVE =  2\nMon Jan 03 16:49:20 CST 2011 : test.queue : enqueue = 1, dequeue count = 1\nMon Jan 03 16:49:20 CST 2011 - Message received by consumer = ID:akuntamukkala-2412-1294094957083-3:1:1:2:1\nnumberOfTimeMessageWasReceived 7\nnumber of times message was received after moving 7\nMon Jan 03 16:49:23 CST 2011 : Final test.queue : enqueue = 1, dequeue count = 2, pending message count = -1\n2011-01-03 16:49:23,739 INFO  (BrokerService) - ActiveMQ Message Broker (localhost, ID:akuntamukkala-2412-1294094957083-0:0) is shutting down\n2011-01-03 16:49:23,739 INFO  (TransportConnector) - Connector vm://localhost Stopped\n2011-01-03 16:49:23,770 INFO  (BrokerService) - ActiveMQ JMS Message Broker (localhost, ID:akuntamukkala-2412-1294094957083-0:0) stopped\n\n\n-----\n\n\nPlease run the attached Junit test and see this issue. Since AMQ 3110 is still unresolved, the only way we could get rid of the bad message being redelivered despite having been moved to an exception queue was by checking the redelivery counter and if the message was still on the queue, if not, then we acknowledge the session so subsequent messages can be processed.\n\nThank you,\nAshwini Kuntamukkala\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12467376","id":"12467376","filename":"FailingMessageRedeliveredDespiteBeingMovedToExceptionQueue.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuntamukkala","name":"akuntamukkala","key":"akuntamukkala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ashwini kuntamukkala","active":true,"timeZone":"America/Chicago"},"created":"2011-01-03T23:00:32.851+0000","size":15615,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12467376/FailingMessageRedeliveredDespiteBeingMovedToExceptionQueue.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81499","customfield_12312823":null,"summary":"Negative Pending Message Count","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuntamukkala","name":"akuntamukkala","key":"akuntamukkala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ashwini kuntamukkala","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuntamukkala","name":"akuntamukkala","key":"akuntamukkala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ashwini kuntamukkala","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP, ActiveMQ 5.4.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12494539/comment/12976998","id":"12976998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuntamukkala","name":"akuntamukkala","key":"akuntamukkala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ashwini kuntamukkala","active":true,"timeZone":"America/Chicago"},"body":"This is a unit test showing the negative pending message count.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuntamukkala","name":"akuntamukkala","key":"akuntamukkala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ashwini kuntamukkala","active":true,"timeZone":"America/Chicago"},"created":"2011-01-03T23:00:32.891+0000","updated":"2011-01-03T23:00:32.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12494539/comment/13815203","id":"13815203","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"tested against 5.9.0 and queue counts are not showing negative numbers in the tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-11-06T19:40:02.433+0000","updated":"2013-11-06T19:40:02.433+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12494539/comment/15384980","id":"15384980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kokushibyou","name":"kokushibyou","key":"kokushibyou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephanie M","active":true,"timeZone":"America/Los_Angeles"},"body":"We are seeing this problem in 5.10.\n\n\n{noformat}\nName â†‘\t                       Number Of Pending Messages  \tNumber Of Consumers  \tMessages Enqueued  \tMessages Dequeued  \ninboundQueue\t               - 210\t                        229\t                 3987822             \t3988032\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kokushibyou","name":"kokushibyou","key":"kokushibyou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephanie M","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-19T22:22:23.025+0000","updated":"2016-07-19T22:22:23.025+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3111/votes","votes":4,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0eapz:"}}