{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12634080","self":"https://issues.apache.org/jira/rest/api/2/issue/12634080","key":"AMQ-4348","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 05 08:27:20 UTC 2013","customfield_12310420":"314573","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_603757901_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-03-05T08:27:20.016+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4348/watchers","watchCount":2,"isWatching":false},"created":"2013-02-26T08:44:42.170+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318549","id":"12318549","name":"5.5.1","archived":false,"released":true,"releaseDate":"2011-10-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-03-05T08:27:20.067+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"This seems to be more or less identical to AMQ-1722\n\nWe run the AMQ 5.5.1 broker and our JEE/Spring application runs in Jboss 7.1.1 and uses the 5.6.0 version of the activemq-all/activemq-core packages.\n(also Spring 3.0.5 and Bitronix 2.1.3 for transactions)\n\nI start up the broker, then Jboss, once everything is up, I use mbeans to start the application picking matching rows from the DB and creating messages (there are 14 queues and associated DLQ queues working in a chain where the consumer of one queue is the producer for the next.)\n\nIn order to test how it handles errors I shut the broker down, then after some time (from a few seconds to a few minutes).\n\nStartup (tried with inactivity monitor due to suggestions in AMQ-1722, it had no effect)\n[org.apache.activemq.transport.failover.FailoverTransport] [JBOSS_AS] Successfully connected to tcp://<host>:14421?wireFormat.maxInactivityDuration=30000\n\nStopped AMQ\n[ActiveMQ Transport: tcp://<host>/<ip>:14421] [org.apache.activemq.transport.failover.FailoverTransport] [JBOSS_AS] Transport (tcp://<ip>:14421) failed, reason:  java.io.EOFException, attempting to automatically reconnect\n\nthe bitronix transactions time out\n\n3 minutes later, and  org.apache.activemq.SimplePriorityMessageDispatchChannel.closed is still false\n\nstart amq again\n[ActiveMQ Task-29] [org.apache.activemq.transport.failover.FailoverTransport] [JBOSS_AS] Successfully connected to tcp://<host>:14421?wireFormat.maxInactivityDuration=30000\n[bitronix-recovery-thread] [bitronix.tm.recovery.Recoverer] [JBOSS_AS] recoverer is already running, abandoning this recovery request\n\nThen the system handles 55 messages before stopping (assume these are prefetched messages), more AMQ restarts makes it handle a variable amount of messages (tried 2 more restarts, first one was 13 messages, then 2)\n\nAfter these the org.springframework.jms.listener.DefaultMessageListenerContainer stops recieving message events and the SimplePriorityMessageDispatchChannel unconsumedMessages in ActiveMQMessageConsumer insists all the queues are of size 0, while jconsole shows that they have plenty messages.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"314917","customfield_12312823":null,"summary":"Consumer not detecting broker restart","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moridin","name":"moridin","key":"moridin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ronny H. Ringen","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moridin","name":"moridin","key":"moridin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ronny H. Ringen","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Red Hat Enterprise Linux Server 5.8","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634080/comment/13586967","id":"13586967","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moridin","name":"moridin","key":"moridin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ronny H. Ringen","active":true,"timeZone":"Europe/Berlin"},"body":"setting maxInactivityDuration=3 makes it (not surprisingly) VERY slow, however, the inactivitymonitor does trigger and even after restart of AMQ it connects and starts eating messages (though as you would guess, it constantly reconnects). \nIf I set maxInactivityDuration=30, it acts the same way as with 30000, it never triggers, even after AMQ has been restartet and no messages are read.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moridin","name":"moridin","key":"moridin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ronny H. Ringen","active":true,"timeZone":"Europe/Berlin"},"created":"2013-02-26T09:50:13.111+0000","updated":"2013-02-26T09:50:13.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634080/comment/13593226","id":"13593226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moridin","name":"moridin","key":"moridin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ronny H. Ringen","active":true,"timeZone":"Europe/Berlin"},"body":"Turns out setting <prop key=\"prefetchPolicy.queuePrefetch\">0</prop> in driverproperties for the spring context for the bitronix PoolingConnectionFactory fixed the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moridin","name":"moridin","key":"moridin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ronny H. Ringen","active":true,"timeZone":"Europe/Berlin"},"created":"2013-03-05T08:26:06.852+0000","updated":"2013-03-05T08:26:06.852+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634080/comment/13593228","id":"13593228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moridin","name":"moridin","key":"moridin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ronny H. Ringen","active":true,"timeZone":"Europe/Berlin"},"body":"Not a problem in AMQ, but in default values and interaction between Spring DMLC and Bitronix PollingConnectionFactory","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moridin","name":"moridin","key":"moridin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ronny H. Ringen","active":true,"timeZone":"Europe/Berlin"},"created":"2013-03-05T08:27:20.062+0000","updated":"2013-03-05T08:27:20.062+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4348/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ia8f:"}}