{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483286","self":"https://issues.apache.org/jira/rest/api/2/issue/12483286","key":"AMQ-2135","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315621","id":"12315621","description":"","name":"5.3.1","archived":false,"released":true,"releaseDate":"2010-03-23"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-03-03T16:50:10.310+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon May 10 16:22:25 UTC 2010","customfield_12310420":"75060","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_38327696905_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-05-10T16:22:25.303+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2135/watchers","watchCount":6,"isWatching":false},"created":"2009-02-21T01:47:28.398+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-05-10T16:22:25.268+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"using only the example code, the 5.2.0 release can be made to distribute messages to brokers with no consumers, which remain at those brokers and are never consumed, unless a consumer later connects specifically to those brokers.\nthis bug is not reproducible in 5.1.0.\n\nto reproduce:\nrun 3 brokers.  connect a consumer to brokers 1 and 2.  connect a producer to broker 1.  not all messages produced will be received by the 2 consumers.  note that the specific brokers connected to matters for the 3-broker case.  for example, on my machine, if the producer connects to broker 2 instead of broker 1, all messages are received.  you may need to try various combinations of consumer/producer connections to reproduce the problem, but this specific setup breaks reliably for me.\n\nthis problem becomes more pronounced and easier to reproduce as the number of brokers increases.\n\nspecific configuration used to reproduce:\n\n3 broker config xml files:\ntestamq1.xml\n<beans\n  xmlns=\"http://www.springframework.org/schema/beans\"\n  xmlns:amq=\"http://activemq.apache.org/schema/core\"\n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd\n  http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd\n  http://activemq.apache.org/camel/schema/spring http://activemq.apache.org/camel/schema/spring/camel-spring.xsd\">\n\n  <broker brokerName=\"b1\" xmlns=\"http://activemq.apache.org/schema/core\" useJmx=\"false\" advisorySupport=\"true\">\n\n    <persistenceAdapter>\n      <amqPersistenceAdapter directory=\"activemq-data1\" maxFileLength=\"32mb\"/>\n    </persistenceAdapter>\n\n    <transportConnectors>\n      <transportConnector uri=\"tcp://localhost:61616\"/>\n    </transportConnectors>\n\n    <networkConnectors>\n      <networkConnector uri=\"static://(tcp://localhost:61617,tcp://localhost:61618)\" dynamicOnly=\"true\" networkTTL=\"5\"/>\n    </networkConnectors>\n\n  </broker>\n</beans>\n\ntestamq2.xml\n<beans\n  xmlns=\"http://www.springframework.org/schema/beans\"\n  xmlns:amq=\"http://activemq.apache.org/schema/core\"\n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd\n  http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd\n  http://activemq.apache.org/camel/schema/spring http://activemq.apache.org/camel/schema/spring/camel-spring.xsd\">\n\n  <broker brokerName=\"b2\" xmlns=\"http://activemq.apache.org/schema/core\" useJmx=\"false\" advisorySupport=\"true\">\n\n    <persistenceAdapter>\n      <amqPersistenceAdapter directory=\"activemq-data2\" maxFileLength=\"32mb\"/>\n    </persistenceAdapter>\n\n    <transportConnectors>\n      <transportConnector uri=\"tcp://localhost:61617\"/>\n    </transportConnectors>\n\n    <networkConnectors>\n      <networkConnector uri=\"static://(tcp://localhost:61616,tcp://localhost:61618)\" dynamicOnly=\"true\" networkTTL=\"5\"/>\n    </networkConnectors>\n\n  </broker>\n</beans>\n\ntestamq3.xml\n<beans\n  xmlns=\"http://www.springframework.org/schema/beans\"\n  xmlns:amq=\"http://activemq.apache.org/schema/core\"\n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd\n  http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd\n  http://activemq.apache.org/camel/schema/spring http://activemq.apache.org/camel/schema/spring/camel-spring.xsd\">\n\n  <broker brokerName=\"b3\" xmlns=\"http://activemq.apache.org/schema/core\" useJmx=\"false\" advisorySupport=\"true\">\n\n\n    <persistenceAdapter>\n      <amqPersistenceAdapter directory=\"activemq-data3\" maxFileLength=\"32mb\"/>\n    </persistenceAdapter>\n\n    <transportConnectors>\n      <transportConnector uri=\"tcp://localhost:61618\"/>\n    </transportConnectors>\n\n    <networkConnectors>\n      <networkConnector uri=\"static://(tcp://localhost:61616,tcp://localhost:61617)\" dynamicOnly=\"true\" networkTTL=\"5\"/>\n    </networkConnectors>\n\n  </broker>\n</beans>\n\n\nrun 3 brokers:\nbin/activemq xbean:testamq1.xml\nbin/activemq xbean:testamq2.xml\nbin/activemq xbean:testamq3.xml\n\nrun 2 consumers (from examples directory):\nant consumer -Durl=\"failover:(tcp://localhost:61616)\" -Dsubject=\"test.queue\" -Dmax=100 -DsleepTime=3\nant consumer -Durl=\"failover:(tcp://localhost:61617)\" -Dsubject=\"test.queue\" -Dmax=100 -DsleepTime=3\n\nrun 1 producer (from examples directory) with 10 messages:\nant producer -Durl=\"failover:(tcp://localhost:61616)\" -Dsubject=\"test.queue\" -Dmax=10\n\nconsumers will not receive all messages.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461609","id":"12461609","filename":"AMQ-2135-022010.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-05T20:40:40.141+0000","size":1648,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461609/AMQ-2135-022010.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461409","id":"12461409","filename":"AMQ-2135-Patch-03182009.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-18T17:47:36.590+0000","size":2974,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461409/AMQ-2135-Patch-03182009.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461608","id":"12461608","filename":"AMQ2135Test.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-05T20:40:39.935+0000","size":7057,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461608/AMQ2135Test.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461386","id":"12461386","filename":"AMQ-2135-UnitTest.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=seanoc","name":"seanoc","key":"seanoc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean O'Callaghan","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-09T17:00:34.509+0000","size":5123,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461386/AMQ-2135-UnitTest.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461256","id":"12461256","filename":"testamq1.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garthpatil","name":"garthpatil","key":"garthpatil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Garth Patil","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-03T19:16:39.523+0000","size":37569,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461256/testamq1.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461357","id":"12461357","filename":"testamq2.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garthpatil","name":"garthpatil","key":"garthpatil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Garth Patil","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-03T19:16:39.573+0000","size":36872,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461357/testamq2.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461289","id":"12461289","filename":"testamq3.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garthpatil","name":"garthpatil","key":"garthpatil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Garth Patil","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-03T19:16:39.576+0000","size":22501,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461289/testamq3.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161706","customfield_12312823":null,"summary":"network of brokers distributes messages to brokers with 0 consumers with dynamicOnly=true set","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhoffman","name":"dhoffman","key":"dhoffman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Don Hoffman","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhoffman","name":"dhoffman","key":"dhoffman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Don Hoffman","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"linux (centos 4.6) using ActiveMQ 5.2.0 binary distribution","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12940862","id":"12940862","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"in the scenario you describe above, can you see messages on broker 3(61618  - with no consumers) in the JMX or WebConsole?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-03T16:50:10.310+0000","updated":"2009-03-03T16:50:10.310+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12940878","id":"12940878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=echuta86","name":"echuta86","key":"echuta86","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"Etc/UTC"},"body":"I have run the same tests and came to the same issue. Using JMX, you can see that the queueSize is n, where n is the number of undelivered messages.\n\nI've also noticed that the undelivered messages will stay on the broker. If you set a consumer to hit the broker with the undelivered message, the messages will be delivered.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=echuta86","name":"echuta86","key":"echuta86","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-03T18:43:39.803+0000","updated":"2009-03-03T18:43:39.803+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12940852","id":"12940852","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garthpatil","name":"garthpatil","key":"garthpatil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Garth Patil","active":true,"timeZone":"Etc/UTC"},"body":"Attached 3 log files from running the example provided in the initial issue (with log4j.logger.org.apache.activemq=TRACE). The result of the test is that the first consumer (connected to 61616) consumes 5 messages, the second consumer (connected to 61617) consumes 2 messages, and 3 messages are orphaned on the 3rd broker (61618).\n\nThis seems to be a rather critical bug, given that a simple use case for a network of brokers does not function properly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garthpatil","name":"garthpatil","key":"garthpatil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Garth Patil","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-03T19:16:39.580+0000","updated":"2009-03-03T19:16:39.580+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12940860","id":"12940860","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=echuta86","name":"echuta86","key":"echuta86","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"Etc/UTC"},"body":"I have traced through the source code on 5.2 and pin-pointed the following behavior:\n\norg.apache.activemq.broker.region.Queue @ doDispatch(List<QueueMessageReference) \nthere is a line of code that checks whether a subscription can be selected for the message based on the message's brokerPath (hops, visited before, etc). This path can potentially fill up to \"n\". (where n=# of brokers in the network). At that point, it will run through all the subscriptions in the list and not be assigned to any queue and the message gets orphaned on that broker.\n\nI have run the same test and traced through the source code on 5.1 at the same block of code and observed that the brokerPath for a message will never be more than 1. (n=1)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=echuta86","name":"echuta86","key":"echuta86","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-05T01:19:30.182+0000","updated":"2009-03-05T01:19:30.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12940947","id":"12940947","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=seanoc","name":"seanoc","key":"seanoc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean O'Callaghan","active":true,"timeZone":"Etc/UTC"},"body":"Unit test which reproduces the problem","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=seanoc","name":"seanoc","key":"seanoc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean O'Callaghan","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-09T17:00:34.682+0000","updated":"2009-03-09T17:00:34.682+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12940929","id":"12940929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tpounds","name":"tpounds","key":"tpounds","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Trevor Pounds","active":true,"timeZone":"Etc/UTC"},"body":"I would like to mention that I have seen something similar with the following configuration:\n\n[producer] -> [broker 1] -> [broker 2] -> consumer\n\nI noticed that I get a small number of messages delivered to broker 2 when the active consumer is closed.  I suspect this has something to do with the preftech limit on the URI which results in one last batch of messages to be dispatched to the broker even though the consumer has been closed. I'm not sure if this is a race condition or not but the scenario mentioned above can be reproduced by producing 1000 messages or so and randomly stopping the consumer on broker 2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tpounds","name":"tpounds","key":"tpounds","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Trevor Pounds","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-09T17:53:02.485+0000","updated":"2009-03-09T17:53:02.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12941006","id":"12941006","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"I am able to reproduce this when I connect , stop and connect consumers many times. It might be the consumer is not removed cleanly on all the brokers when it disconnected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-16T22:37:04.669+0000","updated":"2009-03-16T22:37:04.669+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12941018","id":"12941018","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"this AMQ-2135-Patch-03182009.patch fixes the issue. Junit test is passed, test 4 brokers, with producer rotate on each one. \n\nNote: ConduitBridge.java has change for AMQ-2104, please ignore that. I generate mine on 5.2.0 tag version. Also subscriptionMapByRemoteId is not used by this bridge so i override the parent method to get rid of putting consumer into it. It will never be removed. \n\nPlease review this and apply to trunk once considering this is a valid fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-18T17:47:36.660+0000","updated":"2009-03-18T17:47:36.660+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12941231","id":"12941231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garthpatil","name":"garthpatil","key":"garthpatil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Garth Patil","active":true,"timeZone":"Etc/UTC"},"body":"The AMQ-2135-Patch-03182009.patch reliably passes the JUnit test case for low MESSAGE_COUNT numbers (e.g. less than 100), but reliably fails the test case when MESSAGE_COUNT is large. I am using 1000 for MESSAGE_COUNT, and it has never passed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garthpatil","name":"garthpatil","key":"garthpatil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Garth Patil","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-29T23:53:30.705+0000","updated":"2009-04-29T23:53:30.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12942167","id":"12942167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"hi, the old AMQ-2135-UnitTest.patch has a Thread.sleep(1000) so after the producer produce, wait for 1s, then it starts to check how many messages are consumed and apparently when the message number increases, it needs to give more time for the consumer to consume the messages.\n\nI made a patch on today's trunk r906983\n\nAttached are the AMQ2135Test.java which demonstrate the problem with the trunk code. You will see the test will never quit because it will never consume all the messages produced.\nand apply AMQ-2135-022010.patch it will fix the issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-05T20:40:40.145+0000","updated":"2010-02-05T20:40:40.145+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12942357","id":"12942357","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"try suppressDuplicateQueueSubscriptions=\"true\" on the networkConnector in the conf, this issue seems fixed from 5.3 see http://activemq.apache.org/networks-of-brokers.html by default this attribute is false so you will still experience stuck message on a network of broker bridged by multicast","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-15T16:06:37.112+0000","updated":"2010-03-15T16:06:37.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12942579","id":"12942579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"ying,\ncan you clarify where you are with this issue. Do we have a test case that fails on 5.2 and works on 5.3.0|5.3.1 or do we still need to apply your patches? I would like to commit the  test case if that is the case and close this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-06T08:30:52.413+0000","updated":"2010-05-06T08:30:52.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12942609","id":"12942609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"hi, gary,\nit is fixed from 5.3 on. The only thing the user need to add is suppressDuplicateQueueSubscriptions=\"true\" on the networkConnector in the conf if they are using a network of brokers in a certain way. that fixed the issue i saw. No need to apply my patches. thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-10T16:09:56.287+0000","updated":"2010-05-10T16:09:56.287+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483286/comment/12942610","id":"12942610","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"making resolved post Ying's comment on the resolution. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-10T16:22:25.259+0000","updated":"2010-05-10T16:22:25.259+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2135/votes","votes":4,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s1f3:"}}