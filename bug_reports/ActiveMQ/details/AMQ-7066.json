{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13189079","self":"https://issues.apache.org/jira/rest/api/2/issue/13189079","key":"AMQ-7066","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2018-10-03 06:44:24.478","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7066/watchers","watchCount":1,"isWatching":false},"created":"2018-10-03T06:44:24.478+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12343307","id":"12343307","description":"","name":"5.15.5","archived":false,"released":true,"releaseDate":"2018-08-09"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-10-03T06:58:31.136+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315705","id":"12315705","name":"activemq-camel","description":"camel activemq component"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Recently we observed a strange problem in one of our flows. We could see some messages being stuck in the queue when we are using the message grouping and dynamic scaling feature together.\r\n\r\n*Usecase:*\r\n\r\nWe want to process the messages belonging to a user (application user) in a sequence. Multiple users can send messages to the same queue, but messages originating from transactions made by a user should be processed sequentially. In order to do so we are using the \"JMSXGroupID\"  header to group the messages and the \"username\" serves as the group key.\r\n\r\n*Our configuration and versions:*\r\n # We are using ActiveMQ 5.15.5\r\n # We are using camel routing to connect to ActiveMQ, both on the producer and consumer side. Camel version : 2.20.1\r\n # We are using the following properties in the consumer URI to enable dynamic scaling : maxConcurrentConsumers, idleTaskExecutionLimit (defaulted to 10), maxMessagesPerTask (defaulted to 250)\r\n # JDK version : 1.8.0_91\r\n\r\n*Observations:*\r\n # The messages are stuck for some of the groups. Messages belonging to other groups are processing fine. There is no identifiable pattern for the groups that are stuck. During each execution some random groups got stuck.\r\n # The messages get processed when the consumer container is restarted and works fine for sometime before the issue recurs.\r\n # *When we verified from the admin console, we could see that the number of consumers are going beyond the max value set for it.*\r\n # We verified from the thread dumps that all the consumers are healthy and are in TIMED_WAITING state. Even though there are some messages stuck in the queue, they are not being delivered to the waiting consumers.\r\n # We have entry-exit logs for the producers and consumers. We could see the messages are being sent successfully by the producer and are never delivered to the consumer. \r\n\r\n*Expected behaviour* : All messages should be delivered to the consumers.\r\n\r\n*Actual behaviour* : Some of the messages belonging to random groups get stuck in the queue until the consumer container is restarted.\r\n\r\n \r\n\r\nWe found a similar issue https://issues.apache.org/jira/browse/AMQ-4613 on your board reported long back without any activity. Could these be due to the same root cause?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Using dynamic scaling and message grouping feature together makes messages stuck","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smaiti","name":"smaiti","key":"smaiti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"subhajit maiti","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smaiti","name":"smaiti","key":"smaiti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"subhajit maiti","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7066/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3yrrz:"}}