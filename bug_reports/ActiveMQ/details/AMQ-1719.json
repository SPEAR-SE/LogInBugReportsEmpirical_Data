{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483350","self":"https://issues.apache.org/jira/rest/api/2/issue/12483350","key":"AMQ-1719","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-06-25T00:19:48.413+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Oct 07 10:52:40 UTC 2012","customfield_12310420":"84791","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_139010710396_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-10-07T10:52:40.003+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1719/watchers","watchCount":2,"isWatching":false},"created":"2008-05-12T12:47:29.629+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-10-07T10:52:40.021+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Have attached logs from websphere, activeMQ and also the content of the datadirectory for details of data state ( plus the smal program used to create the scenario).\n\n#1. Installed the resource adapter that came with ActiveMQ into the websperhe applicationserver and configured it to connect to external broker using failover.\n#2. Setup a JDBC XA datasource ( Oracle ) and JMS XA destination ( ActiveMQ ).\n#3. Created a small Message Driven bean that receives a JMS message that it tries to store in the database after which it sleeps for 5 secs. And deployed it to the WebSphere appserver.\n#4. Started the activemq broker without doing any modifications since the download and extract into the filesystem.\n#5. Started applicationserver. \n#6. Started publishing messages to the broker\n#7. As expected the Message driven bean received the messages one-by-one and processed them.\n#8. Used to ctrl-C on the broker to halt it in the middle of the processing. Resulting in a failed commit of XA transaction.\n#9. Waited a while and then started broker again.\n#10. Received Exception on client side and nothing more happened. \n\nException in thread \"ActiveMQ Transport: tcp://localhost/127.0.0.1:61616\" java.lang.NullPointerException\n    at org.apache.activemq.state.ConnectionStateTracker$RemoveTransactionAction.run(ConnectionStateTracker.java:84)\n    at org.apache.activemq.state.Tracked.onResponses(Tracked.java:31)\n    at org.apache.activemq.transport.failover.FailoverTransport$3.onCommand(FailoverTransport.java:148)\n    at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)\n    at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)\n    at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n    at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:196)\n    at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:183)\n    at java.lang.Thread.run(Thread.java:801)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461004","id":"12461004","filename":"ASF.LICENSE.NOT.GRANTED--apache-activemq-5.1.0_data.tar.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johan.eke","name":"johan.eke","key":"johan.eke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johan Ekesparr","active":true,"timeZone":"Europe/Stockholm"},"created":"2008-05-12T12:47:29.633+0000","size":70226,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461004/ASF.LICENSE.NOT.GRANTED--apache-activemq-5.1.0_data.tar.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461047","id":"12461047","filename":"ASF.LICENSE.NOT.GRANTED--DemoEAR.ear","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johan.eke","name":"johan.eke","key":"johan.eke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johan Ekesparr","active":true,"timeZone":"Europe/Stockholm"},"created":"2008-05-12T12:47:29.635+0000","size":5094,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461047/ASF.LICENSE.NOT.GRANTED--DemoEAR.ear"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461103","id":"12461103","filename":"ASF.LICENSE.NOT.GRANTED--websphere_trace.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johan.eke","name":"johan.eke","key":"johan.eke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johan Ekesparr","active":true,"timeZone":"Europe/Stockholm"},"created":"2008-05-12T12:47:29.634+0000","size":100031,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461103/ASF.LICENSE.NOT.GRANTED--websphere_trace.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"32437","customfield_12312823":null,"summary":"Resource adapter stops consuming messages after broker is forcefully stopped/restarted during XA transaction.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johan.eke","name":"johan.eke","key":"johan.eke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johan Ekesparr","active":true,"timeZone":"Europe/Stockholm"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johan.eke","name":"johan.eke","key":"johan.eke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johan Ekesparr","active":true,"timeZone":"Europe/Stockholm"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP, IBM WebSphere 6.1.0.15, Oracle 10.2.0.3, Java 1.5.0 ( IBM J9 VM), ActiveMQ 5.1.0 downloaded 2008-May-12.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483350/comment/12939642","id":"12939642","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johan.eke","name":"johan.eke","key":"johan.eke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johan Ekesparr","active":true,"timeZone":"Europe/Stockholm"},"body":"Ooops! Should be WebSphere 6.1.0.11","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johan.eke","name":"johan.eke","key":"johan.eke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johan Ekesparr","active":true,"timeZone":"Europe/Stockholm"},"created":"2008-05-12T12:49:55.937+0000","updated":"2008-05-12T12:49:55.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483350/comment/12939884","id":"12939884","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"body":"We are getting a similar exception thrown occasionally during our stress tests. Exception happens on start up of some of our consumers. I am working on some reproduction code now but stack trace looks like this:\n{noformat} \nException in thread \"ActiveMQ Transport: tcp://localhost/127.0.0.1:62616\" java.lang.NullPointerException\n        at org.apache.activemq.state.ConnectionStateTracker$RemoveTransactionAction.run(ConnectionStateTracker.java:84)\n        at org.apache.activemq.state.Tracked.onResponses(Tracked.java:31)\n        at org.apache.activemq.transport.failover.FailoverTransport$3.onCommand(FailoverTransport.java:148)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:196)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:183)\n        at java.lang.Thread.run(Unknown Source)\n{noformat} \nWe are using AMQ5.1, Jencks 2.1 on Windows XP SP2, Sun JDK1.6.03\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-25T00:19:48.413+0000","updated":"2008-06-25T00:19:48.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483350/comment/12939894","id":"12939894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"body":"The NullPointerException occurs at the last line of the 'run()' method of RemoveTransactionAction:\n\n\\\\\n{code:title=ConnectionStateTracker.java|borderStyle=solid}\n\n    private class RemoveTransactionAction implements Runnable {\n        private final TransactionInfo info;   \n\n        public RemoveTransactionAction(TransactionInfo info) {\n            this.info = info;\n        }\n\n        public void run() {\n            ConnectionId connectionId = info.getConnectionId();\n            ConnectionState cs = connectionStates.get(connectionId);\n            cs.removeTransactionState(info.getTransactionId());\n        }\n    }\n{code}\n\nApparently there is no ConnectionState for \"connectionId\" (anymore).\n\n\"removeTransactionState\" removes the TransactionState identified by \"transactionId\" from a local Map, but since ConnectionState does not exist anymore, this is bogus.\n\nThe NullPointerException itself is not a problem, but can be avoided by putting an \n\n   \"if (cs != null) {...}\"\n\naround the last statement.\n\nThe problem probably existed already.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-01T21:20:19.249+0000","updated":"2008-07-01T21:26:30.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483350/comment/13471195","id":"13471195","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"I looked in the latest code, and added a fix for the potential NPE.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-10-07T10:52:40.018+0000","updated":"2012-10-07T10:52:40.018+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1719/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i05wyn:"}}