{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483518","self":"https://issues.apache.org/jira/rest/api/2/issue/12483518","key":"AMQ-1762","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2008-07-21T09:51:06.826+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 09 13:46:42 UTC 2010","customfield_12310420":"95900","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_71557915729_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-09-09T13:46:42.140+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1762/watchers","watchCount":1,"isWatching":false},"created":"2008-06-03T08:34:46.411+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-09-09T13:46:42.090+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"As the postgres size for an int is limited to: 2147483647 you can easily reach that number on a loaded ActiveMQ server within weeks. This is very hard to nail issue, as you get an exception like: Batch entry 0 INSERT INTO ACTIVEMQ_MSGS(ID, MSGID_PROD, MSGID_SEQ, CONTAINER, EXPIRATION, MSG) VALUES (2152101302, ID:cnmacoll2.ms.de.cdip.net-2970-1212478745177-0:1397:1:1, 1, queue://CNMACollector_1000474_1000474, 0, <stream of 820 bytes>) was aborted.\n\nWhich gives you no clue about the real issue, so we searched for all kinds of issues around. \n\nHowever we figured out it was the ID column.\n\nNot sure if this happens on other plattforms too, but at least on all PostgreSQL versions.\n\nWhile checking this, someone should make sure that not the ID inside the java code will be the next issue.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461174","id":"12461174","filename":"PostgresqlJDBCAdapter.java.diff.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2008-09-25T19:11:22.123+0000","size":692,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461174/PostgresqlJDBCAdapter.java.diff.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172197","customfield_12312823":null,"summary":"Field Type for ID column on table activemq_msgs should be increased from integer to bigint for postgres","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=comdivisionys","name":"comdivisionys","key":"comdivisionys","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yves Sandfort","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=comdivisionys","name":"comdivisionys","key":"comdivisionys","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yves Sandfort","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux, with Postgres/EnterpriseDB","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483518/comment/12939975","id":"12939975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mlukica","name":"mlukica","key":"mlukica","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mario Lukica","active":true,"timeZone":"Etc/UTC"},"body":"I think the same problem exists in 4.1.2 with DerbyDB 10.1.1.0.\n\nHere is the stack trace:\n{noformat}\n WARN  [JournalMessageStore ] Message could not be added to long term store: Failed to broker message: ID:conn1-34774-1214943118671-4:888842:1:1:380 in container: SQL Exception: The resulting value is outside the range for the data type INTEGER.\njava.io.IOException: Failed to broker message: ID:mgw1-34774-1214943118671-4:888842:1:1:380 in container: SQL Exception: The resulting value is outside the range for the data type INTEGER.\n        at org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:31)\n        at org.apache.activemq.store.jdbc.JDBCMessageStore.addMessage(JDBCMessageStore.java:72)\n        at org.apache.activemq.store.journal.JournalMessageStore$3.execute(JournalMessageStore.java:260)\n        at org.apache.activemq.util.TransactionTemplate.run(TransactionTemplate.java:44)\n        at org.apache.activemq.store.journal.JournalMessageStore.checkpoint(JournalMessageStore.java:247)\n        at org.apache.activemq.store.journal.JournalMessageStore.checkpoint(JournalMessageStore.java:221)\n        at org.apache.activemq.store.journal.JournalPersistenceAdapter$4.call(JournalPersistenceAdapter.java:356)\n        at edu.emory.mathcs.backport.java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:306)\n        at edu.emory.mathcs.backport.java.util.concurrent.FutureTask.run(FutureTask.java:135)\n        at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1061)\n        at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:575)\n        at java.lang.Thread.run(Thread.java:595)\nCaused by: SQL Exception: The resulting value is outside the range for the data type INTEGER.\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedResultSet.noStateChangeException(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.setLong(Unknown Source)\n        at org.apache.activemq.store.jdbc.adapter.DefaultJDBCAdapter.doAddMessage(DefaultJDBCAdapter.java:170)\n        at org.apache.activemq.store.jdbc.JDBCMessageStore.addMessage(JDBCMessageStore.java:69)\n        ... 10 more\n{noformat}\n\nCause of the exception:\nDefaultJDBCAdapter.doAddMessage:\n    s.setLong(1,messageID.getBrokerSequenceId());\n\nIn this case error message explicitely points to INTEGER column range violation.\n\nMessage id ID:conn1-34774-1214943118671-4:888842:1:1:380 does not show brokerSequenceId, so I cannot verify it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mlukica","name":"mlukica","key":"mlukica","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mario Lukica","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-21T09:51:06.826+0000","updated":"2008-07-21T09:51:06.826+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483518/comment/12940252","id":"12940252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"body":"Attaching a patch to add a small change to the ID column type for PostgreSQL from INTEGER to BIGINT. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2008-09-25T19:11:22.193+0000","updated":"2008-09-25T19:11:22.193+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483518/comment/12940654","id":"12940654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pjagielski","name":"pjagielski","key":"pjagielski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Jagielski","active":true,"timeZone":"Etc/UTC"},"body":"Same exception on Servicemix 3.2.1 with ActiveMQ 4.1 and Derby 10.4.1.3:\n\njava.io.IOException: Failed to store acknowledgment for: atm on message ID:servicemix-64271-1228238657193-5:19:1:1:771 in container: java.sql.SQLException: The resulting value is outside the range for the data type INTEGER.\n        at org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:31)\n        at org.apache.activemq.store.jdbc.JDBCTopicMessageStore.acknowledge(JDBCTopicMessageStore.java:54)\n        at org.apache.activemq.store.journal.JournalTopicMessageStore$2.execute(JournalTopicMessageStore.java:170)\n        at org.apache.activemq.store.journal.JournalMessageStore$3.execute(JournalMessageStore.java:293)\n        at org.apache.activemq.util.TransactionTemplate.run(TransactionTemplate.java:44)\n        at org.apache.activemq.store.journal.JournalMessageStore.checkpoint(JournalMessageStore.java:247)\n        at org.apache.activemq.store.journal.JournalTopicMessageStore.checkpoint(JournalTopicMessageStore.java:162)\n        at org.apache.activemq.store.journal.JournalPersistenceAdapter$5.call(JournalPersistenceAdapter.java:373)\n        at edu.emory.mathcs.backport.java.util.concurrent.FutureTask.run(FutureTask.java:176)\n        ... 3 more\nCaused by:\njava.sql.SQLException: The resulting value is outside the range for the data type INTEGER.\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedResultSet.noStateChangeException(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.setLong(Unknown Source)\n        at org.apache.activemq.store.jdbc.adapter.DefaultJDBCAdapter.doSetLastAck(DefaultJDBCAdapter.java:324)\n        at org.apache.activemq.store.jdbc.JDBCTopicMessageStore.acknowledge(JDBCTopicMessageStore.java:51)\n        ... 10 more","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pjagielski","name":"pjagielski","key":"pjagielski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Jagielski","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-13T11:35:16.778+0000","updated":"2009-01-13T11:35:16.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483518/comment/12942854","id":"12942854","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=menulis","name":"menulis","key":"menulis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dziugas Baltrunas","active":true,"timeZone":"Etc/UTC"},"body":"Was this issue fixed in any of 4.1.X or 5.X tree? For systems with some 200 msg / sec throughput, INTEGER reaches it's boundary in few months, so I believe this problem affects quite a lot of heavy users. Our workaround was to ALTER TABLE.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=menulis","name":"menulis","key":"menulis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dziugas Baltrunas","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-07T08:59:15.806+0000","updated":"2010-09-07T08:59:15.806+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483518/comment/12942889","id":"12942889","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"This has been fixed for 5.3.0, see https://issues.apache.org/activemq/browse/AMQ-2291 for more details","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-09-09T13:46:42.081+0000","updated":"2010-09-09T13:46:42.081+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1762/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tu67:"}}