{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13201770","self":"https://issues.apache.org/jira/rest/api/2/issue/13201770","key":"AMQ-7118","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341032","id":"12341032","name":"5.16.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12344359","id":"12344359","description":"","name":"5.15.8","archived":false,"released":true,"releaseDate":"2018-11-19"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-12-02T11:33:16.098+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jan 08 00:10:15 UTC 2019","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_304674892_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-12-04T16:34:54.760+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7118/watchers","watchCount":6,"isWatching":false},"created":"2018-12-01T03:56:59.894+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341032","id":"12341032","name":"5.16.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12344359","id":"12344359","description":"","name":"5.15.8","archived":false,"released":true,"releaseDate":"2018-11-19"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2019-01-08T00:10:15.421+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325017","id":"12325017","name":"KahaDB"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"KahaDB store limit can be exceeded with durable subscribers.\r\n\r\nAMQ with store limit set, we can observe that the usage continues to increase AFTER PFC is engaged. Given time, this growth stabilizes. The issue of having exceeded the store limit remains.\r\n\r\nSee below output from KahaDB dump in attachments:\r\n\r\nThis appears to be caused by checkpointAckMessageFileMap. The log files are not GC'd, and the KAHA_ACK_MESSAGE_FILE_MAP_COMMAND is replicated and the DB log files continue to expand - this can become exponential. Side effect of also not checking storage size in checkpoint update can cause the DB log files to exceed any set limits. The real critical part is the duplicated and leaking Kaha messages which appears to happen with durable subscribers.\r\n\r\n \r\n\r\n \r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12950267","id":"12950267","filename":"kahaCommands.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-12-01T03:58:39.778+0000","size":2019545,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12950267/kahaCommands.jpg"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"KahaDB store limit can be exceeded with durable subscribers.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"JDK 8","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16706200","id":"16706200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user heathkesler opened a pull request:\n\n    https://github.com/apache/activemq/pull/326\n\n    AMQ-7118: fix issue with the unchanged acknowledgement map.\n\n    If the kahadb ack message file map has not changed, then there is no reason to write it again.  So all the kahadb store tests and activemq unit test suite pass. \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/heathkesler/activemq AMQ7118-ack\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/326.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #326\n    \n----\ncommit 7dfecde307e61420b179ed54540953132371d278\nAuthor: hkesler <hkesler@...>\nDate:   2018-12-02T03:34:31Z\n\n    AMQ-7118: fix the issue with the unchanged ack continues to get written to the data files\n\ncommit 5f4fc0793cec914b8990a567f5fdc48fd2aeb9c8\nAuthor: hkesler <hkesler@...>\nDate:   2018-12-02T03:36:04Z\n\n    remove merge file\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-02T11:33:16.098+0000","updated":"2018-12-02T11:33:16.098+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16706366","id":"16706366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heathkesler","name":"heathkesler","key":"heathkesler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Kesler","active":true,"timeZone":"Etc/UTC"},"body":"Yeah, I noticed the same thing, the ackMessageFileMapLocation gets written on every checkpoint, even if it hasnt changed.  I think it should only be written when the file map has changed.  I have attached a PR that does just that and it seems to work great.  It has a unit test and I have run all the unit tests and they pass.  Please let me know what you think or if I should change anything.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heathkesler","name":"heathkesler","key":"heathkesler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Kesler","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-02T15:52:41.484+0000","updated":"2018-12-02T15:52:41.484+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16706371","id":"16706371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"To close the loop from IRC chat:\r\n\r\nHeath, this looks good, but I would use AtomicBoolen with lazySet may be a bit cleaner for this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-12-02T16:10:36.818+0000","updated":"2018-12-02T16:10:36.818+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16706373","id":"16706373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user heathkesler opened a pull request:\n\n    https://github.com/apache/activemq/pull/327\n\n    AMQ-7118: fix issue where the ackMessageFileMapLocation gets written on every checkpoint\n\n     fix issue where the ackMessageFileMapLocation gets written on every checkpoint, even if it hasnt changed and include the use of the Atomic boolean.  \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/heathkesler/activemq AMQ7118-map\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/327.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #327\n    \n----\ncommit 5c08df663de650870d4e4b3f940d7838af96d188\nAuthor: hkesler <hkesler@...>\nDate:   2018-12-02T16:17:40Z\n\n    AMQ-7118: fix issue where the ackMessageFileMapLocation gets written on every checkpoint, even if it hasnt changed and include the use of the Atomic boolean\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-02T16:20:51.359+0000","updated":"2018-12-02T16:20:51.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16706375","id":"16706375","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heathkesler","name":"heathkesler","key":"heathkesler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Kesler","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Jamie for the feedback, I updated the code accordingly. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heathkesler","name":"heathkesler","key":"heathkesler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Kesler","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-02T16:23:59.481+0000","updated":"2018-12-02T16:23:59.481+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16706385","id":"16706385","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"Thanks Heath!  This looks really great.  [~gtully], can you take a gander as well?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-12-02T16:37:19.853+0000","updated":"2018-12-02T16:37:19.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16706940","id":"16706940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~heathkesler] verify that the logic around https://github.com/apache/activemq/blob/master/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java#L1916 still holds. \r\nThat code is tracking modifications to trigger a checkpoint that expects that map to be unconditionally stored.\r\n\r\nsmall note; very often the xml config is not necessary (the broker can be programmatically configure)  and the use of 61616 port can be avoided in favour of the vm transport. It makes the unit test tidier and more self contained and could lead to them being run in parallel. \r\nIn any event, it is great to see a matching test that will protect this change.\r\n.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-03T10:16:28.948+0000","updated":"2018-12-03T10:16:28.948+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16707268","id":"16707268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heathkesler","name":"heathkesler","key":"heathkesler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Kesler","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~gtully], \r\n\r\nThanks for the feedback.  I did indeed verify by breakpoint that it hits the mandatory write on 1948 and the flag is set.  The test reads out all the messages… it hits that code in checkpoint pass #4 in my test.  Are you seeing anything different?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heathkesler","name":"heathkesler","key":"heathkesler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Kesler","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-03T14:25:27.330+0000","updated":"2018-12-03T15:53:04.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16708949","id":"16708949","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit d816b738af33ac2b94e2ef6ba0d3085c7eb32728 in activemq's branch refs/heads/activemq-5.15.x from jgoodyear\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=d816b73 ]\n\nAMQ-7118 This closes #327 - with thanks to Heath Kesler\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-04T16:22:11.735+0000","updated":"2018-12-04T16:22:11.735+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16708959","id":"16708959","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 612d4aeeb4025d62f75a301a655112b6e53c7170 in activemq's branch refs/heads/master from jgoodyear\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=612d4ae ]\n\nAMQ-7118 This closes #327 - with thanks to Heath Kesler\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-04T16:30:34.715+0000","updated":"2018-12-04T16:30:34.715+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16708960","id":"16708960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/activemq/pull/327\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-04T16:30:57.757+0000","updated":"2018-12-04T16:30:57.757+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16708964","id":"16708964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"Thank you [~heathkesler] for the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-12-04T16:34:54.780+0000","updated":"2018-12-04T16:34:54.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16735041","id":"16735041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"The Unit test `testCompaction` seems to be failing on master.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-05T23:19:06.392+0000","updated":"2019-01-05T23:19:06.392+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16735223","id":"16735223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"{{I've pulled latest on Master and built locally:}}\r\n\r\n{{-------------------------------------------------------}}\r\n {{ T E S T S}}\r\n {{-------------------------------------------------------}}\r\n {{Running org.apache.activemq.bugs.AMQ7118Test}}\r\n {{Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 22.474 sec - in org.apache.activemq.bugs.AMQ7118Test}}\r\n\r\n{{Results :}}\r\n\r\n{{Tests run: 1, Failures: 0, Errors: 0, Skipped: 0}}\r\n\r\n{{Can you please supply more information on your environment? }}\r\n\r\n{{I've also run the kahadb store tests as well:}}\r\n\r\n{{Results :}}\r\n\r\n{{Tests run: 140, Failures: 0, Errors: 0, Skipped: 1}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2019-01-06T16:42:47.141+0000","updated":"2019-01-06T16:43:29.637+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16735270","id":"16735270","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"I think I just found the problem...\r\n\r\nThe test is relying in the size of the hostname of your host...\r\n\r\nEx (long hostname):\r\n\r\nsudo hostname hostnamehostnamehostname\r\n\r\nRunning org.apache.activemq.bugs.AMQ7118Test\r\n Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 2.483 sec <<< FAILURE! - in org.apache.activemq.bugs.AMQ7118Test\r\n testCompaction(org.apache.activemq.bugs.AMQ7118Test) Time elapsed: 2.094 sec <<< FAILURE!\r\n java.lang.AssertionError: expected:<21> but was:<22>\r\n at org.junit.Assert.fail(Assert.java:88)\r\n at org.junit.Assert.failNotEquals(Assert.java:834)\r\n at org.junit.Assert.assertEquals(Assert.java:645)\r\n at org.junit.Assert.assertEquals(Assert.java:631)\r\n at org.apache.activemq.bugs.AMQ7118Test.checkFiles(AMQ7118Test.java:193)\r\n at org.apache.activemq.bugs.AMQ7118Test.testCompaction(AMQ7118Test.java:116)\r\n\r\n \r\n\r\nEx (short hostname):\r\n\r\nsudo hostname hostname\r\n\r\nRunning org.apache.activemq.bugs.AMQ7118Test\r\n Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 15.718 sec <<< FAILURE! - in org.apache.activemq.bugs.AMQ7118Test\r\n testCompaction(org.apache.activemq.bugs.AMQ7118Test) Time elapsed: 15.372 sec <<< FAILURE!\r\n org.junit.ComparisonFailure: expected:<db-3[3].log> but was:<db-3[0].log>\r\n at org.junit.Assert.assertEquals(Assert.java:115)\r\n at org.junit.Assert.assertEquals(Assert.java:144)\r\n at org.apache.activemq.bugs.AMQ7118Test.checkFiles(AMQ7118Test.java:194)\r\n at org.apache.activemq.bugs.AMQ7118Test.testCompaction(AMQ7118Test.java:135)\r\n\r\n \r\n\r\nBut the test runs successfully if the hostname is set to \"hostnamehostname\"\r\n\r\nsudo hostname hostnamehostname\r\n\r\n-------------------------------------------------------\r\n T E S T S\r\n -------------------------------------------------------\r\n Running org.apache.activemq.bugs.AMQ7118Test\r\n Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 23.281 sec - in org.apache.activemq.bugs.AMQ7118Test\r\n\r\nResults :\r\n\r\nTests run: 1, Failures: 0, Errors: 0, Skipped: 0\r\n\r\n \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-06T18:12:44.442+0000","updated":"2019-01-06T18:47:56.693+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16736168","id":"16736168","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"Just to clarify, the hostname is changing the message ID and so, changing the number of journal files..\r\n\r\n \r\n\r\nCommandType: KAHA_ADD_MESSAGE_COMMAND - TOPIC (DestId: 1:test), MsgId: ID:hostnamehostname-61683-1546886442069-4:2:1:1:1.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-07T18:41:21.991+0000","updated":"2019-01-07T18:41:21.991+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16736506","id":"16736506","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit a2dccbf8431b881fc95f63a41ce4deb4ae476304 in activemq's branch refs/heads/activemq-5.15.x from Jeff Genender\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=a2dccbf ]\n\nAMQ-7118 - Override hostname for naming to allow tests to apss on all\nplatforms\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-08T00:04:41.136+0000","updated":"2019-01-08T00:04:41.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13201770/comment/16736511","id":"16736511","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 273afef47c9fef5258cc297ae7353b705db3efb6 in activemq's branch refs/heads/master from Jeff Genender\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=273afef ]\n\nAMQ-7118 - Override hostname for naming to allow tests to apss on all\nplatforms\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-08T00:10:15.421+0000","updated":"2019-01-08T00:10:15.421+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7118/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|s012g0:"}}