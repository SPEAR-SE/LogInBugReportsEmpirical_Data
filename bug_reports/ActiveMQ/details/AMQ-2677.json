{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483268","self":"https://issues.apache.org/jira/rest/api/2/issue/12483268","key":"AMQ-2677","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-31T11:52:36.703+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 31 11:52:36 UTC 2010","customfield_12310420":"74849","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_330933177_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-03-31T11:52:36.732+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2677/watchers","watchCount":0,"isWatching":false},"created":"2010-03-27T15:57:03.555+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315621","id":"12315621","description":"","name":"5.3.1","archived":false,"released":true,"releaseDate":"2010-03-23"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-03-31T11:52:36.718+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"If org.apache.activemq.pool.ConnectionPool.start throws a JMSException, the \"started\" flag in ConnectionPool should not be set to true.  If start() throws an exception, the underlying ActiveMQConnection object will not be started.  Since started=true, any subsequent calls to ConnectionPool.start will do nothing, and a non-started connection may be used by the pool.\n\nI ran into this problem when using Camel to consume messages - see the attached test program for an example.  This test program does the following:\n\n1. Starts a bean consuming from queue test.queue using Camel.  The URL used by Camel to connect to ActiveMQ is:\n\nfailover:(tcp://127.0.0.1:61616)?timeout=1000&initialReconnectDelay=1000&maxReconnectDelay=1000&useExponentialBackOff=false\n\nThe test program uses the default behavior of Camel's ActiveMQComponent which creates a PooledConnectionFactory.\n\n2. Waits 10 seconds, then starts an ActiveMQ broker on port 61616.  During this wait time, Camel's connection to the broker fails every second and it is continually retrying.\n\n3. Sends 10 messages to the queue \"test.queue\".\n\nThe call to ConnectionPool.start by camel throws an exception after blocking for 1 second since timeout=1000 is set in the URL.  However the \"started\" flag is set to true, so subsequent calls to ConnectionPool.start by Camel on connection retries do not restart the ActiveMQConnection.\n\nSo, after step 3 in the test the Camel consumer appears to be connected to the broker, but it does not receive any messages and I get the following warning:\n\n2010-03-27 09:47:02,994 [ActiveMQ Transport: tcp:///127.0.0.1:61616] WARN  org.apache.activemq.ActiveMQSessionExecutor - Received a message on a connection which is not yet started. Have you forgotten to call Connection.start()?\n\nI am attaching a patch to org.apache.activemq.pool.ConnectionPool that does not set started=true if start throws an exception.  This fixes my test program - now each connection retry by camel actually attempts to start the ActiveMQConnection.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461607","id":"12461607","filename":"connection_pool_start.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ariekenb","name":"ariekenb","key":"ariekenb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Riekenberg","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-27T15:59:10.270+0000","size":1286,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461607/connection_pool_start.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461606","id":"12461606","filename":"jmstest.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ariekenb","name":"ariekenb","key":"ariekenb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Riekenberg","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-27T15:58:20.696+0000","size":5029,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461606/jmstest.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"159934","customfield_12312823":null,"summary":"org.apache.activemq.pool.ConnectionPool should not set \"started\" flag if start() throws an exception","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ariekenb","name":"ariekenb","key":"ariekenb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Riekenberg","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ariekenb","name":"ariekenb","key":"ariekenb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Riekenberg","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Ubuntu Linux 9.10, Sun JDK 1.6.0_15","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483268/comment/12942280","id":"12942280","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ariekenb","name":"ariekenb","key":"ariekenb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Riekenberg","active":true,"timeZone":"Etc/UTC"},"body":"Test program showing issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ariekenb","name":"ariekenb","key":"ariekenb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Riekenberg","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-27T15:58:20.808+0000","updated":"2010-03-27T15:58:20.808+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483268/comment/12942282","id":"12942282","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ariekenb","name":"ariekenb","key":"ariekenb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Riekenberg","active":true,"timeZone":"Etc/UTC"},"body":"Attaching patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ariekenb","name":"ariekenb","key":"ariekenb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Riekenberg","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-27T15:59:10.348+0000","updated":"2010-03-27T15:59:10.348+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483268/comment/12942046","id":"12942046","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"This should be fixed with svn revision 929488. I also added modified test to system tests. Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-31T11:52:36.703+0000","updated":"2010-03-31T11:52:36.703+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2677/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rqhb:"}}