{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482995","self":"https://issues.apache.org/jira/rest/api/2/issue/12482995","key":"AMQ-1831","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2009-08-29T06:52:04.557+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri May 24 09:34:23 UTC 2013","customfield_12310420":"68213","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_36688901552_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-08-29T06:52:04.577+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1831/watchers","watchCount":2,"isWatching":false},"created":"2008-06-30T15:30:23.025+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-24T09:34:23.748+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"A  java.lang.NumberFormatException is thrown when attempting to retrieve the JMSXProducerTXID from a message. The stack trace is:\n\nException in thread \"main\" java.lang.NumberFormatException: For input string: \"TX:ID:JTURKEL-690-4629-1214839585805-0:0:1\"\n\tat java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)\n\tat java.lang.Integer.parseInt(Integer.java:447)\n\tat java.lang.Integer.<init>(Integer.java:620)\n\tat org.apache.activemq.filter.PropertyExpression$14.evaluate(PropertyExpression.java:147)\n\tat org.apache.activemq.filter.PropertyExpression.evaluate(PropertyExpression.java:194)\n\tat org.apache.activemq.command.ActiveMQMessage.getObjectProperty(ActiveMQMessage.java:447)\n\tat org.apache.activemq.command.ActiveMQMessage.getStringProperty(ActiveMQMessage.java:535)\n\tat com.queue.test.MQTest.testBug(MQTest.java:41)\n\tat com.queue.test.ActiveMQTest.main(ActiveMQTest.java:21)\n\nHere is some simple test code to reproduce the problem:\n\n\t\tConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ActiveMQConnection.DEFAULT_USER, \n\t\t\t\tActiveMQConnection.DEFAULT_PASSWORD, ActiveMQConnection.DEFAULT_BROKER_URL)\n\t\tConnection connection = connectionFactory.createConnection();\t\t\n\t\tconnection.start();\n\t\tSession producerSession = connection.createSession(true, Session.SESSION_TRANSACTED);\n\t\tMessageProducer producer = producerSession.createProducer(producerSession.createQueue(\"myQueue\"));\n\t\tTextMessage producerMessage = producerSession.createTextMessage(\"Test Message\");\n\t\tproducer.send(producerMessage);\n\t\tproducer.close();\n\t\tproducerSession.commit();\n\t\tproducerSession.close();\n\t\t\n\t\tSession consumerSession = connection.createSession(true, Session.SESSION_TRANSACTED);\n\t\tMessageConsumer consumer = consumerSession.createConsumer(consumerSession.createQueue(\"myQueue\"));\n\t\tMessage consumerMessage = consumer.receive(1000);\n\t\tSystem.out.println(consumerMessage.getStringProperty(\"JMSXProducerTXID\"));\n\t\tconsumer.close();\n\t\tconsumerSession.commit();\n\t\tconsumerSession.close();\n\n\t\tconnection.close();\n\nThis problem is quite severe for us since we need the transaction id property and would like to certify against ActiveMQ.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"255154","customfield_12312823":null,"summary":"Message.getStringProperty(\"JMSXProducerTXID\") throws java.lang.NumberFormatException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel_turkel","name":"joel_turkel","key":"joel_turkel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Turkel","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel_turkel","name":"joel_turkel","key":"joel_turkel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Turkel","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP SP2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482995/comment/12941724","id":"12941724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"This should be set be the messaging provider - its not meant to be set by the application","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-29T06:52:04.557+0000","updated":"2009-08-29T06:52:04.557+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482995/comment/13064463","id":"13064463","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=angelo.rosenfelder","name":"angelo.rosenfelder","key":"angelo.rosenfelder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angelo Rosenfelder","active":true,"timeZone":"Etc/UTC"},"body":"Sorry to resurrect such an old issue, but I think there is a bug in the implementation: The JMS Specification Version 1.1 defines the property {{JMSXProducerTXID}} of type {{String}}. But the code in ActiveMQ tries to parse it as {{int}}:\n{{org.apache.activemq.filter.PropertyExpression}}\n{noformat}\n        JMS_PROPERTY_EXPRESSIONS.put(\"JMSXProducerTXID\", new SubExpression() {\n\n            public Object evaluate(Message message) {\n                TransactionId txId = message.getOriginalTransactionId();\n                if (txId == null) {\n                    txId = message.getTransactionId();\n                }\n                if (txId == null) {\n                    return null;\n                }\n                return new Integer(txId.toString());\n            }\n        });\n{noformat}\n\nWhen sending a message for example using HermesJMS, I get a NumberFormatException while reading the property {{JMSXProducerTXID}} in my client code (code is similar to the original poster's one).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=angelo.rosenfelder","name":"angelo.rosenfelder","key":"angelo.rosenfelder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angelo Rosenfelder","active":true,"timeZone":"Etc/UTC"},"created":"2011-07-13T10:06:27.614+0000","updated":"2011-07-13T10:06:27.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482995/comment/13666157","id":"13666157","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbrys","name":"nbrys","key":"nbrys","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nico Brys","active":true,"timeZone":"Etc/UTC"},"body":"This issue should be reopened! We just the method message.getStringProperty(\"JMSXProducerTXID\") and we also get a NumberFormatException. We don't set this property manually on the message! It's activeMQ who does this. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbrys","name":"nbrys","key":"nbrys","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nico Brys","active":true,"timeZone":"Etc/UTC"},"created":"2013-05-24T09:34:23.748+0000","updated":"2013-05-24T09:34:23.748+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1831/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i18267:"}}