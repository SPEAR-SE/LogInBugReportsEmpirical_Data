{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483155","self":"https://issues.apache.org/jira/rest/api/2/issue/12483155","key":"AMQ-1437","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-10-03T14:30:34.717+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 20 18:09:54 UTC 2009","customfield_12310420":"95784","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_67744506854_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-11-20T18:09:54.971+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1437/watchers","watchCount":8,"isWatching":false},"created":"2007-09-28T16:14:48.117+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12335008","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335008","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12483144","key":"AMQ-2166","self":"https://issues.apache.org/jira/rest/api/2/issue/12483144","fields":{"summary":"MemoryLeak in the ResourceAdapter (ManagedConnectionProxy)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-11-20T18:09:54.930+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I think it is a memory leak that calling close() on a org.apache.activemq.ra.ManagedSessionProxy does not remove it from the session list of the org.apache.activemq.ra.ManagedConnectionProxy that created it.  Some programs (like mine) run on a Jboss bean thats generating messages every few seconds and I like to keep a Connection open to ActiveMQ and create a new session for each new batch of messages.  When I close these sessions (which are really ManagedSessionProxy's), the actual ActiveMQSession wrapped inside closes but a lot of its data remains referenced inside it.   Also, the reference to the ManagedSessionProxy stays in the ManagedConnectionProxy's session list.  So since the ManagedSessionProxy has to stay in the ManagedConnectionproxy's session list, it stays in memory and so does the ActiveMQSession, and so all these sessions (thousands of them) stay in memory until the ManagedConnectionProxy is closed which my program only calls when the server shuts down.\n\nTo generate this, create a simple message producing program that uses the resource adaptor's ActiveMQConnectionFactory to generate one connection.  Then run a loop that creates a session on that connection, sends a message or two, and closes the session.  May need to run this loop at least 100 times appreciate what I'm saying and how quickly it affects things.\n\nI think this will be a simple fix and hopefully will be resolved soon.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461152","id":"12461152","filename":"mem-histo.2008.10.03.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikoblik","name":"ikoblik","key":"ikoblik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Koblik","active":true,"timeZone":"Europe/Berlin"},"created":"2008-10-03T14:30:34.650+0000","size":255359,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461152/mem-histo.2008.10.03.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"171941","customfield_12312823":null,"summary":"Memory Leak in Resource Adapator?","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbuberl","name":"sbuberl","key":"sbuberl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Buberl","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbuberl","name":"sbuberl","key":"sbuberl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Buberl","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Ran on ActiveMQ 4.1.1 but ActiveMQ 5.0's code is the same\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483155/comment/12939108","id":"12939108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbuberl","name":"sbuberl","key":"sbuberl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Buberl","active":true,"timeZone":"America/New_York"},"body":"In hopes of providing some evidence and encouragement, I'm posted a memory snapshot of the top 24 ActiveMQ classes by the amount of memory all its live objects take up.  The server is a Jboss server that uses ActiveMQ for all its messaging, and the server has been runing for 6 days straight.  Its sorted by total size of all reachable/live objects of the class to show you how much higher the count and total memory size of the top tier are from the rest.\n\n{quote}\n        Count  ... Total Size ... Class\n\n\t37189 ... 2360k ... org.apache.activemq.management.CountStatisticImpl\n\t\n\t18596 ... 1616k ... org.apache.activemq.management.TimeStatisticImpl\n\t\n\t9295 .... 1098k ... org.apache.activemq.management.JMSSessionStatsImpl\n\t\n\t9295 .... 1080k ... org.apache.activemq.ActiveMQSession\n\t\n\t27945 ... 436k .... org.apache.activemq.util.LongSequenceGenerator\n\t\n\t9307 .... 399k .... org.apache.activemq.command.SessionId\n\t\n\t9295 .... 335k .... org.apache.activemq.command.SessionInfo\n\t\n\t9295 .... 299k .... org.apache.activemq.ActiveMQSessionExecutor\n\t\n\t9295 .... 236k .... org.apache.activemq.MessageDispatchChannel\n\t\n\t3836 .... 194k .... org.apache.activemq.command.ProducerId\n\t\n\t9278 .... 154k .... org.apache.activemq.ra.ManagedSessionProxy\n\t\n\t24 ...... 96k ..... org.apache.activemq.command.DataStructure[]\n\t\n\t922 ..... 28k ..... org.apache.activemq.command.XATransactionId\n\t\n\t76 ...... 19k ..... org.apache.activemq.command.ActiveMQTextMessage\n\t\n\t76 ...... 6k ...... org.apache.activemq.command.MessageDispatch\n\t\n\t160 ..... 3k ...... org.apache.activemq.util.ByteSequence\n\t\n\t76 ...... 3k ...... org.apache.activemq.command.MessageId\n\t\n\t12 ...... 3k ...... org.apache.activemq.ActiveMQConnection\n\t\n\t12 ...... 1k ...... org.apache.activemq.transport.tcp.TcpTransport\n\t\n\t31 ...... 1k ...... org.apache.activemq.command.ActiveMQTopic\n\t\n\t28 ...... 1k ...... org.apache.activemq.command.ConsumerId\n\t\n\t14 ...... 1k ...... org.apache.activemq.command.ConsumerInfo\n\t\n\t21 ...... 1k ...... org.apache.activemq.TransactionContext\n{quote}\n\nAnd I'd like to note at any given time, on my server there are only about 15 ActiveMQSessions being used by the beans at a time but 9000 more along with all their stats and ids are stuck in memory too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbuberl","name":"sbuberl","key":"sbuberl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Buberl","active":true,"timeZone":"America/New_York"},"created":"2007-10-08T20:57:42.128+0000","updated":"2007-10-08T20:57:42.128+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483155/comment/12940300","id":"12940300","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikoblik","name":"ikoblik","key":"ikoblik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Koblik","active":true,"timeZone":"Europe/Berlin"},"body":"We seem to have same problem. Complete memory histogram is attached to the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikoblik","name":"ikoblik","key":"ikoblik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Koblik","active":true,"timeZone":"Europe/Berlin"},"created":"2008-10-03T14:30:34.717+0000","updated":"2008-10-03T14:30:51.730+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483155/comment/12940395","id":"12940395","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikoblik","name":"ikoblik","key":"ikoblik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Koblik","active":true,"timeZone":"Europe/Berlin"},"body":"It looks like we didn't use sessions right. We were opening them but not closing afterwards, it was OK when we had a new connection per message, but as soon as we moved to the single connection factory, memory leak became apparent.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikoblik","name":"ikoblik","key":"ikoblik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Koblik","active":true,"timeZone":"Europe/Berlin"},"created":"2008-10-27T12:32:36.928+0000","updated":"2008-10-27T12:32:36.928+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483155/comment/12941695","id":"12941695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=msiegenthaler","name":"msiegenthaler","key":"msiegenthaler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mario Siegenthaler","active":true,"timeZone":"Etc/UTC"},"body":"Duplicate of AMQ-2166 (contains a fix)\n\nActually mine was the duplicate of this (didn't find it then, I appologize)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=msiegenthaler","name":"msiegenthaler","key":"msiegenthaler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mario Siegenthaler","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-06T15:26:08.624+0000","updated":"2009-07-06T15:26:08.624+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483155/comment/12941783","id":"12941783","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"body":"Fixed by AMQ-2166","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2009-11-20T18:09:54.846+0000","updated":"2009-11-20T18:09:54.846+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1437/votes","votes":13,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tslb:"}}