{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12648486","self":"https://issues.apache.org/jira/rest/api/2/issue/12648486","key":"AMQ-4546","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2013-05-20T19:10:39.685+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 15 21:39:20 UTC 2013","customfield_12310420":"328841","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_7526413836_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-08-15T21:39:20.554+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4546/watchers","watchCount":3,"isWatching":false},"created":"2013-05-20T18:59:06.763+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-08-15T21:39:20.588+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Received a null pointer exception after restarting activemq broker (embedded).\n\nFirst few messages are ok, then this happens and the broker (using network connector) starts to fail indicating remote exceptions.\n\n[//fathom1.win-fiaflosoa0a#43-1] Service                        DEBUG Error occured while processing sync command: Consu\nmerInfo {commandId = 4, responseRequired = true, consumerId = ID:WIN-FIAFLOSOA0A-55945-1369075855975-4:22:1:1, destinati\non = queue://fathom1.win-fiaflosoa0a, prefetchSize = 1, maximumPendingMessageLimit = 0, browser = false, dispatchAsync =\n true, selector = null, subscriptionName = null, noLocal = false, exclusive = false, retroactive = false, priority = 0,\nbrokerPath = null, optimizedAcknowledge = false, noRangeAcks = false, additionalPredicate = null}, exception: java.lang.\nNullPointerException\njava.lang.NullPointerException\n        at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.getMessageCount(KahaDBStore.java:478)\n        at org.apache.activemq.store.ProxyMessageStore.getMessageCount(ProxyMessageStore.java:101)\n        at org.apache.activemq.broker.region.Queue.initialize(Queue.java:376)\n        at org.apache.activemq.broker.region.DestinationFactoryImpl.createDestination(DestinationFactoryImpl.java:87)\n        at org.apache.activemq.broker.region.AbstractRegion.createDestination(AbstractRegion.java:526)\n        at org.apache.activemq.broker.region.AbstractRegion.addDestination(AbstractRegion.java:136)\n        at org.apache.activemq.broker.region.RegionBroker.addDestination(RegionBroker.java:277)\n        at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:145)\n        at org.apache.activemq.advisory.AdvisoryBroker.addDestination(AdvisoryBroker.java:174)\n        at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:145)\n        at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:145)\n        at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:145)\n        at org.apache.activemq.broker.MutableBrokerFilter.addDestination(MutableBrokerFilter.java:151)\n        at org.apache.activemq.broker.region.AbstractRegion.lookup(AbstractRegion.java:452)\n        at org.apache.activemq.broker.region.AbstractRegion.addConsumer(AbstractRegion.java:265)\n        at org.apache.activemq.broker.region.RegionBroker.addConsumer(RegionBroker.java:353)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:89)\n        at org.apache.activemq.advisory.AdvisoryBroker.addConsumer(AdvisoryBroker.java:91)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:89)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:89)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:89)\n        at org.apache.activemq.broker.MutableBrokerFilter.addConsumer(MutableBrokerFilter.java:95)\n        at org.apache.activemq.broker.TransportConnection.processAddConsumer(TransportConnection.java:619)\n        at org.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:332)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:329)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:184)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n        at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:241)\n        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:129)\n        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:47)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:722)\n[                     Thread-12] DefaultComponent               DEBUG Creating endpoint uri=[jms://topic:progress.opened\nge.management.notification.fathom1.win-fiaflosoa0a], path=[topic:progress.openedge.management.notification.fathom1.win-f\niaflosoa0a], parameters=[{}]\n[                     Thread-12] DefaultCamelContext            DEBUG jms://topic:progress.openedge.management.notificat\nion.fathom1.win-fiaflosoa0a converted to endpoint: Endpoint[jms://topic:progress.openedge.management.notification.fathom\n1.win-fiaflosoa0a] by component: org.apache.activemq.camel.component.ActiveMQComponent@1b880ae\n[l Thread #8 - ProducerTemplate] ProducerCache                  DEBUG >>>> Endpoint[jms://topic:progress.openedge.manage\nment.notification.fathom1.win-fiaflosoa0a] Exchange[Message: Remote Event [fathom1.win-fiaflosoa0a:ID=Database applicati\non.state.EServerGroupStateChanged {isShuttingDown=false, isStartable=false, affectedObject=defaultServerGroup, isStartin\ng=true, isStoppable=false, isInitializing=false, stateDescriptor=Starting, isIdle=false, isRunning=false}]]\n[                     Thread-12] DefaultComponent               DEBUG Creating endpoint uri=[jms://topic:progress.opened\nge.management.notification.fathom1.win-fiaflosoa0a], path=[topic:progress.openedge.management.notification.fathom1.win-f\niaflosoa0a], parameters=[{}]\n\n\n\nError from remote broker:\n\n[a0a/192.168.232.128:6835@62013] DemandForwardingBridgeSupport  WARN  Network connection between vm://fathom1.nbbedmbaker2#62 and tcp://win-fiaflosoa0a/192.168.232.128:6835@62013 shutdown due to a remote error: java.io.IOException: ShutdownInfo {commandId = 615, responseRequired = false}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"329183","customfield_12312823":null,"summary":"kahadbstore nullpointerexception after restart","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zerovian","name":"zerovian","key":"zerovian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Baker","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zerovian","name":"zerovian","key":"zerovian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Baker","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648486/comment/13662292","id":"13662292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ceposta","name":"ceposta","key":"ceposta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ceposta&avatarId=15051","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ceposta&avatarId=15051","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ceposta&avatarId=15051","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ceposta&avatarId=15051"},"displayName":"Christian Posta","active":true,"timeZone":"America/Phoenix"},"body":"Can you create a unit test to reproduce this? Or at the very least give broker configs, more detailed logs, and steps to reliably reproduce this? Looks like the index pageFile is null, but no way to know how that happened. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ceposta","name":"ceposta","key":"ceposta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ceposta&avatarId=15051","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ceposta&avatarId=15051","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ceposta&avatarId=15051","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ceposta&avatarId=15051"},"displayName":"Christian Posta","active":true,"timeZone":"America/Phoenix"},"created":"2013-05-20T19:10:39.685+0000","updated":"2013-05-20T19:10:39.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648486/comment/13662303","id":"13662303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zerovian","name":"zerovian","key":"zerovian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Baker","active":true,"timeZone":"Etc/UTC"},"body":"What more logs can I provide?  I have logging set at debug.  Only happens after a couple of restarts so I can't give a reliable set of steps.  It happens after 2-3 restarts.  Not always, but it eventually will always fail after a few restarts.  \n\nIf I delete the database completely it goes away (obviously).\n\nThis is my log4j setting.\n\nlog4j.rootLogger=DEBUG, out\n\n\n\nThese are the lines of code where I setup my broker:\n\n\t\tbroker = new BrokerService();\n\t\tStatisticsBrokerPlugin statisticsPlugin = new StatisticsBrokerPlugin();\n\t\tbroker.setPlugins(new BrokerPlugin[] { statisticsPlugin });\n\n\t\tString dataDirectory = getDefaultDataDirectory();\n\t\tbroker.setDataDirectory(dataDirectory);\n\t\tbroker.setDeleteAllMessagesOnStartup(true);\n\t\tFile tmpDirectory = new File(getTempDataDirectory());\n\t\tbroker.setTmpDataDirectory(tmpDirectory);\n\t\tboolean enableJMX = Boolean.getBoolean(\"enableJMX\");\n\t\tbroker.setUseJmx(enableJMX);\n\n\t\ttry {\n\t\t\t// by default activemq would try to start jmx rmi server on port\n\t\t\t// 1099, the below code would help to work around it.\n\t\t\tString str = System.getProperty(\"activemq.jmx.rmi.port\");\n\t\t\tif (str != null) {\n\t\t\t\tint jmxRMIPort = Integer.parseInt(str);\n\t\t\t\tManagementContext managementContext = new ManagementContext();\n\t\t\t\tmanagementContext.setConnectorPort(jmxRMIPort);\n\t\t\t\tbroker.setManagementContext(managementContext);\n\t\t\t}\n\t\t} catch (Exception e) {\n\t\t}\n\t\t// this is default...but just make sure since some messages are too\n\t\t// big too keep directly in memory\n\t\tbroker.setPersistent(true);\n\n\t\t// broker name must be setup based on domain and container name...\n\t\t// we don't use the value from the activemq.xml file...so we force it\n\t\t// here\n\t\tString brokerName = getBrokerName();\n\t\tbroker.setBrokerName(brokerName);\n\n\t\t// advisory support MUST be enabled for stuff to work right\n\t\tbroker.setAdvisorySupport(true);\n\n// bunch of camel stuff in here that I deleted...not sure if you need that.\n\n\t\tbroker.start();\n\t\tbroker.waitUntilStarted();\n  \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zerovian","name":"zerovian","key":"zerovian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Baker","active":true,"timeZone":"Etc/UTC"},"created":"2013-05-20T19:28:15.658+0000","updated":"2013-05-20T19:28:15.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648486/comment/13741520","id":"13741520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"No test case here to validate.  There are a bunch of fixes in the 5.9-SNAPSHOT so I would suggest testing against that and if you can reproduce then please reopen and attach a test case.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-08-15T21:39:20.576+0000","updated":"2013-08-15T21:39:20.576+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4546/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1kqif:"}}