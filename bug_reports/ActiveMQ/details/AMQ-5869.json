{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12841654","self":"https://issues.apache.org/jira/rest/api/2/issue/12841654","key":"AMQ-5869","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2015-07-06T15:51:36.218+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Sep 04 22:22:27 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5038593563_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-08-27T18:19:04.889+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5869/watchers","watchCount":3,"isWatching":false},"created":"2015-06-30T10:42:31.746+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-09-04T22:22:27.153+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"I have two amq brokers, bridged together with consumers connected to both.\n\nAnd a destination policy configured like this:\n\n<policyEntry topic=\">\" producerFlowControl=\"true\" memoryLimit=\"1mb\" gcInactiveDestinations=\"true\" inactiveTimoutBeforeGC=\"30000\">\n\nI've been running them for years, upgrading through the 5.x releases.\n\nI just upgraded to 5.11.1 (and had to also upgrade from openjdk-6 to openjdk-7 to do so) and are seeing an exception being logged every 10 seconds:\n\nJun 30 10:28:10 srv-zvbod activemq:  INFO | ActiveMQ.Advisory.Consumer.Queue.DB.dbs-yafwc.srv-8ra75 Inactive for longer than 30000 ms - removing ...\nJun 30 10:28:10 srv-zvbod activemq: ERROR | Failed to remove inactive destination org.apache.activemq.security.AuthorizationDestinationFilter@91c406\nJun 30 10:28:10 srv-zvbod activemq: javax.jms.JMSException: Destination still has an active subscription: topic://ActiveMQ.Advisory.Consumer.Queue.DB.dbs-yafwc.srv-8ra75\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.region.AbstractRegion.removeDestination(AbstractRegion.java:194)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.jmx.ManagedTopicRegion.removeDestination(ManagedTopicRegion.java:62)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.region.RegionBroker.removeDestination(RegionBroker.java:363)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:177)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:177)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.advisory.AdvisoryBroker.removeDestination(AdvisoryBroker.java:225)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:177)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:177)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.security.AbstractAuthenticationBroker.removeDestination(AbstractAuthenticationBroker.java:38)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:177)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.security.AuthorizationBroker.removeDestination(AuthorizationBroker.java:129)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:177)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.MutableBrokerFilter.removeDestination(MutableBrokerFilter.java:182)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.region.RegionBroker.purgeInactiveDestinations(RegionBroker.java:907)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.broker.region.RegionBroker$1.run(RegionBroker.java:118)[activemq-broker-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)[activemq-client-5.11.1.jar:5.11.1]\nJun 30 10:28:10 srv-zvbod activemq: #011at java.util.TimerThread.mainLoop(Timer.java:555)[:1.7.0_79]\nJun 30 10:28:10 srv-zvbod activemq: #011at java.util.TimerThread.run(Timer.java:505)[:1.7.0_79]\n\nas more and more of these topics are being created, I'm seeing more exceptions listed.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Failed to remove inactive destination: Destination still has an active subscription","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnleach","name":"johnleach","key":"johnleach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Leach","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnleach","name":"johnleach","key":"johnleach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Leach","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"openjdk-7u79\nlinux\ni386","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12841654/comment/14615213","id":"14615213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Can you submit a test case that reproduces this issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-07-06T15:51:36.218+0000","updated":"2015-07-06T15:51:36.218+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12841654/comment/14624801","id":"14624801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnleach","name":"johnleach","key":"johnleach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Leach","active":true,"timeZone":"Europe/London"},"body":"I'm not a java dev so aren't really geared up for writing test cases, sorry.\n\nMore information though: this appears to be causing us problems (other than just the logging) that we're having trouble putting our finger on. It looks a bit like a message is stuck over on one amq instance and isn't making it to the consumer on the other side of the bridge.\n\nShutting down either one of the instances (so that all producers and consumers are on just one amq instance) and rerunning out tests fixes our problem and this log message goes away.\n\nWe've also tried wiping out the on-disk db on both instances, but the problem reoccurs when we run out tests so this doesn't look like an old data problem.\n\nWe've downgraded back to 5.9.1 and the exception logging and the bridging problem have gone away.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnleach","name":"johnleach","key":"johnleach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Leach","active":true,"timeZone":"Europe/London"},"created":"2015-07-13T15:34:12.729+0000","updated":"2015-07-13T15:34:12.729+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12841654/comment/14717219","id":"14717219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"No test case provided to help reproduce the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-08-27T18:19:04.930+0000","updated":"2015-08-27T18:19:04.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12841654/comment/15463611","id":"15463611","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnleach","name":"johnleach","key":"johnleach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Leach","active":true,"timeZone":"Europe/London"},"body":"This is still a problem with 5.14.0\n\n{quote}\n2016-09-04 19:44:24,304 | INFO  | ActiveMQ.Advisory.Consumer.Queue.XX.yyyyyy.zzzzzzz Inactive for longer than 30000 ms - removing ... | org.apache.activemq.broker.region.RegionBroker | ActiveMQ Broker[b.staging_queue.gb1.brightbox.com] Scheduler\n2016-09-04 19:44:24,304 | ERROR | Failed to remove inactive destination org.apache.activemq.security.AuthorizationDestinationFilter@b6ce7a | org.apache.activemq.broker.region.RegionBroker | ActiveMQ Broker[b.staging_queue.gb1.brightbox.com] Scheduler\njavax.jms.JMSException: Destination still has an active subscription: topic://ActiveMQ.Advisory.Consumer.Queue.LB.lba-vv075.srv-b4ij2\n        at org.apache.activemq.broker.region.AbstractRegion.removeDestination(AbstractRegion.java:270)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.jmx.ManagedTopicRegion.removeDestination(ManagedTopicRegion.java:62)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.region.RegionBroker.removeDestination(RegionBroker.java:363)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:178)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:178)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.advisory.AdvisoryBroker.removeDestination(AdvisoryBroker.java:277)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:178)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:178)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.security.AbstractAuthenticationBroker.removeDestination(AbstractAuthenticationBroker.java:38)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:178)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.security.AuthorizationBroker.removeDestination(AuthorizationBroker.java:131)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:178)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.MutableBrokerFilter.removeDestination(MutableBrokerFilter.java:183)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.region.RegionBroker.purgeInactiveDestinations(RegionBroker.java:906)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.region.RegionBroker$1.run(RegionBroker.java:118)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)[activemq-client-5.14.0.jar:5.14.0]\n        at java.util.TimerThread.mainLoop(Timer.java:555)[:1.7.0_111]\n        at java.util.TimerThread.run(Timer.java:505)[:1.7.0_111]\n{quote}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnleach","name":"johnleach","key":"johnleach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Leach","active":true,"timeZone":"Europe/London"},"created":"2016-09-04T22:22:27.153+0000","updated":"2016-09-04T22:22:27.153+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5869/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2gohj:"}}