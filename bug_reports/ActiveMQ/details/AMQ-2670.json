{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483181","self":"https://issues.apache.org/jira/rest/api/2/issue/12483181","key":"AMQ-2670","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-25T12:07:06.301+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 30 14:05:32 UTC 2010","customfield_12310420":"74853","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_22022994_*|*_5_*:*_2_*:*_84180101_*|*_4_*:*_1_*:*_334807229","customfield_12312321":null,"resolutiondate":"2010-03-30T14:03:59.389+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2670/watchers","watchCount":0,"isWatching":false},"created":"2010-03-25T11:33:49.065+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[{"id":"12335021","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335021","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"outwardIssue":{"id":"12483476","key":"AMQ-2656","self":"https://issues.apache.org/jira/rest/api/2/issue/12483476","fields":{"summary":"ActiveMQInitialConnectionFactory cannot return an XAConnectionFactory","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-03-30T14:23:13.502+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When deploying the rar under JBoss, the connectionfactory bound in de JNDI tree is always of type 'ActiveMQConnectionFactory'., while it should be ActiveMQXAConnectionFactory (which implements XAConnectionFactory).\n\nI attached a new class that creates the correct type of factory, and this can be configured in the ra.xml (also attached).\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461662","id":"12461662","filename":"ActiveMQXAManagedConnectionFactory.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-25T11:35:45.750+0000","size":1271,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461662/ActiveMQXAManagedConnectionFactory.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461661","id":"12461661","filename":"ra.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-25T11:35:43.290+0000","size":20525,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461661/ra.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"159916","customfield_12312823":null,"summary":"ClassCast Exception in JBoss when using XA ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"activemq-rar-5.3.0.rar deployed in jboss-5.1.0-GA","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942251","id":"12942251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"body":"Note, for recovery to work (and for the original error to occur), a configuration in jbossts-properties.xml must be added, like this:\n\t<property name=\"com.arjuna.ats.jta.recovery.XAResourceRecovery.ACTIVEMQ\"\n       value=\"org.jboss.jms.server.recovery.MessagingXAResourceRecovery;java:/ActiveMQJMSProvider\"/>\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-25T11:36:52.295+0000","updated":"2010-03-25T11:36:52.295+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942204","id":"12942204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"can you post an ejb or mdb descriptor that uses this. This looks like a use case where the RAR provides the connection factory but not the recovery contract, is that correct? With the RAR contract, the XAResource would normally be accessed via the javax.resource.spi.ResourceAdapter#getXAResources\n\nWith the new class, the RAR can be bypassed w.r.t to recovery, or just used as an easy way to deploy ActiveMQ to jboss. Am I missing something?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-25T12:07:06.301+0000","updated":"2010-03-25T12:07:06.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942261","id":"12942261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"body":"An mdb:\n@MessageDriven(mappedName = \"jms/SimpleMDB\", messageListenerInterface = javax.jms.MessageListener.class, activationConfig = {\n        @ActivationConfigProperty(propertyName = \"destination\", propertyValue = \"queue.test\"),\n        @ActivationConfigProperty(propertyName = \"destinationType\", propertyValue = \"javax.jms.Queue\"),\n        @ActivationConfigProperty(propertyName = \"subscriptionDurability\", propertyValue = \"NonDurable\"),\n        @ActivationConfigProperty(propertyName = \"maximumRedeliveries\", propertyValue = \"0\") })\n@ResourceAdapter(value = \"activemq-rar-5.3.0.rar\")\npublic class SimpleMDB implements MessageListener {\n...\n}\n\nBut it is not related to the MDB. The problem is that the connectionfactory is not the XA variant. This is deployed in a -ds.xml ike this:\n<connection-factories>\n\n   <tx-connection-factory>\n      <jndi-name>activemq/QueueConnectionFactory</jndi-name>\n      <xa-transaction/>\n      <track-connection-by-tx/>\n      <rar-name>activemq-rar-5.3.0.rar</rar-name>\n      <connection-definition>javax.jms.QueueConnectionFactory</connection-definition>\n      <ServerUrl>tcp://localhost:61616</ServerUrl>\n      <min-pool-size>10</min-pool-size>\n      <max-pool-size>200</max-pool-size>\n      <blocking-timeout-millis>30000</blocking-timeout-millis>\n      <idle-timeout-minutes>3</idle-timeout-minutes>\n   </tx-connection-factory>\n\n   <mbean code=\"org.jboss.jms.jndi.JMSProviderLoader\"\n          name=\"activemq:service=JMSProviderLoader,name=ActiveMQJMSProvider\">\n      <attribute name=\"ProviderName\">ActiveMQJMSProvider</attribute>\n      <attribute name=\"ProviderAdapterClass\">org.jboss.jms.jndi.JNDIProviderAdapter</attribute>\n      <attribute name=\"FactoryRef\">java:/activemq/QueueConnectionFactory</attribute>\n      <attribute name=\"QueueFactoryRef\">java:/activemq/QueueConnectionFactory</attribute>\n      <attribute name=\"TopicFactoryRef\">java:/activemq/QueueConnectionFactory</attribute>\n   </mbean>\n   \n...\n/>\n\nThis will result in a call to ActiveMQManagedConnectionFactory.createConnectionFactory during startup of JBoss (as configured in the ra.xml). But that will always create a ActiveMQConnectionFactory and never the ActiveMQXAConnectionFactory. \nAnd therefore, a ConnectionFactory instance is always bound in the JNDI and not an XAConnectionFactory.\nSo, it is not a bypass for the rar (it is still needed).\n\nI see in the sources for ActiveMQXAConnectionFactory that all work is handled by the superclass (ActiveMQConnectionFactory), so it is only in JBoss actually performing the cast on the connectionfactory that causes a problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-25T12:42:55.084+0000","updated":"2010-03-25T12:42:55.084+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942216","id":"12942216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"ok, I see how this will work but it is a bit of a hack, all be it, one that is of value.\n\nI would expect some sort of generic RAR com.arjuna.ats.jta.recovery.XAResourceRecovery impl that is aware of a resource adapter in jndi and can make calls on javax.resource.spi.ResourceAdapter#getXAResources to do recovery.\n\nIt looks like no such thing exists in jboss or arjuna atm, Having an option to publish an XA connection factory in jndi looks like a reasonable workaround.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-25T17:27:27.437+0000","updated":"2010-03-25T17:27:27.437+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942215","id":"12942215","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"patch applied to trunk with thanks in r927520","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-25T17:40:52.037+0000","updated":"2010-03-25T17:40:52.037+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942286","id":"12942286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"this breaks regular XA, the RAR needs to handle the XAResource and an XAConnectionFactory should not be created.\nWe need another mechanism to integrate with the periodic recovery of jboss. Possibly implement their recovery interface or a wrapper to it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-26T17:03:52.139+0000","updated":"2010-03-26T17:03:52.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942249","id":"12942249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Seems like the issue of of JCA XA recovery registration has come up in jboss land, and it is correctly seen as something that should be handled under the covers between JCA and the TransactionManager, but this has not been completed yet. See: https://jira.jboss.org/jira/browse/JBJCA-39\n\nThere may be some way to workaround this with JMS apis in the short term, but the real solution is to let the appserver work though registering the XA resource from JCA with the underlying transaction services of the container.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-29T10:11:12.748+0000","updated":"2010-03-29T10:11:12.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942372","id":"12942372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Using JMS apis for out of band recovery will work, there is one relevant jboss fix .w.r.t restarted the broker service that may also help https://jira.jboss.org/jira/browse/JBMESSAGING-1608\n\nBackground: The RAR should not create or use an XA connection factory, XA interaction is managed by the RAR implementation in response to calls from the appserver in accordance with the JCA transaction contract.\nThe appserver should also negotiate with the RAR to facilitate recovery using the JCA spi and that is what will be addressed by https://jira.jboss.org/jira/browse/JBJCA-39.\n\nIn the mean time, using the JMS api to deal with recovery is a necessary and a reasonable workaround.\n\nRecovery is configured in the transaction manager properties using a resource wrapper from jboss messaging. In jboss 5.0.1_GA, the relevant addition to the transaction manager properties file: *conf/jbossjta-properties.xml* is:\n{code}    <properties depends=\"arjuna\" name=\"jta\">\n        <!--\n        Support subtransactions in the JTA layer?\n        Default is NO.\n      -->\n        <property name=\"com.arjuna.ats.jta.supportSubtransactions\" value=\"NO\"/>\n        <property name=\"com.arjuna.ats.jta.jtaTMImplementation\" value=\"com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionManagerImple\"/>\n        <!--\n                        com.arjuna.ats.internal.jta.transaction.jts.TransactionManagerImple\n                        -->\n        <property name=\"com.arjuna.ats.jta.jtaUTImplementation\" value=\"com.arjuna.ats.internal.jta.transaction.arjunacore.UserTransactionImple\"/>\n        <!--\n                        com.arjuna.ats.internal.jta.transaction.jts.UserTransactionImple\n                        -->\n       <!-- recovery for ActiveMQ XA pending automated RAR recovery https://jira.jboss.org/jira/browse/JBJCA-39 -->\n       <property name=\"com.arjuna.ats.jta.recovery.XAResourceRecovery.ActiveMQ\" value=\"org.jboss.jms.server.recovery.MessagingXAResourceRecovery;java:/ActiveMQRAR\"/>\n\n    </properties>{code} Note this is a modification to the *jta* configuration, _not_ the recovery manager.\n\n\nThe JNDI name referenced needs to be provided by the ActiveMQ RAR *-ds.xml\" descriptor using a JMSProviderLoader. The addition is as follows:{code}   <mbean code=\"org.jboss.jms.jndi.JMSProviderLoader\"\n          name=\"activemq:service=JMSProviderLoader,name=ActiveMQRAR\">\n      <attribute name=\"ProviderName\">ActiveMQRAR</attribute>\n      <attribute name=\"ProviderAdapterClass\">org.jboss.jms.jndi.JNDIProviderAdapter</attribute>\n      <attribute name=\"Properties\">xa=true\n       java.naming.factory.initial=org.apache.activemq.jndi.ActiveMQInitialContextFactory\n       java.naming.provider.url=tcp://localhost:61616\n</attribute>\n      <attribute name=\"QueueFactoryRef\">ConnectionFactory</attribute>\n      <attribute name=\"TopicFactoryRef\">ConnectionFactory</attribute>\n      <attribute name=\"FactoryRef\">ConnectionFactory</attribute>\n   </mbean>{code}\n\nThis depends on https://issues.apache.org/activemq/browse/AMQ-2656 to allow the ActiveMQ initial context to return an XA connection factory. Note the property, xa=true in the \"Properties\" attribute which ensures that an XAConnectionFactory is created.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-30T13:54:48.324+0000","updated":"2010-03-30T13:54:48.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942361","id":"12942361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"r929145\nremoved the XA version of the managed connection factory and added some additional logging to the transaction broker so it is easy to verify when recovery is configured. To see it, add the following to the log4j config: {code}log4j.logger.org.apache.activemq.broker.TransactionBroker=DEBUG{code} and a message will be output on every call to recover outstanding XA prepared transactions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-30T14:03:59.375+0000","updated":"2010-03-30T14:03:59.375+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483181/comment/12942367","id":"12942367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Add dependency link to https://issues.apache.org/activemq/browse/AMQ-2656 as this needs ActiveMQ initial context to return an XA capable connection factory for out of band recovery using JMS api","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-30T14:05:32.850+0000","updated":"2010-03-30T14:23:13.480+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2670/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rqdb:"}}