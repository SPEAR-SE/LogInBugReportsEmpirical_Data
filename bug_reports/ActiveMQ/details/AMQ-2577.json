{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483221","self":"https://issues.apache.org/jira/rest/api/2/issue/12483221","key":"AMQ-2577","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2010-01-21T19:24:15.369+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jan 21 20:44:17 UTC 2010","customfield_12310420":"96138","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5476181_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-01-21T20:44:17.611+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2577/watchers","watchCount":1,"isWatching":false},"created":"2010-01-21T19:13:01.430+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-01-21T20:44:17.593+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"If I publish a bunch of messages, and then consume them with a session Session.CLIENT_ACKNOWLEDGE, when I acknowlege the first messages, all messages actually get acknowledged.  I'm including some source code that shows the problem.\n\nThis problem can be seen regardless of the Session be transacted or not.\n\nThanks,\nBrad\n\n\npackage bugs;\n\nimport javax.jms.*;\nimport java.util.LinkedList;\nimport java.net.*;\nimport org.apache.activemq.*;\n\n/**\n *\n * @author bwillard\n */\npublic class MessageAcknowledgementBug {\n\n    public static void main(String[] args) {\n\n        try {\n\n            ConnectionFactory factory = new ActiveMQConnectionFactory(URI.create(\"tcp://localhost:61616\"));\n\n            Connection jmsConn = factory.createConnection();\n            jmsConn.start();\n\n            Session session = jmsConn.createSession(false, Session.CLIENT_ACKNOWLEDGE);\n\n            Queue queue = session.createQueue(\"Ack.Bug.Test\");\n\n            MessageProducer publisher = session.createProducer(queue);\n            TextMessage msg;\n\n            /*\n             * Put 50 Messages on Queue\n             */\n            for (int a = 0; a < 50; a++) {\n                msg = session.createTextMessage(\"\" + a);\n                publisher.send(msg);\n            }\n\n\n\n            MessageConsumer reader = session.createConsumer(queue);\n\n            LinkedList<TextMessage> messages = new LinkedList<TextMessage>();\n\n\n            /*\n             * Receive all 50 messages and store in list\n             */\n\n            while ((msg = (TextMessage) reader.receiveNoWait()) != null) {\n                messages.add(msg);\n            }\n\n\n\n            /*\n             * acknowledge one message, which acknowledges them all as received\n             * instead of just the one message\n             */\n\n            messages.getFirst().acknowledge();\n\n\n\n            reader.close();\n            publisher.close();\n\n            jmsConn.stop();\n            jmsConn.close();\n\n\n\n        } catch (Exception exc) {\n            exc.printStackTrace();\n        }\n\n\n    }\n}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172399","customfield_12312823":null,"summary":"Acknowleging a single message actually acknowleges all messages consumed.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Mac OSX 10.6, CentOS 5 Linux","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483221/comment/12942053","id":"12942053","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"This is actually exactly how CLIENT_ACKNOWLEDGE works.  \n\nFrom the JMS Specification:\n\nWith this acknowledgment mode, the client acknowledges a consumed message by calling the message's acknowledge method. Acknowledging a consumed message acknowledges all messages that the session has consumed. \n\nActiveMQ has a special acknowledge mode called INDIVIDUAL_ACKNOWLEDGE that can be used if you really want to ack only a single message at a time.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2010-01-21T19:24:15.369+0000","updated":"2010-01-21T19:24:15.369+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483221/comment/12942054","id":"12942054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"Wow is that a misleading flaw in the JMS Spec, I guess I'll go write them about that.  Thanks for the info on INDIVIDUAL_ACKNOWLEDGE.  I just started using that and it works like a charm.\n\nThanks,\nBrad","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-21T20:43:03.694+0000","updated":"2010-01-21T20:43:03.694+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483221/comment/12942055","id":"12942055","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"This behavior is defined in the JMS Specification.  I think this is really a flaw in the design of the specification.  ActiveMQ supports the spec properly, it's the spec that's misleading.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-21T20:44:17.551+0000","updated":"2010-01-21T20:44:17.551+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2577/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tvf3:"}}