{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482763","self":"https://issues.apache.org/jira/rest/api/2/issue/12482763","key":"AMQ-2087","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"parent":{"id":"12482772","key":"AMQ-1730","self":"https://issues.apache.org/jira/rest/api/2/issue/12482772","fields":{"summary":"Bad use of Jms field JMSXDeliveryCount. Related to RedeliveryCount and message prefetch ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-01-28T18:37:04.644+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 30 09:36:18 UTC 2009","customfield_12310420":"75080","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_20187832_*|*_5_*:*_2_*:*_79472503_*|*_4_*:*_1_*:*_60880874","customfield_12312321":null,"resolutiondate":"2009-01-30T09:36:18.071+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2087/watchers","watchCount":0,"isWatching":false},"created":"2009-01-28T13:00:36.862+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[{"id":"12334987","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334987","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12482795","key":"AMQ-1601","self":"https://issues.apache.org/jira/rest/api/2/issue/12482795","fields":{"summary":"maximumRedeliveries not honoured when transacted session is closed without explicit rollback","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12421970","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12421970","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12822692","key":"AMQ-5735","self":"https://issues.apache.org/jira/rest/api/2/issue/12822692","fields":{"summary":"increment redeliverCounter in the absence of client supplied information","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12334970","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334970","type":{"id":"12310051","name":"Supercedes","inward":"is superceded by","outward":"supercedes","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310051"},"outwardIssue":{"id":"12482782","key":"AMQ-1952","self":"https://issues.apache.org/jira/rest/api/2/issue/12482782","fields":{"summary":"JMSXDeliveryCount is not being incremented correctly","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12334998","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334998","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12482790","key":"AMQ-1593","self":"https://issues.apache.org/jira/rest/api/2/issue/12482790","fields":{"summary":"redeliveryCounter not updated correctly when using XA transactions and Spring","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-21T15:06:13.927+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":null,"customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461207","id":"12461207","filename":"AMQ-2087.test.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","key":"gnt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gnt&avatarId=35232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gnt&avatarId=35232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gnt&avatarId=35232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gnt&avatarId=35232"},"displayName":"Guillaume Nodet","active":true,"timeZone":"Europe/Berlin"},"created":"2009-01-28T13:01:25.910+0000","size":3104,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461207/AMQ-2087.test.diff"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"233421","customfield_12312823":null,"summary":"Redelivery after rollback does not seem to work well ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","key":"gnt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gnt&avatarId=35232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gnt&avatarId=35232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gnt&avatarId=35232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gnt&avatarId=35232"},"displayName":"Guillaume Nodet","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","key":"gnt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gnt&avatarId=35232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gnt&avatarId=35232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gnt&avatarId=35232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gnt&avatarId=35232"},"displayName":"Guillaume Nodet","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482763/comment/12940688","id":"12940688","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","key":"gnt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gnt&avatarId=35232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gnt&avatarId=35232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gnt&avatarId=35232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gnt&avatarId=35232"},"displayName":"Guillaume Nodet","active":true,"timeZone":"Europe/Berlin"},"body":"Test case reproducing the problem","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","key":"gnt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gnt&avatarId=35232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gnt&avatarId=35232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gnt&avatarId=35232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gnt&avatarId=35232"},"displayName":"Guillaume Nodet","active":true,"timeZone":"Europe/Berlin"},"created":"2009-01-28T13:01:26.222+0000","updated":"2009-01-28T13:01:26.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482763/comment/12940698","id":"12940698","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"This is a case of amq treating delivery as delivery to the consumer session rather than to the actual consumer implementation. In the test case, all of the 10 messages get redelivered to each consumer and they very quickly reach the default max redelivery count of 6 and get sent to the DLQ!\n\none solution is to configure the redelivery policy:\n{code}ConnectionFactory connectionFactory =\n     new ActiveMQConnectionFactory(\"vm://localhost?jms.redeliveryPolicy.maximumRedeliveries=100\");\n {code}\n\nAn alternative is to use prefetch=0 so that each consumer will only get what it can use.\n\nThere are a bunch of related open issues on this behavior, with the wire format change in 6.0 it will be possible to address this. A subscription remove command needs to indicate to the broker the last delivered ack that it has produced. An alternative is that the subscription trys to keep track of this information (which may be simpler).\n\nIs it ok to close this as there are so many open related issues: see: https://issues.apache.org/activemq/secure/IssueNavigator.jspa?reset=true&&query=redelivery&summary=true&description=true&body=true&type=1&pid=10520&status=1 ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-28T18:37:04.644+0000","updated":"2009-01-28T18:37:04.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482763/comment/12940684","id":"12940684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"ps: I committed your test with a few variants. thanks,","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-28T18:38:05.630+0000","updated":"2009-01-28T18:38:05.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482763/comment/12940708","id":"12940708","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"going to bite the bullit on this and augment the close command (RemoveInfo) with a deliveredSequenceId so that the broker can determine which of the prefetched messages were actually delivered to the end consumer.\nThis will require some api changes in the destination which will break DestinationFilters but something has got to give. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-29T16:41:37.192+0000","updated":"2009-01-29T16:41:37.192+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482763/comment/12940725","id":"12940725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"resolved in r739008\nnew long attribute to RemoveInfo where the last delivered broker sequence id is passed back to the broker, prefetched messages with ids greater than this value now don't get their redelivery count incremented, requires wireformat version increment to 5 and Destination api change. Any existing DestinationFilters will need to be modified. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-30T09:36:18.060+0000","updated":"2009-01-30T09:36:18.060+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2087/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i14c33:"}}