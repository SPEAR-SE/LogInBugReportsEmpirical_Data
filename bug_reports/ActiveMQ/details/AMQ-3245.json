{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12502617","self":"https://issues.apache.org/jira/rest/api/2/issue/12502617","key":"AMQ-3245","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-03-28T19:15:34.320+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Mar 31 14:25:36 UTC 2011","customfield_12310420":"74709","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_242526974_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-03-31T14:25:36.259+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3245/watchers","watchCount":0,"isWatching":false},"created":"2011-03-28T19:03:29.312+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315624","id":"12315624","description":"Maintenance release for 5.4.0","name":"5.4.1","archived":false,"released":true,"releaseDate":"2010-09-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-03-31T14:25:36.282+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313891","id":"12313891","name":"Selector"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Is it possible that selector was broken due to new enhancement regarding REST selectors on 5.4.0? We are using 5.3.0 and selectors are working fine, however since we've upgraded our demo and test environments to 5.4.1 and essentially 5.4.2 it stop working for some reason. I can recreate it 100% of the time and below are the steps.\n\n1) First create the producer with String property set to 30. i.e. test, 30:\n{code}\nString username=\"Me\"\nString passwd = \"invicible\"\nString url =\"failover:(tcp://localhost:51515)?maxReconnectDelay=5000&useExponentialBackOff=false\";\nConnectionFactory connectionFactory = new ActiveMQConnectionFactory(username, passwd, url);\nConnection connection = connectionFactory.createConnection();\n// connection.setUseCompression(true); set this on the URL instead\nconnection.setExceptionListener(this);\n\nString destinationString = \"Test.Dest\";\n// create a session, destination, and producer\nSession session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\nDestination destination = session.createQueue(destinationString);\n\nMessageProducer producer = session.createProducer(destination);\nproducer.setDeliveryMode(DeliveryMode.PERSISTENT);\n\nMessage message = session.createTextMessage(\"This is a test message\");\nmessage.setIntProperty(\"test\", 30);\n// insert the message 1000 times.\nfor (long l = 0L; l < 1000; l++) {\n      producer.send(message);\n}\n producer.close();\n session.close();\n connection.close();\n{code}\n\nNow we have 1000 message sitting on activemq, if you navigate to http://localhost:8161/admin and view \"Test.Dest\" queue you should see the 1000 message there.\n\n2) Create the consumer with test > 50 selector.\n{code}\npublic void setup() {\nString username=\"Me\"\nString passwd = \"invicible\"\nString url =\"failover:(tcp://localhost:51515)?maxReconnectDelay=5000&useExponentialBackOff=false\"; //\"tcp://localhost:51515\";\nConnectionFactory connectionFactory = new ActiveMQConnectionFactory(username, passwd, url);\nConnection connection = connectionFactory.createConnection();\n// connection.setUseCompression(true); set this on the URL instead\nconnection.setExceptionListener(this);\n\n// create a session, destination, and consumer\nSession session = connection.createSession(false, Session.CLIENT_ACKNOWLEDGE);\nString destinationString = \"Test.Dest\";\nsession.createQueue(destinationString);\nMessageConsumer consumer = session.createConsumer(destination, \"test > 50\");\nconsumer.setMessageListener(this);\n\nconnection.start();\n\n}\n\n\npublic void onMessage(Message message) {\n       try {\n            if (print && text) {\n                TextMessage textMessage = (TextMessage) message;\n                System.out.println(textMessage.getText());\n            }\n\n       catch (Exception ex)\n       { //swallow } \n}\n\n{code}\n\nOnce connected to broker, you'll see that it doesn't do anything as the message is not for this selector.\n\n3) Edit the code to producer.\n{code}\nmessage.setIntProperty(\"test\", 60);\n{code}\n\nAnd then rerun the producer to insert the 1000 records again.\n\nActual: Nothing happens, the consumer just waits for any message that comes in that matches the selector. \nExpected: The message gets consumed, as the latter part of the producer ran matches the selector.\n\nThis behavior works perfectly fine with 5.3.0. As selector is an important functionality of JMS as a whole this being broken is actually bad.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12474996","id":"12474996","filename":"ActiveMQ_Test_Case.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-30T19:04:37.218+0000","size":1657,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12474996/ActiveMQ_Test_Case.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12474995","id":"12474995","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-30T19:04:37.208+0000","size":3157,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12474995/activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12474998","id":"12474998","filename":"JmsTestConsumer1.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-30T19:04:37.236+0000","size":3105,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12474998/JmsTestConsumer1.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12474997","id":"12474997","filename":"JmsTestProducer1.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-30T19:04:37.227+0000","size":3026,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12474997/JmsTestProducer1.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"255277","customfield_12312823":null,"summary":"SELECTORS doesn't work for releases 5.4.0 to current","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13012183","id":"13012183","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You don't appear to be calling connection.start() in your consumer code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-03-28T19:15:34.320+0000","updated":"2011-03-28T19:15:34.320+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13012218","id":"13012218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"body":"I just missed that from the code.. Updating...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-28T20:42:38.840+0000","updated":"2011-03-28T20:42:38.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13012247","id":"13012247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Is this the maxPageSize limit issue? That was ignored in 5.3. Set it to 2000 via a destination policy.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-28T21:55:07.397+0000","updated":"2011-03-28T21:55:07.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13012552","id":"13012552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"body":"I'll test the 2000 maxPageSize. But can anyone please explain what the PageSize mean? is it the number of queue or a page where it can contain number of queues? Thanks,","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-29T16:45:38.408+0000","updated":"2011-03-29T16:45:38.408+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13012563","id":"13012563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"it is documented at http://activemq.apache.org/per-destination-policies.html\nEssentially it is the limit on the number of messages that will be held in memory for dispatch, so it becomes the effective window for selector matching.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-29T17:24:33.668+0000","updated":"2011-03-29T17:24:33.668+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13012602","id":"13012602","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"body":"Gary,\nThanks for your help.\n\nOk, I've tested with 2000 maxPageSize, and I see some issues with selector.It appears that a certain threshold where the selectors fail to apply its rules is at 30 messages and above. \n\nJust to be accurate, queues for the test below are 0. They don't contain any messages at all when I start the app. So when I run #2) the messages shows me 25 and then running #3) I get 50 total messages. Then I purge them so its clean and run the second set below with 30 messages.\n\nIf I run my test app in this sequence\n1) Run consumer selector [test > 50] \n2) Run producer property [test, 20], insert 25 messages\n3) Run producer property [test, 60], insert 25 messages\n\nThe selector works fine! Messages gets consumed.\n\nUsing same sequence as above but send 30 or more messages, nothing gets consumed.\n1) Run consumer selector [test > 50] \n2) Run producer property [test, 20], insert 30 messages\n3) Run producer property [test, 60], insert 30 messages\n\nIs there other ways to get around this? This could particularly happen, a consumer for #2 get disconnected/crashed for some reason, and we are above the 30 threshold then nothing gets consumed at all.\n\nPlease advice.\n\nMelvin\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-29T18:29:44.053+0000","updated":"2011-03-29T19:23:50.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13012685","id":"13012685","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"body":"Ok, making the maxPageSize to 5000, passes the 30 message threshold. So there is a correlation on the limit threshold and maxPageSize.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-29T20:47:45.499+0000","updated":"2011-03-29T20:47:45.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13012914","id":"13012914","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Hi,\n\nI just tried to reproduce this and didn't manage.\n\nI see the normal behavior until the number of messages in the queue reaches the page size, which was explained by Gary.\n\nI noticed that in your code you use client ack and don't ack messages anywhere. Maybe this can explain what you see.\n\nCan you create a test case that reproduces this and which includes your configuration as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2011-03-30T10:56:19.385+0000","updated":"2011-03-30T10:56:19.385+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13012988","id":"13012988","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"body":"Hello Dejan,\n\nI've copied small chunks of my code, although I have the message.acknowledge() on my onMessage(Message message) method, however, this code is not called at all when the threshold is been reached. So it really doesn't matter. Anyway, I will attach my test class and broker configuration, and provide you the test/sequence that I did.\n\nMelvin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-30T14:33:53.386+0000","updated":"2011-03-30T14:33:53.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13013589","id":"13013589","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"body":"Sample code, broker config and test case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-30T19:04:37.303+0000","updated":"2011-03-30T19:04:37.303+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13013590","id":"13013590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"body":"Hello Dejan,\n\nI've attached my sample code and test case I did. If there is problem with our broker config, kindly let us know.\n\nRegards,\nMelvin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-30T19:07:29.586+0000","updated":"2011-03-30T19:07:29.586+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13013911","id":"13013911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Hi,\n\nyour problem isn't related to page size but the small memory limit on the queue. Because of this small limit only portion of messages (22 to be precise) can be cached in the queue and while those messages aren't consumed others can't get in from the store.\n\nSo use some higher value for memory limit and you'd be fine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2011-03-31T10:39:09.239+0000","updated":"2011-03-31T10:39:09.239+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13013991","id":"13013991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"body":"Hi Dejan,\n\nOk, that made sense. We are not finding this information elsewhere, at least this is helpful understanding what is going on. From architecture point of view will haven an idea where we need to allocate memory and how to make activemq more reliable.\n\nI would close this as fixed as the solution that Dejan mentioned works.\n\nThanks again everyone.\n\nMelvin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-31T14:24:05.705+0000","updated":"2011-03-31T14:24:05.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502617/comment/13013992","id":"13013992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"body":"Adding memory limits for queue solved the problem. This document will at least be the information on how selectors work with regards to destination policies.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayd.lowrider","name":"jayd.lowrider","key":"jayd.lowrider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Melvin Ramos","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-31T14:25:36.280+0000","updated":"2011-03-31T14:25:36.280+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3245/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i182xj:"}}