{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13157274","self":"https://issues.apache.org/jira/rest/api/2/issue/13157274","key":"AMQ-6956","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/10008","id":"10008","description":"Information Provided","name":"Information Provided"},"customfield_12312322":null,"customfield_12310220":"2018-05-09T15:00:12.811+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed May 09 15:55:40 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_429009955_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-05-09T17:51:28.217+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6956/watchers","watchCount":2,"isWatching":false},"created":"2018-05-04T18:41:18.288+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341032","id":"12341032","name":"5.16.0","archived":false,"released":false}],"issuelinks":[{"id":"12533398","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12533398","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13151965","key":"ARTEMIS-1804","self":"https://issues.apache.org/jira/rest/api/2/issue/13151965","fields":{"summary":"NPE in recent snapshot","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-09T17:51:28.237+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When I connect and disconnect from a broker using the activemq-client, sometimes I get the exception below. ssl:// is used. The exception appears when the client is disconnecting.\r\n\r\nThe broker in this case is the current snapshot of ActiveMQ Artemis.\r\n\r\nGood test for reproducing is {{org.apache.activemq.artemis.tests.integration.security.SecurityTest#testJAASSecurityManagerAuthenticationWithCertsAndOpenWire}}.\r\n\r\nI saw it in conjunction with the {{flush()}} exception from Netty, discussed on ARTEMIS-1804. It turns out the flush{} exception is probably unrelated to this one, because it appeared in the server log every time and seems harmless.\r\n\r\nThe exception below appears on the client in about 1 % of runs of the aforementioned tests (so it must be run in a loop to see this happen). For some reason, this error appears to me more often on Travis CI (linked from the Artemis bug)\r\n\r\nThe exception is\r\n\r\n{noformat}\r\njavax.jms.JMSException: Connection closed by remote host\r\n\tat org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:72)\r\n\tat org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1310)\r\n\tat org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:696)\r\n\tat com.redhat.mqe.lib.CoreClient.close(CoreClient.java:302)\r\n\tat com.redhat.mqe.lib.CoreClient.closeConnObjects(CoreClient.java:295)\r\n\tat com.redhat.mqe.lib.SenderClient.startClient(SenderClient.java:156)\r\n\tat com.redhat.mqe.lib.Main.main(Main.java:50)\r\n\tat com.redhat.mqe.aoc.Main.main(Main.java:74)\r\n\tat AocMainTest.main(MainTest.kt:113)\r\n\tat AbstractMainTest$sendSingleMessageAllTrustingTls$1.invoke(AbstractMainTest.kt:404)\r\n\tat AbstractMainTest$sendSingleMessageAllTrustingTls$1.invoke(AbstractMainTest.kt:75)\r\n\tat AbstractMainTestKt.assertNoSystemExit(AbstractMainTest.kt:66)\r\n\tat AbstractMainTest.sendSingleMessageAllTrustingTls(AbstractMainTest.kt:398)\r\n\tat sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:436)\r\n\tat org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:115)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$6(TestMethodTestDescriptor.java:170)\r\n\tat org.junit.jupiter.engine.execution.ThrowableCollector.execute(ThrowableCollector.java:40)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:166)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:113)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:58)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.lambda$executeRecursively$3(HierarchicalTestExecutor.java:112)\r\n\tat org.junit.platform.engine.support.hierarchical.SingleTestExecutor.executeSafely(SingleTestExecutor.java:66)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.executeRecursively(HierarchicalTestExecutor.java:108)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.execute(HierarchicalTestExecutor.java:79)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.lambda$executeRecursively$2(HierarchicalTestExecutor.java:120)\r\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)\r\n\tat java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\r\n\tat java.util.Iterator.forEachRemaining(Iterator.java:116)\r\n\tat java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)\r\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\r\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\r\n\tat java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\r\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\r\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n\tat java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.lambda$executeRecursively$3(HierarchicalTestExecutor.java:120)\r\n\tat org.junit.platform.engine.support.hierarchical.SingleTestExecutor.executeSafely(SingleTestExecutor.java:66)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.executeRecursively(HierarchicalTestExecutor.java:108)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.execute(HierarchicalTestExecutor.java:79)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.lambda$executeRecursively$2(HierarchicalTestExecutor.java:120)\r\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)\r\n\tat java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\r\n\tat java.util.Iterator.forEachRemaining(Iterator.java:116)\r\n\tat java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)\r\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\r\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\r\n\tat java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\r\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\r\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n\tat java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.lambda$executeRecursively$3(HierarchicalTestExecutor.java:120)\r\n\tat org.junit.platform.engine.support.hierarchical.SingleTestExecutor.executeSafely(SingleTestExecutor.java:66)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.executeRecursively(HierarchicalTestExecutor.java:108)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor$NodeExecutor.execute(HierarchicalTestExecutor.java:79)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:55)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:43)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:170)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:154)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:90)\r\n\tat com.intellij.junit5.JUnit5IdeaTestRunner.startRunnerWithArgs(JUnit5IdeaTestRunner.java:74)\r\n\tat com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:67)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)\r\nCaused by: java.net.SocketException: Connection closed by remote host\r\n\tat sun.security.ssl.SSLSocketImpl.checkWrite(SSLSocketImpl.java:1565)\r\n\tat sun.security.ssl.AppOutputStream.write(AppOutputStream.java:124)\r\n\tat org.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedOutputStream.java:115)\r\n\tat java.io.DataOutputStream.flush(DataOutputStream.java:123)\r\n\tat org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:194)\r\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.doOnewaySend(AbstractInactivityMonitor.java:335)\r\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.oneway(AbstractInactivityMonitor.java:317)\r\n\tat org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:94)\r\n\tat org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:116)\r\n\tat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)\r\n\tat org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\r\n\tat org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1308)\r\n\t... 64 more\r\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"java.net.SocketException: Connection closed by remote host thrown during ActiveMQConnection#close()","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdanek","name":"jdanek","key":"jdanek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jdanek&avatarId=27353","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jdanek&avatarId=27353","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jdanek&avatarId=27353","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jdanek&avatarId=27353"},"displayName":"Jiri Daněk","active":true,"timeZone":"Europe/Prague"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdanek","name":"jdanek","key":"jdanek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jdanek&avatarId=27353","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jdanek&avatarId=27353","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jdanek&avatarId=27353","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jdanek&avatarId=27353"},"displayName":"Jiri Daněk","active":true,"timeZone":"Europe/Prague"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13157274/comment/16468933","id":"16468933","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I think that is just a race between the client sending its shutdown command and then closing its end of the socket and the broker reacting to that shutdown command and getting to close it's end of the socket first. \r\n\r\nIt is like the broker is reacting too fast which is positive.\r\n\r\n5.x does the close async in case it will block, but Artemis is already non blocking so it can happen quickly in the normal case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-05-09T15:00:12.811+0000","updated":"2018-05-09T15:43:54.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13157274/comment/16468989","id":"16468989","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdanek","name":"jdanek","key":"jdanek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jdanek&avatarId=27353","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jdanek&avatarId=27353","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jdanek&avatarId=27353","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jdanek&avatarId=27353"},"displayName":"Jiri Daněk","active":true,"timeZone":"Europe/Prague"},"body":"Java checks the socket after every write, even after the very last write. So if the broker closes the socket very quickly, there would be one more call to checkWrite() from AppOutputStream.write(AppOutputStream.java:124) and that would throw. See https://github.com/keerath/openjdk-8-source/blob/5f6e9d42a9f6b6736100c9c6f43f5f5ea1570cfb/jdk/src/share/classes/sun/security/ssl/AppOutputStream.java#L124 for relevant source code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdanek","name":"jdanek","key":"jdanek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jdanek&avatarId=27353","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jdanek&avatarId=27353","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jdanek&avatarId=27353","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jdanek&avatarId=27353"},"displayName":"Jiri Daněk","active":true,"timeZone":"Europe/Prague"},"created":"2018-05-09T15:55:40.852+0000","updated":"2018-05-09T15:55:40.852+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6956/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3td3j:"}}