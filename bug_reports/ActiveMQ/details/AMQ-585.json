{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483261","self":"https://issues.apache.org/jira/rest/api/2/issue/12483261","key":"AMQ-585","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315608","id":"12315608","description":"","name":"4.0 RC2","archived":false,"released":true,"releaseDate":"2006-04-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-03-06T21:23:13.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Apr 26 14:43:42 UTC 2016","customfield_12310420":"49225","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1278176000_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2006-03-07T11:30:15.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-585/watchers","watchCount":3,"isWatching":false},"created":"2006-02-20T16:27:19.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315607","id":"12315607","description":"Milestone 4","name":"4.0 M4","archived":false,"released":true,"releaseDate":"2006-01-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-04-26T14:43:42.985+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I am using ActiveMQ as part of a web-app deployed to Tomcat. Active MQ is configured via spring and follows the spring examples that you ship with the source in M4. If I configure the broker to use JMX (  <broker useJmx=\"true\"> ) and deploy the app to tomcat, everything goes fine. However, when I deploy a newer version of the app (hot deploy) I get the following error when the JMS consumer is created from spring:\n\n006-02-20 15:16:17,378 ERROR org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:205) Context initialization failed\norg.springframework.beans.factory.BeanCreationException: Error creating bean with name 'smsResponseConsumer' defined in ServletContext resource [/WEB-INF/applicationContext-messaging.xml]: Initialization of bean failed; nested exception is javax.jms.JMSException: org.apache.activemq:Type=Topic,Destination=ActiveMQ.Advisory.Connection,BrokerName=localhost\njavax.jms.JMSException: org.apache.activemq:Type=Topic,Destination=ActiveMQ.Advisory.Connection,BrokerName=localhost\n\nAnd the root cause of this exception is:\n\nCaused by: javax.management.InstanceAlreadyExistsException: org.apache.activemq:Type=Topic,Destination=ActiveMQ.Advisory.Connection,BrokerName=localhost\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:274)\n\tat org.apache.activemq.openwire.DataStreamMarshaller.createThrowable(DataStreamMarshaller.java:199)\n\tat org.apache.activemq.openwire.DataStreamMarshaller.unmarsalThrowable(DataStreamMarshaller.java:159)\n\tat org.apache.activemq.openwire.v1.ExceptionResponseMarshaller.unmarshal(ExceptionResponseMarshaller.java:67)\n\tat org.apache.activemq.openwire.OpenWireFormat.doUnmarshal(OpenWireFormat.java:214)\n\tat org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:181)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:135)\n\t... 1 more\n\nSo it appears as if the JMX entry isn't \"unbound\" when the applicaiton restarts on a redeploy.\n\nIf I set JMX to false then I can redeploy the application without any errors. \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"254653","customfield_12312823":null,"summary":"InstanceAlreadyExistsException on .war redeploy (if useJmx=\"true)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=massdosage","name":"massdosage","key":"massdosage","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mass Dosage","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=massdosage","name":"massdosage","key":"massdosage","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mass Dosage","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"SuSe Linux 9.1, Sun JDK 1.4.2_08, Tomcat 5.0.28","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483261/comment/12937549","id":"12937549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"BTW could you describe exactly how you are deploying ActiveMQ in spring please - as there are a few optoins. Are you using the BrokerFactoryBean?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-06T21:23:13.000+0000","updated":"2006-03-06T21:23:13.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483261/comment/12937546","id":"12937546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=massdosage","name":"massdosage","key":"massdosage","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mass Dosage","active":true,"timeZone":"Etc/UTC"},"body":"I am indeed using the BrokerFactoryBean. My spring config looks something like this:\n\n\t<!-- JMS CONFIGURATION -->\t\n\t<bean id=\"brokerContainer\" class=\"org.apache.activemq.xbean.BrokerFactoryBean\" depends-on=\"activeMQConfigurer\">\n\t\t<property name=\"config\" value=\"classpath:activemq.xml\"/>\n\t</bean>\n\t\n\t<bean id=\"jmsFactory\" class=\"org.apache.activemq.ActiveMQConnectionFactory\">\n\t\t<property name=\"brokerURL\" value=\"tcp://localhost:61616\"/>\n\t</bean>\n\t  \n\t<!-- Spring JMS Template -->\n\t<bean id=\"jmsTemplate\" class=\"org.springframework.jms.core.JmsTemplate\">\n\t\t<property name=\"connectionFactory\">\n\t\t\t<!-- lets wrap in a pool to avoid creating a connection per send -->\n\t\t\t<bean class=\"org.springframework.jms.connection.SingleConnectionFactory\">\n\t\t\t\t<property name=\"targetConnectionFactory\" ref=\"jmsFactory\"/>\n\t\t\t</bean>\n\t\t</property>\n\t\t<property name=\"pubSubDomain\" value=\"false\"/>\n\t</bean>\n\nThe broker is then configured in activemq.xml like so:\n\n  <broker useJmx=\"false\">\n\n\t<persistenceAdapter>\n      <journaledJDBC journalLogFiles=\"5\" dataDirectory=\"#activeMQConfigurer.dataDirectory\" dataSource=\"#activeMQConfigurer.dataSource\"/>\n    </persistenceAdapter>\n  \n    <transportConnectors>\n       <transportConnector uri=\"tcp://localhost:61616\"/>\n    </transportConnectors>\n    \n    <networkConnectors>\n      <networkConnector uri=\"static://(tcp://localhost:61616)\" />\n    </networkConnectors>\n    \n  </broker>\n\nLet me know if there is any other information you need...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=massdosage","name":"massdosage","key":"massdosage","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mass Dosage","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-06T22:52:48.000+0000","updated":"2006-03-06T22:52:48.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483261/comment/12937511","id":"12937511","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"I've just added the test case ReconnectWithJMXEnabledTest to ensure that all of our MBeans are properly unregistered if you call BrokerService.stop() (which should happen by default if you use the BrokerFactoryBean so AFAIK this issue is now resolved.\n\nIf you still have an issue, let us know more details on how you are using tomcat, spring and activemq and we can always reopen this issue\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-07T11:30:14.000+0000","updated":"2006-03-07T11:30:14.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483261/comment/12937651","id":"12937651","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"Incidentally if this still is an issye - is your Spring application context being closed? Do you see any logging when you undeploy the WAR? Which mechanism are you using in web.xml to load spring","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-08T10:03:36.000+0000","updated":"2006-03-08T10:03:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483261/comment/12942259","id":"12942259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akornev","name":"akornev","key":"akornev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Kornev","active":true,"timeZone":"Etc/UTC"},"body":"Hi!\nI use ActiveMq 5.2.0.\nIn web.xml spring context get by org.springframework.web.context.ContextLoaderListener\nPersistent = false\n\nAnd I have exception:\njavax.jms.JMSException: Could not create Transport. Reason: javax.management.InstanceAlreadyExistsException: org.apache.activemq:BrokerName=localhost,Type=Broker\n        at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:35) [org.apache.activemq-5.2.0.jar:5.2.0]\n        at org.apache.activemq.ActiveMQConnectionFactory.createTransport(ActiveMQConnectionFactory.java:239) [org.apache.activemq-5.2.0.jar:5.2.0]\n        at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:252) [org.apache.activemq-5.2.0.jar:5.2.0]\n        at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:224) [org.apache.activemq-5.2.0.jar:5.2.0]\n        at org.apache.activemq.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:172) [org.apache.activemq-5.2.0.jar:5.2.0]\n\nCould you please help me with my problem.\n\nThx!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akornev","name":"akornev","key":"akornev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Kornev","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-25T15:56:03.582+0000","updated":"2010-03-25T15:56:03.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483261/comment/15258194","id":"15258194","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stuchl4n3k","name":"stuchl4n3k","key":"stuchl4n3k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Petr Stuchlik","active":true,"timeZone":"Etc/UTC"},"body":"Hello there.\n\nSorry to bring this up again, but I am probably experiencing the same issue here 6 years later.\n\nSystem setup:\n - Linux Mint 17.3 x64\n - Tomcat 7 with activemq-all.jar (v5.10.0) in tomcat7/lib\n{code:title=Tomcat context.xml}\n<Resource name=\"jms/myConnectionFactory\" auth=\"Container\"\n              type=\"org.apache.activemq.ActiveMQConnectionFactory\"\n              description=\"JMS Connection Factory\"\n              factory=\"org.apache.activemq.jndi.JNDIReferenceFactory\"\n              brokerURL=\"vm://localhost\"\n              brokerName=\"LocalActiveMQBroker\"\n              userName=\"activemq\" password=\"activemq\"\n              useEmbeddedBroker=\"false\" />\n{code}\n\nUsing JMS with Spring 4.2.5 (Spring Integration JMS & Java DSL config). When invoking JMS outbound adapter I get the above-mentioned {{InstanceAlreadyExistsException}}.\nIf I add {{useJmx=\"false\"}}, the exception disappears.\n\nTo answer the questions for [~jstrachan]:\n - Spring context is closed. I tried clean deploy and tomcat restart as well. \n - I don't see any logging related to AMQ other than a clash of bindings (not related I suppose):\n{code}\nSLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/usr/share/tomcat7/lib/activemq-all.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: Found binding in [jar:file:/var/lib/tomcat7/webapps/ROOT/WEB-INF/lib/logback-classic-1.0.13.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [ch.qos.logback.classic.util.ContextSelectorStaticBinder]\n{code}\n - I load multiple xml classpath files including spring-context.xml in my web.xml. I also import some JavaConfig beans and use aop proxy. \n\nAny ideas?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stuchl4n3k","name":"stuchl4n3k","key":"stuchl4n3k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Petr Stuchlik","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-26T14:43:42.985+0000","updated":"2016-04-26T14:43:42.985+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-585/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i17z2v:"}}