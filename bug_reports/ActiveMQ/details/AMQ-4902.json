{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12681060","self":"https://issues.apache.org/jira/rest/api/2/issue/12681060","key":"AMQ-4902","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-11-25T15:15:31.875+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Nov 25 15:15:31 UTC 2013","customfield_12310420":"360325","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4902/watchers","watchCount":3,"isWatching":false},"created":"2013-11-25T15:03:45.361+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-11-25T15:15:31.875+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I noticed that the BrokerService uses a default ThreadPoolExecutor configured with a \"variable\" number of threads (1-10) and an unbounded queue (LinkedBlockingQueue).  The way that the oracle ThreadPoolExecutor is implemented makes this configuration very ineffective, as it will never use more than 1 thread.  The basic strategy in the ThreadPoolExecutor is to add threads until it gets to the \"core\" pool size (in this case 1) then prefer queueing.  only when an offer to the queue fails will threads be added beyond the core pool size.  since the LinkedBlockingQueue is unbounded, offer will never fail and no more threads will be added.\n\nThere are no great strategies for getting a good variable sized thread pool combined with an unbounded queue using the ThreadPoolExecutor.  2 possible solutions are:\n\n* Set min to the max and allow core threads to timeout\n* using a \"lying\" blocking queue which initially rejects offers, but then use a rejected execution handler which puts the elements on the queue.  this forces threads to be added up to the max before tasks get queued\n\nnote that i noticed this in the broker, but i believe this pattern is used in other activemq classes as well.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"360624","customfield_12312823":null,"summary":"ineffective use of ThreadPoolExecutor","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jahlborn","name":"jahlborn","key":"jahlborn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jahlborn","name":"jahlborn","key":"jahlborn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681060/comment/13831531","id":"13831531","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"body":"As a note:  CXF's workqueues end up using a hacked subclass of the oracle ThreadPoolExecutor to get around this same problem.   Could think about stealing some code from there.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"created":"2013-11-25T15:15:31.875+0000","updated":"2013-11-25T15:15:31.875+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4902/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1q45j:"}}