{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481643","self":"https://issues.apache.org/jira/rest/api/2/issue/12481643","key":"AMQ-639","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315610","id":"12315610","name":"4.0","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-03-17T07:41:22.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon May 01 22:03:04 UTC 2006","customfield_12310420":"49272","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_41716000_*|*_5_*:*_2_*:*_79677000_*|*_4_*:*_1_*:*_3860025000","customfield_12312321":null,"resolutiondate":"2006-05-01T22:03:04.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-639/watchers","watchCount":1,"isWatching":false},"created":"2006-03-16T20:06:06.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315607","id":"12315607","description":"Milestone 4","name":"4.0 M4","archived":false,"released":true,"releaseDate":"2006-01-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-05-01T22:03:04.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"I have set up a network of brokers with the following configuration:\n\n<beans xmlns=\"http://activemq.org/config/1.0\">\n\n  <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"/>\n  \n  <broker brokerName=\"bfe-${HOSTNAME}\" useJmx=\"true\" persistent=\"false\" managementContext=\"#mc\"> \n    <destinationPolicy>\n      <policyMap>\n        <policyEntries>\n          <policyEntry queue=\">\" memoryLimit=\"5000000\"/>\n        </policyEntries>\n      </policyMap>\n   </destinationPolicy>\n   <memoryManager>\n     <usageManager limit=\"100000000\"/>\n    </memoryManager> \n \n    <transportConnectors>\n    \t<transportConnector uri=\"tcp://localhost:61616\" discoveryUri=\"multicast://bfe2\"/> \n    </transportConnectors>\n    \n    <networkConnectors>\n      <!-- by default just auto discover the other brokers -->\n      <networkConnector uri=\"multicast://bfe2\"/>\n    </networkConnectors>\n   </broker>\n  \n <bean id=\"mc\" class=\"org.apache.activemq.broker.jmx.ManagementContext\">\n    <property name=\"connectorPort\" value=\"1099\"/>\n    <property name=\"connectorPath\" value=\"/jmxrmibfe-1\"/>\n  </bean>\n \n</beans>\n\nI then run a series of tests (producing and consuming on the network of brokers). Then I shut one broker down and then start it up again  it can't see the other brokers in the network but the other brokers can see it. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161479","customfield_12312823":null,"summary":"Broker is not re-connecting to a network of brokers after going down and then being brought back up","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bdiesenhaus","name":"bdiesenhaus","key":"bdiesenhaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Diesenhaus","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bdiesenhaus","name":"bdiesenhaus","key":"bdiesenhaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Diesenhaus","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481643/comment/12937532","id":"12937532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Thanks for the report!  Fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2006-03-17T07:41:22.000+0000","updated":"2006-03-17T07:41:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481643/comment/12937627","id":"12937627","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bdiesenhaus","name":"bdiesenhaus","key":"bdiesenhaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Diesenhaus","active":true,"timeZone":"Etc/UTC"},"body":"I did some testing this morning and here is what I found: \n1. The broker is re-connecting. Looking at the connection in the JMX console all the brokers can see each other. This was not the case before. \n2. The brokers that were not brought down are throwing the below exception when the broker re-connects. \n3. Running the test again after the broker comes up only about 1/3 of the message make it to the broker that was brought back up and then it .\n\n\nINFO: Async error occurred: javax.jms.InvalidClientIDException: Broker: bfe-grieg - Client: NC_bfe-holst_inboundbfe-grieg already connected\njavax.jms.InvalidClientIDException: Broker: bfe-grieg - Client: NC_bfe-holst_inboundbfe-grieg already connected\n        at org.apache.activemq.broker.region.RegionBroker.addConnection(RegionBroker.java:151)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:64)\n        at org.apache.activemq.advisory.AdvisoryBroker.addConnection(AdvisoryBroker.java:67)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:64)\n        at org.apache.activemq.broker.MutableBrokerFilter.addConnection(MutableBrokerFilter.java:76)\n        at org.apache.activemq.broker.AbstractConnection.processAddConnection(AbstractConnection.java:500)\n        at org.apache.activemq.command.ConnectionInfo.visit(ConnectionInfo.java:106)\n        at org.apache.activemq.broker.AbstractConnection.service(AbstractConnection.java:196)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:62)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:88)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:70)\n        at org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:75)\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:44)\n        at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:55)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport.startLocalBridge(DemandForwardingBridgeSupport.java:175)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport$3.run(DemandForwardingBridgeSupport.java:147)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bdiesenhaus","name":"bdiesenhaus","key":"bdiesenhaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Diesenhaus","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-17T19:11:39.000+0000","updated":"2006-03-17T19:11:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481643/comment/12937599","id":"12937599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"BTW I wonder if the exception you are getting is related to this fix...\n\nhttp://jira.activemq.org/jira/browse/AMQ-600\n\nwhich was causing InvalidClientIDException to be thrown when network errors occur by handling the IOException in the wrong way","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-17T19:35:36.000+0000","updated":"2006-03-17T19:35:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481643/comment/12937600","id":"12937600","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"(BTW that issue was fixed in the last hour or so in SVN)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-17T19:35:54.000+0000","updated":"2006-03-17T19:35:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481643/comment/12937715","id":"12937715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bdiesenhaus","name":"bdiesenhaus","key":"bdiesenhaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Diesenhaus","active":true,"timeZone":"Etc/UTC"},"body":"I pulled the latest code with the fix for AMQ-600 and I am still seeing the following issues: \n1. The brokers that were not brought down are still throwing the InvalidClientIDException when the broker that was brought down tries to re-connect.  \n2. Only about 1/3 of the message make it to the broker that was brought back up after running the test again. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bdiesenhaus","name":"bdiesenhaus","key":"bdiesenhaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Diesenhaus","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-17T21:27:29.000+0000","updated":"2006-03-17T21:27:29.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481643/comment/12937729","id":"12937729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"I've tried to setup a similar scenario.  And I do see some message loss but when the broker is taken down but that can be expected since the messages are not persistent.  Once the broker is brought back online, processing continues without message loss.  When a broker is shutdown, any transient messages he had in it's queues will be dropped.  Do you think this could explain the lost messages you've been seeing?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2006-04-25T20:25:32.000+0000","updated":"2006-04-25T20:25:32.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481643/comment/12936352","id":"12936352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2006-05-01T22:03:04.000+0000","updated":"2006-05-01T22:03:04.000+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-639/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s00n:"}}