{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482991","self":"https://issues.apache.org/jira/rest/api/2/issue/12482991","key":"AMQ-1600","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 09 21:06:35 UTC 2008","customfield_12310420":"84809","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_48762271804_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-09-12T06:45:46.254+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1600/watchers","watchCount":5,"isWatching":false},"created":"2008-02-25T21:41:14.450+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[{"id":"12334976","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334976","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12482306","key":"AMQ-1603","self":"https://issues.apache.org/jira/rest/api/2/issue/12482306","fields":{"summary":"EOFExceptions and Broken Pipe exceptions everywhere in 5.0 (my services seem to run fine under 4.1 and 4.1.1 and somewhat better in 5.1-SNAPSHOT [if you don't count the queue size problem] which is critical)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-09-12T06:45:46.216+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"If I create a topic and then have a producer write to the topic (non-persistent message) the items in the queueSize in JMX appears to be the total messages that I sent. Even if I start the consumer the number of items on the queue never goes down. If I run the same code in 4.1.0 the queue size is always 0 which is the expected behavior -- something changed in 5.1... Will try on 5.0 in a few minutes.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461228","id":"12461228","filename":"untitled.JPG","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparky2708","name":"sparky2708","key":"sparky2708","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denis Abramov","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-09T21:01:57.232+0000","size":41272,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12461228/untitled.JPG"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161463","customfield_12312823":null,"summary":"Number of items in Topic queue never empties out (Queue Size in JMX for every topic seems to be > 0 all the time)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparky2708","name":"sparky2708","key":"sparky2708","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denis Abramov","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparky2708","name":"sparky2708","key":"sparky2708","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denis Abramov","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482991/comment/12939347","id":"12939347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparky2708","name":"sparky2708","key":"sparky2708","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denis Abramov","active":true,"timeZone":"Etc/UTC"},"body":"Doesn't seem this problem exists in 5.0.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparky2708","name":"sparky2708","key":"sparky2708","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denis Abramov","active":true,"timeZone":"Etc/UTC"},"created":"2008-02-25T23:27:05.722+0000","updated":"2008-02-25T23:27:05.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482991/comment/12939914","id":"12939914","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparky2708","name":"sparky2708","key":"sparky2708","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denis Abramov","active":true,"timeZone":"Etc/UTC"},"body":"running ActiveMQ 5.1.0:\n\nHow can Dequeuecount == Enqueuecount == Dispatchcount and QueueSize != 0?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparky2708","name":"sparky2708","key":"sparky2708","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denis Abramov","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-09T21:01:57.284+0000","updated":"2008-07-09T21:01:57.284+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482991/comment/12939965","id":"12939965","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparky2708","name":"sparky2708","key":"sparky2708","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denis Abramov","active":true,"timeZone":"Etc/UTC"},"body":"Not really doing anything fancy to have this issue happen... just calling send many times: persistent = false and looking at JConsole... \n\n/*********************************************************************\n\t * Create a connection to the messaging system\n\t * \n\t * @param jms_url\n\t * @param intf\n\t * @param is_durable_subscriber\n\t * @throws Exception\n\t *********************************************************************/\n\tpublic void createConnection(String jms_url, MessageManagerIntf intf, boolean is_durable_subscriber) throws Exception {\n\t\t_jms_url = jms_url;\n\t\t_is_durable_subscriber = is_durable_subscriber;\n\t\t_msg_wrapper_intf = intf;\n\t\t\n\t\tlog.info(\"\");\n\t\tlog.info(\"\");\n\t\tlog.info(\"Creating Connection to: \" + jms_url);\n\t\tlog.info(\"\");\n\t\tString user = ActiveMQConnection.DEFAULT_USER;\n\t\tString password = ActiveMQConnection.DEFAULT_PASSWORD;\n\t\t\n\t\t//jms_url = addJMSOptions(jms_url);\n\t\tActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(user, password, jms_url);\n\t\tconnectionFactory.setDispatchAsync(true);\n\t\tconnectionFactory.setUseAsyncSend(true);\n\t\t\n\t\t_connection = connectionFactory.createConnection();\n\t\t_connection.setExceptionListener(this);\n\t\t\n\t\tif (is_durable_subscriber)\n\t\t\t_connection.setClientID(_msg_wrapper_intf.getClass().getSimpleName());\n\t\telse {\n\t\t\tSimpleDateFormat f = new SimpleDateFormat(\"M/d/yyyy h_mm_ss a\");\n\t\t\tCalendar cal = Calendar.getInstance();\n\t\t\t_connection.setClientID(_msg_wrapper_intf.getClass().getSimpleName().toLowerCase() + \"@\" +  InetAddress.getLocalHost().getHostName().toUpperCase() + \"-\" + f.format(cal.getTime()) + \"--\" + cal.getTimeInMillis());\n\t\t}\n\t\t\n\t\tlog.info(\"JMS VERSION: \" + _connection.getMetaData().getJMSVersion());\n\t\tlog.info(\"JMS PROVIDER: \" + _connection.getMetaData().getJMSProviderName());\n\t\tlog.info(\"JMS PROVIDER VERSION: \" + _connection.getMetaData().getProviderVersion());\n\t\tlog.info(\"CLIENT ID: \" + _connection.getClientID());\n\t\t\n\t\t_connection.start();\n\t\t_session = _connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\n\t}\n\t\n\npublic void send(String name, DESTINATION_TYPE destination_type, Destination reply_to, MessageIntf wrapper, boolean persistent) throws Exception { \n                Destination dest = createDestination(name, destination_type); \n                MessageProducer publisher = getProducer(dest, persistent); \n                          \n                          //wrapper.generateXMLMessage() just generates some XML message. \n                TextMessage msg = _session.createTextMessage(wrapper.generateXMLMessage()); \n                msg.setJMSReplyTo(reply_to); \n                log.debug(this.getClass().getName() + \">>>>>> SENDING MESSAGE TO '\" + dest + \"': \" + wrapper.generateXMLMessage()); \n                publisher.send(msg); \n} \n\n\n\n\n        public MessageProducer getProducer(Destination dest, boolean persistent) throws Exception { \n                //just a little optimization so I don't have too many producing running amock. Have 1 producer per destination \n\n                         if (_producer_cache.containsKey(dest.toString())) \n                        return _producer_cache.get(dest.toString()); \n                \n                MessageProducer publisher = _session.createProducer(dest); \n                if(persistent) \n                        publisher.setDeliveryMode(DeliveryMode.PERSISTENT); \n                else \n                        publisher.setDeliveryMode(DeliveryMode.NON_PERSISTENT); \n                \n                _producer_cache.put(dest.toString(), publisher); \n                return publisher; \n        } \n\n\n/******************************************************************** \n         * Create a topic \n         * @param name \n         * @return \n         * @throws JMSException \n         * \n         *******************************************************************/ \n        public Destination createDestination(String name, DESTINATION_TYPE destination) throws JMSException { \n                switch (destination) { \n                case TOPIC: \n                        return _session.createTopic(name); \n                case QUEUE: \n                        return _session.createQueue(name); \n                default: \n                        return null; \n                } \n        } \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sparky2708","name":"sparky2708","key":"sparky2708","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Denis Abramov","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-09T21:06:35.625+0000","updated":"2008-07-09T21:06:35.625+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1600/votes","votes":4,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rzx3:"}}