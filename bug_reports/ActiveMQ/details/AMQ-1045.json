{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483318","self":"https://issues.apache.org/jira/rest/api/2/issue/12483318","key":"AMQ-1045","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2007-05-04T14:06:29.967+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 27 21:32:19 UTC 2011","customfield_12310420":"33745","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_229000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_14773965986_*|*_4_*:*_1_*:*_138871549700","customfield_12312321":null,"resolutiondate":"2011-09-27T21:32:19.628+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1045/watchers","watchCount":9,"isWatching":false},"created":"2006-11-14T14:09:55.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315610","id":"12315610","name":"4.0","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-09-27T21:32:19.681+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The DefaultMessageListenerContainer has retry logic built into it. When a connection dies it tried to reconnect by getting a new connection from the ConnectionFactory. Since the PooledConenctionFactory has one Connection it, it keeps on trying to give out the Connection that died. We would like the PooledConnectionFactory to be able to \"evict\" the dead connection and create a new one.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172126","customfield_12312823":null,"summary":"PooledConnectionFactory does not work with the org.springframework.jms.listener.DefaultMessageListenerContainer in the failure case","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483318/comment/12938624","id":"12938624","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Fixed in trunk rev 474799 and in 4.1 branch rev 474800","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2006-11-14T14:13:44.000+0000","updated":"2006-11-14T14:13:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483318/comment/12938971","id":"12938971","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickolka","name":"mickolka","key":"mickolka","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mykola Paliyenko","active":true,"timeZone":"Etc/UTC"},"body":"Similar problem\n4.1.1 rev 533993\nsometimes when I shut down one of ActiveMQ servers that configured in JDBC master-slave way \nDefaultMessageListenerContainer does not reconnect.\nMessages are published but not consumed\n\nConfig of container\n    <bean class=\"org.springframework.jms.listener.DefaultMessageListenerContainer\">\n        <property name=\"autoStartup\" value=\"${jms.sms.start}\" />\n        <property name=\"concurrentConsumers\" value=\"${jms.sms.concurrent.consumers}\" />\n        <property name=\"connectionFactory\" ref=\"jmsConnectionFactory\" />\n        <property name=\"destination\" ref=\"jmsSmsDestination\" />\n        <property name=\"messageListener\" ref=\"smsJmsListener\" />\n        <property name=\"sessionTransacted\" value=\"true\"></property>\n    </bean>\nConnection factory\n\n\t<bean id=\"jmsConnectionFactory\"\n\t\tclass=\"org.apache.activemq.pool.PooledConnectionFactory\"\n\t\tinit-method=\"start\" destroy-method=\"stop\">\n\t\t<property name=\"connectionFactory\">\n\t\t\t<bean\n\t\t\t\tclass=\"org.apache.activemq.ActiveMQConnectionFactory\">\n\t\t\t\t<property name=\"brokerURL\"\n\t\t\t\t\tvalue=\"failover:(tcp://localhost:61616,tcp://localhost:61716)\" />\n\t\t\t\t<property name=\"redeliveryPolicy\">\n\t\t\t\t\t<bean class=\"org.apache.activemq.RedeliveryPolicy\">\n\t\t\t\t\t\t<property name=\"backOffMultiplier\" value=\"3\"/>\n\t\t\t\t\t\t<property name=\"useExponentialBackOff\" value=\"true\"/>\n\t\t\t\t\t\t<property name=\"maximumRedeliveries\" value=\"11\"></property>\n\t\t\t\t\t\t<property name=\"initialRedeliveryDelay\" value=\"2000\"></property>\n\t\t\t\t\t</bean>\n\t\t\t\t</property>\n\t\t\t</bean>\n\t\t</property>\n\t</bean>\n\n\nAlso whenit reconeects it show such messages often\n\nDEBUG AbstractRegion                 - Removing consumer: ID:MPaliyenkoN2-3962-1178284368281-1:0:1:2014\nDEBUG AbstractRegion                 - Adding consumer: ID:MPaliyenkoN2-3962-1178284368281-1:0:1:2015\nDEBUG AbstractRegion                 - Removing consumer: ID:MPaliyenkoN2-3962-1178284368281-1:0:1:2015\nDEBUG AbstractRegion                 - Adding consumer: ID:MPaliyenkoN2-3962-1178284368281-1:0:1:2016\nDEBUG AbstractRegion                 - Removing consumer: ID:MPaliyenkoN2-3962-1178284368281-1:0:1:2016\nDEBUG AbstractRegion                 - Adding consumer: ID:MPaliyenkoN2-3962-1178284368281-1:0:1:2017\nDEBUG AbstractRegion                 - Removing consumer: ID:MPaliyenkoN2-3962-1178284368281-1:0:1:2017\nDEBUG AbstractRegion                 - Adding consumer: ID:MPaliyenkoN2-3962-1178284368281-1:0:1:2018\n\n\nAfter I switched several times the messages dissapeared.\n\nServer config\n\n<beans>\n\n<!-- Allows us to use system properties as variables in this configuration file -->\n<bean class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"/>\n\n<broker brokerName=\"localhost\" useJmx=\"true\" xmlns=\"http://activemq.org/config/1.0\">\n\n<!-- Use the following to set the broker memory limit\n<memoryManager>\n<usageManager id=\"memory-manager\" limit=\"20 MB\"/>\n</memoryManager>\n-->\n\n<!-- Use the following to configure how ActiveMQ is exposed in JMX\n<managementContext>\n<managementContext connectorPort=\"1099\" jmxDomainName=\"org.apache.activemq\"/>\n</managementContext>\n-->\n\n<persistenceAdapter>\n<jdbcPersistenceAdapter dataSource=\"#mysql-ds\"/>\n</persistenceAdapter>\n\n<transportConnectors>\n<transportConnector name=\"openwire\" uri=\"tcp://localhost:61616\"/>\n<transportConnector name=\"ssl\" uri=\"ssl://localhost:61617\"/>\n<transportConnector name=\"stomp\" uri=\"stomp://localhost:61613\"/>\n</transportConnectors>\n\n<networkConnectors>\n<!-- by default just auto discover the other brokers -->\n<networkConnector name=\"default-nc\" uri=\"multicast://default\"/>\n<!--\n<networkConnector name=\"host1 and host2\" uri=\"static://(tcp://host1:61616,tcp://host2:61616)\" failover=\"true\"/>\n-->\n</networkConnectors>\n\n</broker>\n\n<bean id=\"mysql-ds\" class=\"org.apache.commons.dbcp.BasicDataSource\" destroy-method=\"close\">\n<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\"/>\n<property name=\"url\" value=\"jdbc:mysql://localhost/sonoportal?relaxAutoCommit=true\"/>\n<property name=\"username\" value=\"root\"/>\n<property name=\"password\" value=\"\"/>\n</bean>\n\n</beans>\n\nplease suggest","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickolka","name":"mickolka","key":"mickolka","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mykola Paliyenko","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-04T14:06:29.967+0000","updated":"2007-05-04T14:06:29.967+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483318/comment/12939473","id":"12939473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"body":"Did not get fixed in 4.1.2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-04-07T22:22:02.401+0000","updated":"2008-04-07T22:22:02.401+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483318/comment/12941752","id":"12941752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bunyaminsinif","name":"bunyaminsinif","key":"bunyaminsinif","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"kurt","active":true,"timeZone":"Etc/UTC"},"body":"PooledConnectionFactory does not deal with pooling of consumers; for that look at a library like Jencks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bunyaminsinif","name":"bunyaminsinif","key":"bunyaminsinif","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"kurt","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-16T15:19:38.713+0000","updated":"2009-07-16T15:19:38.713+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483318/comment/13115950","id":"13115950","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The 4.x broker line is EOL.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-09-27T21:32:19.665+0000","updated":"2011-09-27T21:32:19.665+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1045/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ttqf:"}}