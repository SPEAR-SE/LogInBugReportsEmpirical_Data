{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483015","self":"https://issues.apache.org/jira/rest/api/2/issue/12483015","key":"AMQ-2389","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2009-09-14T13:59:51.042+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 15 17:13:14 UTC 2009","customfield_12310420":"96089","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_238364811_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-09-14T13:59:51.094+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2389/watchers","watchCount":1,"isWatching":false},"created":"2009-09-11T19:47:06.283+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-09-15T17:13:14.473+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When persistent=true for the broker, a fast producer / slow consumer may cause ActiveMQ to block on a SocketWrite0() call.  The following thread dump signature results:\n\n...\n\"ActiveMQ Transport: tcp://localhost/127.0.0.1:61610\" prio=5 tid=0x0000000101942000 nid=0x1548c4000 waiting for monitor entry [0x00000001548c3000..0x00000001548c3a50]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:220)\n\t- waiting to lock <0x0000000107d29848> (a java.util.concurrent.atomic.AtomicBoolean)\n\tat org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:185)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)\n\tat java.lang.Thread.run(Thread.java:637) \n...\n\"main\" prio=5 tid=0x0000000101805000 nid=0x101201000 runnable [0x0000000101200000..0x0000000101200ba0]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.SocketOutputStream.socketWrite0(Native Method)\n\tat java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n\tat java.net.SocketOutputStream.write(SocketOutputStream.java:136)\n\tat org.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedOutputStream.java:115)\n\tat java.io.DataOutputStream.flush(DataOutputStream.java:106)\n\tat org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:167)\n\tat org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:233)\n\t- locked <0x0000000107d29848> (a java.util.concurrent.atomic.AtomicBoolean)\n\tat org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:83)\n\tat org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:100)\n\tat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\n\t- locked <0x0000000107d299b0> (a java.lang.Object)\n\tat org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\n\tat org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1214)\n\tat org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1208)\n\tat org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1643)\n\t- locked <0x0000000107d35a68> (a java.lang.Object)\n\tat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:227)\n\tat org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:300)\n\tat com.chad.test.ActiveMQSpamTest1.runTest(ActiveMQSpamTest1.java:73)\n\t- locked <0x0000000107ca6680> (a org.apache.activemq.ActiveMQMessageProducer)\n\tat com.chad.test.ActiveMQSpamTest1.main(ActiveMQSpamTest1.java:117)\n\nThe attached test instantiates an embedded broker and consistently duplicates the problem on my machine (Macbook Pro running Leopard).  The test duplicates behavior we see in production code, which is running an embedded broker on Debian Linux.\n\nI run the test in Eclipse with -Xmx1100mb.  The output I see (after a minute or so) is:\n\n...\nSENT a (mod 10000) message: i=0\nSENT a (mod 10000) message: i=10000\nSENT a (mod 10000) message: i=20000\nSENT a (mod 10000) message: i=30000\nSENT a (mod 10000) message: i=40000\nSENT a (mod 10000) message: i=50000\nSep 11, 2009 3:28:13 PM org.apache.activemq.kaha.impl.KahaStore initialize\nINFO: Kaha Store using data directory activemq-data/localhost/tmp_storage\nRECEIVED a (mod 10000) message: i=10000\nRECEIVED a (mod 10000) message: i=20000\nRECEIVED a (mod 10000) message: i=30000\nRECEIVED a (mod 10000) message: i=40000\nRECEIVED a (mod 10000) message: i=50000 \n\nafter which no further messages are processed, and a thread dump includes the signature shown above.  Uncommenting the line\n\nbroker.setPersistent(false);\n\nresults in the test running to completion (all messages are sent/consumed), with the following output:\n\nSENT a (mod 10000) message: i=0\nSENT a (mod 10000) message: i=10000\nSENT a (mod 10000) message: i=20000\nSENT a (mod 10000) message: i=30000\nSENT a (mod 10000) message: i=40000\nSENT a (mod 10000) message: i=50000\nSENT a (mod 10000) message: i=60000\nRECEIVED a (mod 10000) message: i=10000\nDONE sending messages\nRECEIVED a (mod 10000) message: i=20000\nRECEIVED a (mod 10000) message: i=30000\nRECEIVED a (mod 10000) message: i=40000\nRECEIVED a (mod 10000) message: i=50000\nRECEIVED a (mod 10000) message: i=60000\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461259","id":"12461259","filename":"ActiveMQSpamTest1.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-11T19:51:06.792+0000","size":3742,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461259/ActiveMQSpamTest1.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461290","id":"12461290","filename":"screenshot-1.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-11T19:57:27.127+0000","size":19209,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12461290/screenshot-1.jpg"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"255253","customfield_12312823":null,"summary":"ActiveMQ hangs on SocketWrite0() with fast producer / slow consumer after MemoryLimit is reached","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"$ cat /proc/version\nLinux version 2.6.18-6-amd64 (Debian 2.6.18.dfsg.1-23etch1) (dannf@debian.org) (gcc version 4.1.2 20061115 (prerelease) (Debian 4.1.1-21)) #1 SMP Fri Dec 12 05:49:32 UTC 2008\n\nOS X","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483015/comment/12941671","id":"12941671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"body":"Attached code that reproduces the problem. (-Xmx1100m)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-11T19:51:06.903+0000","updated":"2009-09-11T19:51:06.903+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483015/comment/12941679","id":"12941679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"body":"Note that uncommenting the lines\n\n\t\tactiveMQConnectionFactory.setUseAsyncSend( true );\n\t\tactiveMQConnectionFactory.setProducerWindowSize(1024*1024);\n\nin the attached test results in ActiveMQ blocking before the MemoryLimit is reached.  This feels like a separate bug.\n\nThe following thread dump signature results in this case:\n\n...\n\"main\" prio=5 tid=0x0000000101805000 nid=0x101201000 in Object.wait() [0x0000000101200000..0x0000000101200ba0]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <0x0000000107c43ad8> (a java.lang.Object)\n\tat java.lang.Object.wait(Object.java:485)\n\tat org.apache.activemq.usage.MemoryUsage.waitForSpace(MemoryUsage.java:67)\n\t- locked <0x0000000107c43ad8> (a java.lang.Object)\n\tat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:221)\n\tat org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:300)\n\tat com.chad.test.ActiveMQSpamTest1.runTest(ActiveMQSpamTest1.java:74)\n\t- locked <0x0000000107c93088> (a org.apache.activemq.ActiveMQMessageProducer)\n\tat com.chad.test.ActiveMQSpamTest1.main(ActiveMQSpamTest1.java:117)\n...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-11T20:05:56.186+0000","updated":"2009-09-11T20:05:56.186+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483015/comment/12941601","id":"12941601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"You've hit flow control - you can disable it if you wish  see http://activemq.apache.org/producer-flow-control.html\nNote: flow control is disabled by default in 5.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-14T13:59:51.042+0000","updated":"2009-09-14T13:59:51.042+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483015/comment/12941658","id":"12941658","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"body":"Why does uncommenting \n\nactiveMQConnectionFactory.setProducerWindowSize(1024*1024);\n\nin the attached test result in a hang with the following thread blocking?\n\n\"main\" prio=5 tid=0x0000000101805000 nid=0x10174a000 in Object.wait() [0x0000000101749000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <0x00000001089cede8> (a java.lang.Object)\n\tat java.lang.Object.wait(Object.java:485)\n\tat org.apache.activemq.usage.MemoryUsage.waitForSpace(MemoryUsage.java:67)\n\t- locked <0x00000001089cede8> (a java.lang.Object)\n\tat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:221)\n\tat org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:300)\n\tat com.chad.test.ActiveMQSpamTest1.runTest(ActiveMQSpamTest1.java:82)\n\t- locked <0x000000010894a5b0> (a org.apache.activemq.ActiveMQMessageProducer)\n\tat com.chad.test.ActiveMQSpamTest1.main(ActiveMQSpamTest1.java:125)\n\nShouldn't I be able to use producer flow control such that this test runs to completion?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-14T15:27:00.627+0000","updated":"2009-09-14T15:27:00.627+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483015/comment/12940890","id":"12940890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"body":"Including the text of an email from an offline conversation:\n\n{quote}\nHi Chad,\nanswers inline\n{quote}\nOn 15 Sep 2009, at 14:53, Chad Showalter wrote:\n\nHello Rob,\n\nThanks for your feedback on AMQ-2389. We're trying to understand what we should expect from producer flow control as implemented in 5.2. You very correctly point out that disabling producer flow control allows the test I've attached to AMQ-2389 to run to completion. However, with flow control enabled (the 5.2 default), and with a reasonable producer window size set, as recommended at\n\nhttp://activemq.apache.org/producer-flow-control.html\n\nfor async sends, the test does not complete (to see this behavior, uncomment the line in our test calling setProducerWindowSize()). It seems counterintuitive to us that the fix for a problem that occurs as the result of a fast producer / slow consumer would be to turn off producer flow control. Isn't this producer/consumer mismatch the very reason producer flow control was implemented?\n\n{quote}\nYes - and producer flow control does have its place. What happens with flow control turned off is that messages overflow to temporary storage on disk - if they can't be delivered fast enough to a consumer. This only happens when the broker runs into its memory limit. What we have found that the cases where it might be more appropriate for flow control are fewer than overflowing to temporary storage.\n{quote}\n\nIt seems others have experienced similar problems with flow control. E.g.,\n\nhttp://kovyrin.net/2009/01/23/activemq-tips-flow-control-and-stalled-producers-problem/\n\nA couple specific questions:\n\n1. Is producer flow control fundamentally \"broken\" in 5.2?\n{quote}\nNot completely - though there are some issues around it that have been fixed in trunk - or Fuse MQ - which is really ActiveMQ 5.3\n{quote}\n\n2. If not, how can we configure it to allow the test in AMQ-2389 (or a similar situation with fast producers / slow consumers) to run to completion? (If this is impossible, why so?)\n\n3. Why would we NOT want producer flow control when we have bursty producers that may occasionally temporarily swamp consumers\n{quote}\nFor your use case - flow control off does seem to be the best option - as messages will overflow to temporary storage - and then only block producers when that limit is reached.\nIn reality its badly named - flow control off is really offline to disk first - then do flow control when the limit is reached.\n{quote}\n\n\nThanks,\nChad \n\n{quote}\ncheers,\n\nRob\n{quote}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadshowalter","name":"chadshowalter","key":"chadshowalter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Showalter","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-15T17:13:14.383+0000","updated":"2009-09-15T17:13:14.383+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2389/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i182s7:"}}