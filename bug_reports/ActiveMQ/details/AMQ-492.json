{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483301","self":"https://issues.apache.org/jira/rest/api/2/issue/12483301","key":"AMQ-492","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-03-17T17:59:01.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 05 14:38:09 UTC 2011","customfield_12310420":"46468","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5093827000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_23990270000_*|*_4_*:*_1_*:*_151216865065","customfield_12312321":null,"resolutiondate":"2011-10-05T14:38:09.002+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-492/watchers","watchCount":0,"isWatching":false},"created":"2006-01-17T19:02:07.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315610","id":"12315610","name":"4.0","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-10-05T14:38:09.061+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"I have been trying to get my head around the multicast discovery mechanism.  In particular its use of the FailoverTransport class is bothering me.  The issue presented itself when viewing the DEBUG level log entries that were generated after one broker of a pair, connected using this discovery mechanism, was stopped.  The FailoverTransport went into a very tight endless loop of attempts to reconnect.\n\nMy first thought to tweak the Failover properties in the network connector URI.  But alais, the uri was for the multicast not the failover.  No problem, just duplicate the failover properties on the multicast agent.  After doing so, I started to think why is failover needed at all  wont the connection be reestablished when the broker returns and advertises itself again?\n\nCan someone comment on this issue?  Is the bug that the failover properties where not available or is the problem that failover was used at all?\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59875","customfield_12312823":null,"summary":"Design error in MulticastDiscoveryAgent use of FailoverTransportConnector?","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"w2k and linux w java 1.5","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483301/comment/12937299","id":"12937299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"Maybe jumped the gun again.  Looking a little further I found that the NetworkConnector member failover=true, so if it is explicitly set off, then the multicast discovery transport works more like I expected.\n\nBut then that still leave to question what would the purpose of \"failover\" mode be with used of multicast discovery.  And if it has a purpose then all the failover properties should be exposed and passed through the multicast discovery again uri.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2006-01-17T19:22:44.000+0000","updated":"2006-01-17T19:22:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483301/comment/12937357","id":"12937357","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"Okay, walking back out onto the limb again.  While setting the failover value to false on the network connector forces use of the TcpTransportConnector, I am not sure that the bridge is fully established again after the missing broker is seen found.  There are entries in the log such as:\n\n2006-01-17 11:16:37,882 [Discovery: null] INFO  NetworkConnector               - Establishing network connection between vm://roadrashA?network=true and null at tcp://harley:61616\n2006-01-17 11:16:37,913 [Discovery: null] INFO  TransportConnector             - Accepting connection on: vm://roadrashA\n2006-01-17 11:16:38,038 [Discovery: null] INFO  DemandForwardingBridge         - Starting a network connection between vm://roadrashA#0 and tcp://harley/172.16.12.88:61616 has been established.\n2006-01-17 11:17:07,101 [Discovery: null] DEBUG AbstractConnection             - Sync error occurred: javax.jms.InvalidClientIDException: No clientID specified for connection disconnect request\n\nat the time of the initial connection with the remote broker.  However when the connection is broken then re-established, the only entries in the log indicating such is:\n\n2006-01-17 11:18:14,820 [.16.12.88:32972] DEBUG TcpTransport                   - TCP consumer thread starting\n2006-01-17 11:18:15,007 [.16.12.88:32972] DEBUG AbstractConnection             - Async error occurred: javax.jms.InvalidClientIDException: No clientID specified for connection request\n\nI will run some additional tests, but logs do not look promising.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2006-01-17T19:34:56.000+0000","updated":"2006-01-17T19:34:56.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483301/comment/12937749","id":"12937749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"There was a question of why use failover??  If you don't expect a node in the cluster to be taken offline for an extended period of time, using reliable helps the stablebility between the brokers since by using failover, if a node in the cluster a transient outage, the rest of the cluster will see him as still being online.\n\nI think the gist of the last comment is that that broker was not reconnecting when a clustered broker is bounced.\n\nIf so, then this is related to AMQ-639 which is now fixed.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2006-03-17T17:59:01.000+0000","updated":"2006-03-17T17:59:01.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483301/comment/12938783","id":"12938783","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tryma","name":"tryma","key":"tryma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Trym A","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nWe have been experiencing a strange issue with our setup of paired brokers (using incubator-activemq-4.1).\nRunning our brokers with the Rootlogger set to DEBUG level we experience the same issues with the FailoverTransport going into a very tight endless loop of reconnection attempts upon shutdown of one broker of a pair.\n\nOur environment:\n\nWe have two servers (dev1 and dev2) where we have a broker running on each. They both share the same Oracle datasource. Starting the broker on either server, this broker becomes the Master-broker on the datasource, whereas the second broker will report \"Attempting to acquire the exclusive lock to become the Master broker\" upon startup.\n\nThis is all fine. The problem occurs however when attempting to shutdown the Master-broker where we expect the slave-broker to become the new Master-broker. Running under DEBUG-level, the Master-broker hangs indefinitely.\n\nChanging to log-level INFO fixes the problem.\n\nPlease advise if there is some bug connected to the FailoverTransport if the log-level happens to be DEBUG.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tryma","name":"tryma","key":"tryma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Trym A","active":true,"timeZone":"Etc/UTC"},"created":"2006-12-20T09:57:04.000+0000","updated":"2006-12-20T09:57:04.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483301/comment/12939213","id":"12939213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Hi Trym could you attach a test case to this issue?  I have not seen this behavior so far.  A test case would help us validate the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2007-10-23T14:18:39.703+0000","updated":"2007-10-23T14:18:39.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483301/comment/13121011","id":"13121011","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"4.x broker is EOL","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-10-05T14:38:09.059+0000","updated":"2011-10-05T14:38:09.059+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-492/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0am8f:"}}