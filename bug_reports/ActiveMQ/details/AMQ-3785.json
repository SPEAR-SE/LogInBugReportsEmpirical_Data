{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12547959","self":"https://issues.apache.org/jira/rest/api/2/issue/12547959","key":"AMQ-3785","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321258","id":"12321258","description":"Next v5 maintenance release","name":"5.7.0","archived":false,"released":true,"releaseDate":"2012-10-08"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-04-13T22:25:02.116+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Dec 17 16:11:46 UTC 2012","customfield_12310420":"233056","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_9836786614_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-07-16T12:13:13.432+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3785/watchers","watchCount":3,"isWatching":false},"created":"2012-03-24T15:46:47.170+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-12-17T16:11:46.866+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The createTransport method in ActiveMQSslConnectionFactory delegates to the super class if the URI scheme \nis not ssl. Failover URIs have 'failover' as the URI scheme and so always delegate to the superclass. This causes\nssl connections that need key or trust stores manipulated by code to hang or fail  as the credentials are not available. \n\nCode from  SVN trunk for ActiveMQSslConnectionFactory shows why\n\n protected Transport createTransport() throws JMSException {\n        // If the given URI is non-ssl, let superclass handle it.\n        if (!brokerURL.getScheme().equals(\"ssl\")) {\n            return super.createTransport();\n        }\n// !! jackf comment Code below never reached for failover URIs like failover:ssl:... or failover:(tcp:..., ssl...)\n// because the URI Scheme is failover, not ssl.\n// Therefore connections that need a keyManager or trustManager fail\n\n        try {\n            if (keyManager == null || trustManager == null) {\n                trustManager = createTrustManager();\n                keyManager = createKeyManager();\n                // secureRandom can be left as null\n            }\n            SslTransportFactory sslFactory = new SslTransportFactory();\n            SslContext ctx = new SslContext(keyManager, trustManager, secureRandom);\n            SslContext.setCurrentSslContext(ctx);\n            return sslFactory.doConnect(brokerURL);\n        } catch (Exception e) {\n            throw JMSExceptionSupport.create(\"Could not create Transport. Reason: \" + e, e);\n        }\n    }\n \n(Vague) Solution: 1) need better pattern match than URI scheme to detect requests for ssl connections. 2) A failover URI is  essentially a list of URIs so multiple ssl transport requests may be in the failover list. A first start is to require that the same key and trust stores are used for all failover connections but you may want to consider allowing customized stores for each of the ssl connections.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12542149","id":"12542149","filename":"ActiveMQFailoverTest.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryce","name":"bryce","key":"bryce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryce Prescott","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-23T16:38:22.881+0000","size":3741028,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12542149/ActiveMQFailoverTest.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12560649","id":"12560649","filename":"client.keystore","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"created":"2012-12-12T21:52:24.377+0000","size":2201,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12560649/client.keystore"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12560650","id":"12560650","filename":"server.keystore","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"created":"2012-12-12T21:52:24.386+0000","size":2201,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12560650/server.keystore"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12560648","id":"12560648","filename":"ssltruststore.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"created":"2012-12-12T21:52:24.355+0000","size":8600,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12560648/ssltruststore.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59189","customfield_12312823":null,"summary":"ActiveMQSslConnectionFactory does not detect ssl request in failover URIs when creating transports","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jackf","name":"jackf","key":"jackf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jack Fitch","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jackf","name":"jackf","key":"jackf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jack Fitch","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Looks global from SVN source but I detected with JDK 1.6.0_31 on Redhat Linux client using AMQ 5.5.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547959/comment/13253808","id":"13253808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Should provide unit tests and patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-04-13T22:25:02.116+0000","updated":"2012-04-13T22:25:02.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547959/comment/13415046","id":"13415046","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"fix in http://svn.apache.org/viewvc?rev=1361984&view=rev\nthe sslfactory was bypassing normal transport factory resolution. fix is to have it use the sslcontext thread local, which is respected by the ssltransport factory.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-16T12:13:13.585+0000","updated":"2012-07-16T12:13:13.585+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547959/comment/13440423","id":"13440423","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryce","name":"bryce","key":"bryce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryce Prescott","active":true,"timeZone":"Etc/UTC"},"body":"I downloaded the ActiveMQ 5.7 snapshot Jars and still had a similar issue. See attached zip file.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryce","name":"bryce","key":"bryce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryce Prescott","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-23T16:34:57.614+0000","updated":"2012-08-23T16:34:57.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547959/comment/13440427","id":"13440427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryce","name":"bryce","key":"bryce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryce Prescott","active":true,"timeZone":"Etc/UTC"},"body":"Here it is. \n\nThe SSL failover fails with a certificate_unknown error using\nActiveMQSslConnectionFactory.setKeyAndTrustManagers\n\nIf, however, that line of code is commented out and Thread.setSslContext is used instead it does work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryce","name":"bryce","key":"bryce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryce Prescott","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-23T16:38:22.888+0000","updated":"2012-08-23T16:38:22.888+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547959/comment/13530391","id":"13530391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"body":"This patch fixes the original issue that was brought up with here.  \n\nThe problem was that the getUrlOrResourceAsStream method would assume that the passed store name was formatted as a url or was available on the classpath.  It does not take into account the possibility that the store was not located in the classpath and that the passed store name was not converted into a url.\n\nThis patch fixes this issue. \n\nNote that the attached stores are copies from the activemq-stomp module.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"created":"2012-12-12T21:52:24.389+0000","updated":"2012-12-12T21:52:24.389+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547959/comment/13534029","id":"13534029","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"body":"I have created a new issue, AMQ-4227, to track the bug that I noticed using the test case that was attached to this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"created":"2012-12-17T16:11:46.866+0000","updated":"2012-12-17T16:11:46.866+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3785/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ahzz:"}}