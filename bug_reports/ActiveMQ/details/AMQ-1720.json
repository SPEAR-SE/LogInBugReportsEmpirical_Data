{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482349","self":"https://issues.apache.org/jira/rest/api/2/issue/12482349","key":"AMQ-1720","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-10-26T23:55:11.696+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Oct 26 23:55:11 UTC 2008","customfield_12310420":"84790","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_345024571_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2008-05-16T17:53:37.447+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1720/watchers","watchCount":0,"isWatching":false},"created":"2008-05-12T18:03:12.876+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-10-26T23:55:11.711+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"This is due to all the other non-deamon threads running that are not part of the broker but in the default config.  For example jetty threads and camel stuff.\n\nWe should allow the broker server to callback to a listener to that the Main that starts it all can System.exit properly when the broker is shutdown.. that should cause the non-daemon stuff to exit too.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"119689","customfield_12312823":null,"summary":"Default Broker config does not shutdown when an internal persistence error occurs.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482349/comment/12938427","id":"12938427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Pasting in a log showing a broker who's DB connection has died and the broker tired to shutdown the but the process has not exited.\n\n{code}\nACTIVEMQ_HOME: C:\\iona\\apache-activemq-5.0.0.11-fuse\\bin\\..\nACTIVEMQ_BASE: C:\\iona\\apache-activemq-5.0.0.11-fuse\\bin\\..\nLoading message broker from: xbean:activemq.xml\nINFO  BrokerService                  - Using Persistence Adapter: JDBCPersistenceAdaptor(org.apache.commons.dbcp.BasicDataSource@c272bc)\nINFO  BrokerService                  - ActiveMQ 5.0.0.11-fuse JMS Message Broker (localhost) is starting\nINFO  BrokerService                  - For help or more information please see: http://activemq.apache.org/\nINFO  ManagementContext              - JMX consoles can connect to service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi\nINFO  JDBCPersistenceAdapter         - Database driver recognized: [mysql-ab_jdbc_driver]\nINFO  DefaultDatabaseLocker          - Attempting to acquire the exclusive lock to become the Master broker\nINFO  DefaultDatabaseLocker          - Becoming the master on dataSource: org.apache.commons.dbcp.BasicDataSource@c272bc\nINFO  TransportServerThreadSupport   - Listening for connections at: tcp://jluod810:61616\nINFO  TransportConnector             - Connector openwire Started\nINFO  TransportServerThreadSupport   - Listening for connections at: ssl://jluod810:61617\nINFO  TransportConnector             - Connector ssl Started\nINFO  TransportServerThreadSupport   - Listening for connections at: stomp://jluod810:61613\nINFO  TransportConnector             - Connector stomp Started\nINFO  TransportServerThreadSupport   - Listening for connections at: xmpp://jluod810:61222\nINFO  TransportConnector             - Connector xmpp Started\nINFO  NetworkConnector               - Network Connector org.apache.activemq.transport.discovery.multicast.MulticastDiscoveryAgent@25491d Started\nINFO  BrokerService                  - ActiveMQ JMS Message Broker (localhost, ID:jluod810-2851-1210614072672-0:0) started\nINFO  DiscoveryNetworkConnector      - Establishing network connection between from vm://localhost to tcp://martinmd800:61616\nINFO  TransportConnector             - Connector vm://localhost Started\nINFO  DemandForwardingBridge         - Network connection between vm://localhost#2 and tcp://martinmd800/10.5.1.158:61616(localhost) has been established.\nINFO  log                            - Logging to org.slf4j.impl.JCLLoggerAdapter(org.mortbay.log) via org.mortbay.log.Slf4jLog\nINFO  log                            - jetty-6.1.0.1-fuse\nINFO  WebConsoleStarter              - ActiveMQ WebConsole initialized.\nINFO  /admin                         - Initializing Spring FrameworkServlet 'dispatcher'\nINFO  log                            - ActiveMQ Console at http://0.0.0.0:8161/admin\nINFO  log                            - ActiveMQ Web Demos at http://0.0.0.0:8161/demo\nINFO  log                            - Started SelectChannelConnector@0.0.0.0:8161\nERROR DefaultDatabaseLocker          - Failed to update database lock: com.mysql.jdbc.CommunicationsException: Communications link failure due to underlying exception: \n \n** BEGIN NESTED EXCEPTION ** \n \njava.net.SocketException\nMESSAGE: Connection reset by peer: socket write error\n \nSTACKTRACE:\n \njava.net.SocketException: Connection reset by peer: socket write error\n\tat java.net.SocketOutputStream.socketWrite0(Native Method)\n\tat java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n\tat java.net.SocketOutputStream.write(SocketOutputStream.java:136)\n\tat java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)\n\tat java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)\n\tat com.mysql.jdbc.MysqlIO.send(MysqlIO.java:2744)\n\tat com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1612)\n\tat com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1723)\n\tat com.mysql.jdbc.Connection.execSQL(Connection.java:3283)\n\tat com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1332)\n\tat com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1604)\n\tat com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1519)\n\tat com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1504)\n\tat org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:94)\n\tat org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:94)\n\tat org.apache.activemq.store.jdbc.DefaultDatabaseLocker.keepAlive(DefaultDatabaseLocker.java:103)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.databaseLockKeepAlive(JDBCPersistenceAdapter.java:458)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter$3.run(JDBCPersistenceAdapter.java:260)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:417)\n\tat java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:280)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:135)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:65)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:142)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)\n\tat java.lang.Thread.run(Thread.java:595)\n \n \n** END NESTED EXCEPTION **\n \n \n \nLast packet sent to the server was 0 ms ago.\ncom.mysql.jdbc.CommunicationsException: Communications link failure due to underlying exception: \n \n** BEGIN NESTED EXCEPTION ** \n \njava.net.SocketException\nMESSAGE: Connection reset by peer: socket write error\n \nSTACKTRACE:\n \njava.net.SocketException: Connection reset by peer: socket write error\n\tat java.net.SocketOutputStream.socketWrite0(Native Method)\n\tat java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n\tat java.net.SocketOutputStream.write(SocketOutputStream.java:136)\n\tat java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)\n\tat java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)\n\tat com.mysql.jdbc.MysqlIO.send(MysqlIO.java:2744)\n\tat com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1612)\n\tat com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1723)\n\tat com.mysql.jdbc.Connection.execSQL(Connection.java:3283)\n\tat com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1332)\n\tat com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1604)\n\tat com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1519)\n\tat com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1504)\n\tat org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:94)\n\tat org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:94)\n\tat org.apache.activemq.store.jdbc.DefaultDatabaseLocker.keepAlive(DefaultDatabaseLocker.java:103)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.databaseLockKeepAlive(JDBCPersistenceAdapter.java:458)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter$3.run(JDBCPersistenceAdapter.java:260)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:417)\n\tat java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:280)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:135)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:65)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:142)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)\n\tat java.lang.Thread.run(Thread.java:595)\n \n \n** END NESTED EXCEPTION **\n \n \n \nLast packet sent to the server was 0 ms ago.\n\tat com.mysql.jdbc.MysqlIO.send(MysqlIO.java:2759)\n\tat com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1612)\n\tat com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1723)\n\tat com.mysql.jdbc.Connection.execSQL(Connection.java:3283)\n\tat com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1332)\n\tat com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1604)\n\tat com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1519)\n\tat com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1504)\n\tat org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:94)\n\tat org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:94)\n\tat org.apache.activemq.store.jdbc.DefaultDatabaseLocker.keepAlive(DefaultDatabaseLocker.java:103)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.databaseLockKeepAlive(JDBCPersistenceAdapter.java:458)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter$3.run(JDBCPersistenceAdapter.java:260)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:417)\n\tat java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:280)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:135)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:65)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:142)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)\n\tat java.lang.Thread.run(Thread.java:595)\nINFO  JDBCPersistenceAdapter         - No longer able to keep the exclusive lock so giving up being a master\nINFO  BrokerService                  - ActiveMQ Message Broker (localhost, ID:jluod810-2851-1210614072672-0:0) is shutting down\nINFO  DemandForwardingBridge         - localhost bridge to localhost stopped\nINFO  NetworkConnector               - Network Connector org.apache.activemq.transport.discovery.multicast.MulticastDiscoveryAgent@25491d Stopped\nINFO  TransportConnector             - Connector openwire Stopped\nINFO  TransportConnector             - Connector ssl Stopped\nWARN  ActiveMQConnection             - Async exception with no exception listener: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too long: localhost/127.0.0.1:61616\norg.apache.activemq.transport.InactivityIOException: Channel was inactive for too long: localhost/127.0.0.1:61616\n\tat org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:225)\n\tat org.apache.activemq.transport.InactivityMonitor$3.run(InactivityMonitor.java:135)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)\n\tat java.lang.Thread.run(Thread.java:595)\nINFO  TransportConnector             - Connector stomp Stopped\nINFO  TransportConnector             - Connector xmpp Stopped\nERROR JDBCPersistenceAdapter         - Could not stop service: JDBCPersistenceAdaptor(org.apache.commons.dbcp.BasicDataSource@c272bc). Reason: com.mysql.jdbc.exceptions.MySQLNonTransientConnectionException: Connection.close() has already been called. Invalid operation in this state.\ncom.mysql.jdbc.exceptions.MySQLNonTransientConnectionException: Connection.close() has already been called. Invalid operation in this state.\n\tat com.mysql.jdbc.SQLError.createSQLException(SQLError.java:888)\n\tat com.mysql.jdbc.Connection.getMutex(Connection.java:3755)\n\tat com.mysql.jdbc.Connection.rollback(Connection.java:5251)\n\tat org.apache.commons.dbcp.DelegatingConnection.rollback(DelegatingConnection.java:220)\n\tat org.apache.commons.dbcp.DelegatingConnection.rollback(DelegatingConnection.java:220)\n\tat org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.rollback(PoolingDataSource.java:288)\n\tat org.apache.activemq.store.jdbc.DefaultDatabaseLocker.stop(DefaultDatabaseLocker.java:94)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.stop(JDBCPersistenceAdapter.java:204)\n\tat org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n\tat org.apache.activemq.broker.BrokerService.stop(BrokerService.java:475)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.stopBroker(JDBCPersistenceAdapter.java:474)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.databaseLockKeepAlive(JDBCPersistenceAdapter.java:466)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter$3.run(JDBCPersistenceAdapter.java:260)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:417)\n\tat java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:280)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:135)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:65)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:142)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)\n\tat java.lang.Thread.run(Thread.java:595)\nERROR ManagedTopicRegion             - Could not stop service: TopicRegion: destinations=9, subscriptions=2, memory=0%. Reason: java.lang.InterruptedException\njava.lang.InterruptedException\n\tat java.lang.Object.wait(Native Method)\n\tat org.apache.activemq.thread.DedicatedTaskRunner.shutdown(DedicatedTaskRunner.java:72)\n\tat org.apache.activemq.thread.DedicatedTaskRunner.shutdown(DedicatedTaskRunner.java:83)\n\tat org.apache.activemq.broker.region.Topic.stop(Topic.java:469)\n\tat org.apache.activemq.broker.region.AbstractRegion.stop(AbstractRegion.java:110)\n\tat org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n\tat org.apache.activemq.broker.region.RegionBroker.doStop(RegionBroker.java:629)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.doStop(ManagedRegionBroker.java:109)\n\tat org.apache.activemq.broker.region.RegionBroker.stop(RegionBroker.java:187)\n\tat org.apache.activemq.broker.TransactionBroker.stop(TransactionBroker.java:117)\n\tat org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:157)\n\tat org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:157)\n\tat org.apache.activemq.broker.BrokerService$2.stop(BrokerService.java:1513)\n\tat org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n\tat org.apache.activemq.broker.BrokerService.stop(BrokerService.java:477)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.stopBroker(JDBCPersistenceAdapter.java:474)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.databaseLockKeepAlive(JDBCPersistenceAdapter.java:466)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter$3.run(JDBCPersistenceAdapter.java:260)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:417)\n\tat java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:280)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:135)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:65)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:142)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)\n\tat java.lang.Thread.run(Thread.java:595)\nERROR BrokerService$2                - Could not stop service: org.apache.activemq.broker.BrokerService$2@12b9f14. Reason: java.lang.InterruptedException\njava.lang.InterruptedException\n\tat java.lang.Object.wait(Native Method)\n\tat org.apache.activemq.thread.DedicatedTaskRunner.shutdown(DedicatedTaskRunner.java:72)\n\tat org.apache.activemq.thread.DedicatedTaskRunner.shutdown(DedicatedTaskRunner.java:83)\n\tat org.apache.activemq.broker.region.Topic.stop(Topic.java:469)\n\tat org.apache.activemq.broker.region.AbstractRegion.stop(AbstractRegion.java:110)\n\tat org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n\tat org.apache.activemq.broker.region.RegionBroker.doStop(RegionBroker.java:629)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.doStop(ManagedRegionBroker.java:109)\n\tat org.apache.activemq.broker.region.RegionBroker.stop(RegionBroker.java:187)\n\tat org.apache.activemq.broker.TransactionBroker.stop(TransactionBroker.java:117)\n\tat org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:157)\n\tat org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:157)\n\tat org.apache.activemq.broker.BrokerService$2.stop(BrokerService.java:1513)\n\tat org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n\tat org.apache.activemq.broker.BrokerService.stop(BrokerService.java:477)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.stopBroker(JDBCPersistenceAdapter.java:474)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.databaseLockKeepAlive(JDBCPersistenceAdapter.java:466)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter$3.run(JDBCPersistenceAdapter.java:260)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:417)\n\tat java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:280)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:135)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:65)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:142)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)\n\tat java.lang.Thread.run(Thread.java:595)\nWARN  ActiveMQConnection             - Async exception with no exception listener: org.apache.activemq.transport.TransportDisposedIOException: Peer (vm://localhost#1) disposed.\norg.apache.activemq.transport.TransportDisposedIOException: Peer (vm://localhost#1) disposed.\n\tat org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:198)\n\tat org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\n\tat org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\nINFO  TransportConnector             - Connector vm://localhost Stopped\nINFO  BrokerService                  - ActiveMQ JMS Message Broker (localhost, ID:jluod810-2851-1210614072672-0:0) stopped\nWARN  JDBCPersistenceAdapter         - Failed to stop brokercom.mysql.jdbc.exceptions.MySQLNonTransientConnectionException: Connection.close() has already been called. Invalid operation in this state.\n\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2008-05-12T18:04:24.835+0000","updated":"2008-05-12T18:04:24.835+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482349/comment/12939681","id":"12939681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2008-05-16T17:53:37.427+0000","updated":"2008-05-16T17:53:37.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482349/comment/12940400","id":"12940400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerememonteau","name":"jerememonteau","key":"jerememonteau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jereme Monteau","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nWe are experiencing this problem when our MySQL Cluster performs some weekly maintenance tasks. It seems to force any clients to disconnect momentarily.\nIs there anyway to configure ActiveMQ to handle these disconnects in a more robust fashion? I'm thinking along the lines of autoReconnect at the driver level or \nsomething similar. Has anyone else worked around this? We are running 5.2 and the behavior seems improved from 5.1, since the process does completely shutdown\ninstead of ending up in a zombie-like state of running but not responding to requests. We are running in a Master/Slave failover configuration and unfortunately the\nMySQL Cluster seems to do a wholesale disconnect of all clients at certain times, so the secondary activemq process also goes down, leaving us with no available queues.\nWe are considering moving to a network of brokers high availability configuration but documentation on this setup seems sparse. Any advice is greatly appreciatted.\n\nThanks,\nJereme Monteau","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerememonteau","name":"jerememonteau","key":"jerememonteau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jereme Monteau","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-26T23:55:11.696+0000","updated":"2008-10-26T23:55:11.696+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1720/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ku2f:"}}