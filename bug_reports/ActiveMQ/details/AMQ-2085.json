{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483302","self":"https://issues.apache.org/jira/rest/api/2/issue/12483302","key":"AMQ-2085","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2009-02-19T12:15:26.226+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Feb 27 21:08:28 UTC 2012","customfield_12310420":"75082","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_834125_*|*_6_*:*_1_*:*_39480437002_*|*_5_*:*_1_*:*_0_*|*_4_*:*_1_*:*_57877948280","customfield_12312321":null,"resolutiondate":"2012-02-27T21:08:28.241+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2085/watchers","watchCount":2,"isWatching":false},"created":"2009-01-27T00:54:48.994+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-02-27T21:08:28.398+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313904","id":"12313904","name":"JMX","description":"The JMX support in ActiveMQ"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"ManagementContext tends to create a JMXConnectorServer whenever findMBeanServer is called.  This seems like really wrong behavior -- amq should not be setting up jmx remoting on mbean servers it hasn't created, certainly not as a side effect of something like creating a vm transport connection:\n\n\t  createConnector():365, ManagementContext.java\n\t  findMBeanServer():293, ManagementContext.java\n\t  getMBeanServer():148, ManagementContext.java\n\t  start():77, ManagementContext.java\n\t  start():458, BrokerService.java\n\t  doCompositeConnect():123, VMTransportFactory.java\n\t  doConnect():53, VMTransportFactory.java\n\t  doConnect():51, TransportFactory.java\n\t  connect():80, TransportFactory.java\n\t  createTransport():239, ActiveMQConnectionFactory.java\n\t  createActiveMQConnection():254, ActiveMQConnectionFactory.java\n\t  createConnection():181, ActiveMQConnectionFactory.java\n\t  makeConnection():79, ActiveMQConnectionSupport.java\n\t  makeConnection():61, ActiveMQConnectionSupport.java\n\t  createManagedConnection():169, ActiveMQManagedConnectionFactory.java\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"233458","customfield_12312823":null,"summary":"AMQ should not install a JMXConnectorServer for an MBeanServer it does not create","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483302/comment/12940703","id":"12940703","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"body":"Fixed rev 737951.... please note any problems this might cause.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-01-27T01:08:43.111+0000","updated":"2009-01-27T01:08:43.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483302/comment/12940807","id":"12940807","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Enabled finding Tiger MBean server by default (and creating a connector for it), since it was breaking the standalone broker functionality. I think it should be fine now, since it will not create a connector for any other server. The change is committed in revision 745833. Please let me know if this still works for you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2009-02-19T12:15:26.226+0000","updated":"2009-02-19T12:15:26.226+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483302/comment/12942548","id":"12942548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"body":"I'm seeing some different behavior between a webapp with an embedded broker deployed to JBoss and am suspicious that what I see may be related to these changes.  With ActiveMQ 5.3 and the web demo chat application, I don't see the org.apache.activemq MBeans in the JBoss jmx-console but with the ActiveMQ 5.2 version I do.\n\nI'm bundling up the ActiveMQ demo webapps as two war files, demo52.war and demo53.war.  At first I used the 5.2 jars for the 5.2 webapp and the 5.3 jars for the 5.3 webapp.  To only vary one thing, I changed this so that each bundles the ActiveMQ 5.3 activemq-web-5.3.0.jar, camel-core-2.0.0.jar, and jetty-util-6.1.9.jar.  The difference is that demo5.2 bundles activemq-core-5.2.0.jar and demo53.war bundles activemq-core-5.3.0.jar.\n\nWhen I deploy demo52.war to JBoss, open a browser to the app at URI http://localhost:8280/demo52/chat.html, and enter a username, I see the messages in the JBoss log:\n\n11:07:34,485 INFO  [TomcatDeployer] deploy, ctxPath=/demo52, warUrl=.../tmp/deploy/tmp8966298452211694373demo52-exp.war/\n11:07:56,779 INFO  [BrokerService] Using Persistence Adapter: AMQPersistenceAdapter(activemq-data\\localhost)\n11:07:56,781 INFO  [AMQPersistenceAdapter] AMQStore starting using directory: activemq-data\\localhost\n11:07:56,820 INFO  [KahaStore] Kaha Store using data directory activemq-data\\localhost\\kr-store\\state\n11:07:56,891 INFO  [AMQPersistenceAdapter] Active data files: []\n11:07:56,980 INFO  [BrokerService] ActiveMQ 5.2.0 JMS Message Broker (localhost) is starting\n11:07:56,981 INFO  [BrokerService] For help or more information please see: http://activemq.apache.org/\n11:07:56,988 INFO  [ManagementContext] JMX consoles can connect to service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi\n11:07:57,185 INFO  [KahaStore] Kaha Store using data directory activemq-data\\localhost\\kr-store\\data\n11:07:57,293 INFO  [BrokerService] ActiveMQ JMS Message Broker (localhost, ID:ppickett-PC-64367-1272388077023-0:0) started\n11:07:57,304 INFO  [TransportConnector] Connector vm://localhost Started\n\nand also see the org.apache.activemq MBeans on the JBoss jmx-console at http://localhost:8280/jmx-console/\n\nWhen I undeploy the demo52.war and deploy demo53.war, open a browser to http://localhost:8280/demo53/chat.html, and enter a username, I see similar messages in the JBoss log:\n\n11:11:18,962 INFO  [TomcatDeployer] deploy, ctxPath=/demo53, warUrl=.../tmp/deploy/tmp8938444770518177909demo53-exp.war/\n11:11:35,950 INFO  [BrokerService] Using Persistence Adapter: AMQPersistenceAdapter(activemq-data\\localhost)\n11:11:35,952 INFO  [AMQPersistenceAdapter] AMQStore starting using directory: activemq-data\\localhost\n11:11:35,989 INFO  [KahaStore] Kaha Store using data directory activemq-data\\localhost\\kr-store\\state\n11:11:36,060 INFO  [AMQPersistenceAdapter] Active data files: []\n11:11:36,125 INFO  [BrokerService] ActiveMQ 5.3.0 JMS Message Broker (localhost) is starting\n11:11:36,125 INFO  [BrokerService] For help or more information please see: http://activemq.apache.org/\n11:11:36,333 INFO  [KahaStore] Kaha Store using data directory activemq-data\\localhost\\kr-store\\data\n11:11:36,485 INFO  [ManagementContext] JMX consoles can connect to service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi\n11:11:36,490 INFO  [BrokerService] ActiveMQ JMS Message Broker (localhost, ID:ppickett-PC-64379-1272388296166-0:0) started\n11:11:36,501 INFO  [TransportConnector] Connector vm://localhost Started\n\nbut with the demo53.war, no org.apache.activemq MBeans are shown on the JBoss jmx-console.\n\nAny ideas on this?\n\nThanks,\n\nPhil\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"created":"2010-04-27T23:18:06.763+0000","updated":"2010-04-27T23:18:06.763+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483302/comment/12942553","id":"12942553","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"body":"I'm not sure if there is a workaround, but this change appears to have caused the issue with org.apache.activemq MBeans no longer appearing in the JBoss jmx-console for an app with an embedded broker.  I created a simple jar containing the ManagementContext.class with the changes associated with this Jira.  With the AMQ 5.2 core jar in the webapp, the MBeans appear in the jmx-console.  When the modified version of this class is included in the app, the MBeans no longer appear.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"created":"2010-04-28T23:56:00.109+0000","updated":"2010-04-28T23:56:00.109+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483302/comment/13217561","id":"13217561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The workaround for the JBoss issue is to set findTigerMBeanServer to false.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-02-27T21:08:28.352+0000","updated":"2012-02-27T21:08:28.352+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2085/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i14cbb:"}}