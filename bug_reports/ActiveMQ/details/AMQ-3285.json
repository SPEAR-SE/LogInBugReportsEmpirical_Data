{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12504576","self":"https://issues.apache.org/jira/rest/api/2/issue/12504576","key":"AMQ-3285","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2011-04-21T11:30:26.206+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 17 17:36:17 UTC 2012","customfield_12310420":"33594","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_13996270731_*|*_6_*:*_2_*:*_15241091289_*|*_4_*:*_1_*:*_11444099877","customfield_12312321":null,"resolutiondate":"2012-08-01T14:48:43.679+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3285/watchers","watchCount":5,"isWatching":false},"created":"2011-04-18T18:24:21.950+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[{"id":"12365898","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12365898","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12636594","key":"AMQ-4367","self":"https://issues.apache.org/jira/rest/api/2/issue/12636594","fields":{"summary":"ActiveMQXAConnectionFactory does not respect redelivery policy","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21148&avatarType=issuetype","name":"Task","subtask":false,"avatarId":21148}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-03-18T10:28:05.533+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10092","value":"Unit Test Broken","id":"10092"}],"description":"I tried to add these following parameters to my redelivery policy and activeMQ is not respecting any of them except maximumRedelivery\n<spring:bean id=\"redeliveryPolicy\" class=\"org.apache.activemq.RedeliveryPolicy\">\n\t\t\t<spring:property name=\"maximumRedeliveries\" value=\"5\"/>\n\t\t\t<spring:property name=\"initialRedeliveryDelay\" value=\"5000\"/>\n\t\t\t\t\t\t<spring:property name=\"redeliveryDelay\" value=\"2000\"/>\n\t\t\t<spring:property name=\"useExponentialBackOff\" value=\"true\"/>\n\t\t\t<spring:property name=\"backOffMultiplier\" value=\"2\"/>\n\n\t\t</spring:bean>\n\nI have attached the project which I took from https://issues.apache.org/jira/browse/AMQ-1593 and added the above parameter to my brokerURL:\ntcp://localhost:5000?jms.redeliveryPolicy.maximumRedeliveries=3&jms.redeliveryPolicy.initialRedeliveryDelay=10000&jms.redeliveryPolicy.deliveryDelay=10000&jms.redeliveryPolicy.useExponentialBackOff=true&jms.redeliveryPolicy.backOffMultiplier=2\n\nThis test case will show you that none of the parameters like initiaRedeliveryDelay etc will take effect, except maxRedeliveries","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12476639","id":"12476639","filename":"activemq-test.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-18T18:24:39.347+0000","size":13228,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12476639/activemq-test.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12519438","id":"12519438","filename":"activemq-test-0.1-project.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"created":"2012-03-22T13:15:21.902+0000","size":12761,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12519438/activemq-test-0.1-project.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81709","customfield_12312823":null,"summary":"ActiveMQXAConnectionFactory does not respect various parameters for redelivery policy","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13022720","id":"13022720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"not sure what the ![CDATA[ gives you or what the brokerURL string ends up as.\n\nIn place of CDATA, try replacing the '&' with the entity '&amp;' so that is validates.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-21T11:30:26.206+0000","updated":"2011-04-21T11:30:26.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13022927","id":"13022927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary\nI tried this and still not working:\n <prop key=\"brokerURL\">tcp://localhost:5000?jms.redeliveryPolicy.maximumRedeliveries=3&amp;jms.redeliveryPolicy.initialRedeliveryDelay=10000&amp;jms.redeliveryPolicy.deliveryDelay=10000&amp;jms.redeliveryPolicy.useExponentialBackOff=true&amp;jms.redeliveryPolicy.backOffMultiplier=2</prop>\n\nThanks\nJaskirat","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-21T21:29:58.785+0000","updated":"2011-04-21T21:29:58.785+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13026882","id":"13026882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=flume","name":"flume","key":"flume","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Lievens","active":true,"timeZone":"Etc/UTC"},"body":"The problem lies with the fact that a PoolingConnectionFactory is used. When using the org.springframework.jms.connection.CachingConnectionFactory the various backoff-settings do take effect. This is most likely not fixable due to the fact that multiple ActiveMQMessageConsumers are created and destroyed when using the PoolingConnectionFactory while that is not the case with the CachingConnectionFactory. At least what I see is that the prolific creation and destruction of ActiveMQMessageConsumers in conjunction with the fact that this class is holding state (e.g. the redeliveryDelay property) between rollbacks tends to be contradictory.\nMaybe someone with a better understanding of ActiveMQMessageConsumer in relation with PoolingConnectionFactory can shed some light on this. At least there is a workaround.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=flume","name":"flume","key":"flume","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Lievens","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-29T06:45:59.343+0000","updated":"2011-04-29T06:45:59.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13027106","id":"13027106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"body":"Hi Jan, nope that is not an issue. This thing works if the produced message is set to persistent, if non-persistent then all other attributes defined in the policy are ignored.\n\nSo now the question would be, how to make this thing work for non-persistent messages also?\n\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-29T17:56:13.962+0000","updated":"2011-04-29T17:56:13.962+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13028892","id":"13028892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"body":"Something is weird, I was able to run this with persistent message before. But now it is not working anymore.\nCan someone help?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"created":"2011-05-04T18:54:44.984+0000","updated":"2011-05-04T18:54:44.984+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13115768","id":"13115768","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"This appears to be an issue of not properly using the correct escape values for the & character in the XML.  If an issue still occurs please provide a JUnit test case the demonstrates as the ActiveMQXAConnectionFactory delegates the property configuration to the same ActiveMQConnectionFactory that is tested quite extensively in the existing unit tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-09-27T18:15:32.659+0000","updated":"2011-09-27T18:15:32.659+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13235310","id":"13235310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"body":"Hi all,\n\nI've been experiencing the very same issue Jaskirat has been talking about. I took the liberty to clean up the test he uploaded to expose even better the problem.\n\nBasically now the brokerURL is configured properly (without using CDATA and escaping the & to  %26 )and by debugging it I can se that the org.apache.activemq.RedeliveryPolicy is correctly configured. However some of the property I've set (especially the useExponentialBackOff related one)\n\nPlease take a look at the new attached test","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"created":"2012-03-22T03:40:25.675+0000","updated":"2012-03-22T03:40:25.675+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13235313","id":"13235313","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"body":"Ok I realized I can't attach anything being the case close so I will only post the modification I made:\n\n* Changed the brockerURL properties from the bean queueConnectionFactory to\n{code}\n<prop key=\"brokerURL\" >tcp://localhost:61616?jms.redeliveryPolicy.maximumRedeliveries=10%26jms.redeliveryPolicy.initialRedeliveryDelay=10000%26jms.redeliveryPolicy.deliveryDelay=10000%26jms.redeliveryPolicy.useExponentialBackOff=true%26jms.redeliveryPolicy.backOffMultiplier=2</prop>\n{code}\n* Replaced the pom with the following one\n{code:xml}\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>test</groupId>\n\t<artifactId>activemq-test</artifactId>\n\t<packaging>jar</packaging>\n\t<name>activemq-xaconnection-factory-test</name>\n\t<version>0.1</version>\n\t<url></url>\n\n\t<properties>\n\t\t<slf4j.version>1.6.1</slf4j.version>\n\t\t<spring.version>3.0.6.RELEASE</spring.version>\n\t</properties>\n\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.geronimo.specs</groupId>\n\t\t\t<artifactId>geronimo-jms_1.1_spec</artifactId>\n\t\t\t<version>1.0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.geronimo.specs</groupId>\n\t\t\t<artifactId>geronimo-jta_1.0.1B_spec</artifactId>\n\t\t\t<version>1.1.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-core</artifactId>\n\t\t\t<version>${spring.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-aop</artifactId>\n\t\t\t<version>${spring.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-jdbc</artifactId>\n\t\t\t<version>${spring.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t\t<version>${spring.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-beans</artifactId>\n\t\t\t<version>${spring.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-jms</artifactId>\n\t\t\t<version>${spring.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-api</artifactId>\n\t\t\t<version>${slf4j.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>${slf4j.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.activemq</groupId>\n\t\t\t<artifactId>activemq-core</artifactId>\n\t\t\t<version>5.5.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.codehaus.btm</groupId>\n\t\t\t<artifactId>btm</artifactId>\n\t\t\t<version>2.1.2</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t\t<version>${spring.version}</version>\n\t\t\t<scope>test</scope>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<groupId>commons-logging</groupId>\n\t\t\t\t\t<artifactId>commons-logging</artifactId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<fork>true</fork>\n\t\t\t\t\t<source>1.6</source>\n\t\t\t\t\t<target>1.6</target>\n\t\t\t\t\t<meminitial>128m</meminitial>\n\t\t\t\t\t<maxmem>512m</maxmem>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t\t<debug>true</debug>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-surefire-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<forkMode>pertest</forkMode>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t\t<plugin>\n\t\t\t\t<artifactId>maven-assembly-plugin</artifactId>\n\t\t\t\t<version>2.2.1</version>\n\t\t\t\t<configuration>\n\t\t\t\t\t<descriptorRefs>\n\t\t\t\t\t\t<descriptorRef>project</descriptorRef>\n\t\t\t\t\t</descriptorRefs>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\t</build>\n\n</project>\n\n{code}\n\nCan the case be reopened?\n\nThanks\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"created":"2012-03-22T03:45:36.630+0000","updated":"2012-03-22T03:45:36.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13235316","id":"13235316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"body":"Hi Alberto\nleme try to reopen the case. I never followed on this case, but I am sure there is a problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-22T03:53:08.857+0000","updated":"2012-03-22T03:53:08.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13235317","id":"13235317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"body":"Based on alberto's comment I will reopen this bug","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaskiratbhatia","name":"jaskiratbhatia","key":"jaskiratbhatia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaskirat Bhatia","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-22T03:53:43.902+0000","updated":"2012-03-22T03:53:43.902+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13235564","id":"13235564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"body":"Thanks Jas, please find attached the new test case","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"created":"2012-03-22T13:15:22.366+0000","updated":"2012-03-22T13:15:22.366+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13256638","id":"13256638","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmbaker","name":"jmbaker","key":"jmbaker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Baker","active":true,"timeZone":"Etc/UTC"},"body":"Hello,\n\nI've got some information to add. I've debugged this and find the following code being (correctly?) executed in ActiveMQMessageConsumer when a message is rolled back:\n\n{code}\n                    if (redeliveryDelay > 0 && !unconsumedMessages.isClosed()) {\n                        // Start up the delivery again a little later.\n                        scheduler.executeAfterDelay(new Runnable() {\n                            public void run() {\n                                try {\n                                    if (started.get()) {\n                                        start();\n                                    }\n                                } catch (JMSException e) {\n                                    session.connection.onAsyncException(e);\n                                }\n                            }\n                        }, redeliveryDelay);\n{code}\n\nThe value of redeliveryDelay (in ms) is correct. However, the \"problem\" is the Spring DefaultMessageListener, which asks ActiveMQ for another message and it gives back the message waiting for redelivery. I can see that the thread has the same ID in the debugger, so I think the problem is better described as:\n\n\"ActiveMQ does not remove the message due for redelivery from the queue, but gives it out next time it's asked to do so. After X retries, it's moved to the DLQ and hence the listener will not receive it again when it asks for the next message\".\n\nThis is a very serious problem.\n\n\nJ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmbaker","name":"jmbaker","key":"jmbaker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Baker","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-18T15:23:21.667+0000","updated":"2012-04-18T15:24:31.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13426318","id":"13426318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayqooi","name":"ayqooi","key":"ayqooi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Ooi","active":true,"timeZone":"Etc/UTC"},"body":"Hello,\n\nDid this get resolved?!\n\nWe are using ActiveMQ 5.5.1 (second latest.. I see that 5.6.0 is available) and am seeing this exact issue. The redeliveryDelay in the latest comment is set correctly, but the message is getting picked up immediately by the Listener...\n\nThus, our configurations for redelivery are not being respected.\n\nIs there any intention to fix this? We are not using the persistent mechanism of ActiveMQ. Haven't tried with persistence, but this is not ideal for our scenario anyway. We want to keep messages non-persistent, but also want the redelivery to occur when a transaction is rolled back and respect the redelivery configuration so that we dont use up all of our redeliveries in such a short space of time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayqooi","name":"ayqooi","key":"ayqooi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Ooi","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-01T04:13:43.448+0000","updated":"2012-08-01T04:13:43.448+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13426673","id":"13426673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Added to /activemq-core/src/test/java/org/apache/activemq/ActiveMQXAConnectionFactoryTest.java to show that there is no issue on client.  The test case has an incorrect option 'deliveryDelay' which should be 'redeliveryDelay'","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-08-01T14:48:10.680+0000","updated":"2012-08-01T14:48:10.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13426674","id":"13426674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Added to unit test for the /activemq-core/src/test/java/org/apache/activemq/ActiveMQXAConnectionFactoryTest.java to show options are set as supplied on the URI.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-08-01T14:48:43.801+0000","updated":"2012-08-01T14:48:43.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13436754","id":"13436754","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"body":"Hello Timothy, I've just run the ast version of the test case you attached but I don't see any delay between redeliveries:\n\n{code}\n2012-08-17 11:16:59,897 [queueListenerPojo-1] WARN  org.springframework.jms.listener.DefaultMessageListenerContainer  - Execution of JMS message listener failed, and no ErrorHandler has been set.\njava.lang.IllegalStateException: an exception\n\tat test.LoggingMessageListener.onMessage(LoggingMessageListener.java:22)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:309)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)\n\tat org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:110)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)\n\tat org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)\n\tat $Proxy13.onMessage(Unknown Source)\n\tat org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:560)\n\tat org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:498)\n\tat org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467)\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:243)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)\n\tat java.lang.Thread.run(Thread.java:680)\n2012-08-17 11:16:59,902 [queueListenerPojo-1] INFO  test.LoggingMessageListener  - received: ActiveMQTextMessage {commandId = 10, responseRequired = false, messageId = ID:MacBook-Pro-de-Alberto-Aresca-2.local-65429-1345213018686-2:1:2:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:MacBook-Pro-de-Alberto-Aresca-2.local-65429-1345213018686-2:1:2:1, destination = queue://myQueue, transactionId = XID:1114926712:737072696e672d62746d0000013934f1b46700000001:737072696e672d62746d0000013934f1b48b00000004, expiration = 0, timestamp = 1345213019275, arrival = 0, brokerInTime = 1345213019327, brokerOutTime = 1345213019901, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 10, size = 0, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, text = text message}\n2012-08-17 11:16:59,903 [queueListenerPojo-1] WARN  org.springframework.jms.listener.DefaultMessageListenerContainer  - Execution of JMS message listener failed, and no ErrorHandler has been set.\njava.lang.IllegalStateException: an exception\n\tat test.LoggingMessageListener.onMessage(LoggingMessageListener.java:22)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:309)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)\n\tat org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:110)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)\n\tat org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)\n\tat $Proxy13.onMessage(Unknown Source)\n\tat org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:560)\n\tat org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:498)\n\tat org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467)\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:243)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947)\n\tat java.lang.Thread.run(Thread.java:680)\n{code}\n\nAs you can se from the log of my last 2 redeliveries the wait is of about 10 ms while it should be 10s*2*$(last_redelivery_timeout}\n\nAm I missing something?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"created":"2012-08-17T14:23:36.393+0000","updated":"2012-08-17T14:23:36.393+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13436757","id":"13436757","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You are welcome to create a JUnit test case that shows your issue and attach it here for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-08-17T14:28:20.965+0000","updated":"2012-08-17T14:28:20.965+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13436823","id":"13436823","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"body":"I've used the same test replacing deliveryDelay with redeliveryDelay but i'm still experiencing the same behavior and I'm under the impression that whatever value I set there won't simply be taken in account by the XA Redelivery policy.\n\nI've attached a new version of the testcase.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"created":"2012-08-17T16:13:29.891+0000","updated":"2012-08-17T16:13:29.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13436828","id":"13436828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"body":"Unfortunately I can't attach anything to the case (i guess because the case has been closed), but it can be easily reproduced by simply replacing the jms.redeliveryPolicy.deliveryDelay in the test-context.xml file to jms.redeliveryPolicy.redeliveryDelay.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genjosanzo","name":"genjosanzo","key":"genjosanzo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alberto Aresca","active":true,"timeZone":"America/Argentina/Buenos_Aires"},"created":"2012-08-17T16:18:59.387+0000","updated":"2012-08-17T16:18:59.387+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504576/comment/13436899","id":"13436899","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Recommend you try and modify the test case  /activemq-core/src/test/java/org/apache/activemq/ActiveMQXAConnectionFactoryTest.java to show your issue and open a new Jira ticket to track its progress. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-08-17T17:36:17.855+0000","updated":"2012-08-17T17:36:17.855+0000"}],"maxResults":20,"total":20,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3285/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ec0n:"}}