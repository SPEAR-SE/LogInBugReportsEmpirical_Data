{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12786968","self":"https://issues.apache.org/jira/rest/api/2/issue/12786968","key":"AMQ-5695","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2015-06-18T17:41:27.474+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jan 16 12:42:50 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_31405678270_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-03-28T20:33:42.323+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5695/watchers","watchCount":19,"isWatching":false},"created":"2015-03-31T08:45:44.168+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[{"id":"12428327","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12428327","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12748048","key":"AMQ-5394","self":"https://issues.apache.org/jira/rest/api/2/issue/12748048","fields":{"summary":"Incorrect handling of duplicate update message commands in KahaDB can lead to broker startup errors","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12428254","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12428254","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12770461","key":"AMQ-5542","self":"https://issues.apache.org/jira/rest/api/2/issue/12770461","fields":{"summary":"KahaDB data files containing acknowledgements are deleted during cleanup","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-01-16T12:42:50.649+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Since we have upgraded ActiveMQ from 5.10.0 to 5.11.1, KahaDB is not cleaning up log files properly. It seems to keep all of them. It helped once to restart the service and minutes later, ActiveMQ cleaned up 95% of log files but mostly it is not cleaning up at all.\n\nWhen partition was full, I stopped ActiveMQ, copied the KahaDB to another host and started it with empty queues again. Then I forwarded all messages from that other host back. Even when all messages were forwarded and all queues were empty, the old KahaDB log files were not cleaned up.\n\nI stopped ActiveMQ, removed db.data and db.redo to rebuild index which took around 3h (350GB of log files) but still, the log files are not cleaned up.\n\n[...]\n2015-03-30 18:21:55,532 | INFO  | @13786:158508, 321300000 entries recovered .. | org.apache.activemq.store.kahadb.MessageDatabase | WrapperSimpleAppMain\n2015-03-30 18:22:02,090 | INFO  | Recovery replayed 321378917 operations from the journal in 9226.159 seconds. | org.apache.activemq.store.kahadb.MessageDatabase | WrapperSimpleAppMain\n2015-03-30 18:22:02,402 | INFO  | installing runtimeConfiguration plugin | org.apache.activemq.plugin.RuntimeConfigurationPlugin | WrapperSimpleAppMain\n2015-03-30 18:22:04,576 | INFO  | Apache ActiveMQ 5.11.1 (prd-mig-02-sat.example.com, ID:prd-mig-02-sat.example.com-26260-1427730492201-1:1) is starting | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain\n2015-03-30 18:22:04,946 | INFO  | pending local transactions: [] | org.apache.activemq.store.kahadb.MultiKahaDBTransactionStore | WrapperSimpleAppMain\n2015-03-30 18:22:08,488 | INFO  | Configuration class path resource [activemq.xml] | org.apache.activemq.plugin.RuntimeConfigurationBroker | WrapperSimpleAppMain\n2015-03-30 18:22:12,198 | INFO  | Listening for connections at: nio://prd-mig-02-sat.example.com:61616?transport.reuseAddress=true | org.apache.activemq.transport.TransportServerThreadSupport | WrapperSimpleAppMain\n2015-03-30 18:22:12,199 | INFO  | Connector openwire started | org.apache.activemq.broker.TransportConnector | WrapperSimpleAppMain\n2015-03-30 18:22:12,232 | INFO  | Listening for connections at: stomp+nio://prd-mig-02-sat.example.com:61613?transport.closeAsync=false&transport.reuseAddress=true | org.apache.activemq.transport.TransportServerThreadSupport | WrapperSimpleAppMain\n2015-03-30 18:22:12,234 | INFO  | Connector stomp started | org.apache.activemq.broker.TransportConnector | WrapperSimpleAppMain\n2015-03-30 18:22:12,237 | INFO  | Establishing network connection from vm://prd-mig-02-sat.example.com?async=false&network=true to tcp://172.42.15.40:61616 | org.apache.activemq.network.DiscoveryNetworkConnector | WrapperSimpleAppMain\n2015-03-30 18:22:12,286 | INFO  | Connector vm://prd-mig-02-sat.example.com started | org.apache.activemq.broker.TransportConnector | WrapperSimpleAppMain\n2015-03-30 18:22:12,318 | INFO  | Establishing network connection from vm://prd-mig-02-sat.example.com?async=false&network=true to tcp://172.42.15.39:61616 | org.apache.activemq.network.DiscoveryNetworkConnector | WrapperSimpleAppMain\n2015-03-30 18:22:12,321 | INFO  | Network Connector DiscoveryNetworkConnector:FORWARDER:BrokerService[prd-mig-02-sat.example.com] started | org.apache.activemq.network.NetworkConnector | WrapperSimpleAppMain\n2015-03-30 18:22:12,325 | INFO  | Apache ActiveMQ 5.11.1 (prd-mig-02-sat.example.com, ID:prd-mig-02-sat.example.com-26260-1427730492201-1:1) started | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain\n2015-03-30 18:22:12,326 | INFO  | For help or more information please see: http://activemq.apache.org | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain\n2015-03-30 18:22:12,381 | INFO  | Network connection between vm://prd-mig-02-sat.example.com#0 and tcp:///172.42.15.40:61616@58567 (prdvip-amq-01-sat.example.com) has been established. | org.apache.activemq.network.DemandForwardingBridgeSupport | triggerStartAsyncNetworkBridgeCreation: remoteBroker=tcp:///172.42.15.40:61616@58567, localBroker= vm://prd-mig-02-sat.example.com#0\n2015-03-30 18:22:12,381 | INFO  | Network connection between vm://prd-mig-02-sat.example.com#2 and tcp:///172.42.15.39:61616@4523 (prdvip-amq-02-sat.example.com) has been established. | org.apache.activemq.network.DemandForwardingBridgeSupport | triggerStartAsyncNetworkBridgeCreation: remoteBroker=tcp:///172.42.15.39:61616@4523, localBroker= vm://prd-mig-02-sat.example.com#2\n2015-03-31 04:21:13,971 | INFO  | Slow KahaDB access: Journal append took: 0 ms, Index update took 1936 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:07:34,560 | INFO  | Slow KahaDB access: cleanup took 30113 | org.apache.activemq.store.kahadb.AbstractKahaDBStore | ActiveMQ Journal Checkpoint Worker\n2015-03-31 06:07:39,076 | INFO  | Slow KahaDB access: cleanup took 4015 | org.apache.activemq.store.kahadb.AbstractKahaDBStore | ActiveMQ Journal Checkpoint Worker\n2015-03-31 06:08:48,101 | INFO  | Slow KahaDB access: Journal append took: 0 ms, Index update took 2667 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:09:39,629 | INFO  | Slow KahaDB access: cleanup took 3470 | org.apache.activemq.store.kahadb.AbstractKahaDBStore | ActiveMQ Journal Checkpoint Worker\n2015-03-31 06:10:20,789 | INFO  | Slow KahaDB access: Journal append took: 0 ms, Index update took 2666 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:11:02,925 | INFO  | Slow KahaDB access: Journal append took: 1 ms, Index update took 2714 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:11:23,673 | INFO  | Slow KahaDB access: Journal append took: 1 ms, Index update took 2632 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:11:53,784 | INFO  | Slow KahaDB access: Journal append took: 1 ms, Index update took 2736 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:12:19,786 | INFO  | Slow KahaDB access: Journal append took: 0 ms, Index update took 2663 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:13:08,826 | INFO  | Slow KahaDB access: Journal append took: 1 ms, Index update took 2770 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:13:32,862 | INFO  | Slow KahaDB access: Journal append took: 1 ms, Index update took 2819 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:14:08,931 | INFO  | Slow KahaDB access: Journal append took: 0 ms, Index update took 2885 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n2015-03-31 06:14:42,495 | INFO  | Slow KahaDB access: cleanup took 3480 | org.apache.activemq.store.kahadb.AbstractKahaDBStore | ActiveMQ Journal Checkpoint Worker\n2015-03-31 06:16:13,040 | INFO  | Slow KahaDB access: cleanup took 3341 | org.apache.activemq.store.kahadb.AbstractKahaDBStore | ActiveMQ Journal Checkpoint Worker\n2015-03-31 06:16:43,920 | INFO  | Slow KahaDB access: cleanup took 3760 | org.apache.activemq.store.kahadb.AbstractKahaDBStore | ActiveMQ Journal Checkpoint Worker\n2015-03-31 06:17:14,221 | INFO  | Slow KahaDB access: cleanup took 3717 | org.apache.activemq.store.kahadb.AbstractKahaDBStore | ActiveMQ Journal Checkpoint Worker\n2015-03-31 06:17:44,498 | INFO  | Slow KahaDB access: cleanup took 3722 | org.apache.activemq.store.kahadb.AbstractKahaDBStore | ActiveMQ Journal Checkpoint Worker\n2015-03-31 06:18:20,988 | INFO  | Slow KahaDB access: Journal append took: 1 ms, Index update took 2971 ms | org.apache.activemq.store.kahadb.AbstractKahaDBStore | JobScheduler:JMS\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"KahaDB not cleaning up log files","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sw0x2A","name":"sw0x2A","key":"sw0x2a","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stefan Warten","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sw0x2A","name":"sw0x2A","key":"sw0x2a","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stefan Warten","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14592176","id":"14592176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"body":"When this problem occurs, do you see the journal files in the kahadb folder are all sequential?\n\nAlso, in what state are the destinations?  Are there any queues, or durable topic subscriptions, with old messages sitting around?\n\nBTW, the following log setting will get more details (it does generate a lot of output when there are a lot of files):\n\n{{log4j.logger.org.apache.activemq.store.kahadb.MessageDatabase=TRACE}}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"created":"2015-06-18T17:41:27.474+0000","updated":"2015-06-18T17:41:27.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14592196","id":"14592196","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"body":"This issue may have been introduced by the fix for AMQ-5542.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"created":"2015-06-18T17:50:59.660+0000","updated":"2015-06-18T17:50:59.660+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14592400","id":"14592400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"body":"This was caught in production.\n\n* >14,000 files were pending removal\n* all files from the first appeared to remain (i.e. there were no gaps in the file numbers detected)\n* according to the webconsole, all of the destinations were processing messages fine\n* browsing the messages in the webconsole, no old messages were pending on any destination\n* disconnecting clients and allowing messages to flow across the NOB, all messages were consumed but the kahadb files did not cleanup\n* restarting the broker, the kahadb files cleaned up normally\n* capturing the MessageDatabase logging, one destination showed up as holding the very first data file\n* that destination also showed up in the log files with this warning:\n{{Non existent message update attempt rejected. Destination: QUEUE://<SCRUBBED>, Message id: <SCRUBBED>}}\n\nSo, there is a chance this occurrence is related to that warning.  Looking at the code, that warning appears to indicate an attempt to update an index with a message when that message is not found in the StoredDestination (MessageDatabase.updateIndex).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"created":"2015-06-18T19:55:15.886+0000","updated":"2015-06-18T19:55:15.886+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14592408","id":"14592408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"body":"May relate to AMQ-5394; unclear right now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"created":"2015-06-18T19:58:08.801+0000","updated":"2015-06-18T19:58:08.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14592494","id":"14592494","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"body":"The broker configuration with this issue has {{persistJMSRedelivered=true}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"created":"2015-06-18T20:56:56.753+0000","updated":"2015-06-18T20:56:56.753+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14592975","id":"14592975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"body":"CORRECTION: the destination holding the first data file was not the same one in the error message - the latter contained the former, hence the mis-identification.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"created":"2015-06-19T04:04:26.868+0000","updated":"2015-06-19T04:04:26.868+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14603713","id":"14603713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arkin","name":"arkin","key":"arkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arkin Yetis","active":true,"timeZone":"America/Los_Angeles"},"body":"The following warning message stops occurring when persistJMSRedelivered is set to false:\n{code}\nNon existent message update attempt rejected. Destination: QUEUE://<SCRUBBED>, Message id: <SCRUBBED>\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arkin","name":"arkin","key":"arkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arkin Yetis","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-26T22:33:03.059+0000","updated":"2015-06-26T22:33:03.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14603716","id":"14603716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arkin","name":"arkin","key":"arkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arkin Yetis","active":true,"timeZone":"America/Los_Angeles"},"body":"We have also observed that in some cases restarting the broker or simply browsing a queue through the web console triggered a cleanup.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arkin","name":"arkin","key":"arkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arkin Yetis","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-26T22:36:59.105+0000","updated":"2015-06-26T22:36:59.105+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14608855","id":"14608855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"I noticed this issue happening as well after upgrading some brokers to 5.11.1.  I'm not really sure what's going on yet.  I have persistJMSRedelivered set to true and I'm going to try setting it to false to see if that helps.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-06-30T18:49:50.589+0000","updated":"2015-06-30T18:49:50.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14644833","id":"14644833","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"body":"I find something very interesting concerning this problem.\n\nI can reproduce it when I set producerFlowControl=\"false\" in in policyEntry on activemq.xml \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"created":"2015-07-28T18:44:19.089+0000","updated":"2015-07-28T18:44:19.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14644868","id":"14644868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"body":"{code:title=Trace log with producerFlowControl=\"false\"}\n 2015-07-28 20:56:16,908 [eckpoint Worker] TRACE MessageDatabase                - Last update: 8:17837754, full gc candidates set: [1, 2, 3, 4, 5, 6, 7, 8]\n 2015-07-28 20:56:16,909 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after producerSequenceIdTrackerLocation:8, [1, 2, 3, 4, 5, 6, 7]\n 2015-07-28 20:56:16,909 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after ackMessageFileMapLocation:8, [1, 2, 3, 4, 5, 6, 7]\n 2015-07-28 20:56:16,909 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after tx range:[null, null], [1, 2, 3, 4, 5, 6, 7]\n 2015-07-28 20:56:16,911 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after dest:0:longTerm, [2, 3, 4, 5, 6, 7]\n 2015-07-28 20:56:16,911 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after dest:0:shortTerm, [2, 3, 4, 5, 6, 7]\n 2015-07-28 20:56:16,912 [eckpoint Worker] TRACE MessageDatabase                - gc candidates: [2, 3, 4, 5, 6, 7]\n 2015-07-28 20:56:16,912 [eckpoint Worker] TRACE MessageDatabase                - not removing data file: 2 as contained ack(s) refer to referenced file: [1, 2]\n 2015-07-28 20:56:16,913 [eckpoint Worker] TRACE MessageDatabase                - not removing data file: 3 as contained ack(s) refer to referenced file: [2, 3]\n 2015-07-28 20:56:16,913 [eckpoint Worker] TRACE MessageDatabase                - not removing data file: 4 as contained ack(s) refer to referenced file: [3, 4]\n 2015-07-28 20:56:16,913 [eckpoint Worker] TRACE MessageDatabase                - not removing data file: 5 as contained ack(s) refer to referenced file: [4, 5]\n 2015-07-28 20:56:16,914 [eckpoint Worker] TRACE MessageDatabase                - not removing data file: 6 as contained ack(s) refer to referenced file: [5, 6]\n 2015-07-28 20:56:16,914 [eckpoint Worker] TRACE MessageDatabase                - not removing data file: 7 as contained ack(s) refer to referenced file: [6, 7]\n 2015-07-28 20:56:16,914 [eckpoint Worker] DEBUG MessageDatabase                - Checkpoint done.\n{code}\n\n{code:title=Trace log with producerFlowControl=\"true\"}\n 2015-07-28 20:59:47,203 [eckpoint Worker] DEBUG MessageDatabase                - Checkpoint started.\n 2015-07-28 20:59:47,393 [eckpoint Worker] TRACE MessageDatabase                - Last update: 7:17837754, full gc candidates set: [1, 2, 3, 4, 5, 6, 7]\n 2015-07-28 20:59:47,394 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after producerSequenceIdTrackerLocation:7, [1, 2, 3, 4, 5, 6]\n 2015-07-28 20:59:47,394 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after ackMessageFileMapLocation:7, [1, 2, 3, 4, 5, 6]\n 2015-07-28 20:59:47,394 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after tx range:[null, null], [1, 2, 3, 4, 5, 6]\n 2015-07-28 20:59:47,395 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after dest:0:longTerm, [2, 3, 4, 5, 6]\n 2015-07-28 20:59:47,395 [eckpoint Worker] TRACE MessageDatabase                - gc candidates after dest:0:shortTerm, [2, 3, 4, 5, 6]\n 2015-07-28 20:59:47,396 [eckpoint Worker] TRACE MessageDatabase                - gc candidates: [2, 3, 4, 5, 6]\n 2015-07-28 20:59:47,396 [eckpoint Worker] DEBUG MessageDatabase                - Cleanup removing the data files: [2, 3, 4, 5, 6]\n 2015-07-28 20:59:47,427 [eckpoint Worker] DEBUG MessageDatabase                - Checkpoint done.\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"created":"2015-07-28T19:07:20.474+0000","updated":"2015-07-28T19:07:20.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14644901","id":"14644901","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brianjohnson","name":"brianjohnson","key":"brianjohnson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian D. Johnson","active":true,"timeZone":"America/New_York"},"body":"We have seen this behavior a lot following upgrades to 5.11.1; however, in every case the log files are cleaned up when the persistent messages they reference are consumed.\n\nWhat you are experiencing is a direct result of AMQ-5542.  If you read that ticket you will understand why log files are being retained longer than in previous releases.  Unfortunately, the accumulation of journal logs tends to snowball under a variety of conditions (small message sizes, mixing fast and slow consumers, etc).  Anyone experiencing this may want to look at mKahaDB as a possible solution.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brianjohnson","name":"brianjohnson","key":"brianjohnson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian D. Johnson","active":true,"timeZone":"America/New_York"},"created":"2015-07-28T19:32:27.180+0000","updated":"2015-07-28T19:32:27.180+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14647470","id":"14647470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"body":"You're right Brian, producerFlowControl true or false is just a border effect.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"created":"2015-07-30T10:58:48.079+0000","updated":"2015-07-30T10:58:48.079+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14647476","id":"14647476","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"As a follow up to my post a month ago, I don't think persistJMSRedelivered has anything to do with it.  After more investigation I agree with [~brianjohnson].  The issue seems to just be related to a variety of conditions.  mKahaDB has helped in my case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-07-30T11:04:40.195+0000","updated":"2015-07-30T11:04:40.195+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14693308","id":"14693308","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nands","name":"nands","key":"nands","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nandkishore Singh","active":true,"timeZone":"Etc/UTC"},"body":"We encountered the same problem in our performance test environments. I don't think this bug is only encountered when you have a mix of  fast and slow consumers sharing the same kahadb store. We are using ActiveMQ 5.11.1 in our environments.\nThe behaviour we noticed was that ActiveMQ wrote the messages to a new kahadb file (journal log) after every 32 mb (default configuration). This  lead to the message and its corresponding ack ending up in different files. It resulted in a chain of such journal logs which couldn't be cleaned up by ActiveMQ. It eventually filled up the disk causing ActiveMQ to shutdown\nWe do not have any 'slow' producers/consumers, All the responses during our performance tests were within 80 milliseconds. It implies that the issue is easily reproduced under high load.  \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nands","name":"nands","key":"nands","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nandkishore Singh","active":true,"timeZone":"Etc/UTC"},"created":"2015-08-12T10:51:11.330+0000","updated":"2015-08-12T10:51:11.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14693333","id":"14693333","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~nands] would it be possible to turn the sequence of events of your pref test into something small in a unit type test? If a trivial perf scenario can produce this behaviour we need to invest in some mitigation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-08-12T11:25:05.804+0000","updated":"2015-08-12T11:25:05.804+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/14693435","id":"14693435","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nands","name":"nands","key":"nands","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nandkishore Singh","active":true,"timeZone":"Etc/UTC"},"body":"Gary, It was not easy for us to capture the sequence of events in to a smaller test. The question is, When activemq creates a new journal log after the threshold limit of 32 MB, What happens to the messages in the journal log for which it has not received an ACK yet. Does it move these messages to the new journal.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nands","name":"nands","key":"nands","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nandkishore Singh","active":true,"timeZone":"Etc/UTC"},"created":"2015-08-12T12:49:50.720+0000","updated":"2015-08-12T12:49:50.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15004284","id":"15004284","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Messages are not moved, so if an message is not ACK'd yet then that log file must be retained until it is.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-11-13T16:54:08.017+0000","updated":"2015-11-13T16:54:08.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15004689","id":"15004689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbrozovsky","name":"lbrozovsky","key":"lbrozovsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbrozovsky&avatarId=22840","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbrozovsky&avatarId=22840","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbrozovsky&avatarId=22840","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbrozovsky&avatarId=22840"},"displayName":"Lukáš Brožovský","active":true,"timeZone":"Europe/Prague"},"body":"We experience this in production all the time. During heavy load there's always some messages without ACK when rolling journal log to a new file and therefore the old journal log is never deleted - instead infinite chain of log files just keeps on growing. Assuming for example the case that there's single undelivered message in the first one (e.g. DLQ). So because of this single msg and heavy load nothing gets deleted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lbrozovsky","name":"lbrozovsky","key":"lbrozovsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lbrozovsky&avatarId=22840","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbrozovsky&avatarId=22840","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbrozovsky&avatarId=22840","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbrozovsky&avatarId=22840"},"displayName":"Lukáš Brožovský","active":true,"timeZone":"Europe/Prague"},"created":"2015-11-13T20:47:56.630+0000","updated":"2015-11-13T20:47:56.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15004705","id":"15004705","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arkin","name":"arkin","key":"arkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arkin Yetis","active":true,"timeZone":"America/Los_Angeles"},"body":"We have this condition persisting even after all messages are consumed. To clarify, there are no pending messages on any of the queues, but still several hundreds of kahadb files on disk. Once we restart ActiveMQ, it does clean up the files. Perhaps the data in memory tells it to hold on to the files, but during restart when it goes through all the entries in KahaDB, it figures out that the files are no longer needed. Since we moved to multiKahaDB the occurrence is much less frequent, but it still happens from time to time. It only started after we moved to 5.11.1.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arkin","name":"arkin","key":"arkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arkin Yetis","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-13T20:58:21.537+0000","updated":"2015-11-13T20:58:21.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15105601","id":"15105601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miljan","name":"miljan","key":"miljan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miljan Kosanin","active":true,"timeZone":"Etc/UTC"},"body":"Hi, I am facing same issue: lot of piled up kahadb log files that don't get deleted. It causes CPU peaks. Had to delete it manually, since none of above mentioned workarounds didn't help. Do you have any idea if this has been fixed, or how can I configure activemq to disregard irregularities in old log files (we have log files old 6 months, if some messages didn't get dispatched before 6 months we, and there is no appropriate ACK for them, I don't care) and force old log file deletion?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miljan","name":"miljan","key":"miljan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miljan Kosanin","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-18T18:05:54.201+0000","updated":"2016-01-18T18:05:54.201+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15105752","id":"15105752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miljan","name":"miljan","key":"miljan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miljan Kosanin","active":true,"timeZone":"Etc/UTC"},"body":"Hey Lukáš, did you manage to find workaround for this? It would be really good if you can share possible solution . . .  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miljan","name":"miljan","key":"miljan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miljan Kosanin","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-18T19:54:45.955+0000","updated":"2016-01-18T19:54:45.955+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15144656","id":"15144656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Some recent fixes in this area around cleaning out logs files, would be good to retest with the v5.13.1 and see how that works out.  A reproducer for the issue will really help if you can figure out a test case that can trigger it.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-02-12T14:51:53.445+0000","updated":"2016-02-12T14:51:53.445+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15221215","id":"15221215","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranryan","name":"kieranryan","key":"kieranryan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Ryan","active":true,"timeZone":"Etc/UTC"},"body":"We've seen this issue too in production. i.e. A noticeable increase in disk usage on 5.11. We compared behaviour with 5.9 and 5.13 and found 5.11 to be the odd one out. I am wondering why the closure says \"cannot reproduce\". We are currently working on a test case we can share.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranryan","name":"kieranryan","key":"kieranryan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Ryan","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-01T06:04:10.429+0000","updated":"2016-04-01T06:04:10.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15221549","id":"15221549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"If you can contribute back a test case which shows an issue (on the current version, ie 5.13.x) then this can always be reopened.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-04-01T11:03:10.380+0000","updated":"2016-04-01T11:03:10.380+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15232383","id":"15232383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"5.13.1 still has it.\n\nIt would be nice to see if AMQ-6203 fix will resolve this one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2016-04-08T15:57:53.945+0000","updated":"2016-04-08T15:57:53.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15436997","id":"15436997","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roboy","name":"roboy","key":"roboy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=roboy&avatarId=29346","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=roboy&avatarId=29346","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=roboy&avatarId=29346","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=roboy&avatarId=29346"},"displayName":"Lukas Macek","active":true,"timeZone":"Europe/Prague"},"body":"We're experiencing the same behavior on 5.11.1, or our customers... And it happens when there are slow consumers for whatever reason. In particular circumstances it happens regularly on the customers' sites. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roboy","name":"roboy","key":"roboy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=roboy&avatarId=29346","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=roboy&avatarId=29346","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=roboy&avatarId=29346","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=roboy&avatarId=29346"},"displayName":"Lukas Macek","active":true,"timeZone":"Europe/Prague"},"created":"2016-08-25T14:36:41.907+0000","updated":"2016-08-25T14:36:41.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15708905","id":"15708905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"body":"We've got this problem with 5.13.3 and I suspect it's when the broker or consumer is too busy to send/process the ACK.\n\nThose suffering - are your consumers ACKing each message in turn, or are they using the default of receiving 1,000 messages (JMS) and ACKing the last? Might help narrow the scope of the problem.\n\nIs there an MBean I can execute a command on to force clean-up or must I restart the entire ActiveMQ process (thus forcing a restart of connections)?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"created":"2016-11-30T15:44:46.193+0000","updated":"2016-11-30T15:44:46.193+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786968/comment/15823904","id":"15823904","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hoozecn","name":"hoozecn","key":"hoozecn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Zhimin Wu","active":true,"timeZone":"Asia/Shanghai"},"body":"The problem seems to have been fixed after upgrade from 5.13.1 to 5.14.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hoozecn","name":"hoozecn","key":"hoozecn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Zhimin Wu","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-01-16T12:42:50.649+0000","updated":"2017-01-16T12:42:50.649+0000"}],"maxResults":29,"total":29,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5695/votes","votes":6,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i27kyv:"}}