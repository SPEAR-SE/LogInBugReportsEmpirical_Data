{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481975","self":"https://issues.apache.org/jira/rest/api/2/issue/12481975","key":"AMQ-527","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-05-22T17:42:53.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jun 12 14:50:22 UTC 2007","customfield_12310420":"49183","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_42660796923_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2007-06-12T14:50:22.923+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-527/watchers","watchCount":0,"isWatching":false},"created":"2006-02-03T20:37:06.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315607","id":"12315607","description":"Milestone 4","name":"4.0 M4","archived":false,"released":true,"releaseDate":"2006-01-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-06-12T14:50:22.911+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Setup: \n\n3 networked brokers, B1, B2, and B3, on 3 servers, connected using multicast discovery. activemq.xml: \n\n <broker useJmx=\"false\" brokerName=\"B1\"> \n \n <persistenceAdapter>\n        <journaledJDBC journalLogFiles=\"5\" dataDirectory=\"foo\" dataSource=\"#mysql-ds\"/>\n </persistenceAdapter>\n \n <transportConnectors> \n <transportConnector uri=\"tcp://localhost:61616\" discoveryUri=\"multicast://default\"/> \n </transportConnectors> \n \n <networkConnectors> \n <networkConnector uri=\"multicast://default\"/> \n </networkConnectors> \n \n </broker> \n \n <bean id=\"mysql-ds\" class=\"org.apache.commons.dbcp.BasicDataSource\" destroy-method=\"close\">\n           <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\"/>\n           <property name=\"url\" value=\"jdbc:mysql://localhost/activemq?relaxAutoCommit=true\"/>\n                 <property name=\"username\" value=\"activemqUser\"/>\n                 <property name=\"password\" value=\"activemqPwd\"/>\n                 <property name=\"poolPreparedStatements\" value=\"true\"/>\n </bean>\n\nSimilar for B2 and B3. \n\nTwo queues: Q1 and Q2. \n\nTwo producers, one for each queue, both producers connected to B1. \n\nOne Q1 cosumer connected to B1, another Q1 consumer on B2. \n\nOne Q2 consumer connected to B2, another Q2 consumer connected to B3. \n\nThe problems:\n\nProblem 1: \nQ1 messages are all consumed on B1, never delivered to B2, although there is a Q1 consumer on B2. I understand this is probably the expected behavior, although this definitely looks like a load balancing issue. \n\nProblem 2: \nAll Q2 messages remain persistented in the MySQL DB on B1, even after being successfully forwarded to B2 and B3 and consumed there. \n\nProblem 3: \nWhen all the JMS entities are stoped and restarted, Q1 works fine after a while, but all Q2 messages are no longer forwarded to B2 and B3. This means that all Q2 messages are not consumed but persisted instead, further increase the size of the persistent store. \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"254690","customfield_12312823":null,"summary":"4.0 M4 Persistent Issue with network brokers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhu","name":"lhu","key":"lhu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Leon Hu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhu","name":"lhu","key":"lhu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Leon Hu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"RadHat Linux Enterprise Server 3, Tomcat 5.5.15, MySQL 5.0.18 for Linux","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481975/comment/12937390","id":"12937390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhu","name":"lhu","key":"lhu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Leon Hu","active":true,"timeZone":"Etc/UTC"},"body":"1. It appears that messages forwarded to another broker is not pulled out of the persistent store. \n2. Once a message gets to the database, it is never deleted even if it delivered and consumed.\n\nThis is a serious bug. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhu","name":"lhu","key":"lhu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Leon Hu","active":true,"timeZone":"Etc/UTC"},"created":"2006-02-04T03:37:02.000+0000","updated":"2006-02-04T03:37:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481975/comment/12937584","id":"12937584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"Leon, could you retest with version 4.0 please?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-05-22T17:42:53.000+0000","updated":"2006-05-22T17:42:53.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481975/comment/12936416","id":"12936416","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"Its been over a year since we asked for more feedback; so am gonna assume this is now resolved. Let us know if its not and we can reopen","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-12T14:50:22.892+0000","updated":"2007-06-12T14:50:22.892+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-527/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i17zb3:"}}