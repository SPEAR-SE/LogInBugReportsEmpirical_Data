{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483164","self":"https://issues.apache.org/jira/rest/api/2/issue/12483164","key":"AMQ-968","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2006-10-12T09:43:50.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 27 21:11:36 UTC 2011","customfield_12310420":"33640","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_156582584893_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-09-27T21:11:36.862+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-968/watchers","watchCount":1,"isWatching":false},"created":"2006-10-11T14:01:52.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315612","id":"12315612","description":"","name":"4.0.2","archived":false,"released":true,"releaseDate":"2006-07-25"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-09-27T21:11:36.888+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"For the AMQ reconnection issue, I think it is caused by client can not stop the broker correctly after server broker is stopped. \n\nAttached zip is the test case, it is an IDEA prj, to compile or run it the incubator-activemq-4.0.jar (download from http://people.apache.org/repository/incubator-activemq/jars/incubator-activemq-4.0.jar ) should be involved. In the prj, I added two run configurations: Client, Sever to try all kinds of connection scenarios below:\n1. Start client, then start server\n2. Start server, then start client\n3. Restart client\n4. Restart server\n5. Stop server, then stop client, after that restart server again, then restart client\n\nAll scenarios will be successful if using the run configurations in IDEA, but if we run the server and client in DOS command line, we will find the #5 is failed. \n\nHere is the reason, if the server broker is stopped, the client can not be stopped using CTL + C, and the interrupt signal is always only captured by the client broker rather than its JVM. In this time, if we restart the server, no any messages can be received again. But the messages in client can not be lost, after killing the client and restarting it, the messages can be still sent to server. \n\nSo to the scenario in Domain Log, the managed server must be killed by kill-9 shell and can not be stopped by shutdown.bat (sh) script.\n\nUuuuuunfortunately, the scenario #4 is still failed in Domain Log though the codes are same with above test case's (it IS successful in the test case). I can not get the reason after I struggled for it the whole day :(. I am not sure if the AMQ network connector is impacted in Tomcat runtime env.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460692","id":"12460692","filename":"ASF.LICENSE.NOT.GRANTED--jmstest.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andypiper","name":"andypiper","key":"andypiper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Piper","active":true,"timeZone":"Etc/UTC"},"created":"2006-10-11T14:01:52.000+0000","size":12143,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12460692/ASF.LICENSE.NOT.GRANTED--jmstest.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172125","customfield_12312823":null,"summary":"Store and Forward reconnect failures","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andypiper","name":"andypiper","key":"andypiper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Piper","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andypiper","name":"andypiper","key":"andypiper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Piper","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"All","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483164/comment/12938483","id":"12938483","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=man2c","name":"man2c","key":"man2c","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiang-Kevin-Wang","active":true,"timeZone":"Etc/UTC"},"body":"Good news, the Scenario #4 has been succeeded in Domain Log as well, now restarting the AS will automatically reconnect the store-forward AMQ with remote MS (s). I guess the reason is the store-forward broker (on MS) should disable the JMX or must guarantee the JMX is started correctly if JMX enabled. In previous failure of reconnection, the JMX of managed broker is not started successfully; but when I disable JMX on the broker (broker.setUseJmx(false)), the Scenario is okay!\n\n\nbut it is still an issue that the client (store-forward) AMQ can not stop when the server AMQ is closed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=man2c","name":"man2c","key":"man2c","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiang-Kevin-Wang","active":true,"timeZone":"Etc/UTC"},"created":"2006-10-12T09:43:50.000+0000","updated":"2006-10-12T09:43:50.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483164/comment/13115930","id":"13115930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The 4.x broker line is EOL","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-09-27T21:11:36.886+0000","updated":"2011-09-27T21:11:36.886+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-968/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ttq7:"}}