{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483317","self":"https://issues.apache.org/jira/rest/api/2/issue/12483317","key":"AMQ-1780","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-02-28T19:18:12.161+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jun 19 17:01:52 UTC 2015","customfield_12310420":"14608","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_88525433897_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-03-28T11:08:31.200+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1780/watchers","watchCount":11,"isWatching":false},"created":"2008-06-06T20:44:37.356+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"issuelinks":[{"id":"12347059","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12347059","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12483693","key":"AMQ-2497","self":"https://issues.apache.org/jira/rest/api/2/issue/12483693","fields":{"summary":"Message broker won't come back when the databse goes offline and comes back online","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-06-19T17:01:52.091+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"hi\n\nWe are noticing that after any SQL Server restart or network blip between ActiveMQ and the database, after the connection or the database comes back online activeMQ broker needs to be restarted as well i.e it doesn't automatically re-establish connection to the database as result any message send fails because the broker is still using the stale connection to the database. \n\nIs this designed behaviour or a bug? we are using ActiveMQ 5.0.0 and the latest version of the JSQLConnect database driver: version 5.7. The database we are using is MS SQL Server 2005 \n\nRight now, in our production environment any time we have network maintenance or database restart we also have to restart the ActiveMQ broker which is not a good option for us. \n\nAlso, We are using a single ActiveMQ broker and not the JDBC(Master/Slave) set up.\n\nIssue details in\n\nhttp://www.nabble.com/Database-connection-between-ActiveMQ-and-broker-td17321330s2354.html\n\nPlease let me know if I need to give more information\n\nthanks\njaya\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59039","customfield_12312823":null,"summary":"ActiveMQ broker does not automatically reconnect if the connection to the database is lost","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsrinivasan","name":"jsrinivasan","key":"jsrinivasan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaya Srinivasan","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsrinivasan","name":"jsrinivasan","key":"jsrinivasan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaya Srinivasan","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows 2003 Server","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/12939888","id":"12939888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsrinivasan","name":"jsrinivasan","key":"jsrinivasan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaya Srinivasan","active":true,"timeZone":"Etc/UTC"},"body":"hi\n\ncan someone give an ETA on when this would be fixed?\n\nthanks!\njaya","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsrinivasan","name":"jsrinivasan","key":"jsrinivasan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jaya Srinivasan","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-24T04:05:03.154+0000","updated":"2008-06-24T04:05:03.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13000474","id":"13000474","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kaiqinsun","name":"kaiqinsun","key":"kaiqinsun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kaiqin Sun","active":true,"timeZone":"Etc/UTC"},"body":"This is an issue in our production as well and hope it could be fixed soon.\n\nThanks,\nKaiqin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kaiqinsun","name":"kaiqinsun","key":"kaiqinsun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kaiqin Sun","active":true,"timeZone":"Etc/UTC"},"created":"2011-02-28T19:18:12.161+0000","updated":"2011-02-28T19:18:12.161+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13011998","id":"13011998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"reused the plug-able [IOExceptionHandler|http://activemq.apache.org/configurable-ioexception-handling.html]. It is now called when a call to JDBC getConnection fails. Extended the DefaultIOExceptionHandler to allow stop/resume of connectors option rather than simple broker stop. Added Xbean support for DefaultIOExceptionHandler so it can be easily included in xml configuration.\n\nRelevant programatic configuration from the test, use stopStartConnectors and do not ignore sql exceptions. Disable the default DB lock such that it will not stop the broker on a lock failure.{code}        DefaultIOExceptionHandler handler = new DefaultIOExceptionHandler();\n        handler.setIgnoreSQLExceptions(false);\n        handler.setStopStartConnectors(true);\n        broker.setIoExceptionHandler(handler);\n        JDBCPersistenceAdapter persistenceAdapter = new JDBCPersistenceAdapter();\n        persistenceAdapter.setDataSource(sharedDs);\n        persistenceAdapter.setUseDatabaseLock(false);\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-28T11:08:31.235+0000","updated":"2011-03-28T11:08:31.235+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13016274","id":"13016274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"body":"Is this really been fixed in 5.5 ?\n\nI just tried out 5.5 and same thing happens - as soon as I restart the SQLService the ActiveQM broker shutdowns completely...\n\n(NOTE: I am using same activemq.xml config files copied across from 5.4.2 instance, do I need to modify something for \"fix\" to take effect maybe?)\n\nThank you!\n\n\n\n--- LOG ---\n\n...\n INFO | Using Persistence Adapter: JDBCPersistenceAdapter(org.apache.commons.dbcp.BasicDataSource@1f758cd1)\n INFO | JMX consoles can connect to service:jmx:rmi:///jndi/rmi://localhost:2011/jmxrmi\n INFO | Database adapter driver override recognized for : [microsoft_sql_server_jdbc_driver_2_0] - adapter: class org.apache.activemq.store.jdbc.adapter.TransactJDBCAdapter\n INFO | Database lock driver override recognized for : [microsoft_sql_server_jdbc_driver_2_0] - adapter: class org.apache.activemq.store.jdbc.adapter.TransactDatabaseLocker\n INFO | Attempting to acquire the exclusive lock to become the Master broker\n INFO | Becoming the master on dataSource: org.apache.commons.dbcp.BasicDataSource@1f758cd1\n INFO | ActiveMQ 5.5.0 JMS Message Broker (MobTechTest1) is starting\n INFO | For help or more information please see: http://activemq.apache.org/\n INFO | Listening for connections at: nio://mdtapdot01:10001\n INFO | Connector openwire Started\n INFO | Listening for connections at: stomp://mdtapdot01:10002\n INFO | Connector STOMP Started\n INFO | Listening for connections at: xmpp://mdtapdot01:10003\n INFO | Connector xmpp Started\n INFO | ActiveMQ JMS Message Broker (MobTechTest1, ID:mdtapdot01-46867-1302071153455-0:1) started\n INFO | jetty-7.1.6.v20100715\n INFO | ActiveMQ WebConsole initialized.\n INFO | Initializing Spring FrameworkServlet 'dispatcher'\n INFO | ActiveMQ Console at http://0.0.0.0:8161/admin\n INFO | Initializing Spring root WebApplicationContext\n INFO | OSGi environment not detected.\n INFO | Apache Camel 2.7.0 (CamelContext: camel) is starting\n INFO | JMX enabled. Using ManagedManagementStrategy.\n INFO | Found 5 packages with 16 @Converter classes to load\n INFO | Loaded 152 type converters in 1.914 seconds\n INFO | Connector vm://MobTechTest1 Started\n INFO | Route: route1 started and consuming from: Endpoint[activemq://MDT.INBOUND]\n INFO | Total 1 routes, of which 1 is started.\n INFO | Apache Camel 2.7.0 (CamelContext: camel) started in 5.167 seconds\n INFO | Camel Console at http://0.0.0.0:8161/camel\n INFO | ActiveMQ Web Demos at http://0.0.0.0:8161/demo\n INFO | RESTful file access application at http://0.0.0.0:8161/fileserver\n INFO | Started SelectChannelConnector@0.0.0.0:8161\nERROR | Failed to update database lock: com.microsoft.sqlserver.jdbc.SQLServerException: Broken pipe\ncom.microsoft.sqlserver.jdbc.SQLServerException: Broken pipe\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.terminate(SQLServerConnection.java:1368)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.terminate(SQLServerConnection.java:1355)\n        at com.microsoft.sqlserver.jdbc.TDSChannel.write(IOBuffer.java:1548)\n        at com.microsoft.sqlserver.jdbc.TDSWriter.flush(IOBuffer.java:2368)\n        at com.microsoft.sqlserver.jdbc.TDSWriter.writePacket(IOBuffer.java:2270)\n        at com.microsoft.sqlserver.jdbc.TDSWriter.endMessage(IOBuffer.java:1877)\n        at com.microsoft.sqlserver.jdbc.TDSCommand.startResponse(IOBuffer.java:4403)\n        at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePreparedStatement(SQLServerPreparedStatement.java:386)\n        at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecCmd.doExecute(SQLServerPreparedStatement.java:338)\n        at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:4026)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:1416)\n        at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:185)\n        at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:160)\n        at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeUpdate(SQLServerPreparedStatement.java:306)\n        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:102)\n        at org.apache.activemq.store.jdbc.DefaultDatabaseLocker.keepAlive(DefaultDatabaseLocker.java:161)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.databaseLockKeepAlive(JDBCPersistenceAdapter.java:605)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter$3.run(JDBCPersistenceAdapter.java:291)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)\n        at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317)\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)\n INFO | No longer able to keep the exclusive lock so giving up being a master\n INFO | ActiveMQ Message Broker (MobTechTest1, ID:mdtapdot01-46867-1302071153455-0:1) is shutting down\n INFO | Connector openwire Stopped\n INFO | Connector STOMP Stopped\n INFO | Connector xmpp Stopped\n INFO | Connector vm://MobTechTest1 Stopped\n INFO | PListStore:/usr/local/tollmobile/activemq54data/data/MobTechTest1/tmp_storage stopped\n INFO | ActiveMQ JMS Message Broker (MobTechTest1, ID:mdtapdot01-46867-1302071153455-0:1) stopped\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-06T06:37:28.714+0000","updated":"2011-04-06T06:37:28.714+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13016295","id":"13016295","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Oleg, you do need to make some configuration changes as indicated in the previous comment as this is a behavior change.\nYou need to configure an IOExceptionHandler for the broker to override the defaults{code}<ioExceptionHandler\n  <defaultIOExceptionHandler ignoreSQLExceptions=\"false\" stopStartConnectors=\"true\" />\n</ioExceptionHandler>{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-06T08:01:47.134+0000","updated":"2011-04-06T08:01:47.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13016673","id":"13016673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Gary!\n\nI think I \"get it\" now... adding that config tweak and also - very importantly - setting useDatabaseLock=\"false\" in jdbcPersistenceAdapter \n\ndoes the trick for a single standalone broker, but for a cluster there is still an outstanding issue (where you mention all these too in comments): https://issues.apache.org/jira/browse/AMQ-2497\n\nso yes if this issue (AMQ-1780) is meant to be the context of not-a-cluster setup only then I can confirm it appears indeed to be fixed...\n\nHope the AMQ-2497 (as tricky as it sounds) does get fix in 5.6 as planned too... ;)\n\n\n\n\n\n\n\n\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-07T03:55:27.594+0000","updated":"2011-04-07T03:55:27.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13016679","id":"13016679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"body":"there is an issue however... \n\nwhen the database is stopped for very small period of time - everything works somewhat rather smoothly and as expected... but once DB is not available for longer time (5 secs)\n\n\" INFO | waiting for broker persistence adapter checkpoint to succeed before restarting transports\"\n\nand \n\n\"INFO | Connector openwire Stopped\"\n\nso far so good - makes sense (but note that it only stooped \"openwire\" one at this point,\n\nbut when I restart the database, it then goes and stops (!!) the other transport connectors (in particular STOMP one), but does not start them back...\n\nINFO | Connector STOMP Stopped\n INFO | Connector xmpp Stopped\n\n\n\n\nonly when I go to jConsole and _manually_ start the STOMP transport connector (one we're using) things get back to normal...\n\n INFO | Listening for connections at: stomp://mdtapdot01:10002\n INFO | Connector STOMP Started\n\nbut that means it requires a manual procedure....\n\nit seems to me this is a bug and in fact it was meant to actually \"restart transports\", not just stop them...\n\nit might be that there is in fact a different handling of \"openwire\" and the other s (\"STOMP\") connectors... (based on the fact that \"openwire\" stops when DB connection detected as lost, but \"STOMP\" gets stopped when DB is restored... and does not get restarted automatically...\n\n\n??\n\n\n\n\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-07T04:27:01.616+0000","updated":"2011-04-07T04:27:01.616+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13016859","id":"13016859","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I wonder what is causing the delay in the shutdown of all the transports. They should all be shutdown in order by the same thread. Is there anything odd in the logs?\n\nIt looks like the stop thread is blocked for some time until restart and the restart is complete before the stop is complete.\n\nCould you generate a thread dump of the broker after it has stopped openwire and before you restart... so the stop of stomp should be pending at that time?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-07T14:53:05.930+0000","updated":"2011-04-07T14:53:05.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13017299","id":"13017299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary \n\ninterestingly, on some of the attempts I did today all transport connectors do stop all at same time (when DB conn is lost)...but in either case however they are not been restarted automatically when DB restored...\n\nI tried to produce a thread dump - this is what could fit on shell screen:\n\n---\n\"qtp768129156-32\" prio=3 tid=0x0000000101885800 nid=0x23 waiting on condition [0xfffffffd6bafe000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0xfffffffedce04c38> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1963)\n        at org.eclipse.jetty.util.BlockingArrayQueue.poll(BlockingArrayQueue.java:320)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:465)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"qtp768129156-31\" prio=3 tid=0x00000001010dc000 nid=0x22 waiting on condition [0xfffffffd6bcfe000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0xfffffffedce04c38> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1963)\n        at org.eclipse.jetty.util.BlockingArrayQueue.poll(BlockingArrayQueue.java:320)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:465)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"qtp768129156-30\" prio=3 tid=0x00000001013fe000 nid=0x21 waiting on condition [0xfffffffd6befe000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0xfffffffedce04c38> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1963)\n        at org.eclipse.jetty.util.BlockingArrayQueue.poll(BlockingArrayQueue.java:320)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:465)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"qtp768129156-29\" prio=3 tid=0x00000001013fd800 nid=0x20 waiting on condition [0xfffffffd6c0fe000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0xfffffffedce04c38> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1963)\n        at org.eclipse.jetty.util.BlockingArrayQueue.poll(BlockingArrayQueue.java:320)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:465)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"qtp768129156-28 - Acceptor0 SelectChannelConnector@0.0.0.0:8161\" prio=3 tid=0x0000000100e89000 nid=0x1f runnable [0xfffffffd6c2fe000]\n   java.lang.Thread.State: RUNNABLE\n        at sun.nio.ch.DevPollArrayWrapper.poll0(Native Method)\n        at sun.nio.ch.DevPollArrayWrapper.poll(DevPollArrayWrapper.java:170)\n        at sun.nio.ch.DevPollSelectorImpl.doSelect(DevPollSelectorImpl.java:68)\n        at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:69)\n        - locked <0xffffffff03259268> (a sun.nio.ch.Util$1)\n        - locked <0xffffffff03259250> (a java.util.Collections$UnmodifiableSet)\n        - locked <0xffffffff03258ef0> (a sun.nio.ch.DevPollSelectorImpl)\n        at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:80)\n        at org.eclipse.jetty.io.nio.SelectorManager$SelectSet.doSelect(SelectorManager.java:480)\n        at org.eclipse.jetty.io.nio.SelectorManager.doSelect(SelectorManager.java:193)\n        at org.eclipse.jetty.server.nio.SelectChannelConnector.accept(SelectChannelConnector.java:134)\n        at org.eclipse.jetty.server.AbstractConnector$Acceptor.run(AbstractConnector.java:793)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:436)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"ActiveMQ Broker[MobTechTest1] Scheduler\" daemon prio=3 tid=0x000000010109d000 nid=0x18 in Object.wait() [0xfffffffd6d6ff000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0xfffffffedc814190> (a java.util.TaskQueue)\n        at java.util.TimerThread.mainLoop(Timer.java:509)\n        - locked <0xfffffffedc814190> (a java.util.TaskQueue)\n        at java.util.TimerThread.run(Timer.java:462)\n\n\"ActiveMQ Cleanup Timer\" daemon prio=3 tid=0x0000000100e35000 nid=0x17 waiting on condition [0xfffffffd6e8fe000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0xfffffffedc766668> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1963)\n        at java.util.concurrent.DelayQueue.take(DelayQueue.java:164)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:583)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:576)\n        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:947)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"RMI TCP Connection(5)-10.38.58.172\" daemon prio=3 tid=0x0000000100f54800 nid=0x16 runnable [0xfffffffd6d8fe000]\n   java.lang.Thread.State: RUNNABLE\n        at java.net.SocketInputStream.socketRead0(Native Method)\n        at java.net.SocketInputStream.read(SocketInputStream.java:129)\n        at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)\n        at java.io.BufferedInputStream.read(BufferedInputStream.java:237)\n        - locked <0xfffffffed9747f10> (a java.io.BufferedInputStream)\n        at java.io.FilterInputStream.read(FilterInputStream.java:66)\n        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:517)\n        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:790)\n        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:649)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"RMI RenewClean-[10.66.179.1:50344]\" daemon prio=3 tid=0x0000000100efd800 nid=0x15 in Object.wait() [0xfffffffd6dafe000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0xfffffffed7bf5598> (a java.lang.ref.ReferenceQueue$Lock)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)\n        - locked <0xfffffffed7bf5598> (a java.lang.ref.ReferenceQueue$Lock)\n        at sun.rmi.transport.DGCClient$EndpointEntry$RenewCleanThread.run(DGCClient.java:516)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"RMI Scheduler(0)\" daemon prio=3 tid=0x0000000100dc9800 nid=0x14 waiting on condition [0xfffffffd6defe000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0xfffffffd780eb878> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1963)\n        at java.util.concurrent.DelayQueue.take(DelayQueue.java:164)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:583)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:576)\n        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:947)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"GC Daemon\" daemon prio=3 tid=0x000000010126f800 nid=0x12 in Object.wait() [0xfffffffd6e2ff000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0xfffffffd780001d8> (a sun.misc.GC$LatencyLock)\n        at sun.misc.GC$Daemon.run(GC.java:100)\n        - locked <0xfffffffd780001d8> (a sun.misc.GC$LatencyLock)\n\n\"RMI Reaper\" prio=3 tid=0x00000001010f9000 nid=0x11 in Object.wait() [0xfffffffd6e4ff000]\n   java.lang.Thread.State: WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0xfffffffd78000290> (a java.lang.ref.ReferenceQueue$Lock)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)\n        - locked <0xfffffffd78000290> (a java.lang.ref.ReferenceQueue$Lock)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)\n        at sun.rmi.transport.ObjectTable$Reaper.run(ObjectTable.java:333)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"RMI TCP Accept-0\" daemon prio=3 tid=0x0000000101009800 nid=0x10 runnable [0xfffffffd6e6fe000]\n   java.lang.Thread.State: RUNNABLE\n        at java.net.PlainSocketImpl.socketAccept(Native Method)\n        at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:390)\n        - locked <0xfffffffd782d55d0> (a java.net.SocksSocketImpl)\n        at java.net.ServerSocket.implAccept(ServerSocket.java:453)\n        at java.net.ServerSocket.accept(ServerSocket.java:421)\n        at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:369)\n        at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:341)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"RMI TCP Accept-2011\" daemon prio=3 tid=0x0000000101139800 nid=0xe runnable [0xfffffffd6eafe000]\n   java.lang.Thread.State: RUNNABLE\n        at java.net.PlainSocketImpl.socketAccept(Native Method)\n        at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:390)\n        - locked <0xfffffffd780007b0> (a java.net.SocksSocketImpl)\n        at java.net.ServerSocket.implAccept(ServerSocket.java:453)\n        at java.net.ServerSocket.accept(ServerSocket.java:421)\n        at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:369)\n        at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:341)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"RMI TCP Accept-0\" daemon prio=3 tid=0x00000001007ba800 nid=0xc runnable [0xfffffffd6eefe000]\n   java.lang.Thread.State: RUNNABLE\n        at java.net.PlainSocketImpl.socketAccept(Native Method)\n        at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:390)\n        - locked <0xfffffffd7807dcc8> (a java.net.SocksSocketImpl)\n        at java.net.ServerSocket.implAccept(ServerSocket.java:453)\n        at java.net.ServerSocket.accept(ServerSocket.java:421)\n        at sun.management.jmxremote.LocalRMIServerSocketFactory$1.accept(LocalRMIServerSocketFactory.java:34)\n        at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:369)\n        at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:341)\n        at java.lang.Thread.run(Thread.java:619)\n\n\"Low Memory Detector\" daemon prio=3 tid=0x00000001004fe000 nid=0xb runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"CompilerThread1\" daemon prio=3 tid=0x00000001004f7800 nid=0xa waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"CompilerThread0\" daemon prio=3 tid=0x00000001004f4800 nid=0x9 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Signal Dispatcher\" daemon prio=3 tid=0x00000001004f2800 nid=0x8 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Finalizer\" daemon prio=3 tid=0x00000001004d2800 nid=0x7 in Object.wait() [0xfffffffd704ff000]\n   java.lang.Thread.State: WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0xfffffffd7807e7d0> (a java.lang.ref.ReferenceQueue$Lock)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)\n        - locked <0xfffffffd7807e7d0> (a java.lang.ref.ReferenceQueue$Lock)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)\n        at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\n\n\"Reference Handler\" daemon prio=3 tid=0x00000001004cb800 nid=0x6 in Object.wait() [0xfffffffd706ff000]\n   java.lang.Thread.State: WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0xfffffffd780001b8> (a java.lang.ref.Reference$Lock)\n        at java.lang.Object.wait(Object.java:485)\n        at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)\n        - locked <0xfffffffd780001b8> (a java.lang.ref.Reference$Lock)\n\n\"main\" prio=3 tid=0x0000000100114800 nid=0x2 in Object.wait() [0xffffffff7c4fd000]\n   java.lang.Thread.State: WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0xffffffff03266308> (a [Z)\n        at java.lang.Object.wait(Object.java:485)\n        at org.apache.activemq.console.command.StartCommand.waitForShutdown(StartCommand.java:161)\n        - locked <0xffffffff03266308> (a [Z)\n        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:104)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:143)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:85)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.activemq.console.Main.runTaskClass(Main.java:251)\n        at org.apache.activemq.console.Main.main(Main.java:107)\n\n\"VM Thread\" prio=3 tid=0x00000001004c7800 nid=0x5 runnable\n\n\"GC task thread#0 (ParallelGC)\" prio=3 tid=0x000000010011c000 nid=0x3 runnable\n\n\"GC task thread#1 (ParallelGC)\" prio=3 tid=0x0000000100128000 nid=0x4 runnable\n\n\"VM Periodic Task Thread\" prio=3 tid=0x000000010066c000 nid=0xd waiting on condition\n\nJNI global references: 767\n\nHeap\n PSYoungGen      total 2447872K, used 1608619K [0xfffffffecd800000, 0xffffffff78400000, 0xffffffff78400000)\n  eden space 2098176K, 76% used [0xfffffffecd800000,0xffffffff2faeaca0,0xffffffff4d900000)\n  from space 349696K, 0% used [0xffffffff4d900000,0xffffffff4d900000,0xffffffff62e80000)\n  to   space 349696K, 0% used [0xffffffff62e80000,0xffffffff62e80000,0xffffffff78400000)\n PSOldGen        total 5595136K, used 4074K [0xfffffffd78000000, 0xfffffffecd800000, 0xfffffffecd800000)\n  object space 5595136K, 0% used [0xfffffffd78000000,0xfffffffd783fa8a8,0xfffffffecd800000)\n PSPermGen       total 45056K, used 44664K [0xfffffffd72c00000, 0xfffffffd75800000, 0xfffffffd78000000)\n  object space 45056K, 99% used [0xfffffffd72c00000,0xfffffffd7579e1b8,0xfffffffd75800000)\n\n\n[mdtapdot01]#\n[mdtapdot01]#  INFO | waiting for broker persistence adapter checkpoint to succeed before restarting transports\n INFO | waiting for broker persistence adapter checkpoint to succeed before restarting transports\n INFO | waiting for broker persistence adapter checkpoint to succeed before restarting transports\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-08T05:59:49.108+0000","updated":"2011-04-08T05:59:49.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13017304","id":"13017304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"body":"I also see a message in teh log that might explain why transport connections don't get restarted:\n\n\n[mdtapdot01]#  WARN | Failure occurred while restarting broker connectors\njava.io.IOException: Transport Connector could not be registered in JMX: org.apache.activemq:BrokerName=MobTechTest1,Type=Connector,ConnectorName=openwire\n        at org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:27)\n        at org.apache.activemq.broker.BrokerService.registerConnectorMBean(BrokerService.java:1670)\n        at org.apache.activemq.broker.BrokerService.startTransportConnector(BrokerService.java:2159)\n        at org.apache.activemq.broker.BrokerService.startAllConnectors(BrokerService.java:2073)\n        at org.apache.activemq.util.DefaultIOExceptionHandler$2.run(DefaultIOExceptionHandler.java:99)\nCaused by: javax.management.InstanceAlreadyExistsException: org.apache.activemq:BrokerName=MobTechTest1,Type=Connector,ConnectorName=openwire\n        at com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:453)\n        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.internal_addObject(DefaultMBeanServerInterceptor.java:1484)\n        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:963)\n        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:917)\n        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:312)\n        at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:482)\n        at org.apache.activemq.broker.jmx.ManagementContext.registerMBean(ManagementContext.java:299)\n        at org.apache.activemq.broker.jmx.AnnotatedMBean.registerMBean(AnnotatedMBean.java:65)\n        at org.apache.activemq.broker.BrokerService.registerConnectorMBean(BrokerService.java:1667)\n        ... 3 more\n\n[mdtapdot01]#\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kiorsak","name":"kiorsak","key":"kiorsak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kiorsak","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-08T06:08:14.515+0000","updated":"2011-04-08T06:08:14.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13119180","id":"13119180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=flume","name":"flume","key":"flume","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Lievens","active":true,"timeZone":"Etc/UTC"},"body":"When not using useDatabaseLock=\"true\" on the jdbcPersistenceAdapter I still see the broker go down on a stopped database.\nWhen useDatabaseLock=\"false\" the broker keeps on going on a stopped database but accepted messages disappear (tested with web-console) completely. One should be warned using this setting.\n\n<bean id=\"ioExceptionHandler\" class=\"org.apache.activemq.util.DefaultIOExceptionHandler\">\n\t<property name=\"ignoreAllErrors\"><value>false</value></property>\n        <property name=\"stopStartConnectors\"><value>true</value></property>\n</bean> ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=flume","name":"flume","key":"flume","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Lievens","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-03T07:50:57.665+0000","updated":"2011-10-03T07:50:57.665+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13695040","id":"13695040","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"https://issues.apache.org/jira/browse/AMQ-4575 is relevant.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-27T20:39:30.784+0000","updated":"2013-06-27T20:39:30.784+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/13837963","id":"13837963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kishan3814","name":"kishan3814","key":"kishan3814","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"kishan","active":true,"timeZone":"Etc/UTC"},"body":"Please have a look at https://issues.apache.org/jira/browse/AMQ-4911 andwould appreciate if u guys try to solve ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kishan3814","name":"kishan3814","key":"kishan3814","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"kishan","active":true,"timeZone":"Etc/UTC"},"created":"2013-12-03T18:03:47.716+0000","updated":"2013-12-03T18:03:47.716+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483317/comment/14593638","id":"14593638","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=volkerk","name":"volkerk","key":"volkerk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Volker Kleinschmidt","active":true,"timeZone":"America/Chicago"},"body":"When  using useDatabaseLock=\"true\" of course a stopped DB will cause the broker to go down - it no longer has a lock, nor a means of obtaining one. But when the DB is back up, it needs to be able to re-establish connections, and obtain a new lock, since the DB going down means there no longer is anyone holding that lock. But if you have merely a network blip, and the DB did not go down, you may have a stale session in the DB that still holds the lock, and needs to be killed before a broker can be reestablished. That's tough, but tends to be a lot more reliable than filesystem-based locks, which go AWOL all the time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=volkerk","name":"volkerk","key":"volkerk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Volker Kleinschmidt","active":true,"timeZone":"America/Chicago"},"created":"2015-06-19T17:01:52.025+0000","updated":"2015-06-19T17:01:52.025+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1780/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ah2n:"}}