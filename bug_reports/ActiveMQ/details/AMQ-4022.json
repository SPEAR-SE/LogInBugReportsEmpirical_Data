{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12606236","self":"https://issues.apache.org/jira/rest/api/2/issue/12606236","key":"AMQ-4022","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-09-11T08:42:16.292+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Sep 19 09:13:45 UTC 2012","customfield_12310420":"249861","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1197393361_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-09-19T09:13:45.186+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4022/watchers","watchCount":3,"isWatching":false},"created":"2012-09-05T12:37:11.838+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318549","id":"12318549","name":"5.5.1","archived":false,"released":true,"releaseDate":"2011-10-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-09-19T09:13:45.197+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315706","id":"12315706","name":"stomp"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Executive summary\n---\nWhen an event is about to be delivered to a client while that client simultaneously sends a DISCONNECT message, there's a risk for a deadlock between two threads in ActiveMQ, causing no DISCONNECT receipt as well as \"Already connected\" error if another client connects with the same client ID.\n\n\nDetails\n---\nHere's steps to reproduce, using STOMP, tho it's possible that this issue exists for other protocols also, since the deadlock happens in broker/TransportConnection.java. I could reproduce the error easily with these steps, tho it's entirely possible that some of the steps aren't strictly required but rather provides certain needed timing.\n\n1) Connect to ActiveMQ using STOMP\n\n2) Send a SUBSCRIBE message with destination=/topic/foo, without asking for a receipt. No other options sent in message. \n\n3) Send a message to /topic/foo, without asking for a receipt. Note: It's important that the message is auto-acked by the server.\n\n4) Wait 10ms for message\n\n5) Go right ahead and send DISCONNECT message, asking for a receipt.\n\n5.1) About 20% of the time, the message is never received, nor is the DISCONNECT receipt.\n\n5.2) Run 'jstack -p <activemq pid>', watch how the JVM prints info on stdout about a deadlock between two threads.\n\n\nTest script\n---\nApply the small patch to the perl library Net/Stomp.pm\nIt's a naive minimal patch to make it wait for a receipt for the DISCONNECT message. It will actually just wait for any frame to arrive and won't check what it is, but it's enough for this test.\n\nRun amqtest.pl a few times. A non-buggy run completes almost immediately. A buggy run hangs the script during disconnect.\n\n\nWorkaround\n---\n-When sending the SUBSCRIBE with receipt requested, and waiting for the receipt before sending the SEND, I was unable to reproduce the issue, even after running the script 100000 times.-\nNo, it turns out that the workaround suggested above does not completely eliminate the problem. It probably just introduces a large enough delay to almost always avoid the race condition. After 30000 additional test runs with the script the error occurred again.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12544640","id":"12544640","filename":"AMQ_4022_possible_fix.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-11T13:40:23.454+0000","size":4862,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12544640/AMQ_4022_possible_fix.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12543844","id":"12543844","filename":"amqtest.pl","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-05T12:38:25.534+0000","size":568,"mimeType":"text/x-perl","content":"https://issues.apache.org/jira/secure/attachment/12543844/amqtest.pl"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12543843","id":"12543843","filename":"Net_Stomp.pm.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-05T12:38:25.532+0000","size":486,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12543843/Net_Stomp.pm.diff"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"59719","customfield_12312823":null,"summary":"Receiving event while disconnecting -> AMQ deadlock -> \"Already connected\" error","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"SLES11-SP1 x86_64","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12606236/comment/13452821","id":"13452821","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Have you tried using the 5.6.0 release of ActiveMQ or a 5.7 SNAPSHOT?  There were a lot of fixes and improvements in the STOMP transport between 5.5.1 and 5.6","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-09-11T08:42:16.292+0000","updated":"2012-09-11T08:42:16.292+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12606236/comment/13452989","id":"13452989","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for the reply Timothy. \n\nWe haven't tried with 5.6 or 5.7 for this issue, no. But, I have good news: I think I just found the problem and am currently testing a fix. \n\nI found that the problem is a deadlock in broker.TransportConnection. Once that was clear, the fix was rather easy. I'm currently running the test script and am hopeful that there'll be no problems. If everything's ok I'll get back to you with a patch. \n\nI checked the 5.6 branch and can confirm that the issue does exist there also. Haven't checked 5.7.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-11T13:06:26.289+0000","updated":"2012-09-11T13:06:26.289+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12606236/comment/13453013","id":"13453013","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"body":"jstack output (partial) from when the problem had been reproduced:\n\n{noformat}\n\"ActiveMQ Transport: tcp:///127.0.0.1:59675\" daemon prio=10 tid=0x00000000402bf000 nid=0x1bf0 waiting for monitor entry [0x00007fffcc787000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n    at org.apache.activemq.broker.TransportConnection.removeConsumerBrokerExchange(TransportConnection.java:1473)\n    - waiting to lock <0x00000000c3cf2838> (a java.util.HashMap)\n    at org.apache.activemq.broker.TransportConnection.processRemoveConsumer(TransportConnection.java:684)\n    at org.apache.activemq.broker.TransportConnection.processRemoveSession(TransportConnection.java:721)\n    at org.apache.activemq.broker.TransportConnection.processRemoveConnection(TransportConnection.java:840)\n    - locked <0x00000000c3ce8e98> (a org.apache.activemq.broker.jmx.ManagedTransportConnection)\n    at org.apache.activemq.command.RemoveInfo.visit(RemoveInfo.java:77)\n    at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:336)\n    at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:189)\n    at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n    at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:81)\n    at org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:166)\n    at org.apache.activemq.transport.stomp.ProtocolConverter.onStompDisconnect(ProtocolConverter.java:586)\n    at org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommand(ProtocolConverter.java:220)\n    at org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:70)\n    at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n    at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:232)\n    at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:204)\n    at java.lang.Thread.run(Thread.java:662)\n\n\"ActiveMQ Connection Dispatcher: /127.0.0.1:59675\" daemon prio=10 tid=0x00000000402be000 nid=0x1bef waiting for monitor entry [0x00007fffcae6e000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n    at org.apache.activemq.broker.TransportConnection.lookupConnectionState(TransportConnection.java:1537)\n    - waiting to lock <0x00000000c3ce8e98> (a org.apache.activemq.broker.jmx.ManagedTransportConnection)\n    at org.apache.activemq.broker.TransportConnection.getConsumerBrokerExchange(TransportConnection.java:1451)\n    - locked <0x00000000c3cf2838> (a java.util.HashMap)\n    at org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:572)\n    at org.apache.activemq.command.MessageAck.visit(MessageAck.java:229)\n    at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:336)\n    at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:189)\n    at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n    at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:81)\n    at org.apache.activemq.transport.stomp.StompSubscription.onMessageDispatch(StompSubscription.java:79)\n    at org.apache.activemq.transport.stomp.ProtocolConverter.onActiveMQCommand(ProtocolConverter.java:636)\n    at org.apache.activemq.transport.stomp.StompTransportFilter.oneway(StompTransportFilter.java:58)\n    at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\n    - locked <0x00000000c3cf1f10> (a java.lang.Object)\n    at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1384)\n    at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:929)\n    at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:965)\n    at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:104)\n    at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:42)\n{noformat}\n\n{noformat}\nFound one Java-level deadlock:\n=============================\n\"ActiveMQ Transport: tcp:///127.0.0.1:59675\":\n  waiting to lock monitor 0x0000000040ad8440 (object 0x00000000c3cf2838, a java.util.HashMap),\n  which is held by \"ActiveMQ Connection Dispatcher: /127.0.0.1:59675\"\n\"ActiveMQ Connection Dispatcher: /127.0.0.1:59675\":\n  waiting to lock monitor 0x00000000403568a8 (object 0x00000000c3ce8e98, a org.apache.activemq.broker.jmx.ManagedTransportConnection),\n  which is held by \"ActiveMQ Transport: tcp:///127.0.0.1:59675\"\n{noformat}\n\nThis method (in broker/TransportConnection.java) is one of the culprits, and feels like a good place to break the deadlock:\n{noformat}\n    private ConsumerBrokerExchange getConsumerBrokerExchange(ConsumerId id) {\n        ConsumerBrokerExchange result = consumerExchanges.get(id);\n        if (result == null) {\n            synchronized (consumerExchanges) {\n                result = new ConsumerBrokerExchange();\n                TransportConnectionState state = lookupConnectionState(id);\n                context = state.getContext();\n                result.setConnectionContext(context);\n                SessionState ss = state.getSessionState(id.getParentId());\n                if (ss != null) { \n                    ConsumerState cs = ss.getConsumerState(id);\n                    if (cs != null) {\n                        ConsumerInfo info = cs.getInfo();\n                        if (info != null) { \n                            if (info.getDestination() != null && info.getDestination().isPattern()) {\n                                result.setWildcard(true);\n                            }   \n                        }   \n                    }   \n                }   \n                consumerExchanges.put(id, result);\n            }   \n        }   \n        return result;\n    }   \n{noformat}\n\nIt holds the consumerExchanges lock, calls lookupConnectionState, which is 'synchronized', while another thread is within another 'synchronized' method and calls removeConsumerBrokerExchange, which tries to take consumerExchanges.\n\nSomething like this instead would solve it, basically minimizing the locking to only the get (which wasn't protected at all previously) and the put. The only possible problem is if two callers enter getConsumerBrokerExchange at the same time, both enter the \"if (result == null)\" block and then 'put' the result, causing one to overwrite the result of the other. Without knowing the code it's a bit hard to say, but I'd say that it looks likely that the double-put race condition isn't a problem in this case. It wouldn't do any harm, as far as I can see. What do you think?\n{noformat}\n    private ConsumerBrokerExchange getConsumerBrokerExchange(ConsumerId id) {\n        ConsumerBrokerExchange result;\n        synchronized (consumerExchanges) {\n            result = consumerExchanges.get(id);\n        }\n        if (result == null) {\n            result = new ConsumerBrokerExchange();\n            TransportConnectionState state = lookupConnectionState(id);\n            context = state.getContext();\n            result.setConnectionContext(context);\n            SessionState ss = state.getSessionState(id.getParentId());\n            if (ss != null) {\n                ConsumerState cs = ss.getConsumerState(id);\n                if (cs != null) {\n                    ConsumerInfo info = cs.getInfo();\n                    if (info != null) {\n                        if (info.getDestination() != null && info.getDestination().isPattern()) {\n                            result.setWildcard(true);\n                        }\n                    }\n                }\n            }\n            synchronized (consumerExchanges) {\n                consumerExchanges.put(id, result);\n            }\n        }\n        return result;\n    }\n{noformat}\n\nI'll attach a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-11T13:38:49.124+0000","updated":"2012-09-11T13:38:49.124+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12606236/comment/13453017","id":"13453017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"body":"Attached patch is a possible fix. With this applied, I haven't been able to reproduce the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-11T13:40:23.456+0000","updated":"2012-09-11T13:40:23.456+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12606236/comment/13457028","id":"13457028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"body":"Updated title and description with clearer information, since this issue isn't really about SUBSCRIBE but rather DISCONNECT deadlocking with auto-acking of an event inside Active MQ.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabrielg","name":"gabrielg","key":"gabrielg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gabriel Gerhardsson","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-17T13:57:42.367+0000","updated":"2012-09-17T13:57:42.367+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12606236/comment/13458520","id":"13458520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"This was fixed before the v5.6.0 release and is no longer an issue, the code has been refactored to avoid this particular deadlock scenario.  Upgrade to a newer broker version and you won't run into this any longer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-09-19T09:13:45.195+0000","updated":"2012-09-19T09:13:45.195+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4022/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0al9r:"}}