{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12929159","self":"https://issues.apache.org/jira/rest/api/2/issue/12929159","key":"AMQ-6120","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-01-11T16:23:23.606+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jan 12 14:09:57 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6120/watchers","watchCount":2,"isWatching":false},"created":"2016-01-11T12:24:50.137+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329848","id":"12329848","name":"5.13.0","archived":false,"released":true,"releaseDate":"2015-12-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-01-12T14:09:57.554+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I'm attmepting to use SPEL to configure the recoverDuration attribute of timerSubscriptionRecovery policy as follows (based on SPEL suggestion at http://stackoverflow.com/questions/18265518/using-spring-expression-language-to-define-xml-attribute):\n{code:xml}\n<amq:policyEntry topic=\"mytopic\">\n  <amq:subscriptionRecoveryPolicy>\n     <amq:timedSubscriptionRecoveryPolicy recoverDuration=\"#{ T(java.lang.Integer).valueOf('${my.property}') * 1000 }\" />\n   </amq:subscriptionRecoveryPolicy>\n </amq:policyEntry>\n{code}\nHowever, this results in the following error on startup:\n{noformat}\norg.springframework.beans.factory.xml.XmlBeanDefinitionStoreException: Line 1125 in XML document from class path resource [appserver/spring.xml] is invalid; nested exception is org.xml.sax.SAXParseException; lineNumber: 1125; columnNumber: 119; cvc-datatype-valid.1.2.1: '#{ T(java.lang.Integer).valueOf('1') * 1000 }' is not a valid value for 'integer'.\n     [java] \tat org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:399)\n     [java] \tat org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:336)\n     [java] \tat org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:304)\n     [java] \tat org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:181)\n     [java] \tat org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:217)\n     [java] \tat org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:188)\n     [java] \tat org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:252)\n     [java] \tat org.springframework.context.support.AbstractXmlApplicationContext.loadBeanDefinitions(AbstractXmlApplicationContext.java:127)\n     [java] \tat org.springframework.context.support.AbstractXmlApplicationContext.loadBeanDefinitions(AbstractXmlApplicationContext.java:93)\n     [java] \tat org.springframework.context.support.AbstractRefreshableApplicationContext.refreshBeanFactory(AbstractRefreshableApplicationContext.java:129)\n     [java] \tat org.springframework.context.support.AbstractApplicationContext.obtainFreshBeanFactory(AbstractApplicationContext.java:538)\n     [java] \tat org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:452)\n{noformat}\nI'm using Spring 4.1.8.\n\nIs SPEL supported for this attribute?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Error using Spring Expression Language for recoverDuration attribute on amq:timedSubscriptionRecoveryPolicy","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12929159/comment/15092214","id":"15092214","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"It doesn't look like Springs SPEL works with ActiveMQ's schema.  There is probably some work that would need to be done here to enable it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-01-11T16:23:23.606+0000","updated":"2016-01-11T16:23:23.606+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12929159/comment/15092476","id":"15092476","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"body":"If you could point me at where this would integrate into the code for ActiveMQ's schema I'd be happy to take a look to see if it was something I could contribute.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-11T18:55:15.643+0000","updated":"2016-01-11T18:55:15.643+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12929159/comment/15092583","id":"15092583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"The activemq-spring sub project is where the spring stuff lives.  [xbean-spring|http://geronimo.apache.org/xbean/] is used to generate the schema from the java classes.  This might be something that needs to be fixed in the schema generated by xbean-spring, not sure.  I think the problem is that it isn't even passing schema validation to get to the part where the expression can be evaluated because during validation it errors trying to convert the expression to an integer.  So it might be that the schema would need to be fixed to relax validation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-01-11T20:07:08.968+0000","updated":"2016-01-11T20:07:08.968+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12929159/comment/15093673","id":"15093673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"body":"I think you are correct.\n\nFurther investigation shows that it doesn't even work with simple property placeholders e.g\n\n{code:xml}\n<amq:timedSubscriptionRecoveryPolicy recoverDuration=\"${my.value}\" />\n{code}\n\ngiving the same validation exception.\n\nI see that for the \"persistent\" attribute on \"amq:broker\" the type is \"xs:string\" and these is a custom BooleanEditor. In this case a placeholder can be used but SPEL doesn't seem to work.\n\nIs a similar solution viable? Even if SPEL couldn't be supported using placeholders would be useful. However, would you need to change the schema type for every property you want to set via a placeholder?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-12T10:09:25.791+0000","updated":"2016-01-12T10:09:25.791+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12929159/comment/15093849","id":"15093849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"From what I can tell, I think the only way this will ever work is if every property that needs to support replacement is changed to type xs:string so it passes validation and can be replaced.  As you pointed out, in the case of the persistent attribute it works because it passes schema validation and gives Spring a chance to replace the property.  I'm not sure why SPEL didn't work in that case but in theory it should be at least possible to make it work since the schema will validate.  (I would need to dig into it to figure out why it's not being evaluated and if a code change is necessary)\n\nSo for now, I think the best that could be done is any property that needs support for placeholders would need to be annotated with a PropertyEditor that takes a String and then converts it to the type that is necessary, that way the schema generated specifies a string value and allows the chance for the property placeholder to replace the value before evaluation.  There are several boolean properties that are already annotated that way in the BrokerService.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-01-12T13:05:25.129+0000","updated":"2016-01-12T13:05:25.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12929159/comment/15093905","id":"15093905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"body":"For my immediate needs I'm creating the PolicyMap using Spring Java-based configuration. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-12T13:48:58.060+0000","updated":"2016-01-12T13:48:58.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12929159/comment/15093924","id":"15093924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"That works as well and it is what I typically do. At some point it may be nice to have a Java DSL for this but it's also relatively straight forward to create a Broker using pure Java (as most unit tests already do) and by using Spring's java config. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-01-12T14:09:57.554+0000","updated":"2016-01-12T14:09:57.554+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6120/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2r4mn:"}}