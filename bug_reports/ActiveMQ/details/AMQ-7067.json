{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13189438","self":"https://issues.apache.org/jira/rest/api/2/issue/13189438","key":"AMQ-7067","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341032","id":"12341032","name":"5.16.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12344049","id":"12344049","description":"","name":"5.15.7","archived":false,"released":true,"releaseDate":"2018-10-27"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-10-05T16:45:33.982+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 24 12:56:03 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1133434240_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-10-17T17:18:45.459+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7067/watchers","watchCount":8,"isWatching":false},"created":"2018-10-04T14:28:11.239+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12343805","id":"12343805","description":"","name":"5.15.6","archived":false,"released":true,"releaseDate":"2018-09-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-10-24T12:56:03.725+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325017","id":"12325017","name":"KahaDB"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12330819","id":"12330819","name":"XA"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"KahaDB Recovery can experience a dangling transaction when prepare and commit occur on different data files.\r\n\r\nScenario:\r\n\r\nA XA Transaction is started, message is prepared and sent into Broker.\r\n\r\nWe then send into broker enough messages to file page file (100 message with 512 * 1024 characters in message payload). This forces a new data file to be created.\r\n\r\nCommit the XA transaction. Commit will land on the new data file.\r\n\r\nRestart the Broker.\r\n\r\nUpon restart a KahaDB recovery is executed.\r\n\r\nThe prepare in PageFile 1 is not matched to Commit on PageFile 2, as such, it will appear in recovered message state.\r\n\r\nLooking deeper into this scenario, it appears that the commit message is GC'd, hence the prepare & commit can not be matched.\r\n\r\nThe MessageDatabase only checks the following for GC:\r\n\r\n{color:#808080}// Don't GC files referenced by in-progress tx{color}{color:#cc7832}if {color}(inProgressTxRange[{color:#6897bb}0{color}] != {color:#cc7832}null{color}) {\r\n {color:#cc7832}for {color}({color:#cc7832}int {color}pendingTx=inProgressTxRange[{color:#6897bb}0{color}].getDataFileId(){color:#cc7832}; {color}pendingTx <= inProgressTxRange[{color:#6897bb}1{color}].getDataFileId(){color:#cc7832}; {color}pendingTx++) {\r\n gcCandidateSet.remove(pendingTx){color:#cc7832};{color} }\r\n }\r\n\r\nWe need to become aware of where the prepare & commits occur in pagefiles with respect to GCing files.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12942458","id":"12942458","filename":"amq7067test.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-10-04T21:36:19.847+0000","size":7729,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12942458/amq7067test.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"KahaDB Recovery can experience a dangling transaction when prepare and commit occur on different data files.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10430","value":"Patch","id":"10430"}],"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16638417","id":"16638417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"Please see the amq7067 unit test.\r\n\r\nThis patch is for AMQ 5.15.x branch.\r\n\r\nYou can execute using the following command:\r\n mvn -Dtest=AMQ7067Test test\r\n\r\n\r\nKeeping original comment for history:\r\n\r\nI've attached a stand alone test case to reproduce the issue.\r\n\r\nHere's how to use the test case:\r\n\r\n0. Setup AMQ 5.15.6 broker on local system. Use default configuration, no special settings required. Start broker.\r\n 1. Extract AMQ7067 zip file.\r\n 2. Run XATransactionTest while Broker is live using :  mvn clean compile exec:java -Dexec.mainClass=\"XATransactionTest\"\r\n\r\nThe test case will output:\r\n\r\n[INFO] — exec-maven-plugin:1.6.0:java (default-cli) @ transaction —\r\n SLF4J: Class path contains multiple SLF4J bindings.\r\n SLF4J: Found binding in [jar:file:/Users/icbts/.m2/repository/org/apache/activemq/activemq-all/5.15.6/activemq-all-5.15.6.jar!/org/slf4j/impl/StaticLoggerBinder.class]\r\n SLF4J: Found binding in [jar:file:/Users/icbts/.m2/repository/org/slf4j/slf4j-log4j12/1.6.1/slf4j-log4j12-1.6.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]\r\n SLF4J: See [http://www.slf4j.org/codes.html#multiple_bindings] for an explanation.\r\n SLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]\r\n createDanglingTransaction txid: XID:[55,globalId=ffffffffffffffffffffffffffffffffffffffe9ffffffb8fffffff7ffffffa1,branchId=ffffffffffffffffffffffffffffffffffffffe9ffffffb8fffffff7ffffffa1]\r\n createXATransaction txid: XID:[55,globalId=000015333ec,branchId=000015333ec]\r\n Pending Transactions 1: [XID:[55,globalId=ffffffffffffffffffffffffffffffffffffffe9ffffffb8fffffff7ffffffa1,branchId=ffffffffffffffffffffffffffffffffffffffe9ffffffb8fffffff7ffffffa1]]\r\n  INFO | I/O exception (org.apache.http.NoHttpResponseException) caught when processing request to {}->[http://localhost:8161:] The target server failed to respond\r\n  INFO | Retrying request to {}->[http://localhost:8161|http://localhost:8161/]\r\n Pending Transactions 2: [XID:[55,globalId=ffffffffffffffffffffffffffffffffffffffe9ffffffb8fffffff7ffffffa1,branchId=ffffffffffffffffffffffffffffffffffffffe9ffffffb8fffffff7ffffffa1], XID:[55,globalId=000015333ec,branchId=000015333ec]]\r\n [INFO] ------------------------------------------------------------------------\r\n\r\nIn the Broker log you'll see:\r\n\r\n INFO | KahaDB is version 6\r\n  INFO | Recovering from the journal @1:741\r\n  INFO | Recovery replayed 429 operations from the journal in 0.081 seconds.\r\n  WARN | Recovered prepared XA TX: [XID:[55,globalId=ffffffffffffffffffffffffffffffffffffffe9ffffffb8fffffff7ffffffa1,branchId=ffffffffffffffffffffffffffffffffffffffe9ffffffb8fffffff7ffffffa1]]\r\n  WARN | Recovered prepared XA TX: [XID:[55,globalId=000015333ec,branchId=000015333ec]]\r\n  \r\n On JConsole you'll see two messages in org.apache.activemq > Broker > RecoveredXaTransaction MBean.\r\n\r\nGiven we commit the transaction, I'd expect there to not be a message in Recovered state.\r\n\r\nNote:  If we do not send additional messages to force a new page file, than we do not see the message in Recovered state after broker restart.\r\n\r\nIt appears to be that the prepared statement in db-1.log,. and commit in db-2.log will result in the commit getting GC'd (hence no pare to match) and having the message being seen as being in prepared state, and hence getting recovered.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-10-04T15:52:02.356+0000","updated":"2018-10-04T17:40:27.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16640066","id":"16640066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user jgoodyear opened a pull request:\n\n    https://github.com/apache/activemq/pull/302\n\n    [AMQ-7067] KahaDB Recovery can experience a dangling transaction when…\n\n    [AMQ-7067] KahaDB Recovery can experience a dangling transaction when prepare and commit occur on different pagefiles.\r\n    \r\n    Test cases added for Commit and Rollback on XA and Non-XA transactions.\r\n    \r\n    Executed kahadb-store tests, activemq-unit-tests, and ran full build.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/jgoodyear/activemq master\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/302.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #302\n    \n----\ncommit 2dabd858240dc3dc4341cceb1d28a61e5f440d1a\nAuthor: jgoodyear <jamie.goodyear@...>\nDate:   2018-10-05T16:34:21Z\n\n    [AMQ-7067] KahaDB Recovery can experience a dangling transaction when prepare and commit occur on different pagefiles.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-05T16:45:33.982+0000","updated":"2018-10-05T16:45:33.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16641757","id":"16641757","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~jgoodyear] I think the patch is on the right track but I think it needs some small mod.\r\n\r\n \r\n\r\nThe ack message file map can do what we need but I think it has to track the association between the prepare record location and the outcome (commit/rollback) location rather than the actual message or ack commands.\r\n\r\nie: all of the transaction commands could be in one data file, the prepare in another and the outcome in a third. Tracking the link between the third and the first is not sufficient in this case. It should be possible to validate that with another test scenario.\r\n\r\nI think the prepare record location needs to be tracked in the in memory tx representation in some way to make it available to the outcome processor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-08T12:29:52.146+0000","updated":"2018-10-08T12:29:52.146+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16642067","id":"16642067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"Hi Gary,\r\n\r\nThe crux of this patch is to prevent the GC of the PageFile such that on recovery  Commit/Rollback can be processed as per existing logic.  No changes to the existing processors is required. \r\n\r\nPlease note, the problem was happening with Non-XA transactions as well, hence the addition of non-xa unit tests. The commit/rollback would get lost via GC, by updating the code to mark those index to not be GC'd the behavoir is fixed for both XA and Non-XA transactions. Adding in a new structure and logic to track the TX lifeCycle would not touch the Non-XA transaction case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-10-08T16:05:37.354+0000","updated":"2018-10-08T16:05:37.354+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16642107","id":"16642107","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"In the xa case, I don't think the prepare record location is tracked, so it can get lost, leaving updates and a commit/rollback - which will barf. I am suggesting tracking the outcome record with the prepare location, and possibly with all of the updates.\r\n\r\nI had not considered the non xa case, in that case, the commit is all that is needed b/c the default will be to rollback. The commit outcome location needs to be linked to each of the update commands in turn.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-08T16:35:29.770+0000","updated":"2018-10-08T16:37:22.062+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16642151","id":"16642151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I see that losing a prepare record after an outcome is still recoverable, once all of the updates are present.\r\n\r\nHowever I think that a prepare record needs to be tracked in case it falls outside of the current txRange or current write file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-08T17:02:36.547+0000","updated":"2018-10-08T17:07:06.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16642593","id":"16642593","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"I've updated the PR after our discussion on IRC.\r\n\r\nAll locations are updated on commit/rollback/prepare.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-10-08T23:21:39.572+0000","updated":"2018-10-08T23:21:39.572+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643123","id":"16643123","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~jgoodyear] I have pushed your changes and some additional test tidy up and a prepare variant. Thank you.\r\n\r\n \r\n\r\n[https://github.com/apache/activemq/commit/57c7939534a927bfc2d1b0454aac7ef8d804532b]\r\n\r\n \r\n\r\nI think ack compaction will need some follow on work b/c it won't be aware that the ackMessageFileMap now also has transaction locations, it will only move acks and I think will leave the journals candidates for gc again. \r\n\r\nAs it stands ackCompaction should be disabled for this fix to be effective, until that is proven not to be the case or it is fixed.\r\n\r\n \r\n\r\nThere are some ackCompaction tests that can be combined with the recovery checks to validate. \r\n\r\nThis issue should remain open till we get a resolution to that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-09T11:08:44.572+0000","updated":"2018-10-09T11:08:44.572+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643136","id":"16643136","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Shouldn't we just record the reference location update inside of the pageFile.tx() for the KahaCommitCommand case? This would do it under the write lock and also prevent having to iterate again plus then the change gets commited to the index in the transaciton.  Ie, change: \r\n\r\n  \r\n{code:java}\r\n    final List<Operation> messagingTx = inflightTx;\r\n    indexLock.writeLock().lock();\r\n    try {\r\n        pageFile.tx().execute(new Transaction.Closure<IOException>() {\r\n            @Override\r\n            public void execute(Transaction tx) throws IOException {\r\n                for (Operation op : messagingTx) {\r\n                    op.execute(tx);\r\n                }\r\n            }\r\n        });\r\n        metadata.lastUpdate = location;\r\n    } finally {\r\n        indexLock.writeLock().unlock();\r\n    }\r\n    for (Operation op: inflightTx) {\r\n        recordAckMessageReferenceLocation(location, op.getLocation());\r\n    }    \r\n{code}\r\n\r\nto:\r\n\r\n{code:java}\r\nfinal List<Operation> messagingTx = inflightTx;\r\n    indexLock.writeLock().lock();\r\n    try {\r\n        pageFile.tx().execute(new Transaction.Closure<IOException>() {\r\n            @Override\r\n            public void execute(Transaction tx) throws IOException {\r\n                for (Operation op : messagingTx) {\r\n                    op.execute(tx);\r\n                    recordAckMessageReferenceLocation(location, op.getLocation());\r\n                }\r\n            }\r\n        });\r\n        metadata.lastUpdate = location;\r\n    } finally {\r\n        indexLock.writeLock().unlock();\r\n    }\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-09T11:17:01.011+0000","updated":"2018-10-09T11:24:00.312+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643158","id":"16643158","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~cshannon] yes, good catch. I should be under that lock. The map does not get updated in the pagefile tx, just during checkpoints, but it does need to be protected from concurrent access.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-09T11:31:09.373+0000","updated":"2018-10-09T11:40:29.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643214","id":"16643214","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"[~gtully] - and I guess that means we should also add a pageFile.tx() to do the updates in for the KahaPrepareCommand and KahaRollbackCommand as well right?\r\n\r\nAnd I think you are right that the Ack compaction stuff needs updating..the easiest thing is probably to just change the task so that it doesn't remove the forwarded journal file from the ackMessageFileMap if it contains a transaction command (normal GC should remove it if there are no open transactions remaining on that file)..this probably reduces the usefullness of ack compaction but I don't see a better way without expanding to rewrite all the other commands as well","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-09T11:55:03.307+0000","updated":"2018-10-09T11:55:03.307+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643241","id":"16643241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"I think maybe something like this would work for ack compaction but would need to test it out...I don't see any current tests for ack compaction\r\n\r\nhttps://github.com/cshannon/activemq/commit/bb28cd0b647c52e8dc84b1740ab4d5ef1ca6198a","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-09T12:21:08.486+0000","updated":"2018-10-09T12:21:08.486+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643245","id":"16643245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~cshannon] We just need the lock for protection, no tx, b/c the index is not updated.\r\n\r\nOn the compaction, I think that is the simplest approach.\r\n\r\nIdeally we would have some sort of reference count on the referenced ids in the ackMessageFileMap - allowing each ack and outcome to be recorded and having some way to know there are just non ack references remaining.\r\n\r\nWe don't need to retain everything. i.e.: the prepare record can go if there is an outcome, and if the outcome is rollback then both the prepare and rollback can go b/c recovery will default to rollback. For commit, both xa and non xa, it needs to be retained as long as the updates (add/ack commands).\r\n\r\nIt will get complex fast however.\r\n\r\nGetting it correct first will suffice, which means retaining the transaction related commands. I will see if I can wrangle a test to reproduce to get the full context.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-09T12:22:33.253+0000","updated":"2018-10-09T12:22:33.253+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643252","id":"16643252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"[~gtully] - ok sounds good, having a test case to reproduce everything first will make it easier to validate any changes to ack compaction\r\n\r\nAnd you are right about the index not being updated, I just realized the ackMessageFileMap is marked as transient (i was thinking it was stored to disk during index updates)\r\n\r\nAlso, based on your comment I'm not sure my sample I linked above is good enough for the commit case. (we might end up removing those files if acks are moved and the transaction is commited and not in flight but the message add or commit commands exist not sure). So again having some tests will help tremendously to validate","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-09T12:25:42.580+0000","updated":"2018-10-09T12:32:23.802+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643377","id":"16643377","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"The following test case can be inserted into the AMQ7067Test file:\r\n [https://gist.github.com/jgoodyear/f3c716aec99c066894047ed996cdcdc9]\r\n\r\nIts a non-completing test, it just allows us to setup the scenario, load up a lot of db page files, than let compaction occur.\r\n\r\nIn my IDEA environment i can watch the data folder populate:\r\n{code:java}\r\nicbts-2:activemq-unit-tests icbts$ ls target/data/kahadb/\r\ndb-1.log        db-115.log      db-131.log      db-148.log      db-164.log      db-180.log      db-197.log      db-212.log      db-229.log      db-245.log      db-261.log      db-278.log      db-4.log        db-56.log       db-72.log       db-89.log\r\ndb-10.log       db-116.log      db-132.log      db-149.log      db-165.log      db-181.log      db-198.log      db-213.log      db-23.log       db-246.log      db-262.log      db-279.log      db-40.log       db-57.log       db-73.log       db-9.log\r\ndb-100.log      db-117.log      db-133.log      db-15.log       db-166.log      db-182.log      db-199.log      db-214.log      db-230.log      db-247.log      db-263.log      db-28.log       db-41.log       db-58.log       db-74.log       db-90.log\r\ndb-101.log      db-118.log      db-134.log      db-150.log      db-167.log      db-183.log      db-2.log        db-215.log      db-231.log      db-248.log      db-264.log      db-280.log      db-42.log       db-59.log       db-75.log       db-91.log\r\ndb-102.log      db-119.log      db-135.log      db-151.log      db-168.log      db-184.log      db-20.log       db-216.log      db-232.log      db-249.log      db-265.log      db-281.log      db-43.log       db-6.log        db-76.log       db-92.log\r\ndb-103.log      db-12.log       db-136.log      db-152.log      db-169.log      db-185.log      db-200.log      db-217.log      db-233.log      db-25.log       db-266.log      db-282.log      db-44.log       db-60.log       db-77.log       db-93.log\r\ndb-104.log      db-120.log      db-137.log      db-153.log      db-17.log       db-186.log      db-201.log      db-218.log      db-234.log      db-250.log      db-267.log      db-29.log       db-45.log       db-61.log       db-78.log       db-94.log\r\ndb-105.log      db-121.log      db-138.log      db-154.log      db-170.log      db-187.log      db-202.log      db-219.log      db-235.log      db-251.log      db-268.log      db-3.log        db-46.log       db-62.log       db-79.log       db-95.log\r\ndb-106.log      db-122.log      db-139.log      db-155.log      db-171.log      db-188.log      db-203.log      db-22.log       db-236.log      db-252.log      db-269.log      db-30.log       db-47.log       db-63.log       db-8.log        db-96.log\r\ndb-107.log      db-123.log      db-14.log       db-156.log      db-172.log      db-189.log      db-204.log      db-220.log      db-237.log      db-253.log      db-27.log       db-31.log       db-48.log       db-64.log       db-80.log       db-97.log\r\ndb-108.log      db-124.log      db-140.log      db-157.log      db-173.log      db-19.log       db-205.log      db-221.log      db-238.log      db-254.log      db-270.log      db-32.log       db-49.log       db-65.log       db-81.log       db-98.log\r\ndb-109.log      db-125.log      db-141.log      db-158.log      db-174.log      db-190.log      db-206.log      db-222.log      db-239.log      db-255.log      db-271.log      db-33.log       db-5.log        db-66.log       db-82.log       db-99.log\r\ndb-11.log       db-126.log      db-142.log      db-159.log      db-175.log      db-191.log      db-207.log      db-223.log      db-24.log       db-256.log      db-272.log      db-34.log       db-50.log       db-67.log       db-83.log       db.data\r\ndb-110.log      db-127.log      db-143.log      db-16.log       db-176.log      db-192.log      db-208.log      db-224.log      db-240.log      db-257.log      db-273.log      db-35.log       db-51.log       db-68.log       db-84.log       db.redo\r\ndb-111.log      db-128.log      db-144.log      db-160.log      db-177.log      db-193.log      db-209.log      db-225.log      db-241.log      db-258.log      db-274.log      db-36.log       db-52.log       db-69.log       db-85.log       lock\r\ndb-112.log      db-129.log      db-145.log      db-161.log      db-178.log      db-194.log      db-21.log       db-226.log      db-242.log      db-259.log      db-275.log      db-37.log       db-53.log       db-7.log        db-86.log\r\ndb-113.log      db-13.log       db-146.log      db-162.log      db-179.log      db-195.log      db-210.log      db-227.log      db-243.log      db-26.log       db-276.log      db-38.log       db-54.log       db-70.log       db-87.log\r\ndb-114.log      db-130.log      db-147.log      db-163.log      db-18.log       db-196.log      db-211.log      db-228.log      db-244.log      db-260.log      db-277.log      db-39.log       db-55.log       db-71.log       db-88.log\r\n{code}\r\nThan reduce to the below after GC:\r\n{code:java}\r\nicbts-2:activemq-unit-tests icbts$ ls target/data/kahadb/\r\ndb-318.log      db.data         db.redo         lock\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-10-09T12:57:11.833+0000","updated":"2018-10-09T12:57:11.833+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643380","id":"16643380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"I'll note that I ran the full unit test suite through using the patch with out breaking existing test cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-10-09T12:58:36.047+0000","updated":"2018-10-09T12:58:36.047+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643488","id":"16643488","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"Are the changes we're making to MessageDatabase small enough such that we could back port the fix to 5.15.x line?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-10-09T14:14:56.006+0000","updated":"2018-10-09T14:14:56.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643490","id":"16643490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"I was going to backport all commits from this patch to 5.15.x as I don't know when 5.16.0 will go out and this seems like an important fix","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-09T14:17:56.404+0000","updated":"2018-10-09T14:17:56.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16643497","id":"16643497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"Thank you :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-10-09T14:22:56.571+0000","updated":"2018-10-09T14:22:56.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16645043","id":"16645043","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"[~jgoodyear] - i cherry-picked the existing 3 commits into the 5.15.x branch...I will also move anymore from master after the ack compaction case is sorted so we can do a 5.15.7 release soon as this is an important fix","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-10T14:27:50.152+0000","updated":"2018-10-10T14:27:50.152+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16646464","id":"16646464","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbonofre","name":"jbonofre","key":"jbonofre","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jean-Baptiste Onofré","active":true,"timeZone":"Europe/Berlin"},"body":"Hi, I would like to start ActiveMQ 5.15.6 release pretty soon. What's the current status of this one ? Thanks !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbonofre","name":"jbonofre","key":"jbonofre","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jean-Baptiste Onofré","active":true,"timeZone":"Europe/Berlin"},"created":"2018-10-11T14:04:22.052+0000","updated":"2018-10-11T14:04:22.052+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16646490","id":"16646490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"I assume you mean 5.15.7 as 5.15.6 is already out.\r\n\r\nThere is still no test case yet to validate the ack compaction stuff and I'm out of town next week so probably won't be a release until the following week at least.  I don't want to release (and [~gtully] i'm sure agrees) until we make sure we don't break other stuff with compaction.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-11T14:28:18.835+0000","updated":"2018-10-11T14:28:18.835+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16647928","id":"16647928","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I pushed an update, that goes some of the way, at least there is one test and a fix.\r\nThe test is just for a prepare record, ack compaction will still move once the there are outcomes and that will break the reference. that will need a commit test in the same vein.\r\n[~jgoodyear] flip: [https://github.com/apache/activemq/commit/7c890d477663d91aef518e30d60cf3c13827877a#diff-e3b8fff8c2133dfd70999705bbb558b3R2094] to false to see the new test fail to get suck in\r\nI think the solution is to forward commit records, but more tests are needed to verify the problem and the fix","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-12T13:58:28.327+0000","updated":"2018-10-12T13:58:28.327+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16651026","id":"16651026","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbonofre","name":"jbonofre","key":"jbonofre","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jean-Baptiste Onofré","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks for the update guys. I'm fixing AMQ-7076 and AMQ-7073 on my side.\r\n\r\nPlease let me know when I can start 5.15.7 release. Thanks !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbonofre","name":"jbonofre","key":"jbonofre","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jean-Baptiste Onofré","active":true,"timeZone":"Europe/Berlin"},"created":"2018-10-16T01:26:38.501+0000","updated":"2018-10-16T01:26:38.501+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16653887","id":"16653887","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit ed727d22e1f22a13813d61dba3908408fcd3cd36 in activemq's branch refs/heads/master from gtully\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ed727d2 ]\n\nAMQ-7067 - track xa commit outcomes in ack compaction such that there are no dangling prepared tx on full recovery, fix and test\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-17T17:13:57.762+0000","updated":"2018-10-17T17:13:57.762+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16653895","id":"16653895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I think this is now sorted, the ack compaction will still work and not get in the way.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-17T17:18:45.474+0000","updated":"2018-10-17T17:18:45.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16653909","id":"16653909","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"I see the commit message for master, are we putting this on 5.15 too?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-10-17T17:24:11.679+0000","updated":"2018-10-17T17:24:11.679+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16653926","id":"16653926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit f7ff4c25e13133132c3103141a5179c93e43b536 in activemq's branch refs/heads/activemq-5.15.x from gtully\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=f7ff4c2 ]\n\nAMQ-7067 - track xa commit outcomes in ack compaction such that there are no dangling prepared tx on full recovery, fix and test\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-17T17:35:02.233+0000","updated":"2018-10-17T17:35:02.233+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16653927","id":"16653927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"Done.  Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2018-10-17T17:35:20.022+0000","updated":"2018-10-17T17:35:20.022+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16653948","id":"16653948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Awesome thanks [~gtully] \n\nI’m actually out of the office the rest of the week but when I get back Monday I can do the work for the 5.15.7 release if no one else gets around to it","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-17T17:55:24.506+0000","updated":"2018-10-17T17:55:24.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16658338","id":"16658338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user jgoodyear closed the pull request at:\n\n    https://github.com/apache/activemq/pull/302\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-21T19:14:20.045+0000","updated":"2018-10-21T19:14:20.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13189438/comment/16662257","id":"16662257","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 8e5d539665519629139633e324a672b0a415d4b2 in activemq's branch refs/heads/master from [~cshannon]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8e5d539 ]\n\nAMQ-7067 - add missing license header\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-24T12:56:03.725+0000","updated":"2018-10-24T12:56:03.725+0000"}],"maxResults":32,"total":32,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7067/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3ytzj:"}}