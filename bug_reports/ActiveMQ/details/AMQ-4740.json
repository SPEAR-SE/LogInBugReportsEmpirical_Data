{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12670485","self":"https://issues.apache.org/jira/rest/api/2/issue/12670485","key":"AMQ-4740","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326455","id":"12326455","name":"5.9.1","archived":false,"released":true,"releaseDate":"2014-04-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-09-30T15:56:38.948+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 31 21:38:07 UTC 2015","customfield_12310420":"350314","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2428128999_*|*_5_*:*_2_*:*_19950117494_*|*_4_*:*_1_*:*_25342247167","customfield_12312321":null,"resolutiondate":"2015-03-31T21:38:07.883+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4740/watchers","watchCount":15,"isWatching":false},"created":"2013-09-25T13:56:34.393+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[{"id":"12387464","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12387464","type":{"id":"10020","name":"Cloners","inward":"is cloned by","outward":"is a clone of","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10020"},"inwardIssue":{"id":"12711964","key":"AMQ-5169","self":"https://issues.apache.org/jira/rest/api/2/issue/12711964","fields":{"summary":"CLONE - heart-beat is disabled when connecting to web socket","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12412440","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12412440","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"12709955","key":"AMQ-5155","self":"https://issues.apache.org/jira/rest/api/2/issue/12709955","fields":{"summary":"Heartbeat fails in STOMP over WebSockets","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12388860","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12388860","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12709955","key":"AMQ-5155","self":"https://issues.apache.org/jira/rest/api/2/issue/12709955","fields":{"summary":"Heartbeat fails in STOMP over WebSockets","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-03-31T21:38:07.999+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"If I use the stomp.js library to connect to ActiveMQ over its WebSocket url (ws://localhost:61614), the CONNECTED frame returns with disabled heart-beat:\n\nCONNECTED\nheart-beat:0,0\nsession:ID:retsina.local-63633-1380117269290-2:1\nserver:ActiveMQ/5.8.0\nversion:1.1\n\nIf I connect to its TCP socket (localhost:61613), the CONNECT frame will have heart-beat:\n\nCONNECTED\nheart-beat:10000,10000\nsession:ID:retsina.local-63384-1380115729700-2:12\nserver:ActiveMQ/5.8.0\nversion:1.1\n\nIn both case, the stomp.js send the same CONNECT frame with heart-beat:\n\nCONNECT\nlogin:user\npasscode:password\naccept-version:1.1,1.0\nheart-beat:10000,10000\n\nIs heart-beat disabled on purpose for Web Socket? Please note that the stomp.js does support heart-beat (using window.setInterval in a Web browser)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12609835","id":"12609835","filename":"AMQ-4740.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"created":"2013-10-23T09:57:47.408+0000","size":1097,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12609835/AMQ-4740.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12703415","id":"12703415","filename":"AMQ-4740-EOF.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebsjo","name":"sebsjo","key":"sebsjo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian Sjödin","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-09T12:32:16.927+0000","size":2613,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12703415/AMQ-4740-EOF.diff"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"350607","customfield_12312823":null,"summary":"heart-beat is disabled when connecting to web socket","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmesnil","name":"jmesnil","key":"jmesnil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Mesnil","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmesnil","name":"jmesnil","key":"jmesnil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Mesnil","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Google Chrome 29.0.1547.76 (Official Build 223446) ","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/13781955","id":"13781955","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Have you tested with the latest 5.9-SNAPSHOT?  Can you create a unit test to reproduce?  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-09-30T15:56:38.948+0000","updated":"2013-09-30T15:56:38.948+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/13802753","id":"13802753","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"body":"This was failing because StompSocket did not have an InactivityMonitor defined, so I have added an instance of StompInactivityMonitor.\n\nI tested this manually.  We now return the correct heartbeat, and the server will terminate the connection properly.  I did not add an automated test.  We have some old tests which use Selenium that could be extended to test this, but they are currently deactivated.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"created":"2013-10-23T09:57:47.411+0000","updated":"2013-10-23T09:57:47.411+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/13802998","id":"13802998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Patch applied, thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-10-23T16:25:23.380+0000","updated":"2013-10-23T16:25:23.380+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/13958800","id":"13958800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jprillaman","name":"jprillaman","key":"jprillaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Prillaman","active":true,"timeZone":"Etc/UTC"},"body":"I have applied this patch to version 5.9.0 and have also installed a 5.10.0 snapshot. With each version I receive the following error after establishing a connection and heartbeat through stomp.js. This seems to occur after the 'PING' is sent.\n\n---------- stomp.js output\n<<< CONNECTED\nheart-beat:10000,10000\nsession:ID:localhost.localdomain-45596-1396530920609-2:2\nserver:ActiveMQ/5.10-SNAPSHOT\nversion:1.1\n\nsend PING every 10000ms \ncheck PONG every 10000ms \n<<< PONG \n>>> PING \ndid not receive server activity for the last 20005ms \nWhoops! Lost connection to ws://172.16.99.73:61614/stomp \n\n--------------------- activemq console ---------------\nWARN | Transport Connection to: StompSocket_19548821 failed: java.io.IOException\nException in thread \"ActiveMQ InactivityMonitor Worker\" java.lang.NullPointerException\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n\tat java.lang.Thread.run(Thread.java:722)\n\n\nWARN | Transport Connection to: StompSocket_19548821 failed: java.io.IOException\nException in thread \"ActiveMQ InactivityMonitor Worker\" java.lang.NullPointerException\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n\tat java.lang.Thread.run(Thread.java:722)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jprillaman","name":"jprillaman","key":"jprillaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Prillaman","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-03T13:19:48.544+0000","updated":"2014-04-03T13:31:14.043+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/13986831","id":"13986831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcarman","name":"pcarman","key":"pcarman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paddy","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm using version 5.9.1.  I still see this issue when I connect to the broker using STOMP over websocket. Output from the console:\n\nWARN | Transport Connection to: StompSocket_5104867 failed: java.io.IOException\nException in thread \"ActiveMQ InactivityMonitor Worker\" java.lang.NullPointerException\n        at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)\n        at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:722)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcarman","name":"pcarman","key":"pcarman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paddy","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-01T18:19:05.789+0000","updated":"2014-05-01T18:19:05.789+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/13986982","id":"13986982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jakanapes","name":"jakanapes","key":"jakanapes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Sharp","active":true,"timeZone":"America/Chicago"},"body":"Seeing the same exception as Paddy.\n\nI'm using the 5.9.1 homebrew version locally, but seeing the same thing on our staging environment.\n\nIf I set the heartbeat to 0,0, the browser receives messages, even though it disconnects every 5 minutes and has to reconnect. \n\nWith the heartbeat set to 10000,10000, the browser never receives messages.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jakanapes","name":"jakanapes","key":"jakanapes","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Sharp","active":true,"timeZone":"America/Chicago"},"created":"2014-05-01T20:53:11.665+0000","updated":"2014-05-01T20:57:37.799+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/13987625","id":"13987625","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcharl","name":"tcharl","key":"tcharl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Charlie Mordant","active":true,"timeZone":"Etc/UTC"},"body":"Same as Paddy here too with 5.9.1.\n\nPlease reopen","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcharl","name":"tcharl","key":"tcharl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Charlie Mordant","active":true,"timeZone":"Etc/UTC"},"created":"2014-05-02T12:10:21.989+0000","updated":"2014-05-02T12:10:21.989+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/14008393","id":"14008393","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"Please reopen this ticket. The bug described above is still present in 5.9.1. I tried both cases, heartbeat set to  0,0 and 10000,10000. Slightly different buggy behaviors, but it still does not work. Please:\n1) download 5.9.1\n2) bin/activemq console xbean:examples/conf/activemq-demo.xml\n3) open two browsers (firefox/chrome) to http://localhost:8161/demo/websocket/index.html\n4) type a few messages over a 5 minute period\n\n WARN | Transport Connection to: StompSocket_1998606381 failed: java.io.IOException\n WARN | Transport Connection to: StompSocket_178709817 failed: java.io.IOException\nException in thread \"ActiveMQ InactivityMonitor Worker\" java.lang.NullPointerException\n        at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)\n        at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\nException in thread \"ActiveMQ InactivityMonitor Worker\" java.lang.NullPointerException\n        at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)\n        at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2014-05-25T18:14:42.585+0000","updated":"2014-05-25T18:14:42.585+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/14010995","id":"14010995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bergamot","name":"bergamot","key":"bergamot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjan van den Berg","active":true,"timeZone":"Europe/Berlin"},"body":"I also already opened a ticket for the above heartbeat bug: AMQ-5155\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bergamot","name":"bergamot","key":"bergamot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjan van den Berg","active":true,"timeZone":"Europe/Berlin"},"created":"2014-05-28T10:16:01.568+0000","updated":"2014-05-28T10:16:01.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/14027792","id":"14027792","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmesnil","name":"jmesnil","key":"jmesnil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Mesnil","active":true,"timeZone":"Etc/UTC"},"body":"Issue is still happening with ActiveMQ 5.10.0.\n\nIn the log:\n\n2014-06-11 15:27:59,776 | WARN  | Transport Connection to: StompSocket_1430955985 failed: java.io.IOException | org.apache.activemq.broker.TransportConnection.Transport | qtp542980314-29\n\nThe corresponding STOMP frames were:\n\nCONNECT\naccept-version:1.1,1.0\nheart-beat:20000,60000\n\nCONNECTED\nserver:ActiveMQ/5.10.0\nheart-beat:60000,20000\nsession:ID:jeff.local-51540-1402496252734-2:1\nversion:1.1\n\nAnd the Web Socket client was sending PING frames every 20 seconds.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmesnil","name":"jmesnil","key":"jmesnil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Mesnil","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-11T14:07:20.875+0000","updated":"2014-06-11T14:19:11.581+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/14352886","id":"14352886","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebsjo","name":"sebsjo","key":"sebsjo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian Sjödin","active":true,"timeZone":"Etc/UTC"},"body":"The StompSocket IOException seems to still be an issue with ActiveMQ 5.11.1 (and jetty-8.1.17).\n\nI did some further investigations, and it seems like the java.io.IOException is caused by a java.io.EOFException that in its turn is caused by an InputStream being closed (since there is no more data to be read) and this is not handled gracefully. Quickly added a try-catch block for EOFException and it now seems to work. Should probably be handled in a better way though than what is in the attached AMQ-4740-EOF.diff.\n\nThis patch does not solve the heart-beat issue though, but by applying the suggested code from Claudio in AMQ-5155 this seems to work fine, at least when testing with stomp.js:\n{noformat}\nOpening Web Socket...\nWeb Socket Opened...\n>>> CONNECT\nlogin:\npasscode:password\naccept-version:1.1,1.0\nheart-beat:10000,10000\n\n<<< CONNECTED\nheart-beat:10000,10000\nsession:ID:server01-55719-1425899064567-4:58\nserver:ActiveMQ/5.11.1\nversion:1.1\n\nconnected to server ActiveMQ/5.11.1\nsend PING every 10000ms\ncheck PONG every 10000ms\nconnected to Stomp\n>>> SUBSCRIBE\nid:sub-0\ndestination:/topic/chat.general\n\n<<< PONG\n>>> PING\n<<< PONG\n>>> PING\n<<< PONG\n>>> PING\n<<< PONG\n>>> PING\n<<< PONG\n>>> PING\n<<< PONG\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebsjo","name":"sebsjo","key":"sebsjo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian Sjödin","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-09T12:31:50.477+0000","updated":"2015-03-09T12:31:50.477+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670485/comment/14389465","id":"14389465","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Fixed by AMQ-5155","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-03-31T21:38:07.963+0000","updated":"2015-03-31T21:38:07.963+0000"}],"maxResults":12,"total":12,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4740/votes","votes":6,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1oehr:"}}