{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482081","self":"https://issues.apache.org/jira/rest/api/2/issue/12482081","key":"AMQ-1081","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2006-12-01 03:06:46.0","customfield_12310420":"84724","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_21026159973_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2007-08-01T11:42:45.973+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1081/watchers","watchCount":0,"isWatching":false},"created":"2006-12-01T03:06:46.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-08-01T11:42:45.943+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I'm not sure if this is serious; if not please reduce its severity.\n\nThere seem to be some confusing things happening with acknowledgments.\n\n1. PrefetchSubscription.java does a \"range check\" on the acknowledgement.  However, when the acknowledgment gets to the JDBC or Memory TOPIC store (possibly other stores as well), it is assumed that all acknowledgements up to the last are counted.  This seems to suggest that the \"first\" part of the range should NOT be verified for >= (in other words, it should acknowledge everything from the beginning of the dispatched LinkedList to ack.getLastMessageId -- this means taking out the inAckRange variable, or acting like it is always true).  I believe this may need to happen ONLY when the prefetch is doing a topic (DurableTopicSubscription) , not a queue (QueueSubscription), but I'm totally not sure.\n\n2. When kahaadaptor.KahaTopicMessageStore is called to do an acknowledge, it blindly does a removeFirst on the container, and never uses the MessageId parameter to do anything.  I believe it should do a getFirst, verify that that the MessageId of the ConsumerMessageRef matches the parameter, if it does not match, cancel the acknowledgement (not clear how to do this because the PrefetchSubscription.acknowledge has already done work).  In any event, crashing the subscription might be better than risking goofing up which messages have been acknowledged. (Another possibility is to walk the LinkedList looking for a match, but this doesn't seem to make sense given how PrefetchSubscription tracks the acknowledgments; I haven't fully thought this through).\n\n3. Looks like TopicSubscription.java is ignoring all of the ID info in the ack parameter (this is the non-durable subscriber case).  Is this right?  Seems like client could just send extraneous ack messages with arbitrary IDs on a non-durable subscription and goof this up.\n\n4.  In either durable or non-durable case, attempt by the client to ack out of sequence should error out on the client and not mess up any of the subscription state.  Most worried about the case where the messageis > than what has been delivered, not sure if the < case is a problem as long as it is just ignored without impact (which certainly does not look like the current impl in TopicSubscription.java; not sure about PrefetchSubscription.java).  It looks like this isn't being enforced, or did I miss something?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"254944","customfield_12312823":null,"summary":"Ack range checking, etc.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jk%40penguinsfan.com","name":"jk@penguinsfan.com","key":"jk@penguinsfan.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jk@penguinsfan.com","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jk%40penguinsfan.com","name":"jk@penguinsfan.com","key":"jk@penguinsfan.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jk@penguinsfan.com","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1081/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i180vj:"}}