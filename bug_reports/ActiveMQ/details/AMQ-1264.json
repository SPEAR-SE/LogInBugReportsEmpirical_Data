{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482411","self":"https://issues.apache.org/jira/rest/api/2/issue/12482411","key":"AMQ-1264","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2007-06-12T09:48:09.177+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Apr 28 10:15:58 UTC 2008","customfield_12310420":"84704","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3822499259_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2007-07-19T07:42:46.685+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1264/watchers","watchCount":0,"isWatching":false},"created":"2007-06-05T01:54:27.426+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-04-28T10:15:58.375+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"  There is a problem when using the default persistence settings, and ActiveMQ is shutdown uncleanly with messages in a queue.  After a restart (and log recovery), and attempt to read a message out of the queue, generates the following error (and ActiveMQ hangs).\n\n  It appears that there are too many \"-\" in a concatenation somewhere, as the logfiles are \"data-1\", \"data-2\", etc, not \"data--1\", which is probably is what is generating the exception.\n\n  This is with 4.2-SNAPSHOT-20070602.\n\n\nERROR AsyncDataManager               - Looking for key 1 but not found in fileMap: {3=data-3 number = 3 , length = 9051046 refCount = 3}\nERROR QueueStorePrefetch             - Failed to fill batch\njava.io.IOException: Failed to read to journal for: offset = 20785811, file = 1, size = -1, type = 0. Reason: java.io.IOException: Could not locate data file data--1\n        at org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:31)\n        at org.apache.activemq.store.amq.AMQPersistenceAdapter.createReadException(AMQPersistenceAdapter.java:529)\n        at org.apache.activemq.store.amq.AMQPersistenceAdapter.readCommand(AMQPersistenceAdapter.java:409)\n        at org.apache.activemq.store.amq.AMQMessageStore.getMessage(AMQMessageStore.java:382)\n        at org.apache.activemq.store.amq.RecoveryListenerAdapter.recoverMessageReference(RecoveryListenerAdapter.java:52)\n        at org.apache.activemq.store.kahadaptor.KahaReferenceStore.recover(KahaReferenceStore.java:63)\n        at org.apache.activemq.store.kahadaptor.KahaReferenceStore.recoverNextMessages(KahaReferenceStore.java:89)\n        at org.apache.activemq.store.amq.AMQMessageStore.recoverNextMessages(AMQMessageStore.java:477)\n        at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.fillBatch(QueueStorePrefetch.java:159)\n        at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.hasNext(QueueStorePrefetch.java:110)\n        at org.apache.activemq.broker.region.cursors.StoreQueueCursor.hasNext(StoreQueueCursor.java:122)\n        at org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1007)\n        at org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:992)\n        at org.apache.activemq.broker.region.Queue.addSubscription(Queue.java:215)\n        at org.apache.activemq.broker.region.AbstractRegion.addConsumer(AbstractRegion.java:241)\n        at org.apache.activemq.broker.region.RegionBroker.addConsumer(RegionBroker.java:341)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:87)\n        at org.apache.activemq.advisory.AdvisoryBroker.addConsumer(AdvisoryBroker.java:79)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:87)\n        at org.apache.activemq.broker.MutableBrokerFilter.addConsumer(MutableBrokerFilter.java:97)\n        at org.apache.activemq.broker.TransportConnection.processAddConsumer(TransportConnection.java:566)\n        at org.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:313)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:282)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:65)\n        at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:81)\n        at org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:119)\n        at org.apache.activemq.transport.stomp.ProtocolConverter.onStompSubscribe(ProtocolConverter.java:351)\n        at org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommad(ProtocolConverter.java:149)\n        at org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:71)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:137)\n        at java.lang.Thread.run(Thread.java:595)\nCaused by: java.io.IOException: Could not locate data file data--1\n        at org.apache.activemq.kaha.impl.async.AsyncDataManager.getDataFile(AsyncDataManager.java:259)\n        at org.apache.activemq.kaha.impl.async.AsyncDataManager.read(AsyncDataManager.java:477)\n        at org.apache.activemq.store.amq.AMQPersistenceAdapter.readCommand(AMQPersistenceAdapter.java:406)\n        ... 30 more","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"255016","customfield_12312823":null,"summary":"Kaha crashes after database recovery looking for \"data--2\"","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tom%40samplonius.org","name":"tom@samplonius.org","key":"tom@samplonius.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Samplonius","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tom%40samplonius.org","name":"tom@samplonius.org","key":"tom@samplonius.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Samplonius","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"apache-activemq-4.2-20070602\n\ntom@light:~/activemq$ java -version\njava version \"1.5.0\"\nJava(TM) 2 Runtime Environment, Standard Edition (build diablo-1.5.0-b01)\nJava HotSpot(TM) Server VM (build diablo-1.5.0_07-b01, mixed mode)\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482411/comment/12936486","id":"12936486","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"added an affected version","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-12T09:48:09.177+0000","updated":"2007-06-12T09:48:09.177+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482411/comment/12936430","id":"12936430","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"given your recent work on the Kaha/AMQStore I figured this was for you :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-12T16:07:09.091+0000","updated":"2007-06-12T16:07:09.091+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482411/comment/12936451","id":"12936451","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tom%40samplonius.org","name":"tom@samplonius.org","key":"tom@samplonius.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Samplonius","active":true,"timeZone":"America/Los_Angeles"},"body":"I tested this again in activemq-5.0-20070621.\n\nI used a Net::Stomp based client to produce 250,000 mesages into a queue.  And then used a consumer to grab messages.  After consuming 85,000 of the message, I \"kill -9\" (immediate exit) the java process, and then started ActiveMQ again.\n\nActiveMQ starts a Kaha recovery:\n\nINFO  AMQPersistenceAdapter          - Journal Recovery Started from: DataManager:(data-)\nINFO  AMQPersistenceAdapter          - Recovered 176328 operations from redo log in 2905.979 seconds.\n\n(which takes a really long time, as you can see)\n\nAnd it still does this.  This looks like a trivial bug?  It looks someone just appended two hypens to \"data\".  Probably because the DataManager starts with \"data-\" (as logged above), and then adds \"-1\" afterwards.\n\nERROR AsyncDataManager               - Looking for key 1 but not found in fileMap: {2=data-2 number = 2 , length = 33554395 refCount = 0, 4=data-4 number = 4 , length = 3913200 refCount = 3, 3=data-3 number = 3 , length = 33554195 refCount = 0}\nERROR QueueStorePrefetch             - Failed to fill batch\njava.io.IOException: Failed to read to journal for: offset = 28983199, file = 1, size = -1, type = 0. Reason: java.io.IOException: Could not locate data file data--1\n        at org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:31)\n        at org.apache.activemq.store.amq.AMQPersistenceAdapter.createReadException(AMQPersistenceAdapter.java:541)\n        at org.apache.activemq.store.amq.AMQPersistenceAdapter.readCommand(AMQPersistenceAdapter.java:421)\n...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tom%40samplonius.org","name":"tom@samplonius.org","key":"tom@samplonius.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Samplonius","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-06-24T06:44:20.718+0000","updated":"2007-06-24T06:44:20.718+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482411/comment/12936552","id":"12936552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"this should be fixed - I can't reproduce - can you confirm Tom ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2007-07-11T08:39:28.324+0000","updated":"2007-07-11T08:39:28.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482411/comment/12936309","id":"12936309","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tom%40samplonius.org","name":"tom@samplonius.org","key":"tom@samplonius.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Samplonius","active":true,"timeZone":"America/Los_Angeles"},"body":"I have tested with a 5.0 snapshot from July 12, and it seems to be fine now.\n\nBut you'll want to avoid crashes, as a Kaha recovery on a message store after 200,000 messages have been queued, and then 55,000 removed, takes about a half-hour.\n\nI guess all of the dead-space in the Kaha log files takes a while to scan.  Would reducing the file size help?  I think Kaha removes files that no longer contain any active data as messages are consumed.  So if the log files are smaller, the log recovery should be faster right?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tom%40samplonius.org","name":"tom@samplonius.org","key":"tom@samplonius.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Samplonius","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-07-16T02:41:44.941+0000","updated":"2007-07-16T02:41:44.941+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482411/comment/12936291","id":"12936291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"reducing the size of the log files should help - I'll make it configurable on the AMQStore - thanks for the help Tom!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2007-07-19T07:42:14.624+0000","updated":"2007-07-19T07:42:14.624+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482411/comment/12936341","id":"12936341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"This now appaears fixed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2007-07-19T07:42:46.638+0000","updated":"2007-07-19T07:42:46.638+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482411/comment/12939593","id":"12939593","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dfrodrig","name":"dfrodrig","key":"dfrodrig","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Rodrigues","active":true,"timeZone":"Etc/UTC"},"body":"Hello, \n\nI think I am not supposed to re-open this issue, but the fact is, if there is a crash, recovery takes a  huge amount of time. \n\n2008-04-28 11:32:21,123 [erSimpleAppMain] INFO  AMQPersistenceAdapter          - Recovered 722013 operations from redo log in 3801.997 seconds.\n\nI understand this might have to be recovered once.  But, suppose we have a SAN master-slave configuration, basing it on AMQStore: the fact it's taking more than half an hour to recover renders this topology unusable! \n\n\nMoreover, it seems like kaha is not removing log files not containing any more active-data.\n\nFor instance, a recent log in a crash:\n \n2008-04-28 10:28:59,126 [erSimpleAppMain] INFO  AMQPersistenceAdapter          - Journal Recovery Started from: DataManager:(data-)\n2008-04-28 10:28:59,146 [msg.performance] DEBUG AMQMessageStore                - Doing batch update... adding: 0 removing: 0\n2008-04-28 10:28:59,147 [msg.performance] DEBUG AMQMessageStore                - Batch update done.\n2008-04-28 10:29:02,798 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: CHECKPOINT Tue Apr 15 13:49:33 CEST 2008\n2008-04-28 10:29:56,556 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: CHECKPOINT Tue Apr 15 13:50:33 CEST 2008\n(Repeats same Tracing until) \n2008-04-28 10:32:07,354 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: CHECKPOINT Thu Apr 17 15:23:33 CEST 2008\n2008-04-28 10:32:07,354 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: RECOVERED Thu Apr 17 15:26:50 CEST 2008\n2008-04-28 10:32:07,354 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: RECOVERED Thu Apr 17 16:04:16 CEST 2008\n2008-04-28 10:32:07,354 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: RECOVERED Fri Apr 18 10:38:25 CEST 2008\n2008-04-28 10:32:07,354 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: RECOVERED Fri Apr 18 14:43:28 CEST 2008\n2008-04-28 10:32:07,355 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: RECOVERED Fri Apr 18 16:52:44 CEST 2008\n2008-04-28 10:32:07,355 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: RECOVERED Fri Apr 18 17:00:09 CEST 2008\n2008-04-28 10:32:11,196 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: CHECKPOINT Wed Apr 23 11:41:09 CEST 2008\n(Repeats same tracing until)\n2008-04-28 11:32:21,091 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: CHECKPOINT Mon Apr 28 10:26:09 CEST 2008\n2008-04-28 11:32:21,091 [erSimpleAppMain] DEBUG AMQPersistenceAdapter          - TRACE Entry: CHECKPOINT Mon Apr 28 10:27:09 CEST 2008\n2008-04-28 11:32:21,123 [erSimpleAppMain] INFO  AMQPersistenceAdapter          - Recovered 722013 operations from redo log in 3801.997 secon\nds.\n2008-04-28 11:32:21,123 [erSimpleAppMain] INFO  AMQPersistenceAdapter          - Finished recovering the ReferenceStore\n\n\n\nSo, only very few operations were recovered, and most of the time the recovering time seems to have been spent unecessarily.\n\nEven assuming this is necessary once, why is it necessary to go back this much in time if we failover again?\n\n\nThanks,\ndaniel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dfrodrig","name":"dfrodrig","key":"dfrodrig","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Rodrigues","active":true,"timeZone":"Etc/UTC"},"created":"2008-04-28T10:15:58.293+0000","updated":"2008-04-28T10:15:58.293+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1264/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i181bj:"}}