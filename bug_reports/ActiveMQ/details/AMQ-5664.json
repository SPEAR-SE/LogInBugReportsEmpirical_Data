{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12782324","self":"https://issues.apache.org/jira/rest/api/2/issue/12782324","key":"AMQ-5664","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2015-05-13T00:05:15.977+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 15 17:28:30 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_26347591618_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-01-15T17:28:30.130+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5664/watchers","watchCount":2,"isWatching":false},"created":"2015-03-16T18:41:58.566+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[{"id":"12446078","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12446078","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12904879","key":"QPIDJMS-129","self":"https://issues.apache.org/jira/rest/api/2/issue/12904879","fields":{"summary":"occasional CME in broker during ActiveMQ interop tests","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/6","id":"6","description":"A new unit, integration or system test.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/requirement.png","name":"Test","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-01-15T17:28:30.181+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"While running test against the new QPid AMQP JMS client we send some messages to a Queue via the OpenWire JMS client over a VM transport connection for later consumption by the AMQP JMS client.  During a recent test run we caught this:\n\n{noformat}\nTests run: 18, Failures: 0, Errors: 1, Skipped: 1, Time elapsed: 27.368 sec <<< FAILURE! - in org.apache.qpid.jms.consumer.JmsMessageConsumerTest\ntestSetMessageListenerAfterStartAndSend(org.apache.qpid.jms.consumer.JmsMessageConsumerTest)  Time elapsed: 0.596 sec  <<< ERROR!\njavax.jms.JMSException: java.util.ConcurrentModificationException\n        at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:54)\n        at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1420)\n        at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1346)\n        at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1904)\n        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:288)\n        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:223)\n        at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:468)\n        at org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:297)\n        at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n        at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:307)\n        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:152)\n        at org.apache.activemq.security.AuthorizationBroker.send(AuthorizationBroker.java:223)\n        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:152)\n        at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:157)\n        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:541)\n        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:768)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:334)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n        at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:248)\n        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:133)\n        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:48)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.util.ConcurrentModificationException: null\n        at java.util.HashMap$HashIterator.nextNode(HashMap.java:1429)\n        at java.util.HashMap$KeyIterator.next(HashMap.java:1453)\n        at org.apache.activemq.util.MarshallingSupport.marshalPrimitiveMap(MarshallingSupport.java:61)\n        at org.apache.activemq.command.Message.beforeMarshall(Message.java:231)\n        at org.apache.activemq.command.ActiveMQTextMessage.beforeMarshall(ActiveMQTextMessage.java:115)\n        at org.apache.activemq.openwire.v10.MessageMarshaller.looseMarshal(MessageMarshaller.java:281)\n        at org.apache.activemq.openwire.v10.ActiveMQMessageMarshaller.looseMarshal(ActiveMQMessageMarshaller.java:111)\n        at org.apache.activemq.openwire.v10.ActiveMQTextMessageMarshaller.looseMarshal(ActiveMQTextMessageMarshaller.java:111)\n        at org.apache.activemq.openwire.OpenWireFormat.marshal(OpenWireFormat.java:155)\n        at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.addMessage(KahaDBStore.java:427)\n        at org.apache.activemq.store.kahadb.KahaDBStore$StoreQueueTask.run(KahaDBStore.java:1296)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n{noformat}\n\nWill need to dig in and see how this happened when we have a chance.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ConcurrentModificationException seen from client send of TextMessage","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12782324/comment/14541070","id":"14541070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mike3d3","name":"mike3d3","key":"mike3d3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dillon","active":true,"timeZone":"Etc/UTC"},"body":"Seeing a similar issue with AMQ broker using v 5.10.  The client is using verison 5.10 of the AMQ libraries.  This happens at least a couple of times a month per client.  The client shows as  connected/Active, but does not process more messages.  The Messages Awaiting Acknowledgement increases up to the prefetch limit for durable subscribers of the topics.  I do not have a test case to reporcude this as it happens randomly.  The only thing of note is that once the error happens the broker and the client exchange bits every 10 seconds (assuming this is the keepalive) until the client is restarted.\n\n2015-05-12_18:59:53.39814 Exception in thread \"ActiveMQ Connection Dispatcher: tcp://11.11.11.111:2291\" java.util.ConcurrentModificationException\n2015-05-12_18:59:53.39830       at java.util.HashMap$HashIterator.nextNode(HashMap.java:1429)\n2015-05-12_18:59:53.39831       at java.util.HashMap$KeyIterator.next(HashMap.java:1453)\n2015-05-12_18:59:53.39831       at org.apache.activemq.util.MarshallingSupport.marshalPrimitiveMap(MarshallingSupport.java:61)\n2015-05-12_18:59:53.39832       at org.apache.activemq.command.Message.beforeMarshall(Message.java:231)\n2015-05-12_18:59:53.39832       at org.apache.activemq.command.ActiveMQTextMessage.beforeMarshall(ActiveMQTextMessage.java:115)\n2015-05-12_18:59:53.39832       at org.apache.activemq.openwire.v10.MessageMarshaller.looseMarshal(MessageMarshaller.java:281)\n2015-05-12_18:59:53.39832       at org.apache.activemq.openwire.v10.ActiveMQMessageMarshaller.looseMarshal(ActiveMQMessageMarshaller.java:111)\n2015-05-12_18:59:53.39832       at org.apache.activemq.openwire.v10.ActiveMQTextMessageMarshaller.looseMarshal(ActiveMQTextMessageMarshaller.java:111)\n2015-05-12_18:59:53.39832       at org.apache.activemq.openwire.OpenWireFormat.looseMarshalNestedObject(OpenWireFormat.java:480)\n2015-05-12_18:59:53.39833       at org.apache.activemq.openwire.v10.BaseDataStreamMarshaller.looseMarshalNestedObject(BaseDataStreamMarshaller.java:471)\n2015-05-12_18:59:53.39833       at org.apache.activemq.openwire.v10.MessageDispatchMarshaller.looseMarshal(MessageDispatchMarshaller.java:139)\n2015-05-12_18:59:53.39833       at org.apache.activemq.openwire.OpenWireFormat.marshal(OpenWireFormat.java:237)\n2015-05-12_18:59:53.39833       at org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:175)\n2015-05-12_18:59:53.39834       at org.apache.activemq.transport.AbstractInactivityMonitor.doOnewaySend(AbstractInactivityMonitor.java:304)\n2015-05-12_18:59:53.39834       at org.apache.activemq.transport.AbstractInactivityMonitor.oneway(AbstractInactivityMonitor.java:286)\n2015-05-12_18:59:53.39834       at org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:85)\n2015-05-12_18:59:53.39834       at org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:104)\n2015-05-12_18:59:53.39835       at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)\n2015-05-12_18:59:53.39836       at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1370)\n2015-05-12_18:59:53.39836       at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:889)\n2015-05-12_18:59:53.39836       at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:935)\n2015-05-12_18:59:53.39836       at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:112)\n2015-05-12_18:59:53.39836       at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:42)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mike3d3","name":"mike3d3","key":"mike3d3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dillon","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-13T00:05:15.977+0000","updated":"2015-05-13T14:55:08.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12782324/comment/14544425","id":"14544425","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"That error is coming from the Broker side and not the client, I'd suggest moving to 5.11.1+ to run with the latest fixes. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-05-14T21:53:07.551+0000","updated":"2015-05-14T21:53:07.551+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12782324/comment/15102124","id":"15102124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"We haven't been able to reproduce this in awhile to capture any meaningful diagnostics ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-01-15T17:28:30.171+0000","updated":"2016-01-15T17:28:30.171+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5664/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i26trj:"}}