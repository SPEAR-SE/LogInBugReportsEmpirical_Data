{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12702360","self":"https://issues.apache.org/jira/rest/api/2/issue/12702360","key":"AMQ-5109","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-03-19T16:51:18.856+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Apr 04 15:43:29 UTC 2014","customfield_12310420":"380700","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5109/watchers","watchCount":5,"isWatching":false},"created":"2014-03-19T11:27:17.829+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":["patch"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"issuelinks":[{"id":"12385880","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12385880","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12687674","key":"AMQ-4964","self":"https://issues.apache.org/jira/rest/api/2/issue/12687674","fields":{"summary":"org.apache.activemq.bugs.ConnectionPerMessageTest is very slow - seems to point to lock contention on close","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-04-04T15:43:49.828+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"\"Soft\" deadlock occurres due to async stopping in case of starting/stopping lots of client connections (using jms template with standard connection factory, for example). ActiveMQ BrokerService gets frozen for 1 second trying to acquire the lock. As a result, already poor performance in case of unpooled connection factory further degrades by around 50%.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12635528","id":"12635528","filename":"TransportConnection.java.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickolay_martinov","name":"nickolay_martinov","key":"nickolay_martinov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nickolay_martinov&avatarId=17284","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nickolay_martinov&avatarId=17284","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nickolay_martinov&avatarId=17284","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nickolay_martinov&avatarId=17284"},"displayName":"Nikolay Martynov","active":true,"timeZone":"Europe/Moscow"},"created":"2014-03-19T11:28:15.809+0000","size":10009,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12635528/TransportConnection.java.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"380979","customfield_12312823":null,"summary":"\"Soft deadlock\" in TransportConnection causes degraded performance in certain situations","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickolay_martinov","name":"nickolay_martinov","key":"nickolay_martinov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nickolay_martinov&avatarId=17284","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nickolay_martinov&avatarId=17284","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nickolay_martinov&avatarId=17284","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nickolay_martinov&avatarId=17284"},"displayName":"Nikolay Martynov","active":true,"timeZone":"Europe/Moscow"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickolay_martinov","name":"nickolay_martinov","key":"nickolay_martinov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nickolay_martinov&avatarId=17284","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nickolay_martinov&avatarId=17284","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nickolay_martinov&avatarId=17284","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nickolay_martinov&avatarId=17284"},"displayName":"Nikolay Martynov","active":true,"timeZone":"Europe/Moscow"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"HP-UX 11.31, RHEL 5/6. HP JDK 6/7, Oracle JDK 6/7","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12702360/comment/13940404","id":"13940404","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickolay_martinov","name":"nickolay_martinov","key":"nickolay_martinov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nickolay_martinov&avatarId=17284","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nickolay_martinov&avatarId=17284","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nickolay_martinov&avatarId=17284","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nickolay_martinov&avatarId=17284"},"displayName":"Nikolay Martynov","active":true,"timeZone":"Europe/Moscow"},"body":"Attached patch that fixes problem for us","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickolay_martinov","name":"nickolay_martinov","key":"nickolay_martinov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nickolay_martinov&avatarId=17284","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nickolay_martinov&avatarId=17284","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nickolay_martinov&avatarId=17284","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nickolay_martinov&avatarId=17284"},"displayName":"Nikolay Martynov","active":true,"timeZone":"Europe/Moscow"},"created":"2014-03-19T11:28:15.813+0000","updated":"2014-03-19T11:28:15.813+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12702360/comment/13940659","id":"13940659","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"do you have any unit test that can easily demo the problem?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2014-03-19T16:51:18.856+0000","updated":"2014-03-19T16:51:18.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12702360/comment/13946773","id":"13946773","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickolay_martinov","name":"nickolay_martinov","key":"nickolay_martinov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nickolay_martinov&avatarId=17284","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nickolay_martinov&avatarId=17284","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nickolay_martinov&avatarId=17284","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nickolay_martinov&avatarId=17284"},"displayName":"Nikolay Martynov","active":true,"timeZone":"Europe/Moscow"},"body":"Sorry, we have no unit test. The problem was discovered, troubleshooted and fixed thanks to the load test for the application. It should be possible, however, to reproduce it with JMSTemplate or code like in it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickolay_martinov","name":"nickolay_martinov","key":"nickolay_martinov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nickolay_martinov&avatarId=17284","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nickolay_martinov&avatarId=17284","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nickolay_martinov&avatarId=17284","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nickolay_martinov&avatarId=17284"},"displayName":"Nikolay Martynov","active":true,"timeZone":"Europe/Moscow"},"created":"2014-03-25T16:49:58.863+0000","updated":"2014-03-25T16:49:58.863+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12702360/comment/13956435","id":"13956435","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"this may provide a test case - seems to be the same issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-01T11:56:27.614+0000","updated":"2014-04-01T11:56:27.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12702360/comment/13960066","id":"13960066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lurida","name":"lurida","key":"lurida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marina","active":true,"timeZone":"Etc/UTC"},"body":"We have checked ConnectionPerMessageTest and it shows the soft deadlock described in this bug. Although the use-case is bad in AMQ-4964, the deadlock is in the transport connection and it can affect performance in other usecases.\nThe debugger reveals that, one of the transports in VM transports pair needs the other one to stop. If the second thread is busy and the first thread manages to receive a write lock before the second one, then the second tread cannot shutdown, because it cannot acquire the lock. They both wait for each other until the specified timeout period elapses ( 1 second in runable.wait(timeout)). This problem is resolved when session gets closed. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lurida","name":"lurida","key":"lurida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marina","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-04T15:43:29.393+0000","updated":"2014-04-04T15:43:49.822+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5109/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1tlcv:"}}