{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483115","self":"https://issues.apache.org/jira/rest/api/2/issue/12483115","key":"AMQ-2028","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"parent":{"id":"12483121","key":"AMQ-2483","self":"https://issues.apache.org/jira/rest/api/2/issue/12483121","fields":{"summary":"OOM due to build of of iterate executions during bulk message consumption - asyncWakeup called excessivly","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315621","id":"12315621","description":"","name":"5.3.1","archived":false,"released":true,"releaseDate":"2010-03-23"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-10-27T08:19:23.304+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 13 15:24:27 UTC 2009","customfield_12310420":"75116","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_24597910_*|*_6_*:*_1_*:*_28907686457_*|*_5_*:*_1_*:*_0_*|*_4_*:*_1_*:*_324769798","customfield_12312321":null,"resolutiondate":"2009-11-13T15:24:27.371+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2028/watchers","watchCount":1,"isWatching":false},"created":"2008-12-10T00:26:53.206+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-11-13T15:30:58.163+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"cmon guys,\n\n                    if (taskRunnerCreated.compareAndSet(false, true)) {\n                        if (taskRunner == null) {\n                            taskRunner = session.connection.getSessionTaskRunner().createTaskRunner(this,\n                                    \"ActiveMQ Session: \" + session.getSessionId());\n                        }\n                    }\n                    taskRunner.wakeup();\n\n\nis not anywhere close to thread safe.\n\nI'm seeing JmsClientAckTest and JmsRedeliveredTest failing due to this.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461329","id":"12461329","filename":"ActiveMQSessionExecutor.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-09T21:08:32.373+0000","size":2525,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461329/ActiveMQSessionExecutor.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161704","customfield_12312823":null,"summary":"ActiveMQSessionExecutor.taskRunner usage is very non-thread-safe","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483115/comment/12940538","id":"12940538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"body":"Fixed in rev 725020.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djencks","name":"djencks","key":"djencks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Jencks","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-10T07:16:51.114+0000","updated":"2008-12-10T07:16:51.114+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483115/comment/12941682","id":"12941682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"body":"It seems to me that the ActiveMQSessionExecutor is still not very thread safe.\n\nThe problem is that in the stop() method the this.taskRunner is set to null without synchronization.\n\nHence in the wakeup() method within the synchronized block it could happen that this.taskRunner is set to null between \ncreating new TaskRunner and assigning it to the local variable, if the stop() is called in parallel  - see below:\n\n                        synchronized (this) {\n                            if (this.taskRunner == null) {\n                                this.taskRunner = session.connection.getSessionTaskRunner().createTaskRunner(this,\n                                        \"ActiveMQ Session: \" + session.getSessionId());\n                            }\n                            ///////////////// here this.taskRunner can be set to null, if stop() is called  in between .... //////////////////////\n                            taskRunner = this.taskRunner;\n                        }\nThe result would be a NullPointerException in taskRunner.wakeup() two lines below.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-27T08:19:23.304+0000","updated":"2009-11-09T19:53:34.038+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483115/comment/12941750","id":"12941750","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuhtz","name":"akuhtz","key":"akuhtz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=akuhtz&avatarId=14846","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=akuhtz&avatarId=14846","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=akuhtz&avatarId=14846","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=akuhtz&avatarId=14846"},"displayName":"Andreas Kuhtz","active":true,"timeZone":"Europe/Berlin"},"body":"You should create a new issue or at least re-open this issue ....","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuhtz","name":"akuhtz","key":"akuhtz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=akuhtz&avatarId=14846","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=akuhtz&avatarId=14846","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=akuhtz&avatarId=14846","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=akuhtz&avatarId=14846"},"displayName":"Andreas Kuhtz","active":true,"timeZone":"Europe/Berlin"},"created":"2009-10-28T08:54:17.933+0000","updated":"2009-10-28T08:54:17.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483115/comment/12941608","id":"12941608","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"body":"Attached a proposal for a thread safety patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-09T21:08:32.552+0000","updated":"2009-11-09T21:08:32.552+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483115/comment/12941777","id":"12941777","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"fixed applied in r835874\nleft use of volatile but tidied up stop() logic and creation of new taskRunner if queue was stopped. This avoids the NPE. Came across this with useDedicatedTaskRunner=true system property, result was leaked threads due to this sync issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-13T15:24:27.338+0000","updated":"2009-11-13T15:24:27.338+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2028/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s1en:"}}