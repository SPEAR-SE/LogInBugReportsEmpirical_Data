{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12833667","self":"https://issues.apache.org/jira/rest/api/2/issue/12833667","key":"AMQ-5814","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329669","id":"12329669","name":"5.11.2","archived":false,"released":true,"releaseDate":"2015-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329258","id":"12329258","name":"5.12.0","archived":false,"released":true,"releaseDate":"2015-08-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-05-29T14:43:36.373+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 03 01:45:42 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2978017059_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-07-02T15:41:19.272+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5814/watchers","watchCount":5,"isWatching":false},"created":"2015-05-29T04:27:42.288+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329390","id":"12329390","name":"5.10.2","archived":false,"released":true,"releaseDate":"2015-02-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324951","id":"12324951","name":"5.11.0","archived":false,"released":true,"releaseDate":"2015-02-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[{"id":"12429446","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12429446","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12710147","key":"AMQ-5160","self":"https://issues.apache.org/jira/rest/api/2/issue/12710147","fields":{"summary":"Wildcard subscriptions bypass Authentication / Authorization","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-08-04T12:51:37.920+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12318701","id":"12318701","name":"MQTT","description":"MQTT Transport"}],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10092","value":"Unit Test Broken","id":"10092"}],"description":"Since version 5.10, the problem has been caused by broker. It was behaving wrong with role-based authorization. I have configured right SimpleAuthorization plugin but no luck.  \n\nI guess it has problem from -AMQ-5160- \n\nHere my test cases on github, please review and let me know if you have any questions: https://github.com/hongphu8790/activemq/tree/master/mqtt-authorization-test\n\nProject test-case descriptions:\n- Using debug mode for broker to view detail\nproblem.\n- Repeat with pom.xml file \n+ With AMQ 5.9.1 (it will pass all test cases)\n+ With AMQ >= 5.10.0 (it will pass only test cases with using publisher have super permission\n\nHere my log occurred when the test case failed:\n{code:title=Log debug mode - activemq.log|borderStyle=solid}\n2015-05-29 10:30:24,746 | DEBUG | AbstractRegion                 | Subscription denied for TopicSubscription: consumer=ID:XXXXXX-50828-1432870224218-2:2:-1:1, destinations=0, dispatched=0, delivered=0, matched=0, discarded=0 to destination topic://dcu.id: User publisher is not authorized to read from: topic://dcu.id\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12736307","id":"12736307","filename":"activemq-snapshot-5.12-20150529.223833.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"created":"2015-05-30T02:44:01.906+0000","size":15806,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12736307/activemq-snapshot-5.12-20150529.223833.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Wrong with role-based authorization when using right permission","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Unix, Windows","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14564913","id":"14564913","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Have you tried against a 5.12-SNAPSHOT, there have been some fixes in this area I think. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-05-29T14:43:36.373+0000","updated":"2015-05-29T14:43:36.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14565799","id":"14565799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"body":"Hi Timothy Bish,\n\nI was tested again with 5.12-snapshot, and no luck. Please view my attachment: activemq-snapshot-5.12-20150529.223833.txt\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"created":"2015-05-30T02:47:54.318+0000","updated":"2015-05-30T02:47:54.318+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14572736","id":"14572736","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"body":"Hi Timothy Bish,\n\nThis was a big problem for my production. I couldn't use AMQ version greater than version 5.9.1.\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"created":"2015-06-04T13:17:21.685+0000","updated":"2015-06-04T13:17:21.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14609680","id":"14609680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"body":"Hi [~tabish121],\n\nPlease help me to reproduce this error, we couldn't use AMQ version greater than 5.9.1 with SimpleAuthorization support.\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"created":"2015-07-01T07:28:15.215+0000","updated":"2015-07-01T07:28:15.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14611077","id":"14611077","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I wrote a little test that doesn't requite MQTT to reproduce, the difference from previous behaviour seems to have come from the changes made for AMQ-5160.  Some further investigation is needed.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-07-01T22:12:29.974+0000","updated":"2015-07-01T22:12:29.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14611078","id":"14611078","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Changes here seem to have introduced this behavior","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-07-01T22:13:18.001+0000","updated":"2015-07-01T22:13:18.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14611809","id":"14611809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"I looked at this a little yesterday.  When the producer sends a message it causes a new destination to get created because the subscriber is listening on a wildcard destination.  The issue seems to be that during destination creation, the ConnectionContext of the producer is used to create the destination, instead of the consumer.  (Happens in addSubscriptionsForDestination method of TopicRegion).  The end result is the security check fails in the addSubscription method of AuthorizationDestinationFilter because it uses the producer's ACLs instead of the consumer's ACLs to determine if the subscription is allowed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-07-02T11:26:05.636+0000","updated":"2015-07-02T11:26:54.539+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14611818","id":"14611818","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"body":"This is a big bug, i think so. Could you tell me how to bypass or fix this problem. We have waited a long time since first release AMQ 5.9.1.\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"created":"2015-07-02T11:39:42.143+0000","updated":"2015-07-02T11:39:42.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14611887","id":"14611887","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user cshannon opened a pull request:\n\n    https://github.com/apache/activemq/pull/125\n\n    https://issues.apache.org/jira/browse/AMQ-5814\n\n    This fixes an issue where a producer's connection context was being\n    used to create a subscription instead of the consumer's context\n    which could lead to permission check failures.\n    \n    Thanks to hongphu8790@gmail.com for providing the test case.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/cshannon/activemq AMQ-5814\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/125.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #125\n    \n----\ncommit ef552fcc8bb14eea33170019aca2850e3c03467d\nAuthor: Christopher L. Shannon (cshannon) <christopher.l.shannon@gmail.com>\nDate:   2015-07-02T12:33:16Z\n\n    https://issues.apache.org/jira/browse/AMQ-5814\n    \n    This fixes an issue where a producer's connection context was being\n    used to create a subscription instead of the consumer's context\n    which could lead to permission check failures.\n    \n    Thanks to hongphu8790@gmail.com for providing the test case.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-02T12:35:56.301+0000","updated":"2015-07-02T12:35:56.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14611893","id":"14611893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"[~hongphu8790],\n\nI have pushed up a pull request to fix this issue and included your test case in the patch to make sure that the issue stays fixed.\n\n[~tabish121],\n\nCan you take a look and make sure it looks ok?  It seemed like a very simple fix but I just want to make sure what I changed wouldn't have any unintended consequences.  I ran through some of the tests relating to AMQ-5160 and they all still seemed to pass.  I'm running through all the tests right now but that will take a while to finish.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-07-02T12:40:50.644+0000","updated":"2015-07-02T12:40:50.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14611912","id":"14611912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I was testing a similar fix last night, guess I should have assigned this one to myself to avoid duplication of effort, oops.  So I made basically the same change although I tried to ensure that a valid context was always passed along by checking that the context in the sub was non-null and using the pass in context if none was supplied in the subscription.\n\n{code}\n        ConnectionContext originalContext = sub.getContext() != null ? sub.getContext() : context;\n{code}\n\nFrom a run of the tests with this change I didn't see any new failures so I don't think there are any hidden surprises.  If you want to update your PR and do some additional sanity checks we can just push that.\n\nI also created a simpler OpenWire only test since this actually affects any client connection which I will show below:\n\n{code}\n/**\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.apache.activemq.bugs;\n\nimport static org.junit.Assert.assertNotNull;\n\nimport java.net.URI;\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport javax.jms.Connection;\nimport javax.jms.ConnectionFactory;\nimport javax.jms.MessageConsumer;\nimport javax.jms.MessageProducer;\nimport javax.jms.Session;\nimport javax.jms.Topic;\n\nimport org.apache.activemq.ActiveMQConnectionFactory;\nimport org.apache.activemq.broker.BrokerPlugin;\nimport org.apache.activemq.broker.BrokerService;\nimport org.apache.activemq.broker.TransportConnector;\nimport org.apache.activemq.filter.DestinationMapEntry;\nimport org.apache.activemq.security.AuthenticationUser;\nimport org.apache.activemq.security.AuthorizationEntry;\nimport org.apache.activemq.security.AuthorizationPlugin;\nimport org.apache.activemq.security.DefaultAuthorizationMap;\nimport org.apache.activemq.security.SimpleAuthenticationPlugin;\nimport org.junit.After;\nimport org.junit.Before;\nimport org.junit.Test;\n\npublic class AMQ5814Test {\n\n    private BrokerService brokerService;\n    private String openwireClientUrl;\n\n    public BrokerPlugin configureAuthentication() throws Exception {\n        List<AuthenticationUser> users = new ArrayList<>();\n        users.add(new AuthenticationUser(\"publisher\", \"123\", \"publisher\"));\n        users.add(new AuthenticationUser(\"subscriber\", \"123\", \"subscriber\"));\n        users.add(new AuthenticationUser(\"admin\", \"123\", \"publisher,subscriber\"));\n\n        SimpleAuthenticationPlugin authenticationPlugin = new SimpleAuthenticationPlugin(users);\n\n        return authenticationPlugin;\n    }\n\n    public BrokerPlugin configureAuthorization() throws Exception {\n\n        @SuppressWarnings(\"rawtypes\")\n        List<DestinationMapEntry> authorizationEntries = new ArrayList<>();\n\n        AuthorizationEntry entry = new AuthorizationEntry();\n        entry.setTopic(\"dcu.>\");\n        entry.setRead(\"subscriber\");\n        entry.setWrite(\"publisher\");\n        entry.setAdmin(\"publisher,subscriber\");\n        authorizationEntries.add(entry);\n\n        entry = new AuthorizationEntry();\n        entry.setTopic(\"ActiveMQ.Advisory.>\");\n        entry.setRead(\"publisher,subscriber\");\n        entry.setWrite(\"publisher,subscriber\");\n        entry.setAdmin(\"publisher,subscriber\");\n        authorizationEntries.add(entry);\n\n        DefaultAuthorizationMap authorizationMap = new DefaultAuthorizationMap(authorizationEntries);\n        AuthorizationPlugin authorizationPlugin = new AuthorizationPlugin(authorizationMap);\n\n        return authorizationPlugin;\n    }\n\n    @Before\n    public void setup() throws Exception {\n\n        TransportConnector openwireConnector = new TransportConnector();\n        openwireConnector.setUri(new URI(\"tcp://localhost:0\"));\n        openwireConnector.setName(\"openwire\");\n\n        ArrayList<BrokerPlugin> plugins = new ArrayList<>();\n        plugins.add(configureAuthentication());\n        plugins.add(configureAuthorization());\n\n        brokerService = new BrokerService();\n        brokerService.setPersistent(false);\n        brokerService.addConnector(openwireConnector);\n        if (!plugins.isEmpty()) {\n            BrokerPlugin[] array = new BrokerPlugin[plugins.size()];\n            brokerService.setPlugins(plugins.toArray(array));\n        }\n        brokerService.start();\n        brokerService.waitUntilStarted();\n\n        openwireClientUrl = openwireConnector.getPublishableConnectString();\n    }\n\n    @After\n    public void shutdown() throws Exception {\n        if (brokerService != null) {\n            brokerService.stop();\n            brokerService.waitUntilStopped();\n            brokerService = null;\n        }\n    }\n\n    @Test(timeout=30000)\n    public void testProduceConsumeWithAuthorization() throws Exception {\n        ConnectionFactory factory = new ActiveMQConnectionFactory(openwireClientUrl);\n        Connection connection1 = factory.createConnection(\"subscriber\", \"123\");\n        Session session1 = connection1.createSession(false, Session.AUTO_ACKNOWLEDGE);\n        Topic wildCarded = session1.createTopic(\"dcu.>\");\n        MessageConsumer consumer = session1.createConsumer(wildCarded);\n        connection1.start();\n\n        Connection connection2 = factory.createConnection(\"publisher\", \"123\");\n        Session session2 = connection2.createSession(false, Session.AUTO_ACKNOWLEDGE);\n        Topic named = session2.createTopic(\"dcu.id\");\n        MessageProducer producer = session2.createProducer(named);\n        producer.send(session2.createTextMessage(\"test\"));\n\n        assertNotNull(consumer.receive(2000));\n\n        connection1.close();\n        connection2.close();\n    }\n}\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-07-02T12:55:05.904+0000","updated":"2015-07-02T12:55:05.904+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14611945","id":"14611945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Not a problem, I only spent a few minutes on this as it was only a one line fix.  Since you created the OpenWire test I'll let you go ahead and push up the fix and I'll close my PR.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-07-02T13:23:20.396+0000","updated":"2015-07-02T13:23:20.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14611948","id":"14611948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user cshannon closed the pull request at:\n\n    https://github.com/apache/activemq/pull/125\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-02T13:24:42.399+0000","updated":"2015-07-02T13:24:42.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14612093","id":"14612093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Fix and test added on master ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-07-02T15:41:19.302+0000","updated":"2015-07-02T15:41:19.302+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833667/comment/14612745","id":"14612745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"body":"Hey [~tabish121], [~christopher.l.shannon],\n\nIt's working fine now. When is it released or a nightly build version? I'm looking forward to it.\nThanks!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hongphu8790","name":"hongphu8790","key":"hongphu8790","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PhuNH5-VTICT","active":true,"timeZone":"Asia/Ho_Chi_Minh"},"created":"2015-07-03T01:45:42.862+0000","updated":"2015-07-03T01:45:42.862+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5814/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2fczj:"}}