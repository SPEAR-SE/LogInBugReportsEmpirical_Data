{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483095","self":"https://issues.apache.org/jira/rest/api/2/issue/12483095","key":"AMQ-2676","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-26T16:29:09.908+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Aug 09 15:56:06 UTC 2010","customfield_12310420":"74850","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_11757745284_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-08-09T15:56:06.752+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2676/watchers","watchCount":0,"isWatching":false},"created":"2010-03-26T13:53:41.468+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-08-09T15:56:06.713+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We are trying to use an inbound and outbound queue on a remote ActiveMQ instance using XA transactions.\nReceiving seems to work ok, but when we send a message, the ActiveMQ RA gives an exception saying that the session is not 'enlisted to a distributed transaction'.\n\nIf we use JBoss Messaging, there is no exception, but the thread on this forum http://community.jboss.org/thread/149573 gives me the impression that JBMQ just works without the transaction in that situation, without throwing an exception.\n\nTo work around a classcastexception on the QueueConnectionFactory we use a patched version of the activemq-rar-adapter (see also https://issues.apache.org/activemq/browse/AMQ-2670).\n\nhis is the test application & configuration.\n\nTo set it up, a regular JBoss 5.1.0-GA can be used (compiled for java 6).\n\nChanges in configuration:\n- unzipped activemq-rar (5.3.0), with the new class I wrote as a 'hack'.\nThe ra.xml is attached to this message, as is the replacement for the jar \n\n jbossts-properties.xml - Has the ActiveMQProvider registered for XA recovery purposes\n\n activemq-jms-ds.xml, must be placed in the deploy folder\n\nTest application:\n\nI commented out the persistence stuff, that is not related to the issue.\nThe application deploys a MDB and a SLSB. For running the test, you need an ActiveMQ instance on localhost :61616 (default)\nTo get the error, you can call the SLSB directly (see Test.java, put jboss-all-client.jar on the cp and the ejbjar).\nThe helloWorld method sends to ActiveMQ.\nThe sendJBoss method uses a JBoss Messaging Queue (this doesn't give the Exception, but I'm not sure that this means it actually runs in a XA transaction)\n\nTo deploy the JBoss queue, you need to add this fragment to the 'deploy/messaging/destinations-service.xml':\n  <mbean code=\"org.jboss.jms.server.destination.QueueService\"\n     name=\"jboss.messaging.destination:service=Queue,name=DemoQueue\"\n     xmbean-dd=\"xmdesc/Queue-xmbean.xml\">\n     <depends optional-attribute-name=\"ServerPeer\">jboss.messaging:service=ServerPeer</depends>\n     <depends>jboss.messaging:service=PostOffice</depends>\n  </mbean>\n\nThe rar_performance.ear is the compiled testcase.\nTo rebuild, unzip the 'simple_ejb_testcase' and perform a mvn install in te 'simple_mdb' folder and in the 'simple_mdb_ear' folder (there is no parent pom.xml).\n\nThe exception:\n11:56:28,851 ERROR [STDERR] javax.jms.JMSException: Session's XAResource has not been enlisted in a distributed transaction.\n11:56:28,852 ERROR [STDERR]     at org.apache.activemq.ActiveMQXASession.doStartTransaction(ActiveMQXASession.java:109)\n11:56:28,852 ERROR [STDERR]     at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1636)\n11:56:28,852 ERROR [STDERR]     at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:231)\n11:56:28,852 ERROR [STDERR]     at org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:241)\n11:56:28,852 ERROR [STDERR]     at gts.ise.refdata.domain.complexinstrument.HelloBean.helloWorld(HelloBean.java:46)\n11:56:28,852 ERROR [STDERR]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n11:56:28,852 ERROR [STDERR]     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n11:56:28,852 ERROR [STDERR]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n11:56:28,852 ERROR [STDERR]     at java.lang.reflect.Method.invoke(Method.java:597)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461636","id":"12461636","filename":"activemq-jms-ds.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-26T13:55:48.362+0000","size":2826,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461636/activemq-jms-ds.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461635","id":"12461635","filename":"activemq-ra-5.3.0.jar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-26T13:55:48.340+0000","size":87066,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461635/activemq-ra-5.3.0.jar"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461637","id":"12461637","filename":"jbossts-properties.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-26T13:55:48.365+0000","size":15163,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461637/jbossts-properties.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461638","id":"12461638","filename":"ra.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-26T13:56:50.713+0000","size":21176,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461638/ra.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461639","id":"12461639","filename":"rar_performance.ear","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-26T13:56:50.768+0000","size":703331,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461639/rar_performance.ear"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461640","id":"12461640","filename":"simpl_ejb_testcase.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-26T13:56:50.771+0000","size":31943,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461640/simpl_ejb_testcase.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"159903","customfield_12312823":null,"summary":"Exception sending to an ActiveMQ queue from JBoss in an XA Transaction","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483095/comment/12942298","id":"12942298","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"body":"Test code (client calling a remote session bean):\n\npublic class Test {\n\n   public static void main(String arg[]) throws NamingException {\n      Hashtable<String, String> props = new Hashtable<String, String>();\n\n      props.put(\"java.naming.factory.initial\", \"org.jnp.interfaces.NamingContextFactory\");\n      props.put(\"java.naming.factory.url.pkgs\",\"org.jboss.naming:org.jnp.interfaces\");\n      props.put(\"java.naming.provider.url\",\"localhost:1099\");\n      InitialContext context = new InitialContext(props);\n      HelloRemote remote = (HelloRemote) context.lookup(\"/rar_performance/HelloBean/remote\");\n\n      remote.helloWorld();\n   }\n}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-26T13:59:31.575+0000","updated":"2010-03-26T13:59:31.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483095/comment/12942304","id":"12942304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"with the vanilla 5.3.1 rar, this works fine for me. The rar connection factory is enlisted in the XA transaction. It must be the mods to the rar to support the transaction recovery processing that is problematic.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-26T16:29:09.908+0000","updated":"2010-03-26T16:29:09.908+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483095/comment/12942278","id":"12942278","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"body":"Yes, it looks like I was too focused on getting the integration with the recovery manager working.\nWe should probably remove those changes and find another way to get that part working.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edwin%40finalist.com","name":"edwin@finalist.com","key":"edwin@finalist.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin van der Elst","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-29T07:26:47.040+0000","updated":"2010-03-29T07:26:47.040+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483095/comment/12939319","id":"12939319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"https://issues.apache.org/activemq/browse/AMQ-2670 sorts this issue out. Please reopen if this is not the case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-09T15:56:06.658+0000","updated":"2010-08-09T15:56:06.658+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2676/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rqaf:"}}