{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482795","self":"https://issues.apache.org/jira/rest/api/2/issue/12482795","key":"AMQ-1601","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-01-30T16:22:36.101+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 30 16:26:50 UTC 2009","customfield_12310420":"84808","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_29353952428_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-01-30T16:26:50.990+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1601/watchers","watchCount":0,"isWatching":false},"created":"2008-02-25T22:34:18.562+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[{"id":"12334987","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334987","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12482763","key":"AMQ-2087","self":"https://issues.apache.org/jira/rest/api/2/issue/12482763","fields":{"summary":"Redelivery after rollback does not seem to work well ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-01-30T16:26:50.989+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10092","value":"Unit Test Broken","id":"10092"}],"description":"1) Unzip attachment into a directory\n2) Edit build.xml and change activemq.home to point to your ActiveMQ distribution\n3) Run \"ant\" and observe that one of the 2 JUnit tests fail\n4) Refer to test-report for information about the failure\n\nThe first JUnit test creates a temporary broker and submits a single message to the queue \"test.queue\".  It then creates a transacted message consumer that retrieves the message, prints out details about it, and then rollsback and closes the session.  Subsequent retries by the consumer verify that the message is redelivered up to the MAX_REDELIVERIES constant in RedeliveryRollbackTest.java.  Finally, the test verifies that after MAX_REDELIVERIES, test.queue is empy (i.e., the message has been recognized as a poison pill).\n\nThe second JUnit test performs the same sequence of operations, but instead of explicitly rolling back the session, it just closes the session.  According to the JavaDoc for javax.jms.session#close():\n\nhttp://java.sun.com/j2ee/sdk_1.3/techdocs/api/index.html\n\n\"Closing a transacted session must roll back the transaction in progress. \"\n\nIn other words, I was expecting the behaviour to be the same for both test cases.  However, although the delivery count is updated on the message, it continues to get delivered regardless of the MAX_REDELIVERIES setting.\n\nADDITIONAL CONCERN\n---------------------------------\nObserve the console output of the tests and note how the delivery count increments by two for the test that works, but only by one for the test that doesn't:\n\nAttempt 1\nReceived message id=ID:schow-desktop-4347-1203977945999-2:0:1:1:1, redelivered=false, delivery count=1\nAttempt 2\nReceived message id=ID:schow-desktop-4347-1203977945999-2:0:1:1:1, redelivered=true, delivery count=3\nAttempt 3\nReceived message id=ID:schow-desktop-4347-1203977945999-2:0:1:1:1, redelivered=true, delivery count=5\nAttempt 4\nReceived message id=ID:schow-desktop-4347-1203977945999-2:0:1:1:1, redelivered=true, delivery count=7\nAttempt 5\nNo message available.\nAttempt 1\nReceived message id=ID:schow-desktop-4347-1203977945999-2:1:1:1:1, redelivered=false, delivery count=1\nAttempt 2\nReceived message id=ID:schow-desktop-4347-1203977945999-2:1:1:1:1, redelivered=true, delivery count=2\nAttempt 3\nReceived message id=ID:schow-desktop-4347-1203977945999-2:1:1:1:1, redelivered=true, delivery count=3\nAttempt 4\nReceived message id=ID:schow-desktop-4347-1203977945999-2:1:1:1:1, redelivered=true, delivery count=4\nAttempt 5\nReceived message id=ID:schow-desktop-4347-1203977945999-2:1:1:1:1, redelivered=true, delivery count=5","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461070","id":"12461070","filename":"ASF.LICENSE.NOT.GRANTED--ActiveMQTest.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stirlingc","name":"stirlingc","key":"stirlingc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stirling Chow","active":true,"timeZone":"Etc/UTC"},"created":"2008-02-25T22:34:18.713+0000","size":8161,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461070/ASF.LICENSE.NOT.GRANTED--ActiveMQTest.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"255116","customfield_12312823":null,"summary":"maximumRedeliveries not honoured when transacted session is closed without explicit rollback","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stirlingc","name":"stirlingc","key":"stirlingc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stirling Chow","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stirlingc","name":"stirlingc","key":"stirlingc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stirling Chow","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP SP2, Sun JDK 1.5.0_8","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482795/comment/12940711","id":"12940711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"similar issue and the fix is relevant.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-30T16:22:36.101+0000","updated":"2009-01-30T16:22:36.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482795/comment/12940716","id":"12940716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"this issue is resolved on trunk, see the resolution to the linked issue.\n\nRe the test case: I made the following small changes, diff:\n{code}53c53\n< \t\tfor (int attempt = 1; attempt <= MAX_REDELIVERIES; attempt++) {\n---\n> \t\tfor (int attempt = 0; attempt <= MAX_REDELIVERIES; attempt++) {\n59c59\n< \t\t\t\tif (attempt < MAX_REDELIVERIES) {\n---\n> \t\t\t\tif (attempt <= MAX_REDELIVERIES) {\n78c78\n< \t\tfor (int attempt = 1; attempt <= MAX_REDELIVERIES; attempt++) {\n---\n> \t\tfor (int attempt = 0; attempt <= MAX_REDELIVERIES; attempt++) {\n84c84\n< \t\t\t\tif (attempt < MAX_REDELIVERIES) {\n---\n> \t\t\t\tif (attempt <= MAX_REDELIVERIES) {\n{code}\nas you need to exceed the max deliveries to get a null message. But with these changes it works on trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-30T16:26:50.982+0000","updated":"2009-01-30T16:26:50.982+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1601/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i181xr:"}}