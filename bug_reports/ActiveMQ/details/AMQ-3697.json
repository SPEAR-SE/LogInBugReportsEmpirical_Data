{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12541252","self":"https://issues.apache.org/jira/rest/api/2/issue/12541252","key":"AMQ-3697","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2012-02-05T15:28:54.964+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jun 12 21:14:33 UTC 2012","customfield_12310420":"226604","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_11080605399_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-06-12T21:14:33.672+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3697/watchers","watchCount":1,"isWatching":false},"created":"2012-02-05T15:17:48.544+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318549","id":"12318549","name":"5.5.1","archived":false,"released":true,"releaseDate":"2011-10-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-06-12T21:14:33.938+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I am using ActiveMQ 5.5.1 and sometimes messages are not dispatched to connected consumers. \n\nA single broker is used. No transaction and no persistence is used for message delivery. Message consumers are spring template made for topic consuption. Optimize acknowledge is enabled and acknowledgment is auto.\n\nBy Looking at JMX Topic MBean I can see that messages are received but not dispatched (and of course non depueued). I noticed that disptatched count was 100 more than dequeue count.\n\nFrom JMX : \n* Received count : 4502\n* Dispatched count : 3756\n* Dequeued count : 3656\n\nIf a start a new consumer on the same topic, the messages are only dispatched to the new consumer while the older one is still seen as connected (consumer count on the mbean is 2). Once the problem appear the only solution is to restart the consumer or the activemq instance.\n\nIt seems that even if the consumer is seen as connected, messages as not dispatched for an unknow reason. \n\nWhich logs can I enable in order to diagnose the problem (on activemq side and/or consumer side) ? I have already made a thread dump, not thread are blocke","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172241","customfield_12312823":null,"summary":"Messages not delivered to connecter consumer","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"SunOS 5.10 Generic_142909-17 sun4v sparc SUNW,T5140\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541252/comment/13200791","id":"13200791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You should try using an ActiveMQ 5.6-SHAPSHOT, or the latest FuseSource 5.5.1 release which incorporates many of the latest fixes to see if the problem is still present.  Creating a test case that reproduces the problem would also be helpful.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-02-05T15:28:54.964+0000","updated":"2012-02-05T15:28:54.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541252/comment/13200797","id":"13200797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"body":"Ok but does 5.6.0 is suitable for production ?\n\nI have patched my 5.5.1 version with AMQ-3454 for performance reasons. Does this fix is included in FuseSource 5.5.1 ?\n\nAnd alseo what is the difference between ActiveMQ and FuseSource ?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-05T16:17:57.451+0000","updated":"2012-02-05T16:17:57.451+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541252/comment/13201348","id":"13201348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"body":"I am able to reproduce the problem. The scenario is the following.\n\nSend a lot of messages, let's say hundreds very quickly on one topic with one consumer. Messages are consumed and suddently (I think when the send rate is too high)  messages stopped to be consume. I run the debugger and I can see that when the prefetch size is higher than the dispatched count the topic is condiered as full and messages are not dispatched to the consumer.\n\nThe situation can only get back to normal when the consumer is restarted because the counters change.\n\nSo Here are my questions : \n\n* What does dispatchCount, dequeueCount, etc mean ? \n* Do I have to adjust message acknowledgement and prefetch size ?\n* Does the fact that dequeue count never increase means that the consumers are blocked ?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-06T15:35:13.854+0000","updated":"2012-02-06T15:35:13.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541252/comment/13201409","id":"13201409","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"body":"I think my consumers are considered as durable consumers but I have configured my broker to be non persistent => so prefetch limit is 100.\n\nHow shoud I configure my consumer to be a non durable consumer ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-06T17:23:50.448+0000","updated":"2012-02-06T17:24:00.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541252/comment/13204375","id":"13204375","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"body":"I changed my config in order to not reach the prefetch limit (limit is very high) and put a thread pool in order to process messages on the consumer side (the message listener only submit a task to the thread pool and ack).\n\nDid you have any issue about a consumer that stop sendings acks ? From my understanding the only thing that can make the broker buffer messages is that the acks are not send back, am I right ?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=williamd","name":"williamd","key":"williamd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-09T09:10:01.707+0000","updated":"2012-02-09T09:10:01.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541252/comment/13215999","id":"13215999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Would be interesting if you could create a junit test case that can reproduce your issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-02-24T22:26:20.459+0000","updated":"2012-02-24T22:26:20.459+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541252/comment/13254540","id":"13254540","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Acks do not seem to be sent by the consumer in this scenario - we need a test case to see why this is happening - downgrading to major as this looks like a client implementation problem","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-16T06:49:47.044+0000","updated":"2012-04-16T06:49:47.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541252/comment/13293927","id":"13293927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Not test case provided and am not able to reproduce it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-06-12T21:14:33.892+0000","updated":"2012-06-12T21:14:33.892+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3697/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tufz:"}}