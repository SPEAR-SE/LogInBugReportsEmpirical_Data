{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12656340","self":"https://issues.apache.org/jira/rest/api/2/issue/12656340","key":"AMQ-4619","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316331","id":"12316331","description":"Next unplanned v5 maintenance release","name":"5.x","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-07-05T09:07:07.874+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 09 01:26:39 UTC 2013","customfield_12310420":"336563","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4619/watchers","watchCount":5,"isWatching":false},"created":"2013-07-05T08:44:15.961+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["security"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":259200,"aggregatetimeoriginalestimate":259200,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-09T01:26:39.360+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":259200,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":" There are two activemq instance in my pc, they are in  Shared File System Master/Slave with kahaDB model. \n1 set up the consumer listener and  receive message use failover protocol .\n2 set up the producer to send message use failover protocol. the message total is 6000.\n3 close the master actviemq , so the slave can replace the master to work.\nrepeat the step 3 many times (more than 5) and quickly.\n\nresult:\n1 the producer will throw exception several times:\njavax.jms.TransactionRolledBackException: Transaction completion in doubt due to failover. Forcing rollback of TX:ID:wcmis175-55198-1372489851858-1:1:643\n                at org.apache.activemq.state.ConnectionStateTracker.restoreTransactions(ConnectionStateTracker.java:231)\n                at org.apache.activemq.state.ConnectionStateTracker.restore(ConnectionStateTracker.java:169)\n                at org.apache.activemq.transport.failover.FailoverTransport.restoreTransport(FailoverTransport.java:821)\n                at org.apache.activemq.transport.failover.FailoverTransport.doReconnect(FailoverTransport.java:996)\n                at org.apache.activemq.transport.failover.FailoverTransport$2.iterate(FailoverTransport.java:143)\n                at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:129)\n                at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:47)\n                at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n                at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n                at java.lang.Thread.run(Thread.java:722)\n\n2 sometimes it will lose messages in consumer side (for example producer send 6000 messages ,throw 8 exceptions , the consumer will receive 5998 messages).I don't know where the lost messages going.\n\n\nSo ,I think this bug is dangerous if it was really exsit. Sometimes we must use failover switch the master and slave,and we don't want to face losing messages.\n","customfield_10010":null,"timetracking":{"originalEstimate":"72h","remainingEstimate":"72h","originalEstimateSeconds":259200,"remainingEstimateSeconds":259200},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":259200,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"336887","customfield_12312823":null,"summary":"lose messages in  Shared File System Master/Slave while swich master to slave quickly and many times","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zachary880914%40163.com","name":"zachary880914@163.com","key":"zachary880914@163.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zachary.zhang","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zachary880914%40163.com","name":"zachary880914@163.com","key":"zachary880914@163.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zachary.zhang","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":259200,"percent":0},"customfield_12311024":null,"environment":"pc(computer), windows 7(os), Shared File System Master/Slave","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":259200,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656340/comment/13700551","id":"13700551","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"body":"Your client can not ensure if the transaction is successful or not since it cannot receive a response of the commit request from the broker when fail over happens.The exception message 'Transaction completion in doubt due to failover' has told you that the transaction completion is in doubt and now it's up to you to decide what to do next. You can continue to start a new transaction to resend messages, but you may see duplicate messages in your consumer.\nYou can also just ignore it but you may lose messages in the doubt transaction.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2013-07-05T09:07:07.874+0000","updated":"2013-07-05T09:07:07.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656340/comment/13702748","id":"13702748","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zachary880914%40163.com","name":"zachary880914@163.com","key":"zachary880914@163.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zachary.zhang","active":true,"timeZone":"Etc/UTC"},"body":"In our scenario, there are many consumers to receive messages,if we send duplicate messages  or losing messages,there isn't a good way to make consumers to know which message is duplicate or losing.\nI noticed there is a rollback methed in session.I plan to use it when producer throw exception,then resend message ,so the consumer can receive messages perfectly neither more or less. However, after I tested, the rollback methed can't destroy the message ,it worked not  as JDBC rollback. Is there something wrong in this solution? \nThanks for your help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zachary880914%40163.com","name":"zachary880914@163.com","key":"zachary880914@163.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zachary.zhang","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-09T01:26:39.360+0000","updated":"2013-07-09T01:26:39.360+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4619/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1m1y7:"}}