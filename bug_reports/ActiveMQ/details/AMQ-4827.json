{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12675866","self":"https://issues.apache.org/jira/rest/api/2/issue/12675866","key":"AMQ-4827","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2013-10-31T14:48:25.011+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Oct 31 18:37:25 UTC 2013","customfield_12310420":"355364","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_518267059_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-10-31T18:37:25.424+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4827/watchers","watchCount":3,"isWatching":false},"created":"2013-10-25T18:39:38.391+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321258","id":"12321258","description":"Next v5 maintenance release","name":"5.7.0","archived":false,"released":true,"releaseDate":"2012-10-08"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-10-31T18:37:25.447+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Configuration:\nconnectionUri=tcp://localhost:61616?jms.prefetchPolicy.queuePrefetch=1&keepAlive=true\n\nactivemq.conf is default with no changes\n\nScenario:\nSent 7 different messages to the same queue. With prefetch=1 about 1 or 2 messages would get stuck in the queue everytime. After a restart of activemq the messages that were stuck in queue would be processed.\n\nWith cachingConsumers=false the messages would not get stuck.\n\nWe need cachingConsumers for better performance so setting it to false is not an option for us.\n\nHere is a thread that is very similar to the issue.\nhttp://activemq.2283324.n4.nabble.com/Messages-stuck-in-queue-td3244342.html\n\nThank you for your time and consideration.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"355652","customfield_12312823":null,"summary":"Set jms.queuePrefetch=1 Causes Messages To Be Stuck in Queue","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yung5027","name":"yung5027","key":"yung5027","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yung Lai","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yung5027","name":"yung5027","key":"yung5027","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yung Lai","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12675866/comment/13810309","id":"13810309","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Have you tried setting prefetch to zero to prevent cached consumers from holding a message in its prefetch buffer, that's the most common cause when people report stuck messages.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-10-31T14:48:25.011+0000","updated":"2013-10-31T14:48:25.011+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12675866/comment/13810381","id":"13810381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ben.truitt","name":"ben.truitt","key":"ben.truitt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Truitt","active":true,"timeZone":"Etc/UTC"},"body":"Hi Timothy - thanks for your response.  I am a colleague of Yung's so I'll jump in.  \n\nWe have tried setting prefetch size to 0 as you suggest, and yes that does solve the issue.  However, performance degrades to an unacceptable degree when we reduce prefetch size to 0 (from 1).  A few more facts, in case they are useful:\n* We use transacted routes\n* We are using durable queues\n* We use caching consumers for performance reasons\n* We use prefetch = 1 for performance reasons...we found no significant improvement for values greater than 1, but when set to 0, performance is much worse.\n\nWe did read in the ActiveMQ documentation (http://activemq.apache.org/what-is-the-prefetch-limit-for.html) that pooled / cached consumers should not use prefetch greater than 0 for exactly the reason we are reporting here.  \n\nSo to clarify this purpose of this bug report, we aren't really asking why this is happening, but whether there is some additional setting we can use to prevent messages from being stuck, while preserving the high performance we get from cached consumers + prefetch.\n\nFor example, ActiveMQ 5.9 introduces AbortSlowAckConsumerStrategy (http://java.dzone.com/articles/coming-activemq-59-new-way).  I believe this is probably the solution to this \"bug\" report.  Does that seem right to you?   If so, we'd like to humbly suggest updating the documentation about prefetch with pooled consumers (http://activemq.apache.org/what-is-the-prefetch-limit-for.html) to note that this can be used to prevent stuck messages.  If it won't work, can you please help us understand why not? \n\nThanks in advance for your help!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ben.truitt","name":"ben.truitt","key":"ben.truitt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Truitt","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-31T16:04:19.540+0000","updated":"2013-10-31T16:04:19.540+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12675866/comment/13810396","id":"13810396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Yes, if you must use prefetch then you would need to configure the abort strategy to kill off those Idle consumers after some period of time (the correct amount depends on your needs so its up to you to determine that).  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-10-31T16:14:36.153+0000","updated":"2013-10-31T16:14:36.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12675866/comment/13810408","id":"13810408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ben.truitt","name":"ben.truitt","key":"ben.truitt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Truitt","active":true,"timeZone":"Etc/UTC"},"body":"Awesome. Thanks for the fast response!  \n\nIn that case, we may want to convert this bug report to a request to improve the documentation at http://activemq.apache.org/what-is-the-prefetch-limit-for.html to include the information at http://java.dzone.com/articles/coming-activemq-59-new-way. \n\nThanks again.\n-Ben","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ben.truitt","name":"ben.truitt","key":"ben.truitt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Truitt","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-31T16:26:24.314+0000","updated":"2013-10-31T16:26:24.314+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12675866/comment/13810535","id":"13810535","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Issue can be resolved with the AbortSlowAckConsumerStrategy or by setting prefetch to zero.  Update page adding a link to the API docs for the strategy.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-10-31T18:37:25.444+0000","updated":"2013-10-31T18:37:25.444+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4827/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1p9if:"}}