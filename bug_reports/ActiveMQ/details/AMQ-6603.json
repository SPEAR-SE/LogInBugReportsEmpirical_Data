{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13043574","self":"https://issues.apache.org/jira/rest/api/2/issue/13043574","key":"AMQ-6603","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338054","id":"12338054","name":"5.15.0","archived":false,"released":true,"releaseDate":"2017-07-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339772","id":"12339772","name":"5.14.5","archived":false,"released":true,"releaseDate":"2017-04-16"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-02-22T14:01:58.592+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 01 16:45:22 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1126789294_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-03-01T10:41:56.472+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6603/watchers","watchCount":5,"isWatching":false},"created":"2017-02-16T09:42:07.241+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338822","id":"12338822","name":"5.14.3","archived":false,"released":true,"releaseDate":"2016-12-22"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-04-11T16:12:44.351+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When {{PooledConnectionFactory}} is used with Failover transport, insufficient access control settings on the broker result in an excessive number of consumer objects on the broker once the access control settings are properly set. \n\nHere is an example Spring XML configuration:\n\n{code:xml}\n<beans ...>\n\n  <bean id=\"jmsConnectionFactory\" class=\"org.apache.activemq.ActiveMQConnectionFactory\">\n    <property name=\"brokerURL\" value=\"failover:(tcp://localhost:61616)\" />\n    <property name=\"userName\" value=\"test\" />\n    <property name=\"password\" value=\"test\" />\n  </bean>\n\n  <bean id=\"pooledConnectionFactory\" class=\"org.apache.activemq.pool.PooledConnectionFactory\">\n    <property name=\"connectionFactory\" ref=\"jmsConnectionFactory\" />\n    <property name=\"maxConnections\" value=\"10\" />\n  </bean>\n\n  <bean id=\"jmsContainer\" class=\"org.springframework.jms.listener.DefaultMessageListenerContainer\">\n    <property name=\"connectionFactory\" ref=\"pooledConnectionFactory\" />\n    <property name=\"destinationName\" value=\"TEST\" />\n    <property name=\"messageListener\" ref=\"messageListener\" />\n    <property name=\"concurrentConsumers\" value=\"10\" />\n  </bean>\n\n  <bean id=\"messageListener\" class=\"com.redhat.issues.amq.SpringJmsConsumer\" />\n\n</beans>\n{code}\n\nIn this configuration we expect only one connection and 10 consumers for {{TEST}} queue, but after following the reproducer steps we see around 10 connections and 100 consumers for the queue on hawtio. In the above configuration Spring DMLC is used but we can reproduce the issue without Spring.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12855038","id":"12855038","filename":"pooled-amq-client.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tadayosi","name":"tadayosi","key":"tadayosi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tadayosi&avatarId=26150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tadayosi&avatarId=26150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tadayosi&avatarId=26150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tadayosi&avatarId=26150"},"displayName":"Tadayoshi Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2017-02-28T01:43:47.280+0000","size":8104,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12855038/pooled-amq-client.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12853020","id":"12853020","filename":"spring-amq-client.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tadayosi","name":"tadayosi","key":"tadayosi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tadayosi&avatarId=26150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tadayosi&avatarId=26150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tadayosi&avatarId=26150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tadayosi&avatarId=26150"},"displayName":"Tadayoshi Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2017-02-16T10:00:32.052+0000","size":8958,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12853020/spring-amq-client.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Excessive number of consumers when used with PooledConnectionFactory and Failover transport","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tadayosi","name":"tadayosi","key":"tadayosi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tadayosi&avatarId=26150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tadayosi&avatarId=26150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tadayosi&avatarId=26150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tadayosi&avatarId=26150"},"displayName":"Tadayoshi Sato","active":true,"timeZone":"Asia/Tokyo"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tadayosi","name":"tadayosi","key":"tadayosi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tadayosi&avatarId=26150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tadayosi&avatarId=26150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tadayosi&avatarId=26150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tadayosi&avatarId=26150"},"displayName":"Tadayoshi Sato","active":true,"timeZone":"Asia/Tokyo"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":"https://issues.jboss.org/browse/ENTESB-6505","duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15869658","id":"15869658","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tadayosi","name":"tadayosi","key":"tadayosi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tadayosi&avatarId=26150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tadayosi&avatarId=26150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tadayosi&avatarId=26150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tadayosi&avatarId=26150"},"displayName":"Tadayoshi Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"Reproducer {{spring-amq-client.zip}} attached.\n\nTo reproduce the issue:\n\n# Create broker {{sample-broker}}, apply the configurations: {{activemq.xml}}, {{users.properties}}, {{groups.properties}} and run it.\n# Run this project:\n{quote}\n$ mvn spring-boot:run\n{quote}\n# Change {{groups.properties}} to make user {{test}} belong to {{users}} instead of {{guests}} and restart the broker (while keep the reproducer project running):\n{quote}\nadmins=admin\nusers=test\n#guests=test\n{quote}\n# Check the number of consumers connecting to queue {{TEST}}. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tadayosi","name":"tadayosi","key":"tadayosi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tadayosi&avatarId=26150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tadayosi&avatarId=26150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tadayosi&avatarId=26150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tadayosi&avatarId=26150"},"displayName":"Tadayoshi Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2017-02-16T10:00:32.059+0000","updated":"2017-02-16T10:00:32.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15878255","id":"15878255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"I think the issue is with your configuration.  It usually doesn't make sense to use a connection pool with a DefaultMessageLIstenerContainer because you want to let the DefaultMessageListenerContainer do its own caching.  If you just pass a normal connection factory to the DefaultMessageListenerContainer then it should just create 1 connection and 10 consumers.\n\nFrom the Spring docs:\n\n\"Note: Don't use Spring's CachingConnectionFactory in combination with dynamic scaling. Ideally, don't use it with a message listener container at all, since it is generally preferable to let the listener container itself handle appropriate caching within its lifecycle. Also, stopping and restarting a listener container will only work with an independent, locally cached Connection - not with an externally cached one.\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2017-02-22T14:01:58.592+0000","updated":"2017-02-22T14:01:58.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15878259","id":"15878259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Also you said you could reproduce it without using Spring DMLC.  What was your setup in that case?  Something needs to be detecting the failed consumer/connections and trying to create new ones on ACL change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2017-02-22T14:05:08.722+0000","updated":"2017-02-22T14:05:08.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15887117","id":"15887117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tadayosi","name":"tadayosi","key":"tadayosi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tadayosi&avatarId=26150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tadayosi&avatarId=26150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tadayosi&avatarId=26150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tadayosi&avatarId=26150"},"displayName":"Tadayoshi Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"Hi [~cshannon],\n\nThank you for your comments, and sorry for my late response.\n\n{quote}\nI think the issue is with your configuration. It usually doesn't make sense to use a connection pool with a DefaultMessageLIstenerContainer because you want to let the DefaultMessageListenerContainer do its own caching.\n{quote}\n\nI can see your point, but one itchy situation about it is that Apache Camel has long been promoting the combination of {{PooledConnectionFactory}} + DMLC as the best practice ({{camel-jms}} is effectively just a DMLC inside).\nhttp://camel.apache.org/activemq.html#ActiveMQ-Usingconnectionpooling\n\nWe could say that Apache Camel has been wrong on this, but please note that the issue happens only when a {{failover:\\(...)}} broker URL is used with {{ActiveMQConnectionFactory}} and for a plain {{tcp://...}} URL we see no issues even with the above combination. That's why I think there might be something that can be improved in ActiveMQ side (especially between {{PooledConnectionFactory}} and Failover transport).\n\nOr we could instead argue that the specific combination of Failover transport + PooledConnectionFactory + DMLC is evil; in this case, what do you think would be the correct configuration if users need to use Failover transport?\n\n{quote}\nIf you just pass a normal connection factory to the DefaultMessageListenerContainer then it should just create 1 connection and 10 consumers.\n{quote}\n\nYes, but then doesn't the number of connection instances grow proportionately to the number of DMLC instances used?  I think that's why people want to use {{PooledConnectionFactory}} in combination with DMLC (or {{camel-jms}}).\n\n{quote}\nAlso you said you could reproduce it without using Spring DMLC. What was your setup in that case? \n{quote}\n\nAttached {{pooled-amq-client.zip}} is a reproducer that doesn't use DMLC. I admit it's rather a contrived example and mostly just mimics what's being done inside DMLC, but it still reproduces the issue with only ActiveMQ.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tadayosi","name":"tadayosi","key":"tadayosi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tadayosi&avatarId=26150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tadayosi&avatarId=26150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tadayosi&avatarId=26150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tadayosi&avatarId=26150"},"displayName":"Tadayoshi Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2017-02-28T02:45:30.126+0000","updated":"2017-02-28T02:45:30.126+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15888131","id":"15888131","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Right, if you really want to share connections across multiple DMLCs then you'd still need a pooled factory.  I wouldn't say using failover + pooled factory + DMLC is necessarily evil...just that there's a lot going on there that could cause problems and it would simply things if you didn't use a pooled connection factory (such as if you were only a small number of DMLCs) unless you really need it.  And yes Spring doesn't really recommend doing it that way so if you can get away with creating 1 connection per DMLC then that is usually the way to go.\n\nThe use case should still work however and there is probably some improvement here that needs to be done in order to properly handle the failover case in this set up so that an excessive number of consumers don't get created.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2017-02-28T14:46:35.191+0000","updated":"2017-02-28T14:48:31.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15888349","id":"15888349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I think there is something in this. The consumer creation failing with an exception is not being tracked by the failover transport and when it reconnects, b/c the session is still present b/c it was pooled, it gets recreated along with the failed consumer.\nThe connection state tracker needs to respond to the failure to create the consumer such that it is not recreated on reconnect. I think.\nWill see if I can validate with that test code and peek at a possible fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-28T16:16:25.197+0000","updated":"2017-02-28T16:16:25.197+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15888416","id":"15888416","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Creation of MessageProducer would likely also suffer from this issue as it can also fail for security exceptions when access control prevents writes.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-02-28T16:46:02.534+0000","updated":"2017-02-28T16:46:02.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15888482","id":"15888482","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 8641928553e0f1d97416fd010c2f7d6f165b3660 in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8641928 ]\n\n[AMQ-6603] ensure failover does not track consumer creation that fails with an exception, fix and test. Thanks for the test Tadayoshi Sato\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-28T17:17:36.160+0000","updated":"2017-02-28T17:17:36.160+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15888497","id":"15888497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~tabish121] need to check if producers are cached by the pool but yep, would have the same problem. may be able to make the logic to deal with exceptions more generic.\nas as workaround for both, is it possible to have the connection pool not cache sessions in wonder?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-28T17:24:39.131+0000","updated":"2017-02-28T17:24:39.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15888515","id":"15888515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You can't currently cache sessions, and it'd probably be way more trouble than it's worth.  I believe there's two options for the producers in the pool, one cached anonymous producer or a cached producer for each destination that a producer is requested for.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-02-28T17:33:32.229+0000","updated":"2017-02-28T21:15:44.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15888882","id":"15888882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 90b808ab98b760f06885a5f45628353c9d2224f2 in activemq's branch refs/heads/master from [~tabish121]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=90b808a ]\n\nAMQ-6603 Stop tracking producer if creation failed\n\nTrack the message producer create and ensure it is not recreated on\nfailover if the creation resulted in an error response.  Add failover\nlevel tests to cover consumer and producer failed create tracking.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-28T21:17:41.824+0000","updated":"2017-02-28T21:17:41.824+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15888884","id":"15888884","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 5a52bf2a51909bcb2b4a7e5301e4bddf5aadb0c4 in activemq's branch refs/heads/activemq-5.14.x from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=5a52bf2 ]\n\n[AMQ-6603] ensure failover does not track consumer creation that fails with an exception, fix and test. Thanks for the test Tadayoshi Sato\n\n(cherry picked from commit 8641928553e0f1d97416fd010c2f7d6f165b3660)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-28T21:20:25.734+0000","updated":"2017-02-28T21:20:25.734+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15888885","id":"15888885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 4c5a70421c2ed39d0faeb78593728ac170812343 in activemq's branch refs/heads/activemq-5.14.x from [~tabish121]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4c5a704 ]\n\nAMQ-6603 Stop tracking producer if creation failed\n\nTrack the message producer create and ensure it is not recreated on\nfailover if the creation resulted in an error response.  Add failover\nlevel tests to cover consumer and producer failed create tracking.\n(cherry picked from commit 90b808ab98b760f06885a5f45628353c9d2224f2)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-28T21:20:29.338+0000","updated":"2017-02-28T21:20:29.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15889951","id":"15889951","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for the follow up [~tabish121] :-)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-01T10:41:56.512+0000","updated":"2017-03-01T10:41:56.512+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15890372","id":"15890372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit eab9a0d05758fd0e8e83e7e482f4f0406cd9af5e in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=eab9a0d ]\n\n[AMQ-6603] pull unnecessary guava dep from the new test\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-01T15:26:18.403+0000","updated":"2017-03-01T15:26:18.403+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13043574/comment/15890526","id":"15890526","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 2dfe0c7c291b5e1beca7ab80d6eea8639f070d6f in activemq's branch refs/heads/activemq-5.14.x from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2dfe0c7 ]\n\n[AMQ-6603] pull unnecessary guava dep from the new test\n\n(cherry picked from commit eab9a0d05758fd0e8e83e7e482f4f0406cd9af5e)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-01T16:45:22.944+0000","updated":"2017-03-01T16:45:22.944+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6603/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3a61j:"}}