{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12940190","self":"https://issues.apache.org/jira/rest/api/2/issue/12940190","key":"AMQ-6174","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2016-05-18T16:26:20.071+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Feb 06 14:22:56 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_30578611614_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-02-06T14:22:56.085+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6174/watchers","watchCount":8,"isWatching":false},"created":"2016-02-18T16:19:24.528+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329848","id":"12329848","name":"5.13.0","archived":false,"released":true,"releaseDate":"2015-12-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-02-06T14:22:56.138+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320200","id":"12320200","name":"activemq-leveldb-store","description":"LevelDB based message store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Currently I am testing the following setup:\n\nActiveMQ 5.13.0 with LevelDB (3 node cluster).\nZookeeper 3.4.6 (3 node cluster).\nFile system: NFSv3\n\nStarted up all 3 Zookeeper nodes. (aamqzk1, aamqzk2 and aamqzk3)\nStarted up all 5 ActiveMQ nodes. (aamql1, aamql2, aamql3, aamql4 and aamql5)\nI started aamql1 first and all others in order. aamql1 is the master and I am able to see all the queue statistics for aamql1 via ActiveMQ Web Console.\n\nI am also watching all 5 AMQ's \"application.log\" file using \"tail -f application.log‚Äù command.\n\nThe message producer starts sending messages (about 120,000 of them).  While the messages are being queued and also being consumed, I stopped the master instance (aamql1).  Now aamql2 becomes the master. About 10 seconds later after all the slave aamq reports to the new master, aamql2 throws the following exception and the instance dies.  This keeps repeating as it failover to the next instance.\n2016-02-17T15:43:48.358885-08:00 aamql2.bus.jetqa1.syseng.tmcs severity=INFO datetime=2016-02-17 15:43:48,354 thread=LevelDB IOException handler. category=org.apache.activemq.util.DefaultIOExceptionHandler Stopping BrokerService[localhost] due to exception, java.io.EOFException: File '/aamql/local/activemq/data/leveldb/0000000038409848.log' offset: 477491777\n2016-02-17T15:43:48.370881-08:00 aamql2.bus.jetqa1.syseng.tmcs java.io.EOFException: File '/aamql/local/activemq/data/leveldb/0000000038409848.log' offset: 477491777\n2016-02-17T15:43:48.371003-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.RecordLog$LogReader.read(RecordLog.scala:389)\n2016-02-17T15:43:48.371082-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.RecordLog$$anonfun$read$2.apply(RecordLog.scala:654)\n2016-02-17T15:43:48.371148-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.RecordLog$$anonfun$read$2.apply(RecordLog.scala:654)\n2016-02-17T15:43:48.371219-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.RecordLog.get_reader(RecordLog.scala:644)\n2016-02-17T15:43:48.371380-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.RecordLog.read(RecordLog.scala:654)\n2016-02-17T15:43:48.371454-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient.getMessage(LevelDBClient.scala:1335)\n2016-02-17T15:43:48.371526-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$$anonfun$queueCursor$1.apply(LevelDBClient.scala:1274)\n2016-02-17T15:43:48.371604-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$$anonfun$queueCursor$1.apply(LevelDBClient.scala:1271)\n2016-02-17T15:43:48.371675-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1$$anonfun$apply$mcV$sp$12.apply(LevelDBClient.scala:1359)\n2016-02-17T15:43:48.371746-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1$$anonfun$apply$mcV$sp$12.apply(LevelDBClient.scala:1358)\n2016-02-17T15:43:48.371818-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$RichDB.check$4(LevelDBClient.scala:323)\n2016-02-17T15:43:48.371888-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$RichDB.cursorRange(LevelDBClient.scala:325)\n2016-02-17T15:43:48.371960-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1.apply$mcV$sp(LevelDBClient.scala:1358)\n2016-02-17T15:43:48.372034-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1.apply(LevelDBClient.scala:1358)\n2016-02-17T15:43:48.372104-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1.apply(LevelDBClient.scala:1358)\n2016-02-17T15:43:48.372175-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient.usingIndex(LevelDBClient.scala:1038)\n2016-02-17T15:43:48.372259-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient$$anonfun$might_fail_using_index$1.apply(LevelDBClient.scala:1044)\n2016-02-17T15:43:48.372334-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient.might_fail(LevelDBClient.scala:549)\n2016-02-17T15:43:48.372406-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient.might_fail_using_index(LevelDBClient.scala:1044)\n2016-02-17T15:43:48.372488-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient.collectionCursor(LevelDBClient.scala:1357)\n2016-02-17T15:43:48.372573-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBClient.queueCursor(LevelDBClient.scala:1271)\n2016-02-17T15:43:48.372635-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.DBManager.cursorMessages(DBManager.scala:735)\n2016-02-17T15:43:48.372705-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.leveldb.LevelDBStore$LevelDBMessageStore.recoverNextMessages(LevelDBStore.scala:860)\n2016-02-17T15:43:48.372774-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.doFillBatch(QueueStorePrefetch.java:120)\n2016-02-17T15:43:48.372844-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.fillBatch(AbstractStoreCursor.java:406)\n2016-02-17T15:43:48.372913-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.reset(AbstractStoreCursor.java:149)\n2016-02-17T15:43:48.372990-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.cursors.StoreQueueCursor.reset(StoreQueueCursor.java:169)\n2016-02-17T15:43:48.373060-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.Queue.doPageInForDispatch(Queue.java:1938)\n2016-02-17T15:43:48.373130-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:2149)\n2016-02-17T15:43:48.373201-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.Queue.doBrowse(Queue.java:1137)\n2016-02-17T15:43:48.373275-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.Queue.expireMessages(Queue.java:917)\n2016-02-17T15:43:48.373344-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.Queue.access$100(Queue.java:103)\n2016-02-17T15:43:48.373413-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.broker.region.Queue$2.run(Queue.java:146)\n2016-02-17T15:43:48.373484-08:00 aamql2.bus.jetqa1.syseng.tmcs     at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\n2016-02-17T15:43:48.373553-08:00 aamql2.bus.jetqa1.syseng.tmcs     at java.util.TimerThread.mainLoop(Timer.java:555)\n2016-02-17T15:43:48.373622-08:00 aamql2.bus.jetqa1.syseng.tmcs     at java.util.TimerThread.run(Timer.java:505)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"LevelDB gets corrupted when Primary ActiveMQ server is shutdown while messages are queued to it","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilasfvish","name":"sunilasfvish","key":"sunilasfvish","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Vishwanath","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilasfvish","name":"sunilasfvish","key":"sunilasfvish","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Vishwanath","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Virtual type detected as xen-para.\nLast rubix: Mon Feb  1 11:02:37 2016 release: 74867 version: 2.0.7\nInstalled kernel: 2.6.18-308.0.0.0.1.el5xen x86_64","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12940190/comment/15152589","id":"15152589","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilasfvish","name":"sunilasfvish","key":"sunilasfvish","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Vishwanath","active":true,"timeZone":"Etc/UTC"},"body":"Here is the Persistence Adapter configuration:\n        <persistenceAdapter>\n               <replicatedLevelDB\n                directory=\"${activemq.data}/leveldb\"\n                replicas=\"5\"\n                bind=\"tcp://0.0.0.0:61619\"\n                zkAddress=\"${zk.server.1}:${zk.port},${zk.server.2}:${zk.port},${zk.server.3}:${zk.port}\"\n                zkPassword=\"password\"\n                zkSessionTimeout=\"${zkSessionTimeout}\"\n                zkPath=\"${activemq.data}/leveldb-stores\"\n                sync=\"local_disk\"\n                logSize=\"${limit.journal_file_max_length}\"\n                paranoidChecks=\"true\"\n                verifyChecksums=\"true\"\n                indexCompression=\"none\"\n               />","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilasfvish","name":"sunilasfvish","key":"sunilasfvish","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Vishwanath","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-18T16:47:17.883+0000","updated":"2016-02-18T16:47:17.883+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12940190/comment/15289245","id":"15289245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heka","name":"heka","key":"heka","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henrik Karlsson","active":true,"timeZone":"Europe/Stockholm"},"body":"I'm seeing the same thing on 5.13.1 and 5.13.2 ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heka","name":"heka","key":"heka","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henrik Karlsson","active":true,"timeZone":"Europe/Stockholm"},"created":"2016-05-18T16:26:20.071+0000","updated":"2016-05-18T16:26:20.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12940190/comment/15289256","id":"15289256","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You might want to take a look at this issue and see if there's any correlation: AMQ-6282","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-05-18T16:31:24.802+0000","updated":"2016-05-18T16:31:24.802+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12940190/comment/15289266","id":"15289266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heka","name":"heka","key":"heka","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henrik Karlsson","active":true,"timeZone":"Europe/Stockholm"},"body":"No, we don't have any problems that's related to running out of diskspace.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heka","name":"heka","key":"heka","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henrik Karlsson","active":true,"timeZone":"Europe/Stockholm"},"created":"2016-05-18T16:37:05.836+0000","updated":"2016-05-18T16:37:05.836+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12940190/comment/15289276","id":"15289276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heka","name":"heka","key":"heka","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henrik Karlsson","active":true,"timeZone":"Europe/Stockholm"},"body":"I got this last night:\n2016-05-17 01:12:07,632 | INFO  | Stopping BrokerService[mule-actmql] due to exception, java.io.EOFException: File '/opt/activemq/data/leveldb/00000000b25fbe01.log' offset: 383306030 | org.apache.activemq.util.DefaultIOExceptionHandler | LevelDB IOException handler.\njava.io.EOFException: File '/opt/activemq/data/leveldb/00000000b25fbe01.log' offset: 383306030\n        at org.apache.activemq.leveldb.RecordLog$LogReader.read(RecordLog.scala:389)\n        at org.apache.activemq.leveldb.RecordLog$$anonfun$read$2.apply(RecordLog.scala:654)\n        at org.apache.activemq.leveldb.RecordLog$$anonfun$read$2.apply(RecordLog.scala:654)\n        at org.apache.activemq.leveldb.RecordLog.get_reader(RecordLog.scala:644)\n        at org.apache.activemq.leveldb.RecordLog.read(RecordLog.scala:654)\n        at org.apache.activemq.leveldb.LevelDBClient.getMessage(LevelDBClient.scala:1335)\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$queueCursor$1.apply(LevelDBClient.scala:1274)\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$queueCursor$1.apply(LevelDBClient.scala:1271)\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1$$anonfun$apply$mcV$sp$12.apply(LevelDBClient.scala:1359)\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1$$anonfun$apply$mcV$sp$12.apply(LevelDBClient.scala:1358)\n        at org.apache.activemq.leveldb.LevelDBClient$RichDB.check$4(LevelDBClient.scala:323)\n        at org.apache.activemq.leveldb.LevelDBClient$RichDB.cursorRange(LevelDBClient.scala:325)\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1.apply$mcV$sp(LevelDBClient.scala:1358)\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1.apply(LevelDBClient.scala:1358)\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1.apply(LevelDBClient.scala:1358)\n        at org.apache.activemq.leveldb.LevelDBClient.usingIndex(LevelDBClient.scala:1038)\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$might_fail_using_index$1.apply(LevelDBClient.scala:1044)\n        at org.apache.activemq.leveldb.LevelDBClient.might_fail(LevelDBClient.scala:549)\n        at org.apache.activemq.leveldb.LevelDBClient.might_fail_using_index(LevelDBClient.scala:1044)\n        at org.apache.activemq.leveldb.LevelDBClient.collectionCursor(LevelDBClient.scala:1357)\n        at org.apache.activemq.leveldb.LevelDBClient.queueCursor(LevelDBClient.scala:1271)\n        at org.apache.activemq.leveldb.DBManager.cursorMessages(DBManager.scala:735)\n        at org.apache.activemq.leveldb.LevelDBStore$LevelDBMessageStore.recoverNextMessages(LevelDBStore.scala:860)\n        at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.doFillBatch(QueueStorePrefetch.java:120)\n        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.fillBatch(AbstractStoreCursor.java:406)\n        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.reset(AbstractStoreCursor.java:149)\n        at org.apache.activemq.broker.region.cursors.StoreQueueCursor.reset(StoreQueueCursor.java:169)\n        at org.apache.activemq.broker.region.Queue.doPageInForDispatch(Queue.java:1938)\n        at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:2159)\n        at org.apache.activemq.broker.region.Queue.doBrowse(Queue.java:1137)\n        at org.apache.activemq.broker.region.Queue.expireMessages(Queue.java:917)\n        at org.apache.activemq.broker.region.Queue.access$100(Queue.java:103)\n        at org.apache.activemq.broker.region.Queue$2.run(Queue.java:146)\n        at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\n        at java.util.TimerThread.mainLoop(Timer.java:555)\n        at java.util.TimerThread.run(Timer.java:505)\n\nAnd this happen right after another master was elected...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heka","name":"heka","key":"heka","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henrik Karlsson","active":true,"timeZone":"Europe/Stockholm"},"created":"2016-05-18T16:41:13.282+0000","updated":"2016-05-18T16:42:47.302+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12940190/comment/15583154","id":"15583154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgovindarajulu","name":"vgovindarajulu","key":"vgovindarajulu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vijay Govindarajulu","active":true,"timeZone":"Etc/UTC"},"body":"I am faced with the same problem reported by [~sunilasfvish], my cluster config is a little different\nAffects Version/s: 5.11.1\nActiveMQ 5.11.1 with replicated LevelDB (3 node cluster).\nZookeeper 3.4.6 (3 node cluster).\nFile system: ext4\n\n{code}\n2016-09-28 10:54:40,849 | INFO  | Stopping BrokerService[localhost] due to exception, java.io.EOFException: File '/opt/activemq/activemq-batch/data/leveldb/000000000c8002d7.log' offset: 3012576207 | org.apache.activemq.u\ntil.DefaultIOExceptionHandler | LevelDB IOException handler.\njava.io.EOFException: File '/opt/activemq/activemq-batch/data/leveldb/000000000c8002d7.log' offset: 3012576207\n        at org.apache.activemq.leveldb.RecordLog$LogReader.read(RecordLog.scala:389)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.RecordLog$$anonfun$read$2.apply(RecordLog.scala:654)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.RecordLog$$anonfun$read$2.apply(RecordLog.scala:654)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.RecordLog.get_reader(RecordLog.scala:644)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.RecordLog.read(RecordLog.scala:654)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient.getMessage(LevelDBClient.scala:1335)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$queueCursor$1.apply(LevelDBClient.scala:1274)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$queueCursor$1.apply(LevelDBClient.scala:1271)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1$$anonfun$apply$mcV$sp$12.apply(LevelDBClient.scala:1359)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1$$anonfun$apply$mcV$sp$12.apply(LevelDBClient.scala:1358)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$RichDB.check$4(LevelDBClient.scala:323)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$RichDB.cursorRange(LevelDBClient.scala:325)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1.apply$mcV$sp(LevelDBClient.scala:1358)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1.apply(LevelDBClient.scala:1358)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$collectionCursor$1.apply(LevelDBClient.scala:1358)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient.usingIndex(LevelDBClient.scala:1038)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient$$anonfun$might_fail_using_index$1.apply(LevelDBClient.scala:1044)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient.might_fail(LevelDBClient.scala:549)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient.might_fail_using_index(LevelDBClient.scala:1044)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient.collectionCursor(LevelDBClient.scala:1357)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBClient.queueCursor(LevelDBClient.scala:1271)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.DBManager.cursorMessages(DBManager.scala:735)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.leveldb.LevelDBStore$LevelDBMessageStore.recoverNextMessages(LevelDBStore.scala:860)[activemq-leveldb-store-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.doFillBatch(QueueStorePrefetch.java:109)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.fillBatch(AbstractStoreCursor.java:381)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.reset(AbstractStoreCursor.java:142)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.cursors.StoreQueueCursor.reset(StoreQueueCursor.java:159)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.Queue.doPageInForDispatch(Queue.java:1897)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:2119)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.Queue.doBrowse(Queue.java:1116)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.Queue.expireMessages(Queue.java:909)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.Queue.access$100(Queue.java:100)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.broker.region.Queue$2.run(Queue.java:144)[activemq-broker-5.11.1.jar:5.11.1]\n        at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)[activemq-client-5.11.1.jar:5.11.1]\n        at java.util.TimerThread.mainLoop(Timer.java:555)[:1.8.0_92]\n        at java.util.TimerThread.run(Timer.java:505)[:1.8.0_92]\"\n{code}\n\nactivemq.xml snip\n\n{code:xml}\n        <persistenceAdapter>\n            <replicatedLevelDB\n                 directory=\"${activemq.data}/leveldb\"\n                 replicas=\"2\"\n                 bind=\"tcp://0.0.0.0:61613\"\n                 zkAddress=\"zk-1:2181,zk-2:2181,zk-3:2181\"\n                 zkPassword=\"\"\n                 zkPath=\"${activemq.data}/batch/leveldb\"\n                 sync=\"quorum_disk\"\n            />\n        </persistenceAdapter>\n{code}\n\nI was able to resolve the issue by removing the data folder on all the cluster nodes and restarting the Brokers. \n\n*This error causes the activemq cluster to failover continuously*\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgovindarajulu","name":"vgovindarajulu","key":"vgovindarajulu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vijay Govindarajulu","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-17T19:07:30.438+0000","updated":"2016-10-17T19:16:24.322+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12940190/comment/15854071","id":"15854071","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"LevelDB has been deprecated and is no longer supported.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2017-02-06T14:22:56.120+0000","updated":"2017-02-06T14:22:56.120+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6174/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2t0c7:"}}