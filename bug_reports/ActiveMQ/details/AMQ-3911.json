{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12597138","self":"https://issues.apache.org/jira/rest/api/2/issue/12597138","key":"AMQ-3911","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2012-07-03T13:08:08.367+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 22 19:10:32 UTC 2012","customfield_12310420":"293798","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4347116648_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-08-22T19:10:32.703+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3911/watchers","watchCount":2,"isWatching":false},"created":"2012-07-03T11:38:36.151+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-08-22T19:10:32.794+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have 1 topic, 100 producer and  1 consumer. We use non-transacted sessions, NON_PERSISTENT messages and CLIENT_ACKNOWLEDGE mode. The problem is that after a while (1 day or more) some messages are not acknowledged and inflight count goes up till maximum memory of the topic is reach. Consumer code is something like this:\n\n{code}\nSession session = connection.createSession(false, Session.CLIENT_ACKNOWLEDGE);\n\t\tMessageConsumer consumer = session.createConsumer(JMSProviderUtil.getTopic(AGENT_STATUS_TOPIC));\n\t\tconsumer.setMessageListener(new MessageListener() {\n\n\t\t\tpublic void onMessage(Message message) {\n\t\t\t\ttry {\n\t\t\t\t\tif (message instanceof TextMessage && message.getJMSRedelivered() == false) {\n\t\t\t\t\t\tTextMessage textMessage = (TextMessage) message;\n\t\t\t\t\t\tString host = textMessage.getText();\n\t\t\t\t\t\tString switchId = host2idMap.get(host);\n\t\t\t\t\t\tif (switchId != null) {\n\t\t\t\t\t\t\tid2lastHeartbeatMap.put(switchId, System.currentTimeMillis());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (JMSException e) {\n\t\t\t\t\tGeneralLogger.LOGGER.logError(e.getMessage(), e);\n\t\t\t\t} finally {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmessage.acknowledge();\n\t\t\t\t\t} catch (JMSException e) {\n\t\t\t\t\t\tGeneralLogger.LOGGER.logError(e.getMessage(), e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172231","customfield_12312823":null,"summary":"Messages are not acknowelge and inflight count goes up till max memory is reached for topic","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alireza_tp","name":"alireza_tp","key":"alireza_tp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ali Reza.T","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alireza_tp","name":"alireza_tp","key":"alireza_tp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ali Reza.T","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"OS: Solaris 10\nJava Version: 1.6","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12597138/comment/13405900","id":"13405900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Do you have logs from the times when this happening, is there anything in them to give more insight?  Have you tried with a newer broker release, latest is v5.6.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-07-03T13:08:08.367+0000","updated":"2012-07-03T13:08:08.367+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12597138/comment/13405910","id":"13405910","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alireza_tp","name":"alireza_tp","key":"alireza_tp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ali Reza.T","active":true,"timeZone":"Etc/UTC"},"body":"We had further investigations and we found this happens when the CPU usage goes up due to some other process in server (it reaches around 50%. We have an Sun V880 server with four 1.2 GHz CPUs with 8MB cache). We hadn't tried new versions due to hard update procedure. Is it possible that this problem is solved in newer versions?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alireza_tp","name":"alireza_tp","key":"alireza_tp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ali Reza.T","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-03T13:22:53.933+0000","updated":"2012-07-03T13:22:53.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12597138/comment/13439773","id":"13439773","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"No test case, and no logs.  Recommend you try a newer version as AMQ 5.4.2 is quite old now. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-08-22T19:10:32.761+0000","updated":"2012-08-22T19:10:32.761+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3911/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tudr:"}}