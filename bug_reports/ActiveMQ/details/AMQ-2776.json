{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482393","self":"https://issues.apache.org/jira/rest/api/2/issue/12482393","key":"AMQ-2776","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-06-14T10:20:05.927+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Aug 09 09:41:08 UTC 2010","customfield_12310420":"74805","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4919804491_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-08-09T09:41:08.840+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2776/watchers","watchCount":0,"isWatching":false},"created":"2010-06-13T11:04:24.349+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-08-09T09:41:08.835+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"1. On server suse10sp268, start activemq , then run activemq-admin.bat browse --amqurl tcp://suse10sp268:61616 TEST.FOO , got excecption Caused by: javax.jms.JMSException: Could not connect to broker URL: tcp://suse10sp268:61616. Reason: java.net.ConnectException: Connection refused: connect\nat org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:35)\nat org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:286)\nat org.apache.activemq.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:185)\nat org.apache.activemq.ra.ActiveMQConnectionSupport.makeConnection(ActiveMQConnectionSupport.java:79)\nat org.apache.activemq.ra.ActiveMQConnectionSupport.makeConnection(ActiveMQConnectionSupport.java:61)\nat org.apache.activemq.ra.ActiveMQManagedConnectionFactory.createManagedConnection(ActiveMQManagedConnectionFactory.java:169)\n... 42 more\nCaused by: java.net.ConnectException: Connection refused: connect\nat java.net.PlainSocketImpl.socketConnect(Native Method)\nat java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)\nat java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)\nat java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)\nat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)\nat java.net.Socket.connect(Socket.java:519)\nat org.apache.activemq.transport.tcp.TcpTransport.connect(TcpTransport.java:483)\nat org.apache.activemq.transport.tcp.TcpTransport.doStart(TcpTransport.java:446)\nat org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:53)\nat org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\nat org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\nat org.apache.activemq.transport.WireFormatNegotiator.start(WireFormatNegotiator.java:72)\nat org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\nat org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\nat org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:266)\n\nThis  happened also when got error starting activemq-ra module in geronimo\nhttps://issues.apache.org/jira/browse/GERONIMO-5371","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461755","id":"12461755","filename":"activemq-2776.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuhaihong","name":"xuhaihong","key":"xuhaihong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-06-30T01:51:18.012+0000","size":4305,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461755/activemq-2776.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"159970","customfield_12312823":null,"summary":"Connection refused when using shortname in activemqurl","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=viola.lu","name":"viola.lu","key":"viola.lu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"viola.lu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=viola.lu","name":"viola.lu","key":"viola.lu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"viola.lu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Suse 10 Sp2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12942637","id":"12942637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Is this a case of https://issues.apache.org/activemq/browse/AMQ-2094 - does the broker transportConnector use localhost?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-14T10:20:05.927+0000","updated":"2010-06-14T10:20:05.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12942546","id":"12942546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=viola.lu","name":"viola.lu","key":"viola.lu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"viola.lu","active":true,"timeZone":"Etc/UTC"},"body":"This case is different from amq-2094 case. activemq.sh can bind connector with full/short server host name.\n\n1. Server suse10sp268, i add its ip map into /etc/hosts\n9.186.10.68     suse10sp268.site suse10sp268\n2.Edit its acitvemq.xml with :\n<transportConnectors>\n            <transportConnector name=\"openwire\" uri=\"tcp://suse10sp268:61616\"/>\n</transportConnectors>\n\n3. Start activemq\n INFO | ActiveMQ 5.3.2 JMS Message Broker (share) is starting\n INFO | For help or more information please see: http://activemq.apache.org/\n INFO | Kaha Store using data directory /share/kr-store/data\n INFO | Listening for connections at: tcp://suse10sp268.site:61616\n INFO | Connector openwire Started\n INFO | ActiveMQ JMS Message Broker (share, ID:suse10sp268-49309-1277133128502-0:0) started\n INFO | Logging to org.slf4j.impl.JCLLoggerAdapter(org.mortbay.log) via org.mortbay.log.Slf4jLog\n INFO | jetty-6.1.9\n INFO | ActiveMQ WebConsole initialized.\n\n4. Then i run \nactivemq-admin.sh browse --amqurl tcp://suse10sp268:61616 TEST.FOO, it will report error,\nERROR: java.lang.RuntimeException: Failed to execute browse task. Reason: javax.jms.JMSException: Could not connect to broker URL: tcp://suse10sp268:61616. Reason: java.net.ConnectException: Connection refused\njava.lang.RuntimeException: Failed to execute browse task. Reason: javax.jms.JMSException: Could not connect to broker URL: tcp://suse10sp268:61616. Reason: java.net.ConnectException: Connection refused\n        at org.apache.activemq.console.command.AmqBrowseCommand.runTask(AmqBrowseCommand.java:130)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.activemq.console.Main.runTaskClass(Main.java:251)\n        at org.apache.activemq.console.Main.main(Main.java:107)\nERROR: java.lang.Exception: javax.jms.JMSException: Could not connect to broker URL: tcp://suse10sp268:61616. Reason: java.net.ConnectException: Connection refused\njava.lang.Exception: javax.jms.JMSException: Could not connect to broker URL: tcp://suse10sp268:61616. Reason: java.net.ConnectException: Connection refused\n        at org.apache.activemq.console.command.AmqBrowseCommand.runTask(AmqBrowseCommand.java:131)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.activemq.console.Main.runTaskClass(Main.java:251)\n        at org.apache.activemq.console.Main.main(Main.java:107)\nCaused by: javax.jms.JMSException: Could not connect to broker URL: tcp://suse10sp268:61616. Reason: java.net.ConnectException: Connection refused\n        at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:35)\n        at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:286)\n        at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:230)\n        at org.apache.activemq.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:178)\n        at org.apache.activemq.console.filter.AmqMessagesQueryFilter.createConnection(AmqMessagesQueryFilter.java:123)\n        at org.apache.activemq.console.filter.AmqMessagesQueryFilter.queryMessages(AmqMessagesQueryFilter.java:87)\n        at org.apache.activemq.console.filter.AmqMessagesQueryFilter.query(AmqMessagesQueryFilter.java:72)\n        at org.apache.activemq.console.filter.WildcardTransformFilter.query(WildcardTransformFilter.java:60)\n        at org.apache.activemq.console.util.AmqMessagesUtil.getMessages(AmqMessagesUtil.java:51)\n        at org.apache.activemq.console.command.AmqBrowseCommand.runTask(AmqBrowseCommand.java:117)\n        ... 10 more\nCaused by: java.net.ConnectException: Connection refused\n        at java.net.PlainSocketImpl.socketConnect(Native Method)\n        at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)\n        at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)\n        at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)\n        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)\n        at java.net.Socket.connect(Socket.java:519)\n        at org.apache.activemq.transport.tcp.TcpTransport.connect(TcpTransport.java:436)\n        at org.apache.activemq.transport.tcp.TcpTransport.doStart(TcpTransport.java:402)\n        at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:53)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:57)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:57)\n        at org.apache.activemq.transport.WireFormatNegotiator.start(WireFormatNegotiator.java:72)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:57)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:57)\n        at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:266)\n        ... 18 more\n\n\n but if i run \nactivemq-admin.sh browse --amqurl tcp://suse10sp268.site:61616 TEST.FOO, no error, there is just one difference between two command: server host name, the former is short host name suse10sp268, the latter is full host name: sus10sp268.site\n tcp://suse10sp268:61616 \n tcp://suse10sp268.site:61616\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=viola.lu","name":"viola.lu","key":"viola.lu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"viola.lu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-21T07:38:43.703+0000","updated":"2010-06-21T07:38:43.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12942544","id":"12942544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=viola.lu","name":"viola.lu","key":"viola.lu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"viola.lu","active":true,"timeZone":"Etc/UTC"},"body":"if transportConnector is 0.0.0.0, amqurl start log is: \nINFO | Listening for connections at: tcp://suse10sp268:61616 \nif i run : \nactivemq-admin.sh browse --amqurl tcp://suse10sp268:61616 TEST.FOO, it will work. \n\nif transportConnector is suse10sp268, start log is \nINFO | Listening for connections at: tcp://suse10sp268.site:61616 \nif i run \nactivemq-admin.sh browse --amqurl tcp://suse10sp268:61616 TEST.FOO, it doesn't work, but \"activemq-admin.sh browse --amqurl tcp://suse10sp268.site:61616 TEST.FOO\" will work. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=viola.lu","name":"viola.lu","key":"viola.lu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"viola.lu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-21T08:58:46.793+0000","updated":"2010-06-21T08:58:46.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12942516","id":"12942516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuhaihong","name":"xuhaihong","key":"xuhaihong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan","active":true,"timeZone":"Asia/Shanghai"},"body":"I try to investigate the problem a bit. Before TCPTransport tries to connect the remote server, it would first call the resolveHost method to check whether the target remote host is the local machine, also it will check a boolean tag useLocalHost. From the comments in the codes, it said in Mac, there is a problem while trying to connect the local machine with its hostname. But, I am not sure whether it is a good choice in other platforms, usually the hostname is corresponding to the actual IP. Since the user configures the target server with hostname, it means that the actual IP is expected to connect to, because the server is only binding to actual IP, not the localhost (127.0.0.1) interface. \nI attached a patch, it just initialize the useLocalHost depending on the OS platform.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuhaihong","name":"xuhaihong","key":"xuhaihong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-06-30T01:51:18.116+0000","updated":"2010-06-30T01:51:18.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12940542","id":"12940542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"body":"In 5.3.2\n\nWith two distinct brokers on the same server with a single interface, and without localhost usage.\n\nI experiment the same problem of connection refused on a multicast network connector connection. Only \"0.0.0.0\" seems to work as IP address of the transport connector\n\n\"name\" of the current host, with or without domain extension, with useLocalHost=true or useLocalHost=false doesn't work. \n\nIt works in 5.3.0-5 fuse.\n\nI don't know if using the virtual hostname associated to another interface in the /etc/hosts file, works. We must have this functionality in production environment to isolate flows for security reasons.\n\nEric-AWL","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-27T09:39:04.997+0000","updated":"2010-07-27T09:39:04.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12941286","id":"12941286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"body":"With multicast discovery, I think I found the problem\n\nMy transport connector was in 5.3.0\n\n      <transportConnector name=\"TestDeCharge-DEFAULT-IN\"\n                          uri=\"tcp://td0sib01s.priv.atos.fr:61616?useLocalHost=false\"\n                          discoveryUri=\"multicast://default?group=TestDeCharge-DEFAULT\"/>\n\nIn 5.3.0, the corresponding multicast frame is\n\n09:59:02.870809 IP td0sib01s.priv.atos.fr.6155 > 239.255.2.3.6155: UDP, length 102\n        0x0000:  4500 0082 0000 4000 0111 959b 0a18 e7b5  E.....@.........\n        0x0010:  efff 0203 180b 180b 006e e44f 5465 7374  .........n.OTest\n        0x0020:  4465 4368 6172 6765 2d44 4546 4155 4c54  DeCharge-DEFAULT\n        0x0030:  2e41 6374 6976 654d 512d 342e 616c 6976  .ActiveMQ-4.aliv\n        0x0040:  652e 256c 6f63 616c 686f 7374 2574 6370  e.%localhost%tcp\n        0x0050:  3a2f 2f74 6430 7369 6230 3173 2e70 7269  ://td0sib01s.pri\n        0x0060:  762e 6174 6f73 2e66 723a 3631 3631 363f  v.atos.fr:61616?\n        0x0070:  7573 654c 6f63 616c 486f 7374 3d66 616c  useLocalHost=fal\n        0x0080:  7365                                     se\n\nIn 5.3.2, the corresponding multicast frame is\n\n[root@td0sib01s ~]# tcpdump -s 200 -c 4 src host td0sib01s and ip multicast -X\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 200 bytes\n09:51:30.818735 IP td0sib01s.priv.atos.fr.6155 > 239.255.2.3.6155: UDP, length 83\n        0x0000:  4500 006f 0000 4000 0111 95ae 0a18 e7b5  E..o..@.........\n        0x0010:  efff 0203 180b 180b 005b e43c 5465 7374  .........[.<Test\n        0x0020:  4465 4368 6172 6765 2d44 4546 4155 4c54  DeCharge-DEFAULT\n        0x0030:  2e41 6374 6976 654d 512d 342e 616c 6976  .ActiveMQ-4.aliv\n        0x0040:  652e 256c 6f63 616c 686f 7374 2574 6370  e.%localhost%tcp\n        0x0050:  3a2f 2f74 6430 7369 6230 3173 2e70 7269  ://td0sib01s.pri\n        0x0060:  762e 6174 6f73 2e66 723a 3631 3631 36    v.atos.fr:61616\n\nwithout \"?useLocalHost=false\"\n\nA broker that is present on the same server wants to connect with useLocalHost=true => localhost and not \"address\".\n\nit fails to connect.\n\nEric-AWL","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-28T07:59:56.191+0000","updated":"2010-07-28T07:59:56.191+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12940150","id":"12940150","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"the parameters supplied to the TransportConnector are stripped of before being broadcast because many of the server side options are not applicable to the connection initiator (client side)\nIf you want a client to connect using useLocalHost=true, then that option needs to be specified on the brokerURL (connection factory) or on the networkConnector broker url. The parameters are then applied to all discovered urls.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-29T10:45:28.042+0000","updated":"2010-07-29T10:45:28.042+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12940073","id":"12940073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuhaihong","name":"xuhaihong","key":"xuhaihong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi, Gary\n    So for the initial purpose for this JIRA, do you mean that useLocal=false should be used ? I am just wondering that why ActiveQM assume to use localhost to connect the server if both client and server are the same machine, it is for performance ? But sometimes, the borker might not listen on 0.0.0.0, which means that client could not connect to the server via localhost.\n     Thanks !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuhaihong","name":"xuhaihong","key":"xuhaihong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-07-30T01:29:47.170+0000","updated":"2010-07-30T01:29:47.170+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12939748","id":"12939748","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"yes, and that will be the default value in 5.4. see: https://issues.apache.org/activemq/browse/AMQ-2771\nthe useLocalHost flag is really a hack for macosx (at some stage) that should always have been disabled by default.\n\nAlso, the patch attached that makes the use of InetAddress.getLocalHost().getHostName() conditional on useLocalHost being set has been applied for 5.4 (r983565) which avoids one unnecessary resolution.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-09T09:40:06.983+0000","updated":"2010-08-09T09:40:06.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482393/comment/12939749","id":"12939749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"variant of patch applied that makes localhost resolution conditional on useLocalHost which now defaults to false.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-09T09:41:08.824+0000","updated":"2010-08-09T09:41:08.824+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2776/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rqpb:"}}