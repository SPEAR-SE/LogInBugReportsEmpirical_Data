{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12539600","self":"https://issues.apache.org/jira/rest/api/2/issue/12539600","key":"AMQ-3678","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-04-16T05:48:25.296+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Apr 16 05:48:25 UTC 2012","customfield_12310420":"225102","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_7148332432_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-04-16T05:48:24.651+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3678/watchers","watchCount":0,"isWatching":false},"created":"2012-01-24T12:09:32.883+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["Topic"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318549","id":"12318549","name":"5.5.1","archived":false,"released":true,"releaseDate":"2011-10-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-04-16T05:48:59.531+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"If I have a durable subscriber on a topic, which is *{{active}}*; and a message \nproducer is sending to the topic. If the topic is deleted (whist the durable \nconsumer is *{{active}}*), should the durable subscription be re-added to the \ntopic (as a consumer) when it the TOPIC is subsequently recreated by the producer \non the next message send? \n\nWhen replicating the above with a QUEUE that has an active consumer and producer.\nIf you delete the queue whilst the producer and consumer are active, the next message \nsent by the producer recreates the QUEUE, and the active consumer is then registered \nas a consumer on the queue.  However, this isn't the case for an active durable consumer \n(which isn't re-added as a consumer); when the TOPIC is subsequently recreated by the \nproducer's next message to the topic.\n\n\nIt could be the case that you should not be able to delete the topic, via jmx, when\nan active durable consumer is present?  If so, then should this logic also apply to the queue? (not able\nto delete it via jmx when it has an active consumer).\n\n\nTo re-attach the active durable consumer to the newly created topic, in \n- http://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/broker/region/Topic.java\n\nYou could apply the attached patch to the *{{public void addSubscription(ConnectionContext context, final Subscription sub) throws Exception }}* method (line 112) to re-add the durable consumer. (junit included)\n\n\n----\n\nA related question to the above is should the advisory \n\n- \"ActiveMQ.Advisory.Consumer.Topic.XXX\"  or\n- \"ActiveMQ.Advisory.Consumer.Queue.XXX\" \n\nBe recreated when the active consumer reattaches to the queue or topic?\n\nWhen you remove, via jmx, the Queue or Topic the associated Consumer Advisory Topic is also removed.\nWhen the queue or topic is recreated, and the consumer re-assigned to the new queue; the advisory isn't\ncreated/fired.  Would this cause any issues?  Should an advisory be sent?  does it affect *{{dynamicallyIncludedDestinations}}*\nand the use of the Advisories when using a network of brokers?\n\n\ncheers\n/dom","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12511660","id":"12511660","filename":"CountMessagesRecievedOnDurableTopicAfterTopicDeletion.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-24T12:10:32.014+0000","size":6145,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12511660/CountMessagesRecievedOnDurableTopicAfterTopicDeletion.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12511661","id":"12511661","filename":"Topic.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-24T12:10:32.033+0000","size":1307,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12511661/Topic.patch.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"59238","customfield_12312823":null,"summary":"Active Durable Topic Consumer is not re-assigned to Topic after it is deleted and recreated","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Mac OS X (10.7.2)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12539600/comment/13254521","id":"13254521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed by SVN revision 1326493","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-16T05:48:25.296+0000","updated":"2012-04-16T05:48:25.296+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3678/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0aiav:"}}