{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13123162","self":"https://issues.apache.org/jira/rest/api/2/issue/13123162","key":"AMQ-6870","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2017-12-06T14:38:53.071+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Dec 27 12:02:28 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1656890923_*|*_4_*:*_1_*:*_153337899_*|*_6_*:*_2_*:*_8374708","customfield_12312321":null,"resolutiondate":"2017-12-27T12:03:18.610+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6870/watchers","watchCount":3,"isWatching":false},"created":"2017-12-06T10:53:15.133+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-12-27T12:03:18.655+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I want to connect to my broker using STOMP+SSL as because my broker is exposing that protocol:\r\n{code:xml}\r\n<transportConnector name=\"stomp+nio+ssl\" uri=\"stomp+nio+ssl://0.0.0.0:61612?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600\"/>\r\n{code}\r\nThe connector is working fine because I'm able to connect to it with a Javascript library and another Ruby one.\r\n\r\nBut when using the Java libraries, by applying the connection string {{\"stomp+ssl://localhost:61612\"}} or {{\"ssl://localhost:61612?wireFormat=stomp\"}} it fails because of a bug in the StompSslTransportFactory not supporting the field {{wireFormat.host}}.\r\n\r\nAn easy way to get the same error is by applying the following config in camel:\r\n{code:xml}\r\n<bean id=\"myConnectionFactory\" class=\"org.apache.activemq.ActiveMQConnectionFactory\">\r\n    <property name=\"brokerURL\" value=\"stomp+ssl://localhost:61612\"/>\r\n    <!-- or with <property name=\"brokerURL\" value=\"ssl://localhost:61612?wireFormat=stomp\"/> -->\r\n    <property name=\"userName\" value=\"${amq.user}\"/>\r\n    <property name=\"password\" value=\"${amq.pass}\"/>\r\n</bean>\r\n{code}\r\n\r\nThe error I'm getting is:\r\n{code}\r\nInvalid connect parameters: {wireFormat.host=localhost}\r\n{code}\r\n\r\nI think it might be related to this piece of code where it enforces the value if it doesn't exist:\r\n{code:title=org/apache/activemq/transport/TransportFactory.java}\r\n    public Transport doConnect(URI location) throws Exception { \r\n        try { \r\n            Map<String, String> options = new HashMap<String, String>(URISupport.parseParameters(location)); \r\n            if( !options.containsKey(\"wireFormat.host\") ) { \r\n                options.put(\"wireFormat.host\", location.getHost()); \r\n            } \r\n            WireFormat wf = createWireFormat(options); \r\n            Transport transport = createTransport(location, wf); \r\n            Transport rc = configure(transport, wf, options); \r\n            if (!options.isEmpty()) { \r\n                throw new IllegalArgumentException(\"Invalid connect parameters: \" + options); \r\n            } \r\n            return rc; \r\n        } catch (URISyntaxException e) { \r\n            throw IOExceptionSupport.create(e); \r\n        } \r\n    } \r\n{code}\r\n\r\nHere's another experience from another guy suffering from the same bug: http://activemq.2283324.n4.nabble.com/quot-wireFormat-host-quot-option-for-StompSslTransportFactory-td4685162.html","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"java.lang.IllegalArgumentException: Invalid connect parameters: {wireFormat.host=localhost}","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13123162/comment/16280246","id":"16280246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"It's not entirely clear what you are doing so the context what you are asking about that code block is also unclear.  Can you please elaborate in the description on what you are doing that lead to this point. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-12-06T14:38:53.071+0000","updated":"2017-12-06T14:38:53.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13123162/comment/16281802","id":"16281802","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"body":"Sure! Sorry for the short description. Updated","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"created":"2017-12-07T12:49:21.842+0000","updated":"2017-12-07T12:49:21.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13123162/comment/16297141","id":"16297141","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You say you are using Java libraries to try and connect to the STOMP endpoint, is the Java library you are trying to use the ActiveMQ JMS Client library?  If so that won't work as that client only speaks OpenWire, no STIMP support in there.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-12-19T17:42:07.623+0000","updated":"2017-12-19T17:42:07.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13123162/comment/16303273","id":"16303273","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"body":"From the camel XML configuration I supplied, we can see the used class is {{org.apache.activemq.ActiveMQConnectionFactory}}.\r\nIt returns an instance of StompSslTransportFactory because of the SSL+STOMP URL options. So it sounds like it’s supported (there is an specific class for it). I’d say, instead, that class is broken and not compliant with the TransportFactory requirements. \r\n\r\nI would say it’s either TransportFactory enforcing {{wireFormat.host}}, not taking into account the transport factories called, depending on the protocols, or just StompSslTransportFactory needing an update to support that enforced parameter instead of refusing to establish the connection because that parameter is not allowed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"created":"2017-12-25T13:36:02.568+0000","updated":"2017-12-25T13:36:02.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13123162/comment/16303301","id":"16303301","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The ActiveMQ client library does not and will not support STOMP, if you want to use STOMP as a JMS client (which you really shouldn't) then you'd need to choose a STOMP based JMS client library.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-12-25T15:08:06.039+0000","updated":"2017-12-25T15:08:06.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13123162/comment/16303322","id":"16303322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"body":"Si what is this class for? http://activemq.apache.org/maven/apidocs/org/apache/activemq/transport/stomp/StompSslTransportFactory.html\r\n\r\nI insist that, if a class exist, it needs to work. It does tell much wrong about the health of a software if it has a class with a bug and the solution is denying it.\r\n\r\nIf it’s not supported, it should clearly say so. Especially since there is a class for it.\r\nI’m using JMS connection for this Java app I needed (I had to open the ports specifically for it) and, happily for me, most of my work is done in other working languages.\r\n\r\nMy main concern is how badly maintained this code is if, even when a feature exists (broken, but there it is and you can see it in the source code). I took the time to let you know and tried to help in sharing all the info I could to fix this bug. And the response is “use another thing because we are not going to fix the bug”. I know this ticket is even closed at the moment. How sad it is you deny from supporting a standard and you don’t plan even updating the already existing class to log that same message instead of a random error as you are logging at the moment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"created":"2017-12-25T17:17:01.235+0000","updated":"2017-12-25T17:17:01.235+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13123162/comment/16303328","id":"16303328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"body":"I’m reopening this ticket as I clearly think it’s not fixed and the bug is still persisting.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=afharo","name":"afharo","key":"afharo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alejandro Fernandez Haro","active":true,"timeZone":"Etc/UTC"},"created":"2017-12-25T17:27:40.746+0000","updated":"2017-12-25T17:27:40.746+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13123162/comment/16304485","id":"16304485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"The StompSslTransportFactory class (and other matching factories for AMQP, MQTT, etc) exist for the broker side and is not a client side class.  The class exists only in the activemq-stomp jar and is not part of the activemq-client jar. The broker uses it to create the server side transport in order to handle the STOMP protocol on the broker.  It is not intended for use by the client and if you try it isn't going to work because it was never designed as a client side class.\r\n\r\nNo one is denying supporting a standard or telling you to use something else because we aren't going to fix a bug.  This was closed because as Tim mentioned, there is no bug because the ActiveMQ clients only job is to support JMS using the native OpenWire protocol.  It does not support any other protocol but OpenWire.  If you want to use STOMP then you need to use a STOMP client.  Just like if you want to use MQTT or AMQP you need to use clients that support those protocols.\r\n\r\nI think this is pretty clear and I'm closing this again because this is not a bug and works as intended.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2017-12-27T12:02:28.206+0000","updated":"2017-12-27T12:02:28.206+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6870/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3nlk7:"}}