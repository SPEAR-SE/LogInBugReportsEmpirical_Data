{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12544010","self":"https://issues.apache.org/jira/rest/api/2/issue/12544010","key":"AMQ-3738","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2012-02-28T09:53:32.360+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Sep 19 12:21:29 UTC 2012","customfield_12310420":"229248","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3738/watchers","watchCount":2,"isWatching":false},"created":"2012-02-24T16:07:49.500+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318549","id":"12318549","name":"5.5.1","archived":false,"released":true,"releaseDate":"2011-10-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-09-19T12:21:29.045+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have defined a topic with a memoryLimit of 1mb using a fileDurableSubscriberCursor. I would expect that sending messages to a durable subscriber through that topic would result in more than 1mb worth of messages being able to be sent. Instead producer flow control kicks in at the 1mb limit. \n\nTo test this I am using the Maven activemq-perf plugin with a single consumer and producer:\n$ mvn activemq-perf:producer -Durl=tcp://localhost:61616 -Dproducer.destName=topic://orders\n$ mvn activemq-perf:consumer -Durl=tcp://localhost:61616 -Dconsumer.durable=true -Dconsumer.destName=topic://orders -Dconsumer.recvDelay=100\n\nThis does not match the behaviour described in http://activemq.apache.org/my-producer-blocks.html or http://activemq.apache.org/message-cursors.html\nGoing by the docs, I would expect messages to get paged out to disk until the systemUsage/tempUsage limit fills up.\n\nThis same behaviour happens using the default cursor configuration.\n\nAttached are the activemq-perf pom and activemq.xml.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12515935","id":"12515935","filename":"activemq-cursors.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkorab","name":"jkorab","key":"jkorab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkorab&avatarId=13437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkorab&avatarId=13437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkorab&avatarId=13437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkorab&avatarId=13437"},"displayName":"Jakub Korab","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-24T16:09:54.448+0000","size":1993,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12515935/activemq-cursors.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12515934","id":"12515934","filename":"pom.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkorab","name":"jkorab","key":"jkorab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkorab&avatarId=13437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkorab&avatarId=13437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkorab&avatarId=13437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkorab&avatarId=13437"},"displayName":"Jakub Korab","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-24T16:08:56.336+0000","size":1587,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12515934/pom.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81447","customfield_12312823":null,"summary":"Cursors not dealing with topic memoryLimit overflow","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkorab","name":"jkorab","key":"jkorab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkorab&avatarId=13437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkorab&avatarId=13437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkorab&avatarId=13437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkorab&avatarId=13437"},"displayName":"Jakub Korab","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkorab","name":"jkorab","key":"jkorab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkorab&avatarId=13437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkorab&avatarId=13437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkorab&avatarId=13437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkorab&avatarId=13437"},"displayName":"Jakub Korab","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"OSX, Apple Java Runtime 1.6.0_26","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544010/comment/13218032","id":"13218032","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"body":"IIRC then producer flow control will kick in. Paging out to disk only happens when 100% of the memoryLimit are used. At that same time producer flow control will kick in as well because of the 100% limit being reached. Paging to disk will only occur if producer flow control is disabled. \nBut I presume the limit at which paging to disk happens may be configurable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-28T09:53:32.360+0000","updated":"2012-02-28T09:53:32.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544010/comment/13218286","id":"13218286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkorab","name":"jkorab","key":"jkorab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkorab&avatarId=13437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkorab&avatarId=13437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkorab&avatarId=13437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkorab&avatarId=13437"},"displayName":"Jakub Korab","active":true,"timeZone":"Etc/UTC"},"body":"I ran the same thing with PFC turned off. VisualVM shows MemoryPercentUsage on the topic steadily rise to 100%, then drop to 0%. No further messages are dequeued or enqueued.\n\nOnly difference to earlier attached config was:\n\n<policyEntry topic=\">\" producerFlowControl=\"false\" memoryLimit=\"1mb\">","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkorab","name":"jkorab","key":"jkorab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkorab&avatarId=13437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkorab&avatarId=13437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkorab&avatarId=13437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkorab&avatarId=13437"},"displayName":"Jakub Korab","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-28T15:42:23.315+0000","updated":"2012-02-28T15:42:23.315+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544010/comment/13226128","id":"13226128","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"body":"I modified the test case testFillTempAndConsume in http://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/bugs/TempStorageBlockedBrokerTest.java?view=markup&pathrev=1233367 to use a topic instead of a queue and it failed.\n\nIs this the same issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-09T15:21:15.574+0000","updated":"2012-03-09T15:21:35.037+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544010/comment/13228306","id":"13228306","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"body":"From posting on the mailing list I found that I needed to add setting the topic prefetch policy on my connection factories to enable temp storage with topics and non-persistent messages so my previous comment was incorrect.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manderson23%40gmail.com","name":"manderson23@gmail.com","key":"manderson23@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Anderson","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-13T10:52:11.121+0000","updated":"2012-03-13T10:52:11.121+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544010/comment/13458624","id":"13458624","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Whats the status of this ticket?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-19T12:21:29.045+0000","updated":"2012-09-19T12:21:29.045+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3738/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0eaef:"}}