{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12518840","self":"https://issues.apache.org/jira/rest/api/2/issue/12518840","key":"AMQ-3451","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321258","id":"12321258","description":"Next v5 maintenance release","name":"5.7.0","archived":false,"released":true,"releaseDate":"2012-10-08"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-09-01T14:48:53.610+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Sep 12 09:02:28 UTC 2012","customfield_12310420":"60650","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_51764660_*|*_6_*:*_1_*:*_130370_*|*_5_*:*_2_*:*_22963_*|*_4_*:*_1_*:*_33774956609","customfield_12312321":null,"resolutiondate":"2012-09-09T08:39:38.727+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3451/watchers","watchCount":15,"isWatching":false},"created":"2011-08-14T20:18:24.152+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["leak","resource"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[{"id":"12342216","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12342216","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12483952","key":"AMQ-2852","self":"https://issues.apache.org/jira/rest/api/2/issue/12483952","fields":{"summary":"Memory leak when undeploying webapp with ActiveMQ client","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12355807","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12355807","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12601450","key":"AMQ-3962","self":"https://issues.apache.org/jira/rest/api/2/issue/12601450","fields":{"summary":"Memory leak bacause of InactivityMonitor thread","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12355774","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12355774","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12601350","key":"AMQ-3959","self":"https://issues.apache.org/jira/rest/api/2/issue/12601350","fields":{"summary":"Memory leak caused by org.apache.activemq.util.StringArrayEditor","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12357535","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12357535","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12606761","key":"AMQ-4033","self":"https://issues.apache.org/jira/rest/api/2/issue/12606761","fields":{"summary":"AMQ Broker - Uses custom RMIServerSocketFactory class which cannot be unloaded due socket reuse","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12494429","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12494429","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13043532","key":"AMQ-6602","self":"https://issues.apache.org/jira/rest/api/2/issue/13043532","fields":{"summary":"Memory leak when undeploying webapp with ActiveMQ client","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12357221","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12357221","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12605552","key":"AMQ-4008","self":"https://issues.apache.org/jira/rest/api/2/issue/12605552","fields":{"summary":"Tomcat WARN on shutdown about ThreadLocal not cleared from log4j","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-02-16T08:02:41.176+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Every time when restarting web application in Tomcat Manager I get messages:\n\nSEVERE: The web application [/sms] appears to have started a thread named [ActiveMQ Task-3] but has failed to stop it. This is very likely to create a memory leak.\n\nWith every restart PermGen space is increased and finally i got OutOfMemory error for PermGen space.\n\nI use Spring DefaultMessageListenerContainer, and it's shutdown method closes properly receivers threads. What is \"ActiveMQ Task-3\" thread and how to close it properly ?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12543651","id":"12543651","filename":"activemq-core-5.7-SNAPSHOT.jar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-04T10:50:13.539+0000","size":4029586,"mimeType":"application/java-archive","content":"https://issues.apache.org/jira/secure/attachment/12543651/activemq-core-5.7-SNAPSHOT.jar"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12543537","id":"12543537","filename":"AMQ-3451-broker.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-03T12:05:14.775+0000","size":6921,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12543537/AMQ-3451-broker.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12543548","id":"12543548","filename":"AMQ-3451-broker2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-03T13:40:36.073+0000","size":11167,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12543548/AMQ-3451-broker2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12543650","id":"12543650","filename":"AMQ-3541-3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-04T10:50:13.537+0000","size":29139,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12543650/AMQ-3541-3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12539034","id":"12539034","filename":"inherited_access_cotrol_context_leak.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T12:15:31.756+0000","size":298989,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12539034/inherited_access_cotrol_context_leak.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12539044","id":"12539044","filename":"patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T13:15:37.983+0000","size":2162,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12539044/patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12538954","id":"12538954","filename":"transport_thread_leak.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-02T21:18:17.113+0000","size":509348,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12538954/transport_thread_leak.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59360","customfield_12312823":null,"summary":"Tomcat 6.0.32 complains that ActiveMQ 5.5 doesn't shutdown a thread","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"jdk 1.6.0_23 for Linux 64 bit, Ubuntu 11.04\nTomcat 6.0.32\nSpring 3.0.5\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13084896","id":"13084896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"body":"My connection factory is declared in web.xml\n\n<!-- Standalone ActiveMQ -->       \n     <Resource name=\"jms/connectionFactory\" auth=\"Container\" type=\"org.apache.activemq.ActiveMQConnectionFactory\"\n            description=\"Repository JMS Connection Factory\" factory=\"org.apache.activemq.jndi.JNDIReferenceFactory\"\n            brokerURL=\"failover:(tcp://localhost:61616)?timeout=3000&amp;jms.redeliveryPolicy.maximumRedeliveries=2&amp;jms.redeliveryPolicy.initialRedeliveryDelay=3000L&amp;jms.redeliveryPolicy.useExponentialBackOff=false\"\n            brokerName=\"LocalActiveMQBroker\"/>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-14T20:22:11.336+0000","updated":"2011-08-14T20:22:11.336+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13085016","id":"13085016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"body":"Duplicate of https://issues.apache.org/jira/browse/AMQ-2852","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-15T10:41:08.761+0000","updated":"2011-08-15T10:41:08.761+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13085017","id":"13085017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"body":"Duplicate","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-15T10:41:31.759+0000","updated":"2011-08-15T10:41:31.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13085019","id":"13085019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"body":"Linked a similar issue, not sure if this is a duplicate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=beowulf","name":"beowulf","key":"beowulf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"John Miller","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-15T10:47:43.402+0000","updated":"2011-08-15T10:47:43.402+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13095327","id":"13095327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"does calling: org.apache.activemq.thread.DefaultThreadPools#shutdown work for you? I guess it would need to be part of a javax.servlet.ServletContextListener or called as part of the shutdown of your message listener container.\nI guess we would need to include a little helper class to make it easier to configure.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-01T14:48:53.610+0000","updated":"2011-09-01T14:48:53.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13104531","id":"13104531","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravimbhatt","name":"ravimbhatt","key":"ravimbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ravi bhatt","active":true,"timeZone":"Etc/UTC"},"body":"I am having similar issue where tomcat does not shut down properly because of activemq threads. \n\nI tried above solution org.apache.activemq.thread.DefaultThreadPools#shutdown, it does not help. I called this inside my contextDestroyed in tomcat, and it makes no difference to the situation.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravimbhatt","name":"ravimbhatt","key":"ravimbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ravi bhatt","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-14T14:38:16.758+0000","updated":"2011-09-14T14:38:16.758+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13104532","id":"13104532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravimbhatt","name":"ravimbhatt","key":"ravimbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ravi bhatt","active":true,"timeZone":"Etc/UTC"},"body":"and BTW i have tested this on tomcat 5, 6 and 7 with activemq 5.5.0\n\nThe situation happens only when there were messages on the queue and messages where being processed inside onMessage of a listener. If there are no messages on the queue, it shuts down properly if we call connection close etc in cotextDestroyed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ravimbhatt","name":"ravimbhatt","key":"ravimbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ravi bhatt","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-14T14:39:10.153+0000","updated":"2011-09-14T14:41:32.099+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13128557","id":"13128557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=javich","name":"javich","key":"javich","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Javier Molina","active":true,"timeZone":"Australia/Sydney"},"body":"In my case the message appears regardless of the queue(s) being empty.\n\nUsing activemq 5.5 with camel 2.8 and spring 3.0.5 deployed to tomcat 6.0.32\n\nBroker is set up locally using activemq camel component.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=javich","name":"javich","key":"javich","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Javier Molina","active":true,"timeZone":"Australia/Sydney"},"created":"2011-10-17T01:23:43.018+0000","updated":"2011-10-17T01:23:43.018+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13138391","id":"13138391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbakhti","name":"mbakhti","key":"mbakhti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"MBakhti","active":true,"timeZone":"Etc/UTC"},"body":"I have the same issue in Activemq 5.5. \nI tried :\n \nbroker.getTaskRunnerFactory().shutdown();\nbroker.getPersistenceTaskRunnerFactory().shutdown();\nbroker.stop();\nbroker.waitUntilStopped();\nScheduler.shutdown();\n\nbut it doesn't change anything \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbakhti","name":"mbakhti","key":"mbakhti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"MBakhti","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-28T14:17:22.210+0000","updated":"2011-10-28T14:17:22.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13170863","id":"13170863","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreas%40apache.org","name":"andreas@apache.org","key":"andreas@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Hartmann","active":true,"timeZone":"Etc/UTC"},"body":"For me the following seems to work:\n\nInterrupt the TCP transport socket handler daemon thread:\n\n----\n\nIndex: activemq-core/src/main/java/org/apache/activemq/transport/tcp/TcpTransportServer.java\n===================================================================\n--- activemq-core/src/main/java/org/apache/activemq/transport/tcp/TcpTransportServer.java\t(revision 1214868)\n+++ activemq-core/src/main/java/org/apache/activemq/transport/tcp/TcpTransportServer.java\t(working copy)\n@@ -380,6 +380,8 @@\n         if (serverSocket != null) {\n             serverSocket.close();\n         }\n+        this.socketHandlerThread.interrupt();\n+        this.socketHandlerThread = null;\n     }\n----\n\nShutdown the task runner factory in a servlet context listener:\n\n----\n\npublic class CleanupAmqThreads implements ServletContextListener {\n\n     @Override\n         public void contextInitialized(ServletContextEvent sce) {\n     }\n\n     @Override\n     public void contextDestroyed(ServletContextEvent sce) {\n         DefaultThreadPools.getDefaultTaskRunnerFactory().shutdown();\n     }\n}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreas%40apache.org","name":"andreas@apache.org","key":"andreas@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Hartmann","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-16T09:39:03.581+0000","updated":"2011-12-16T09:45:54.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13172356","id":"13172356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Looked at some similar issue, and it seems to me it's just Tomcat doesn't like threads created for async closing of activemq connections. Try using URLs like\n\n{code}failover:(tcp://localhost:61616?closeAsync=false){code}\n\nand see if it helps.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2011-12-19T15:55:04.833+0000","updated":"2011-12-19T15:55:04.833+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13184829","id":"13184829","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nilsga","name":"nilsga","key":"nilsga","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nils-Helge Garli","active":true,"timeZone":"Etc/UTC"},"body":"Same problem, using Active MQ 5.5.1. Tried with \"closeAsync=false\" which didn't seem to make any difference.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nilsga","name":"nilsga","key":"nilsga","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nils-Helge Garli","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-12T08:48:22.878+0000","updated":"2012-01-12T08:48:22.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13268345","id":"13268345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=grambal","name":"grambal","key":"grambal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guilhem RAMBAL","active":true,"timeZone":"Europe/Paris"},"body":"Hello,\n\nHave you got a workaround to solve this issue ?\n\nSincerely","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=grambal","name":"grambal","key":"grambal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guilhem RAMBAL","active":true,"timeZone":"Europe/Paris"},"created":"2012-05-04T13:18:22.434+0000","updated":"2012-05-04T13:18:22.434+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13413543","id":"13413543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"body":"I have same issue after stop my application by Tomcat.\nI don't know why ActiveMQ team doesn't fix it for a long time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-13T07:30:05.520+0000","updated":"2012-07-13T07:30:05.520+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13415845","id":"13415845","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"body":"I crated a war to reproduce this issue. Please refer to http://activemq.2283324.n4.nabble.com/Old-issue-Memory-leak-after-stop-web-application-in-Tomcat-tp4653959p4654028.html. Hope this is helpful.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-17T02:09:52.530+0000","updated":"2012-07-17T02:09:52.530+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13416044","id":"13416044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@liny, thanks for that test case war. Peeking at the code, I think the problem is related to the code in com.foo.MainApplication#stop\n\nThat closes the connection, (returns them to the pool), but does not stop the connection pool. It does however stop the executors, and this prevents the real close of the connections when the spring context calls the custom stop destroy method. This is evident from the {{ERROR o.a.a.transport.tcp.TcpTransport - Could not stop service: tcp://foo.com/15.87.14.93:61616. Reason: java.util.concurrent.RejectedExecutionException}} exception.\n\nSo you can explicitly call close on the connection pool, like:\n{code}conn.close();\n((PooledConnectionFactory) springHelper.getBean(\"pooledJmsFactory\")).stop();\nDefaultThreadPools.getDefaultTaskRunnerFactory().shutdown();\nDefaultThreadPools.shutdown();{code}\nor somehow arrange it such that the calls to {{shutdown()}} are done when the spring context is destroyed. So after the connection pool is successfully destroyed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-17T09:44:48.258+0000","updated":"2012-07-17T09:44:48.258+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13416089","id":"13416089","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"body":"@Gary \nThanks for reply. Directly call below method in my stop() still can't work.\n{noformat}\n((PooledConnectionFactory) springHelper.getBean(\"pooledJmsFactory\")).stop();\n{noformat}\nPlease refer to http://activemq.2283324.n4.nabble.com/Old-issue-Memory-leak-after-stop-web-application-in-Tomcat-tp4653959p4654084.html for details.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-17T11:10:36.869+0000","updated":"2012-07-17T11:13:27.751+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13427617","id":"13427617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"The problem is that when you put ActiveMQ libraries into Tomcat shared \"lib\" folder, then ActiveMQ  thread pool becomes shared between all web applications. When a web application sends a message, then a transport thread is created by a web application, then the thread is returned to the pool. Then the web application is undeployed,  the thread remains alive in the pool and can be re-used by another applicaiton. In results into a memory leak, because the thread is still alive after undeployment of web application and references the web application context classloader.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-02T21:16:44.462+0000","updated":"2012-08-02T21:16:44.462+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13427619","id":"13427619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"Attached a screenshot with profiler which clearly shows a memory leak.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-02T21:18:17.141+0000","updated":"2012-08-02T21:18:17.141+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13427629","id":"13427629","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"However, when I removed ActiveMQ libraries from tomcat shared libraries and packaged them into WAR, the problem has gone because each web application now has its own ActiveMQ thread pool.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-02T21:23:12.504+0000","updated":"2012-08-02T21:23:12.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13427633","id":"13427633","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"You can't call org.apache.activemq.thread.DefaultThreadPools#shutdown when ActiveMQ libraries are in Tomcat shared libs, because calling that method will shutdown the shared thread pool, and  all other web application deployed to the same Tomcat will be unable to send any JMS messages. You can do that when ActiveMQ libraries are packaged into web application only.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-02T21:27:28.186+0000","updated":"2012-08-02T21:28:13.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13427643","id":"13427643","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"Whether you have a memory leak or not depends on how fast you re-load or re-deploy applications and how intense ActiveMQ is used by other web applications on the same tomcat. Sometimes \"ActiveMQ Transport\" or \"ActiveMQ Task\" thread is terminated by inactivity, and in that case you don't have a memory leak. Most of the time you have a memory leak when deploying ActiveMQ to Tomcat shared libs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-02T21:38:25.582+0000","updated":"2012-08-02T21:38:25.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13427872","id":"13427872","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"The problem is in org.apache.activemq.thread.TaskRunnerFactory#executor. The thread pool's keepAliveTime is 30 seconds. If you have a single web application in Tomcat which uses JMS, and\n you re-start (or re-deploy) your web application in an interval less that 30 seconds, then the thread is not terminated and re-used, the thread references the undeployed web applicaiton classloader and JVM cannot collect undeployed application and free PermGen memory area.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T07:10:55.317+0000","updated":"2012-08-03T07:10:55.317+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13427938","id":"13427938","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@Sergey this is great information\n\nSo the crux seems to be the classloader reference, if the pool is to be shared then it must not refer to an app specific loader. Do you understand the nature of that reference?\n\nThe alternative approach is to remove the use of the statically defined default task runner factory from client side code and use one per connection factory.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T09:42:55.236+0000","updated":"2012-08-03T09:42:55.236+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13427981","id":"13427981","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"@Gary\n\nYes, I understand the nature of the reference. When ActiveMQ thread pool creates a new thread, then the thread inherits the current thread context classloder. When the client web application is creating a JMS connection, then the context classloder is Tomcat WebAppClassLoader. As long as the thread is alive, it references web application classloader. The thread can be re-used by another web application while still holding a reference to the undeployed web application which created the thread.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T10:42:52.239+0000","updated":"2012-08-03T10:42:52.239+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13427996","id":"13427996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"hmm, ok. so it sounds like a sensible fix is to clear and reset the tccl in the thread factory such that it is not inherited by the activemq task runner threads.\nI just wonder if that behavior will break any clients, am thinking cxf and jaxb or in servicemix etc. It may need to be configurable via a system property just incase.\nfancy taking a stab at a patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T11:15:35.268+0000","updated":"2012-08-03T11:15:35.268+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13428000","id":"13428000","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"Found another memory leak, see AMQ-3959","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T11:33:50.847+0000","updated":"2012-08-03T11:35:43.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13428012","id":"13428012","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"@Gary\n\nOk, I will try to set tccl to null and then will run the memory profiler again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T12:01:28.451+0000","updated":"2012-08-03T12:01:48.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13428020","id":"13428020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"I have tried the patch below\n-------------------------\nIndex: activemq-core/src/main/java/org/apache/activemq/thread/TaskRunnerFactory.java\n===================================================================\n--- activemq-core/src/main/java/org/apache/activemq/thread/TaskRunnerFactory.java       (revision 1366667)\n+++ activemq-core/src/main/java/org/apache/activemq/thread/TaskRunnerFactory.java       (working copy)\n@@ -108,6 +108,8 @@\n                 Thread thread = new Thread(runnable, name + \"-\" + id.incrementAndGet());\n                 thread.setDaemon(daemon);\n                 thread.setPriority(priority);\n+                thread.setContextClassLoader(null);\n                 return thread;\n             }\n         });\n-------------------------\n\nStill have memory leak, now because of inherited access control context, see the screenshot.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T12:15:31.788+0000","updated":"2012-08-03T12:15:53.752+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13428065","id":"13428065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"Attached a patch which cleans the thread's context classloader and inherited security context.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T13:15:38.034+0000","updated":"2012-08-03T13:15:38.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13428097","id":"13428097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nIs the solution is one of bellows?\n1. Killed all sessions, wait more than 30 secs, then thread pool will kill himself.\n2. Use patch.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T14:03:09.249+0000","updated":"2012-08-03T14:03:09.249+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13428118","id":"13428118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"body":"@Sergey\n\nNo, I didn't put ActiveMQ Lib in tomcat share lib directory. So your solutions work, right? If yes, really appreciated. I'll try soon!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T14:26:16.541+0000","updated":"2012-08-03T14:26:16.541+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13428126","id":"13428126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"@liny\n\nI you didn't put ActiveMQ lib in tomcat shared lib, then I don't understand why you have a memory leak, because when I package ActiveMQ libs to WEB-INF/lib, then I don't have any memory leaks except AMQ-3959. \nYou need to deploy your web application, then stop it in Tomcat Manager, then use Eclipse Memory Analysis tool, take a heap dump, open histogram, group by clasloader, then find paths to GC root for WebAppClassLoader. When done, you will know for sure the cause of  the memory leak.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T14:34:52.356+0000","updated":"2012-08-03T14:35:16.913+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13428135","id":"13428135","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"body":"@Sergey\n\nMy situation is described at http://activemq.2283324.n4.nabble.com/Old-issue-Memory-leak-after-stop-web-application-in-Tomcat-tp4653959p4654028.html with a simple web app. Would you like to try to see if you can see the same problem like me? Eclipse Memory Analysis looks a good tool, will try it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liny","name":"liny","key":"liny","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liny","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T14:49:48.831+0000","updated":"2012-08-03T14:49:48.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13428167","id":"13428167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"body":"@liny\n\nI have downloaded the application from https://docs.google.com/open?id=0B-ZFcczN9qxYZmh5dDdoMFVCUkE, and analyzed the heap dump.\n\nI don't see any memory leaks related to threads, the only memory leak with your web application is  AMQ-3959","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sgri","name":"sgri","key":"sgri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T15:09:23.995+0000","updated":"2012-08-03T15:10:36.895+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13430390","id":"13430390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"body":"@Sergey\n\nThe issue is more fundamental than your patch.  Those threads are created by the default task runner factory and this factory is created once and then never shutdown throwout the life time of the process. \n\nAdding a shutdown of the default task runner will remove this issue but will raise another issue when using the shared classloader of the application server with multiple containers.\n\nThe default task runner should be associated with the broker server and not a self contained static class.  This should resolve the case of its use within the broker side code but will not resolve this issue within the client side issue.  That needs a little more work on getting this to work properly.\n\nI have tried to shutdown the default task runner factory fix but when I hot deploy the container again.  It raises a rejected exception when trying to add a task to the runner since this executor has been shutdown already.\n\nI tried a fix to associates a default task runner factory to the broker and that resolved the issue I was initially seeing.\n\nI still have an issue with the client code that uses the default task runner factory.  This still needs work on my end and will probably require a different fix that would provide a similar solution.  I was thinking about using WeakReferences associated with a ReferenceQueue.  Whenever the remove method is called the task runner factory can be shutdown.  This might work.  I just need to implement this.\n\n--Claudio\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"created":"2012-08-07T16:08:48.746+0000","updated":"2012-08-07T16:08:48.746+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13446121","id":"13446121","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"body":"When can we expect a solution to this issue ? We are facing the same issue on Tomcat7 as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-31T16:48:03.586+0000","updated":"2012-08-31T16:48:03.586+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447162","id":"13447162","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"If people only run 1 broker in the JVM, we could as a temporary fix, add some flag/option/whatever to tell the broker, to shutdown these thread pools when the BrokerService is shutdown.\n\nIts of course a bit tricker when its a JMS client, as that would be some stop logic in a ConnectionFactory or the likes, to get a callback when to shutdown.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-03T08:41:49.246+0000","updated":"2012-09-03T08:41:49.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447171","id":"13447171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"The org.apache.activemq.thread.DefaultThreadPools seems to be used in 2 areas\n- by the broker a bit\n- transports\n\nThe code for the broker, can be refactored to use a broker specific executor, so when the broker shutdown, those threads will be shutdown as well. That should be doable\n\nThe transports can be used by JMS clients as well, so I wonder as Gary says, can we use a dedicated thread pool (executor service) *per* transport?\nIf that would be doable, then we have start|stop callbacks on the transports, where we can ensure the thread pool is setup / shutdown properly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-03T08:57:03.705+0000","updated":"2012-09-03T08:57:03.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447238","id":"13447238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"I have attached a patch to fix the part that is used by the broker, to use the executor the broker itself provides.\n\nAnyone see a problem with that? The unit tests passes, and a brief spin of running a standalone broker seems fine.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-03T12:05:14.776+0000","updated":"2012-09-03T12:05:14.776+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447251","id":"13447251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"body":"Hello Claus,\n\nWould it be possible to attach the updated ActiveMQ jar please.Also let me know which version of ActiveMQ are you using.\nI am trying the 5.7.snapshot since it has the new DefaultThreadPools.getDefaultTaskRunnerFactory().shutdown(); method but still Tomcat7 fails to shutdown cleanly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-03T12:50:51.821+0000","updated":"2012-09-03T12:50:51.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447262","id":"13447262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"The ASF CI server will once in a while deploy a new SNAPSHOT you can download. Keep an eye on\nhttps://builds.apache.org/job/ActiveMQ-Trunk-Deploy/\n\nThe attached patch only fixes on the broker side, there is still all the transports. I am continuing on the patch, taking one step at a time. Currently testing with 2 more fixes for discover agent and another place. Then next is the remainder 7 transports using it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-03T13:17:33.388+0000","updated":"2012-09-03T13:17:33.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447274","id":"13447274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Patch with more fixes. Only the transports to go now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-03T13:40:36.074+0000","updated":"2012-09-03T13:40:36.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447299","id":"13447299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"body":"Thank you very much for working on this issue.I'll check the builds page.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-03T14:50:37.770+0000","updated":"2012-09-03T14:50:37.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447575","id":"13447575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Okay got as far with a JMS client in Tomcat now not reporting any leaks from its console, when I stop the app or redeploy it.\n> \nMessage: \t\nNo web applications appear to have triggered a memory leak on stop, reload or undeploy.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-04T09:18:45.293+0000","updated":"2012-09-04T09:18:45.293+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447576","id":"13447576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"With an embedded AMQ broker I still get this\n\n> The following web applications were stopped (reloaded, undeployed), but their\nclasses from previous runs are still loaded in memory, thus causing a memory\nleak (use a profiler to confirm):\n/camel-example-activemq-tomcat","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-04T09:21:41.132+0000","updated":"2012-09-04T09:21:41.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447609","id":"13447609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Patch with transport connections fixes. I also attached the core JAR for people to give a try. The other SNAPSHOT jars are in maven snapshot repo, where you can download them. As no fixes has yet been committed to the codebase.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-04T10:50:13.540+0000","updated":"2012-09-04T10:50:13.540+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13447726","id":"13447726","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"I discovered a leak in Camel, when JMX is enabled. \nhttps://issues.apache.org/jira/browse/CAMEL-5564","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-04T14:38:10.735+0000","updated":"2012-09-04T14:38:10.735+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13448865","id":"13448865","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"First part of patch is committed to the code base. The connector/transport code need a bit more love, as they tend to either create the pools in ctr / start or stop lifecycle methods. The code could possible be more consistent among them.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-05T16:30:20.360+0000","updated":"2012-09-05T16:30:20.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13449862","id":"13449862","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Okay AMQ-4026 is now committed, so we have a better API for shutting down thread pools. Will work on getting the patches in the codebase, so the JMS Client work well in Tomcat when re-deploying apps. \n\nA fully embedded ActiveMQ broker in Tomcat has a number of more pools and other parts in the works, eg such as JMX and whatnot that can cause a bit pain, eg to ensure all JMX stuff is properly unregistered and whatnot. \n\nFirst priority is the JMS client though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-06T17:57:08.054+0000","updated":"2012-09-06T17:57:08.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13450546","id":"13450546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Okay got the JMS client leak fixed and committed to trunk. No leaks reported by Tomcat, and the WebappClassLoader did not have any strong references to any classes anymore. So seems we can fully undeploy/redeploy without leaks now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-07T12:00:02.258+0000","updated":"2012-09-07T12:00:02.258+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13450678","id":"13450678","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Okay got further on the embedded broker side. Got a classloader leak fixed due a spring introspection cache, needed to be explicit cleared.\nThe tomcat manager console now says there is no leaks. And all activemq and camel classes is fully unloaded when stopping the app.\n\nOne last thing would be a JMX thread not being shutdown on the broker side.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-07T14:50:22.848+0000","updated":"2012-09-07T14:50:22.848+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13450843","id":"13450843","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"body":"We tried the 6th September build and our issues with ActiveMQ task runner threads have been fixed.Thank you.\nWhen can we expect the official version of ActiveMQ-5.7 to be released ?\nAlso could anybody please comment on AMQ-4030.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-07T18:14:39.533+0000","updated":"2012-09-07T18:14:39.533+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13451543","id":"13451543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"I created AMQ-4033 for the issue with the embedded AMQ broker. The JMS client now shutdown all the threads, and can be unloaded by the classloader etc.\n\nAbout the AMQ 5.7 release, then this should be discussed at the AMQ mailing list such as either the dev or user.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-09T08:39:38.751+0000","updated":"2012-09-09T08:39:38.751+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518840/comment/13453845","id":"13453845","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"body":"ok,thank you.Will mail the user mailing list.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nimmi","name":"nimmi","key":"nimmi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"nimmi","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-12T09:02:28.687+0000","updated":"2012-09-12T09:02:28.687+0000"}],"maxResults":55,"total":55,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3451/votes","votes":11,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0aj1z:"}}