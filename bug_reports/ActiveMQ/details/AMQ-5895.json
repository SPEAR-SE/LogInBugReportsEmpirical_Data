{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12845910","self":"https://issues.apache.org/jira/rest/api/2/issue/12845910","key":"AMQ-5895","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329258","id":"12329258","name":"5.12.0","archived":false,"released":true,"releaseDate":"2015-08-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-07-17T22:25:10.208+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 29 11:50:58 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1023363581_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-07-29T11:50:58.110+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5895/watchers","watchCount":4,"isWatching":false},"created":"2015-07-17T15:34:54.568+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["runtime-configuration","virtualDestinations"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-07-29T11:50:58.142+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When adding a FilteredDestination to VirtualDestinations in activemq.xml, the runtimeConfigurationPlugin will not update the configuration correct for the filteredDestination. The log does not give any errors until we send a message towards the CompositeTopic/Queue that contains the FilteredDestination, then the message is not forwarded and the following error is written in the log:\n{code}java.lang.IllegalArgumentException: Unknown mapped destination type java.lang.Object@7a141450\n        at org.apache.activemq.broker.region.virtual.CompositeDestination.getMappedDestinations(CompositeDestination.java:124)[activemq-broker-5.11.1.jar:5.11.1] {code}\n\nIt works if we restart activeMQ, because then the configuration is not loaded by the runtimeConfigurationPlugin, however we really want to avoid that.\n\nSolution: It seems that the translation from JAXB objects to ActiveMQ objects is not translating DtoFilteredDestination to FilteredDestinations in org.apache.activemq.plugin.JAXBUtils.\n\nWhen I added the following code to the method \"inferTargetObject\", then the problem was solved:\n{code}\n        } else if (DtoFilteredDestination.class.isAssignableFrom(elementContent.getClass())) {\n            return new FilteredDestination();\n{code}\n\nWhy this matters: In my organisation we really like to use ActiveMQ VirtualDestinations with FilteredDestinations, because it is a much more minimalistic than having to make many simple subscriptions in Camel and it has many benefits compared to durable subscribers. However, we do not wish to restart ActiveMQ every time we modify the VirtualDestinations, hence we need to be able to updated the VirtualDestinations using runtimeConfigurationPlugin and this does not work right now due to this bug.\n\nI have added some files to this issue: a patch file, a full stacktrace and some steps to reproduce the problem.\n\nPerhaps I can also commit the bug fix myself if that can speed up the process.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12746032","id":"12746032","filename":"activemq.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AndersAaberg","name":"AndersAaberg","key":"andersaaberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andersaaberg&avatarId=24670","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andersaaberg&avatarId=24670","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andersaaberg&avatarId=24670","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andersaaberg&avatarId=24670"},"displayName":"Anders Aaberg","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-19T22:26:06.150+0000","size":12540,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12746032/activemq.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12745829","id":"12745829","filename":"stacktrace.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AndersAaberg","name":"AndersAaberg","key":"andersaaberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andersaaberg&avatarId=24670","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andersaaberg&avatarId=24670","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andersaaberg&avatarId=24670","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andersaaberg&avatarId=24670"},"displayName":"Anders Aaberg","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-17T15:37:16.495+0000","size":3474,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12745829/stacktrace.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12745831","id":"12745831","filename":"steps_to_reproduce.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AndersAaberg","name":"AndersAaberg","key":"andersaaberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andersaaberg&avatarId=24670","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andersaaberg&avatarId=24670","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andersaaberg&avatarId=24670","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andersaaberg&avatarId=24670"},"displayName":"Anders Aaberg","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-17T15:47:36.320+0000","size":1022,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12745831/steps_to_reproduce.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"FilteredDestinations do not work when loaded by runtimeConfigurationPlugin","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AndersAaberg","name":"AndersAaberg","key":"andersaaberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andersaaberg&avatarId=24670","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andersaaberg&avatarId=24670","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andersaaberg&avatarId=24670","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andersaaberg&avatarId=24670"},"displayName":"Anders Aaberg","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AndersAaberg","name":"AndersAaberg","key":"andersaaberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andersaaberg&avatarId=24670","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andersaaberg&avatarId=24670","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andersaaberg&avatarId=24670","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andersaaberg&avatarId=24670"},"displayName":"Anders Aaberg","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Both windows / linux, IBM java 6 / Oracle Java 7","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845910/comment/14632027","id":"14632027","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"thanks for the patch. if you add a junit test case it will be golden! ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-17T22:25:10.208+0000","updated":"2015-07-17T22:25:10.208+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845910/comment/14632943","id":"14632943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AndersAaberg","name":"AndersAaberg","key":"andersaaberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andersaaberg&avatarId=24670","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andersaaberg&avatarId=24670","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andersaaberg&avatarId=24670","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andersaaberg&avatarId=24670"},"displayName":"Anders Aaberg","active":true,"timeZone":"Etc/UTC"},"body":"The fix is in JAXBUtils.java - the rest is unittest.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AndersAaberg","name":"AndersAaberg","key":"andersaaberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andersaaberg&avatarId=24670","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andersaaberg&avatarId=24670","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andersaaberg&avatarId=24670","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andersaaberg&avatarId=24670"},"displayName":"Anders Aaberg","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-19T22:26:06.154+0000","updated":"2015-07-19T22:26:06.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845910/comment/14632948","id":"14632948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AndersAaberg","name":"AndersAaberg","key":"andersaaberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andersaaberg&avatarId=24670","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andersaaberg&avatarId=24670","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andersaaberg&avatarId=24670","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andersaaberg&avatarId=24670"},"displayName":"Anders Aaberg","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for the quick reply and sorry about the missing test. I have extended VirtualDestTest (added a unittest that tests basic composite queue filtering and update using runtimeConfigurationPlugin) such that the test will fail if the fix is not implemented in the JABXUtils class. I have updated the activemq.patch file to also include the unittest.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AndersAaberg","name":"AndersAaberg","key":"andersaaberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andersaaberg&avatarId=24670","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andersaaberg&avatarId=24670","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andersaaberg&avatarId=24670","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andersaaberg&avatarId=24670"},"displayName":"Anders Aaberg","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-19T22:34:11.681+0000","updated":"2015-07-19T22:34:11.681+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845910/comment/14645914","id":"14645914","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 4a603a9936b1880eba501d7f0e6fff812ae29d2f in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4a603a9 ]\n\nAMQ-5895 - apply patch with thanks to Anders Aaberg\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-29T11:49:56.220+0000","updated":"2015-07-29T11:49:56.220+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845910/comment/14645916","id":"14645916","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Patch (with lovely test) applied with thanks :-)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-29T11:50:58.138+0000","updated":"2015-07-29T11:50:58.138+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5895/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2he2f:"}}