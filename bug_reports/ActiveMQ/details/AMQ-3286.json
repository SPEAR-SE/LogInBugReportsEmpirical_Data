{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12504649","self":"https://issues.apache.org/jira/rest/api/2/issue/12504649","key":"AMQ-3286","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2011-07-06T18:39:10.525+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 12 19:41:46 UTC 2011","customfield_12310420":"65157","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_6762737086_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-06T18:39:10.202+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3286/watchers","watchCount":2,"isWatching":false},"created":"2011-04-19T12:06:53.685+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-08-12T19:41:46.832+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I'm having some issues with ActiveMQ Connection Dispatcher threads. Whenever I get an InactivityIOException the thread goes into the Waiting state and a new thread is started.\n\n== activemq.log ==\n2011-04-18 10:15:31,244 | ERROR | Could not accept connection : org.apache.activemq.transport.InactivityIOException: Channel was inactive for too long: /127.0.0.1:35401 | org.apache.activemq.broker.TransportConnector | ActiveMQ Task\n\n== jstack ==\n\"ActiveMQ Connection Dispatcher: /127.0.0.1:35401\" daemon prio=10\ntid=0x00007f10e440f800 nid=0x63e9 in Object.wait() [0x00007f10ce578000]\n   java.lang.Thread.State: WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        at java.lang.Object.wait(Object.java:485)\n        at\norg.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:105)\n        - locked <0x00007f113bbd4618> (a java.lang.Object)\n        at\norg.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\n\nAfter running ActiveMQ for a couple of weeks there are more than 3k waiting threads doing nothing but wasting memory. If i disable the inactivity monitor the problem goes away (wireFormat.maxInactivityDuration=0).","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"119680","customfield_12312823":null,"summary":"ActiveMQ Connection Dispatcher thread","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=splebel","name":"splebel","key":"splebel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon-Pierre LeBel","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=splebel","name":"splebel","key":"splebel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon-Pierre LeBel","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"== Java ==\njava version \"1.6.0_20\"\nJava(TM) SE Runtime Environment (build 1.6.0_20-b02)\nJava HotSpot(TM) 64-Bit Server VM (build 16.3-b01, mixed mode)\n\n== ActiveMQ ==\n- Versions: 5.3.0 and 5.3.2\n- Pure Master/Slave\n- Openwire enabled\n- FlowControl enabled\n- KahaDB","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504649/comment/13060752","id":"13060752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Tried a couple different tests but couldn't reproduce this issue, if you have a test case that can demonstrate the issue please reopen and attach it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-07-06T18:39:10.525+0000","updated":"2011-07-06T18:39:10.525+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504649/comment/13082562","id":"13082562","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Active MQ 5.3.2\n\njava version \"1.6.0_23\"\nJava(TM) SE Runtime Environment (build 1.6.0_23-b05)\nJava HotSpot(TM) Server VM (build 19.0-b09, mixed mode)\n\nLSB Version:    :core-3.1-amd64:core-3.1-ia32:core-3.1-noarch:graphics-3.1-amd64:graphics-3.1-ia32:graphics-3.1-noarch\nDistributor ID: CentOS\nDescription:    CentOS release 5.5 (Final)\nRelease:        5.5\nCodename:       Final\n\nI don't know how to reproduce with a test case, but I have found 800+ of such \"ActiveMQ Connection Dispatcher\" threads. I also noted that the number of FDs for the process keeps increasing and after a few days, we have a \"too many files opened\" when going beyond the 1024 limit. Most of those FDs (hundreds) do look like:\n\njava    6700 lexo-ext  904u  sock                0,5          1741176200 can't identify protocol\n\nThere is not much activity on the system and that is still enough to get the problem.\n\nWhen we reach the limit of FDs, we get tons of stack traces in the logs, filling up the hard disk...\n\nThis is a pain.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-10T18:58:55.514+0000","updated":"2011-08-10T18:58:55.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504649/comment/13082585","id":"13082585","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"In the logs, I also found messages like this (I don't know if there is a correlation between that message, the number of threads and the number of FDs being consumed):\n\nWARN | Failed to register MBean: org.apache.activemq:BrokerName=localhost,Type=Connection,ConnectorName=openwire,ViewType=address,Name=/192.168.235.8_63370\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-10T19:21:23.483+0000","updated":"2011-08-10T19:21:23.483+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504649/comment/13082594","id":"13082594","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Here is a dump of all activemq live objects in the JVM:\n\njmap -histo:live 6700 | grep activemq\n   1:          1640      105894928  [Lorg.apache.activemq.command.DataStructure;\n  26:           818         124336  org.apache.activemq.broker.jmx.ManagedTransportConnection\n  28:           818         111248  org.apache.activemq.transport.tcp.TcpTransport\n  33:           839          93968  org.apache.activemq.thread.DedicatedTaskRunner$1\n  35:          1816          87168  org.apache.activemq.management.CountStatisticImpl\n  36:           818          85072  org.apache.activemq.transport.InactivityMonitor\n  39:          1747          69880  org.apache.activemq.command.ProducerId\n  43:          1941          62112  org.apache.activemq.command.SessionId\n  46:          1722          55104  org.apache.activemq.command.LocalTransactionId\n  49:           820          45920  org.apache.activemq.openwire.OpenWireFormat\n  50:           818          45808  org.apache.activemq.broker.region.ConnectionStatistics\n  51:          2776          44416  org.apache.activemq.command.ConnectionId\n  53:          1046          41840  org.apache.activemq.command.ConsumerId\n  57:           818          39264  org.apache.activemq.transport.WireFormatNegotiator\n  71:           831          26592  org.apache.activemq.command.WireFormatInfo\n  75:           818          26176  org.apache.activemq.transport.tcp.TcpTransport$2\n  76:           818          26176  org.apache.activemq.transport.tcp.TcpBufferedOutputStream\n  83:           839          20136  org.apache.activemq.thread.DedicatedTaskRunner\n  85:           822          19728  org.apache.activemq.util.ByteSequence\n  86:           821          19704  org.apache.activemq.util.DataByteArrayInputStream\n  88:           818          19632  org.apache.activemq.transport.InactivityMonitor$1\n  89:           818          19632  org.apache.activemq.transport.InactivityMonitor$2\n  90:           818          19632  org.apache.activemq.transport.MutexTransport\n 104:           821          13136  org.apache.activemq.util.DataByteArrayOutputStream\n 108:           818          13088  org.apache.activemq.broker.TransportConnection$1\n 109:           818          13088  org.apache.activemq.broker.jmx.ConnectionView\n 110:           818          13088  org.apache.activemq.broker.SingleTransportConnectionStateRegister\n 132:           160           5120  org.apache.activemq.util.BitArrayBin\n 133:           317           5072  org.apache.activemq.broker.jmx.AnnotatedMBean\n 141:             1           4112  [Lorg.apache.activemq.command.ConsumerId;\n 144:           160           3840  org.apache.activemq.util.BitArray\n 158:            86           2752  org.apache.activemq.filter.DestinationMapNode\n 168:            60           2400  org.apache.activemq.command.ActiveMQTopic\n 174:            24           2112  org.apache.activemq.command.ConsumerInfo\n 179:            22           1936  org.apache.activemq.broker.region.DestinationStatistics\n 182:            14           1904  org.apache.activemq.broker.region.Topic\n 186:            22           1760  org.apache.activemq.management.TimeStatisticImpl\n 187:            31           1736  org.apache.activemq.util.LRUCache\n 190:            40           1600  org.apache.activemq.thread.SchedulerTimerTask\n 191:            20           1600  org.apache.activemq.broker.region.cursors.FilePendingMessageCursor\n 192:            22           1584  org.apache.activemq.usage.MemoryUsage\n 198:            26           1456  org.apache.activemq.command.ConnectionInfo\n 201:            22           1408  org.apache.activemq.usage.TempUsage\n 202:            22           1408  org.apache.activemq.usage.StoreUsage\n 203:             7           1400  org.apache.activemq.broker.region.Queue\n 215:            11           1232  org.apache.activemq.broker.region.QueueSubscription\n 223:            13           1144  org.apache.activemq.broker.region.TopicSubscription\n 227:            23           1104  org.apache.activemq.management.PollCountStatisticImpl\n 229:            22           1056  org.apache.activemq.usage.SystemUsage\n 231:            66           1056  org.apache.activemq.usage.DefaultUsageCapacity\n 235:             1           1040  [Lorg.apache.activemq.openwire.DataStreamMarshaller;\n 240:            13            936  org.apache.activemq.broker.ConnectionContext\n 249:            22            880  org.apache.activemq.command.ActiveMQQueue\n 252:            26            832  org.apache.activemq.command.SessionInfo\n 259:             7            784  org.apache.activemq.broker.region.Queue$FlowControlTimeoutTask\n 265:            31            744  org.apache.activemq.ActiveMQMessageAudit\n 282:            26            624  org.apache.activemq.state.SessionState\n 287:            13            624  org.apache.activemq.broker.TransportConnectionState\n 292:            37            592  org.apache.activemq.filter.SimpleDestinationFilter\n 301:            11            528  org.apache.activemq.broker.region.cursors.VMPendingMessageCursor\n 303:             7            504  org.apache.activemq.broker.region.cursors.StoreQueueCursor\n 304:             7            504  org.apache.activemq.broker.region.cursors.QueueStorePrefetch\n 329:            24            384  org.apache.activemq.state.ConsumerState\n 336:             7            336  org.apache.activemq.command.DestinationInfo\n 338:             7            336  org.apache.activemq.store.kahadb.MessageDatabase$StoredDestination\n 341:            14            336  [Lorg.apache.activemq.command.ActiveMQDestination;\n 342:            14            336  org.apache.activemq.thread.Valve\n 348:            13            312  [Lorg.apache.activemq.filter.DestinationFilter;\n 350:            13            312  org.apache.activemq.filter.MessageEvaluationContext\n 374:             1            248  org.apache.activemq.xbean.XBeanBrokerService\n 390:             7            224  org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore\n 391:            14            224  org.apache.activemq.broker.jmx.TopicView\n 394:            14            224  org.apache.activemq.broker.region.Topic$1\n 400:            13            208  org.apache.activemq.filter.CompositeDestinationFilter\n 401:            13            208  org.apache.activemq.filter.NoLocalExpression\n 402:            13            208  org.apache.activemq.broker.region.policy.OldestMessageEvictionStrategy\n 406:            13            208  org.apache.activemq.broker.jmx.TopicSubscriptionView\n 409:             5            200  org.apache.activemq.command.MessageId\n 415:             6            192  org.apache.activemq.broker.ConsumerBrokerExchange\n 420:             8            192  org.apache.activemq.store.kahadb.data.KahaEntryType\n 432:             1            176  org.apache.activemq.command.ActiveMQMessage\n 435:            11            176  org.apache.activemq.broker.jmx.SubscriptionView\n 438:             7            168  org.apache.activemq.store.kahadb.data.KahaDestination\n 451:             2            160  org.apache.activemq.kaha.impl.index.IndexItem\n 457:             1            152  org.apache.activemq.broker.region.policy.PolicyEntry\n 459:             1            144  org.apache.activemq.broker.jmx.ManagedRegionBroker\n 469:             1            136  org.apache.activemq.transport.tcp.TcpTransportServer\n 494:             1            120  org.apache.activemq.store.kahadb.KahaDBStore\n 497:             1            120  org.apache.activemq.ActiveMQConnectionFactory\n 508:             7            112  org.apache.activemq.broker.jmx.QueueView\n 509:             1            112  org.apache.activemq.console.command.StartCommand$1\n 514:             1            112  org.apache.activemq.store.kahadb.MessageDatabase$3\n 518:             7            112  org.apache.activemq.broker.region.Queue$1\n 519:             7            112  org.apache.activemq.broker.region.Queue$2\n 521:             7            112  org.apache.activemq.broker.region.Queue$3\n 523:             7            112  org.apache.activemq.broker.region.QueueDispatchSelector\n 524:            14            112  org.apache.activemq.broker.region.policy.SimpleDispatchPolicy\n 527:             1            112  org.apache.activemq.broker.BrokerService$4\n 528:            14            112  org.apache.activemq.broker.region.policy.NoSubscriptionRecoveryPolicy\n 535:             2             96  org.apache.activemq.command.ProducerInfo\n 557:             4             96  org.apache.activemq.store.kahadb.data.KahaDestination$DestinationType\n 573:             1             88  org.apache.activemq.web.AjaxServlet\n 582:             1             80  org.apache.activemq.web.MessageServlet\n 584:             5             80  org.apache.activemq.filter.DestinationMap\n 587:             1             80  org.apache.activemq.broker.jmx.ManagedTransportConnector\n 594:             1             80  org.apache.activemq.broker.jmx.ManagedTempQueueRegion\n 599:             1             80  org.apache.activemq.broker.jmx.ManagedTempTopicRegion\n 613:             1             72  org.apache.activemq.kaha.impl.index.IndexManager\n 616:             1             72  org.apache.activemq.kaha.impl.KahaStore\n 617:             1             72  org.apache.activemq.broker.jmx.ManagedTopicRegion\n 636:             2             64  org.apache.activemq.thread.TaskRunnerFactory\n 638:             1             64  org.apache.activemq.web.handler.BindingBeanNameUrlHandlerMapping\n 642:             1             64  org.apache.activemq.broker.jmx.ManagementContext\n 653:             2             64  org.apache.activemq.kaha.impl.IndexRootContainer\n 660:             1             64  org.apache.activemq.broker.region.ConnectorStatistics\n 667:             1             64  org.apache.activemq.command.BrokerInfo\n 671:             2             64  org.apache.activemq.broker.ProducerBrokerExchange\n 674:             1             56  org.apache.activemq.broker.jmx.ManagedQueueRegion\n 685:             1             56  org.apache.activemq.kaha.impl.data.DataManagerImpl\n 689:             7             56  org.apache.activemq.broker.region.policy.RoundRobinDispatchPolicy\n 703:             3             48  org.apache.activemq.util.FactoryFinder\n 707:             2             48  org.apache.activemq.console.command.ShellCommand\n 730:             2             48  org.apache.activemq.util.IdGenerator\n 733:             1             48  [Lorg.apache.activemq.store.kahadb.data.KahaEntryType;\n 760:             3             48  org.apache.activemq.util.LongSequenceGenerator\n 761:             1             48  org.apache.activemq.management.JMSStatsImpl\n 772:             1             40  org.apache.activemq.RedeliveryPolicy\n 778:             1             40  org.apache.activemq.openwire.OpenWireFormatFactory\n 788:             1             40  org.apache.activemq.advisory.AdvisoryBroker\n 821:             1             40  org.apache.activemq.ActiveMQPrefetchPolicy\n 822:             2             32  org.apache.activemq.state.ProducerState\n 830:             1             32  org.apache.activemq.blob.BlobTransferPolicy\n 854:             1             32  org.apache.activemq.console.command.StartCommand\n 871:             1             32  [Lorg.apache.activemq.store.kahadb.data.KahaDestination$DestinationType;\n 882:             1             32  org.apache.activemq.store.kahadb.MessageDatabase$Metadata\n 902:             1             32  org.apache.activemq.console.Main\n 911:             1             24  org.apache.activemq.web.filter.ApplicationContextFilter\n 915:             1             24  org.apache.activemq.web.filter.ApplicationContextFilter$1\n 924:             1             24  org.apache.activemq.web.SessionPool\n 926:             1             24  org.apache.activemq.console.command.StartCommand$2\n 927:             1             24  org.apache.activemq.kaha.impl.index.StoreIndexReader\n 928:             1             24  org.apache.activemq.kaha.impl.index.StoreIndexWriter\n 929:             1             24  org.apache.activemq.broker.region.DestinationFactoryImpl\n 933:             1             24  org.apache.activemq.security.SecurityContext$1\n 949:             1             24  org.apache.activemq.broker.region.policy.PolicyMap\n 950:             1             24  org.apache.activemq.broker.region.virtual.VirtualTopic\n 957:             1             24  org.apache.activemq.broker.region.policy.IndividualDeadLetterStrategy\n 979:             1             24  org.apache.activemq.broker.BrokerService$3\n 983:             1             24  org.apache.activemq.util.DefaultIOExceptionHandler\n 988:             1             24  org.apache.activemq.broker.jmx.BrokerView\n 989:             1             24  org.apache.activemq.broker.TransactionBroker\n 992:             1             16  org.apache.activemq.store.kahadb.KahaDBStore$1\n 994:             1             16  org.apache.activemq.store.kahadb.MessageDatabase$StoredDestinationMarshaller\n1001:             1             16  org.apache.activemq.broker.BrokerRegistry\n1019:             1             16  org.apache.activemq.util.LogWriterFinder\n1026:             1             16  org.apache.activemq.broker.CompositeDestinationBroker\n1036:             1             16  org.apache.activemq.broker.region.group.MessageGroupHashBucket\n1038:             1             16  org.apache.activemq.util.FactoryFinder$StandaloneObjectFactory\n1041:             1             16  org.apache.activemq.console.CommandContext\n1046:             1             16  org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter\n1053:             1             16  org.apache.activemq.broker.region.virtual.VirtualDestinationInterceptor\n1056:             1             16  org.apache.activemq.console.formatter.CommandShellOutputFormatter\n1061:             1             16  [Lorg.apache.activemq.broker.region.DestinationInterceptor;\n1062:             1             16  [Lorg.apache.activemq.broker.region.virtual.VirtualDestination;\n1065:             1             16  org.apache.activemq.broker.region.policy.SharedDeadLetterStrategy\n1067:             1             16  org.apache.activemq.broker.region.CompositeDestinationInterceptor\n1088:             1             16  org.apache.activemq.kaha.CommandMarshaller\n1107:             1             16  org.apache.activemq.thread.Scheduler\n1109:             1             16  org.apache.activemq.broker.jmx.ConnectorView\n1114:             1             16  [Lorg.apache.activemq.command.BrokerInfo;\n1120:             1             16  org.apache.activemq.broker.TransportConnector$1\n1123:             1             16  org.apache.activemq.transport.tcp.TcpTransportServer$1\n1124:             1             16  org.apache.activemq.broker.region.group.MessageGroupHashBucketFactory\n1127:             1             16  org.apache.activemq.store.kahadb.MessageDatabase$MetadataMarshaller\n1128:             1             16  org.apache.activemq.xbean.XBeanBrokerService$1\n1134:             1             16  org.apache.activemq.command.BrokerId\n1156:             1             16  org.apache.activemq.broker.region.NullMessageReference\n1162:             1              8  org.apache.activemq.openwire.v5.ConnectionIdMarshaller\n1167:             1              8  org.apache.activemq.openwire.v5.LocalTransactionIdMarshaller\n1171:             1              8  org.apache.activemq.kaha.impl.index.RedoStoreIndexItem$1\n1174:             1              8  org.apache.activemq.openwire.v5.ConnectionInfoMarshaller\n1179:             1              8  org.apache.activemq.openwire.v5.MessageAckMarshaller\n1186:             1              8  org.apache.activemq.web.SessionFilter\n1191:             1              8  org.apache.activemq.openwire.v5.ConsumerControlMarshaller\n1196:             1              8  org.apache.activemq.openwire.v5.MessageDispatchMarshaller\n1200:             1              8  org.apache.activemq.openwire.v5.ConsumerIdMarshaller\n1204:             1              8  org.apache.activemq.ActiveMQConnectionMetaData\n1208:             1              8  org.apache.activemq.openwire.v5.MessageDispatchNotificationMarshaller\n1216:             1              8  org.apache.activemq.openwire.v5.MessageIdMarshaller\n1219:             1              8  org.apache.activemq.openwire.v5.ConsumerInfoMarshaller\n1223:             1              8  org.apache.activemq.openwire.v5.MessagePullMarshaller\n1226:             1              8  org.apache.activemq.openwire.v5.ControlCommandMarshaller\n1228:             1              8  org.apache.activemq.transport.InactivityMonitor$5\n1229:             1              8  org.apache.activemq.openwire.v5.ActiveMQMessageMarshaller\n1230:             1              8  org.apache.activemq.broker.region.group.EmptyMessageGroupSet\n1233:             1              8  org.apache.activemq.openwire.v5.ActiveMQBlobMessageMarshaller\n1235:             1              8  org.apache.activemq.openwire.v5.NetworkBridgeFilterMarshaller\n1244:             1              8  org.apache.activemq.openwire.v5.ResponseMarshaller\n1247:             1              8  org.apache.activemq.openwire.v5.DataArrayResponseMarshaller\n1248:             1              8  org.apache.activemq.openwire.v5.ProducerAckMarshaller\n1249:             1              8  org.apache.activemq.transport.tcp.TcpTransportFactory\n1251:             1              8  org.apache.activemq.openwire.v5.ActiveMQBytesMessageMarshaller\n1253:             1              8  org.apache.activemq.usage.Usage$3\n1262:             1              8  org.apache.activemq.openwire.v5.DataResponseMarshaller\n1263:             1              8  org.apache.activemq.openwire.v5.ProducerIdMarshaller\n1265:             1              8  org.apache.activemq.openwire.v5.ActiveMQMapMessageMarshaller\n1275:             1              8  org.apache.activemq.openwire.v5.ActiveMQObjectMessageMarshaller\n1277:             1              8  org.apache.activemq.openwire.v5.DestinationInfoMarshaller\n1278:             1              8  org.apache.activemq.openwire.v5.ProducerInfoMarshaller\n1279:             1              8  org.apache.activemq.store.kahadb.MessageDatabase$MessageKeysMarshaller\n1280:             1              8  org.apache.activemq.kaha.BytesMarshaller\n1283:             1              8  org.apache.activemq.kaha.ObjectMarshaller\n1285:             1              8  org.apache.activemq.openwire.v5.DiscoveryEventMarshaller\n1288:             1              8  org.apache.activemq.openwire.v5.RemoveInfoMarshaller\n1293:             1              8  org.apache.activemq.openwire.v5.ActiveMQQueueMarshaller\n1294:             1              8  org.apache.activemq.kaha.StringMarshaller\n1295:             1              8  org.apache.activemq.command.ActiveMQMessage$1\n1297:             1              8  org.apache.activemq.openwire.v5.ExceptionResponseMarshaller\n1300:             1              8  org.apache.activemq.command.ActiveMQMessage$2\n1303:             1              8  org.apache.activemq.openwire.v5.RemoveSubscriptionInfoMarshaller\n1306:             1              8  org.apache.activemq.openwire.v5.ActiveMQStreamMessageMarshaller\n1307:             1              8  org.apache.activemq.command.ActiveMQMessage$3\n1310:             1              8  org.apache.activemq.kaha.MessageIdMarshaller\n1311:             1              8  org.apache.activemq.web.WebConsoleStarter\n1312:             1              8  org.apache.activemq.openwire.v5.FlushCommandMarshaller\n1314:             1              8  org.apache.activemq.command.ActiveMQMessage$4\n1316:             1              8  org.apache.activemq.openwire.v5.ReplayCommandMarshaller\n1318:             1              8  org.apache.activemq.command.ActiveMQMessage$5\n1319:             1              8  org.apache.activemq.openwire.v5.IntegerResponseMarshaller\n1321:             1              8  org.apache.activemq.openwire.v5.ActiveMQTempQueueMarshaller\n1324:             1              8  org.apache.activemq.command.ActiveMQMessage$6\n1325:             1              8  org.apache.activemq.openwire.v5.SessionIdMarshaller\n1327:             1              8  org.apache.activemq.command.ActiveMQMessage$7\n1329:             1              8  org.apache.activemq.openwire.v5.ActiveMQTempTopicMarshaller\n1330:             1              8  org.apache.activemq.openwire.v5.JournalQueueAckMarshaller\n1332:             1              8  org.apache.activemq.broker.region.Queue$4\n1337:             1              8  org.apache.activemq.command.ActiveMQMessage$8\n1339:             1              8  org.apache.activemq.openwire.v5.SessionInfoMarshaller\n1342:             1              8  org.apache.activemq.openwire.v5.ActiveMQTextMessageMarshaller\n1343:             1              8  org.apache.activemq.command.ActiveMQMessage$9\n1346:             1              8  org.apache.activemq.openwire.v5.JournalTopicAckMarshaller\n1347:             1              8  org.apache.activemq.openwire.v5.ShutdownInfoMarshaller\n1349:             1              8  org.apache.activemq.command.ActiveMQMessage$10\n1350:             1              8  org.apache.activemq.openwire.v5.ActiveMQTopicMarshaller\n1352:             1              8  org.apache.activemq.command.ActiveMQMessage$11\n1357:             1              8  org.apache.activemq.openwire.v5.JournalTraceMarshaller\n1359:             1              8  org.apache.activemq.openwire.v5.SubscriptionInfoMarshaller\n1360:             1              8  org.apache.activemq.openwire.v5.BrokerIdMarshaller\n1367:             1              8  org.apache.activemq.openwire.v5.JournalTransactionMarshaller\n1368:             1              8  org.apache.activemq.ActiveMQConnectionFactory$1\n1369:             1              8  org.apache.activemq.openwire.v5.TransactionInfoMarshaller\n1371:             1              8  org.apache.activemq.openwire.v5.BrokerInfoMarshaller\n1372:             1              8  org.apache.activemq.openwire.v5.KeepAliveInfoMarshaller\n1374:             1              8  org.apache.activemq.openwire.v5.WireFormatInfoMarshaller\n1378:             1              8  org.apache.activemq.transport.tcp.TcpTransport$3\n1379:             1              8  org.apache.activemq.openwire.v5.ConnectionControlMarshaller\n1381:             1              8  org.apache.activemq.openwire.v5.XATransactionIdMarshaller\n1385:             1              8  org.apache.activemq.openwire.v5.PartialCommandMarshaller\n1387:             1              8  org.apache.activemq.openwire.v5.LastPartialCommandMarshaller\n1390:             1              8  org.apache.activemq.openwire.v5.ConnectionErrorMarshaller\n1392:             1              8  org.apache.activemq.store.kahadb.MessageDatabase$LocationMarshaller\n\n /usr/sbin/lsof -p 6700 | grep \"can't identify\" | wc -l\n797\n\njstack 6700 | grep \"nid=\" | grep \"ActiveMQ Connection Dispatcher\" | wc -l\n818\n\nI can't see why I should have 818 ActiveMQ Connection Dispatcher threads running with their corresponding objects in the JVM. Could they be stuck there?\n\n\"ActiveMQ Connection Dispatcher: /172.30.210.39:38631\" daemon prio=10 tid=0x09ef8c00 nid=0x1b12 in Object.wait() [0xce3c7000]\n   java.lang.Thread.State: WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0xd47f5080> (a java.lang.Object)\n        at java.lang.Object.wait(Object.java:485)\n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:105)\n        - locked <0xd47f5080> (a java.lang.Object)\n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\n\n\"ActiveMQ Connection Dispatcher: /172.30.210.39:38632\" daemon prio=10 tid=0x09efa400 nid=0x1b15 in Object.wait() [0xce4ba000]\n   java.lang.Thread.State: WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0xd480c968> (a java.lang.Object)\n        at java.lang.Object.wait(Object.java:485)\n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:105)\n        - locked <0xd480c968> (a java.lang.Object)\n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-10T19:26:58.565+0000","updated":"2011-08-10T19:26:58.565+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504649/comment/13082596","id":"13082596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"To contrast, I have only 15 ActiveMQ Transport threads like this one:\n\nlexo-ext@cert1-lexo-util:~/activemq/apache-activemq-5.3.2/logs$ jstack 6700 | grep \"nid=\" | grep \"ActiveMQ Transport\" | wc -l\n15\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-10T19:28:45.463+0000","updated":"2011-08-10T19:28:45.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504649/comment/13084312","id":"13084312","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"It seems every time a new ActiveMQ Connection Dispatcher thread become \"zombie\", that a file descriptor is held for an indefinite time, leading to the consumption of all FDs eventually (or all RAM/Permgen available as ...)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-12T19:25:31.078+0000","updated":"2011-08-12T19:25:31.078+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12504649/comment/13084326","id":"13084326","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"I opened https://issues.apache.org/jira/browse/AMQ-3448 since I cannnot see how to reopen this bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-12T19:41:46.774+0000","updated":"2011-08-12T19:41:46.774+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3286/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ku0f:"}}