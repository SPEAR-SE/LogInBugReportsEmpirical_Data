{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482190","self":"https://issues.apache.org/jira/rest/api/2/issue/12482190","key":"AMQ-1249","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2007-05-23T16:02:29.324+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Feb 09 13:04:12 UTC 2009","customfield_12310420":"43769","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_54349077193_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-02-09T13:04:12.911+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1249/watchers","watchCount":0,"isWatching":false},"created":"2007-05-22T12:06:15.718+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315614","id":"12315614","description":"","name":"4.1.1","archived":false,"released":true,"releaseDate":"2007-06-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-02-09T13:04:12.910+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Scenario:\n\nused queue to transfer a message of size 10MB, producer and consumer were in the same location, but broker was available through a WAN, so sending a message took some time, client crashed with exception (also added some trace):\n\n{noformat}\n14:58:00,914 DEBUG [main] org.apache.activemq.ActiveMQSession: Sending message: ActiveMQBytesMessage {commandId = 0, responseRequired = false, messageId = ID:itstl007-41444-1179835075925-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:itstl007-41444-1179835075925-1:0:1:1, destination = queue://Huge.Remote.1, transactionId = null, expiration = 0, timestamp = 1179835080911, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@7808b9, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = {HASH=80f6524683f484f19f244fc5d290f79f5f1b48c1}, readOnlyProperties = true, readOnlyBody = true, droppable = false} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null }\n14:58:00,914 DEBUG [main] org.apache.activemq.transport.TransportLogger.Connection:1: SENDING: ActiveMQBytesMessage {commandId = 5, responseRequired = true, messageId = ID:itstl007-41444-1179835075925-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:itstl007-41444-1179835075925-1:0:1:1, destination = queue://Huge.Remote.1, transactionId = null, expiration = 0, timestamp = 1179835080911, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@7808b9, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = {HASH=80f6524683f484f19f244fc5d290f79f5f1b48c1}, readOnlyProperties = true, readOnlyBody = true, droppable = false} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null }\n14:58:26,716 DEBUG [ActiveMQ Transport: tcp://gkscoc01.igk.intel.com/172.28.168.10:61616] org.apache.activemq.transport.TransportLogger.Connection:1: RECEIVED: KeepAliveInfo {}\n14:58:41,699 DEBUG [ActiveMQ Transport: tcp://gkscoc01.igk.intel.com/172.28.168.10:61616] org.apache.activemq.transport.TransportLogger.Connection:1: RECEIVED: KeepAliveInfo {}\n14:58:56,701 DEBUG [ActiveMQ Transport: tcp://gkscoc01.igk.intel.com/172.28.168.10:61616] org.apache.activemq.transport.TransportLogger.Connection:1: RECEIVED: KeepAliveInfo {}\n14:58:56,707 DEBUG [ActiveMQ Transport: tcp://gkscoc01.igk.intel.com/172.28.168.10:61616] org.apache.activemq.transport.TransportLogger.Connection:1: RECEIVED Exception: java.io.EOFException\njava.io.EOFException\n        at java.io.DataInputStream.readInt(DataInputStream.java:397)\n        at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:267)\n        at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:156)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:136)\n        at java.lang.Thread.run(Thread.java:536)\n14:58:56,709 DEBUG [main] org.apache.activemq.transport.TransportLogger.Connection:1: SENDING: RemoveInfo {commandId = 6, responseRequired = false, objectId = ID:itstl007-41444-1179835075925-1:0:1:1}\n14:58:56,711 DEBUG [main] org.apache.activemq.transport.TransportLogger.Connection:1: SENDING: RemoveInfo {commandId = 7, responseRequired = false, objectId = ID:itstl007-41444-1179835075925-1:0:1}\n14:58:56,711 DEBUG [main] org.apache.activemq.transport.TransportLogger.Connection:1: SENDING: RemoveInfo {commandId = 8, responseRequired = true, objectId = ID:itstl007-41444-1179835075925-1:0}\nException in thread \"main\" javax.jms.JMSException: The transport is not running.\n        at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:58)\n        at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1213)\n        at org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:579)\n        at com.intel.ingrid.test.stress.jms.HugeMessageProducer.main(HugeMessageProducer.java:93)\nCaused by: java.io.IOException: The transport is not running.\n        at org.apache.activemq.transport.TransportSupport.checkStarted(TransportSupport.java:103)\n        at org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:117)\n        at org.apache.activemq.transport.TransportLogger.oneway(TransportLogger.java:71)\n        at org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:141)\n        at org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:80)\n        at org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:93)\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:47)\n        at org.apache.activemq.transport.ResponseCorrelator.asyncRequest(ResponseCorrelator.java:69)\n        at org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:79)\n        at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1203)\n        ... 2 more\n{noformat}\n\nAfter I changed *wireFormat.maxInactivityDuration* to 0 it succeeded and sent the message.\n\nIt's strange for me because in the first case (when *wireFormat.maxInactivityDuration* is not set, so default value is used) *there's an activity occuring* - the client sends a lot of data so server should not treat it as a hanging client and *the server should not close the connection*.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"254999","customfield_12312823":null,"summary":"Exception when sending big messages","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=new","name":"new","key":"new","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pawel Niewiadomski","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=new","name":"new","key":"new","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pawel Niewiadomski","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482190/comment/12938975","id":"12938975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yaussy","name":"yaussy","key":"yaussy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Yaussy","active":true,"timeZone":"Etc/UTC"},"body":"I think it is likely that you can't really detect this - the code is blocked on the socket.write.  I don't think that can be distinguished from the socket being in a hung\nstate, or the target broker being hung.  You might have to bump up the maxInactivity value to a higher value than the default to allow for large messages \nand your WAN.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yaussy","name":"yaussy","key":"yaussy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Yaussy","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-23T16:02:29.324+0000","updated":"2007-05-23T16:02:29.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482190/comment/12936650","id":"12936650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=new","name":"new","key":"new","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pawel Niewiadomski","active":true,"timeZone":"Etc/UTC"},"body":"Let me think loud: if you use socket.write you usually write chunk by chunk so you can actually detect this somehow - you're probably use socket.write to send chunk by chunk, right? So each call to socket.write will return after some time, so you can set flag \"I'm still alive\" to true and continue sending, if connection fails flag will not be set and application will know that something's wrong.\n\nAm I thinking right?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=new","name":"new","key":"new","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pawel Niewiadomski","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-23T19:54:25.373+0000","updated":"2007-05-23T19:54:25.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482190/comment/12936364","id":"12936364","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"It would be good if the TCP transport implementation kept the transport alive while its still reading chunks of a single message. So even if one huge Command is being read over a slow network, it still kept the activity monitor alive.\n\nBTW another work around is to use out of band messaging for large messages over 1Mb\n\nhttp://activemq.apache.org/blob-messages.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-12T08:17:14.931+0000","updated":"2007-06-12T08:17:14.931+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482190/comment/12940745","id":"12940745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"This issue is duplicate of [https://issues.apache.org/activemq/browse/AMQ-2088], which just has been fixed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2009-02-09T13:04:12.886+0000","updated":"2009-02-09T13:04:12.886+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1249/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1817r:"}}