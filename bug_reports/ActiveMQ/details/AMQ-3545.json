{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12527285","self":"https://issues.apache.org/jira/rest/api/2/issue/12527285","key":"AMQ-3545","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Oct 17 12:33:52 UTC 2011","customfield_12310420":"86665","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_182926375_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-10-17T12:33:52.589+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3545/watchers","watchCount":1,"isWatching":false},"created":"2011-10-15T09:45:06.293+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["activemq"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-10-17T12:33:52.663+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Hi,\nWe use AMQ broker 5.5 and Spring 3.0 for configuring connection factory and other stuffs. \nThe connection factory we are using is PooledConnectionFactory and a part of my config looks like this:\n\n{code:xml}\n<bean id=\"jmsFactory\" class=\"org.apache.activemq.pool.PooledConnectionFactory\" destroy-method=\"stop\">\n <property name=\"connectionFactory\">\n   <bean class=\"org.apache.activemq.ActiveMQConnectionFactory\">\n      <property name=\"brokerURL\" value=\"some_url\"/>\n   </bean>\n </property>\n</bean>\n\n<!-- Spring JMS Template -->\n<bean id=\"jmsTemplate\"\nclass=\"org.springframework.jms.core.JmsTemplate\">\n <property name=\"connectionFactory\">\n  <ref local=\"jmsFactory\" />\n </property>\n\n <property name=\"explicitQosEnabled\" value=\"true\"/>\n <property name=\"timeToLive\" value=\"86400000\"/>\n</bean>\n{code}\n\nA few days back our broker crashed and kept restarting with this error:\n\n# java.lang.OutOfMemoryError: requested \n369384 bytes for Chunk::new. Out of swap space? \n\nAt that point of time, from jconsole, I could not find anything unusual with the broker, except that one of our client application\nwhich talks with the server (via broker) by sending and listening to messages every *minute* had created ~3000 connections (saw it on jconsole).\nOnce we had shut it down, everything was back to normal. \n\nSo, to avoid this I tried closing the connection in finally block doing something like this.\n\n{code:xml}\ntry {\n connection = myJmsTemplate.getConnectionFactory().createConnection();\n session = connection.createSession(false, 1);\n\n String messageSelector = \"JMSCorrelationID='\" + correlationId + \"'\";\n responseConsumer = session.createConsumer(receiveDestination, messageSelector);\n LOG.info(\"Starting connection\");\n connection.start();\n myJmsTemplate.send(sendDestination, new SimpleTextMessageCreator(\n   message, receiveDestination, correlationId));\n LOG.info(\"Waiting for message with \" + messageSelector + \" for \" + DEFAULT_TIMEOUT + \" ms\");\n TextMessage responseMessage = (TextMessage) responseConsumer.receive(DEFAULT_TIMEOUT);\n}\ncatch (Someexception e) {do something}\nfinally {\n responseConsumer.close();\n session.close();\n connection.close();\n}\n{code}\n\nBut even then I can see the connections floating around in jconsole and are only lost if the client app which publishes the messages is brought down.\nCan someone please help me understand what's happening here and how I can close the connections after each pub sub cycle.\n\nThank you in advance,\nHari","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172373","customfield_12312823":null,"summary":"JmsTemplate does not close connections even with PooledConnectionFactory","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harimharan","name":"harimharan","key":"harimharan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hariharan","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harimharan","name":"harimharan","key":"harimharan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hariharan","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527285/comment/13128821","id":"13128821","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harimharan","name":"harimharan","key":"harimharan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hariharan","active":true,"timeZone":"Etc/UTC"},"body":"My bad :( false alarm. There was another piece of code in my app which was leaving the connections open. Closing it solved the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harimharan","name":"harimharan","key":"harimharan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hariharan","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-17T12:33:52.648+0000","updated":"2011-10-17T12:33:52.648+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3545/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tv9b:"}}