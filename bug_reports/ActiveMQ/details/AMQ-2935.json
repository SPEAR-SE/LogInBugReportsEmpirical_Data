{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483866","self":"https://issues.apache.org/jira/rest/api/2/issue/12483866","key":"AMQ-2935","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-09-23T15:49:24.400+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 09 02:49:19 UTC 2015","customfield_12310420":"14825","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1126767481_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-10-06T13:43:17.075+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2935/watchers","watchCount":31,"isWatching":false},"created":"2010-09-23T12:43:49.594+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315624","id":"12315624","description":"Maintenance release for 5.4.0","name":"5.4.1","archived":false,"released":true,"releaseDate":"2010-09-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"issuelinks":[{"id":"12347045","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12347045","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12537142","key":"AMQ-3648","self":"https://issues.apache.org/jira/rest/api/2/issue/12537142","fields":{"summary":"ActiveMQ crashed with an error: Chunk stream does not exist at page...","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T02:49:19.106+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I am seeing this regularly upon restarts in all versions from 5.4.x - I cannot downgrade due to breaking issues in previous versions.\nThe broker was shutdown cleanly with no logged issues.\nDeleting the activemq-data directory seems to be the only recovery solution (which is not an option in production)\n\n2010-09-23 13:54:30,997 [Starting ActiveMQ Broker] ERROR org.apache.activemq.broker.BrokerService - Failed to start ActiveMQ JMS Message Broker. Reason: java.io.EOFException: Chunk stream does not exist at page: 0\njava.io.EOFException: Chunk stream does not exist at page: 0\n\tat org.apache.kahadb.page.Transaction$2.readPage(Transaction.java:454)\n\tat org.apache.kahadb.page.Transaction$2.<init>(Transaction.java:431)\n\tat org.apache.kahadb.page.Transaction.openInputStream(Transaction.java:428)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:404)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:361)\n\tat org.apache.activemq.broker.scheduler.JobSchedulerStore$3.execute(JobSchedulerStore.java:250)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:728)\n\tat org.apache.activemq.broker.scheduler.JobSchedulerStore.doStart(JobSchedulerStore.java:239)\n\tat org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:53)\n\tat org.apache.activemq.broker.scheduler.SchedulerBroker.getStore(SchedulerBroker.java:198)\n\tat org.apache.activemq.broker.scheduler.SchedulerBroker.getInternalScheduler(SchedulerBroker.java:185)\n\tat org.apache.activemq.broker.scheduler.SchedulerBroker.start(SchedulerBroker.java:85)\n\tat org.apache.activemq.broker.BrokerFilter.start(BrokerFilter.java:157)\n\tat org.apache.activemq.broker.BrokerFilter.start(BrokerFilter.java:157)\n\tat org.apache.activemq.broker.TransactionBroker.start(TransactionBroker.java:112)\n\tat org.apache.activemq.broker.BrokerService$3.start(BrokerService.java:1786)\n\tat org.apache.activemq.broker.BrokerService.start(BrokerService.java:496)\n\tat org.apache.activemq.ra.ActiveMQResourceAdapter$1.run(ActiveMQResourceAdapter.java:85)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461859","id":"12461859","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"created":"2010-09-23T12:58:29.608+0000","size":1412,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461859/activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461872","id":"12461872","filename":"activemq-data.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"created":"2010-09-23T13:35:16.315+0000","size":41621,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461872/activemq-data.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461845","id":"12461845","filename":"stacktraces.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanck","name":"bryanck","key":"bryanck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Keller","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-24T17:42:44.672+0000","size":3938,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461845/stacktraces.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"63733","customfield_12312823":null,"summary":"java.io.EOFException: Chunk stream does not exist at page on broker start","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Win7 32bit, JDK 1.6_20","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942958","id":"12942958","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"body":"Here is my config and zipped activemq-data directory","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"created":"2010-09-23T12:46:13.827+0000","updated":"2010-09-23T12:46:13.827+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942945","id":"12942945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"body":"\nI upgraded from 5.3.2 to 5.4.1. Some jars (spring) were updated.\n\nIf  I delete all files in activemq-data/xxxx/scheduler and then restart the process. It's OK\n\n[sibModule@td0sib01s SIBBusModule-TestDeCharge-td0sib01s]$ ll scheduler\ntotal 36\n-rw-r--r-- 1 sibModule sibdev     0 Sep 23 17:39 db-1.log\n-rw-r--r-- 1 sibModule sibdev     0 Sep 23 17:39 lock\n-rw-r--r-- 1 sibModule sibdev 16384 Sep 23 17:39 scheduleDB.data\n-rw-r--r-- 1 sibModule sibdev 16408 Sep 23 17:39 scheduleDB.redo\n\nIf I stop the process with a CTRL-C shutdown action and try to restart it without deleting the files, I have this error.\n\n[sibModule@td0sib01s scheduler]$ ll\ntotal 36\n-rw-r--r-- 1 sibModule sibdev     0 Sep 23 17:39 db-1.log\n-rw-r--r-- 1 sibModule sibdev 16384 Sep 23 17:44 scheduleDB.data\n-rw-r--r-- 1 sibModule sibdev 16408 Sep 23 17:39 scheduleDB.redo\n\nI have a MemoryPersistance configuration.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-23T15:49:24.400+0000","updated":"2010-09-23T15:49:24.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942948","id":"12942948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"body":"When I add\nschedulerSupport=\"false\"\n\nin the \"broker\" configuration, It seems OK. No activemq-data directory nor files below are created.\n\nExample :\n\n<broker xmlns=\"http://activemq.apache.org/schema/core\" brokerName=\"SIBBusModule-TestDeCharge-td0sib01s\" useJmx=\"true\" persistent=\"false\" useShutdownHook=\"false\" schedulerSupport=\"false\">\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-23T16:05:19.175+0000","updated":"2010-09-23T16:06:13.547+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942925","id":"12942925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks Eric,\n\nApplying the property schedulerSupport=\"false\"  to the broker seems to have nipped this in the bud, at least for the few tests I have run.\n\nWhere did you find the docs on this parameter? - All I can find is this: http://activemq.apache.org/delay-and-schedule-message-delivery.html\n\nAs this was introduced recently (5.4.x) as new option I think 'false' should really be the default option - Especially as it seems to be broken.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"created":"2010-09-24T09:23:26.358+0000","updated":"2010-09-24T09:23:26.358+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942972","id":"12942972","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanck","name":"bryanck","key":"bryanck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Keller","active":true,"timeZone":"Etc/UTC"},"body":"Setting the schedulerSupport=false for me did reduce the likelihood of this error occurring for me. With it set to true, it happens nearly every single time I shut down and restart. However, I am still getting the problem intermittently after shutdown and restart, even with this set to false, albeit less frequently. I will attached stack traces of it occurring with both schedulerSupport=true and false (the error occurs in different places during initialization).\n\nAlso, to note, this is a much more frequent occurrence with 5.4.1 vs 5.4.0. I do not have this issue with 5.3.2 so have downgraded to that for now.\n\nThis occurs for me on both Windows 7 64-bit JDK 1.6.21 and Mac OS 10.6.4.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanck","name":"bryanck","key":"bryanck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Keller","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-24T17:27:23.616+0000","updated":"2010-09-24T17:27:23.616+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942965","id":"12942965","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanck","name":"bryanck","key":"bryanck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Keller","active":true,"timeZone":"Etc/UTC"},"body":"Stack traces of the issue, with schedulerSupport=true and with schedulerSupport=false","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanck","name":"bryanck","key":"bryanck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Keller","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-24T17:42:44.725+0000","updated":"2010-09-24T17:42:44.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942976","id":"12942976","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shiweiyuan","name":"shiweiyuan","key":"shiweiyuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shiweiyuan","active":true,"timeZone":"Etc/UTC"},"body":"I get the same issue when try activemq 5.4.1 on linux with jdk1.5. and I get around this issue by deleting all files/folders under data.\nBut it will not be practical if it's a production environment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shiweiyuan","name":"shiweiyuan","key":"shiweiyuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shiweiyuan","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-26T07:14:45.156+0000","updated":"2010-09-26T07:14:45.156+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942975","id":"12942975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"body":"Yes Bryan, you are right, setting schedulerSupport=false has only 'reduced' the likelihood of this occurring - This is still happening, but less frequently.\n\nThere must be a race condition on shutdown which is corrupting the KahaDB files - I have looked at the startup code, but nothing seems to have changed much recently.\n\nThe corruption is obviously more aggressive in the the sheduler code.\n\nThis is a real show stopper for me right now, so I will dig more into this to see if I can find the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"created":"2010-09-26T09:49:09.656+0000","updated":"2010-09-26T09:49:09.656+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942974","id":"12942974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"body":"I have elevated this to 'Blocker' due to the fact that others are also experiencing this, and that the general solution for everyone is to physically delete files in order to continue - not an option in production.\nThe bug is consistently repeatable and is destructive in that files are left in an unrecoverable state - The ability of ActiveMQ to recover from a crash is a feature, so the the ability to recover from a simple restart is ultimately critical. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"created":"2010-09-26T09:58:14.674+0000","updated":"2010-09-26T09:58:14.674+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942984","id":"12942984","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shiweiyuan","name":"shiweiyuan","key":"shiweiyuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shiweiyuan","active":true,"timeZone":"Etc/UTC"},"body":"This issue maybe caused by lack of disk capacity.\n\nwhen using the default configuration, i.e. the pending queue policy will be store based message cursor.\nI found that the data folder size will increase very rapidly:\n300,000 messages, 30 bytes per message, non_persistent,  the file named tmpDB.data  under data\\localhost\\tmp_storage\\ will up to 1.15G in my environment.\nso, pls check if your disk load/capacity is full.\n\nBut I'm still experiencing this issue after make sure the disk capacity is not full.\nWill update on this issue if I get new evidence later...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shiweiyuan","name":"shiweiyuan","key":"shiweiyuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shiweiyuan","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-27T04:42:12.776+0000","updated":"2010-09-27T04:42:12.776+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942983","id":"12942983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"body":"Tested in several environments, of which at least one is a very high spec system, all with plenty of free space. Same results, so nothing to do with capacity.\n\nThis seems to be pretty consistent, but even more so with schedulerSupport=true (occurs on practically every restart).\nThe point of failure is easy to track down at org.apache.kahadb.page.Transaction$2.readPage(Transaction.java:454) - The question is more about why is the KahaDB file left in an unreadable state on a clean shutdown?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"created":"2010-09-27T07:09:40.664+0000","updated":"2010-09-27T07:09:40.664+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942993","id":"12942993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fgynnild","name":"fgynnild","key":"fgynnild","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Gynnild","active":true,"timeZone":"Europe/Oslo"},"body":"This is a blocker issue for me, and it seems to be unrelated to the amount of available disk space.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fgynnild","name":"fgynnild","key":"fgynnild","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Gynnild","active":true,"timeZone":"Europe/Oslo"},"created":"2010-10-04T08:33:38.442+0000","updated":"2010-10-04T08:33:38.442+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943031","id":"12943031","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adamaitch","name":"adamaitch","key":"adamaitch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Hoskins","active":true,"timeZone":"Etc/UTC"},"body":"This renders 5.4.1 unusable for me. Had to roll back to 5.3.2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adamaitch","name":"adamaitch","key":"adamaitch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Hoskins","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-04T09:44:03.150+0000","updated":"2010-10-04T09:44:03.150+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942847","id":"12942847","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swapnonil","name":"swapnonil","key":"swapnonil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Swapnonil Mukherjee","active":true,"timeZone":"Etc/UTC"},"body":"The reason I chose Active MQ 5.4 is because is of it's \"Message Scheduling\" feature, which is not there in 5.3. We are using the message scheduling feature released with 5.4. Our application needs messages to sit on a queue for at least 30 seconds.  \nI am using the Spring JMS Template to send messages. This is how I am sending messages.\n----\t\n{code:title=|borderStyle=none}\npublic Message createMessage(Session session) throws JMSException\n{\n    Date date = new Date();\n    String delayInSeconds = properties.getProperty(MESSAGE_DELAY);\n    Message message = session.createObjectMessage(mqRequest);\n    message.setLongProperty(TIMESTAMP_AS_EPOCH_ATTRIBUTE, date.getTime());\n    message.setStringProperty(TIMESTAMP_AS_STRING_ATTRIBUTE, getDateAsString(date));\n    if (delayInSeconds != null)\n    {\n        LOGGER.info(\"Delay set at \" + delayInSeconds + \" seconds\");\n        message.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_DELAY, Integer.parseInt(delayInSeconds) * 1000);\n    }\n    return message;\n}\n\n{code}\n\nI can downgrade to 5.3 but then how do I get message scheduling. Please advice.\n\nI have checked disk capacity. There's no problem with that. \nBy the way the stack trace I get is exactly what Andy posted.\n\nI just deleted all the contents of localhost/scheduler directory, and started the broker again. This time it starts ok and is working fine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swapnonil","name":"swapnonil","key":"swapnonil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Swapnonil Mukherjee","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-04T15:36:24.880+0000","updated":"2010-10-04T17:17:06.510+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942880","id":"12942880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"{code}useShutdownHook=\"false\"{code} is relevant. With a simple embedded broker Ctrl+C and restart without the shutdown hook, the stores are not stopped, in fact the broker is not stopped. A restart results in this problem every time. The store needs to be flushed on start which will should help but requires some code changes. In addition, this exception should be trapped such that it leads to recovery.\n\nTo work around, either {code}useShutdownHook=\"true\"{code} needs to be used such that the broker is stopped when the jvm is shutdown or there needs to be an explicit call to broker.stop()\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T08:40:32.246+0000","updated":"2010-10-05T08:40:32.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942936","id":"12942936","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary\n\nDo you confirm us that \"schedulerSupport=false\" is enough when we don't plan to use sheduled messages and don't want to have any files written on disk ?\n\nEric\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T09:02:02.414+0000","updated":"2010-10-05T09:02:02.414+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942879","id":"12942879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"body":"In our configuration we have [and had] useShutdownHook=\"true\", also we do not use db (only memory).\n\nbroker.setPersistenceAdapter(new MemoryPersistenceAdapter());\nbroker.setPersistent(false);\nbroker.setUseShutdownHook(true);\nbroker.setUseLoggingForShutdownErrors(false);\n\nIf we do not use: \"broker.setSchedulerSupport(false);\" the problem is 100% reproducible.\n\nAlthough we were not able to reproduce it with a scheduler being off, we would not take a risk, as someone mentioned above, this setting only reduce the probability of the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T09:03:05.360+0000","updated":"2010-10-05T09:03:05.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942935","id":"12942935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"body":"Eric,\n\nOnly using \"schedulerSupport=false\" does NOT resolve this issue. The problem is specifically a KahaDB problem (the default persistence store is KahaDB).\n\nSwapping out the persistence store is currently the only option. If you need 'any' persistence then I would suggest the jdbcPersistenceAdapter (the default uses a Derby Database, but many can be used).\nThis is substantially slower than KahaDB, but not enough to worry about if you are only pushing say several thousand messages a minute (you'd have to run your own tests). I am in fact happy enough with the performance that I am likely to stick with it for stabilities sake even if this issue is resolved.\n\n<broker xmlns=\"http://activemq.apache.org/schema/core\"\n          useJmx=\"false\"\n          brokerName=\"YourName\"\n          useShutdownHook=\"false\"\n          persistent=\"true\"\n          start=\"false\"\n          schedulerSupport=\"false\"\n          enableStatistics=\"false\">\n\n    <persistenceAdapter>\n      <jdbcPersistenceAdapter dataDirectory=\"activemq-data/jdbc\"/>\n    </persistenceAdapter>\n\n.....\n\nNote: If schedulerSupport is enabled then the error will still persist (excuse the pun) due to the fact that the scheduler uses KahaDB irrelevant of the persistenceAdapter - So if you want scheduler support then there is currently no option (unless someone knows how to configure the scheduler to use another store?).\n\nGary,\n\nI should have mentioned that my configuration is for an OpenEJB RA, whereby the RA is responsible for starting and stopping ActiveMQ (which is does, and still produces a corrupt KahaDB) - The default OpenEJB RA config uses a memory store, but I require persistence for my project. A standalone application (basically as Krzysztof writes) which loops through start/stop will still produce the same stacktrace virtually every time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-05T09:39:22.234+0000","updated":"2010-10-05T09:39:22.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942952","id":"12942952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"body":"Hi Andy\n\nI don't need nor scheduled Messages, nor Persistance. So I don't need KahaDB usage at all.\n\nI wonder if, in this case, \"schedulerSupport=false\" is enough.\n\nEric","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eric-awl","name":"eric-awl","key":"eric-awl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T09:59:50.165+0000","updated":"2010-10-05T09:59:50.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942960","id":"12942960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I have found a problem with the recovery processing in the kahaDB pageFile/index but the issue only occurs when there has been an abortive close, as in the stop method of the broker was not called or did not complete or a file write did not complete with the clean shutdown flag set.\nWith a successful call to broker.stop() the problem is avoided as there is no recovery of the pageFile from the redo buffer at restart so it may not be the only issue here.\n\nThe latest 5.5-SNAPSHOT from maven or the repo has the fix. It would be great if you could validate.\nhttps://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.5-SNAPSHOT/\n\nAndy, Krzysztof, Can you verify that the broker is actually stopped in your start/stop tests.There should be messages in the log of the form: 10:55:37,927 [main ] INFO  JobSchedulerStore - JobSchedulerStore:activemq-data/localhost/scheduler stopped\n\nEric, for your use case, schedulerSupport=false is sufficient.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T11:24:20.843+0000","updated":"2010-10-05T11:24:20.843+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942968","id":"12942968","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngehring","name":"ngehring","key":"ngehring","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nik Gehring","active":true,"timeZone":"Etc/UTC"},"body":"Gary - thanks for looking in to this.  We are going to test that it solves the issue we're seeing.\n\nIn the meantime a quick question please....  as we are running this in the background in Unix, how do we stop the broker gracefully?  The FAQ simply says to kill the process and I presume that this will not call broker.stop() correctly.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngehring","name":"ngehring","key":"ngehring","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nik Gehring","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T11:47:05.108+0000","updated":"2010-10-05T11:47:05.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942862","id":"12942862","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"body":"Gary, you are right.\nAfter deleting activemq-data I verified following situation:\nuntil I abnormally quit the application [and thus the broker.stop() is not invoked] everything starts OK\nonly after a crash/abnormal ending of an application the problem appears [in 100% cases] (deleting the data or setting schedulerSupport to false resolve the issue).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T11:57:19.863+0000","updated":"2010-10-05T11:57:19.863+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942951","id":"12942951","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Nik, so long as you don't use kill -9, and use one of the interrupt signals SIGHUP (Unix Only), SIGINT, or SIGTERM  instead, the jvm interruption handler will have a chance to kick in and call stop via the shutdownHooks registered by the broker.\n\nBut you can also use ./bin/activemq stop on unix, see : http://activemq.apache.org/unix-shell-script.html\nI guess activemq stop is the preferred approach, it will try via jmx first and then revert to kill after some timeout.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T12:32:16.563+0000","updated":"2010-10-05T12:32:16.563+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942973","id":"12942973","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swapnonil","name":"swapnonil","key":"swapnonil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Swapnonil Mukherjee","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary,\n\nI can indeed confirm that in our case the problem started only after someone killed the activemq process using kill -9. As I reported earlier, when I deleted everything under localhost/scheduler folder and restarted activemq it started cleanly.\n\nWith regards to your suggestion of testing 5.5 Snapshot; Are you saying that with 5.5 activemq can recover correctly from these kill -9 type shutdowns and we won't see this \"Chunk Stream\" errors? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swapnonil","name":"swapnonil","key":"swapnonil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Swapnonil Mukherjee","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T18:33:42.572+0000","updated":"2010-10-05T18:33:42.572+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942933","id":"12942933","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"yes. it would be great if you could validate the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-05T18:37:46.306+0000","updated":"2010-10-05T18:37:46.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942988","id":"12942988","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"body":"Gary,\n\nMany thanks, the fix works so far. I am still in the process of further testing , but a corrupted KahaDB is now properly recovered on restart.\n\nI think in my specific RA case that 'not' calling 'waitUntilStopped()'  in the RA may have caused the corruption - If the system exits too early then this would be the culprit.\n\nI'll let you know if and when I find something.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andyg","name":"andyg","key":"andyg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andyg&avatarId=20366","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andyg&avatarId=20366","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andyg&avatarId=20366","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andyg&avatarId=20366"},"displayName":"Andy Gumbrecht","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-06T13:16:19.256+0000","updated":"2010-10-06T13:16:19.256+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942946","id":"12942946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"thanks for the validation andy, marking resolved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-06T13:43:16.993+0000","updated":"2010-10-06T13:43:16.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942995","id":"12942995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fgynnild","name":"fgynnild","key":"fgynnild","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Gynnild","active":true,"timeZone":"Europe/Oslo"},"body":"Great that you found and fixed this issue! What is the strategy of back porting critical and blocker issues like this? The severity of this bug leaves 5.4.* useless in a production environment, but it is still announced as the stable one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fgynnild","name":"fgynnild","key":"fgynnild","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Gynnild","active":true,"timeZone":"Europe/Oslo"},"created":"2010-10-06T14:13:40.108+0000","updated":"2010-10-06T14:13:40.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942784","id":"12942784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eduzanni","name":"eduzanni","key":"eduzanni","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Zanni","active":true,"timeZone":"Etc/UTC"},"body":"I agree with Frank. This issue has been affecting us too (we're using Fuse broker v. 5.4, which in turn relies on activeMQ 5.4). Is there any prevision regarding a \"patched\" release for version 5.4 with Gary's fix that can be used safely in a production environment?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eduzanni","name":"eduzanni","key":"eduzanni","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Zanni","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-07T18:32:47.642+0000","updated":"2010-10-07T18:32:47.642+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943010","id":"12943010","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tomdz","name":"tomdz","key":"tomdz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Dudziak","active":true,"timeZone":"America/Los_Angeles"},"body":"FWIW, I get this issue on first write into a new KahaDB store, as well, though not consistently. In this particular case, ActiveMQ is used in a unit test and KahaDB is configured to write to a new temporary directory. The startup code looks like this:\n\nFile tmpDir = File.createTempFile(\"activmq\", \"\");\n\ntmpDir.delete();\ntmpDir.mkdir();\n\nKahaDBStore kaha = new KahaDBStore();\n\nkaha.setDirectory(localDbDir);\n\nBrokerService broker = new BrokerService();\n\nbroker.setUseShutdownHook(true);\nbroker.setPersistenceAdapter(kaha);\nbroker.addConnector(\"vm://localhost:12345\" );\nbroker.start();\n\nThen the very first message (jms producer using via a vm connection) fails with this error:\n\nVMTransport org.apache.activemq.broker.TransportConnection.Transport Transport failed: java.io.EOFException: Chunk stream does not exist at page: 0\njava.io.EOFException: Chunk stream does not exist at page: 0\n\tat org.apache.kahadb.page.Transaction$2.readPage(Transaction.java:454)\n\tat org.apache.kahadb.page.Transaction$2.<init>(Transaction.java:431)\n\tat org.apache.kahadb.page.Transaction.openInputStream(Transaction.java:428)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:404)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:361)\n\tat org.apache.activemq.broker.scheduler.JobSchedulerStore$3.execute(JobSchedulerStore.java:250)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:728)\n\tat org.apache.activemq.broker.scheduler.JobSchedulerStore.doStart(JobSchedulerStore.java:239)\n\tat org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:53)\n\tat org.apache.activemq.broker.scheduler.SchedulerBroker.getStore(SchedulerBroker.java:197)\n\tat org.apache.activemq.broker.scheduler.SchedulerBroker.getInternalScheduler(SchedulerBroker.java:184)\n\tat org.apache.activemq.broker.scheduler.SchedulerBroker.send(SchedulerBroker.java:131)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:230)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:460)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:663)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:309)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:185)\n\tat org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n\tat org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n\tat org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:218)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tomdz","name":"tomdz","key":"tomdz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Dudziak","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-10-08T01:48:12.896+0000","updated":"2010-10-08T01:50:23.099+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943014","id":"12943014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swapnonil","name":"swapnonil","key":"swapnonil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Swapnonil Mukherjee","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary,\n\nWe verified the fix. It works as expected. \n\nHowever since there is no talk of merging this fix back to 5.4 we are going into production from Monday onwards with 5.5 Snapshot.\n\nWe thank you for applying this fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swapnonil","name":"swapnonil","key":"swapnonil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Swapnonil Mukherjee","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-08T07:35:32.681+0000","updated":"2010-10-08T07:35:32.681+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12942985","id":"12942985","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fgynnild","name":"fgynnild","key":"fgynnild","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Gynnild","active":true,"timeZone":"Europe/Oslo"},"body":"I also tried the fix, and I no longer got the error message. But not all queues are working afterwards. Some queues work as expected, but for some of the other queues nothing gets into them. And there is no error messages either, neither on the server or the client side. Does anyone else experience this behavior?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fgynnild","name":"fgynnild","key":"fgynnild","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Gynnild","active":true,"timeZone":"Europe/Oslo"},"created":"2010-10-08T14:01:29.718+0000","updated":"2010-10-08T14:01:29.718+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943024","id":"12943024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Frank, can you try an reproduce with trace level logging?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-08T14:08:03.307+0000","updated":"2010-10-08T14:08:03.307+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943038","id":"12943038","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=norman","name":"norman","key":"norman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=norman&avatarId=32504","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=norman&avatarId=32504","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=norman&avatarId=32504","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=norman&avatarId=32504"},"displayName":"Norman Maurer","active":true,"timeZone":"Etc/UTC"},"body":"We saw the same exception in JAMES. IMHO a backport of the fix is a must because its really unacceptable to only be able to start again when purge all data. Thats just a no-go for a production service.. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=norman","name":"norman","key":"norman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=norman&avatarId=32504","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=norman&avatarId=32504","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=norman&avatarId=32504","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=norman&avatarId=32504"},"displayName":"Norman Maurer","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-10T18:08:31.381+0000","updated":"2010-10-10T18:08:31.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943101","id":"12943101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eduzanni","name":"eduzanni","key":"eduzanni","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Zanni","active":true,"timeZone":"Etc/UTC"},"body":"Any news on the backport possibility for this issue? We'd like having the scheduled/delayed message delivery available, so reverting to version 5.3 wouldn't be so much of a nice option for us here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eduzanni","name":"eduzanni","key":"eduzanni","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Zanni","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-21T21:21:23.402+0000","updated":"2010-10-21T21:21:23.402+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943116","id":"12943116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"we will drop a new release 5.4.2 once we get completion on a few more outstanding issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-22T07:56:00.033+0000","updated":"2010-10-22T07:56:00.033+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943102","id":"12943102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jns","name":"jns","key":"jns","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jns","active":true,"timeZone":"Etc/UTC"},"body":"Gary,\n Activemq 5.5 snapshot fix worked. Thanks for the fix. \nCan you provide us with an approximate 5.4.2 release date....Just a rough estimate would be fine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jns","name":"jns","key":"jns","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jns","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-22T23:11:59.515+0000","updated":"2010-10-22T23:11:59.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943157","id":"12943157","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rbonneau","name":"rbonneau","key":"rbonneau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard Bonneau","active":true,"timeZone":"Etc/UTC"},"body":"As requested by Eduardo Zanni above, can anyone supply a workaround if using 5.4.0?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rbonneau","name":"rbonneau","key":"rbonneau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard Bonneau","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-01T22:28:44.340+0000","updated":"2010-11-01T22:28:44.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943188","id":"12943188","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=redvortex","name":"redvortex","key":"redvortex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Monfette","active":true,"timeZone":"Etc/UTC"},"body":"We are also looking for either:\n\n- A workaround for 5.4.1\n- A 5.4.2 version that includes this fix\n\nWe need to move to 5.4.x from 5.3.2 but cannot do so because of this critical issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=redvortex","name":"redvortex","key":"redvortex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Monfette","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-08T16:53:01.627+0000","updated":"2010-11-08T16:53:01.627+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943204","id":"12943204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=okozlov","name":"okozlov","key":"okozlov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kozlov","active":true,"timeZone":"Etc/UTC"},"body":"Could one of the Activemq developers provide a date for the next release that will include a fix for this issue? Whatever it will be.. 5.4.2 or 5.5.0.\n\nWe are in the final stage of developing an large system that will go to production in beginning of December and we are experiencing this issue in staging (using 5.4.1). It would be really nice to get a fix before Dec.1  If it's not possible - is there a patch for 5.4.1 or a workaround?\n\nReally appreciate!\n\nRegards,\nOleg.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=okozlov","name":"okozlov","key":"okozlov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oleg Kozlov","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-11T02:20:17.766+0000","updated":"2010-11-11T02:20:17.766+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12943203","id":"12943203","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85%40gmail.com","name":"srodrigu85@gmail.com","key":"srodrigu85@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"body":"@Oleg: The issue is resolved in the trunk, you can always pickup the latest sourcecode there and compile, or grab the nightly builds.\nBut there is a discussion in the mailing list, there should be a 5.4.2 soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85%40gmail.com","name":"srodrigu85@gmail.com","key":"srodrigu85@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-11T05:53:33.644+0000","updated":"2010-11-11T05:53:33.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/12973878","id":"12973878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randy_palmer","name":"randy_palmer","key":"randy_palmer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Randy Palmer","active":true,"timeZone":"Etc/UTC"},"body":"It seems like schedulerSupport defaulted to true in 5.4.1.  It appears to default to false in 5.4.2 so you may need to explicitly set schedulerSupport=true on your broker when you update from 5.4.1. to 5.4.2 if it's not already in your config file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randy_palmer","name":"randy_palmer","key":"randy_palmer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Randy Palmer","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-21T20:48:24.259+0000","updated":"2010-12-21T20:48:24.259+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/14933672","id":"14933672","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=volkerk","name":"volkerk","key":"volkerk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Volker Kleinschmidt","active":true,"timeZone":"America/Chicago"},"body":"This error still happens in 5.10 with the PList store (tmp_storage), which always uses kahaDB. A lot!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=volkerk","name":"volkerk","key":"volkerk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Volker Kleinschmidt","active":true,"timeZone":"America/Chicago"},"created":"2015-09-28T17:58:20.690+0000","updated":"2015-09-28T17:58:20.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483866/comment/14949795","id":"14949795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fenghao0038","name":"fenghao0038","key":"fenghao0038","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hao Feng","active":true,"timeZone":"Asia/Shanghai"},"body":"I met the same problem in 5.8 . I wonder  how did you resolve your problem in 5.10 , Using the workaround by set the schedulerSupport=false  ?\nI will always use KahaDB and even sometimes need the scheduler function . \nWould you please share some of your good experience ?  Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fenghao0038","name":"fenghao0038","key":"fenghao0038","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hao Feng","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-10-09T02:49:19.106+0000","updated":"2015-10-09T02:49:19.106+0000"}],"maxResults":44,"total":44,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2935/votes","votes":17,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ba07:"}}