{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483633","self":"https://issues.apache.org/jira/rest/api/2/issue/12483633","key":"AMQ-2742","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2010-05-19T15:11:22.770+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Feb 04 22:15:23 UTC 2012","customfield_12310420":"43763","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_54112304768_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-02-04T22:15:23.184+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2742/watchers","watchCount":1,"isWatching":false},"created":"2010-05-19T15:03:38.843+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-02-04T22:15:23.600+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313904","id":"12313904","name":"JMX","description":"The JMX support in ActiveMQ"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have the following situation:\nA static network of brokers, working on hostA:61619 and hostB:61619, both with JMX enabled as shown in this Spring configuration:\n\n{noformat}\n<amq:broker xmlns=\"http://activemq.apache.org/schema/core\" id=\"broker\" persistent=\"false\" useJmx=\"true\"\n\tbrokerName=\"${hostname}:61619\" useShutdownHook=\"false\">\n\t\n\t<amq:destinationPolicy>\n\t\t<amq:policyMap>\n\t\t\t<amq:defaultEntry>\n\t\t\t\t<amq:policyEntry queue=\"${queue-name}\">\n\t\t\t\t\t<amq:dispatchPolicy>\n\t\t\t\t\t\t<amq:roundRobinDispatchPolicy />\n\t\t\t\t\t</amq:dispatchPolicy>\n\t\t\t\t</amq:policyEntry>\n\t\t\t</amq:defaultEntry>\n\t\t</amq:policyMap>\n\t</amq:destinationPolicy> \n\n\t<!-- Use the default JVM JMX connector -->\n\t<amq:managementContext>\n\t\t<amq:managementContext createConnector=\"false\" />\n\t</amq:managementContext>\n\n\t<amq:networkConnectors>\n\t<!--  Cluster configuration: build a static network of brokers -->\n\t  <amq:networkConnector uri=\"static:(tcp://${HOSTNAME_OF_OTHER_INSTANCE}:61619)\" />\n\t</amq:networkConnectors>\n\n\t<amq:transportConnectors>\n\t  <!-- \"listen\" on the in-VM transport -->\n\t  <amq:transportConnector uri=\"vm://my-server\" />\n\t  \n\t  <!-- listen on a statically chosen tcp port which is announced for discovery -->\n\t  <amq:transportConnector uri=\"tcp://0.0.0.0:61619\"\n\t\tdiscoveryUri=\"multicast://default?group=${activemq-group}\" />\n\t</amq:transportConnectors>\n</amq:broker>\n{noformat}\n\nMy application looks like this:\n\n # Both host instances are connected via VM transport to the broker and wait for new messages in $queue-name\n # Clients send messages to this shared queue with a TempQueue to which the hosts shall reply:\n {code}\n\tQueueConnectionFactory factory = new ActiveMQConnectionFactory(\"failover:(...)\");\n\tQueueConnection connection = factory.createQueueConnection();\n    Queue session = connection.createQueueSession(false, Session.AUTO_ACKNOWLEDGE);\n    final QueueSender producer = session.createSender(session.createQueue($queue-name));\n\tTemporaryQueue rxQueue = session.createTemporaryQueue();\n\tObjectMessage initMessage = session.createObjectMessage(...);\n\tinitMessage.setJMSReplyTo(rxQueue);\n\tproducer.send(initMessage, DeliveryMode.NON_PERSISTENT, Message.DEFAULT_PRIORITY, 100000);\n\t// When the host takes this initMessage from the queue, it creates a 2nd temp queue for further client messages\n\t// Do some work...\n\t// Close everything: connection, session, producer and in particular:\n\trxQueue.delete();\n\t// Host closes 2nd temp queue, too\n{code}\n\nSay a client connects to hostA (e.g. via tcp://hostA:616169) and hostA takes the client request from the queue. Now I can see a non-durable subscription for the temporary queue the client has created in the JMX consoles of both host instances. But after the temp queue was deleted the subscription still exists on hostB.\nAfter several requests there are a lot of subscriptions for deleted queues in the JMX console which looks like a potential memory leak. (-> screenshot)\n\t\nI've seen this effect in ActiveMQ version 5.3.0 and 5.3.2\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172243","customfield_12312823":null,"summary":"Subscription on TempQueues in Network-Of-Brokers not deleted","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geissebn","name":"geissebn","key":"geissebn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Geißelmeier","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12483291","key":"AMQ-2706","self":"https://issues.apache.org/jira/rest/api/2/issue/12483291","fields":{"summary":"Memory leak & huge thread count in broker","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geissebn","name":"geissebn","key":"geissebn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Geißelmeier","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"seen on Win XP, Win 7, Server 2003 and 2008","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483633/comment/12942680","id":"12942680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geissebn","name":"geissebn","key":"geissebn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Geißelmeier","active":true,"timeZone":"Etc/UTC"},"body":"Unfortunately I cannot attach a screenshot :(","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geissebn","name":"geissebn","key":"geissebn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Geißelmeier","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-19T15:06:12.690+0000","updated":"2010-05-19T15:06:12.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483633/comment/12942679","id":"12942679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"This looks like it has been resolved on trunk with the fix for https://issues.apache.org/activemq/browse/AMQ-2706  can u verify with a 5.4-SNAPSHOT","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-19T15:11:22.770+0000","updated":"2010-05-19T15:11:22.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483633/comment/12942686","id":"12942686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geissebn","name":"geissebn","key":"geissebn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Geißelmeier","active":true,"timeZone":"Etc/UTC"},"body":"It almost works... I can see subscriptions comming and going, but after a while, the old behavior is back.\nInstead the following Exception appears periodically in the log of hostB:\n\n{noformat}\nWARN  [, Service] Async error occurred: java.lang.IllegalStateException: Cannot remove a produce\nr that had not been registered: ID:hostB-65486-1274287604271-4:2:186:1\njava.lang.IllegalStateException: Cannot remove a producer that had not been registered: ID:hostB-6548\n6-1274287604271-4:2:186:1\n     at org.apache.activemq.broker.TransportConnection.processRemoveProducer(TransportConnection.java:525)\n     at org.apache.activemq.command.RemoveInfo.visit(RemoveInfo.java:78)\n     at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:306)\n     at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:182)\n     at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n     at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n     at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:217)\n     at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n     at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:219)\n     at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:201)\n     at java.lang.Thread.run(Unknown Source)\n{noformat}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geissebn","name":"geissebn","key":"geissebn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Geißelmeier","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-20T07:24:28.549+0000","updated":"2010-05-20T07:24:28.549+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483633/comment/12942695","id":"12942695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hennejg","name":"hennejg","key":"hennejg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg Henne","active":true,"timeZone":"Europe/Berlin"},"body":"These two issues seen to be related.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hennejg","name":"hennejg","key":"hennejg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg Henne","active":true,"timeZone":"Europe/Berlin"},"created":"2010-05-20T11:02:09.869+0000","updated":"2010-05-20T11:02:09.869+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483633/comment/13200573","id":"13200573","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"No test case to validate.  Suggest trying with the latest 5.6-SNAPSHOT to determine if this still exists.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-02-04T22:15:23.537+0000","updated":"2012-02-04T22:15:23.537+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2742/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tugf:"}}