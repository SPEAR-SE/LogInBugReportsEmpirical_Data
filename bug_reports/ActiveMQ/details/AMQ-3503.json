{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12523323","self":"https://issues.apache.org/jira/rest/api/2/issue/12523323","key":"AMQ-3503","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2011-09-16T13:02:20.284+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Sep 19 13:16:37 UTC 2011","customfield_12310420":"39715","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_260687793_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-09-19T13:16:37.776+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3503/watchers","watchCount":1,"isWatching":false},"created":"2011-09-16T12:51:50.024+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-09-19T13:16:37.811+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"lsof | grep apache | grep data/localhost | wc -l\nShows constantly increasing number of open files. Had 1016 open when it died.\nulimit is set at 1024.\nDocs say files are supposed to be removed when \"no longer needed\".\nWe're running 3 producers and 3 consumers so no messages should be left in the queue.\nAt the point of dying we have put in around 2 billion messages.\n\n2011-09-16 00:18:21,148 | ERROR | I/O error | org.apache.activemq.broker.region.cursors.FilePendingMessageCursor | Queue:MCNA\njava.io.FileNotFoundException: /usr/local/apache-activemq-5.5.0/data/localhost/tmp_storage/db-1987.log (Too many open files)\n  at java.io.RandomAccessFile.open(Native Method)\n  at java.io.RandomAccessFile.<init>(RandomAccessFile.java:212)\n  at org.apache.kahadb.journal.DataFile.openRandomAccessFile(DataFile.java:70)\n  at org.apache.kahadb.journal.DataFileAccessor.<init>(DataFileAccessor.java:49)\n  at org.apache.kahadb.journal.DataFileAccessorPool$Pool.openDataFileReader(DataFileAccessorPool.java:53)\n  at org.apache.kahadb.journal.DataFileAccessorPool.openDataFileAccessor(DataFileAccessorPool.java:139)\n  at org.apache.kahadb.journal.Journal.read(Journal.java:598)\n  at org.apache.activemq.store.kahadb.plist.PListStore.getPayload(PListStore.java:337)\n  at org.apache.activemq.store.kahadb.plist.PList.getNext(PList.java:316)\n  at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor$DiskIterator.next(FilePendingMessageCursor.java:500)\n  at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor$DiskIterator.next(FilePendingMessageCursor.java:473)\n  at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.next(FilePendingMessageCursor.java:293)\n  at org.apache.activemq.broker.region.cursors.StoreQueueCursor.next(StoreQueueCursor.java:135)\n  at org.apache.activemq.broker.region.Queue.doPageInForDispatch(Queue.java:1714)\n  at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1932)\n  at org.apache.activemq.broker.region.Queue.iterate(Queue.java:1440)\n  at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:104)\n  at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:42)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81716","customfield_12312823":null,"summary":"Too many open files for db log","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdblack98","name":"mdblack98","key":"mdblack98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Black","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdblack98","name":"mdblack98","key":"mdblack98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Black","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Redhat 5.7.  Default conf file used for startup","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523323/comment/13106035","id":"13106035","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"can you try this scenario with a 5.6-SNAPSHOT, the plist store has had a revamp since 5.5","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-16T13:02:20.284+0000","updated":"2011-09-16T13:02:20.284+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523323/comment/13106043","id":"13106043","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdblack98","name":"mdblack98","key":"mdblack98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Black","active":true,"timeZone":"America/Chicago"},"body":"Sure...can you tell me how?  A link somewhere?\n\n\n\nI'm not exactly a Java wiz....\n\n\n\nMichael D. Black\n\nSenior Scientist\n\nNG Information Systems\n\nAdvanced Analytics Directorate\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdblack98","name":"mdblack98","key":"mdblack98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Black","active":true,"timeZone":"America/Chicago"},"created":"2011-09-16T13:14:09.102+0000","updated":"2011-09-16T13:14:09.102+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523323/comment/13106065","id":"13106065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"body":"You can get the latest snapshot version from [here|https://repository.apache.org/content/groups/snapshots-group/org/apache/activemq/apache-activemq/5.6-SNAPSHOT/].","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2011-09-16T13:40:37.791+0000","updated":"2011-09-16T13:40:37.791+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523323/comment/13106092","id":"13106092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdblack98","name":"mdblack98","key":"mdblack98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Black","active":true,"timeZone":"America/Chicago"},"body":"The db log files seem to be getting deleted now...whereas before (in 5.5.0) all the db-*-.log files were still in the directory (over 1000 of them).\n\nSo...for right now the latest snapshot seems to have fixed this.\n\nI'll follow up later after a few billion messages have been put in the queue and it's still running.\n\nThat will be in a day or two.\n\nTotal files open by apachemq seems stable at around 212-215\n\nlsof | grep apache | wc -l\n\n\n\nls -l\ntotal 96360\n-rw-rw-r-- 1 root root 33554649 Sep 16 10:21 db-44.log\n-rw-rw-r-- 1 root root 33554465 Sep 16 10:21 db-45.log\n-rw-rw-r-- 1 root root 33030144 Sep 16 10:21 db-46.log\n-rw-rw-r-- 1 root root        0 Sep 16 10:17 lock\n-rw-rw-r-- 1 root root    12288 Sep 16 10:17 tmpDB.data\n-rw-rw-r-- 1 root root    12304 Sep 16 10:17 tmpDB.redo\n\nMichael D. Black\n\nSenior Scientist\n\nNG Information Systems\n\nAdvanced Analytics Directorate\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdblack98","name":"mdblack98","key":"mdblack98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Black","active":true,"timeZone":"America/Chicago"},"created":"2011-09-16T14:32:08.574+0000","updated":"2011-09-16T14:32:08.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523323/comment/13107785","id":"13107785","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdblack98","name":"mdblack98","key":"mdblack98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Black","active":true,"timeZone":"America/Chicago"},"body":"OK...I think we can close this now as of the latest snapshot\nI've pumped in about 5 billion message.\nI've got 207 files open now so it's not increasing at all.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdblack98","name":"mdblack98","key":"mdblack98","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Black","active":true,"timeZone":"America/Chicago"},"created":"2011-09-19T12:45:39.331+0000","updated":"2011-09-19T12:45:39.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523323/comment/13107801","id":"13107801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"PList updates have resolved this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-09-19T13:16:37.786+0000","updated":"2011-09-19T13:16:37.786+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3503/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ec27:"}}