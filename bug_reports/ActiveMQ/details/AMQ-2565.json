{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483683","self":"https://issues.apache.org/jira/rest/api/2/issue/12483683","key":"AMQ-2565","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2011-06-29T21:26:43.877+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 08 22:33:48 UTC 2011","customfield_12310420":"68685","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_46838977318_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-08T22:33:48.302+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2565/watchers","watchCount":2,"isWatching":false},"created":"2010-01-12T19:44:11.493+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-07-08T22:33:48.313+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"MessageListener that is triggered by a message in queue A reads messages from queue B using JmsTemplate. Although there are more messages in queue B, it can only read the first one. The bug was introduced in AMQ 5.3\n\nThis is related to [CAMEL-2305|https://issues.apache.org/activemq/browse/CAMEL-2305].\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461593","id":"12461593","filename":"TransactedConcurrentConsumerTest.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dragisak","name":"dragisak","key":"dragisak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dragisak&avatarId=12932","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dragisak&avatarId=12932","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dragisak&avatarId=12932","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dragisak&avatarId=12932"},"displayName":"Dragisa Krsmanovic","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-01-12T19:47:30.921+0000","size":6824,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461593/TransactedConcurrentConsumerTest.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"172220","customfield_12312823":null,"summary":"Consumer skips messages in a queue when invoked from another queue","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dragisak","name":"dragisak","key":"dragisak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dragisak&avatarId=12932","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dragisak&avatarId=12932","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dragisak&avatarId=12932","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dragisak&avatarId=12932"},"displayName":"Dragisa Krsmanovic","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dragisak","name":"dragisak","key":"dragisak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dragisak&avatarId=12932","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dragisak&avatarId=12932","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dragisak&avatarId=12932","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dragisak&avatarId=12932"},"displayName":"Dragisa Krsmanovic","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"ActiveMQ 5.4-SNAPSHOT, Spring 2.5.6, JDK 1.6","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483683/comment/12941993","id":"12941993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dragisak","name":"dragisak","key":"dragisak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dragisak&avatarId=12932","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dragisak&avatarId=12932","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dragisak&avatarId=12932","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dragisak&avatarId=12932"},"displayName":"Dragisa Krsmanovic","active":true,"timeZone":"America/Los_Angeles"},"body":"Added patch with unit test that demonstrates this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dragisak","name":"dragisak","key":"dragisak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dragisak&avatarId=12932","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dragisak&avatarId=12932","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dragisak&avatarId=12932","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dragisak&avatarId=12932"},"displayName":"Dragisa Krsmanovic","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-01-12T19:47:30.989+0000","updated":"2010-03-12T17:13:17.317+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483683/comment/13057477","id":"13057477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The test fails because the JMSTemplate creates a new consumer on each call to receive, and the fact that its inside a transaction when onMessage is called means that the consumers aren't closed until the transaction is committed.  Since the consumers have their prefetch left at default settings the second message is sitting in the prefetch buffer of the consumer created by the first call to JMSTemplate receive.  Once the onMessage completes and the transaction is committed the second message is available for dispatch once again.  You can observe this by adding another call to the JMSTemplate send to Queue A, then you test condition will be met and the test will pass.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-06-29T21:26:43.877+0000","updated":"2011-06-29T21:26:43.877+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483683/comment/13062233","id":"13062233","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Test case is invalid use of transactional JMS.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-07-08T22:33:48.311+0000","updated":"2011-07-08T22:33:48.311+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2565/votes","votes":4,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tubb:"}}