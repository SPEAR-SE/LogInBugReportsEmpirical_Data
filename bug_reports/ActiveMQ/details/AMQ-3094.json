{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12493543","self":"https://issues.apache.org/jira/rest/api/2/issue/12493543","key":"AMQ-3094","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-12-23T13:22:31.347+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 28 15:26:18 UTC 2011","customfield_12310420":"14715","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_499995065_*|*_5_*:*_2_*:*_37499609_*|*_4_*:*_1_*:*_3080327062","customfield_12312321":null,"resolutiondate":"2011-01-28T15:26:18.132+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3094/watchers","watchCount":1,"isWatching":false},"created":"2010-12-17T18:29:16.396+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"issuelinks":[{"id":"12345420","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12345420","type":{"id":"10020","name":"Cloners","inward":"is cloned by","outward":"is a clone of","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10020"},"inwardIssue":{"id":"12530969","key":"AMQ-3585","self":"https://issues.apache.org/jira/rest/api/2/issue/12530969","fields":{"summary":"CLONE - ajax client does not receive all messages","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12387873","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12387873","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12713666","key":"AMQ-5182","self":"https://issues.apache.org/jira/rest/api/2/issue/12713666","fields":{"summary":"ActiveMQ web demo - chat example - Very slow on JBoss7 after AMQ-4801","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-05-12T17:09:00.691+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Not all messages written to a destination are delivered to an ajax client.  This seems particularly true if more than 1 message should be returned to a client at once.  Often, if 5 messages are available, only the first 1 is actually returned in the <ajax-response> XML.  The other 4 are lost.\n\nSteps to reproduce:\n * Place the attached chat-sent.html in activemq/webapps/demo/  (or in activemq-trunk/activemq-web-demo/src/main/webapp in an svn working copy).\n * Start ActiveMQ.\n * Browse to http://localhost:8161/demo/chat.html & join the chat room.\n * In a new window, browse to http://localhost:8161/demo/chat-send.html\n\nchat-send.html will send 5 message to topic://CHAT.DEMO.  Only 1 (or sometimes 2) messages will be received by the original browser window which is subscribed to the topic.  The activemq web admin will verify that 5 messages were actually sent.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12467892","id":"12467892","filename":"all_messages_are_delivered_to_ajax_clients.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-10T15:55:51.076+0000","size":29423,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12467892/all_messages_are_delivered_to_ajax_clients.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12467757","id":"12467757","filename":"all_messages_are_delivered_to_ajax_clients.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-07T20:27:54.205+0000","size":29423,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12467757/all_messages_are_delivered_to_ajax_clients.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12466479","id":"12466479","filename":"chat-send.html","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-17T18:30:20.880+0000","size":2855,"mimeType":"text/html","content":"https://issues.apache.org/jira/secure/attachment/12466479/chat-send.html"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12466485","id":"12466485","filename":"include-commons-httpclient-in-pom-xml.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-17T19:10:55.655+0000","size":466,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12466485/include-commons-httpclient-in-pom-xml.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59537","customfield_12312823":null,"summary":"ajax client does not receive all messages","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"OSX 10.6 on MacBook Pro\n\njava version \"1.6.0_20\"\nJava(TM) SE Runtime Environment (build 1.6.0_20-b02-279-10M3065)\nJava HotSpot(TM) 64-Bit Server VM (build 16.3-b01-279, mixed mode)\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12972580","id":"12972580","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"Test file which publishes 5 messages to topic://CHAT.DEMO.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-17T18:30:20.924+0000","updated":"2010-12-17T18:30:20.924+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12972600","id":"12972600","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"Attached test case does the following:\n * publishes 3 messages to queue://test\n * subscribes to queue://test using an http POST to the AjaxServlet\n * polls for messages\n\nThe results of the test are inconsistent.  Sometimes the client receives all messages, sometimes the client receives 0 messages.  (See attached test output in AjaxTest-output.txt.)  These results are not consistent with what I'm seeing in JavaScript testing, where I always seem to receive at least one message, but still provide some documentation for the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-17T19:10:55.711+0000","updated":"2010-12-17T19:10:55.711+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12972666","id":"12972666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"In AjaxTest-output.txt, also note that for the test runs where no messages are received also show 2 GET requests being made.  The test run where all messages are received shows only a single GET request.  I'm not sure what that means, given that the test has only a single GET.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-17T22:10:30.851+0000","updated":"2010-12-17T22:10:30.851+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12974442","id":"12974442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"I added 1 debugging statement to MessageListenerServlet.writeMessageResponse.  (See attached patch & sample output.)  The output shows that several individual messages sent from another web client are contained in properties of this single ActiveMQTextMessage.  This seems very likely to be the root cause of the problem.\n\nIs this normal behavior, and we need to search all properties of a TextMessage when writing a response to a client?  Or is it that we need to send messages differently so each 'send' POST actually creates a distinct TextMessage?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-22T23:52:12.050+0000","updated":"2010-12-22T23:52:12.050+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12974618","id":"12974618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Fixed with svn revision 1052259.\n\nThe problem was that messages received between POST and GET calls were ignored. That should be fixed now. I modified a provided test a bit to demonstrate this issue every time.\n\nThanks for the great work!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-12-23T13:22:31.347+0000","updated":"2010-12-23T13:22:31.347+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12974789","id":"12974789","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"Dejan: Take a look at the message properties in https://issues.apache.org/jira/secure/attachment/12466851/write_message_response_debugging_output.txt.  There are four messages here, but only 1 of them gets delivered.\n\nThe interesting bits are these:\n  message=<message type=\"chat\" from=\"test-user\">message two</message>\n  text = <message type=\"chat\" from=\"test-user\">message five</message>\n  destination = topic://CHAT.DEMO\n  m1=<message type=\"chat\" from=\"test-user\">message three</message>\n  m2=<message type=\"chat\" from=\"test-user\">message four</message>\n  m3=<message type=\"chat\" from=\"test-user\">message five</message>\n  t1=send\n  t3=send\n  t2=send\n  d1=topic://CHAT.DEMO\n  d2=topic://CHAT.DEMO\n  d3=topic://CHAT.DEMO\n\nWhen an ajax client sends many messages in a short amount of time, they are then delivered to other clients in a single ActiveMQTextMessage.  writeMessageResponse() doesn't handle this properly, and only delivers one of the messages to a subscriber.\n\nI'm not sure if this is a problem on the sending or receiving side.  (Is it legitimate to have multiple messages piled into a single ActiveMQTextMessage like this?)  I agree the junit test now passes, but I don't think the issue is resolved yet.  I'll work on getting some more tests created which reproduce this issue.  For now, you should be able to reproduce it using the chat-send.html script I've already attached to the ticket.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-23T23:47:30.986+0000","updated":"2010-12-23T23:47:30.986+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12977931","id":"12977931","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"Attached test shows that an ajax client will miss messages which arrive while an ajax poll request is in progress.\n\nThis test uses org.eclipse.jetty.client.HttpClient rather than org.apache.commons.httpclient.HttpClient.  I was able to get session handling working with the Jetty HttpClient, and it's much better at async requests than the commons HttpClient.\n\nI sometimes see an org.eclipse.jetty.io.EofException in the poll request.  The cause is unclear.  Sometimes the error disappears simply by re-running the test.  Sometimes doing a recompile of activemq-trunk/activemq-web and then re-running the test causes the error to disappear.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-05T19:44:54.559+0000","updated":"2011-01-05T19:44:54.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12977932","id":"12977932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"Sample test output showing the presence/absence of the EofException I noted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-05T19:46:11.766+0000","updated":"2011-01-05T19:46:11.766+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12978948","id":"12978948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"Patch will allow an ajax client to receive all messages.  Several other tests are included for previously-untested ajax code.\n\nThe following tests fail w/o the patch:\n  testAjaxClientReceivesMessagesWhichAreSentToQueueWhileClientIsPolling\n  testAjaxClientReceivesMessagesWhichAreSentToTopicWhileClientIsPolling\n  testStompMessagesAreReceivedByAjaxClient","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-07T20:27:54.267+0000","updated":"2011-01-07T20:27:54.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12979612","id":"12979612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"Updated my svn working copy & re-generated patch due to request from Jeff Rose.  Now based on trunk r1057227.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-10T15:47:37.148+0000","updated":"2011-01-10T15:47:37.148+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12979614","id":"12979614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"Updated my svn working copy & re-generated patch due to request from Jeff Rose. Now based on trunk r1057227.  Previous version of this patch (w/ identical file name) was missing 1 test which should not have been omitted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-10T15:55:51.125+0000","updated":"2011-01-10T15:55:51.125+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12493543/comment/12988105","id":"12988105","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"Resolved in svn revision 1064725.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-28T15:26:18.053+0000","updated":"2011-01-28T15:26:18.053+0000"}],"maxResults":12,"total":12,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3094/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ak5b:"}}