{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12679335","self":"https://issues.apache.org/jira/rest/api/2/issue/12679335","key":"AMQ-4887","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326455","id":"12326455","name":"5.9.1","archived":false,"released":true,"releaseDate":"2014-04-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-11-25T15:25:16.697+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Dec 13 15:55:48 UTC 2013","customfield_12310420":"358697","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2461994715_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-12-13T15:55:48.616+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4887/watchers","watchCount":5,"isWatching":false},"created":"2013-11-15T04:02:33.943+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":86400,"aggregatetimeoriginalestimate":86400,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"issuelinks":[{"id":"12455469","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12455469","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12933814","key":"AMQ-6142","self":"https://issues.apache.org/jira/rest/api/2/issue/12933814","fields":{"summary":"ActiveMQBytesMessage decompress throws DataFormatException incorrect header check","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-01-26T09:29:01.934+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":86400,"customfield_12310080":null,"description":"ActiveMQBytesMessage will lost content if message's property was set before copy. Here is the test code:\n\nProducer:\nMessageProducer producer;  \n//initialize Connection, Session, MessageProducer    \nbyte[] bs = \"bytes message\".getBytes();  \nBytesMessage message = session.createBytesMessage();  \nmessage.writeBytes(bs);  //write bytes to message 1\n  \nfor(int i=0; i< 0; i++){  \n  // then set message's propery   2\n    message.setLongProperty(\"sendTime\", System.currentTimeMillis());  \n    try{  \n        producer.send(message);  \n    }catch(){  \n         e.printStackTrace();  \n    }\n}  \n\nConsumer:\n\nMessageConsumer consumer  \n//initailize Connection, Session, MessageConsumer  \nfor(int i=0; i<10; i++){  \n    ActiveMQBytesMessage msg = (ActiveMQBytesMessage)consumer.receive(60*1000);  \n    long sendTime = message.getLongProperty(\"sendTime\");  \n    System.out.println(\"sendtime:\" + sendTime);  \n    ByteSequence bs = message.getMessage().getContent();  \n    System.out.println(\"bytes data:\" + new String(bs.getData()));  \n}  \n\nExpected result:\nconsumer gets bytes data in all received messages\n\nActual result:\nonly the fisrt message has bytes data, all other messages lost bytes data, while long property value is not lost;\n\nAnalysization:\nmessage gets copied when send, it will call storeContent() before copy,  DataOutputStream dataOut will be closed and the data in dataOut will be set to conent. This works correctly if there are no property was set.\n\nwhen setLongProperty was called, it will call setObjectProperty() then will call  initializeWriting(), here DataOutputStream dataOut  will be create AGAIN. \n\nSo when message was copied in second time, DataOutputStream dataOut is NOT null, but EMPTY, it will clear the value in content.\n\nsuggestion:\nrestore the content data to DataOutputStream dataOut when nitializeWriting()\n\nmy fix:\nActiveMQBytesMessage :\n private void  initializeWriting() throws JMSException {\n669        The original code\n                ......\n701        \n            //fix code\n            if(this.content !=null && this.content.length >0){\n                try{\n                    this.dataOut.write(this.content.getData());\n                }catch(IOException ioe){\n                    throw JMSExceptionSupport.create(ioe);\n                }\n            }\n702    }","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616672","id":"12616672","filename":"ActiveMQBytesMessage.java.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-12-03T01:57:15.737+0000","size":669,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12616672/ActiveMQBytesMessage.java.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616713","id":"12616713","filename":"ActiveMQBytesMessageTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-12-03T07:52:37.980+0000","size":368,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12616713/ActiveMQBytesMessageTest.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12617239","id":"12617239","filename":"AMQ-4887.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-05T21:00:57.586+0000","size":10386,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12617239/AMQ-4887.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12617133","id":"12617133","filename":"AMQ-4887.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"created":"2013-12-05T09:02:06.029+0000","size":1056,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12617133/AMQ-4887.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616714","id":"12616714","filename":"Consumer.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-12-03T07:52:37.984+0000","size":1837,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12616714/Consumer.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616712","id":"12616712","filename":"Producer.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-12-03T07:52:37.976+0000","size":2071,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12616712/Producer.java"}],"aggregatetimeestimate":86400,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"358987","customfield_12312823":null,"summary":"ActiveMQBytesMessage will lost content if message's property was set before copy ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":86400,"percent":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":86400,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13831544","id":"13831544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Recommend you create a proper JUnit test case and a patch with your fix for use to review.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-11-25T15:25:16.697+0000","updated":"2013-11-25T15:25:16.697+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13837232","id":"13837232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"body":"patch for bug AMQ-4887","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-12-03T01:57:15.741+0000","updated":"2013-12-03T01:57:15.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13837241","id":"13837241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Still needs a unit test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-03T02:08:26.506+0000","updated":"2013-12-03T02:08:26.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13837429","id":"13837429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"body":"unit test for bug AMQ-4887","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caoyunfei","name":"caoyunfei","key":"caoyunfei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"caoyunfei","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-12-03T07:52:37.989+0000","updated":"2013-12-03T07:52:37.989+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13839956","id":"13839956","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"body":"This is a slightly modified version of the original patch.  Tim, can you review this?\n\nI have also added a test, AMQ4887Test.java to activemq-unit-tests\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"created":"2013-12-05T09:02:06.034+0000","updated":"2013-12-05T09:02:06.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13840030","id":"13840030","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I'll review in a bit","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-05T11:32:55.203+0000","updated":"2013-12-05T11:32:55.203+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13840214","id":"13840214","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The fix seems reasonable but I think there's still a problem here if the content is stored compressed.  If you simply rewrite the contents into the output stream and message compression is enabled you'd be writing compressed data with an output stream that's doing compression again so that's not good, plus you be adding new data onto already compressed content if you use any of the write methods so you are doubly corrupted.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-05T16:13:37.845+0000","updated":"2013-12-05T16:13:37.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13840219","id":"13840219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I'm also going to guess that the StreamMessage implementation suffers from the same problem and the test should be expanded to check that message too, as well as the compressed case.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-05T16:19:02.284+0000","updated":"2013-12-05T16:19:02.284+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13840559","id":"13840559","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"[~kearls] Updated the test case to show the other bits that are broken.  I patched the bytes message and started Stream Message.  Thought you might want to take a crack at addressing the compressed case in StreamMessage and seeing if there's anything else needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-05T21:00:18.588+0000","updated":"2013-12-05T21:00:18.588+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13840560","id":"13840560","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Updated patch that fixes bytes message and the uncompressed case in stream message.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-05T21:00:57.591+0000","updated":"2013-12-05T21:00:57.591+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679335/comment/13847595","id":"13847595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Wrapped this one up as I was afraid I might be seeing this in some AMQP dispatch scenarios.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-13T15:55:48.647+0000","updated":"2013-12-13T15:55:48.647+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4887/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1pu1r:"}}