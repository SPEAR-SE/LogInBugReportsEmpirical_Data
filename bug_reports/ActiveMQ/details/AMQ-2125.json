{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482501","self":"https://issues.apache.org/jira/rest/api/2/issue/12482501","key":"AMQ-2125","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-02-19T15:28:44.554+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 06 14:31:48 UTC 2010","customfield_12310420":"75064","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_46145656574_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-08-06T14:31:48.960+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2125/watchers","watchCount":2,"isWatching":false},"created":"2009-02-18T12:17:32.386+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-08-06T14:31:48.953+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When failing over to a new broker we see this exception. Although the exception is thrown no messages seem to be lost.\n\nThis can be reproduced using the following unit test and this setup:\n1. Create two activemq's using the same datasource.\n2. Run the test\n3. Kill the first active mq before the test completes (after you see the first Recieved Message... in the system out)\n4. See the exception thrown in the second activemq log\n\nimport org.apache.activemq.ActiveMQConnectionFactory;\n\nimport javax.jms.*;\nimport static javax.jms.Session.AUTO_ACKNOWLEDGE;\nimport static javax.jms.Session.SESSION_TRANSACTED;\n\nimport junit.framework.TestCase;\n\nimport java.util.concurrent.atomic.AtomicInteger;\n\npublic class BrokerTest extends TestCase {\n\n    public void testFoo() throws Exception {\n        ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(\"failover:(tcp://localhost:61616,tcp://localhost:61617)\");\n\n        Connection connection = connectionFactory.createConnection();\n        connection.start();\n\n        Session producerSession = connection.createSession(false, AUTO_ACKNOWLEDGE);\n\n        MessageProducer producer = producerSession.createProducer(producerSession.createQueue(\"testQueue\"));\n\n        for (int i = 0; i < 100; i++) {\n            System.out.println(\"Sending messages\");\n            producer.send(producerSession.createTextMessage(\"Hello\"));\n        }\n\n        final AtomicInteger atomicInteger = new AtomicInteger(0);\n\n        final Session consumerSession = connection.createSession(true, SESSION_TRANSACTED);\n        MessageConsumer messageConsumer = consumerSession.createConsumer(consumerSession.createQueue(\"testQueue\"));\n        messageConsumer.setMessageListener(new MessageListener() {\n\n\n\n            public void onMessage(Message message) {\n                try {\n                    System.out.println(\"Received Message\" + message);\n                    Thread.sleep(1000);\n                    atomicInteger.addAndGet(1);\n                    System.out.println(atomicInteger.get());\n                    consumerSession.commit();\n                } catch (Exception e) {\n                    throw new RuntimeException(\"Oh dear\", e);\n                }\n            }\n        });\n\n        Thread.sleep(2 * 60 * 1000);\n\n        assertEquals(100, atomicInteger.get());\n    }\n\n}\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"159868","customfield_12312823":null,"summary":"javax.jms.JMSException: Could not correlate acknowledgment with dispatched message thrown on failover","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teamhiro","name":"teamhiro","key":"teamhiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Team Hiro","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teamhiro","name":"teamhiro","key":"teamhiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Team Hiro","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"MacOS 10.5 and Solaris 10","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482501/comment/12940816","id":"12940816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"This exception is expected on failover if a transaction was in progress at the point of failover. \nThe failover transport on the client side has a state tracker for commands and transactions that have been sent so that it can recreate its state on the failover broker. In the case of a transaction commit that is out standing, the message acks will be replayed as part of the commit, the transaction will be replayed but the messages will not be present (as dispatched messages to a consumer ) on the failover broker, they will still be in the store as the original tx will have rolledback when the connection was dropped. These messages will be subsequently be redelivered. The exception occurs when the message corresponding to the ack cannot be found as pending in the broker but it can be safely ignored.\n\nJust to be sure this is what is occurring, is it possible to provide a log of both brokers with full logging enabled.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-19T15:28:44.554+0000","updated":"2009-02-19T15:28:44.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482501/comment/12941831","id":"12941831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fredrikj","name":"fredrikj","key":"fredrikj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fredrik Jonson","active":true,"timeZone":"Europe/Stockholm"},"body":"In activemq 5.2 and probably 5.3 this message is logged at loglevel ERROR. It would perhaps make sense to reduce it to loglevel WARN? From Gary's description it appears to be harmless when using failover connections.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fredrikj","name":"fredrikj","key":"fredrikj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fredrik Jonson","active":true,"timeZone":"Europe/Stockholm"},"created":"2009-11-19T08:36:28.332+0000","updated":"2009-11-19T08:36:28.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482501/comment/12939149","id":"12939149","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"log message at warn level in 5.4\nr982990","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-06T14:31:48.936+0000","updated":"2010-08-06T14:31:48.936+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2125/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rq2n:"}}