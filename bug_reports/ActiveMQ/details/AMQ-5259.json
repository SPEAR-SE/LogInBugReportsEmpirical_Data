{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12725423","self":"https://issues.apache.org/jira/rest/api/2/issue/12725423","key":"AMQ-5259","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2014-07-09T16:13:29.322+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 09 16:13:29 UTC 2014","customfield_12310420":"403583","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_469988510_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-07-09T16:13:29.290+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5259/watchers","watchCount":2,"isWatching":false},"created":"2014-07-04T05:40:20.833+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-07-09T16:13:29.333+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320200","id":"12320200","name":"activemq-leveldb-store","description":"LevelDB based message store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When using the leveldb persistenceAdapter, I found that the producer will stall for about 10-20s, which I think is quite strange...\nAnd then I open the debug log and see something below:\n\n2014-07-03 10:54:40,961 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:696 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:54:41,452 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:697 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:54:41,944 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:698 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:54:42,433 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:699 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:54:42,914 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:700 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:54:43,314 | DEBUG | Taking a snapshot of the current index: /home/work/local/activemq/apache-activemq-5.10.0/data/leveldb/0000001391db4436.index | org.apache.activemq.leveldb.LevelDBClient | Thread-2\n2014-07-03 10:55:12,253 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:701 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:55:12,742 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:702 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:55:13,235 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:703 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:55:13,724 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:704 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n\n\nAnother piece:\n\n2014-07-03 10:53:42,605 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:637 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:53:43,116 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:638 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:53:43,133 | DEBUG | Taking a snapshot of the current index: /home/work/local/activemq/apache-activemq-5.10.0/data/leveldb/000000138b966b69.index | org.apache.activemq.leveldb.LevelDBClient | Thread-2\n2014-07-03 10:53:43,649 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:639 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n2014-07-03 10:54:11,969 | DEBUG | commit: TX:ID:10.81.200.187-44084-1404353539471-1:1:640 syncCount: 1000 | org.apache.activemq.transaction.LocalTransaction | ActiveMQ NIO Worker 453\n\nIt happened all the time  during my performance test stage, which certainly reduce the throughput greatly...\n\nI think the problem lays on the snapshot thread, but in your description about leveldb is \"Fast index snapshots using hard links\", and I can't find any more description about the levelbd so is that normal?\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"403627","customfield_12312823":null,"summary":"LevelDB spent much time on \"Taking a snapshot of the current index\" and stall producers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djj0809","name":"djj0809","key":"djj0809","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Jinqiang","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djj0809","name":"djj0809","key":"djj0809","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Jinqiang","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"CentOS 6.3","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12725423/comment/14056406","id":"14056406","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Questions should be sent to the mailing list.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-07-09T16:13:29.322+0000","updated":"2014-07-09T16:13:29.322+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5259/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1xgl3:"}}