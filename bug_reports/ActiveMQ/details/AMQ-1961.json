{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482230","self":"https://issues.apache.org/jira/rest/api/2/issue/12482230","key":"AMQ-1961","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-10-01T14:54:58.726+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 01 15:49:39 UTC 2008","customfield_12310420":"75153","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_519279_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2008-10-01T14:54:58.737+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1961/watchers","watchCount":0,"isWatching":false},"created":"2008-10-01T14:46:19.458+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-10-01T15:49:39.229+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I create a vm queue with ten messages. I then create a consumer, dequeue the top message (message #1), and close that consumer. If I then create a second consumer, and try to dequeue the top message (message #2), there is a small chance that this will unexpectedly fail, and the request will time out. This is one problem.\n\nAfter this happens, examining the queue with a queue browser shows message #2 still on the queue. However, subsequent attempts to dequeue this message will always time out. Messages #3-10 will be in the same state; they will still be in the queue, but they cannot be dequeued. This is a worse problem, as it means that we can not reuse this queue.\n\nThe problem arises more frequently as there are more consumers. With two or three consumers, it comes up sporadically. With twenty or more consumers, it happens almost 100% of the time. I've attached a test case which demonstrates the bug consistenty.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461239","id":"12461239","filename":"ASF.LICENSE.NOT.GRANTED--EnqueueDequeueBug.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=piepera","name":"piepera","key":"piepera","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"aaron pieper","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-01T14:46:19.473+0000","size":2824,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461239/ASF.LICENSE.NOT.GRANTED--EnqueueDequeueBug.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"255169","customfield_12312823":null,"summary":"Creating two consumers one after the other causes problems dequeuing messages","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=piepera","name":"piepera","key":"piepera","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"aaron pieper","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=piepera","name":"piepera","key":"piepera","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"aaron pieper","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482230/comment/12940289","id":"12940289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"I don't think this is a bug, just a misunderstanding or misconfiguration of the prefetch size...\n\nhttp://activemq.apache.org/what-is-the-prefetch-limit-for.html\n\nsetting a prefetch size of 1 or zero should fix your issue - or waiting long enough for messages to be redispatched to the closed consumer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-01T14:54:58.726+0000","updated":"2008-10-01T14:54:58.726+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482230/comment/12940287","id":"12940287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=piepera","name":"piepera","key":"piepera","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"aaron pieper","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for your reply. Disabling prefetch for queues fixes the problem. Waiting a few seconds before closing each consumer works also.\n\nSo this works as designed then? If you close one consumer, open a second consumer and retrieve a message, the expected behavior is that the message should occasionally be permanently \"locked\" by the closed consumer?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=piepera","name":"piepera","key":"piepera","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"aaron pieper","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-01T15:49:39.206+0000","updated":"2008-10-01T15:49:39.206+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1961/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1829j:"}}