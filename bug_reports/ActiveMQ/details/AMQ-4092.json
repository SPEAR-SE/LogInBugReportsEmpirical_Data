{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12610178","self":"https://issues.apache.org/jira/rest/api/2/issue/12610178","key":"AMQ-4092","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-10-04T10:23:41.307+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 17 10:19:52 UTC 2013","customfield_12310420":"240208","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_30093003283_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-09-17T10:06:47.543+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4092/watchers","watchCount":5,"isWatching":false},"created":"2012-10-04T02:56:44.300+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-09-17T10:19:52.593+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"seeing these WARN messages frequently while consuming (maxConcurrentConsumers=5) from a queue with the message groups header (JMSXGroupID) set.  If I disable the message groups header, these errors go away...  \n\nThat said, I don't see any specific errors with my application (at this point), just these messages in my logs.\n\n2012-10-04 02:34:02,552 |  WARN - Service              - | Async error occurred: java.util.concurrent.ExecutionException: java.util.ConcurrentModificationException\njava.util.concurrent.ExecutionException: java.util.ConcurrentModificationException\n\tat java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)\n\tat java.util.concurrent.FutureTask.get(FutureTask.java:83)\n\tat org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:785)\n\tat org.apache.activemq.broker.region.Queue.send(Queue.java:707)\n\tat org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:407)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:503)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:305)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:306)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:453)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:681)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:150)\n\tat org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:231)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:680)\nCaused by: java.util.ConcurrentModificationException\n\tat java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)\n\tat java.util.HashMap$KeyIterator.next(HashMap.java:828)\n\tat org.apache.activemq.util.MarshallingSupport.marshalPrimitiveMap(MarshallingSupport.java:64)\n\tat org.apache.activemq.command.Message.beforeMarshall(Message.java:210)\n\tat org.apache.activemq.command.ActiveMQObjectMessage.beforeMarshall(ActiveMQObjectMessage.java:199)\n\tat org.apache.activemq.openwire.v6.MessageMarshaller.looseMarshal(MessageMarshaller.java:277)\n\tat org.apache.activemq.openwire.v6.ActiveMQMessageMarshaller.looseMarshal(ActiveMQMessageMarshaller.java:111)\n\tat org.apache.activemq.openwire.v6.ActiveMQObjectMessageMarshaller.looseMarshal(ActiveMQObjectMessageMarshaller.java:111)\n\tat org.apache.activemq.openwire.OpenWireFormat.marshal(OpenWireFormat.java:168)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.addMessage(KahaDBStore.java:429)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$StoreQueueTask.run(KahaDBStore.java:1177)\n\t... 3 more\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"3518","customfield_12312823":null,"summary":"ConcurrentModificationException when using message groups","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"ActiveMQ 5.6.0 standalone, kahadb persistence, Spring JMSTemplate producer (ObjectMessage), Camel 2.9.2 route consumer (AMQ connection pool, vm transport)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13469275","id":"13469275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"message groups, makes sense, the problem is in\norg.apache.activemq.broker.region.Queue#assignGroup where the JMSXGroupFirstForConsumer property is set, but the message is being stored concurrently.\nA workaround is to disable kahadb concurrentStoreAndDispatchQueues, set to false. This will ensure that the dispatch (which can set the property) and store do not occur in parallel.\n\nNeed to check up on the need to set that property and see if we can do it after the message  is persisted such that it will work with concurrent store and dispatch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-04T10:23:41.307+0000","updated":"2012-10-04T10:23:41.307+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13469457","id":"13469457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"body":"thanks Gary, testing with concurrentStoreAndDispatchQueues=false now...so far so good","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-04T15:29:50.178+0000","updated":"2012-10-04T15:29:50.178+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13469480","id":"13469480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"body":"alright, concurrentStoreAndDispatchQueues=false appears to have resolved the issue...not sure if we should close this given the work around of if there is a code change to better handle this case w/o that setting...I'll leave it open for now...thanks again","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-04T16:24:16.564+0000","updated":"2012-10-04T16:24:16.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13506849","id":"13506849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"body":"After doing some burnin/performance testing with concurrentStoreAndDispatchQueues=\"false\"...this setting if proving problematic and is causing unacceptable throttling of our application.  Is this issue addressed in a 5.7.0?  if not, any plan to address it?  thanks...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-29T21:49:16.277+0000","updated":"2012-11-29T21:49:16.277+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13572630","id":"13572630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"line this up for the next release","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-06T18:15:36.171+0000","updated":"2013-02-06T18:15:36.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13629918","id":"13629918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=can_do","name":"can_do","key":"can_do","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"can_do","active":true,"timeZone":"Etc/UTC"},"body":"I have the same error in AMQ 5.7.0.\nThe detail log is as the following:\n////////////////begin////////////\njavax.jms.JMSException: java.util.ConcurrentModificationException\n        at com.rf.emq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:49)\n        at com.rf.emq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1377)\n        at com.rf.emq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1305)\n        at com.rf.emq.ActiveMQSession.send(ActiveMQSession.java:2060)\n        at com.rf.emq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:277)\n        at com.rf.emq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:212)\n        at com.rf.emq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:241)\n        at com.rf.emq.product.message.ByteMessageSender.produceMessageInFragmentWithReturnValue(ByteMessageSender.java:166)\n        at com.rf.emq.product.web.AutoSplitLargeFileAndSendTimerTask.splitLargeFile(AutoSplitLargeFileAndSendTimerTask.java:693)\n        at com.rf.emq.product.web.AutoSplitLargeFileAndSendTimerTask$SplitLargFileSubTask.run(AutoSplitLargeFileAndSendTimerTask.j\nava:879)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:722)\nCaused by: java.util.concurrent.ExecutionException: java.util.ConcurrentModificationException\n        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:252)\n        at java.util.concurrent.FutureTask.get(FutureTask.java:111)\n        at com.rf.emq.broker.region.Queue.doMessageSend(Queue.java:795)\n        at com.rf.emq.broker.region.Queue.send(Queue.java:717)\n        at com.rf.emq.broker.region.AbstractRegion.send(AbstractRegion.java:407)\n        at com.rf.emq.broker.region.RegionBroker.send(RegionBroker.java:503)\n        at com.rf.emq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:311)\n        at com.rf.emq.broker.BrokerFilter.send(BrokerFilter.java:129)\n        at com.rf.emq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n        at com.rf.emq.broker.TransactionBroker.send(TransactionBroker.java:317)\n        at com.rf.emq.broker.BrokerFilter.send(BrokerFilter.java:129)\n        at com.rf.emq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)\n        at com.rf.emq.broker.TransportConnection.processMessage(TransportConnection.java:450)\n        at com.rf.emq.command.ActiveMQMessage.visit(ActiveMQMessage.java:680)\n        at com.rf.emq.broker.TransportConnection.service(TransportConnection.java:294)\n        at com.rf.emq.broker.TransportConnection$1.onCommand(TransportConnection.java:152)\n        at com.rf.emq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n        at com.rf.emq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n        at com.rf.emq.transport.vm.VMTransport.iterate(VMTransport.java:241)\n        at com.rf.emq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:129)\n        at com.rf.emq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:47)\n        ... 3 more\nCaused by: java.util.ConcurrentModificationException\n        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:806)\n        at java.util.HashMap$KeyIterator.next(HashMap.java:841)\n        at com.rf.emq.util.MarshallingSupport.marshalPrimitiveMap(MarshallingSupport.java:64)\n        at com.rf.emq.command.Message.beforeMarshall(Message.java:215)\n        at com.rf.emq.openwire.v6.MessageMarshaller.looseMarshal(MessageMarshaller.java:277)\n        at com.rf.emq.openwire.v6.ActiveMQMessageMarshaller.looseMarshal(ActiveMQMessageMarshaller.java:111)\n        at com.rf.emq.openwire.v6.ActiveMQBytesMessageMarshaller.looseMarshal(ActiveMQBytesMessageMarshaller.java:111)\n        at com.rf.emq.openwire.OpenWireFormat.marshal(OpenWireFormat.java:168)\n        at com.rf.emq.store.kahadb.KahaDBStore$KahaDBMessageStore.addMessage(KahaDBStore.java:431)\n        at com.rf.emq.store.kahadb.KahaDBStore$StoreQueueTask.run(KahaDBStore.java:1192)\n        ... 3 more\n////////////////end///////////////","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=can_do","name":"can_do","key":"can_do","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"can_do","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-12T08:21:15.129+0000","updated":"2013-04-12T08:21:15.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13629921","id":"13629921","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=can_do","name":"can_do","key":"can_do","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"can_do","active":true,"timeZone":"Etc/UTC"},"body":"I have set the message property such as msg.setGroupID(\"GROUPBEGIN_\" + encodedName + \"_GROUPEND_\"\n\t\t\t\t+ file.length()) and msg.setGroupSequence(++i);\nFrom message property,I see the value of JMSXGroupFirstForConsumer is true.\n\nWhether this extensive property JMSXGroupFirstForConsumer can be set to false and problem can be eliminated or not.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=can_do","name":"can_do","key":"can_do","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"can_do","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-12T08:26:40.736+0000","updated":"2013-04-12T08:47:13.335+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13660857","id":"13660857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"body":"when this ConcurrentModificationException event occurs...does an exception get thrown back to the producer or consumer of this message or is the issue just with setting the JMSXGroupFirstForConsumer property?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=boday","name":"boday","key":"boday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=boday&avatarId=17138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=boday&avatarId=17138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=boday&avatarId=17138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=boday&avatarId=17138"},"displayName":"Ben O'Day","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-17T16:59:51.853+0000","updated":"2013-05-17T16:59:51.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13727342","id":"13727342","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=the_amol","name":"the_amol","key":"the_amol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amol Verma","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\ni am not an expert using Activemq..but i am facing the same issue. Gary Tully can you please suggest where to add, i.e. under which section, the fix code i.e. \"concurrentStoreAndDispatchQueues=false\" in activemq.xml? or please provide sample activemq.xml file with this workaround.\n\nThanks,\namol","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=the_amol","name":"the_amol","key":"the_amol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amol Verma","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-02T05:16:54.262+0000","updated":"2013-08-02T05:18:03.968+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13727530","id":"13727530","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@Amol google is always your friend. It is an option on kahadb - http://activemq.apache.org/kahadb.html\n\nso {code}<broker brokerName=\"broker\" ... >\n   <persistenceAdapter>\n     <kahaDB ... concurrentStoreAndDispatchQueues =\"false\"/>\n   </persistenceAdapter>\n   ...\n </broker>{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-02T10:08:51.886+0000","updated":"2013-08-02T10:08:51.886+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13727557","id":"13727557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=the_amol","name":"the_amol","key":"the_amol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amol Verma","active":true,"timeZone":"Etc/UTC"},"body":"Gary, thanks for replying. I used the settings..but still i am getting the\nsame exception and failure for same file but at random occasions i.e. the\nsame file is working fine most of time and some time it is failing. I am\nusing latest release of activemq i.e.5.8.0\n\nPlease suggest.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=the_amol","name":"the_amol","key":"the_amol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amol Verma","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-02T10:47:47.111+0000","updated":"2013-08-02T10:47:47.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13768717","id":"13768717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@Amol - are you using composite destinations in your producers?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-16T20:29:25.804+0000","updated":"2013-09-16T20:29:25.804+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13769387","id":"13769387","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"fix in http://git-wip-us.apache.org/repos/asf/activemq/commit/dd91e859\n\nJMSXGroupFirstForConsumer property is now backed by a message attribute which avoids contention. requires v10 wireformat","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-17T10:06:47.579+0000","updated":"2013-09-17T10:06:47.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12610178/comment/13769398","id":"13769398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=the_amol","name":"the_amol","key":"the_amol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amol Verma","active":true,"timeZone":"Etc/UTC"},"body":"thanks Gary..i will give it a try.\n\n\n\n\n\n\n-- \nThanks & Regards\nAmol Verma\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=the_amol","name":"the_amol","key":"the_amol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amol Verma","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-17T10:19:52.504+0000","updated":"2013-09-17T10:19:52.504+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4092/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i00yhb:"}}