{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12695543","self":"https://issues.apache.org/jira/rest/api/2/issue/12695543","key":"AMQ-5057","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2014-02-17 16:11:06.819","customfield_12310420":"374051","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5057/watchers","watchCount":2,"isWatching":false},"created":"2014-02-17T16:11:06.819+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-02-17T16:11:06.819+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When using the jdbcPersistenceAdapter and an exception is thrown in the store, then no further messages can be consumed until the broker is restarted.\n\nI our case we were trying to store a message that was larger than what max_allowed_packet was set to in mysql (though I would assume other types of exceptions might cause the same issue).  Valid messages sent after the exception occurred were stored in the database, but did not show up in the UI and could not be consumed.  After a restart of the broker, the messages showed up in the UI and were able to be consumed.\n\n        <persistenceAdapter>\n          <jdbcPersistenceAdapter dataDirectory=\"${activemq.base}/activemq-data\" dataSource=\"#mysql-ds\"/>\n        </persistenceAdapter>\n\n    <bean id=\"mysql-ds\" class=\"org.apache.commons.dbcp.BasicDataSource\" destroy-method=\"close\">\n                <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\"/>\n                <property name=\"url\" value=\"jdbc:mysql://db3/activemq59?relaxAutoCommit=true&amp;autoReconnect=true\"/>\n                <property name=\"username\" value=\"activemq\"/>\n                <property name=\"password\" value=\"xxxxx\"/>\n                <property name=\"maxActive\" value=\"400\"/>\n                <property name=\"maxIdle\" value=\"10\"/>\n                <property name=\"minIdle\" value=\"5\"/>\n                <property name=\"testOnBorrow\" value=\"true\"/>\n                <property name=\"validationQuery\" value=\"select 1\"/>\n                <property name=\"poolPreparedStatements\" value=\"true\"/>\n                <property name=\"maxOpenPreparedStatements\" value=\"50\"/>\n        </bean>\n\n\n2014-02-14 13:29:28,978 | WARN  | Commit failed: Packet for query is too large (105132838 > 25165824). You can change this value on the server by setting the max_allowed_packet' variable. | org.apache.activemq.store.jdbc.JDBCPersistenceAdapter | ActiveMQ Transport: tcp:///192.168.101.223:60777@61616\njava.sql.BatchUpdateException: Packet for query is too large (105132838 > 25165824). You can change this value on the server by setting the max_allowed_packet' variable.\n        at com.mysql.jdbc.PreparedStatement.executeBatchSerially(PreparedStatement.java:2024)\n        at com.mysql.jdbc.PreparedStatement.executeBatch(PreparedStatement.java:1449)\n        at org.apache.commons.dbcp.DelegatingStatement.executeBatch(DelegatingStatement.java:297)\n        at org.apache.commons.dbcp.DelegatingStatement.executeBatch(DelegatingStatement.java:297)\n        at org.apache.commons.dbcp.DelegatingStatement.executeBatch(DelegatingStatement.java:297)\n        at org.apache.activemq.store.jdbc.TransactionContext.executeBatch(TransactionContext.java:106)\n        at org.apache.activemq.store.jdbc.TransactionContext.executeBatch(TransactionContext.java:84)\n        at org.apache.activemq.store.jdbc.TransactionContext.commit(TransactionContext.java:171)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.commitTransaction(JDBCPersistenceAdapter.java:516)\n        at org.apache.activemq.store.memory.MemoryTransactionStore$Tx.commit(MemoryTransactionStore.java:110)\n        at org.apache.activemq.store.memory.MemoryTransactionStore.commit(MemoryTransactionStore.java:259)\n        at org.apache.activemq.transaction.LocalTransaction.commit(LocalTransaction.java:70)\n        at org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:253)\n        at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:112)\n        at org.apache.activemq.broker.TransportConnection.processCommitTransactionOnePhase(TransportConnection.java:424)\n        at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:100)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:149)\n        at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n        at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n        at java.lang.Thread.run(Thread.java:724)\nCaused by: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (105132838 > 25165824). You can change this value on the server by setting the max_allowed_packet' variable.\n        at com.mysql.jdbc.MysqlIO.send(MysqlIO.java:3279)\n        at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1971)\n        at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2151)\n        at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2625)\n        at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:2119)\n        at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:2415)\n        at com.mysql.jdbc.PreparedStatement.executeBatchSerially(PreparedStatement.java:1976)\n        ... 24 more\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"374351","customfield_12312823":null,"summary":"JDBC datastore unable to process messages after exception","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kroekle","name":"kroekle","key":"kroekle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kurt Roekle","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kroekle","name":"kroekle","key":"kroekle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kurt Roekle","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"RHEL, MySql 5.5, mysql connector 5.1.17","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5057/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1sgjz:"}}