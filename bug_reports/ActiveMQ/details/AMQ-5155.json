{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12709955","self":"https://issues.apache.org/jira/rest/api/2/issue/12709955","key":"AMQ-5155","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329258","id":"12329258","name":"5.12.0","archived":false,"released":true,"releaseDate":"2015-08-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-06-11T00:53:36.002+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon May 11 23:37:47 UTC 2015","customfield_12310420":"388277","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_29597162844_*|*_5_*:*_2_*:*_2413820936_*|*_4_*:*_1_*:*_10742096","customfield_12312321":null,"resolutiondate":"2015-04-28T22:11:45.823+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5155/watchers","watchCount":22,"isWatching":false},"created":"2014-04-23T07:16:20.043+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326455","id":"12326455","name":"5.9.1","archived":false,"released":true,"releaseDate":"2014-04-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[{"id":"12412440","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12412440","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"outwardIssue":{"id":"12670485","key":"AMQ-4740","self":"https://issues.apache.org/jira/rest/api/2/issue/12670485","fields":{"summary":"heart-beat is disabled when connecting to web socket","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12388860","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12388860","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12670485","key":"AMQ-4740","self":"https://issues.apache.org/jira/rest/api/2/issue/12670485","fields":{"summary":"heart-beat is disabled when connecting to web socket","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-11T23:37:47.401+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"From AMQ-4740:\nI receive the following error after establishing a connection and heartbeat through stomp.js. This seems to occur after the 'PING' is sent.\n---------- stomp.js output\n<<< CONNECTED\nheart-beat:10000,10000\nsession:ID:localhost.localdomain-45596-1396530920609-2:2\nserver:ActiveMQ/5.10-SNAPSHOT\nversion:1.1\nsend PING every 10000ms \ncheck PONG every 10000ms \n<<< PONG \n>>> PING \ndid not receive server activity for the last 20005ms \nWhoops! Lost connection to ws://172.16.99.73:61614/stomp\n--------------------- activemq console ---------------\nWARN | Transport Connection to: StompSocket_19548821 failed: java.io.IOException\nException in thread \"ActiveMQ InactivityMonitor Worker\" java.lang.NullPointerException\nat org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)\nat org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\nat java.lang.Thread.run(Thread.java:722)\nWARN | Transport Connection to: StompSocket_19548821 failed: java.io.IOException\nException in thread \"ActiveMQ InactivityMonitor Worker\" java.lang.NullPointerException\nat org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)\nat org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\nat java.lang.Thread.run(Thread.java:722)\n\nFor me it looks as if the StompInactivityMonitor is delivering its events to the wrong Transport, i.e. it needs a \"narrow()\" when setting it up.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12703417","id":"12703417","filename":"AMQ-5155-jetty8.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebsjo","name":"sebsjo","key":"sebsjo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian Sjödin","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-09T12:34:21.754+0000","size":1765,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12703417/AMQ-5155-jetty8.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12703418","id":"12703418","filename":"AMQ-5155-jetty9.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebsjo","name":"sebsjo","key":"sebsjo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian Sjödin","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-09T12:34:21.760+0000","size":1750,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12703418/AMQ-5155-jetty9.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12726334","id":"12726334","filename":"firefox_bug_example1.pcapng","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-18T02:58:43.155+0000","size":13008,"mimeType":"application/x-pcapng","content":"https://issues.apache.org/jira/secure/attachment/12726334/firefox_bug_example1.pcapng"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12726768","id":"12726768","filename":"patchfile.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-21T03:33:39.540+0000","size":4422,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12726768/patchfile.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"388532","customfield_12312823":null,"summary":"Heartbeat fails in STOMP over WebSockets","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bergamot","name":"bergamot","key":"bergamot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjan van den Berg","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bergamot","name":"bergamot","key":"bergamot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjan van den Berg","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14027280","id":"14027280","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"Someone please help resolve this ticket. The bug described above is still present in 5.9.1. I tried both cases, heartbeat set to 0,0 and 10000,10000. Slightly different buggy behaviors, but it still does not work. Please:\n1) download 5.9.1\n2) bin/activemq console xbean:examples/conf/activemq-demo.xml\n3) open two browsers (firefox/chrome) to http://localhost:8161/demo/websocket/index.html\n4) type a few messages over a 5 minute period\n\nWARN | Transport Connection to: StompSocket_1998606381 failed: java.io.IOException\nWARN | Transport Connection to: StompSocket_178709817 failed: java.io.IOException\nException in thread \"ActiveMQ InactivityMonitor Worker\" java.lang.NullPointerException\nat org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)\nat org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\nat java.lang.Thread.run(Thread.java:745)\nException in thread \"ActiveMQ InactivityMonitor Worker\" java.lang.NullPointerException\nat org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)\nat org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\nat java.lang.Thread.run(Thread.java:745)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-11T00:53:36.002+0000","updated":"2014-06-11T00:53:36.002+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14027304","id":"14027304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Why not try and create a unit test and submit a patch that fixes it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-06-11T01:19:00.462+0000","updated":"2014-06-11T01:19:00.462+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14262395","id":"14262395","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcharl","name":"tcharl","key":"tcharl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Charlie Mordant","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\nCan we pull up the Priority, as it is a real blocker for websocket users? I really hope that it will be corrected in 5.10.1: our enterprise stack is stuck with 5.8 because of it.\n@Timothy, I'm sorry, I tried but the AMQ internals are not so easy to understand, I'm sure that it'll not be so difficult for an expert like you, but it's really red hairing for noobs like me...\n\nRegards,","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcharl","name":"tcharl","key":"tcharl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Charlie Mordant","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-31T19:56:09.279+0000","updated":"2014-12-31T19:56:09.279+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14264112","id":"14264112","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaiyun","name":"zhaiyun","key":"zhaiyun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ZhaiYun","active":true,"timeZone":"Etc/UTC"},"body":"Can we pull up the Priority\n-> we all think so.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaiyun","name":"zhaiyun","key":"zhaiyun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ZhaiYun","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-05T00:31:21.044+0000","updated":"2015-01-05T00:31:21.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14348653","id":"14348653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gigaclood","name":"gigaclood","key":"gigaclood","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Parodi","active":true,"timeZone":"Etc/UTC"},"body":"Hi, \nI have created a patch for activemq 5.9.1 version that seems to work.\n\nThese are my changes for org.apache.activemq.transport.ws.StompSocket:\n\n1. in doStart() I set transportListener to remove NPE:\n{code}\n@Override\n    protected void doStart() throws Exception {\n        socketTransportStarted.countDown();\n\t\tstompInactivityMonitor.setTransportListener(this.getTransportListener());\n    }\n{code}\n\n2. in onMessage(String data) I managed keepalive frame:\n{code}\nif (!transportStartedAtLeastOnce()) {\n            LOG.debug(\"Waiting for StompSocket to be properly started...\");\n            try {\n                socketTransportStarted.await();\n            } catch (InterruptedException e) {\n                LOG.warn(\"While waiting for StompSocket to be properly started, we got interrupted!! Should be okay, but you could see race conditions...\");\n            }\n        }\n        try {\n\t      if (data!=null && data.equals(\"\\n\"))\n\t\t{\n\t\t    sendToActiveMQ(new KeepAliveInfo());\n\t\t}\n\t      else {\n\t\t   protocolConverter.onStompCommand((StompFrame)wireFormat.unmarshal(new ByteSequence(data.getBytes(\"UTF-8\"))));\n\t\t}\n        } catch (Exception e) {\n            onException(IOExceptionSupport.create(e));\n        }\n{code}\n\nCan I share with you my code in a better way?\nThanks\nClaudio Parodi","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gigaclood","name":"gigaclood","key":"gigaclood","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Parodi","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-05T11:49:11.739+0000","updated":"2015-03-05T11:49:11.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14352888","id":"14352888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebsjo","name":"sebsjo","key":"sebsjo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian Sjödin","active":true,"timeZone":"Etc/UTC"},"body":"Hi Claudio,\n\nI tried your code with ActiveMQ 5.11.1 and it seems to work fine now, at least with the stomp.js example chat test.\nMade some diffs for the 5.11.1 version that I'll attach to this ticket.\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebsjo","name":"sebsjo","key":"sebsjo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian Sjödin","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-09T12:34:10.550+0000","updated":"2015-03-09T12:34:10.550+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14379347","id":"14379347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amonaco","name":"amonaco","key":"amonaco","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ariel Monaco","active":true,"timeZone":"Etc/UTC"},"body":"I've tried every version >= 5.9.1 to 5.12-SNAPSHOT and I can reproduce the reported issue. I guess for now some people will have to stick to 5.8 for production. This is a bug that affects everyone using Websockets and it's been open for almost a year :|","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amonaco","name":"amonaco","key":"amonaco","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ariel Monaco","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-25T05:53:53.149+0000","updated":"2015-03-25T05:54:16.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14389365","id":"14389365","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Applied a slightly tweaked version of the patch, thanks for looking into it.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-03-31T20:42:22.832+0000","updated":"2015-03-31T20:42:22.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14392271","id":"14392271","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Peter.Pfort","name":"Peter.Pfort","key":"peter.pfort","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Pfort","active":true,"timeZone":"Etc/UTC"},"body":"Hi Timothy,\nyour change in version 5.12 isn't complete. You forget the \"else\" before the \"onStompCommand ...\", like in the snippet from Claudio.\n\nThe \"(StompFrame)wireFormat.unmarshal\" throw an EOFException, because the KeepAlive command isn't handled in it. Then the session is marked as failed.\n\nPlease complete the code.\n\nPeter","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Peter.Pfort","name":"Peter.Pfort","key":"peter.pfort","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Pfort","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-02T07:13:03.982+0000","updated":"2015-04-02T07:13:03.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14392674","id":"14392674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Added a fix, let me know if it works for you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-04-02T13:11:07.795+0000","updated":"2015-04-02T13:11:07.795+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14482775","id":"14482775","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Peter.Pfort","name":"Peter.Pfort","key":"peter.pfort","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Pfort","active":true,"timeZone":"Etc/UTC"},"body":"It's works now.\n\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Peter.Pfort","name":"Peter.Pfort","key":"peter.pfort","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Pfort","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-07T08:04:21.725+0000","updated":"2015-04-07T08:04:21.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14487669","id":"14487669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"Even though the above bug was fixed, a related bug now occurs. This may deserve a new ticket? Can someone confirm the following:\n1) Download a recent 5.12 SNOPSHOT that works and contains the patch above. I used https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.12-SNAPSHOT/apache-activemq-5.12-20150407.222248-96-bin.tar.gz\n2) bin/activemq console xbean:examples/conf/activemq-demo.xml\n3) open two browsers (firefox/chrome) to http://localhost:8161/demo/websocket/index.html\n4) In a single browser window, type 1, 2, 3, ... 9 with a return/enter after each number \n5) Half of the chat ends up in one browser, and half in the other. \n\nThis bug causes the receiving browser to only get 1/2 the chats. Could this bug relate to the new added code that uses \"/n\"?\n\nCan someone confirm this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-09T17:05:32.297+0000","updated":"2015-04-09T17:05:32.297+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14487682","id":"14487682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"This is not a bug, the default address  string in that example is: /queue/test which means that the messages are load balanced across connections, try it with /topic/test and it should work as expected. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-04-09T17:14:03.931+0000","updated":"2015-04-09T17:14:03.931+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14487704","id":"14487704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"You are correct, using /topic/test works as expected. I performed various tests and no issues to report.\nThank you very much for solving this bug. This is the one feature I needed in order to use ActiveMQ. I appreciate everyone's contribution in resolving this problem and look forward to the release of 5.12. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-09T17:28:26.355+0000","updated":"2015-04-09T17:28:26.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14487732","id":"14487732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Keep testing it and report back if you find any other gremlins.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-04-09T17:40:09.595+0000","updated":"2015-04-09T17:40:09.595+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14501051","id":"14501051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"REVISION\nCan someone confirm this bug occurs in their environment? If so, this bug relates to AMQ-5155 and AMQ-4674. I recommend that the ActiveMQ WebSocket example should work as is, regardless of using parameters like transport.hbGracePeriodMultiplier. Using Fedora/Firefox would cause the bug 50% of the times after 50-500 PINGs, but NO bug to report in Fedora/Chrome because of timing conditions.\n\nThe bug manifests itself in \"/activemq-client/src/main/java/org/apache/activemq/transport/AbstractInactivityMonitor.java\" when the timing of onCommand() (generated by the web browser PING or message) crosses over the timing of readCheck(). In other words, the 10 second timing of onCommand() via web browser's PING occurs before  the 10 second thread timing of readCheck(), but with a small time drift, the timing of readCheck() starts to occur before onCommand(). At this exact cross over point,  readCheck() will occur twice, and this will cause the bug. In the log below, the timing sequence is:\n17:05:21,162 | DEBUG | onCommand()\n17:05:21,162 | DEBUG | readCheck()\n17:05:31,162 | DEBUG | readCheck()\n17:05:31,164 | DEBUG | onCommand()\n\nOpening Web Socket...\nWeb Socket Opened...\n>>> CONNECT\naccept-version:1.1,1.0\nheart-beat:10000,10000\nlogin:guesttgg\npasscode:guest\n\n<<< CONNECTED\nserver:ActiveMQ/5.12-SNAPSHOT\nheart-beat:10000,10000\nsession:ID:c1-39862-1429234022608-4:2\nversion:1.1\n\nconnected to server ActiveMQ/5.12-SNAPSHOT\nsend PING every 10000ms\ncheck PONG every 10000ms\nconnected to Stomp\n>>> SUBSCRIBE\nid:sub-0\ndestination:/queue/test (same behavor for /topic/test)\n\n<<< PONG\n>>> PING\n... 395 times this case, but 50-500 times in general\n<<< PONG\n>>> PING\n<<< PONG\n>>> PING\n>>> PING\n>>> PING\ndid not receive server activity for the last 20003ms\nWhoops! Lost connection to ws://localhost:61614/stomp\n\n\nINFO version of data/activemq.log\n2015-04-17 15:49:12,750 | WARN  | Transport Connection to: StompSocket_919027643 failed: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (>10000) long: StompSocket_919027643 | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ InactivityMonitor Worker\n\nDEBUG with special coding version of data/activemq.log\n2015-04-19 17:05:21,162 | DEBUG | onCommand() | org.apache.activemq.transport.AbstractInactivityMonitor | qtp1493158871-33\n2015-04-19 17:05:21,162 | DEBUG | 10000ms elapsed since last read check. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer\n2015-04-19 17:05:21,162 | DEBUG | readCheck() | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer\n2015-04-19 17:05:31,161 | DEBUG | WriteChecker: 10000ms elapsed since last write check. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor WriteCheckTimer\n2015-04-19 17:05:31,161 | DEBUG | Running WriteCheck[StompSocket_1693369093] | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor Worker\n2015-04-19 17:05:31,162 | DEBUG | 10000ms elapsed since last read check. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer\n2015-04-19 17:05:31,162 | DEBUG | readCheck() | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer\n2015-04-19 17:05:31,163 | DEBUG | No message received since last read check for org.apache.activemq.transport.ws.jetty8.StompSocket@64eec305. Throwing InactivityIOException. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer\n2015-04-19 17:05:31,164 | DEBUG | Running ReadCheck[StompSocket_1693369093] | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor Worker\n2015-04-19 17:05:31,164 | DEBUG | onCommand() | org.apache.activemq.transport.AbstractInactivityMonitor | qtp1493158871-30","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-18T03:01:00.824+0000","updated":"2015-04-20T02:46:15.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14504231","id":"14504231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"/activemq-client/src/main/java/org/apache/activemq/transport/AbstractInactivityMonitor.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-21T03:33:39.556+0000","updated":"2015-04-21T03:33:39.556+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14504267","id":"14504267","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"Hi Timothy,\nThe included patch will give the read check thread a 2nd chance (via 1 second) before exception and termination. It also designs the read check thread and write check thread to be nearly identical. I will implement other approaches should this one NOT be satisfactory. The attached patchfile.txt is for “/activemq-client/src/main/java/org/apache/activemq/transport/AbstractInactivityMonitor.java”.\n\nI believe there is a fundamental design problem with AMQ heartbeats, because the timing of web browsers heartbeats has a cadence equal to the timing for AMQ to check heartbeats. Eventually, due to very small changes in time, the web browser heartbeat can eventually cross over AMQ checks for heartbeats. In the included example, the web browser client is sending at the rate of 10 seconds, and AMQ server is also checking at the rate of 10 seconds. Longer term testing, with a variety of websocket enabled browsers, show that the heartbeats can cross over. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-21T03:56:05.481+0000","updated":"2015-04-21T03:56:05.481+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14506059","id":"14506059","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"Please retest 5.12-SNAPSHOT in your environment using Firefox. I want to confirm that the problem still persists in other environments under more extensive testing. Patch included above (patchfile.txt) has not failed in 5.12-SNAPSHOT for 32+ hours of testing. The websocket chat example using the current SNAPHOT will fail for me in Fedora 21/Firefox.\n\n1) download the latest 5.12-SNAPSHOT at https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.12-SNAPSHOT/\n2) bin/activemq start xbean:examples/conf/activemq-demo.xml\n3) open three instances of Firefox (because it has greater time variation) to http://localhost:8161/demo/websocket/index.html and view for 20 minutes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-21T23:59:33.331+0000","updated":"2015-04-22T00:05:42.194+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14517699","id":"14517699","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Will look into reported disconnects when heartbeats are flowing.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-04-28T19:12:43.710+0000","updated":"2015-04-28T19:12:43.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14518103","id":"14518103","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The main problem here is that the StompSocket is not providing a valid received counter value for the inactivity monitor to track continuing read progress, and a few other nits that needs fixing.  I also looks like there might be a memory leak in play also but I'm still investigating that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-04-28T21:25:50.503+0000","updated":"2015-04-28T21:25:50.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14518204","id":"14518204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Added fix that ensures the inactivity monitor can properly determine heartbeat and normal STOMP traffic when performing read checks. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-04-28T22:11:45.891+0000","updated":"2015-04-28T22:11:45.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14519926","id":"14519926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"Timothy, I will test out your patch on May 9-11 and report back. Thank you very much for your contribution.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-29T18:47:33.261+0000","updated":"2015-04-29T18:47:33.261+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14535378","id":"14535378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.hinshaw","name":"chris.hinshaw","key":"chris.hinshaw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Hinshaw","active":true,"timeZone":"Etc/UTC"},"body":"Verified that the issue appears to be resolved with the 5.12 snapshot from May 8th. Thanks you very very much.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.hinshaw","name":"chris.hinshaw","key":"chris.hinshaw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Hinshaw","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-08T19:52:53.706+0000","updated":"2015-05-08T19:58:08.251+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14535383","id":"14535383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Peter.Pfort","name":"Peter.Pfort","key":"peter.pfort","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Pfort","active":true,"timeZone":"Etc/UTC"},"body":"Guten Tag, vielen Dank für Ihre Nachricht! Ich bin vom 01.05.2015 bis zum 25.05.2015 nicht im Büro. Ihre Emails werden in dieser Zeit weder gelesen noch weitergeleitet. In dringenden Fällen wenden Sie sich bitte an den alfa Support (+49 (0) 6074 / 3104 - 333). Nach meiner Rückkehr werde ich Ihre Nachricht umgehend beantworten. Mit freundlichen Grüßen Best regards Peter Pfort\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Peter.Pfort","name":"Peter.Pfort","key":"peter.pfort","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Pfort","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-08T19:53:40.894+0000","updated":"2015-05-08T19:53:40.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14538857","id":"14538857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"body":"Timothy, I performed various tests and no issues to report. 30+ hours of testing with 6 concurrent web browser connections  using Firefox/Chrome.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chadkelly","name":"chadkelly","key":"chadkelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chad Kelly","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-11T23:21:00.394+0000","updated":"2015-05-11T23:21:00.394+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12709955/comment/14538885","id":"14538885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Great, thanks for reporting back.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-05-11T23:37:47.401+0000","updated":"2015-05-11T23:37:47.401+0000"}],"maxResults":27,"total":27,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5155/votes","votes":12,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1uvv3:"}}