{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12660583","self":"https://issues.apache.org/jira/rest/api/2/issue/12660583","key":"AMQ-4660","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2013-07-30T10:20:23.679+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 15 21:34:37 UTC 2013","customfield_12310420":"340773","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1432892202_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-08-15T21:34:37.064+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4660/watchers","watchCount":2,"isWatching":false},"created":"2013-07-30T07:33:04.919+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-08-15T21:34:37.106+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have multiple queues (about 20), most of them are empty. One queue has 60 messages. When click on the queue in the web console to view the messages, I get an error displayed after a few minutes:\n\n{quote}\nError!\nException occurred while processing this request, check the log for more information!\n{quote}\n\nWhen I check the log, I get this huge stacktrace:\n{quote}\n2013-07-30 08:44:26,380 | WARN  | /admin/browse.jsp | org.eclipse.jetty.servlet.ServletHandler | qtp10279131-55\njavax.servlet.jsp.JspException: java.lang.OutOfMemoryError: Java heap space\n        at org.apache.jsp.tag.web.jms.persistent_tag.doTag(org.apache.jsp.tag.web.jms.persistent_tag:80)\n        at org.apache.jsp.browse_jsp._jspx_meth_jms_persistent_0(org.apache.jsp.browse_jsp:222)\n        at org.apache.jsp.browse_jsp.access$2(org.apache.jsp.browse_jsp:210)\n        at org.apache.jsp.browse_jsp$browse_jspHelper.invoke0(org.apache.jsp.browse_jsp:401)\n        at org.apache.jsp.browse_jsp$browse_jspHelper.invoke(org.apache.jsp.browse_jsp:450)\n        at org.apache.jsp.tag.web.jms.forEachMessage_tag.doTag(org.apache.jsp.tag.web.jms.forEachMessage_tag:89)\n        at org.apache.jsp.browse_jsp._jspx_meth_jms_forEachMessage_0(org.apache.jsp.browse_jsp:170)\n        at org.apache.jsp.browse_jsp._jspService(org.apache.jsp.browse_jsp:100)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:109)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:806)\n        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:389)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:486)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:380)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:806)\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:652)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1329)\n        at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:83)\n        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1300)\n        at org.apache.activemq.web.SessionFilter.doFilter(SessionFilter.java:45)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1300)\n        at org.apache.activemq.web.filter.ApplicationContextFilter.doFilter(ApplicationContextFilter.java:102)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1300)\n        at com.opensymphony.sitemesh.webapp.SiteMeshFilter.obtainContent(SiteMeshFilter.java:129)\n        at com.opensymphony.sitemesh.webapp.SiteMeshFilter.doFilter(SiteMeshFilter.java:77)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1300)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:445)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:534)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:227)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1038)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:374)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:189)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:972)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:534)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n        at org.eclipse.jetty.server.Server.handle(Server.java:363)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:483)\n        at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:920)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:982)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:635)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n        at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:627)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:51)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n        at java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.OutOfMemoryError: Java heap space\n        at java.util.Arrays.copyOf(Arrays.java:2882)\n        at java.io.CharArrayWriter.write(CharArrayWriter.java:88)\n        at java.io.PrintWriter.write(PrintWriter.java:382)\n        at com.opensymphony.module.sitemesh.filter.RoutablePrintWriter.write(RoutablePrintWriter.java:144)\n        at org.apache.jasper.runtime.JspWriterImpl.flushBuffer(JspWriterImpl.java:181)\n        at org.apache.jasper.runtime.JspWriterImpl.write(JspWriterImpl.java:449)\n        at org.apache.jasper.runtime.JspWriterImpl.write(JspWriterImpl.java:462)\n        at org.apache.jasper.runtime.JspWriterImpl.print(JspWriterImpl.java:587)\n        at org.apache.jasper.runtime.JspWriterImpl.println(JspWriterImpl.java:695)\n        at org.apache.jsp.tag.web.jms.persistent_tag.doTag(org.apache.jsp.tag.web.jms.persistent_tag:63)\n        at org.apache.jsp.browse_jsp._jspx_meth_jms_persistent_0(org.apache.jsp.browse_jsp:222)\n        at org.apache.jsp.browse_jsp.access$2(org.apache.jsp.browse_jsp:210)\n        at org.apache.jsp.browse_jsp$browse_jspHelper.invoke0(org.apache.jsp.browse_jsp:401)\n        at org.apache.jsp.browse_jsp$browse_jspHelper.invoke(org.apache.jsp.browse_jsp:450)\n        at org.apache.jsp.tag.web.jms.forEachMessage_tag.doTag(org.apache.jsp.tag.web.jms.forEachMessage_tag:89)\n        at org.apache.jsp.browse_jsp._jspx_meth_jms_forEachMessage_0(org.apache.jsp.browse_jsp:170)\n        at org.apache.jsp.browse_jsp._jspService(org.apache.jsp.browse_jsp:100)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:109)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:806)\n        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:389)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:486)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:380)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:806)\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:652)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1329)\n        at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:83)\n        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1300)\n        at org.apache.activemq.web.SessionFilter.doFilter(SessionFilter.java:45)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1300)\n        at org.apache.activemq.web.filter.ApplicationContextFilter.doFilter(ApplicationContextFilter.java:102)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1300)\n{quote}\n\nI ran AMQ with {{-Xms1024m -Xmx1024m}} settings an there is no system-based memory shortage, afaik. So I'm wondering why its not possible to 60 messages? Once I purge the queue, I am able to view it again.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"341091","customfield_12312823":null,"summary":"OutOfMemoryError in Web Console","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ebeb","name":"ebeb","key":"ebeb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Wedel","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ebeb","name":"ebeb","key":"ebeb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Wedel","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux h1666427 2.6.32-042stab078.27 #1 SMP Mon Jul 1 20:48:07 MSK 2013 i686 athlon i386 GNU/Linux","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12660583/comment/13723671","id":"13723671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Sounds like AMQ-4595 is the root cause, grab the latest nightly 5.9 SNAPSHOT and give that a try. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-07-30T10:20:23.679+0000","updated":"2013-07-30T10:20:23.679+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12660583/comment/13723693","id":"13723693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ebeb","name":"ebeb","key":"ebeb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Wedel","active":true,"timeZone":"Europe/Berlin"},"body":"Hmm, the question is: Why does it happen with 60 messages? In issue AMQ-4595, the had 10000 messages. Right now, after some messages have been consumed, there are 28 left, and these messages are displayed instantly.\n\nHowever, I've checked the body size and each message contains about 20kB of XML (don't ask my why, its not my code). But does browsing actually needs to acquire the body for displaying a list of message ids?\n\nAnd even if its been done, this would be 60*20b=1,4MB which should be fine when running AMQ with 1GB of heap, shouldn't it?\n\nAlso, they were talking about the auditDeph, which is set to > 2000 by default. So this appears not to be the same issue at least from my outsider's point of view.\n\nUnfortunately, this is a live-system. I will try to deploy the dev version on one of our development servers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ebeb","name":"ebeb","key":"ebeb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Wedel","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-30T10:42:19.980+0000","updated":"2013-07-30T10:42:19.980+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12660583/comment/13725753","id":"13725753","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Hard to say since I can't reproduce it, try a 5.9 SNAPSHOT and see if its resolved. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-07-31T21:49:30.412+0000","updated":"2013-07-31T21:49:30.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12660583/comment/13741516","id":"13741516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Cannot reproduce on the latest 5.9-SNAPSHOT.  Reopen if you can provide a test case that shows a new issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-08-15T21:34:37.087+0000","updated":"2013-08-15T21:34:37.087+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4660/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1mruv:"}}