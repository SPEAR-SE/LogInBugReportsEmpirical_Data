{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12914759","self":"https://issues.apache.org/jira/rest/api/2/issue/12914759","key":"AMQ-6054","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2015-11-20T13:29:03.750+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Nov 24 02:17:14 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_327173834_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-11-24T02:17:34.799+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6054/watchers","watchCount":4,"isWatching":false},"created":"2015-11-20T07:24:40.998+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12333269","id":"12333269","name":"5.12.1","archived":false,"released":true,"releaseDate":"2015-10-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-11-24T02:17:34.829+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"*How to Reproduce*\n1. Make a durable subscription to a topic from a JMS client.\n2. Disconnect the JMS client.\n3. Send a message to the subscribed topic from another JMS client.\n4. Restart AMQ.\n5. When the duarable re-connects to AMQ, it cannot receive the message sent in step 3.\n\n*Cause Analysis*\nThe message is saved in the persistent store successfully. However, when the message is marshalled by the class MessageMarshaller, the field regionDestination is not marshalled and saved to persistent store. When the message is recovered from persistent store after restart, the regionDestination filed of Message is empty so it is unknown which topic this message belongs to.\n\n*Possible Cause*\nIn the method org.apache.activemq.broker.region.Topic.activate(ConnectionContext context, final DurableTopicSubscription subscription), the subscription.isRecoveryRequired() check is always false. The message cannot go to the subscription.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12773463","id":"12773463","filename":"Web Console Snapshot.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nevinchen","name":"nevinchen","key":"nevinchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nevin Chen","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2015-11-20T07:29:31.621+0000","size":17444,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12773463/Web+Console+Snapshot.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Durable subscriber cannot receive the existing messages after AMQ restarts","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nevinchen","name":"nevinchen","key":"nevinchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nevin Chen","active":true,"timeZone":"Asia/Hong_Kong"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nevinchen","name":"nevinchen","key":"nevinchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nevin Chen","active":true,"timeZone":"Asia/Hong_Kong"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Redhat Linux","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914759/comment/15015355","id":"15015355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nevinchen","name":"nevinchen","key":"nevinchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nevin Chen","active":true,"timeZone":"Asia/Hong_Kong"},"body":"AMQ web console snapshot before and after restart","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nevinchen","name":"nevinchen","key":"nevinchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nevin Chen","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2015-11-20T07:29:31.625+0000","updated":"2015-11-20T07:29:31.625+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914759/comment/15018017","id":"15018017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Are you using KahaDB? I recommend that you submit a test case to demonstrate this issue so we can see if there is something specific about your configuration that is causing this because this is a very common use case and there are many tests to make sure that this works properly.  One example is the test class DurableSubscriptionOfflineTestBase (and all children classes) which test various cases of durables being able to be consumed after being offline and after a broker restart.\n\nThe KahaDB index keeps track of durable subscriptions and and which messages were acked so it should be able to recover messages on restart.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-11-20T13:29:03.750+0000","updated":"2015-11-20T13:29:03.750+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914759/comment/15023603","id":"15023603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nevinchen","name":"nevinchen","key":"nevinchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nevin Chen","active":true,"timeZone":"Asia/Hong_Kong"},"body":"Sorry, I tried it again and everything goes well. There must be something wrong with my previous operations.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nevinchen","name":"nevinchen","key":"nevinchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nevin Chen","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2015-11-24T02:17:14.151+0000","updated":"2015-11-24T02:17:14.151+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6054/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ootr:"}}