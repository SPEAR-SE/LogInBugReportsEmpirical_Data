{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481404","self":"https://issues.apache.org/jira/rest/api/2/issue/12481404","key":"AMQ-326","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2006-01-11T07:53:39.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 11 07:53:39 UTC 2006","customfield_12310420":"84268","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_12666909000_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2006-01-11T07:53:39.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-326/watchers","watchCount":0,"isWatching":false},"created":"2005-08-17T17:18:30.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315601","id":"12315601","name":"3.1","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-01-11T07:53:39.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Have seen cases where the delivery can be delayed by minutes.  This was happening in single broker configuration.  ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460738","id":"12460738","filename":"ASF.LICENSE.NOT.GRANTED--AMQ-326.tar.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-09-01T01:33:24.000+0000","size":302670,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12460738/ASF.LICENSE.NOT.GRANTED--AMQ-326.tar.gz"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"254560","customfield_12312823":null,"summary":"Intermittent delay of delivery of queue messages to clients in a timely fashion.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"w2k & RH 9.0 jdk1.4.2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481404/comment/12936766","id":"12936766","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":" The attachment are scripts, classes and library needed to duplicated the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-09-01T01:33:24.000+0000","updated":"2005-09-01T01:33:24.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481404/comment/12936594","id":"12936594","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"This describes both the \"lost queue messages\" during broker fail over condition,  and the \"orphaned messages\" problem  where messages are getting stuck in some network channel buffer on a remote broker.  Here is the scenario:\n\nTwo networked brokers A and B.\nOne queue message producer connected to broker A\nOne queue message receiver X connected to broker A\nOne queue message receiver Y connected to broker B\n\nBoth the message receivers have their queue prefetch policy, prefetch count set to 1.  This causes each of the two receivers to receive every other message generated.  This much was expected.  However, after stopping receiver Y on broker B, the receiver X on broker A is still only receiving half of the generated messages.  The other half of the messages is being sent across the network bridge to broker B.  This occurs even though there is no client attached to broker B.\n\nIf receiver Y is restarted (attached to broker B), then it will receive all the backlogged queue messages.   \n\nIf both receivers are stopped, then all messages get sent across the bridge from broker A to broker B.  At that point even if receiver X is started on broker A it can only receive messages generated after the time is started (and only half of the messages).  The messages that go across the bridge never become available to the local receiver.  \n\nThe only way to stop the flow of message across the bridge seem to be to stop broker B.  After restarting broker B, a couple (2 out of 10) of the messages that where incorrect sent across the bridge were returned back to receiver X on broker A.  But even restarting receiver Y on broker B cannot recover the remaining messages.  The have just \"disappeared\". \n\nRun instructions to duplicate:\n\nThe goal is to run three clients on a cluster of two networked brokers.\n\nPrequirements:\n\nTwo stand-alone brokers with network connections to each other. The client scripts assume that both brokers on localhost using ports 61616 and 62626.\n\nACTIVEMQ_HOME environment variable has been defined.\n\nUsing SVN HEAD (built as 3.2-SNAPSHOT)\n\n\nSteps to reproduce problems.\n\n1) start script receiver1.cmd (connects using port 61616)\n2) start script receiver2.cmd (connects using port 62626)\n3) start script sender.cmd (connects using port 62626)\n\nThe scripts can be adjusted to tailor rate of message generation and consumption.  Each script has a COUNT and INTERVAL for this purpose.  The default provided in the script will demonstrate the problem.  10 messages every 5000ms are generated and both receivers consume a total of 8 messages every 3000ms.  Logs (one for each process) and console output are identical and show generation sequences and receipt information.  \n\nAt this time logs will show even distribution of generated message across receivers.\n\n4) stop receiver1 process.\n\nNow log for receiver2 will show it is only receiving every other message (the other messages are going across the network bridge even though not client to receive them.\n\n5) start script receiver1.cmd (connects using port 61616)\n\nThe receiver1 will now start to receive the messages that have been buffered (the log entries show the delay time for each message). The receiver2 is still only receiving every other newly generated message.\n\n6) stop sender process. \n7) stop receiver1 process. \n8) stop receiver2 process.\n\nNow generate a burst of messages\n9) start script sender.cmd (connects using port 62626)\n10) stop sender process.\n\nReconnect the local receiver.\n11) start script receiver2.cmd (connects using port 62626)\n\nThis receiver will receive no messages.  When there was no local receiver, all generated messages were sent across the bridge.  At this point there are a minimum of 10 messages in the remote broker and if receiver1 were started it would receive these messages.  If no client every reconnects to this broker, the messages are permentatly \"orphaned\"\n\n12) stop receiver2 process.\n\n13) stop the remote broker (the one offering port 61616).\n14) restart the remote broker (the one offering port 61616).\n\nAfter both brokers are interconnected again\n\n15) start script receiver2.cmd (connects using port 62626)\n\nAt this point a couple of message may be provided to the receiver2, but most of the previously generated message are MIA.\n\n\n\n\n\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-09-01T01:36:22.000+0000","updated":"2005-09-01T01:36:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481404/comment/12936261","id":"12936261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"Opps! All of the above comments (and attachment) were meant for AMQ-327","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-09-01T01:39:25.000+0000","updated":"2005-09-01T01:39:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481404/comment/12936636","id":"12936636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"Just an update, I have still not been able to recreate this situation again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-09-02T19:30:13.000+0000","updated":"2005-09-02T19:30:13.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481404/comment/12937329","id":"12937329","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aco","name":"aco","key":"aco","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Co","active":true,"timeZone":"Etc/UTC"},"body":"Unable to reproduce. No test scenario was also provided for delayed delivery.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aco","name":"aco","key":"aco","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Co","active":true,"timeZone":"Etc/UTC"},"created":"2006-01-11T07:53:39.000+0000","updated":"2006-01-11T07:53:39.000+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-326/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i17yi7:"}}