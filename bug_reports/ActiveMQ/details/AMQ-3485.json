{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12521530","self":"https://issues.apache.org/jira/rest/api/2/issue/12521530","key":"AMQ-3485","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2011-09-07T13:33:15.424+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 23 14:51:33 UTC 2012","customfield_12310420":"59991","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3485/watchers","watchCount":4,"isWatching":false},"created":"2011-09-07T02:37:31.993+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-10-23T14:51:33.405+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When I have a transacted Session, as it is single threaded I can't create two MessageConsumer to the same Destination. But if I create a MessageConsumer to a Destination and then I close it, then I should be able to create a new MessageConsumer to the same Destination. This is working fine in active mq 4.1.2 but it doesn't work in 5.5.0. It allows to create a second MessageConsumer but that seconde MessageConsumer always returns null when the queue has messages.\n\ni.e:\nSession session = .... //transacted session\nDestination dest = .... \nMessageConsumer mc = session.createMessageConsumer(dest);\nMessage message = mc.receive(); // message received ok\nmc.close();\nmc = session.createMessageConsumer(dest);\nMessage message = mc.receive(); // message is null\n\nThanks, Pablo.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12493512","id":"12493512","filename":"activemq-issue-test-case.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-07T21:44:17.741+0000","size":64146,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12493512/activemq-issue-test-case.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"60089","customfield_12312823":null,"summary":"Transacted Session returns invalid MessageConsumer after the first MessageConsumer for the same destiantion. Bug introduced in 5.5.0 - working ok in 4.1.2","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13098940","id":"13098940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I'd recommend creating a JUnit test case that reproduces your issue and attaching it here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-09-07T13:33:15.424+0000","updated":"2011-09-07T13:33:15.424+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13099584","id":"13099584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"body":"App showing bug","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-07T21:44:17.778+0000","updated":"2011-09-07T21:44:17.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13099586","id":"13099586","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"body":"Attached you can found a maven project with a test reproducing this issue. It seems to be working in 5.2.0 and failing after that release.\n\nThanks, Pablo.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-07T21:45:01.534+0000","updated":"2011-09-07T21:45:01.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13104932","id":"13104932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Working as designed.  The second consumer would not receive the message as the session has not been rolled back, called rollback after consumer.close() and your second consumer would receive the message.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-09-14T22:16:01.312+0000","updated":"2011-09-14T22:16:01.312+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13106710","id":"13106710","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Timothy. But I really don't understand. \n\nIf the session is not close, why I'm not able to create one consumer, close it, and then create another. And in the end commit()/rollback() the session?. This should be allowed as it is in previous ActiveMQ releases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-16T19:01:18.210+0000","updated":"2011-09-16T19:01:18.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13106714","id":"13106714","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You can create as many consumers as you'd like but they won't consumer messages that have already been consumed in that transaction, you need to first rollback the transaction before a message will be redelivered.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-09-16T19:04:17.839+0000","updated":"2011-09-16T19:04:17.839+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13108811","id":"13108811","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"body":"I'm don't want that. What I want is that if I have a queue QUEUEA with 2 messages, and I have a session SESSIONA, I should be able to create one consumer with SESSIONA and consume the first message, close that consumer, and then create another consumer with SESSIONA and consume the second message. Once more, as I was able to do in previous versions of ActiveMQ.\n\nIf after that I commit SESSIONA both message will be removed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-20T16:29:54.523+0000","updated":"2011-09-20T16:29:54.523+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13480132","id":"13480132","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbtourist","name":"sbtourist","key":"sbtourist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sbtourist&avatarId=17033","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sbtourist&avatarId=17033","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sbtourist&avatarId=17033","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sbtourist&avatarId=17033"},"displayName":"Sergio Bossa","active":true,"timeZone":"Europe/London"},"body":"The problem is not about consuming from *multiple consumers* the *same* message: it is about consuming *different messages*.\nThat is, subsequent consumers always return null if there's a previous consumer with a non committed message, which doesn't make sense, as if you want to preserve ordering with that, you should really throw an exception rather than fail silently.\nIs it clearer now?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbtourist","name":"sbtourist","key":"sbtourist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sbtourist&avatarId=17033","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sbtourist&avatarId=17033","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sbtourist&avatarId=17033","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sbtourist&avatarId=17033"},"displayName":"Sergio Bossa","active":true,"timeZone":"Europe/London"},"created":"2012-10-19T17:02:38.087+0000","updated":"2012-10-19T17:02:38.087+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13480246","id":"13480246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"body":"I disagree. Message ordering processing should only be preserved if I'm using only one consumer.\n\nIt's ok to not preserve order if I decide to have more than one consumer. And I should also be able to have more than one consumer from the same QUEUE at the same time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-19T18:48:36.936+0000","updated":"2012-10-19T18:48:36.936+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13480278","id":"13480278","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbtourist","name":"sbtourist","key":"sbtourist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sbtourist&avatarId=17033","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sbtourist&avatarId=17033","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sbtourist&avatarId=17033","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sbtourist&avatarId=17033"},"displayName":"Sergio Bossa","active":true,"timeZone":"Europe/London"},"body":"I agree with you obviously.\n\nI'm just saying if that's the case, it shouldn't fail silently by the way.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbtourist","name":"sbtourist","key":"sbtourist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sbtourist&avatarId=17033","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sbtourist&avatarId=17033","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sbtourist&avatarId=17033","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sbtourist&avatarId=17033"},"displayName":"Sergio Bossa","active":true,"timeZone":"Europe/London"},"created":"2012-10-19T19:14:09.183+0000","updated":"2012-10-19T19:14:09.183+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13481291","id":"13481291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"It looks like a bug. The expectation that you can close and open new consumers in the same transaction and receive messages is valid.\n\nI'll play with the test a bit to see if I can find the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2012-10-22T10:30:37.840+0000","updated":"2012-10-22T10:30:37.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13482288","id":"13482288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"So we investigated this in more details. The problem was introduced with a fix for [AMQ-2034], when we started postponing the closing of the actual consumer until transaction ends (either commit or rollback). This leads us to the problem where the messages that were already prefetched by the consumer are stuck on that consumer until the end of the transaction.\n\nThe easiest workaround for this is to turn of prefetching, with something like\n\n{code}Destination dest = session.createQueue(\"TEST?consumer.prefetchSize=0\");{code}\n\nAnd frankly turning of the prefetch in use cases where you want to have multiple consumers coming and going inside the single transaction make the only sense, as every other approach will mess the order of messages.\n\nTo support closing consumers with prefetched messages inside the transaction we'd need to refactor the whole thing. Ideally the consumer would close immediately and on transaction end, broker would know how to redeliver unconsumed messages.\n\nLet me know if this workaround works for you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2012-10-23T12:33:50.444+0000","updated":"2012-10-23T12:34:28.730+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13482339","id":"13482339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"body":"To be honest it's not a solution for me. The thing is that I have a generic layer on top of activemq that I can't specialize for a particular case.\n\nI don't need this fix right now but would be nice to have it fix in a future release.\n\nThanks Dejan.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pablolagreca","name":"pablolagreca","key":"pablolagreca","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pablo La Greca","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-23T14:04:20.103+0000","updated":"2012-10-23T14:04:20.103+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13482347","id":"13482347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks for the comment Pablo. We'll try to make a fix. The thing is, it's not that trivial and will affect how we process transactions, so it requires some work. \n\nAs for the workaround, you just need to change a destination name when creating a consumer, so it should be easy one. But again, it might be impossible to do in your system.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2012-10-23T14:12:02.586+0000","updated":"2012-10-23T14:12:02.586+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521530/comment/13482369","id":"13482369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"or you can set the prefetch on the broker via a destinationPolicy to set the prefetch for all or a matching set, of destinations.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-23T14:51:33.405+0000","updated":"2012-10-23T14:51:33.405+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3485/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0anjz:"}}