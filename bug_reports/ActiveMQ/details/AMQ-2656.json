{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483476","self":"https://issues.apache.org/jira/rest/api/2/issue/12483476","key":"AMQ-2656","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321258","id":"12321258","description":"Next v5 maintenance release","name":"5.7.0","archived":false,"released":true,"releaseDate":"2012-10-08"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-18T20:05:11.874+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 11 11:41:21 UTC 2012","customfield_12310420":"74857","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_795704_*|*_5_*:*_2_*:*_27303387186_*|*_4_*:*_1_*:*_45760782487","customfield_12312321":null,"resolutiondate":"2012-07-11T11:41:21.197+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2656/watchers","watchCount":3,"isWatching":false},"created":"2010-03-18T19:51:56.194+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[{"id":"12335021","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335021","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12483181","key":"AMQ-2670","self":"https://issues.apache.org/jira/rest/api/2/issue/12483181","fields":{"summary":"ClassCast Exception in JBoss when using XA ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-11T11:41:21.525+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"ActiveMQInitialContextFactory cannot resolve the name \"XAConnectionFactory\"  a la:\n\nINFO: JNDI API lookup failed: javax.naming.NameNotFoundException: XAConnectionFactory\n\nThis prevents using the builtin JNDI service in an XA transaction context.  I've created a simple patch to workaround this and discussed it on the mailing list:  http://old.nabble.com/ActiveMQ%27s-JNDI-does-not-resolve-XAConnectionFactory-td27936255.html\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461576","id":"12461576","filename":"ActiveMQInitialContextFactory.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T03:05:04.319+0000","size":8422,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461576/ActiveMQInitialContextFactory.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461439","id":"12461439","filename":"ActiveMQInitialContextFactory.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T20:20:33.447+0000","size":9409,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461439/ActiveMQInitialContextFactory.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59598","customfield_12312823":null,"summary":"ActiveMQInitialConnectionFactory cannot return an XAConnectionFactory","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12936918","id":"12936918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"added support for a boolean xa property in the environment which will cause an xa connection factory to be created. r924972\n{code}xa=true{code}\nor on a lookup name basis\n{code}connection.<name>.xa=true{code}\nwill result in an XAConnectionFactory being created.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T20:05:11.874+0000","updated":"2010-03-18T20:05:11.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12937601","id":"12937601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"body":"This is my patched version that allows me to jndiContext.lookup(\"XAConnectionFactory\") and get a working XAConnectionFactory.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T20:20:33.571+0000","updated":"2010-03-18T20:20:33.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12939050","id":"12939050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"body":"Gary, will your patch (I can't see it yet) allow me to JNDI lookup \"XAConnectionFactory\"  ?  That may be all I have available in webMethods \"JNDI Provider Alias\" settings.  I guess I can try to lookup connection.MyConnection or something along those lines.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T20:24:00.776+0000","updated":"2010-03-18T20:25:59.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12939391","id":"12939391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"check out the subversion commits tag to see the changes.\n\nIt may not be enough for you if you cannot augment the environment to add the xa=true property.\nthere is also a property for the connectionFactoryNames where you can provide the list of names you will expect. This overrides the DEFAULT_CONNECTION_FACTORY_NAMES","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T20:45:49.850+0000","updated":"2010-03-18T20:45:49.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12941940","id":"12941940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"body":"At least from work, it took a while for the source code to show up in Crucible.  I saw it before I left work, but I wasn't able to get it to work.  I'll try again tomorrow, but I get ClassCastException trying to cast ActiveMQConnectionFactory to ActiveMQXAConnectionFactory.  Maybe that should work since it's a subclass, but that error makes me doubtful :)  So far I've only been successful with my patch which returns an ActiveMQXAConnectionFactory specifically.\n\nFrom within webMethods, I can set \"other properties\" which seem to be \"jndi.properties.\"   I tried adding \"MyConnection\" to my custom list of connectionFactoryNames, but I was unsuccessful performing a context.lookup() on \"MyConnection.xa=true\" or \"connection.MyConnection.xa=true\" ...\n\nIf I can get your patch working, I still want to modify the DEFAULT_CONNECTION_FACTORY_NAMES to include \"XAConnectionFactory\" to make it available as easily as the other standard JMS types.  Thanks for your help on this :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T01:31:14.126+0000","updated":"2010-03-19T01:31:14.126+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12941992","id":"12941992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"body":"This version is based on the latest svn but adds an XAConnectionFactory to the default list of factories, and sets the \"xa\" environment value manually for that factory during creation.  I was able to test the original patch successfully, and this patch lets me lookup \"XAConnectionFactory\" via the JNDI context which I believe will be required to easily integrate with webMethods.\n\nMaybe it should be a regexp so any custom connection name with \"XA\" will get the treatment?  *shrug*  I guess I think that at a minimum, a default connection factory name like \"XAConnectionFactory\" should work without setting environment variables.  But I what do I know, seriously...   ;)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T03:05:04.323+0000","updated":"2010-03-19T03:10:02.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12942038","id":"12942038","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"If you can specify in other properties:\n{code}\nconnectionFactoryNames=XAConnectionFactory\nxa=true\n{code}\n\nthen:\n{code}context.lookup(\"XAConnectionFactory\"){code} will be an instanceof XAConnectionFactory","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T11:19:11.592+0000","updated":"2010-03-19T11:19:11.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12941998","id":"12941998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for the pointers on the properties.  I was able to just have a line with \"xa=true\" in both my jndi.properties for my standalone java client test and the \"Other Properties\" in webMethods and create an \"XA\" transaction by just looking up \"ConnectionFactory.\"  It seems to apply to all ConnectionFactory lookups, though, so my standalone java client gets an exception when sending a message:\n\njavax.jms.JMSException: Session's XAResource has not been enlisted in a distributed transaction.\n\nI assume there is no way to limit the xa=true property to a particular connection factory lookup with this method.  (If I use your snippet above a lookup of \"ConnectionFactory\" fails, for instance.)  It seems less desirable to me to be forced into creating separate processes or JNDI Providers in webMethods to do XA or not.  But I can work with the patch you have submitted for 5.4.0, as opposed to current.  Once we've had a chance to test out the current patch in webMethods more, perhaps we will see if it is a big of a pain or not.  \n\nI'm tempted to keep my patch locally, as it strikes me as much easier to remember \"just look up XAConnectionFactory if that's what you need\" as opposed to configuring the environment.  OTOH, it may be harder to remember to keep my local patch when we upgrade someday :)  Thanks again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T15:46:12.599+0000","updated":"2010-03-19T15:46:12.599+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12941988","id":"12941988","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"you are nearly there, try{code}\nconnectionFactoryNames=XAConnectionFactory,ConnectionFactory\nconnection.XAConnectionFactory.xa=true\n{code}\n\nand you can lookup both an xa and non xa connectonfactory by their respective names.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T15:53:25.842+0000","updated":"2010-03-19T15:53:25.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12942125","id":"12942125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"body":"Why didn't you mention that in the first place!?!?!   Oh... Because you did... DOH!\n\nOk, that is working fine for both my Java client test and our webMethods environment, even as far as verifying a transaction can be rolled back.    I still think XAConnectionFactory should be available without additional configuration, for instance, just yesterday I had to remind a coworker to copy the properties configuration after setting up a new system :)\n\nBut this is working and I don't want to be too pushy with my first reported issue :)  Thanks a lot for the help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=edan","name":"edan","key":"edan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edan idzerda","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-23T20:14:52.196+0000","updated":"2010-03-23T20:15:14.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12942816","id":"12942816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sapunce","name":"sapunce","key":"sapunce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nace Sapundziev","active":true,"timeZone":"Etc/UTC"},"body":"Hello Gary and Edan, \n\nI have the same problem using the XAConnectionFactory with ActiveMQ. \nCould please tell me is this patch released and how can I use it?\n\nRegards,\nNace","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sapunce","name":"sapunce","key":"sapunce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nace Sapundziev","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-01T14:37:07.651+0000","updated":"2010-09-01T14:37:07.651+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12942803","id":"12942803","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"it is in 5.4.0, see the fix version above and the comment: https://issues.apache.org/activemq/browse/AMQ-2656?focusedCommentId=58336&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_58336\n\nthat has details of the properties.\nThere is also a test you can browse: \nhttp://fisheye6.cenqua.com/browse/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/jndi/XAConnectionFactoryTest.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-01T15:25:14.395+0000","updated":"2010-09-01T15:25:14.395+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12942794","id":"12942794","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sapunce","name":"sapunce","key":"sapunce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nace Sapundziev","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for your fast response Gary. Yes it works for me.\n\nThanks again, \nNace","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sapunce","name":"sapunce","key":"sapunce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nace Sapundziev","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-02T10:32:19.271+0000","updated":"2010-09-02T10:32:19.271+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12986410","id":"12986410","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hindsbeans","name":"hindsbeans","key":"hindsbeans","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Hinds","active":true,"timeZone":"Etc/UTC"},"body":"Gary, thanks for your help on this. In the end I had to use the version of ActiveMQInitialContextFactory.java as attached by Edan idzerda at 2010-03-18 11:05 PM. I had a search through the ActiveMQ issue tracker and couldn't find if Edan's suggested code was ever added to core - do you know if it was? It would be very useful if it was for cases like the one I have outlined below where the setting up of the jndi environment is abstracted up out of the code. (i.e. in websphere you cannot define the 'xa=true' property anywhere - hence Edan's 'XAConnection' jndi name is invaluable!\n\nFor anybody else trying to get a connection to ActiveMQ within a WebSphere7.0.0-managed XA transaction and getting an error of \"An illegal attempt to commit a one phase capable resource with existing two phase capable resources has occured\" in the WebSphere SystemOut.log. This error was thrown when a Message Driven Bean was fired from a WebSphere default jms queue and it tried to write a message to an ActiveMQ queue all within an XA transaction. There was an Oracle db write in the same transaction also. Here are the steps to get around it:\n\n1) Use the attached file kindly attached by Edan at 2010-03-18 11:05 PM to compile activemq-5.4.0.\n\n2) In WebSphere Admin Console, create a new JMS provider:\ni) Resources > JMS > JMS providers > New\nii) Use the following:\n    Name: use a name like 'ActiveMQ 5.4.0'\n    Classpath: add the paths to the following jar files (each path needs to be on a new line in the text box) activemq-all-5.4.0.jar, commons-logging-1.1.jar, geronimo-j2ee-management_1.1_spec-1.0.1.jar\n    External Initial Context Factory: org.apache.activemq.jndi.ActiveMQWASInitialContextFactory\n    External Provider URL: tcp://localhost:61616\n\n3) In WebSphere Admin Console, create a new ConnectionFactory\ni) Resources > JMS > Connection factories > New\nii) Use the following:\n    Name: use a name like 'ActiveMQ 5.4.0 Connection Factory'\n    JNDI name: jmsfactory/activemq540connfactory (this will be the name that any WebSphere-run apps will lookup using jndi)\n    External JNDI name: XAConnectionFactory (this is the new name added by Edan's code in step 1 above - basically, when you're code running in WebSphere calls 'jmsfactory/activemq540connfactory', WebSphere does a call to activemq using this jndi name, i.e. XAConnectionFactory )\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hindsbeans","name":"hindsbeans","key":"hindsbeans","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Hinds","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-25T14:52:40.173+0000","updated":"2011-01-25T15:14:39.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12986433","id":"12986433","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@peter, thanks for closing the loop on this with the feeback.\nSo in 2.ii or 3.i - there is no possibility to specify an additional property for the jndi environment?\nnot good. \n\nSo either we have a hardcoded xaconnection factory, Edan's fix, or the 'xa=true' jndi env property needs to be embedded in the 2.ii external provider url, like tcp://localhost:61616?jndi.xa=true","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-25T15:29:43.179+0000","updated":"2011-01-25T15:29:43.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12986512","id":"12986512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hindsbeans","name":"hindsbeans","key":"hindsbeans","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Hinds","active":true,"timeZone":"Etc/UTC"},"body":"In websphere there are options in 2.ii and 3.i to add what are called 'custom properties' but these do not get translated into jndi environment properties unfortulately.\n\nIn terms of which route to take I would say that the provider url should be left intact. To me it would be more intuitive if the name you supply to a jndi lookup call determines if an ActiveMQXAConnectionFactory or an ActiveMQConnectionFactory is returned as opposed to the provider url used to create the InitialContext. I guess setting it in the provider url abstracts it away from where it is relevant, which is in the jndi lookup call. As in all things though, this is just my opinion - and I'm more than wiling to be corrected!\n\nUsing the 'XAConnectionFactory' jndi name also has the additional benefit of leaving the well recognised url of 'tcp://localhost:61616' untouched as well as being tried and tested - thanks to Edan!!\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hindsbeans","name":"hindsbeans","key":"hindsbeans","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Hinds","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-25T16:56:16.691+0000","updated":"2011-01-25T17:05:40.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/12988215","id":"12988215","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"opening so we don't forget to add a hard coded xa factory name.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-28T20:21:39.029+0000","updated":"2011-01-28T20:21:39.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483476/comment/13411422","id":"13411422","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"\nURL: http://svn.apache.org/viewvc?rev=1360125&view=rev\nLog:\nhttps://issues.apache.org/jira/browse/AMQ-2656 - add wellknown xa factory name, XAConnectionFactory so that context.lookup(\"XAConnectionFactory\") will work as expected out of the box","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-11T11:41:21.362+0000","updated":"2012-07-11T11:41:21.362+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2656/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0akiv:"}}