{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481170","self":"https://issues.apache.org/jira/rest/api/2/issue/12481170","key":"AMQ-173","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315598","id":"12315598","name":"2.0","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2005-03-27T03:23:26.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Mar 27 03:23:26 UTC 2005","customfield_12310420":"48906","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_161328000_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2005-01-22T01:15:33.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-173/watchers","watchCount":1,"isWatching":false},"created":"2005-01-20T04:26:45.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2005-03-27T03:23:26.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I am testing a setup where two brokers are networked in a site. This is done to provided but load balancing and high availablity.  However I have found a bug that prevents this configuration for both purposes.  In short if one of the broker fails for any length of time, the remain broker can never re-establish a proper link back to the restored broker.  The following steps to duplicate this problem.\n\n\nTopology: 2 brokers\n               broker1 port=61616, network channel=62626\n               broker2 port=62626, network channel=61616\n          1 consumer connects to 61616\n\t\t\t 1 producer connects to 62626\n\t\t\t \n\nTest procedure:\n\n1) start broker1 and broker2\n   log shows that both brokers establish network channels to the other\n\t\n2) start consumer\n\tlog for broker1 show client connection and forward of destination registration to broker2\n\tlog for broker2 show receipt of destination registration\n\t \n3) start producer\n   log for broker2 shows client connection and discconection when producer terminates\n\tlog for broker1 shows forwarded messages for consumer received from broker2\n\t\n4) stop broker2\n   log for broker2 shows shutdown\n\tlog for broker1 show broker2 disconnect, but also errors when trying to send keepalive\n\t\n5) stop consumer\n\n6) wait 2+ minutes, wait for \"NetworkChannel - stopped MetworkMessageBridge for destination:\" in broker1 log\n\n7) start broker2\n   log for broker1 shows establishment of network channel for broker2, but broker2 log does not corresponding broker1 network channel registration\n\t\n8) start consumer\n   log for broker 1 show error in attempt to establish NetworkMessageBridge for destination\n\t\n9) start producter\n   log for broker2 shows client connection and discconection when producer terminates\n\tlog for broker1 shows NO forwarded messages","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161866","customfield_12312823":null,"summary":"Network channel fails to reconnect","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"W2K Pro, java version \"1.4.2_05\"","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481170/comment/12936621","id":"12936621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"Broker config and log files from my test. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-01-20T04:31:21.000+0000","updated":"2005-01-20T04:31:21.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481170/comment/12936625","id":"12936625","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"I ran the test again changing step 6 to restart broker2 immediately.  In this case it looks like broker1 was able to re-establish the network channel.  However when the producer is started, broker2 log shows a null pointer exception for every message forwarded to broker1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-01-20T05:33:01.000+0000","updated":"2005-01-20T05:33:01.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481170/comment/12936943","id":"12936943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"I have track the second part of this problem down to the fact that the writeValueCache in the DefaultWireFormat is not cleared when the network channel connection is broken.  However, I am not not sure the proper place to perform the clear. Can someone step in and provide some guidance.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-01-21T03:34:42.000+0000","updated":"2005-01-21T03:34:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481170/comment/12936836","id":"12936836","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"The information in attached file amq173info-3.zip is an extract from the log files generated by the networked brokers.  I added log statements in the DefaultWireFormat methods that read and write to the readValueCache map.  After confirming that I am currently working against the code in CVS HEAD, I reran my test and extracted the cache accessing log messages.  The log clearly show that the something is wrong with the cache as it is returning null values for the key that should represent the destination value.  I had assumed that this was cause by the sender assuming that the receiver had cached the needed values, but looking at the extracts closer, I think that wrong instance being accessed might be the cause.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-01-21T21:52:38.000+0000","updated":"2005-01-21T21:52:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481170/comment/12937045","id":"12937045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"The NullPointerException problem has been repaired now, however the first problem still remains.  Thinking about it though I realized that not be a bug, but instead a limitation of the configuration used for the reliable transport.  Unless this tranport is configured in such a way as to perform a perpetual check for its defined peers, the Netword channel will eventually timeout and stop.  Once this NetworkChannel stops the only way to start it again is to restart the broker.\n\nWith this understanding I consider this issue close.  Thank Stewie for helping find the problem with NullPointerException.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-01-22T01:12:25.000+0000","updated":"2005-01-22T01:12:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481170/comment/12936913","id":"12936913","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fanhong","name":"fanhong","key":"fanhong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hong Fan","active":true,"timeZone":"Etc/UTC"},"body":"Hi everyone,\n\nI need your input related to this problem. I am using the latest ActiveMQ 2.1 with JDK 1.5. I have two brokers clusters with network channels, let's say A, B. If I shutdown broker B, the network channel on both ends re-connected. But i noticed that the topic publisher in B is no longer able to publish message to A. On the other hand, topic subscriber is able to receive the message published by A. If I shutdown A, the situation is reversed.\n\nI like to confirm whether this finding is valid. I appreciate you input.\n\nThanks\n\nHong","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fanhong","name":"fanhong","key":"fanhong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hong Fan","active":true,"timeZone":"Etc/UTC"},"created":"2005-03-27T03:23:26.000+0000","updated":"2005-03-27T03:23:26.000+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-173/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s2en:"}}