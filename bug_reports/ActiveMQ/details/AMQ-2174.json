{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483649","self":"https://issues.apache.org/jira/rest/api/2/issue/12483649","key":"AMQ-2174","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2010-08-09T10:40:11.570+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 20 18:53:52 UTC 2015","customfield_12310420":"75041","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_202333334330_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-08-20T18:53:52.704+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2174/watchers","watchCount":6,"isWatching":false},"created":"2009-03-22T23:11:38.429+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-08-20T18:53:52.756+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When modifying an existing durable subscription, for example to change selectors, that subscription no longer gets any messages and error messages are produced.\n\nJuni test case attached and broker output with log level set to TRACE, which is based on the ProducerTool and ConsumerTool examples.\n\nSequence to produce the problem is \n\n1. Clean data directory\n2. Run test case testConsumeWithNoSelectors - this creates the topic and blocks waiting for messages\n3. Run test case testProduceWithProperties - this creates 6 messages each with a single String property.  First 2 have \"selectorProp = 0\", second 2 have value 1 and third pair have value 0 again.  Consumer test case in (2) will consume messages and exit.\n4. Run test case testConsumeWithSelectors - this changes the durable subscription and adds the selectorProp = '0' to the subscription.\n5. Run same test case as (3).  The consumer will then receive the first 2 messages produced by this producer and then block as it changes the subscription to have selectorProp = '1'.\n\nAt this point this would appear to be a problem.  According to the JMS TopicSubscriber Javadocs\n\n\"A client can change an existing durable subscription by creating a durable TopicSubscriber with the same name and a new topic and/or message selector. Changing a durable subscription is equivalent to unsubscribing (deleting) the old one and creating a new one. \"\n\nso, if step (4) above has now changed the durable subscription to add a selector it still receives the first two messages from step 5, so from that, it appears that the broker is able to recognise this as a modification (although it is delete+create).  So, when it then tried to make the modification to change the selector to \"selectorProp = 1\" and receive the next two it does not get any messages.  So, I would expect that as it has now blocked waiting for messages with those properties, if I do\n\n6. Run same test case as (3)\n\nI would expect the middle two messages to be received by the blocked consumer, but no more messages are consumed and I get the following messages to the broker log\n\nERROR RecoveryListenerAdapter        - Message id ID:aconcagua-4821-1237761609609-0:0:1:1:3 could not be recovered from the data store - already dispatched\n\nThis particular subscription for clientId and topic now seems to be blocked forever and messages posted to this topic can never be received by this subscriber.\n\n\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461792","id":"12461792","filename":"AMQ2174Test.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-09T10:40:11.490+0000","size":12290,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461792/AMQ2174Test.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461420","id":"12461420","filename":"selector.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adb","name":"adb","key":"adb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antony Bowesman","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-22T23:14:24.603+0000","size":189204,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461420/selector.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461419","id":"12461419","filename":"SelectorBugTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adb","name":"adb","key":"adb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antony Bowesman","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-22T23:14:24.495+0000","size":12007,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461419/SelectorBugTest.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59706","customfield_12312823":null,"summary":"Modifying an existing Durable subscription blocks that subscription from receiving messages","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adb","name":"adb","key":"adb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antony Bowesman","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adb","name":"adb","key":"adb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antony Bowesman","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XPSP3","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483649/comment/12941031","id":"12941031","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adb","name":"adb","key":"adb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antony Bowesman","active":true,"timeZone":"Etc/UTC"},"body":"Test cases and log output from the test cases when running the test sequence as described\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adb","name":"adb","key":"adb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antony Bowesman","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-22T23:14:24.606+0000","updated":"2009-03-22T23:14:24.606+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483649/comment/12941047","id":"12941047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adb","name":"adb","key":"adb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antony Bowesman","active":true,"timeZone":"Etc/UTC"},"body":"The broker is the default broker from a standard 5.2.0 installation run from bin/activemq.bat","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adb","name":"adb","key":"adb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antony Bowesman","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-22T23:37:46.354+0000","updated":"2009-03-22T23:37:46.354+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483649/comment/12939281","id":"12939281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"ran the test on trunk, there is still an issue.. attaching the test case in the more integrated form with an embedded broker...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-09T10:40:11.570+0000","updated":"2010-08-09T10:40:11.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483649/comment/14705542","id":"14705542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 3f5cfcf6de7910e52871604c8886f2b0da3084b4 in activemq's branch refs/heads/master from [~tabish121]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=3f5cfcf ]\n\nhttps://issues.apache.org/jira/browse/AMQ-2174\n\nAdd a test case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-08-20T18:52:23.737+0000","updated":"2015-08-20T18:52:23.737+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483649/comment/14705547","id":"14705547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Test case added does not reproduce, changes to durable subs appears to working as expected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-08-20T18:53:52.743+0000","updated":"2015-08-20T18:53:52.743+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2174/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0al6v:"}}