{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483743","self":"https://issues.apache.org/jira/rest/api/2/issue/12483743","key":"AMQ-2488","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321258","id":"12321258","description":"Next v5 maintenance release","name":"5.7.0","archived":false,"released":true,"releaseDate":"2012-10-08"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-11-12T07:36:33.535+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 18 13:56:46 UTC 2012","customfield_12310420":"43794","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5424639732_*|*_5_*:*_2_*:*_8266231491_*|*_4_*:*_1_*:*_76312164451","customfield_12312321":null,"resolutiondate":"2012-09-18T13:56:53.113+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2488/watchers","watchCount":8,"isWatching":false},"created":"2009-11-11T21:06:17.479+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-09-18T13:56:53.152+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have configured applications to use Log4J's JMSAppender in order to log messages on a queue as follows;\n\n{noformat}\nlog4j.appender.jms=org.apache.log4j.net.JMSAppender\nlog4j.appender.jms.InitialContextFactoryName=org.apache.activemq.jndi.ActiveMQInitialContextFactory\nlog4j.appender.jms.ProviderURL=tcp://localhost:61616\nlog4j.appender.jms.TopicBindingName=logTopic\nlog4j.appender.jms.TopicConnectionFactoryBindingName=ConnectionFactory\n{noformat}\n\nEach application logging statement adds a new message to topic://logTopic on the broker.  I have a bundle deployed that attempts to route the messages from this topic with camel;\n\n{code}\nfrom(\"activemq:topic:logTopic\")\n  .convertBodyTo(String.class)\n  .to(\"log:foo?level=DEBUG&showProperties=true&showHeaders=true\");\n{code}\n\nWhen using servicemix 4 (Fuse 4.1.0.4), a stack trace is seen with the following message (enhanced using felix.log.level=4);\n\n\n{noformat}Caused by: java.lang.ClassNotFoundException: *** Class 'org.apache.log4j.spi.LoggingEvent' \nwas not found because bundle 56 does not import 'org.apache.log4j.spi' even though bundle 84 \ndoes export it. To resolve this issue, add an import for 'org.apache.log4j.spi' to bundle 56. ***\n{noformat}\n\nBundles as follows;\n\n{noformat}smx@root:/> osgi/list|grep 56\n[  56] [Active     ] [       ] [   60] activemq-core (5.3.0.fuse)\n\nsmx@root:/> osgi/list|grep 84\n[  84] [Active     ] [       ] [    8] OPS4J Pax Logging - API (1.3.0)\n{noformat}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461568","id":"12461568","filename":"amq-error.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=darren.davison","name":"darren.davison","key":"darren.davison","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-11T21:07:57.652+0000","size":15162,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461568/amq-error.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461570","id":"12461570","filename":"amq-headers.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=darren.davison","name":"darren.davison","key":"darren.davison","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-11T21:07:57.690+0000","size":28722,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461570/amq-headers.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461449","id":"12461449","filename":"SMX4-424.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gertvanthienen","name":"gertvanthienen","key":"gertvanthienen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gertvanthienen&avatarId=16938","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gertvanthienen&avatarId=16938","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gertvanthienen&avatarId=16938","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gertvanthienen&avatarId=16938"},"displayName":"Gert Vanthienen","active":true,"timeZone":"Europe/Berlin"},"created":"2009-11-12T08:19:12.449+0000","size":1649,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461449/SMX4-424.diff"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59617","customfield_12312823":null,"summary":"Unable to access Serializable class when receiving ObjectMessage in OSGi environment","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=darren.davison","name":"darren.davison","key":"darren.davison","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=darren.davison","name":"darren.davison","key":"darren.davison","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/12941530","id":"12941530","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=darren.davison","name":"darren.davison","key":"darren.davison","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"body":"complete stack trace attached in amq-error.log\noutput of OSGi headers for activemq-core bundle attached in amq-headers.log","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=darren.davison","name":"darren.davison","key":"darren.davison","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-11T21:07:57.693+0000","updated":"2009-11-11T21:07:57.693+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/12941366","id":"12941366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mproch","name":"mproch","key":"mproch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mproch&avatarId=26124","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mproch&avatarId=26124","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mproch&avatarId=26124","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mproch&avatarId=26124"},"displayName":"Maciej Prochniak","active":true,"timeZone":"Europe/Warsaw"},"body":"Do  you have this log4j import in your bundle (containing camel route)? I guess the felix debug message (... was not found because ...) can be misleading - I think it should be your camel bundle that imports 'org.apache.log4j.spi' package","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mproch","name":"mproch","key":"mproch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mproch&avatarId=26124","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mproch&avatarId=26124","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mproch&avatarId=26124","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mproch&avatarId=26124"},"displayName":"Maciej Prochniak","active":true,"timeZone":"Europe/Warsaw"},"created":"2009-11-12T07:36:33.535+0000","updated":"2009-11-12T07:36:33.535+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/12941810","id":"12941810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gertvanthienen","name":"gertvanthienen","key":"gertvanthienen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gertvanthienen&avatarId=16938","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gertvanthienen&avatarId=16938","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gertvanthienen&avatarId=16938","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gertvanthienen&avatarId=16938"},"displayName":"Gert Vanthienen","active":true,"timeZone":"Europe/Berlin"},"body":"I think the message on the CNFE is correct: if you look at the stack traces, you'll notice that it's ActiveMQ's ClassLoadingAwareObjectInputStream class that is trying to load the org.apache.log4j.spi.LoggingEvent class.  \n\nWith the current OSGi bundle configuration for activemq-core, it can not access that class.  The easy solution would be to add a dynamic import to the activemq-core bundle as in the attached SMX4-424.diff file.  Another option would be to modify the ClassLoadingAwareObjectInputStream class to use OSGi's FrameworkUtil class to determine the correct classloader.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gertvanthienen","name":"gertvanthienen","key":"gertvanthienen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gertvanthienen&avatarId=16938","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gertvanthienen&avatarId=16938","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gertvanthienen&avatarId=16938","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gertvanthienen&avatarId=16938"},"displayName":"Gert Vanthienen","active":true,"timeZone":"Europe/Berlin"},"created":"2009-11-12T08:19:12.452+0000","updated":"2009-11-12T08:19:12.452+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/12941589","id":"12941589","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gertvanthienen","name":"gertvanthienen","key":"gertvanthienen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gertvanthienen&avatarId=16938","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gertvanthienen&avatarId=16938","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gertvanthienen&avatarId=16938","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gertvanthienen&avatarId=16938"},"displayName":"Gert Vanthienen","active":true,"timeZone":"Europe/Berlin"},"body":"This issue was originally created for ServiceMix 4, but I think the real issue is inside the activemq-core bundle.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gertvanthienen","name":"gertvanthienen","key":"gertvanthienen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gertvanthienen&avatarId=16938","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gertvanthienen&avatarId=16938","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gertvanthienen&avatarId=16938","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gertvanthienen&avatarId=16938"},"displayName":"Gert Vanthienen","active":true,"timeZone":"Europe/Berlin"},"created":"2009-11-12T08:22:27.281+0000","updated":"2009-11-12T08:22:27.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/12941596","id":"12941596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=darren.davison","name":"darren.davison","key":"darren.davison","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"body":"sorry, I thought I'd included those OSGi headers in one of the attachments.  It does import that package.  Here are the headers from my bundle with the camel route (line breaks added by me for formatting)\n\\\\\n\\\\\n{noformat}Application Log Router (75)\n---------------------------\nManifest-Version = 1.0\nBnd-LastModified = 1257721682850\nTool = Bnd-0.0.238\nBundle-Name = Application Log Router\nBuilt-By = darren\nImport-Package = org.apache.activemq;version=\"5.2.0.fuse\",\n  org.apache.camel; version=\"1.6.1.fuse\",\n  org.apache.camel.builder;version=\"1.6.1.fuse\",\n  org.apache.camel.component.jms;version=\"1.6.1.fuse\",\n  org.apache.camel.model;version=\"1.6.1.fuse\",\n  org.apache.camel.spring;version=\"1.6.1.fuse\",\n  org.apache.commons.logging,\n  org.apache.log4j.spi,\n  org.davisononline.fuselogger\nBundle-SymbolicName = org.davisononline.fuse-logger\nExport-Package = org.davisononline.fuselogger;\n  uses:=\"org.apache.camel.builder,org.apache.camel.model,\n    org.apache.commons.logging,org.apache.camel,org.apache.camel.spring\"\nBundle-Version = 0.0.1.SNAPSHOT\nBuild-Jdk = 1.6.0_16\nCreated-By = Apache Maven Bundle Plugin\nBundle-ManifestVersion = 2\n{noformat}\n\\\\\n\\\\\nI queried this all with gertv on IRC, it was he that suggested this looked like an activemq bug and henced raised here.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=darren.davison","name":"darren.davison","key":"darren.davison","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-12T08:23:47.146+0000","updated":"2009-11-12T08:23:47.146+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/12942003","id":"12942003","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Fixed with svn revision 898812","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-01-13T15:56:57.120+0000","updated":"2010-01-13T15:56:57.120+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/12942446","id":"12942446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davisond","name":"davisond","key":"davisond","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"body":"I still appear to get similar issues even with the dynamic import in the manifest:\n\n\n21:35:46,565 | ERROR | tenerContainer-2 | EndpointMessageListener          | rg.apache.camel.processor.Logger  248 | Caused by: [org.apache.camel.RuntimeCamelException - Failed to extract body due to: javax.jms.JMSException: Failed to build body from content. Serializable class not available to broker. Reason: java.lang.ClassNotFoundException: org.apache.log4j.spi.LoggingEvent. Message: ActiveMQObjectMessage {commandId = 5, responseRequired = true, messageId = ID:hepburn-51431-1271622946297-0:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:hepburn-51431-1271622946297-0:0:1:1, destination = topic://logTopic, transactionId = null, expiration = 0, timestamp = 1271622946535, arrival = 0, brokerInTime = 1271622946538, brokerOutTime = 1271622946539, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@13bef50, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false}]\norg.apache.camel.RuntimeCamelException: Failed to extract body due to: javax.jms.JMSException: Failed to build body from content. Serializable class not available to broker. Reason: java.lang.ClassNotFoundException: org.apache.log4j.spi.LoggingEvent. Message: ActiveMQObjectMessage {commandId = 5, responseRequired = true, messageId = ID:hepburn-51431-1271622946297-0:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:hepburn-51431-1271622946297-0:0:1:1, destination = topic://logTopic, transactionId = null, expiration = 0, timestamp = 1271622946535, arrival = 0, brokerInTime = 1271622946538, brokerOutTime = 1271622946539, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@13bef50, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false}\n\tat org.apache.camel.component.jms.JmsBinding.extractBodyFromJms(JmsBinding.java:158)\n\tat org.apache.camel.component.jms.JmsMessage.createBody(JmsMessage.java:183)\n\tat org.apache.camel.impl.MessageSupport.getBody(MessageSupport.java:42)\n\tat org.apache.camel.impl.DefaultUnitOfWork.<init>(DefaultUnitOfWork.java:60)\n\tat org.apache.camel.processor.UnitOfWorkProcessor.processNext(UnitOfWorkProcessor.java:56)\n\tat org.apache.camel.processor.DelegateProcessor.process(DelegateProcessor.java:48)\n\tat org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)\n\tat org.apache.camel.component.jms.EndpointMessageListener.onMessage(EndpointMessageListener.java:84)\n\tat org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:543)\n\tat org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:482)\n\tat org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:451)\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:323)\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:261)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:982)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:974)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:876)\n\tat java.lang.Thread.run(Thread.java:619)\nCaused by: javax.jms.JMSException: Failed to build body from content. Serializable class not available to broker. Reason: java.lang.ClassNotFoundException: org.apache.log4j.spi.LoggingEvent\n\tat org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:35)\n\tat org.apache.activemq.command.ActiveMQObjectMessage.getObject(ActiveMQObjectMessage.java:179)\n\tat org.apache.camel.component.jms.JmsBinding.extractBodyFromJms(JmsBinding.java:125)\n\t... 16 more\nCaused by: java.lang.ClassNotFoundException: org.apache.log4j.spi.LoggingEvent\n\tat org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:468)\n\tat org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:410)\n\tat org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:398)\n\tat org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:105)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:252)\n\tat java.lang.ClassLoader.loadClassInternal(ClassLoader.java:320)\n\tat java.lang.Class.forName0(Native Method)\n\tat java.lang.Class.forName(Class.java:247)\n\tat org.apache.activemq.util.ClassLoadingAwareObjectInputStream.load(ClassLoadingAwareObjectInputStream.java:63)\n\tat org.apache.activemq.util.ClassLoadingAwareObjectInputStream.resolveClass(ClassLoadingAwareObjectInputStream.java:37)\n\tat java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1575)\n\tat java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1496)\n\tat java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1732)\n\tat java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329)\n\tat java.io.ObjectInputStream.readObject(ObjectInputStream.java:351)\n\tat org.apache.activemq.command.ActiveMQObjectMessage.getObject(ActiveMQObjectMessage.java:177)\n\t... 17 more\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davisond","name":"davisond","key":"davisond","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darren Davison","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-19T08:07:28.686+0000","updated":"2010-04-19T08:07:28.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/13000103","id":"13000103","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=computerpunk","name":"computerpunk","key":"computerpunk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PK Tan","active":true,"timeZone":"Asia/Singapore"},"body":"Hi, any updates on this issue ? Is it fixed in version 5.5.0 or will there be any upcoming fix?  \n\nI see a similar stacktrace on my side using activemq version 5.4.2. Is there any other way to verify that I have the same problem on my side other than using the stacktrace?  \n\nFor my case, I've deployed ActiveMQ embedded within WebLogic 10. \n\nThank you for your time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=computerpunk","name":"computerpunk","key":"computerpunk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"PK Tan","active":true,"timeZone":"Asia/Singapore"},"created":"2011-02-28T04:29:28.419+0000","updated":"2011-02-28T04:29:28.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/13054240","id":"13054240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joed","name":"joed","key":"joed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edstrom Johan","active":true,"timeZone":"America/Denver"},"body":"Have confirmed the same on a 5.5 embedded in servicemix 4.0, possible to \nworkaround by doing the serialization yourself and making sure that mapJmsMessage=false in camel.\n\nThe problem is in :\n\nhttps://svn.apache.org/repos/asf/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/util/ClassLoadingAwareObjectInputStream.java\n\nWill try to get a patch together against a 5.5 release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joed","name":"joed","key":"joed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edstrom Johan","active":true,"timeZone":"America/Denver"},"created":"2011-06-24T05:01:39.868+0000","updated":"2011-06-24T05:01:39.868+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/13054249","id":"13054249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"In the camel-sql component there is a JDBC based support for a persistent store for the aggregator EIP. And the serialization logic was a copy of that class mentioned above. We recently had this problem with class loading in OSGi, so we had to use an OSGi aware class loader. So I guess a similar issue exists now in AMQ when running under OSGi.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2011-06-24T06:10:04.139+0000","updated":"2011-06-24T06:10:04.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/13054256","id":"13054256","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joed","name":"joed","key":"joed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edstrom Johan","active":true,"timeZone":"America/Denver"},"body":"The fallback strategy really is the problem.\nI think this whole classloader should be delegated back to the consumer of the object.\n\nThe * dynamic import in a server is a kinda sorta solution to me.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joed","name":"joed","key":"joed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edstrom Johan","active":true,"timeZone":"America/Denver"},"created":"2011-06-24T06:23:08.485+0000","updated":"2011-06-24T06:23:08.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/13054282","id":"13054282","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joed","name":"joed","key":"joed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edstrom Johan","active":true,"timeZone":"America/Denver"},"body":"Just had this confirmed on a non osgi deploy as well.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joed","name":"joed","key":"joed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edstrom Johan","active":true,"timeZone":"America/Denver"},"created":"2011-06-24T07:27:08.523+0000","updated":"2011-06-24T07:27:08.523+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/13257101","id":"13257101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johno","name":"johno","key":"johno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johno Crawford","active":true,"timeZone":"Etc/UTC"},"body":"Any luck with the patch Edstrom?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johno","name":"johno","key":"johno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johno Crawford","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-19T00:04:21.630+0000","updated":"2012-04-19T00:04:21.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/13457782","id":"13457782","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Working on using the classloader from the input stream as fallback.\n\nBut ideally we may have to do as in Camel to have a ClassResover SPI, which can adapt to its environments, standalone, OSGi, jee etc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-18T12:45:41.579+0000","updated":"2012-09-18T12:45:41.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483743/comment/13457827","id":"13457827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Committed a fix to trunk that uses the classloader of the input stream as 2nd fallback. \n\nFell free to give the code on trunk a try.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-18T13:56:46.353+0000","updated":"2012-09-18T13:56:46.353+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2488/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0akn3:"}}