{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13171170","self":"https://issues.apache.org/jira/rest/api/2/issue/13171170","key":"AMQ-7009","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-07-11T12:43:30.452+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jul 26 09:20:25 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7009/watchers","watchCount":3,"isWatching":false},"created":"2018-07-10T14:50:07.601+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12342685","id":"12342685","description":"","name":"5.15.4","archived":false,"released":true,"releaseDate":"2018-05-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-26T09:29:56.149+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have a problem with ActiveMQ 5.15.4, it stop deliver messages to clients.\r\n\r\nThis happens completely randomly and we are not able to give a test case that reproduce the problem\r\n\r\nActivemq is configured to use the « memoryPersistenceAdapter »\r\n\r\n \r\n\r\nWhen examining memory dumps, we identified incoherent situation in the class MemoryMessageStore that can lead to stop delivering messages. When :\r\n - MemoryMessageStore.recoverNextMessages(...) is called\r\n\r\n - « lastBatchId » is not null\r\n\r\n - « messageTable » does not contains any entry with « lastBatchId » as key\r\n\r\nno messages are recovered\r\n\r\n \r\n\r\nWe added logs to try to understand how it is possible to have a non null « lastBatchId » and «  messageTable » with no entry having « lastBatchId » as key.\r\n\r\n \r\n\r\nWe noticed that the method setBatch is called with a non null « messageId » parameter, but no message with this id is inserted in « messageTable ». After that, when the method MemoryMessageStore.recoverNextMessages(...) is called, it does nothing and no messages are recoverd. And the system go in a what looks like an endless loop.\r\n\r\n \r\n\r\nWe are testing a temporary solution by resetting « lastBatchId » to null when the incoherent situation is detected.\r\n\r\n \r\n\r\nCan you help us resolving the problem at the source and not just get around.\r\n\r\nI joined modified source code of the class MemoryMessageStore and an extract of the log file.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12931809","id":"12931809","filename":"activemq.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-16T15:16:08.735+0000","size":97172,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12931809/activemq.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12931803","id":"12931803","filename":"MemoryMessageStore.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-16T14:34:44.504+0000","size":8251,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12931803/MemoryMessageStore.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12933171","id":"12933171","filename":"MemoryMessageStoreQueueCursorTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-26T09:29:55.784+0000","size":5276,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12933171/MemoryMessageStoreQueueCursorTest.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ActiveMQ stop delivering messages","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171170/comment/16540036","id":"16540036","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The version you are using is old an not a supported release, please upgrade to the latest release and then report back if the problem persists.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2018-07-11T12:43:30.452+0000","updated":"2018-07-11T12:43:30.452+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171170/comment/16545272","id":"16545272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"body":"We have done the upgrade to the latest version 5.15.4 and the problem does persist. So I updated the description of the problem above.\r\n\r\nIn attachement, the new version of the class modified to generate some helpful logs.\r\n\r\n[^MemoryMessageStore.java]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-16T14:44:46.065+0000","updated":"2018-07-16T15:02:27.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171170/comment/16545338","id":"16545338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=realitix","name":"realitix","key":"realitix","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=realitix&avatarId=34513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=realitix&avatarId=34513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=realitix&avatarId=34513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=realitix&avatarId=34513"},"displayName":"Jean-Sébastien BEVILACQUA","active":true,"timeZone":"Etc/UTC"},"body":"Hello [~tabish121],\r\n\r\nI encounter the same problem as Nezih on the last version too.\r\n\r\nThanks,\r\nJean-Sébastien","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=realitix","name":"realitix","key":"realitix","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=realitix&avatarId=34513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=realitix&avatarId=34513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=realitix&avatarId=34513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=realitix&avatarId=34513"},"displayName":"Jean-Sébastien BEVILACQUA","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-16T15:27:00.583+0000","updated":"2018-07-16T15:27:00.583+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171170/comment/16545355","id":"16545355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You should work on providing a unit test to reproduce the issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2018-07-16T15:32:58.150+0000","updated":"2018-07-16T15:32:58.150+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171170/comment/16546177","id":"16546177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"body":"Hello [~tabish121],\r\n\r\nUnfortunately, we already spent a lot of time trying to understand why AMQ stop deliver messages, and we don't have resources and time to do more analysis (The problam has began 3 years ago).\r\n\r\nWe should get by, by uncommenting the line 135 of the method \"recoverNextMessages(...)\".\r\n\r\n \r\n\r\nThanks,\r\n\r\nNezih\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-17T08:23:36.070+0000","updated":"2018-07-17T08:23:36.070+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171170/comment/16555745","id":"16555745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"body":"In attachment, a unit test reproducing the issue.[^MemoryMessageStoreQueueCursor.java].\r\n\r\nTo make the memoryMessageStore more robust we can modify methods setBatch and recoverNextMessages as follow :\r\n\r\n    @Override\r\n    public void setBatch(MessageId messageId) {\r\n        synchronized (messageTable) {\r\n            lastBatchId = messageId;\r\n            if(!messageTable.containsKey(lastBatchId)) {\r\n                lastBatchId = null;\r\n            }\r\n        }\r\n    }\r\n\r\n \r\n\r\n    @Override\r\n    public void recoverNextMessages(int maxReturned, MessageRecoveryListener listener) throws Exception {\r\n        synchronized (messageTable) {\r\n            boolean containsLastBatchId = messageTable.containsKey(lastBatchId);\r\n            if(!containsLastBatchId) {\r\n                lastBatchId = null;\r\n            }\r\n            \r\n            boolean pastLackBatch = lastBatchId == null;\r\n            for (Map.Entry<MessageId, Message> entry : messageTable.entrySet()) {\r\n                if (pastLackBatch) {\r\n                    Object msg = entry.getValue();\r\n                    lastBatchId = entry.getKey();\r\n                    if (msg.getClass() == MessageId.class) {\r\n                        listener.recoverMessageReference((MessageId) msg);\r\n                    } else {\r\n                        listener.recoverMessage((Message) msg);\r\n                    }\r\n                } else {\r\n                    pastLackBatch = entry.getKey().equals(lastBatchId);\r\n                }\r\n            }\r\n        }\r\n    }","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-25T14:21:07.707+0000","updated":"2018-07-25T14:21:07.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171170/comment/16558093","id":"16558093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"body":"Explanation :\r\nwhen activating TRACE level logs for the class \"AbstractStoreCursor\", I noticed the next two lines in the log file :\r\n\r\n2018-07-18 12:02:06,136 | TRACE | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@3a5f8f9a:retour.event.box4,batchResetNeeded=false,size=0,cacheEnabled=true,maxBatchSize:1,hasSpace:false,pendingCachedIds.size:0,lastSyncCachedId:ID:vhqve41.pprod.helios.cp-54155-1531902423423-1:10:2:1:282,lastSyncCachedId-seq:75,lastAsyncCachedId:null,lastAsyncCachedId-seq:null,store=org.apache.activemq.store.memory.MemoryMessageStore@349876a1 - disabling cache on add ID:vhqve41.pprod.helios.cp-54155-1531902423423-1:3:1:1:370 76 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ Transport: tcp:///174.4.111.217:35610@6666\r\n2018-07-18 12:02:06,136 | WARN  | @@@NBF@@@ setBatch called with param messageId : (ID:vhqve41.pprod.helios.cp-54155-1531902423423-1:10:2:1:282). lastBatchId : (null) the new lastBatchId : (ID:vhqve41.pprod.helios.cp-54155-1531902423423-1:10:2:1:282) is NOT in messageTable | org.apache.activemq.store.memory.MemoryMessageStore | ActiveMQ Transport: tcp:///174.4.111.217:35610@6666\r\n\r\nThe second line shows that setBatch is called with a parameter \"messageId\" corresponding to a probably old message that is already removed from store.\r\nThe first line shows that just befor calling setBatch, we had (hasSpace:false while size=0) which mean : there is no messages in the queue but there is no free space too !!!.\r\nIt seems like messages are consumed but their space is not rendered or not yet rendered at that moment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nezih","name":"nezih","key":"nezih","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nezih&avatarId=36148","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nezih&avatarId=36148","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nezih&avatarId=36148","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nezih&avatarId=36148"},"displayName":"Nezih BEN FREDJ","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-26T09:20:25.497+0000","updated":"2018-07-26T09:20:25.497+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7009/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3vq8n:"}}