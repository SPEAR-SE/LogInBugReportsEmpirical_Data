{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12518731","self":"https://issues.apache.org/jira/rest/api/2/issue/12518731","key":"AMQ-3448","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2011-08-12T20:22:49.118+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Oct 13 14:42:47 UTC 2011","customfield_12310420":"43954","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4765809578_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-10-06T23:19:47.002+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3448/watchers","watchCount":1,"isWatching":false},"created":"2011-08-12T19:29:37.481+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-10-13T14:42:47.243+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Somehow linked to https://issues.apache.org/jira/browse/AMQ-3286 which was closed. I am opening here as I cannot reopen the old bug and I hope that with the information I provide here, someone will be able to have some insight of the possible cause and a fix.\n\nI don't know how to reproduce with a test case, but I have found 800+ of such \"ActiveMQ Connection Dispatcher\" threads. I also noted that the number of FDs for the process keeps increasing and after a few days, we have a \"too many files opened\" when going beyond the 1024 limit. Most of those FDs (hundreds) do look like:\n\njava 6700 lexo-ext 904u sock 0,5 1741176200 can't identify protocol\n\nThere is not much activity on the system and that is still enough to get the problem.\n\nWhen we reach the limit of FDs, we get tons of stack traces in the logs, filling up the hard disk...\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"119677","customfield_12312823":null,"summary":"Zombie ActiveMQ Connection Dispatcher threads - seems to consume all process File Descriptors (FD leak)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Active MQ 5.3.2\n\njava version \"1.6.0_23\"\nJava(TM) SE Runtime Environment (build 1.6.0_23-b05)\nJava HotSpot(TM) Server VM (build 19.0-b09, mixed mode)\n\nLSB Version: :core-3.1-amd64:core-3.1-ia32:core-3.1-noarch:graphics-3.1-amd64:graphics-3.1-ia32:graphics-3.1-noarch\nDistributor ID: CentOS\nDescription: CentOS release 5.5 (Final)\nRelease: 5.5\nCodename: Final\n\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13084316","id":"13084316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"In the logs, I also found messages like this (I don't know if there is a correlation between that message, the number of threads and the number of FDs being consumed):\n\nWARN | Failed to register MBean: org.apache.activemq:BrokerName=localhost,Type=Connection,ConnectorName=openwire,ViewType=address,Name=/192.168.235.8_63370\n\nIt does NOT seemed to me that as soon as a new log entry like that one was showing up, a new FD was consumed, but again, this could be valuable information.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-12T19:30:41.817+0000","updated":"2011-08-12T19:30:41.817+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13084317","id":"13084317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Here is a dump of all activemq live objects in the JVM:\n\njmap -histo:live 6700 | grep activemq\n1: 1640 105894928 [Lorg.apache.activemq.command.DataStructure;\n26: 818 124336 org.apache.activemq.broker.jmx.ManagedTransportConnection\n28: 818 111248 org.apache.activemq.transport.tcp.TcpTransport\n33: 839 93968 org.apache.activemq.thread.DedicatedTaskRunner$1\n35: 1816 87168 org.apache.activemq.management.CountStatisticImpl\n36: 818 85072 org.apache.activemq.transport.InactivityMonitor\n39: 1747 69880 org.apache.activemq.command.ProducerId\n43: 1941 62112 org.apache.activemq.command.SessionId\n46: 1722 55104 org.apache.activemq.command.LocalTransactionId\n49: 820 45920 org.apache.activemq.openwire.OpenWireFormat\n50: 818 45808 org.apache.activemq.broker.region.ConnectionStatistics\n51: 2776 44416 org.apache.activemq.command.ConnectionId\n53: 1046 41840 org.apache.activemq.command.ConsumerId\n57: 818 39264 org.apache.activemq.transport.WireFormatNegotiator\n71: 831 26592 org.apache.activemq.command.WireFormatInfo\n75: 818 26176 org.apache.activemq.transport.tcp.TcpTransport$2\n76: 818 26176 org.apache.activemq.transport.tcp.TcpBufferedOutputStream\n83: 839 20136 org.apache.activemq.thread.DedicatedTaskRunner\n85: 822 19728 org.apache.activemq.util.ByteSequence\n86: 821 19704 org.apache.activemq.util.DataByteArrayInputStream\n88: 818 19632 org.apache.activemq.transport.InactivityMonitor$1\n89: 818 19632 org.apache.activemq.transport.InactivityMonitor$2\n90: 818 19632 org.apache.activemq.transport.MutexTransport\n104: 821 13136 org.apache.activemq.util.DataByteArrayOutputStream\n108: 818 13088 org.apache.activemq.broker.TransportConnection$1\n109: 818 13088 org.apache.activemq.broker.jmx.ConnectionView\n110: 818 13088 org.apache.activemq.broker.SingleTransportConnectionStateRegister\n132: 160 5120 org.apache.activemq.util.BitArrayBin\n133: 317 5072 org.apache.activemq.broker.jmx.AnnotatedMBean\n141: 1 4112 [Lorg.apache.activemq.command.ConsumerId;\n144: 160 3840 org.apache.activemq.util.BitArray\n158: 86 2752 org.apache.activemq.filter.DestinationMapNode\n168: 60 2400 org.apache.activemq.command.ActiveMQTopic\n174: 24 2112 org.apache.activemq.command.ConsumerInfo\n179: 22 1936 org.apache.activemq.broker.region.DestinationStatistics\n182: 14 1904 org.apache.activemq.broker.region.Topic\n186: 22 1760 org.apache.activemq.management.TimeStatisticImpl\n187: 31 1736 org.apache.activemq.util.LRUCache\n190: 40 1600 org.apache.activemq.thread.SchedulerTimerTask\n191: 20 1600 org.apache.activemq.broker.region.cursors.FilePendingMessageCursor\n192: 22 1584 org.apache.activemq.usage.MemoryUsage\n198: 26 1456 org.apache.activemq.command.ConnectionInfo\n201: 22 1408 org.apache.activemq.usage.TempUsage\n202: 22 1408 org.apache.activemq.usage.StoreUsage\n203: 7 1400 org.apache.activemq.broker.region.Queue\n215: 11 1232 org.apache.activemq.broker.region.QueueSubscription\n223: 13 1144 org.apache.activemq.broker.region.TopicSubscription\n227: 23 1104 org.apache.activemq.management.PollCountStatisticImpl\n229: 22 1056 org.apache.activemq.usage.SystemUsage\n231: 66 1056 org.apache.activemq.usage.DefaultUsageCapacity\n235: 1 1040 [Lorg.apache.activemq.openwire.DataStreamMarshaller;\n240: 13 936 org.apache.activemq.broker.ConnectionContext\n249: 22 880 org.apache.activemq.command.ActiveMQQueue\n252: 26 832 org.apache.activemq.command.SessionInfo\n259: 7 784 org.apache.activemq.broker.region.Queue$FlowControlTimeoutTask\n265: 31 744 org.apache.activemq.ActiveMQMessageAudit\n282: 26 624 org.apache.activemq.state.SessionState\n287: 13 624 org.apache.activemq.broker.TransportConnectionState\n292: 37 592 org.apache.activemq.filter.SimpleDestinationFilter\n301: 11 528 org.apache.activemq.broker.region.cursors.VMPendingMessageCursor\n303: 7 504 org.apache.activemq.broker.region.cursors.StoreQueueCursor\n304: 7 504 org.apache.activemq.broker.region.cursors.QueueStorePrefetch\n329: 24 384 org.apache.activemq.state.ConsumerState\n336: 7 336 org.apache.activemq.command.DestinationInfo\n338: 7 336 org.apache.activemq.store.kahadb.MessageDatabase$StoredDestination\n341: 14 336 [Lorg.apache.activemq.command.ActiveMQDestination;\n342: 14 336 org.apache.activemq.thread.Valve\n348: 13 312 [Lorg.apache.activemq.filter.DestinationFilter;\n350: 13 312 org.apache.activemq.filter.MessageEvaluationContext\n374: 1 248 org.apache.activemq.xbean.XBeanBrokerService\n390: 7 224 org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore\n391: 14 224 org.apache.activemq.broker.jmx.TopicView\n394: 14 224 org.apache.activemq.broker.region.Topic$1\n400: 13 208 org.apache.activemq.filter.CompositeDestinationFilter\n401: 13 208 org.apache.activemq.filter.NoLocalExpression\n402: 13 208 org.apache.activemq.broker.region.policy.OldestMessageEvictionStrategy\n406: 13 208 org.apache.activemq.broker.jmx.TopicSubscriptionView\n409: 5 200 org.apache.activemq.command.MessageId\n415: 6 192 org.apache.activemq.broker.ConsumerBrokerExchange\n420: 8 192 org.apache.activemq.store.kahadb.data.KahaEntryType\n432: 1 176 org.apache.activemq.command.ActiveMQMessage\n435: 11 176 org.apache.activemq.broker.jmx.SubscriptionView\n438: 7 168 org.apache.activemq.store.kahadb.data.KahaDestination\n451: 2 160 org.apache.activemq.kaha.impl.index.IndexItem\n457: 1 152 org.apache.activemq.broker.region.policy.PolicyEntry\n459: 1 144 org.apache.activemq.broker.jmx.ManagedRegionBroker\n469: 1 136 org.apache.activemq.transport.tcp.TcpTransportServer\n494: 1 120 org.apache.activemq.store.kahadb.KahaDBStore\n497: 1 120 org.apache.activemq.ActiveMQConnectionFactory\n508: 7 112 org.apache.activemq.broker.jmx.QueueView\n509: 1 112 org.apache.activemq.console.command.StartCommand$1\n514: 1 112 org.apache.activemq.store.kahadb.MessageDatabase$3\n518: 7 112 org.apache.activemq.broker.region.Queue$1\n519: 7 112 org.apache.activemq.broker.region.Queue$2\n521: 7 112 org.apache.activemq.broker.region.Queue$3\n523: 7 112 org.apache.activemq.broker.region.QueueDispatchSelector\n524: 14 112 org.apache.activemq.broker.region.policy.SimpleDispatchPolicy\n527: 1 112 org.apache.activemq.broker.BrokerService$4\n528: 14 112 org.apache.activemq.broker.region.policy.NoSubscriptionRecoveryPolicy\n535: 2 96 org.apache.activemq.command.ProducerInfo\n557: 4 96 org.apache.activemq.store.kahadb.data.KahaDestination$DestinationType\n573: 1 88 org.apache.activemq.web.AjaxServlet\n582: 1 80 org.apache.activemq.web.MessageServlet\n584: 5 80 org.apache.activemq.filter.DestinationMap\n587: 1 80 org.apache.activemq.broker.jmx.ManagedTransportConnector\n594: 1 80 org.apache.activemq.broker.jmx.ManagedTempQueueRegion\n599: 1 80 org.apache.activemq.broker.jmx.ManagedTempTopicRegion\n613: 1 72 org.apache.activemq.kaha.impl.index.IndexManager\n616: 1 72 org.apache.activemq.kaha.impl.KahaStore\n617: 1 72 org.apache.activemq.broker.jmx.ManagedTopicRegion\n636: 2 64 org.apache.activemq.thread.TaskRunnerFactory\n638: 1 64 org.apache.activemq.web.handler.BindingBeanNameUrlHandlerMapping\n642: 1 64 org.apache.activemq.broker.jmx.ManagementContext\n653: 2 64 org.apache.activemq.kaha.impl.IndexRootContainer\n660: 1 64 org.apache.activemq.broker.region.ConnectorStatistics\n667: 1 64 org.apache.activemq.command.BrokerInfo\n671: 2 64 org.apache.activemq.broker.ProducerBrokerExchange\n674: 1 56 org.apache.activemq.broker.jmx.ManagedQueueRegion\n685: 1 56 org.apache.activemq.kaha.impl.data.DataManagerImpl\n689: 7 56 org.apache.activemq.broker.region.policy.RoundRobinDispatchPolicy\n703: 3 48 org.apache.activemq.util.FactoryFinder\n707: 2 48 org.apache.activemq.console.command.ShellCommand\n730: 2 48 org.apache.activemq.util.IdGenerator\n733: 1 48 [Lorg.apache.activemq.store.kahadb.data.KahaEntryType;\n760: 3 48 org.apache.activemq.util.LongSequenceGenerator\n761: 1 48 org.apache.activemq.management.JMSStatsImpl\n772: 1 40 org.apache.activemq.RedeliveryPolicy\n778: 1 40 org.apache.activemq.openwire.OpenWireFormatFactory\n788: 1 40 org.apache.activemq.advisory.AdvisoryBroker\n821: 1 40 org.apache.activemq.ActiveMQPrefetchPolicy\n822: 2 32 org.apache.activemq.state.ProducerState\n830: 1 32 org.apache.activemq.blob.BlobTransferPolicy\n854: 1 32 org.apache.activemq.console.command.StartCommand\n871: 1 32 [Lorg.apache.activemq.store.kahadb.data.KahaDestination$DestinationType;\n882: 1 32 org.apache.activemq.store.kahadb.MessageDatabase$Metadata\n902: 1 32 org.apache.activemq.console.Main\n911: 1 24 org.apache.activemq.web.filter.ApplicationContextFilter\n915: 1 24 org.apache.activemq.web.filter.ApplicationContextFilter$1\n924: 1 24 org.apache.activemq.web.SessionPool\n926: 1 24 org.apache.activemq.console.command.StartCommand$2\n927: 1 24 org.apache.activemq.kaha.impl.index.StoreIndexReader\n928: 1 24 org.apache.activemq.kaha.impl.index.StoreIndexWriter\n929: 1 24 org.apache.activemq.broker.region.DestinationFactoryImpl\n933: 1 24 org.apache.activemq.security.SecurityContext$1\n949: 1 24 org.apache.activemq.broker.region.policy.PolicyMap\n950: 1 24 org.apache.activemq.broker.region.virtual.VirtualTopic\n957: 1 24 org.apache.activemq.broker.region.policy.IndividualDeadLetterStrategy\n979: 1 24 org.apache.activemq.broker.BrokerService$3\n983: 1 24 org.apache.activemq.util.DefaultIOExceptionHandler\n988: 1 24 org.apache.activemq.broker.jmx.BrokerView\n989: 1 24 org.apache.activemq.broker.TransactionBroker\n992: 1 16 org.apache.activemq.store.kahadb.KahaDBStore$1\n994: 1 16 org.apache.activemq.store.kahadb.MessageDatabase$StoredDestinationMarshaller\n1001: 1 16 org.apache.activemq.broker.BrokerRegistry\n1019: 1 16 org.apache.activemq.util.LogWriterFinder\n1026: 1 16 org.apache.activemq.broker.CompositeDestinationBroker\n1036: 1 16 org.apache.activemq.broker.region.group.MessageGroupHashBucket\n1038: 1 16 org.apache.activemq.util.FactoryFinder$StandaloneObjectFactory\n1041: 1 16 org.apache.activemq.console.CommandContext\n1046: 1 16 org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter\n1053: 1 16 org.apache.activemq.broker.region.virtual.VirtualDestinationInterceptor\n1056: 1 16 org.apache.activemq.console.formatter.CommandShellOutputFormatter\n1061: 1 16 [Lorg.apache.activemq.broker.region.DestinationInterceptor;\n1062: 1 16 [Lorg.apache.activemq.broker.region.virtual.VirtualDestination;\n1065: 1 16 org.apache.activemq.broker.region.policy.SharedDeadLetterStrategy\n1067: 1 16 org.apache.activemq.broker.region.CompositeDestinationInterceptor\n1088: 1 16 org.apache.activemq.kaha.CommandMarshaller\n1107: 1 16 org.apache.activemq.thread.Scheduler\n1109: 1 16 org.apache.activemq.broker.jmx.ConnectorView\n1114: 1 16 [Lorg.apache.activemq.command.BrokerInfo;\n1120: 1 16 org.apache.activemq.broker.TransportConnector$1\n1123: 1 16 org.apache.activemq.transport.tcp.TcpTransportServer$1\n1124: 1 16 org.apache.activemq.broker.region.group.MessageGroupHashBucketFactory\n1127: 1 16 org.apache.activemq.store.kahadb.MessageDatabase$MetadataMarshaller\n1128: 1 16 org.apache.activemq.xbean.XBeanBrokerService$1\n1134: 1 16 org.apache.activemq.command.BrokerId\n1156: 1 16 org.apache.activemq.broker.region.NullMessageReference\n1162: 1 8 org.apache.activemq.openwire.v5.ConnectionIdMarshaller\n1167: 1 8 org.apache.activemq.openwire.v5.LocalTransactionIdMarshaller\n1171: 1 8 org.apache.activemq.kaha.impl.index.RedoStoreIndexItem$1\n1174: 1 8 org.apache.activemq.openwire.v5.ConnectionInfoMarshaller\n1179: 1 8 org.apache.activemq.openwire.v5.MessageAckMarshaller\n1186: 1 8 org.apache.activemq.web.SessionFilter\n1191: 1 8 org.apache.activemq.openwire.v5.ConsumerControlMarshaller\n1196: 1 8 org.apache.activemq.openwire.v5.MessageDispatchMarshaller\n1200: 1 8 org.apache.activemq.openwire.v5.ConsumerIdMarshaller\n1204: 1 8 org.apache.activemq.ActiveMQConnectionMetaData\n1208: 1 8 org.apache.activemq.openwire.v5.MessageDispatchNotificationMarshaller\n1216: 1 8 org.apache.activemq.openwire.v5.MessageIdMarshaller\n1219: 1 8 org.apache.activemq.openwire.v5.ConsumerInfoMarshaller\n1223: 1 8 org.apache.activemq.openwire.v5.MessagePullMarshaller\n1226: 1 8 org.apache.activemq.openwire.v5.ControlCommandMarshaller\n1228: 1 8 org.apache.activemq.transport.InactivityMonitor$5\n1229: 1 8 org.apache.activemq.openwire.v5.ActiveMQMessageMarshaller\n1230: 1 8 org.apache.activemq.broker.region.group.EmptyMessageGroupSet\n1233: 1 8 org.apache.activemq.openwire.v5.ActiveMQBlobMessageMarshaller\n1235: 1 8 org.apache.activemq.openwire.v5.NetworkBridgeFilterMarshaller\n1244: 1 8 org.apache.activemq.openwire.v5.ResponseMarshaller\n1247: 1 8 org.apache.activemq.openwire.v5.DataArrayResponseMarshaller\n1248: 1 8 org.apache.activemq.openwire.v5.ProducerAckMarshaller\n1249: 1 8 org.apache.activemq.transport.tcp.TcpTransportFactory\n1251: 1 8 org.apache.activemq.openwire.v5.ActiveMQBytesMessageMarshaller\n1253: 1 8 org.apache.activemq.usage.Usage$3\n1262: 1 8 org.apache.activemq.openwire.v5.DataResponseMarshaller\n1263: 1 8 org.apache.activemq.openwire.v5.ProducerIdMarshaller\n1265: 1 8 org.apache.activemq.openwire.v5.ActiveMQMapMessageMarshaller\n1275: 1 8 org.apache.activemq.openwire.v5.ActiveMQObjectMessageMarshaller\n1277: 1 8 org.apache.activemq.openwire.v5.DestinationInfoMarshaller\n1278: 1 8 org.apache.activemq.openwire.v5.ProducerInfoMarshaller\n1279: 1 8 org.apache.activemq.store.kahadb.MessageDatabase$MessageKeysMarshaller\n1280: 1 8 org.apache.activemq.kaha.BytesMarshaller\n1283: 1 8 org.apache.activemq.kaha.ObjectMarshaller\n1285: 1 8 org.apache.activemq.openwire.v5.DiscoveryEventMarshaller\n1288: 1 8 org.apache.activemq.openwire.v5.RemoveInfoMarshaller\n1293: 1 8 org.apache.activemq.openwire.v5.ActiveMQQueueMarshaller\n1294: 1 8 org.apache.activemq.kaha.StringMarshaller\n1295: 1 8 org.apache.activemq.command.ActiveMQMessage$1\n1297: 1 8 org.apache.activemq.openwire.v5.ExceptionResponseMarshaller\n1300: 1 8 org.apache.activemq.command.ActiveMQMessage$2\n1303: 1 8 org.apache.activemq.openwire.v5.RemoveSubscriptionInfoMarshaller\n1306: 1 8 org.apache.activemq.openwire.v5.ActiveMQStreamMessageMarshaller\n1307: 1 8 org.apache.activemq.command.ActiveMQMessage$3\n1310: 1 8 org.apache.activemq.kaha.MessageIdMarshaller\n1311: 1 8 org.apache.activemq.web.WebConsoleStarter\n1312: 1 8 org.apache.activemq.openwire.v5.FlushCommandMarshaller\n1314: 1 8 org.apache.activemq.command.ActiveMQMessage$4\n1316: 1 8 org.apache.activemq.openwire.v5.ReplayCommandMarshaller\n1318: 1 8 org.apache.activemq.command.ActiveMQMessage$5\n1319: 1 8 org.apache.activemq.openwire.v5.IntegerResponseMarshaller\n1321: 1 8 org.apache.activemq.openwire.v5.ActiveMQTempQueueMarshaller\n1324: 1 8 org.apache.activemq.command.ActiveMQMessage$6\n1325: 1 8 org.apache.activemq.openwire.v5.SessionIdMarshaller\n1327: 1 8 org.apache.activemq.command.ActiveMQMessage$7\n1329: 1 8 org.apache.activemq.openwire.v5.ActiveMQTempTopicMarshaller\n1330: 1 8 org.apache.activemq.openwire.v5.JournalQueueAckMarshaller\n1332: 1 8 org.apache.activemq.broker.region.Queue$4\n1337: 1 8 org.apache.activemq.command.ActiveMQMessage$8\n1339: 1 8 org.apache.activemq.openwire.v5.SessionInfoMarshaller\n1342: 1 8 org.apache.activemq.openwire.v5.ActiveMQTextMessageMarshaller\n1343: 1 8 org.apache.activemq.command.ActiveMQMessage$9\n1346: 1 8 org.apache.activemq.openwire.v5.JournalTopicAckMarshaller\n1347: 1 8 org.apache.activemq.openwire.v5.ShutdownInfoMarshaller\n1349: 1 8 org.apache.activemq.command.ActiveMQMessage$10\n1350: 1 8 org.apache.activemq.openwire.v5.ActiveMQTopicMarshaller\n1352: 1 8 org.apache.activemq.command.ActiveMQMessage$11\n1357: 1 8 org.apache.activemq.openwire.v5.JournalTraceMarshaller\n1359: 1 8 org.apache.activemq.openwire.v5.SubscriptionInfoMarshaller\n1360: 1 8 org.apache.activemq.openwire.v5.BrokerIdMarshaller\n1367: 1 8 org.apache.activemq.openwire.v5.JournalTransactionMarshaller\n1368: 1 8 org.apache.activemq.ActiveMQConnectionFactory$1\n1369: 1 8 org.apache.activemq.openwire.v5.TransactionInfoMarshaller\n1371: 1 8 org.apache.activemq.openwire.v5.BrokerInfoMarshaller\n1372: 1 8 org.apache.activemq.openwire.v5.KeepAliveInfoMarshaller\n1374: 1 8 org.apache.activemq.openwire.v5.WireFormatInfoMarshaller\n1378: 1 8 org.apache.activemq.transport.tcp.TcpTransport$3\n1379: 1 8 org.apache.activemq.openwire.v5.ConnectionControlMarshaller\n1381: 1 8 org.apache.activemq.openwire.v5.XATransactionIdMarshaller\n1385: 1 8 org.apache.activemq.openwire.v5.PartialCommandMarshaller\n1387: 1 8 org.apache.activemq.openwire.v5.LastPartialCommandMarshaller\n1390: 1 8 org.apache.activemq.openwire.v5.ConnectionErrorMarshaller\n1392: 1 8 org.apache.activemq.store.kahadb.MessageDatabase$LocationMarshaller\n\n/usr/sbin/lsof -p 6700 | grep \"can't identify\" | wc -l\n797\n\njstack 6700 | grep \"nid=\" | grep \"ActiveMQ Connection Dispatcher\" | wc -l\n818\n\nI can't see why I should have 818 ActiveMQ Connection Dispatcher threads running with their corresponding objects in the JVM. Could they be stuck there?\n\n\"ActiveMQ Connection Dispatcher: /172.30.210.39:38631\" daemon prio=10 tid=0x09ef8c00 nid=0x1b12 in Object.wait() [0xce3c7000]\njava.lang.Thread.State: WAITING (on object monitor)\nat java.lang.Object.wait(Native Method)\n\n■waiting on <0xd47f5080> (a java.lang.Object)\nat java.lang.Object.wait(Object.java:485)\nat org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:105)\n■locked <0xd47f5080> (a java.lang.Object)\nat org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\n\"ActiveMQ Connection Dispatcher: /172.30.210.39:38632\" daemon prio=10 tid=0x09efa400 nid=0x1b15 in Object.wait() [0xce4ba000]\njava.lang.Thread.State: WAITING (on object monitor)\nat java.lang.Object.wait(Native Method)\n\n■waiting on <0xd480c968> (a java.lang.Object)\nat java.lang.Object.wait(Object.java:485)\nat org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:105)\n■locked <0xd480c968> (a java.lang.Object)\nat org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-12T19:31:11.911+0000","updated":"2011-08-12T19:31:11.911+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13084318","id":"13084318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"To contrast, I have only 15 ActiveMQ Transport threads like this one:\n\n~/activemq/apache-activemq-5.3.2/logs$ jstack 6700 | grep \"nid=\" | grep \"ActiveMQ Transport\" | wc -l\n15\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-12T19:31:33.840+0000","updated":"2011-08-12T19:31:33.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13084319","id":"13084319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"It seems every time a new ActiveMQ Connection Dispatcher thread become \"zombie\", that a file descriptor is held for an indefinite time, leading to the consumption of all FDs eventually (or all RAM/Permgen available as ...)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-12T19:31:43.819+0000","updated":"2011-08-12T19:31:43.819+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13084324","id":"13084324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"It seems to me like there is a race condition making some ActiveMQ Connection Dispatcher threads hang (waiting for something that never occurs), which keep an FD open forever. Connections are made normally at the other end (the AMQ client does not show ERRORs but a few (one in two days) \n\n2011-08-10 10:41:00,334 WARN  [org.apache.activemq.transport.failover.FailoverTransport] (InactivityMonitor Async Task: java.util.co\nncurrent.ThreadPoolExecutor$Worker@1fdd357) Transport failed to tcp://host:port , attempting to automatically reconnect\ndue to: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too long: host/ip:port\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-12T19:40:00.916+0000","updated":"2011-08-12T19:40:00.916+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13084325","id":"13084325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Also, we see all FDs consumed with lsof, but none of them shows up with netstat -an","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-12T19:41:23.152+0000","updated":"2011-08-12T19:41:23.152+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13084352","id":"13084352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Have you tested with a newer version, 5.3.2 is a bit old, I'd recommend you try 5.5 or the latest 5.6-SNAPSHOT build.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-08-12T20:22:49.118+0000","updated":"2011-08-12T20:22:49.118+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13092882","id":"13092882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Hi, no we have not tested with latest version as we cannot upgrade quickly to latest versions (production setup).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-29T14:54:18.927+0000","updated":"2011-08-29T14:54:18.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13093810","id":"13093810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"One thing important to note, is that among the various connections made against this AMQ server, one of them is subject to a firewall and I suspect that the firewall closes unused connections after a while, but that AMQ does not handle well the closing of the connection by the firewall. What do you think of that possibility?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-30T15:23:19.689+0000","updated":"2011-08-30T15:23:19.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13100358","id":"13100358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Seems too like the host from where the leaking threads/connections come from is creating a connection \neverysecond or so. Could it be the problem? From the dev team, I obtained the \"spring\" config:\n\n<!-- ActiveMQ connection factory -->\n<bean id=\"activemqConnectionFactory\" class=\"org.apache.activemq.ActiveMQConnectionFactory\">\n<property name=\"brokerURL\" value=\"failover${JmsQueueManager.brokerUrl})?startupMaxReconnectAttempts=1\"/>\n<property name=\"redeliveryPolicy\" ref=\"redeliveryPolicy\"/>\n<property name=\"prefetchPolicy\" ref=\"activemqPrefetchPolicy\"/>\n<property name=\"userName\" value=\"${JmsQueueManager.userName}\"/>\n<property name=\"password\" value=\"${JmsQueueManager.password.encrypted}\"/>\n</bean>\n\n<bean id=\"redeliveryPolicy\" class=\"org.apache.activemq.RedeliveryPolicy\">\n<property name=\"maximumRedeliveries\" value=\"0\"/>\n</bean>\n\n<bean id=\"activemqPrefetchPolicy\" class=\"org.apache.activemq.ActiveMQPrefetchPolicy\">\n<property name=\"queuePrefetch\" value=\"1\"/>\n</bean>\n\n<bean id=\"pooledConnectionFactory\" class=\"org.apache.activemq.pool.PooledConnectionFactory\" destroy-method=\"stop\">\n<property name=\"connectionFactory\" ref=\"activemqConnectionFactory\"/>\n</bean>\n\n<!-- Message listener for the ticketing queue -->\n<bean id=\"tktMessageListener\" class=\"com.xyz.rex.broker.jms.TktMessageListener\"/>\n\n<bean id=\"transactionManager\" class=\"org.springframework.transaction.jta.JtaTransactionManager\"/>\n\n<!-- Container for the ticketing queue -->\n<bean id=\"tktJmsContainer\" class=\"org.springframework.jms.listener.DefaultMessageListenerContainer\">\n<property name=\"connectionFactory\" ref=\"pooledConnectionFactory\"/>\n<property name=\"destinationName\" value=\"${JmsQueueManager.ticketingQueue.name}\"/>\n<property name=\"messageListener\" ref=\"tktMessageListener\"/>\n<property name=\"recoveryInterval\" value=\"${JmsQueueManager.connectionRetryInterval}\"/>\n<property name=\"transactionManager\" ref=\"transactionManager\"/>\n</bean>\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-08T14:43:07.331+0000","updated":"2011-09-08T14:43:07.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13100431","id":"13100431","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"More info. I found that the IP addresses that were seen by AMQ had no hostname information available. Could it be the source of the problem, in relation with errors like these ones:\n\n\n WARN | Failed to register MBean: org.apache.activemq:BrokerName=localhost,Type=Connection,ConnectorName=openwire,ViewType=address,Name=/192.168.235.7_55843\n WARN | Failed to register MBean: org.apache.activemq:BrokerName=localhost,Type=Connection,ConnectorName=openwire,ViewType=address,Name=/192.168.235.7_65303\n\nthat I have in the logs.\n\nI mean, could an impossible hostname resolution end up with our FD/thread leak problem somehow?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-08T16:28:24.384+0000","updated":"2011-09-08T16:28:24.384+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13108411","id":"13108411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikab","name":"mikab","key":"mikab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mikab PENG","active":true,"timeZone":"Etc/UTC"},"body":"I found this issue too.\n\nI use a very old version(4.1.1) of ActiveMQ server, and use a very old version of NMS client to connect to the MQ server. I use the default configuration of the ActiveMQ Release. I found in the default configuration , ActiveMQ create a dedicated thread to dipatch message, these thread are the the threads you talking about. in my system, if the client connection doesn't provide the MaxInactivityDuration parameter or the value of this parameter less than 0 , the monitor thread will not started, so if the socket closed before we call the connection's close method, the dispatch thread will not close.\n\nthe error is occour in the method onException of class org.apache.activemq.transport.InactivityMonitor in 4.1.1. I have saw the newwest code, this code have been move to org.apache.activemq.transport.AbstractInactivityMonitor, I don't think it have been fixed.\n\nyou can disable the asynchronous dispatch in the #{ACTIVEMQ_HOME}/conf/activemq.xml, or don't use dedicated thread to dipatch message in the cmd line, set the system property org.apache.activemq.UseDedicatedTaskRunner to false in the #{ACTIVEMQ_HOME}/bin/activemq. \n\ni hope this is useful for you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikab","name":"mikab","key":"mikab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mikab PENG","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-20T07:11:49.066+0000","updated":"2011-09-20T07:12:46.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13119632","id":"13119632","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Without a test case or some way of reproducing this its going to hard for anyone to help.  I suggest trying a newer broker version like 5.5 or trying the latest 5.6-SNAPSHOT to see if this issue has already been fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-10-03T21:25:27.525+0000","updated":"2011-10-03T21:25:27.525+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13122400","id":"13122400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Unable to reproduce this, recommend trying a newer release to see if this occurs anymore.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-10-06T23:19:47.036+0000","updated":"2011-10-06T23:19:47.036+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13125861","id":"13125861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Hi, one of the problems we face, is that AMQ 5.4 and 5.5 do use Spring 3 and all our client apps are Spring 2.5.6 based so upgrading to the latest and greatest is not that trivial.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-12T13:56:35.623+0000","updated":"2011-10-12T13:56:35.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13126412","id":"13126412","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikab","name":"mikab","key":"mikab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mikab PENG","active":true,"timeZone":"Etc/UTC"},"body":"sorry, the below code is test code :\npublic static void main(String[] argv) throws Exception {\n\tfor (int i = 0; i < 1000; i++) {\n\t\tString url = \"tcp://localhost:61616?wireFormat.maxInactivityDuration=0\";\n\t\tActiveMQConnectionFactory factory = new ActiveMQConnectionFactory(url);\n\t\tActiveMQConnection connection = (ActiveMQConnection) factory.createConnection();\n\n\t\tSystem.err.println(connection);\n\t\tconnection.start();\n\t}\n\tSystem.exit(0);\n}\n\nI tried the last version(5.5.0) and didn't reproduce this error.\nwhen I run these code on 4.1.1, each connection will create a zombie thread.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikab","name":"mikab","key":"mikab","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mikab PENG","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-13T07:44:49.706+0000","updated":"2011-10-13T07:44:49.706+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13126632","id":"13126632","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"One short-term solution for us could be to keep the 5.3.2 clients and use the 5.5 server. Would that version difference between the client and the server be ok or are they incompatible???","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-13T14:41:42.380+0000","updated":"2011-10-13T14:41:42.380+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518731/comment/13126633","id":"13126633","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Is there a client vs server compatibility matrix chart somewhere that is available for such questions (that I guess are frequent)?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_accovia","name":"callain_accovia","key":"callain_accovia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-13T14:42:47.177+0000","updated":"2011-10-13T14:42:47.177+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3448/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ktzr:"}}