{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483401","self":"https://issues.apache.org/jira/rest/api/2/issue/12483401","key":"AMQ-1927","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2008-09-03T15:17:41.609+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 03 23:15:19 UTC 2011","customfield_12310420":"66359","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_91959591903_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-08-03T23:15:19.913+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1927/watchers","watchCount":7,"isWatching":false},"created":"2008-09-03T14:55:28.023+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-08-03T23:15:19.922+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"\nWe have an internal activemq queue configured using the spring framework (configuration below). During a high volume message test, the message producer hangs. See stack trace below.\n\nMay be related to bugs #AMQ-1641 or #AMQ-1490.\n\n\"pool-2-thread-2\" prio=10 tid=0x00002aaaf2c20000 nid=0x297e waiting on condition [0x000000004173f000..0x000000004173fc20]\n   java.lang.Thread.State: WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x00002aaae859af40> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1925)\n\tat java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:317)\n\tat org.apache.activemq.transport.FutureResponse.getResult(FutureResponse.java:40)\n\tat org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:80)\n\tat org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1195)\n\tat org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1644)\n\t- locked <0x00002aaab3e433d8> (a java.lang.Object)\n\tat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:227)\n\tat org.apache.activemq.pool.PooledProducer.send(PooledProducer.java:74)\n\t- locked <0x00002aaab3e42d08> (a org.apache.activemq.ActiveMQMessageProducer)\n\tat org.apache.activemq.pool.PooledProducer.send(PooledProducer.java:59)\n\tat org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:534)\n\tat org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:511)\n\tat org.springframework.jms.core.JmsTemplate$2.doInJms(JmsTemplate.java:477)\n\tat org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:428)\n\tat org.springframework.jms.core.JmsTemplate.send(JmsTemplate.java:475)\n\n\n<amq:broker id=\"broker\" useJmx=\"true\" persistent=\"false\"  brokerName=\"fb\" >\n\t\n  \t\t<amq:managementContext>\n        \t<amq:managementContext connectorPort=\"2011\" jmxDomainName=\"org.apache.activemq\"/>\n        </amq:managementContext>\n\n\t\t<amq:transportConnectors>\n\t\t\t<amq:transportConnector uri=\"tcp://localhost:0\" />\n\t\t\t<amq:transportConnector uri=\"tcp://localhost:61616\" />\n\t\t</amq:transportConnectors>\n\t</amq:broker>\n\n\t<!--  ActiveMQ destinations to use  -->\n\t<amq:queue id=\"inboundEvents\" physicalName=\"fb.inbound.events\">\n\t</amq:queue>\n \n\t<bean id=\"jmsFactory\" class=\"org.apache.activemq.pool.PooledConnectionFactory\">\n\t\t<property name=\"connectionFactory\">\n\t\t\t<bean class=\"org.apache.activemq.ActiveMQConnectionFactory\">\n\t\t\t\t<property name=\"brokerURL\" value=\"vm://localhost\"/>\n\t\t\t</bean>\n\t\t</property>\n\t</bean>\n\n\t<bean id=\"simpleJmsTemplate\" class=\"org.springframework.jms.core.JmsTemplate\">\n\t\t<property name=\"connectionFactory\" ref=\"jmsFactory\"/>\n\t</bean>\n\n\t<!-- consumers -->\n\t<bean id=\"inboundEventConsumer\" class=\"jms.WrapperConsumer\" init-method=\"start\" destroy-method=\"stop\">\n\t\t<property name=\"myId\" value=\"fb.consumer.events\"/>\n\t\t<property name=\"template\" ref=\"simpleJmsTemplate\"/>\n\t\t<property name=\"destination\" ref=\"inboundEvents\"/>\n\t</bean>\n\n\t<!-- producers -->\n\t<bean id=\"inboundEventProducer\" class=\"jms.WrapperProducer\">\n\t\t<property name=\"template\" ref=\"simpleJmsTemplate\"/>\n\t\t<property name=\"destination\" ref=\"inboundEvents\"/>\n\t</bean>","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59819","customfield_12312823":null,"summary":"activemq producer hangs (using spring)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rlp82","name":"rlp82","key":"rlp82","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Randy","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rlp82","name":"rlp82","key":"rlp82","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Randy","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"suse linux 10.3\nsun jdk \"1.6.0_06\"\ntomcat 6.0.16\nspring framework 2.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12940101","id":"12940101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"body":"Is this the [producer flow control|http://activemq.apache.org/producer-flow-control.html] kicking in? Try disabling it in the configuration to see if your results are different. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2008-09-03T15:17:41.609+0000","updated":"2008-09-03T15:17:41.609+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12940219","id":"12940219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"body":"Hi... i'm facing the same problem as above. My configuration variates a little bit but have the same idea.\nMy system is:\n - CentOS\n - Dual QuadCore processor\n - JVM 1.6 update 7\n - Tomcat 6.0.16\n - Spring 2.0\n - ActiveMQ 5.1\n\nI have made this change that you suggested in a test server and it apparently worked but it's hard to be sure, because it's hard to reproduce this, at least it doesn't break anything. I guess i will try in production as soon as we have a window.\n\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-10T21:16:30.776+0000","updated":"2008-09-10T21:16:30.776+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12940223","id":"12940223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"body":"I've tried adding your suggestion code to the queue policyEntry, like this:\n <policyEntry queue=\">\" producerFlowControl=\"false\" memoryLimit=\"5mb\"/>\n\nIt has worked. It was deadlocking at the producer and doesn't anymore.\n\nAlthough it worked, now it's deadlocking at the Consumer, like the stack Trace shows below. The problem is that, It keeps one processor core at 100%, very strange.\n\n\"listenerContainerQuickActivation-4\" prio=10 tid=0x00002aaebc906800 nid=0x44d5 in Object.wait() [0x0000000043cd6000..0x0000000043cd6c90]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <0x00002aabb0190468> (a java.lang.Object)\n\tat org.apache.activemq.MessageDispatchChannel.dequeue(MessageDispatchChannel.java:77)\n\t- locked <0x00002aabb0190468> (a java.lang.Object)\n\tat org.apache.activemq.ActiveMQMessageConsumer.dequeue(ActiveMQMessageConsumer.java:409)\n\tat org.apache.activemq.ActiveMQMessageConsumer.receive(ActiveMQMessageConsumer.java:521)\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveMessage(AbstractPollingMessageListenerContainer.java:375)\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:300)\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:254)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:870)\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:810)\n\tat java.lang.Thread.run(Thread.java:619)\n\nThanks for any tip you could give.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-14T17:42:48.073+0000","updated":"2008-09-14T17:42:48.073+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12940227","id":"12940227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"body":"I'm not sure yet if this is the issue, but have you tried adjusting the [consumer prefetch limit|http://activemq.apache.org/what-is-the-prefetch-limit-for.html]? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2008-09-14T19:46:32.554+0000","updated":"2008-09-14T19:46:32.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12940224","id":"12940224","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"body":"I'll try that. But just a question. Is there any problem of having, like 10 consumers on the same queue?\nMaybe, i'll try to make 1 consumer with a prefetch about 10 messages instead of 10  consumers.\n\nIn this application we don't have large amount of messages, we could average on 5 messages per minute.\n\nJust fo the records, today i have this configuration on the URI: \nfailover:(tcp://10.11.20.12:61616?wireFormat.maxInactivityDuration=10000&amp;connectionTimeout=30000)?maxReconnectAttempts=4&amp;initialReconnectDelay=1000\n\nIf you could see something that is not right, please tell me.\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-14T20:24:04.559+0000","updated":"2008-09-14T20:24:04.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12940256","id":"12940256","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"body":"Hi Bruce, \n\njust for a feedback, the last (mis)information i gave is not real, it became to be a tomcat NIO problem. I Have updated to 6.0.18 and the problem is solved. I haven't tried the the new tomcat with the producerFlowControl turned on yet, but as soon as i try this i will reply to this.\nI think this could be a tomcat problem, seen that the report for this issue is with the tomcat.6.0.16 wich one i was using.\n\nThanks in advance.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-18T19:46:10.030+0000","updated":"2008-09-18T19:46:10.030+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12940271","id":"12940271","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"body":"Just to give the feedback i've promissed.\nI've tried the producerFlowControl turned on, and the lock problem persists. We have seen one of our systems, at the end of a transaction when it will produce a message to a queue, it \"stay running\" and the thread gets the state of \"Waiting\", the same as the one reported above. \nWhen i tried this with the producerFlowControle turned off, it worked perfectly.\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliano.carniel","name":"juliano.carniel","key":"juliano.carniel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juliano Carniel","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-01T17:59:33.096+0000","updated":"2008-10-01T17:59:33.096+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12940499","id":"12940499","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rwitcher","name":"rwitcher","key":"rwitcher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Witcher","active":true,"timeZone":"Etc/UTC"},"body":"We saw the same problem and turning off the producerFlowControl worked.  \n\nWe think the underlying issue is that the MemoryPercentageUsed never seemed to go down (as seen in JConsole).  So once the MemoryPercentageUsed reached 100%, even if consumers removed messages from it, the system would still block.  \n\nThis issue claims that was fixed in 5.1.0 but we aren't so sure.\nhttps://issues.apache.org/activemq/browse/AMQ-1644","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rwitcher","name":"rwitcher","key":"rwitcher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Witcher","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-23T04:00:36.214+0000","updated":"2008-11-23T04:00:36.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12943296","id":"12943296","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgutierrez","name":"jgutierrez","key":"jgutierrez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Gutierrez","active":true,"timeZone":"Etc/UTC"},"body":"I've been trying to get the AMQ 5.1.0 Broker to work with our Spring-based application. I'm seeing the same behavior as Juliano was seeing but it didn't work for me when I set processFlowControl to \"false\". (See my activemq.xml file below.) The AMQ Broker actually stopped receiving and distributing messages (but /admin was responsive though.) After restarting the AMQ Broker the producers and consumers started working again. Take note that the producers and consumers were NOT restarted.\n\nI also tried the following to no avail:\n- set jms.prefetchPolicy.queuePrefetch=1\n- with out failover protocol\n- AMQ 5.0.0 client with AMQ 5.1.0 broker\n- no parameters in the URL\n\nConfiguration:\n- Centos (kernel 2.6.18-92)\n- Java 1.6.0_05\n- ActiveMQ 5.1.0 (java -Xmx256m -Xss128k -Xms128m -Dorg.apache.activemq.UseDedicatedTaskRunner=true) \n- Spring 2.5.5\n- Camel 1.3.0\n- JMeter (load produces messages to 3 queue with throughput of 10/sec, 1/sec, and 1/sec.)\n\nAMQ URL used by producer: failover:(tcp://host1.internal:12345)?jms.prefetchPolicy.queuePrefetch=1&jms.redeliveryPolicy.allPrefetchValues=1&jms.redeliveryPolicy.initialRedeliveryDelay=2000&jms.redeliveryPoli\ncy.maximumRedeliveries=24&jms.redeliveryPolicy.useCollisionAvoidance=true\n\nIn activemq.xml:\n\n<broker>\n                <!-- Destination specific policies using destination names or wildcards -->\n                <destinationPolicy>\n                        <policyMap>\n                                <policyEntries>\n\n                                        <policyEntry topic=\">\" producerFlowControl=\"false\" memoryLimit=\"1mb\">\n                                                <dispatchPolicy>\n                                                        <strictOrderDispatchPolicy />\n                                                </dispatchPolicy>\n                                                <subscriptionRecoveryPolicy>\n                                                        <lastImageSubscriptionRecoveryPolicy />\n                                                </subscriptionRecoveryPolicy>\n                                        </policyEntry>\n\n                                        <policyEntry queue=\">\">\n                                                <dispatchPolicy>\n                                                        <strictOrderDispatchPolicy />\n                                                </dispatchPolicy>\n                                                <subscriptionRecoveryPolicy>\n                                                        <lastImageSubscriptionRecoveryPolicy />\n                                                </subscriptionRecoveryPolicy>                                   \n                                                <deadLetterStrategy>\n                                                        <individualDeadLetterStrategy queuePrefix=\"DLQ.\" useQueueForQueueMessages=\"true\"/>\n                                                </deadLetterStrategy>\n                                        </policyEntry>\n                                        \n                                </policyEntries>\n                        </policyMap>\n                </destinationPolicy>\n\n                <!-- The transport connectors ActiveMQ will listen to -->\n                <transportConnectors>\n                        <transportConnector name=\"openwire\" uri=\"tcp://host1.internal:12345\" />\n                </transportConnectors>\n\n                <!--  Use the following to set the broker memory limit -->\n                <systemUsage>\n                        <systemUsage>\n                                <memoryUsage>\n                                        <memoryUsage limit=\"64 mb\" percentUsageMinDelta=\"20\" />\n                                </memoryUsage>\n                                <tempUsage>\n                                        <tempUsage limit=\"100 mb\" />\n                                </tempUsage>\n                                <storeUsage>\n                                        <storeUsage limit=\"1 g\" name=\"host1.internal\" />\n                                </storeUsage>\n                        </systemUsage>\n                </systemUsage>\n\n                <!-- Use the following to configure how ActiveMQ is exposed in JMX -->\n                <managementContext>\n                        <managementContext connectorPort=\"56789\" jmxDomainName=\"org.apache.activemq\" />\n                </managementContext>\n</broker>\n...\n\nThread blocked in the producer side:\n\"resin-tcp-connection-*:6102-9\" daemon prio=10 tid=0xa7a5d400 nid=0x6946 waiting on condition [0xa68b5000..0xa68b7130]\n   java.lang.Thread.State: WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0xb0b3d848> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1925)\n        at java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:317)\n\n\n\nDo you guys see any issue with my configuration? \n\nI'd appreciate any information.\n\nThanks,\nJeff","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgutierrez","name":"jgutierrez","key":"jgutierrez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Gutierrez","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-02T07:46:32.864+0000","updated":"2008-12-02T08:03:02.369+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/12940592","id":"12940592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"body":"Jeff, I notice that you have a destination policy entry for all topics restricting them to using only 1mb of memory. Please change or remove this policy entry to see if this helps at all. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2008-12-19T18:27:51.797+0000","updated":"2008-12-19T18:27:51.797+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483401/comment/13079112","id":"13079112","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"No report from the user on this one and no test case provided.  Suggest testing against a newer release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-08-03T23:15:19.921+0000","updated":"2011-08-03T23:15:19.921+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1927/votes","votes":6,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0alvz:"}}