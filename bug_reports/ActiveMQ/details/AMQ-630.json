{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482159","self":"https://issues.apache.org/jira/rest/api/2/issue/12482159","key":"AMQ-630","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315613","id":"12315613","description":"","name":"4.1.0","archived":false,"released":true,"releaseDate":"2006-11-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-03-16T11:52:09.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Oct 22 20:23:12 UTC 2007","customfield_12310420":"49264","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_222132000_*|*_6_*:*_1_*:*_25124943944_*|*_5_*:*_2_*:*_3554228000_*|*_4_*:*_2_*:*_21895491204","customfield_12312321":null,"resolutiondate":"2007-10-22T20:23:12.148+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-630/watchers","watchCount":0,"isWatching":false},"created":"2006-03-13T22:09:57.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315607","id":"12315607","description":"Milestone 4","name":"4.0 M4","archived":false,"released":true,"releaseDate":"2006-01-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-10-22T20:23:12.146+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"1.  Bring up a broker\n2.  Bring up a client application which connects to the broker\n3.  Stop the broker.\n4.  Now try to stop the client app -- it will not shutdown until the broker is restarted.  \n\nUsing failover:tcp to connect to broker.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161726","customfield_12312823":null,"summary":"After broker has shutdown, cannot shutdown a client application","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482159/comment/12937516","id":"12937516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"We used to have an infinite blocking request-response when closing clients, letting the broker konw that the client was shutting down. The code was patched a few days ago to use a timeout instead - so if the broker is down, the client will only wait until the timeout occurs before shutting down","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-16T11:52:09.000+0000","updated":"2006-03-16T11:52:09.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482159/comment/12937790","id":"12937790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"body":"This is fixed except when I use failover.  I am using failover (on client side) to connect to a network of brokers configured with static discovery and failover=true.  After the client has connected to some broker in the network, if I bring down all brokers in the network, the client will not shutdown.  Watching the client's DEBUG output, I see that it is forever trying to recoonect to a broker from the failover list.\n\nWhen I turn off failover on the client side, the reconnection attempts do not continue -- i.e. without failover, the client shuts down properly. With failover, the client is forever trying to reconnect to a broker. I also set maxReconnectAttempts on the client, it still gets this debug output:\n\nDEBUG - Attempting connect to: tcp://localhost:61616\nDEBUG - Connect fail to: tcp://localhost:61616, reason: java.net.ConnectException: Connection refused\nDEBUG - Waiting 30000 ms before attempting connection.\nDEBUG - Waiting for transport to reconnect.\nDEBUG - Waiting for transport to reconnect.\nDEBUG - Waiting for transport to reconnect.\nDEBUG - Waiting for transport to reconnect.\nDEBUG - Waiting for transport to reconnect.\n\n...and so on. This prevents the client fromn shutting down.\n\nIf I restart a broker, the client reconnects and then completes shutting down.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"created":"2006-04-26T15:09:17.000+0000","updated":"2006-04-26T15:09:17.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482159/comment/12937778","id":"12937778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Look into fixing this post 4.x","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2006-05-01T22:00:39.000+0000","updated":"2006-05-01T22:00:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482159/comment/12938070","id":"12938070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"body":"Is it possible to get this into the 4.0 release?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"created":"2006-05-10T04:15:58.000+0000","updated":"2006-05-10T04:15:58.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482159/comment/12937980","id":"12937980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"BTW have you tried setting a fairly aggresive closeTimeout value? (e.g. like 500 milliseconds)\n\nhttp://activemq.org/site/connection-configuration-uri.html\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-06-09T00:59:52.000+0000","updated":"2006-06-09T00:59:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482159/comment/12938278","id":"12938278","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"body":"Yes - even with the closeTimeout value set to 500ms, if I am using failover then the client will wait FOREVER for the broker to reply before shutting down.  Without failover, if I just use TCP, then client shuts down properly, \n\nI have been testing this using the 4.0.1 release: incubator-activemq-4.0.1.\n\nPerhaps you could try to duplicate this, so I'll at least know that it's not just my configuration?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"created":"2006-08-11T21:49:02.000+0000","updated":"2006-08-11T21:49:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482159/comment/12938641","id":"12938641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"body":"This is fixed, but the client using the failover protocol must  be configured with the maxReconnectAttempts argument set.  If maxReconnectAttempts is not set, then the client tries forever to reconnect and this seems to block the client's shutdown.  As long as maxReconnectAttempts value is non-zero, then the client will be able to shutdown when no brokers are online.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"created":"2006-11-10T16:51:48.000+0000","updated":"2006-11-10T16:51:48.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482159/comment/12939045","id":"12939045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"body":"I think it is a bug. Why transport cannot be stopped without any parameters? I have same problem and this problem not described in documentation. I set this parameter and solve problem, but I think bug is not resolved","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"created":"2007-08-28T12:00:51.438+0000","updated":"2007-08-28T12:00:51.438+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482159/comment/12939126","id":"12939126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Issue has been resolved.  The behavior described regarding maxReconnectAttempts is what is expected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2007-10-22T20:23:12.121+0000","updated":"2007-10-22T20:23:12.121+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-630/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s1jj:"}}