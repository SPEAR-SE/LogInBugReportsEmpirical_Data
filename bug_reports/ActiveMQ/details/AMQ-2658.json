{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483754","self":"https://issues.apache.org/jira/rest/api/2/issue/12483754","key":"AMQ-2658","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2010-03-29T14:02:02.461+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 27 20:47:39 UTC 2011","customfield_12310420":"33651","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_48197882600_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-09-27T20:47:39.690+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2658/watchers","watchCount":2,"isWatching":false},"created":"2010-03-19T00:29:37.134+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-09-27T20:47:39.729+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Using the producer and consumer samples where the build.xml was modified to use a topic with a durable subscriber and quite a few large messages, I see the MemoryPercentUsage grow to 225% after stopping and restarting the consumer multiple times.  Everything seems to run fine, but the large percentage makes me wonder how long this would be able to continue.   I don't have producerFlowControl enabled for topics.\n\nThe \"problem\" seems to occur after the long Index updates as shown in the messages below.  I'm attaching a jconsole screenshot showing the high percentage along with the example build.xml and the activemq.xml.  This is easily recreated.\n\nphil@ubuntu910:~/apache-activemq-5.3.0/bin$ ./activemq xbean:file:../conf/memusage-activemq.xml\nJava Runtime: Sun Microsystems Inc. 1.6.0_18 /opt/jdk1.6.0_18/jre\n  Heap sizes: current=15552k  free=14290k  max=506816k\n    JVM args: -Xmx512M -Dorg.apache.activemq.UseDedicatedTaskRunner=true -Djava.util.logging.config.file=logging.properties -Dcom.sun.management.jmxremote -Dactivemq.classpath=/home/phil/apache-activemq-5.3.0/conf; -Dactivemq.home=/home/phil/apache-activemq-5.3.0 -Dactivemq.base=/home/phil/apache-activemq-5.3.0\nACTIVEMQ_HOME: /home/phil/apache-activemq-5.3.0\nACTIVEMQ_BASE: /home/phil/apache-activemq-5.3.0 Loading message broker from: xbean:file:../conf/memusage-activemq.xml\n INFO | Using Persistence Adapter: org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter@1e0f2f6\n INFO | ActiveMQ 5.3.0 JMS Message Broker (localhost) is starting  \n INFO | For help or more information please see: http://activemq.apache.org/ \n INFO | Listening for connections at: tcp://ubuntu910:61616 \n INFO | Connector openwire Started \n INFO | ActiveMQ JMS Message Broker (localhost, ID:ubuntu910-52519-1268950522231-0:0) started \n INFO | Logging to org.slf4j.impl.JCLLoggerAdapter(org.mortbay.log) via org.mortbay.log.Slf4jLog \n INFO | jetty-6.1.9  INFO | ActiveMQ WebConsole initialized.\n INFO | Initializing Spring FrameworkServlet 'dispatcher'\n INFO | ActiveMQ Console at http://0.0.0.0:8161/admin \n INFO | Initializing Spring root WebApplicationContext \n INFO | Connector vm://localhost Started \n INFO | Camel Console at http://0.0.0.0:8161/camel \n INFO | ActiveMQ Web Demos at http://0.0.0.0:8161/demo \n INFO | RESTful file access application at http://0.0.0.0:8161/fileserver \n INFO | Started SelectChannelConnector@0.0.0.0:8161\n INFO | Slow KahaDB access: Journal append took: 0 ms, Index update took 5815 ms \n INFO | Slow KahaDB access: cleanup took 1937 \n INFO | Slow KahaDB access: Journal append took: 49 ms, Index update took 4031 ms \n INFO | Slow KahaDB access: cleanup took 1621 \n INFO | Slow KahaDB access: Journal append took: 70 ms, Index update took 2314 ms \n INFO | Slow KahaDB access: cleanup took 721 \n INFO | Slow KahaDB access: cleanup took 681 \n INFO | Slow KahaDB access: Journal append took: 7 ms, Index update took 46591 ms \n INFO | Slow KahaDB access: cleanup took 45788 \n INFO | Slow KahaDB access: cleanup took 1592 \n INFO | Slow KahaDB access: Journal append took: 55 ms, Index update took 452 ms \n INFO | Slow KahaDB access: cleanup took 1673 \n INFO | Slow KahaDB access: cleanup took 1343 \n INFO | Slow KahaDB access: Journal append took: 102 ms, Index update took 620 ms \n INFO | Slow KahaDB access: cleanup took 1215 \n INFO | Slow KahaDB access: cleanup took 816 \n INFO | Slow KahaDB access: cleanup took 1454 \n INFO | Slow KahaDB access: cleanup took 851\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461442","id":"12461442","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"created":"2010-03-19T00:59:15.407+0000","size":5934,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461442/activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461448","id":"12461448","filename":"build.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"created":"2010-03-19T00:59:15.468+0000","size":12701,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461448/build.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461600","id":"12461600","filename":"MemPercentUsage225.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"created":"2010-03-19T00:59:15.472+0000","size":101827,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12461600/MemPercentUsage225.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172301","customfield_12312823":null,"summary":"Broker's JMX attribute \"MemoryPercentageUsage\" greater than 100%","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483754/comment/12942323","id":"12942323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Curious if you see the same on 5.3.1 ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-29T14:02:02.461+0000","updated":"2010-03-29T14:02:02.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483754/comment/12942031","id":"12942031","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"body":"I just tried this with 5.3.1 and yes, I see the same thing with the MemoryPercentUsage reaching 225.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"created":"2010-03-31T16:35:35.748+0000","updated":"2010-03-31T16:35:35.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483754/comment/12942633","id":"12942633","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"body":"BTW - I tried this using 5.3.2 and the current 5.4 snapshot and see similar behavior to that mentioned above.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phil.pickett%40springsource.com","name":"phil.pickett@springsource.com","key":"phil.pickett@springsource.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Pickett","active":true,"timeZone":"America/Denver"},"created":"2010-06-08T20:59:00.053+0000","updated":"2010-06-08T20:59:00.053+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483754/comment/13115905","id":"13115905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Closing for now.  Should try this against a newer broker release and see if you can still reproduce it, if so a JUnit test case the demonstrates the problem would be key to finding the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-09-27T20:47:39.718+0000","updated":"2011-09-27T20:47:39.718+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2658/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tutb:"}}