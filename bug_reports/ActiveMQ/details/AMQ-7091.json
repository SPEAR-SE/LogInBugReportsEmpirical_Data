{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13196142","self":"https://issues.apache.org/jira/rest/api/2/issue/13196142","key":"AMQ-7091","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341032","id":"12341032","name":"5.16.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12344359","id":"12344359","description":"","name":"5.15.8","archived":false,"released":true,"releaseDate":"2018-11-19"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-11-04T22:49:51.130+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Nov 12 21:56:08 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_688682323_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-11-12T21:57:29.759+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7091/watchers","watchCount":7,"isWatching":false},"created":"2018-11-04T22:39:27.486+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12344049","id":"12344049","description":"","name":"5.15.7","archived":false,"released":true,"releaseDate":"2018-10-27"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-11-12T21:57:29.789+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325017","id":"12325017","name":"KahaDB"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Hi :D\r\n\r\nOne of our brokers was bouncing indefinitely due OOM even though the load (TPS) was pretty low.\r\n\r\nGetting the memory dump I could see that almost 90% of the memory was being used by [messageReferences|https://github.com/apache/activemq/blob/master/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java#L2368] TreeMap to keep track of what messages were already acked by all Subscribes in order to delete them.\r\n\r\nThis seems to be a problem as if the broker has an inactive durable subscribe, the memory footprint increase proportionally (O) with the number of messages sent to the topic in question, causing the broker to die due OOM sooner or later (the high memory footprint continue even after a restart).\r\n\r\nYou can find attached (memoryAllocation.jpg) a screen shot showing my broker using 90% of the memory to keep track of those messages, making it barely usable.\r\n\r\nLooking at the code, I could do a change to change the messageReferences to use a BTreeIndex:\r\n\r\nfinal TreeMap<Long, Long> messageReferences = new TreeMap<>();\r\n + BTreeIndex<Long, Long> messageReferences;\r\n\r\nMaking this change, the memory allocation of the broker stabilized and the broker didn't run OOM anymore.\r\n\r\nAttached you can see the code that I used to reproduce this scenario, also the memory utilization (HEAP and GC graphs) before and after this change.\r\n\r\nBefore the change the broker died in 5 minutes and I could send 480000. After then change the broker was still pretty healthy after 5 minutes and i could send 2265000 to the topic (almost 5x more due high GC pauses).\r\n\r\n \r\n\r\nAll test are passing: mvn clean install -Dactivemq.tests=all","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12946841","id":"12946841","filename":"After.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-04T22:40:01.331+0000","size":367510,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12946841/After.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12946842","id":"12946842","filename":"Before.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-04T22:40:01.311+0000","size":328129,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12946842/Before.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12946843","id":"12946843","filename":"InactiveDurableSubscriberTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-04T22:41:40.516+0000","size":3229,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12946843/InactiveDurableSubscriberTest.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12946840","id":"12946840","filename":"memoryAllocation.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-04T22:39:49.552+0000","size":44339,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12946840/memoryAllocation.jpg"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"O(n) Memory consumption when broker has inactive durable subscribes causing OOM","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16674544","id":"16674544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user alanprot opened a pull request:\n\n    https://github.com/apache/activemq/pull/315\n\n    AMQ-7091 - O(n) Memory consumption when broker has inactive durable s…\n\n    …ubscribes causing OOM\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/alanprot/activemq AMQ-7091\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/315.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #315\n    \n----\ncommit 29dde9fa81be3bd20fd840daa178259e74cc032e\nAuthor: Alan Protasio <alanprot@...>\nDate:   2018-11-04T06:22:32Z\n\n    AMQ-7091 - O(n) Memory consumption when broker has inactive durable subscribes causing OOM\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-04T22:49:51.130+0000","updated":"2018-11-04T22:49:51.130+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16676851","id":"16676851","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"The patch looks good to me - thank you Alan.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-11-06T14:50:34.345+0000","updated":"2018-11-06T14:50:34.345+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16676855","id":"16676855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"that info does not need to be persisted, it is duplicate info. I would like to understand the tradeoff - that in mem reference map was introduced as on optimisation via: https://issues.apache.org/jira/browse/AMQ-3467 in 2011 but is in memory only to be fast. It may be possible to squash that map to a sequenceSet of offsets that share a reference count which would address the mem usage without the need to persist to disk.\r\n\r\n \r\n\r\nThe implications of additional page writes on every add/ack may be significant for the simple fanout (when users keep up) case. Typically the broker has plenty of memory for this sort of thing.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T14:53:53.135+0000","updated":"2018-11-06T14:53:53.135+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16676857","id":"16676857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"[~cshannon], [~gtully]\r\n\r\nI've reviewed Alan's patch and it looks good.\r\n\r\nThe bump in KahaDB version to 7 on Master would open the door to us doing some more changes to KahaDB/MessageDatabase (perhaps some gentle refactoring). \r\n\r\nI'd like to know what you think.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-11-06T14:56:15.887+0000","updated":"2018-11-06T14:56:15.887+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16676861","id":"16676861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"Thanks Gary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-11-06T14:59:23.190+0000","updated":"2018-11-06T14:59:23.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16677021","id":"16677021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"Hi [~alanprot], \r\n\r\nAfter some conversation with the community, the SeuqnceSet in AMQ is good to use for this scenario, because then we can control the sizes and toss them when memory is short: \r\nhttps://github.com/apache/activemq/blob/master/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/disk/util/SequenceSet.java\r\n\r\nPlease have a look at the above, and lets update your PR.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-11-06T17:09:31.069+0000","updated":"2018-11-06T17:09:31.069+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16677145","id":"16677145","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"Cool! Thanks guys to looking into that...\r\n\r\nI will change my PR! :D\r\n\r\n \r\n\r\nThanks again!!! :D","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T18:37:28.424+0000","updated":"2018-11-06T18:37:28.424+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16677471","id":"16677471","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"Hi Guys....\r\n\r\n \r\n\r\nI changed my PR to use the SequenceSets that already exists in the index...\r\n\r\n[https://github.com/apache/activemq/pull/315]\r\n\r\nI'm running all the tests now...\r\n\r\n \r\n\r\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T00:54:31.764+0000","updated":"2018-11-07T00:54:31.764+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16678599","id":"16678599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"[~gtully] [~jgoodyear] Seems that all tests succeed! \r\n\r\nIf you guys think that getting this from the ListIndex<String, SequenceSet> ackPositions is expensive I can create a TreeMap<String, SequenceSet> to keep it in memory.. but I think having this duplicate information can be error prone. And also we are already accessing this index in the code... the only overhead is when you ack a message instead o getting the sequenceSet only for the subscriber that is acking we have to get the sequenceSet for all subscribers..\r\n\r\nSee \"isSequenceReferenced\" method.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T18:21:57.395+0000","updated":"2018-11-07T20:49:59.174+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16678790","id":"16678790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~alanprot] you have to ask the computer to see if there is any negative performance impact. This reference count in memory is an optimisation introduced for a performance issue, probably a typical fanout case with lots of subs. See the linked issue. This issue is about that cache being unbounded in terms of memory usage, the solution is to have the data in the pageFile and pageCache such that it can get flushed from memory at the cost of accessing from pages in normal operation.\r\n\r\nI would like to see the actual trade off in publish/ack latency quantified. It may well be negligible; but we need to respect the original use case to verify.\r\n\r\nIn addition, if this warrants a version update, the auto migration path needs to be validated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T21:23:53.369+0000","updated":"2018-11-07T21:23:53.369+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16678860","id":"16678860","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~gtully]\r\n\r\nThanks again! haha :D\r\n\r\n \r\n{quote}the solution is to have the data in the pageFile and pageCache such that it can get flushed from memory at the cost of accessing from pages in normal operation.\r\n{quote}\r\nDid you see my last proposed change? This change does not requite new index version (kahadb) and will not write anything new to the index.\r\n\r\nI dont know why the bot didn't add the comment (updated the PR) here but i'm not adding a new Btree Index anymore... I'm reusing the data that is already there:\r\n\r\n[https://github.com/apache/activemq/pull/315/commits/98d1be6acaee79f9acd72d2c7c2bdb2358638e18]\r\n\r\nWe already have this information in other format in the ListIndex<String, SequenceSet> ackPositions; So i'm using it.\r\n\r\nMy comment before was.... nowadays to discover if one message is referenced by one subscribe we only do a sd.messageReferences.get(sequenceId) and check if the reference count is 0.\r\n\r\nWith my change,  we will do when acking a message something similar with that we already do when sending a message.\r\n\r\nSee:\r\n\r\n[https://github.com/apache/activemq/blob/master/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java#L2924]\r\n\r\nand\r\n\r\n[https://github.com/apache/activemq/pull/315/commits/98d1be6acaee79f9acd72d2c7c2bdb2358638e18#diff-e3b8fff8c2133dfd70999705bbb558b3R2935]\r\n\r\n  \r\n\r\n \r\n\r\n \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T22:11:44.983+0000","updated":"2018-11-08T15:49:01.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16679987","id":"16679987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"This looks good to me...the additional writes are gone.  [~gtully], since you are the resident expert in this area, please let us know what you think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2018-11-08T16:32:42.702+0000","updated":"2018-11-08T16:32:42.702+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16680307","id":"16680307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"[~gtully] [~jgenender]\r\n\r\nI did some performance tests before and after the change:\r\n\r\nThe test scenarios were:\r\n\r\n1, 10, 100 Consumers\r\n\r\nProducing and consuming messages in parallel\r\n\r\nProducing all message before starting the consumers \r\n\r\nThe results are here:\r\n\r\n[https://github.com/alanprot/activemq/blob/master/AMQ-7091.md]\r\n\r\n \r\n\r\nI used KahaDBDurableTopicTest as base for this test.\r\n\r\n \r\n\r\nSeems that this change does not have impact performance wise.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-08T19:53:40.811+0000","updated":"2018-11-08T19:53:40.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16683923","id":"16683923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~tabish121] Hi tim, you added the messageReferences cache way back in https://github.com/apache/activemq/commit/943db3c3cb12b4c4504b4966135cf9a0cc69f0ba - this PR proposed to remove that cache b/c it can grow unlimited with the number of pending messages, even it is a just two Longs per message it can be significant.\r\nCan you recall the use case that caused that cache to be introduced? I ask b/c it is under threat with this change.\r\nIt may be that the need for the cache is offset by the changes to what is in the index , or it may be that with the change to what is stored, the cache is more important. \r\nMy guess is that if it is important you may recall, hense the redirect.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-12T15:18:08.920+0000","updated":"2018-11-12T15:18:08.920+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16683962","id":"16683962","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"[~gtully], what if the change was a configuration property? i.e. you can have the cache or you can set the property to do what is being proposed here?  So for those strapped for memory, they can just disable the cache?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2018-11-12T15:44:23.586+0000","updated":"2018-11-12T15:44:23.586+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16684019","id":"16684019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"[~gtully] I'm afraid I don't recall any longer what the context was for that work. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2018-11-12T16:15:34.768+0000","updated":"2018-11-12T16:15:34.768+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16684081","id":"16684081","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~tabish121] thanks. [~jgenender] Probably no need for any config option then. let it run as is.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-12T16:57:36.408+0000","updated":"2018-11-12T16:57:36.408+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16684375","id":"16684375","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 9012a7871b77da6ecdc403f6b44ef0221345bfb7 in activemq's branch refs/heads/master from [~alanprot]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9012a78 ]\n\nAMQ-7091 - O(n) Memory consumption when broker has inactive durable subscribes causing OOM\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-12T21:21:13.378+0000","updated":"2018-11-12T21:21:13.378+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16684377","id":"16684377","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/activemq/pull/315\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-12T21:23:59.753+0000","updated":"2018-11-12T21:23:59.753+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16684381","id":"16684381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 71ce081157a0c4bd007cdf58d68e2e0784f87956 in activemq's branch refs/heads/activemq-5.15.x from [~alanprot]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=71ce081 ]\n\nAMQ-7091 - O(n) Memory consumption when broker has inactive durable subscribes causing OOM\n\n(cherry picked from commit 9012a7871b77da6ecdc403f6b44ef0221345bfb7)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-12T21:32:33.449+0000","updated":"2018-11-12T21:32:33.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13196142/comment/16684398","id":"16684398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"body":"Thank you Alan Protasio for the PR :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgoodyear","name":"jgoodyear","key":"jgoodyear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jgoodyear&avatarId=10107","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jgoodyear&avatarId=10107","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jgoodyear&avatarId=10107","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jgoodyear&avatarId=10107"},"displayName":"Jamie goodyear","active":true,"timeZone":"America/St_Johns"},"created":"2018-11-12T21:56:08.874+0000","updated":"2018-11-12T21:56:08.874+0000"}],"maxResults":21,"total":21,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7091/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|s003w8:"}}