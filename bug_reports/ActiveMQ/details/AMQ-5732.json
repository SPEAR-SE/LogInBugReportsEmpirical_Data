{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12821394","self":"https://issues.apache.org/jira/rest/api/2/issue/12821394","key":"AMQ-5732","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2015-04-17T14:31:26.271+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Apr 22 06:31:41 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_536127043_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-04-22T06:32:17.232+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5732/watchers","watchCount":4,"isWatching":false},"created":"2015-04-16T01:36:50.236+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["features"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-22T06:32:17.267+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The problem is:\n\n1. I create a queue in activemq broker (version 5.11.1) and some message with string property, for example \"filename\".\n\n2. Use a client to consume the message with message selector \"filename='123.tar'\" with consumer.receive(),it works.  After it receive the message, it acks the message and send the same message back to the broker and commit the session. (client_acknowledge). \n\n3. Use the same client, change the message selector to \"filename='456.tar'\" with consumer.receive(), the consumer is blocked. \n\n4. restart the broker and consumer \"filename='456.tar'\" again, it successfully receive the message, but if i change the selector back to \"filename='123.tar'\", it blocked again.\n\nAt first I thought that there might be some rules for message dispatching. However, with ActiveMQ version 5.10.0, the problem is gone.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Changing message selector leads to blocking message","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cadmean","name":"Cadmean","key":"cadmean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Cadmean","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cadmean","name":"Cadmean","key":"cadmean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Cadmean","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Suse Linux 11 sp2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821394/comment/14499902","id":"14499902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Can you try and provide a unit test that shows your use-case and the problem you are having?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-04-17T14:31:26.271+0000","updated":"2015-04-17T14:31:26.271+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821394/comment/14502272","id":"14502272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cadmean","name":"Cadmean","key":"cadmean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Cadmean","active":true,"timeZone":"Etc/UTC"},"body":"The message receive function is like this (ignoring creating connection part):\n\n{code}\n\n\tpublic BlobMessage getMedia(String fileName) throws JMSException{\n\t\ttry {\n\t\t\tActiveMQSession fileSession = (ActiveMQSession) connection.createSession(true, ActiveMQSession.CLIENT_ACKNOWLEDGE);\n\t\t\tDestination destinationMedia = fileSession.createQueue(\"MediaQueue\");\n\t\t\tMessageConsumer consumerFile = fileSession.createConsumer(destinationMedia,\"FileName='\"+ fileName + \"'\");\n\t\t\tMessage bmsg = consumerFile.receive(60000);\n\t\t\tBlobMessage blobMessage = (BlobMessage) bmsg;\n\t\t\tif (null != blobMessage) {\n\t\t\t\tbmsg.acknowledge();\n\t\t\t\tfileSession.commit();\n\t\t\t\tfileSession.close();\t\t\t\t\n\t\t\t\tfileSession = (ActiveMQSession) connection.createSession(true, ActiveMQSession.CLIENT_ACKNOWLEDGE);\n\t\t\t\tdestinationMedia = fileSession.createQueue(\"MediaQueue\");\n\t\t\t\tMessageProducer produceFile = fileSession.createProducer(destinationMedia);\n\t\t\t\tproduceFile.send(bmsg);\n\t\t\t\tproduceFile.close();\n\t\t\t}\n\t\t\tconsumerFile.close();\n\t\t\tfileSession.rollback();\n\t\t\tfileSession.close();\n\t\t\treturn blobMessage;\t\t\t\n\t\t} catch (JMSException e) {\n\t\t\tthrow e;\n\t\t}\t\t\n\t}\n\n{code}\n\nand in the main function :\n\nBlobMessage bmsg = client.getMedia(\"scriptset123.zip\");  \n\nthe code works fine, but then if I change the filename to \"script456.zip\" (which is exist in the queue),and run the code again. the consumer is blocked 60s. \nIf I restart the activeMQ, and run the code with  \"script456.zip\", it works. but if I change to \"scriptset123.zip\" and rerun the code, the consumer is blocked again.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-04-20T03:02:09.380+0000","updated":"2015-04-20T13:24:12.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821394/comment/14503108","id":"14503108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"How deep is the Queue when you do this?  You could be seeing a case where the depth is larger than the maxPageSize setting which would prevent those older messages from paging in which could cause the stall you see.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-04-20T16:16:33.373+0000","updated":"2015-04-20T16:16:33.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821394/comment/14503308","id":"14503308","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clebertsuconic","name":"clebertsuconic","key":"clebertsuconic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"clebert suconic","active":true,"timeZone":"America/New_York"},"body":"[~Cadmean] it looks like you are using the messaging provider as a database where you are storing and retrieving data.. (storing file=X, Y and Z.. and later reading for the file you want). This is the kind of thing a database is a better fit than a message system IMHO.\n\n\nIf you were always having a consumer active for your entire dataset you shouldn't have an issue with paging...\n\n\nThis has been the case for any messaging system I have worked with.\n\n\nThis issue should be closed unless you provide a working testcase that shows this as an issue.. you start an empty server. Send a few messages and consume them accordingly showing the message blocked without paging.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clebertsuconic","name":"clebertsuconic","key":"clebertsuconic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"clebert suconic","active":true,"timeZone":"America/New_York"},"created":"2015-04-20T18:01:43.801+0000","updated":"2015-04-20T18:01:43.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821394/comment/14506459","id":"14506459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cadmean","name":"Cadmean","key":"cadmean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Cadmean","active":true,"timeZone":"Etc/UTC"},"body":"Actually there were only 2 or 3 messages in the queue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cadmean","name":"Cadmean","key":"cadmean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Cadmean","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-22T05:36:38.499+0000","updated":"2015-04-22T05:36:38.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821394/comment/14506476","id":"14506476","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cadmean","name":"Cadmean","key":"cadmean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Cadmean","active":true,"timeZone":"Etc/UTC"},"body":"It is indeed what I want to achieve using ActiveMQ as a small database. The reason is that all the clients (consumer) are always active. In this case, I use activemq broker to save the file location (blobmessage) in a fileserver I build. If a client needs any file, they just need to create a session and receive the blobmessage. \n\nSince I am not sure if the problem is caused by xml configuration, I am going to setup a new broker and see if this problem exists.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cadmean","name":"Cadmean","key":"cadmean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Cadmean","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-22T05:50:11.827+0000","updated":"2015-04-22T05:50:11.827+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821394/comment/14506517","id":"14506517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cadmean","name":"Cadmean","key":"cadmean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Cadmean","active":true,"timeZone":"Etc/UTC"},"body":"The issue is gone after I use a complete new broker. So there might be some problems with my configuration or system. Thank you for your advice.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cadmean","name":"Cadmean","key":"cadmean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Cadmean","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-22T06:31:41.161+0000","updated":"2015-04-22T06:31:41.161+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5732/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2dbnj:"}}