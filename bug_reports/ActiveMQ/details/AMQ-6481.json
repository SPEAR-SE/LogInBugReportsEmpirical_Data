{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13015109","self":"https://issues.apache.org/jira/rest/api/2/issue/13015109","key":"AMQ-6481","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-10-25T17:14:02.157+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 25 18:13:48 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6481/watchers","watchCount":3,"isWatching":false},"created":"2016-10-25T15:23:30.161+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335045","id":"12335045","name":"5.13.3","archived":false,"released":true,"releaseDate":"2016-05-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-10-25T18:13:48.268+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Producer flow control cannot be disabled in activemq 5.13.3. I have tried to disable producer flow control using the following configurations for destination policy and  system usage below. \n\nI was able to recreate this issue easily by reducing the memory limit to very low value and send messages consistently (load test). Once the memory usage shows 100% on the activemq console. I can see the producer flow control kicks in with the following message in log:\n\nUsage Manager memory limit reached 134217728. Producers will be throttled to the rate at which messages are removed from this destination to prevent flooding it. See http://activemq.apache.org/producer-flow-control.html for more info.\n\nI can surely increase the memory limit, but that would only push the occurrence of the issue to later.\n\n   <destinationPolicy>\n\t\t<policyMap>\n\t\t\t<policyEntries>\n\t\t\t\t<policyEntry topic=\">\" producerFlowControl=\"false\">\n\t\t\t\t\t<dispatchPolicy>\n\t\t\t\t\t\t<strictOrderDispatchPolicy />\n\t\t\t\t\t</dispatchPolicy>\n\t\t\t\t\t<pendingSubscriberPolicy>\n\t\t\t\t\t\t<fileCursor />\n\t\t\t\t\t</pendingSubscriberPolicy>\n\t\t\t\t\t<pendingDurableSubscriberPolicy>\n\t\t\t\t\t\t<fileDurableSubscriberCursor />\n\t\t\t\t\t</pendingDurableSubscriberPolicy>\n\t\t\t\t</policyEntry>\n\t\t\t</policyEntries>\n\t\t\t<policyEntries>\n\t\t\t\t<policyEntry queue=\">\" producerFlowControl=\"false\">\n\t\t\t\t\t<pendingQueuePolicy>\n\t\t\t\t\t\t<fileQueueCursor />\n\t\t\t\t\t</pendingQueuePolicy>\n\t\t\t\t</policyEntry>\n\t\t\t</policyEntries>\n\t\t</policyMap>\n\t\t</destinationPolicy>\n\n\n        <systemUsage>\n            <systemUsage>\n                <memoryUsage>\n                    <memoryUsage limit=\"128 mb/>\n                </memoryUsage>\n                <storeUsage>\n                    <storeUsage limit=\"3 gb\"/>     \n                </storeUsage>\n                <tempUsage>\n                    <tempUsage limit=\"1 gb\"/>    \n                </tempUsage>\n            </systemUsage>\n        </systemUsage>\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Producer Flow Control not disabling","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Active MQ  5.13.3 in  Karaf 4.x \nCamel 2.16.3\nCentos OS","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13015109/comment/15605890","id":"15605890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Were the destinations created after you configured the policy?  Looking at your configuration, it should apply to new destinations and disable the flow control flag but it won't apply to any existing destinations that were created before disabling the flag in your policy.  Also you can try the latest 5.14.x version as well to see if that makes any difference.\n\nIf you are still having an issue it would be a good idea to try and write a test case/junit test to demonstrate an issue if it exists.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-10-25T17:14:02.157+0000","updated":"2016-10-25T17:14:02.157+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13015109/comment/15606023","id":"15606023","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for your reply, I have deleted kahaDB and recreated the destinations with producer flow control configuration. Still same result. I dont see any JIRA related to this in 5.14.x. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-25T18:13:44.087+0000","updated":"2016-10-25T18:13:44.087+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13015109/comment/15606024","id":"15606024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for your reply, I have deleted kahaDB and recreated the destinations with producer flow control configuration. Still same result. I dont see any JIRA related to this in 5.14.x. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-25T18:13:48.268+0000","updated":"2016-10-25T18:13:48.268+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6481/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i35d73:"}}