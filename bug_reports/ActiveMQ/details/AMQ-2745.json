{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483533","self":"https://issues.apache.org/jira/rest/api/2/issue/12483533","key":"AMQ-2745","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2010-05-21T16:13:17.593+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Dec 06 21:55:21 UTC 2012","customfield_12310420":"74819","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_80373617097_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-12-06T21:55:21.195+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2745/watchers","watchCount":3,"isWatching":false},"created":"2010-05-21T15:55:04.157+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315621","id":"12315621","description":"","name":"5.3.1","archived":false,"released":true,"releaseDate":"2010-03-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315624","id":"12315624","description":"Maintenance release for 5.4.0","name":"5.4.1","archived":false,"released":true,"releaseDate":"2010-09-21"}],"issuelinks":[{"id":"12335032","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335032","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12483549","key":"AMQ-2217","self":"https://issues.apache.org/jira/rest/api/2/issue/12483549","fields":{"summary":"Message delivery to selector based consumers pauses if selector leaves messages on the queue.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12361575","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12361575","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"12483549","key":"AMQ-2217","self":"https://issues.apache.org/jira/rest/api/2/issue/12483549","fields":{"summary":"Message delivery to selector based consumers pauses if selector leaves messages on the queue.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-12-06T21:55:21.238+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have a situation where we are posting messages to a queue with two different correlation ids specifically intended to reach two different clients who subscribe with message selectors for the appropriate correlation.  The clients are reading with message listeners.  When one client stops reading the expected behavior, and the behavior we saw on 5.3.0, is that the messages with the correlation for the stopped client will backup on the queue and will not effect the performance of the second client who is still reading the messages with the other correlation.  With our memory config messages can backup into the hundreds of thousands before noticing any performance impact on the active client.\n\nHowever this is not the case in 5.3.1 or 5.3.2.  With 5.3.1 once enough messages backup for the stopped client, suddenly the active client's performance drops drastically 20 ms reads to 30,000ms reads.  We will see this within a few hundred messages.  I believe there is some kind of deadlock, or buffering bottleneck that was introduced on the client side.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461864","id":"12461864","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-10T20:19:08.032+0000","size":5426,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461864/activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461761","id":"12461761","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-14T19:44:46.579+0000","size":5164,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461761/activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461762","id":"12461762","filename":"PutMessages.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-14T19:47:46.297+0000","size":1870,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461762/PutMessages.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461763","id":"12461763","filename":"ReadMessages.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-14T19:47:46.343+0000","size":1904,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461763/ReadMessages.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59695","customfield_12312823":null,"summary":"Deadlock or Performance Bottleneck when reading messages with Correlation","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Java 64-bit, Windows 2008 Server, Centos 5 64bit,  Ubuntu 110 64-bit, OS X 10.5, 10.6","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12942720","id":"12942720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"it would be great if you could provide a tests case for this so we can see your configuration and setup. Of interest is the maxPageSize for the queue and the distribution of messages across the two selectors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-21T16:13:17.593+0000","updated":"2010-05-21T16:13:17.593+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12942435","id":"12942435","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"I have created two classes to show this problem:  test.PutMessages and test.ReadMessages that show the problem.  Steps to reproduce\n\n1) Start a 5.3.0 broker\n\n2) Start two messages reader for two different correlations on the same queue\njava -cp <yourclasspath> test.ReadMessages tcp://localhost:61616 TestQueue ForReader1\njava -cp <yourclasspath> test.ReadMessages tcp://localhost:61616 TestQueue ForReader2\n\n3) Start two messages producers for the two different correlations\njava -cp <yourclasspath> tesPutMessages tcp://localhost:61616 TestQueue ForReader1\njava -cp <yourclasspath> test.PutMessages tcp://localhost:61616 TestQueue ForReader2\n\n4) Looking at the output of the readers you started on step two, you will both read the messages for the correlation with the time on the broker about 1ms.\n\n5) Stop the reader ForReader1, you will notice that the program ForReader2 is uneffected.  Messages with corrlations \"ForReader1\" backup on the queue, and the program ForReader2 continues reading normally.\n\n6) stop all classes, and stop 5.3.0 broker.  Start a 5.3.2  broker.\n\n7) Repeat steps 1-5.  Except you'll notice that once you stop ForReader1, ForReader2 is effected which is shouldn't be.  ForReader2 will basically stop being able to read messages until you start ForReader1 again.  ForReader2 will occasionally get messages, but incredibly slowly and performance is ruined.\n\npackage test;\n\nimport java.net.*;\nimport javax.jms.*;\nimport org.apache.activemq.ActiveMQConnectionFactory;\n\n/**\n *\n * @author bwillard\n */\npublic class PutMessages extends Thread {\n\n    final private MessageProducer producer;\n    final private String correlationID;\n    final private Session session;\n\n    public PutMessages(URI uri, String queueName, String correlationID) throws Exception {\n\n        this.correlationID = correlationID;\n\n        ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory(uri);\n        Connection connection = factory.createConnection();\n        connection.start();\n\n        session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\n        Queue queue = session.createQueue(queueName);\n\n        producer = session.createProducer(queue);\n        producer.setDeliveryMode(DeliveryMode.PERSISTENT);\n    }\n\n    public void run() {\n\n        ObjectMessage message;\n        String text;\n        long counter = 0;\n\n        while (true) {\n\n            try {\n\n                this.sleep(5);\n\n                counter++;\n\n                message = session.createObjectMessage();\n                message.setJMSCorrelationID(correlationID);\n                text = \"Message \" + counter + \" for consumer \" + correlationID;\n                message.setObject(text);\n\n                producer.send(message);\n\n            } catch (Exception exc) {\n                System.err.println(\"Error sending message\");\n                exc.printStackTrace(System.err);\n            }\n\n        }\n    }\n\n    public static void main(String[] args) {\n\n        try {\n\n            URI uri = URI.create(args[0]);\n            String queueName = args[1];\n            String correlationID = args[2];\n\n            new PutMessages(uri, queueName, correlationID).start();\n\n        } catch (Exception exc) {\n            exc.printStackTrace();\n        }\n\n    }\n}\n\n\n\n\n\n\n\npackage test;\n\nimport java.net.*;\nimport javax.jms.*;\nimport org.apache.activemq.ActiveMQConnectionFactory;\n\n/**\n *\n * @author bwillard\n */\npublic class ReadMessages implements MessageListener {\n\n    final private MessageConsumer consumer;\n    final private String correlationID;\n    final private Session session;\n\n    public ReadMessages(URI uri, String queueName, String correlationID) throws Exception {\n\n        this.correlationID = correlationID;\n\n        ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory(uri);\n        Connection connection = factory.createConnection();\n        connection.start();\n\n        session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\n        Queue queue = session.createQueue(queueName);\n\n        consumer = session.createConsumer(queue, \"JMSCorrelationID='\" + correlationID + \"'\");\n        consumer.setMessageListener(this);\n    }\n\n    public void onMessage(Message msg) {\n        long inTime, outTime, brokerTime;\n\n        try {\n\n            if (msg instanceof ObjectMessage) {\n                ObjectMessage txt = (ObjectMessage) msg;\n                inTime = txt.getLongProperty(\"JMSActiveMQBrokerInTime\");\n                outTime = txt.getLongProperty(\"JMSActiveMQBrokerOutTime\");\n\n                brokerTime = outTime - inTime;\n\n                System.out.println(\"Message waited \" + brokerTime + \"ms : \" + txt.getObject().toString());\n            }\n\n        } catch (Exception exc) {\n            System.err.println(\"Error reading message\");\n            exc.printStackTrace();\n        }\n    }\n\n    public static void main(String[] args) {\n\n        try {\n\n            URI uri = URI.create(args[0]);\n            String queueName = args[1];\n            String correlationID = args[2];\n\n            new ReadMessages(uri, queueName, correlationID);\n\n        } catch (Exception exc) {\n            exc.printStackTrace();\n        }\n\n    }\n}\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-14T19:40:20.071+0000","updated":"2010-07-14T19:40:20.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12940994","id":"12940994","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"I updated the issue because it's a major performance issue that also exists in 5.3.2 when using messages selectors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-14T19:43:41.519+0000","updated":"2010-07-14T19:43:41.519+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12940920","id":"12940920","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"This is the config file I used in both brokers to show the problem","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-14T19:44:46.634+0000","updated":"2010-07-14T19:44:46.634+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12942434","id":"12942434","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"Source files instead of pasting into comment, sorry.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-14T19:47:46.387+0000","updated":"2010-07-14T19:47:46.387+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12942418","id":"12942418","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"Has anyone had a chance to verify this is a real problem or if there is something wrong with my config?  I am unable to upgrade past broker 5.3.0 because of it, and really want to be able to upgrade to resolve other issues I've been seeing.  I also want to make sure this isn't also an issue in the 5.4 broker due out.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-19T18:27:32.445+0000","updated":"2010-07-19T18:27:32.445+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12940640","id":"12940640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"Confirmed this is still an issue in the 5.4 snapshot https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.4-SNAPSHOT/apache-activemq-5.4-SNAPSHOT-bin.tar.gz","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-19T18:54:37.728+0000","updated":"2010-07-19T18:54:37.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12942771","id":"12942771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"I wanted to confirm that this is still an issue in the 5.4 release.  I can do it with the default properties file it ship with as well.  Increasing the maxPageSize in the policyEntry seems to help the issue, but eventually the consumer on a separate correlation will lock up.\n\nAny ideas, this is has prevented up from upgrading since 5.3.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-10T20:17:42.089+0000","updated":"2010-09-10T20:17:42.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12942778","id":"12942778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"Modifications to 5.4.0 default config file that still show the problem running the provided sample code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-10T20:19:08.104+0000","updated":"2010-09-10T20:19:08.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12942905","id":"12942905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"This is another case of https://issues.apache.org/activemq/browse/AMQ-2217 - there are some strategies using named queues or virtual queues that can help as outlined in the comments on AMQ-2217\n\n5.3.0 had a bug in this regard that could lead to an out of memory exception as there was no limit on the size of the in memory dispatch queue, it was as if maxPageSize == MAX_INT. With a very sparse selector, the broker would exhaust available memory.\nSet maxPageSize to MAX_INT to replicate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-13T10:28:43.984+0000","updated":"2010-09-13T10:28:43.984+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/12964888","id":"12964888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"body":"I have confirmed this is still a problem in 5.4.1  I have also confirmed you can reproduce this problem with the default activemq configuration file.  Disabling flow control has no effect, neither does lowering the message pre-fetch.  This is a real performance issues for anyone using message selectors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=odysseyfx","name":"odysseyfx","key":"odysseyfx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brad Willard","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-29T19:19:05.547+0000","updated":"2010-11-29T19:19:05.547+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483533/comment/13525793","id":"13525793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Relates to the same issue of maxPageSize ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-12-06T21:55:21.211+0000","updated":"2012-12-06T21:55:21.211+0000"}],"maxResults":12,"total":12,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2745/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0al4f:"}}