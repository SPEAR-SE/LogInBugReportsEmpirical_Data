{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12521617","self":"https://issues.apache.org/jira/rest/api/2/issue/12521617","key":"AMQ-3487","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2011-09-08T13:14:24.755+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Nov 09 10:26:43 UTC 2011","customfield_12310420":"43955","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3487/watchers","watchCount":0,"isWatching":false},"created":"2011-09-07T16:31:32.551+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-11-09T10:57:31.317+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have Glassfish sending messages to an activeMQ topic using an XA Transaction. This seems to work correctly when transactions are committing.\nHowever, *every* time we have a transaction rollback we have a slight memory leak from activeMQ. After 1000 rollbacks our 1mb queue memory is full.\nThe logs show:\n2011-06-06 11:50:06,842 | DEBUG | Setting up new connection id: ID:HOTCPC8567-53061-1307352319478-0:338, address: /127.0.0.1:56674 | org.apache.activemq.broker.TransportConnection | ActiveMQ Transport: tcp:///127.0.0.1:56674\n2011-06-06 11:50:06,843 | DEBUG | localhost adding consumer: ID:HOTCPC8567-53061-1307352319478-0:338:-1:102 for destination: topic://ActiveMQ.Advisory.TempQueue,topic://ActiveMQ.Advisory.TempTopic | org.apache.activemq.broker.region.AbstractRegion | ActiveMQ Transport: tcp:///127.0.0.1:56674\n2011-06-06 11:50:06,846 | DEBUG | XA Transaction new/begin : XID:4871251:c51600003f724564484f54435043383536372c7365727665722c5033373030:484f54435043383536372c7365727665722c50333730302c00 | org.apache.activemq.transaction.XATransaction | ActiveMQ Transport: tcp:///127.0.0.1:56674\n2011-06-06 11:50:06,849 | DEBUG | Main:memory:topic://createBookingTopic:memory: usage change from: 9% of available memory, to: 10% of available memory | org.apache.activemq.usage.Usage | ActiveMQ Transport: tcp:///127.0.0.1:56674\n2011-06-06 11:50:06,852 | DEBUG | XA Transaction rollback: XID:4871251:c51600003f724564484f54435043383536372c7365727665722c5033373030:484f54435043383536372c7365727665722c50333730302c00 | org.apache.activemq.transaction.XATransaction | ActiveMQ Transport: tcp:///127.0.0.1:56674\n2011-06-06 11:50:06,884 | DEBUG | localhost removing consumer: ID:HOTCPC8567-53061-1307352319478-0:338:-1:102 for destination: topic://ActiveMQ.Advisory.TempQueue,topic://ActiveMQ.Advisory.TempTopic | org.apache.activemq.broker.region.AbstractRegion | ActiveMQ Transport: tcp:///127.0.0.1:56674\n2011-06-06 11:50:06,885 | DEBUG | remove connection id: ID:HOTCPC8567-53061-1307352319478-0:338 | org.apache.activemq.broker.TransportConnection | ActiveMQ Transport: tcp:///127.0.0.1:56674\n\nSo no obvious issue in ActiveMQ. Also, this does not happen when we use a queue and the transaction is rolled back.\n\nThis is a serious problem for us as we are needing to restart activeMQ on a daily basis to keep the production servers running.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81466","customfield_12312823":null,"summary":"Topic message rollback memory leak (XA transaction)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Glassfish 3.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521617/comment/13100185","id":"13100185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"body":"My last statement \"This is a serious problem for us as we are needing to restart activeMQ on a daily basis to keep the production servers running.\" is now out of date.\nWe have had to resort to using queues for everything, and have noticed no memory leak after running solidly for 3 months! So queues work beautifully :-)\nHowever, we have reached a point where we really need to use topics, hence the defect.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-08T09:49:45.764+0000","updated":"2011-09-08T09:49:45.764+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521617/comment/13100302","id":"13100302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"can you validate that the problem exists with a current 5.6-SNAPSHOT. I recall, there was some work in this area.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-08T13:14:24.755+0000","updated":"2011-09-08T13:14:24.755+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521617/comment/13100426","id":"13100426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary, thanks for the response.\nJust tried with 5.6-SNAPSHOT broker and 5.6-SNAPSHOT resource adapter and still we have exactly the same problem :-(","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-08T16:23:31.580+0000","updated":"2011-09-08T16:23:31.580+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521617/comment/13103626","id":"13103626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"body":"Thomas, can you re-run the leak and generate two or more heap dumps from that run.   Where one is generated during the beginning of the run and one at the end of the run. \n\nAttaching those heap dumps to this issue might allow us to determine the leak culprit.\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ccorsi","name":"ccorsi","key":"ccorsi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Claudio Corsi","active":true,"timeZone":"America/Montreal"},"created":"2011-09-13T13:39:20.889+0000","updated":"2011-09-13T13:39:20.889+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521617/comment/13119630","id":"13119630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"No information provided on how to reproduce or test case attached.  Suggest testing with a newer version of the broker, 5.6 SNAPSHOT has many fixes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-10-03T21:23:06.597+0000","updated":"2011-10-03T21:23:06.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521617/comment/13146911","id":"13146911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"body":"I was unable to dedicate time to this defect due to work pressures. Now back on an activemq related task and have created the requested heap dumps on the very latest 5.6 activemq and resource adaptor snapshots.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-09T10:17:06.827+0000","updated":"2011-11-09T10:29:10.243+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521617/comment/13146918","id":"13146918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"body":"Attached are heapdumps from before and after we sent three hundred messages to a topic. Each message was within its own XATransaction, which was rolled back before the next message was sent. The memory on the queue increased 3% during that time.\nFiles are too large (45mb) for bugzilla. Is there an alternative location (e.g. ftp) where they can be sent?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geeky.diamond%40gmail.com","name":"geeky.diamond@gmail.com","key":"geeky.diamond@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Bailey","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-09T10:26:43.226+0000","updated":"2011-11-09T10:57:31.272+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3487/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0eain:"}}