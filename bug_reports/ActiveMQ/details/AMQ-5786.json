{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12831395","self":"https://issues.apache.org/jira/rest/api/2/issue/12831395","key":"AMQ-5786","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2016-01-20T22:45:29.614+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jan 21 10:53:08 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_21196725125_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-01-20T22:45:29.580+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5786/watchers","watchCount":6,"isWatching":false},"created":"2015-05-20T14:46:44.510+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[{"id":"12455069","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12455069","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12493645","key":"AMQ-3098","self":"https://issues.apache.org/jira/rest/api/2/issue/12493645","fields":{"summary":"Failed to page in more queue messages - Cannot consume messages","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12455071","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12455071","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12933042","key":"AMQ-6134","self":"https://issues.apache.org/jira/rest/api/2/issue/12933042","fields":{"summary":"ActiveMQ corrupted state when local disk fills up and Queues begin to buffer to KahaDB","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-01-21T11:07:30.199+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325017","id":"12325017","name":"KahaDB"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"ActiveMQ failed to start up, with the following information:\n\n{noformat}\n2015-05-20 14:23:21,709 | INFO  | apache.activemq.server]) | Journal                          | tore.kahadb.disk.journal.Journal  219 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Corrupt journal records found in 'activemq/kahadb/db-1.log' between offsets: 5504795..5505130\n2015-05-20 14:23:21,725 | INFO  | apache.activemq.server]) | Journal                          | tore.kahadb.disk.journal.Journal  219 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Corrupt journal records found in 'activemq/kahadb/db-1.log' between offsets: 5611475..5612818\n2015-05-20 14:23:21,749 | INFO  | apache.activemq.server]) | Journal                          | tore.kahadb.disk.journal.Journal  219 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Corrupt journal records found in 'activemq/kahadb/db-1.log' between offsets: 6139835..6140254\n2015-05-20 14:23:21,756 | INFO  | apache.activemq.server]) | Journal                          | tore.kahadb.disk.journal.Journal  219 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Corrupt journal records found in 'activemq/kahadb/db-1.log' between offsets: 6246179..6247270\n2015-05-20 14:23:21,765 | INFO  | apache.activemq.server]) | Journal                          | tore.kahadb.disk.journal.Journal  219 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Corrupt journal records found in 'activemq/kahadb/db-1.log' between offsets: 6512519..6520426\n2015-05-20 14:23:21,789 | INFO  | apache.activemq.server]) | Journal                          | tore.kahadb.disk.journal.Journal  219 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Corrupt journal records found in 'activemq/kahadb/db-1.log' between offsets: 7606018..7627848\n2015-05-20 14:23:21,794 | INFO  | apache.activemq.server]) | Journal                          | tore.kahadb.disk.journal.Journal  219 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Corrupt journal records found in 'activemq/kahadb/db-1.log' between offsets: 7630473..7650409\n2015-05-20 14:23:21,796 | INFO  | apache.activemq.server]) | Journal                          | tore.kahadb.disk.journal.Journal  219 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Corrupt journal records found in 'activemq/kahadb/db-1.log' between offsets: 7650488..7703243\n2015-05-20 14:23:22,065 | INFO  | apache.activemq.server]) | MessageDatabase                  | .kahadb.MessageDatabase$Metadata  168 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | KahaDB is version 5\n2015-05-20 14:23:22,188 | INFO  | apache.activemq.server]) | MessageDatabase                  | emq.store.kahadb.MessageDatabase  603 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Recovering from the journal ...\n2015-05-20 14:23:22,188 | ERROR | apache.activemq.server]) | BrokerService                    | he.activemq.broker.BrokerService  609 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Failed to start Apache ActiveMQ ([broker-amq, null], java.io.IOException: Invalid location: 1:6516763, : java.lang.NegativeArraySizeException)\n2015-05-20 14:23:22,189 | INFO  | apache.activemq.server]) | BrokerService                    | he.activemq.broker.BrokerService  758 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Apache ActiveMQ 5.11.1 (broker-amq, null) is shutting down\n2015-05-20 14:23:22,194 | INFO  | apache.activemq.server]) | TransportConnector               | tivemq.broker.TransportConnector  291 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Connector openwire stopped\n2015-05-20 14:23:22,372 | INFO  | apache.activemq.server]) | JobSchedulerStoreImpl            | .scheduler.JobSchedulerStoreImpl  259 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | JobSchedulerStore: activemq/broker-amq/scheduler stopped.\n2015-05-20 14:23:22,372 | INFO  | apache.activemq.server]) | PListStoreImpl                   | tore.kahadb.plist.PListStoreImpl  356 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | PListStore:[/integrator/int1/proc/broker-amq/karaf-std-0.2-440/activemq/broker-amq/tmp_storage] stopped\n2015-05-20 14:23:22,372 | INFO  | apache.activemq.server]) | KahaDBStore                      | ctivemq.store.kahadb.KahaDBStore  245 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Stopping async queue tasks\n2015-05-20 14:23:22,372 | INFO  | apache.activemq.server]) | KahaDBStore                      | ctivemq.store.kahadb.KahaDBStore  259 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Stopping async topic tasks\n2015-05-20 14:23:22,373 | INFO  | apache.activemq.server]) | KahaDBStore                      | ctivemq.store.kahadb.KahaDBStore  287 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Stopped KahaDB\n2015-05-20 14:23:22,664 | INFO  | apache.activemq.server]) | BrokerService                    | he.activemq.broker.BrokerService  819 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Apache ActiveMQ 5.11.1 (broker-amq, null) uptime 1.245 seconds\n2015-05-20 14:23:22,664 | INFO  | apache.activemq.server]) | BrokerService                    | he.activemq.broker.BrokerService  821 | 105 - org.apache.activemq.activemq-osgi - 5.11.1 | Apache ActiveMQ 5.11.1 (broker-amq, null) is shutdown\n2015-05-20 14:23:22,676 | ERROR | apache.activemq.server]) | configadmin                      | ?                                   ? | 6 - org.apache.felix.configadmin - 1.8.0 | [org.osgi.service.cm.ManagedServiceFactory, id=673, bundle=105/mvn:org.apache.activemq/activemq-osgi/5.11.1]: Updating configuration org.apache.activemq.server.02ee5a2d-fb5b-48ce-b4e1-93ed72adba19 caused a problem: Cannot start the broker\norg.osgi.service.cm.ConfigurationException: null : Cannot start the broker\n        at org.apache.activemq.osgi.ActiveMQServiceFactory.updated(ActiveMQServiceFactory.java:120)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at Proxyfc1340e4_63f4_474d_995e_cdb9ac0c71b9.updated(Unknown Source)[:]\n        at org.apache.felix.cm.impl.helper.ManagedServiceFactoryTracker.provideConfiguration(ManagedServiceFactoryTracker.java:88)[6:org.apache.felix.configadmin:1.8.0]\n        at org.apache.felix.cm.impl.ConfigurationManager$ManagedServiceFactoryUpdate.provide(ConfigurationManager.java:1605)[6:org.apache.felix.configadmin:1.8.0]\n        at org.apache.felix.cm.impl.ConfigurationManager$ManagedServiceFactoryUpdate.run(ConfigurationManager.java:1548)[6:org.apache.felix.configadmin:1.8.0]\n        at org.apache.felix.cm.impl.UpdateThread.run(UpdateThread.java:103)[6:org.apache.felix.configadmin:1.8.0]\n        at java.lang.Thread.run(Thread.java:745)[:1.8.0_45]\nCaused by: java.io.IOException: Invalid location: 1:6516763, : java.lang.NegativeArraySizeException\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAccessor.readRecord(DataFileAccessor.java:92)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.store.kahadb.disk.journal.Journal.read(Journal.java:619)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.store.kahadb.MessageDatabase.load(MessageDatabase.java:1013)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.store.kahadb.MessageDatabase.recover(MessageDatabase.java:605)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.store.kahadb.MessageDatabase.open(MessageDatabase.java:399)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.store.kahadb.MessageDatabase.load(MessageDatabase.java:417)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.store.kahadb.MessageDatabase.doStart(MessageDatabase.java:261)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.store.kahadb.KahaDBStore.doStart(KahaDBStore.java:206)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter.doStart(KahaDBPersistenceAdapter.java:223)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.broker.BrokerService.doStartPersistenceAdapter(BrokerService.java:651)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.broker.BrokerService.startPersistenceAdapter(BrokerService.java:640)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.broker.BrokerService.start(BrokerService.java:605)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        at org.apache.activemq.osgi.ActiveMQServiceFactory.updated(ActiveMQServiceFactory.java:116)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        ... 6 more\nCaused by: java.lang.NegativeArraySizeException\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAccessor.readRecord(DataFileAccessor.java:87)[105:org.apache.activemq.activemq-osgi:5.11.1]\n        ... 20 more\n{noformat}\n\n<kahaDB> is configured with checkForCorruptJournalFiles=\"true\".\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ActiveMQ failed to start with KahaDB reporting corrupt journal records and throwing NegativeArraySizeException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Zurich"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Zurich"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Karaf 3.0.3","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12831395/comment/15109638","id":"15109638","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Without more information there is little that can be done here, we'd need broker logs and if possible a test that can reproduce the situation or a copy of the faulty index / journal to determine what might have gone wrong.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-01-20T22:45:29.614+0000","updated":"2016-01-20T22:45:29.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12831395/comment/15110419","id":"15110419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=psmith%40apache.org","name":"psmith@apache.org","key":"psmith@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Smith","active":true,"timeZone":"Australia/Sydney"},"body":"We have faced the same situation for the 3rd time now, this looks the same as reported in AMQ-3098.\n\nI can provide a copy of the ActiveMQ logs and a copy of the Kahadb in the state it was in when it went south.\n\nFundamentally though I think the KahaDB db/txn log allocation is flawed, because it ought to (IMHO) pre-allocate logs as per the sizes specified to ensure it 'grabs' the allocated space and then can't lose a chance to allocate one in some future time (when sadly the disk fills up).\n\nIn our case what was happening was that rsyslog could not route some application logs downstream, and started stalling the consumer application (the one doing the logging) so the Queue built up, and eventually when rsyslog had starved the local disk, ActiveMQ could not correctly allocate any more redo log space, and throwing the error.\n\nIt is unrecoverable at this point, I've tried moving aside Kaha individual log files, but it doesn't help, the whole KahaDB data store needs to be purged, and then ActiveMQ restarted.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=psmith%40apache.org","name":"psmith@apache.org","key":"psmith@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Smith","active":true,"timeZone":"Australia/Sydney"},"created":"2016-01-21T10:53:08.569+0000","updated":"2016-01-21T10:53:08.569+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5786/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ezpj:"}}