{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482787","self":"https://issues.apache.org/jira/rest/api/2/issue/12482787","key":"AMQ-1859","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-12-22T16:23:07.980+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Feb 26 16:40:59 UTC 2009","customfield_12310420":"84746","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_19344591461_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-02-26T16:40:59.988+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1859/watchers","watchCount":3,"isWatching":false},"created":"2008-07-17T19:11:08.527+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-02-26T16:40:59.987+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Browsing a queue aggressively ( ie repeatedly with high frequency ) that is also experiencing message production and consumption results in some messages failing to be delivered to pre-registered consumers.  Messages are visible on the queue to new consumers, but not pre-existing ones.\n\nI've attached a junit test case that show this behaviour.  Note that since this is a race condition, it manifests sporadically.  You may need to run the test a few times before it fails.\n\nThe interesting bit is the method testProducerBrowserConsumer().  This sets up a couple of message producers, a message consumer, and a message browser on the same queue.  The producers send a known number of messages on the queue while the browsers creates a number of queue browsers and iterates through the contents.  The consumer pulls messages from the queue using a receive method set to time out after 30 sec.  Once the consumer exits, we start a cleanup consumer to process any remaining messages on the queue.  There should be zero messages outstanding.  This is often not the case.  I've modified the test case, originally, we just asserted that we had received the sent number of messages.  I added the cleanup receiver to demonstrate that new consumers on the queue can see messages that pre-existing ones do not.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461147","id":"12461147","filename":"ASF.LICENSE.NOT.GRANTED--QueueBrowserTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aenache","name":"aenache","key":"aenache","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anthony Enache","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-17T19:11:08.565+0000","size":8454,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461147/ASF.LICENSE.NOT.GRANTED--QueueBrowserTest.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161833","customfield_12312823":null,"summary":"Race condition when browsing a queue with active Producers / Consumers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aenache","name":"aenache","key":"aenache","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anthony Enache","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aenache","name":"aenache","key":"aenache","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anthony Enache","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP Professional, SP2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482787/comment/12940595","id":"12940595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Can you test this one against 5.2.0. It should be fixed. Thanks, Dejan","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2008-12-22T16:23:07.980+0000","updated":"2008-12-22T16:23:07.980+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482787/comment/12940833","id":"12940833","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aenache","name":"aenache","key":"aenache","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anthony Enache","active":true,"timeZone":"Etc/UTC"},"body":"Hello Dejan,\n\nI've tested this with the 5.1, 5.2, and the Feb. 17, 2009 5.3 snapshot.\nThey all failed, but in slightly different ways.  I've modified the\nQueueBrowserTest.java file to show this by changing the\ntestProducerBrowserConsumer() method as below.\n\nPreviously, the method verified that \"Cleanup Receiver 1\" did not see any\nmessages on the queue.  In 5.1 and 5.2 this test would fail.  In 5.3 it now\npasses.  However, in all versions, the number of sent messages does not\nequal the number received.  I have added this assertion to the test and it\nfails across the board.\n\n\n  public void testProducerBrowserConsumer() throws InterruptedException,\nJMSException\n  {\n    int      count     = 1000;\n    Producer producer1 = new Producer(\"Producer 1\", count / 2);\n    Producer producer2 = new Producer(\"Producer 2\", count / 2);\n    Browser  browser   = new Browser(\"Browser 1\");\n    Receiver receiver  = new Receiver(\"Receiver 1\");\n\n    browser.start();\n    receiver.start();\n    producer1.start();\n    producer2.start();\n    receiver.join();\n    browser.finish();\n\n    int received = receiver.getCount();\n\n    System.out.println(\"Received \" + received + \" of \" + count + \".\");\n\n    receiver  = new Receiver(\"Cleanup Receiver 1\");\n    receiver.start();\n    receiver.join();\n\n    assertEquals(0, receiver.getCount());\n    assertEquals(count, received);\n  }\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aenache","name":"aenache","key":"aenache","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anthony Enache","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-24T14:24:59.456+0000","updated":"2009-02-24T14:24:59.456+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482787/comment/12940820","id":"12940820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Anthony, thanks for this update, I'll take a look.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2009-02-24T14:34:11.743+0000","updated":"2009-02-24T14:34:11.743+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482787/comment/12940849","id":"12940849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Fix committed to SVN revision 748204.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2009-02-26T16:40:59.943+0000","updated":"2009-02-26T16:40:59.943+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1859/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s27b:"}}