{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482841","self":"https://issues.apache.org/jira/rest/api/2/issue/12482841","key":"AMQ-844","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-07-25T08:52:37.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Jan 28 09:50:32 UTC 2007","customfield_12310420":"84446","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_98276505710_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-09-04T18:38:04.710+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-844/watchers","watchCount":1,"isWatching":false},"created":"2006-07-25T07:36:19.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315612","id":"12315612","description":"","name":"4.0.2","archived":false,"released":true,"releaseDate":"2006-07-25"}],"issuelinks":[{"id":"12335005","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335005","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12482206","key":"AMQ-724","self":"https://issues.apache.org/jira/rest/api/2/issue/12482206","fields":{"summary":"Stomp client is not removed from the broker on client disconnect","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-09-04T18:38:04.686+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"This problem readily occurs running the standard examples:\nant -Durl=tcp://10.10.3.73:61616?trace=true -Dmax=100 consumer  \nant -Durl=tcp://10.10.3.73:61616 -Dmax=10 producer \n...run the producer side for 2-5 iterations before is just hangs. Once it's in that state, all subsequent client connections hang (i.e. control-C out of either consumer or producer and restart the connection: hangs).\n\nUpping and lowering soTimeout and other connection parameters has so far proven fruitless. Switching JVMs, up'ing from 4.0.1 to 4.0.2-SNAPSHOT (on both client and server), and including/excluding \"-Ddurable=true\" made no difference (all orignal test attempts were with durable messages but in the end, not incluing that had no effect on whether or not the clients eventually hang). The config on the server looks like this:\n\n<beans xmlns=\"http://activemq.org/config/1.0\">\n  <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"/>\n  <broker useJmx=\"true\">\n    <persistenceAdapter>\n      <journaledJDBC journalLogFiles=\"5\" dataDirectory=\"../activemq-data\" \n          dataSource=\"#postgres-ds\"/>\n    </persistenceAdapter>\n    <transportConnectors>\n       <transportConnector name=\"default\" uri=\"tcp://10.10.3.73:61616?trace=true\" />\n    </transportConnectors>\n  </broker>\n  <bean id=\"postgres-ds\" class=\"org.postgresql.ds.PGPoolingDataSource\">\n    <property name=\"serverName\" value=\"localhost\"/>\n    <property name=\"databaseName\" value=\"activemq\"/>\n    <property name=\"portNumber\" value=\"0\"/>\n    <property name=\"user\" value=\"activemq\"/>\n    <property name=\"password\" value=\"activemq\"/>\n    <property name=\"dataSourceName\" value=\"postgres\"/>\n    <property name=\"initialConnections\" value=\"5\"/>\n    <property name=\"maxConnections\" value=\"50\"/>\n  </bean>\n</beans> \n\nFWIW, this doesn't happen when running the same tests on a laptop (MacOS tiger) with clients on loopback. Bug is \"Minor\" but (since is't only exhibited by a small group of us)without being able validate the client connections, this is a not show-stopper for production use of activemq.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460864","id":"12460864","filename":"dumpemu3.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tvijlbrief","name":"tvijlbrief","key":"tvijlbrief","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Vijlbrief","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-28T09:54:30.242+0000","size":40165,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12460864/dumpemu3.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"254793","customfield_12312823":null,"summary":"tcp connections hang","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spidaman","name":"spidaman","key":"spidaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Kallen","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spidaman","name":"spidaman","key":"spidaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Kallen","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Tried with j2sdk1.4.2_06 and jdk1.5.0_05 on redhat enterprise linux 4 (2.6 kernel).","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482841/comment/12938035","id":"12938035","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"BTW I wonder if you create a thread dump when things are hanging if there is any kind of deadlock in the broker?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-07-25T08:52:37.000+0000","updated":"2006-07-25T08:52:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482841/comment/12938098","id":"12938098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spidaman","name":"spidaman","key":"spidaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Kallen","active":true,"timeZone":"Etc/UTC"},"body":"We got to the bottom of this. It turned out that there were still some client processes running activemq-3.1-M5 on the network hitting the 4.0.x servers. When took them offline (and then fired them back up with 4.0.2 jars), everything stabilized. If backwards compatibility isn't handled, it'd be nice if there was a graceful degradation; having the servers opaquely cease to be responsive to *any* clients due to the presence of some other old clients was pretty troublesome.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spidaman","name":"spidaman","key":"spidaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Kallen","active":true,"timeZone":"Etc/UTC"},"created":"2006-07-26T00:18:31.000+0000","updated":"2006-07-26T00:18:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482841/comment/12938778","id":"12938778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tvijlbrief","name":"tvijlbrief","key":"tvijlbrief","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Vijlbrief","active":true,"timeZone":"Etc/UTC"},"body":"This bug is still present in 4.1!\n\nWhen running Stomp C clients and terminating them the TCP-connection is closed\nbut still visible in JConsole (see screendump)\n\ntom@nomad:~$ netstat -t\nActive Internet connections (w/o servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State\ntcp        0      0 nomad.local:47610       pop.xs4all.nl:pop3      ESTABLISHED\ntcp        0      0 localhost:32000         localhost:31000         ESTABLISHED\ntcp        0      0 nomad.local:36415       userimap.xs4all.n:imap2 ESTABLISHED\ntcp        0      0 nomad.local:39095       userimap.xs4all.n:imap2 ESTABLISHED\ntcp6       0      0 localhost:45628         localhost:61616         ESTABLISHED\ntcp6       0      0 localhost:38235         localhost:46749         ESTABLISHED\ntcp6       0      0 localhost:34009         localhost:8093          ESTABLISHED\ntcp6       0      0 localhost:33475         localhost:46749         ESTABLISHED\ntcp6       0      0 localhost:51894         localhost:46749         TIME_WAIT\ntcp6       0      0 localhost:46749         localhost:33475         ESTABLISHED\ntcp6       0      0 localhost:31000         localhost:32000         ESTABLISHED\ntcp6       1      0 nomad.local:44358       eris.apache.org:www     CLOSE_WAIT\ntcp6       1      0 nomad.local:45311       eris.apache.org:www     CLOSE_WAIT\ntcp6       0      0 localhost:8093          localhost:34009         ESTABLISHED\ntcp6       0      0 localhost:61616         localhost:45628         ESTABLISHED\ntcp6       0      0 localhost:46749         localhost:38235         ESTABLISHED\ntcp6       1      0 nomad.local:54433       eris.apache.org:www     CLOSE_WAIT\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tvijlbrief","name":"tvijlbrief","key":"tvijlbrief","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Vijlbrief","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-28T09:50:32.819+0000","updated":"2007-01-28T09:50:32.819+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-844/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i17zxz:"}}