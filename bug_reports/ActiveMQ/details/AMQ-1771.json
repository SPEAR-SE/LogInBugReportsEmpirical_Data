{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482415","self":"https://issues.apache.org/jira/rest/api/2/issue/12482415","key":"AMQ-1771","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-06-05T17:58:34.098+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jun 20 05:22:46 UTC 2008","customfield_12310420":"84775","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_23492095_*|*_5_*:*_2_*:*_331255433_*|*_4_*:*_1_*:*_206581993","customfield_12312321":null,"resolutiondate":"2008-06-11T23:22:31.556+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1771/watchers","watchCount":1,"isWatching":false},"created":"2008-06-05T11:27:02.035+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-06-20T05:22:46.038+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The FailoverTransport does currently not signal the initial resume of the transport (due to race condition) nor the failure (if maxReconnectAttempts is 0) and therefore we don't know if the connection is successfully connected or not.\n\nThe attached patch adds a sleep (copied from the failure processing part some lines below) that ensures that the ??transportListener?? is set and the ??transportListener.transportResumed()?? is called.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461161","id":"12461161","filename":"amq-failover-reconnect.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuhtz","name":"akuhtz","key":"akuhtz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=akuhtz&avatarId=14846","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=akuhtz&avatarId=14846","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=akuhtz&avatarId=14846","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=akuhtz&avatarId=14846"},"displayName":"Andreas Kuhtz","active":true,"timeZone":"Europe/Berlin"},"created":"2008-06-09T14:00:31.594+0000","size":1306,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461161/amq-failover-reconnect.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460985","id":"12460985","filename":"ASF.LICENSE.NOT.GRANTED--amq-failover.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuhtz","name":"akuhtz","key":"akuhtz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=akuhtz&avatarId=14846","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=akuhtz&avatarId=14846","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=akuhtz&avatarId=14846","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=akuhtz&avatarId=14846"},"displayName":"Andreas Kuhtz","active":true,"timeZone":"Europe/Berlin"},"created":"2008-06-05T11:27:02.188+0000","size":1668,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12460985/ASF.LICENSE.NOT.GRANTED--amq-failover.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"161748","customfield_12312823":null,"summary":"Failover transport should always signal resume of transport","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuhtz","name":"akuhtz","key":"akuhtz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=akuhtz&avatarId=14846","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=akuhtz&avatarId=14846","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=akuhtz&avatarId=14846","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=akuhtz&avatarId=14846"},"displayName":"Andreas Kuhtz","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuhtz","name":"akuhtz","key":"akuhtz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=akuhtz&avatarId=14846","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=akuhtz&avatarId=14846","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=akuhtz&avatarId=14846","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=akuhtz&avatarId=14846"},"displayName":"Andreas Kuhtz","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"WinXP, JDK5","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482415/comment/12939757","id":"12939757","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed by SVN revision 663680 and 663691","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-05T17:58:34.098+0000","updated":"2008-06-05T18:12:14.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482415/comment/12939782","id":"12939782","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuhtz","name":"akuhtz","key":"akuhtz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=akuhtz&avatarId=14846","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=akuhtz&avatarId=14846","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=akuhtz&avatarId=14846","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=akuhtz&avatarId=14846"},"displayName":"Andreas Kuhtz","active":true,"timeZone":"Europe/Berlin"},"body":"There is another timing issue because the reconnect task is triggered via the {{FailoverTransport.add(URI u[])}} method before the connection is configured (see {{ActiveMConnectionFactory.createActiveMQConnection(...)}}) and therefore the transport listener is not set.\n\nThe attached patch (amq-failover-reconnect.patch) checks if the transport is started and does not call {{reconnect()}} because the {{start()}} will do it later after the connection is configured.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akuhtz","name":"akuhtz","key":"akuhtz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=akuhtz&avatarId=14846","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=akuhtz&avatarId=14846","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=akuhtz&avatarId=14846","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=akuhtz&avatarId=14846"},"displayName":"Andreas Kuhtz","active":true,"timeZone":"Europe/Berlin"},"created":"2008-06-09T13:59:29.518+0000","updated":"2008-06-09T13:59:29.518+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482415/comment/12939791","id":"12939791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed by revision 666893","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-11T23:22:31.512+0000","updated":"2008-06-11T23:22:31.512+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482415/comment/12939877","id":"12939877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janbartel","name":"janbartel","key":"janbartel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Bartel","active":true,"timeZone":"Australia/Sydney"},"body":"Hi Rob,\n\nA jetty hightide user has posted me the following problem description, which I think may be fixed by the patches above, but I'm not entirely sure - could you confirm for me if that's the case?\n\nHere's the problem as it was reported:\n\n\"ActiveMQConnection\n—————————\nThe Main thread is stuck waiting for ActiveMQConnection.brokerInfoReceived CountDownLatch in the ActiveMQConnection.waitForBrokerInfo() method. The brokerInfoReceived latch is released when the ActiveMQConnection.onCommand().processBrokerInfo() Listner event is received.\n\nFailoverTransport\n————————-\nWhen the FailoverTransport is instantiated it immediately attempts to connect to the brokers. On successful connection to the broker it calls the Listener, if one is attached.\nThe processBrokerInfo command from the broker is sent to the listener, in this case the ActiveMQConnection which releases the latch.\n\nThe sequence of wiring the connection to the transport is as follows...\n- ActiveMQConnectionFactory.createActiveMQConnection() creates the transport, then creates the ActiveMQConnection(transport)\n- The ActiveMQConnection constructor calls transport.setTransportListener(this) which attaches the connection listener to the transport\n- Finally the factory calls start() on the transport\n\nThe problem is the FailoverTransport starts to connect doReconnect() at construction time using its own thread. On successful connection to the broker it notifies using the listener but only if the listener is set. The race condition occurs on the main thread to attach the listener to the FailoverTransport before the FailoverTransport connects. If the FailoverTransport connects and the listener is not connected, notification messages are lost..\"\n\nta muchly,\nJan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janbartel","name":"janbartel","key":"janbartel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Bartel","active":true,"timeZone":"Australia/Sydney"},"created":"2008-06-20T05:22:46.015+0000","updated":"2008-06-20T05:22:46.015+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1771/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s1of:"}}