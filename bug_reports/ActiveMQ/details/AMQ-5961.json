{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12863111","self":"https://issues.apache.org/jira/rest/api/2/issue/12863111","key":"AMQ-5961","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329848","id":"12329848","name":"5.13.0","archived":false,"released":true,"releaseDate":"2015-12-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-09-10T16:51:36.772+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Oct 01 13:36:56 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1803487156_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-10-01T13:36:56.205+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5961/watchers","watchCount":5,"isWatching":false},"created":"2015-09-10T16:38:49.084+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324951","id":"12324951","name":"5.11.0","archived":false,"released":true,"releaseDate":"2015-02-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-01T13:36:56.233+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12324517","id":"12324517","name":"RAR"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When we run JBoss EAP 6.4 with high load using AMQ 6.2 (ActiveMQ 5.11) everything grinds to a halt after a few hours. We have 170 threads blocked on the same lock:\n\n\"default-threads - 1400\" #406720 prio=5 os_prio=0 tid=0x00007f1b8402b800 nid=0xfe2d waiting for monitor entry [0x00007f19ccdd5000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat org.apache.activemq.TransactionContext.setXid(TransactionContext.java:729)\n\t- waiting to lock <0x000000063ac688b8> (a java.util.HashMap)\n\tat org.apache.activemq.TransactionContext.end(TransactionContext.java:418)\n\tat org.apache.activemq.ra.LocalAndXATransaction.end(LocalAndXATransaction.java:98)\n\tat org.jboss.jca.core.tx.jbossts.XAResourceWrapperImpl.end(XAResourceWrapperImpl.java:118)\n\tat com.arjuna.ats.internal.jta.resources.arjunacore.XAResourceRecord.topLevelPrepare(XAResourceRecord.java:208)\n\tat com.arjuna.ats.arjuna.coordinator.BasicAction.doPrepare(BasicAction.java:2530)\n\tat com.arjuna.ats.arjuna.coordinator.BasicAction.doPrepare(BasicAction.java:2497)\n\tat com.arjuna.ats.arjuna.coordinator.BasicAction.prepare(BasicAction.java:2074)\n\t- locked <0x000000067461c090> (a com.arjuna.ats.internal.jta.transaction.arjunacore.AtomicAction)\n\tat com.arjuna.ats.arjuna.coordinator.BasicAction.End(BasicAction.java:1485)\n\t- locked <0x000000067461c090> (a com.arjuna.ats.internal.jta.transaction.arjunacore.AtomicAction)\n\tat com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.end(TwoPhaseCoordinator.java:98)\n\tat com.arjuna.ats.arjuna.AtomicAction.commit(AtomicAction.java:162)\n\nThis lock is owned by a thread that is waiting for another lock:\n\n\"default-threads - 1381\" #404073 prio=5 os_prio=0 tid=0x00007f1a6403c000 nid=0x7d49 waiting on condition [0x00007f19d8a91000]\n   java.lang.Thread.State: WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x000000063ab2a260> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:870)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1199)\n\tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:209)\n\tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)\n\tat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:66)\n\tat org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\n\tat org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1309)\n\tat org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1303)\n\tat org.apache.activemq.ActiveMQSession.asyncSendPacket(ActiveMQSession.java:2008)\n\tat org.apache.activemq.ActiveMQSession$5.afterRollback(ActiveMQSession.java:973)\n\tat org.apache.activemq.TransactionContext.afterRollback(TransactionContext.java:162)\n\tat org.apache.activemq.TransactionContext.prepare(TransactionContext.java:482)\n\t- locked <0x000000063ac688b8> (a java.util.HashMap)\n\tat org.apache.activemq.ra.LocalAndXATransaction.prepare(LocalAndXATransaction.java:130)\n\tat com.arjuna.ats.internal.jta.resources.arjunacore.XAResourceRecord.topLevelPrepare(XAResourceRecord.java:213)\n\tat com.arjuna.ats.arjuna.coordinator.BasicAction.doPrepare(BasicAction.java:2530)\n\tat com.arjuna.ats.arjuna.coordinator.BasicAction.doPrepare(BasicAction.java:2497)\n\nThe locked object is ENDED_XA_TRANSACTION_CONTEXTS in TransactionContext. The thread that has the lock calls afterRollback without first releasing it and afterRollback does not return promptly (not at all in fact, we need to restart the server to fix this). The same can happen with afterCommit, which is also called from within a synchronized block causing a potential deadlock.\n\nI think I have a fix for this and will create a pull request in github, or if you prefer I can send a patch? It simply means moving the external calls out from the synchronized blocks and would both remove the very real deadlock risks and improve performance.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12762510","id":"12762510","filename":"edited-trace.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"created":"2015-09-26T09:29:25.703+0000","size":1332029,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12762510/edited-trace.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Deadlock in client blocks all application server threads","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Platform independent","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14739101","id":"14739101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user erik-wramner opened a pull request:\n\n    https://github.com/apache/activemq/pull/141\n\n    https://issues.apache.org/jira/browse/AMQ-5961\n\n    Prevent deadlock by moving calls to afterCommit\n    and afterRollback out of synchronized blocks.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/erik-wramner/activemq master\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/141.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #141\n    \n----\ncommit bb2a9acaca34be9a96fa785396cca8d34255e8cd\nAuthor: erik-wramner <erik@wramner.name>\nDate:   2015-09-10T16:44:36Z\n\n    https://issues.apache.org/jira/browse/AMQ-5961\n    \n    Prevent deadlock by moving calls to afterCommit\n    and afterRollback out of synchronized blocks.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-10T16:51:36.772+0000","updated":"2015-09-10T16:51:36.772+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14877273","id":"14877273","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user erik-wramner closed the pull request at:\n\n    https://github.com/apache/activemq/pull/141\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-19T18:56:24.225+0000","updated":"2015-09-19T18:56:24.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14877456","id":"14877456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"body":"Pull request submitted, tests passed. How do I go about getting this into the release?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"created":"2015-09-20T08:10:10.081+0000","updated":"2015-09-20T08:10:10.081+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14899892","id":"14899892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"It looks like the pull request is closed and doesn't show any commits, can you reopen it so I can take a look?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-09-20T12:06:46.446+0000","updated":"2015-09-20T12:06:46.446+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14899907","id":"14899907","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"body":"Sorry, I moved the commit to a dedicated branch in order to rebase. I have created a new pull request with the same code now, I didn't know that moving the commit would close the pull request.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"created":"2015-09-20T12:44:25.807+0000","updated":"2015-09-20T12:44:25.807+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14899921","id":"14899921","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user erik-wramner opened a pull request:\n\n    https://github.com/apache/activemq/pull/143\n\n    https://issues.apache.org/jira/browse/AMQ-5961\n\n    Prevent deadlock by moving calls to afterCommit and afterRollback out of synchronized blocks.\n    Same commit as before, moved it to separate branch.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/erik-wramner/activemq amq5961-deadlock\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/143.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #143\n    \n----\ncommit 7c98fdd2819a34fe06b38555601ceaecd5f53aaa\nAuthor: erik-wramner <erik@wramner.name>\nDate:   2015-09-10T16:44:36Z\n\n    https://issues.apache.org/jira/browse/AMQ-5961\n    \n    Prevent deadlock by moving calls to afterCommit\n    and afterRollback out of synchronized blocks.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-20T13:12:32.008+0000","updated":"2015-09-20T13:12:32.008+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14899946","id":"14899946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"That patch might work but I'm a little concerned that the iteration of the list outside of a synchronization block could cause other issues such as concurrent modification exceptions if another thread tried to insert into the list.\n\nSince this is only a partial thread dump, I am wondering why the afterRollback() call is never returning and stuck waiting for the MutexTransport write lock.  Is there an actual deadlock in that sense that the thread that has acquired the MutexTransport lock is waiting to acquire the ENDED_XA_TRANSACTION_CONTEXTS lock or is there some other reason why the MutexTransport lock can't be acquired? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-09-20T13:57:01.215+0000","updated":"2015-09-20T13:57:01.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14900024","id":"14900024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"body":"That is a valid point. I have changed the code so that it synchronizes on the list, keeping the global lock on the map short.\n\nThe thread with the MutexTransport is waiting for the communication channel to the broker to be reestablished. I'm not sure why that doesn't happen. It may be that the thread that should take care of that is blocked on the global map or it may be due to something else. We have two issues here. We are trying to sort out the communication issue with Red Hat. The broker is live and working, but obviously something is wrong.\n\nHowever, even if everything had worked out the global lock must hurt performance. It makes all other threads working with other destinations and transactions wait for this specific thread and transaction to complete its afterCommit or afterRollback calls. That must hurt. And it may cause the server to hang as it does in this case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"created":"2015-09-20T18:40:47.323+0000","updated":"2015-09-20T18:40:47.323+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14901308","id":"14901308","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Looks like the PR got closed again. \n\nAnd as you pointed out, we can look at seeing if it makes sense to get rid of the global lock for performance reasons.  But this specific bug in this case certainly seems to be that the afterRollback is stuck.  Even if you took away the locking, you'd have all of your threads stuck waiting forever for afterRollback to finish which would still cause the broker to quit working eventually.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-09-21T20:12:38.863+0000","updated":"2015-09-21T20:12:38.863+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14904020","id":"14904020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"body":"Pull request 143 (https://github.com/apache/activemq/pull/143) is open, 141 is closed.\n\nAs for all threads becoming stuck I don't agree for two reasons. First it might be that the thread that is supposed to reestablish communication is blocked on the locked HashMap. I don't know the code base well enough to easily find out, but I can dig into the stack trace. If that is the case we have a true deadlock and it would help to get rid of the global lock. Second even if afterRollback blocks forever that will kill one thread and one transaction, but without the global lock it may be possible for the other 169 threads to proceed with their work for new transactions (possibly for other queues/topics if the queue/topic is broken). They may also get blocked by other things, but it is possible that they can proceed. That could make the difference between a panic and a planned restart after peak times.\n\nBy the way, I changed the code again so that it doesn't lock the list when it has been removed from the map. Instead all additions to the list are within the map's lock. That way additions are protected and nothing can modify the list when it has been removed, so it can be processed safely without locks. That gets rid of the possible global lock in isInXATransaction, where the previous version locked the map and then tried to get a lock on the list.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"created":"2015-09-23T06:08:52.688+0000","updated":"2015-09-23T06:08:52.688+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14906176","id":"14906176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"[~gtully], Can you take a look at this when you get a chance to see what you think about the proposed changes of to the transactional behavior here? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-09-24T10:30:46.878+0000","updated":"2015-09-24T10:30:46.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14908162","id":"14908162","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~erik.wramner] can you attach the full thread dump, just to determine why there is no response from the broker. thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-25T15:31:17.673+0000","updated":"2015-09-25T15:31:17.673+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14909175","id":"14909175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"body":"Stack trace, application-specific package/class names replaced.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"created":"2015-09-26T09:29:25.712+0000","updated":"2015-09-26T09:29:25.712+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14933473","id":"14933473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"peeking at the thread dump the root cause is: {code}at org.apache.activemq.transport.failover.FailoverTransport.oneway(FailoverTransport.java:614){code}. There was a recent fix (https://issues.apache.org/jira/browse/AMQ-5951) in that area but there is also a workaround via timeout=1 for the failover transport.\nThe RAR does it's own reconnection and as a result the failover transport should not block on a reconnect and rather propagate the failure back to the caller, ie: maxReconnectAttempts=0 needs to be used on the failover url.\nPeeking more at the fix, I think the canReconnect check may also be needed at line 609. Need to verify that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-28T15:49:32.045+0000","updated":"2015-09-28T15:52:44.744+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14933860","id":"14933860","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"body":"I'm quite sure we were using maxReconnectAttempts=0, but not timeout=1. Good to know.\n\nStill, unless you think the global lock is needed in order to ensure correctness somehow I would still argue for getting rid of it. It must hurt performance to make all the other threads wait for the afterCommit/afterRollback processing to complete and as illustrated here there is always a risk for liveness problems.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"created":"2015-09-28T19:40:51.117+0000","updated":"2015-09-28T19:40:51.117+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14936704","id":"14936704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I think the pull request looks fine and I see your point about liveness. The only issue is the lack of tests in this area and no additional test are included. However if you found some benefit in your use case it can make some sense to include this.\nI can't see any point in holding the lock for callback processing from an transaction integrity point of view :-)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-30T10:52:13.360+0000","updated":"2015-09-30T10:52:13.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14939537","id":"14939537","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"body":"Good. I like tests, but I can't see how I could write a good one for this. It happens after a few hours of heavy load. I guess I can mock it, but then the test would just work the way I intended...\n\nIf you are happy with the pull request perhaps you or Christopher can accept it?\n\n-Erik","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erik.wramner","name":"erik.wramner","key":"erik.wramner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erik.wramner&avatarId=24842","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erik.wramner&avatarId=24842","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erik.wramner&avatarId=24842","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erik.wramner&avatarId=24842"},"displayName":"Erik Wramner","active":true,"timeZone":"Europe/Berlin"},"created":"2015-10-01T09:05:27.577+0000","updated":"2015-10-01T09:05:27.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14939803","id":"14939803","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"I can merge this in and we can let Jenkins run and see if it causes any regressions on the existing tests.  Thanks for reviewing this Gary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-10-01T13:26:28.365+0000","updated":"2015-10-01T13:26:28.365+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14939814","id":"14939814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 9a78bc689f06dde61ba38be1ebc840a53ca02b68 in activemq's branch refs/heads/master from [~erik.wramner]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6 ]\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\n\nPrevent deadlock by moving calls to afterCommit\nand afterRollback out of synchronized blocks.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nLock list but keep global hashmap out for deadlock protection.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nLock safely in isInXATransaction.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nDon't synchronize on list as we have an exclusive reference.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-01T13:35:04.672+0000","updated":"2015-10-01T13:35:04.672+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14939815","id":"14939815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 9a78bc689f06dde61ba38be1ebc840a53ca02b68 in activemq's branch refs/heads/master from [~erik.wramner]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6 ]\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\n\nPrevent deadlock by moving calls to afterCommit\nand afterRollback out of synchronized blocks.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nLock list but keep global hashmap out for deadlock protection.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nLock safely in isInXATransaction.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nDon't synchronize on list as we have an exclusive reference.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-01T13:35:05.646+0000","updated":"2015-10-01T13:35:05.646+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14939816","id":"14939816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 9a78bc689f06dde61ba38be1ebc840a53ca02b68 in activemq's branch refs/heads/master from [~erik.wramner]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6 ]\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\n\nPrevent deadlock by moving calls to afterCommit\nand afterRollback out of synchronized blocks.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nLock list but keep global hashmap out for deadlock protection.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nLock safely in isInXATransaction.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nDon't synchronize on list as we have an exclusive reference.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-01T13:35:06.482+0000","updated":"2015-10-01T13:35:06.482+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14939817","id":"14939817","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 9a78bc689f06dde61ba38be1ebc840a53ca02b68 in activemq's branch refs/heads/master from [~erik.wramner]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6 ]\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\n\nPrevent deadlock by moving calls to afterCommit\nand afterRollback out of synchronized blocks.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nLock list but keep global hashmap out for deadlock protection.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nLock safely in isInXATransaction.\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\nDon't synchronize on list as we have an exclusive reference.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-01T13:35:07.449+0000","updated":"2015-10-01T13:35:07.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14939818","id":"14939818","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 450a5226e01a6a75e5dda4efbf088933fc0878a4 in activemq's branch refs/heads/master from [~cshannon]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=450a522 ]\n\nhttps://issues.apache.org/jira/browse/AMQ-5961\n\nThis closes #143\n\nApplying patch with thanks to Erik Wramner\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-01T13:35:08.271+0000","updated":"2015-10-01T13:35:08.271+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14939820","id":"14939820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/activemq/pull/143\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-01T13:35:18.163+0000","updated":"2015-10-01T13:35:18.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12863111/comment/14939823","id":"14939823","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"I squashed the commits/rebased and applied the change.  If everything looks good after CI runs I can backport the fix to 5.12.1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2015-10-01T13:36:56.230+0000","updated":"2015-10-01T13:36:56.230+0000"}],"maxResults":25,"total":25,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5961/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2k093:"}}