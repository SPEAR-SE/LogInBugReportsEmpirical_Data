{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12507641","self":"https://issues.apache.org/jira/rest/api/2/issue/12507641","key":"AMQ-3327","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2011-05-18T18:54:48.439+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri May 20 13:11:33 UTC 2011","customfield_12310420":"43749","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_153034261_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-05-20T13:11:33.825+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3327/watchers","watchCount":0,"isWatching":false},"created":"2011-05-18T18:40:59.615+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-05-20T13:11:33.871+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Using the STOMP transport, messages from a destination are sometimes being delivered *after* the receipt for unsubscribing from that destination is received.\n\nIn the following example, I subscribed to a queue witha prefetch size of 1, received a message, acknowledged it, then unsubscribed (with a receipt request), received the receipt for the unsubscription, and *then* received a message from the subscription that I just got the receipt for.\n\nThis is particularly problematic if, after unsubscribing from one queue, you want to subscribe to a different queue. Clients may (and will) mistakenly believe that the message they receive is from the new subscription, not the old one.\n\nClients can work around this issue by including subscription ids for all subscriptions, and adding client-side logic to ignore any messages received for non-active subscriptions.\n\nThis is a synchronization issue that may be difficult to reproduce in certain environments, but I was able to reproduce this issue in my test environment using a multi-threaded client that repeatedly subscribes, consumes messages and unsubscribes (with approximately a 1-in-5000 error rate).\n\nNote that the client's expectations may be different for messages received *before* a unsubscribe receipt. Using the STOMP protocol, I expect to see messages for the subscription delivered until I unsubscribe. But I don't expect to see messages delivered after the unsubscribe is confirmed.\n\n{quote}\nSUBSCRIBE\ndestination:/queue/foo\nack:client\nactivemq.prefetchSize:1\nid:dbbeded6-1182-4658-b076-10a064da31f5\n\n\nMESSAGE\nmessage-id:ID:localhost-61955-1305208152844-4:617:-1:1:2952\ndestination:/queue/foo\ntimestamp:1305556042086\nexpires:0\nsubscription:dbbeded6-1182-4658-b076-10a064da31f5\npriority:4\n\nTest2 message (2952 of 5000)\n\nACK\nmessage-id:ID:localhost-61955-1305208152844-4:617:-1:1:2952\n\n\nUNSUBSCRIBE\nid:dbbeded6-1182-4658-b076-10a064da31f5\nreceipt:1d2a8486-ee7a-48ba-842c-d0c47c1be5be\n\n\nRECEIPT\nreceipt-id:1d2a8486-ee7a-48ba-842c-d0c47c1be5be\n\n\nMESSAGE\nredelivered:true\nmessage-id:ID:localhost-61955-1305208152844-4:617:-1:1:2938\ndestination:/queue/foo\ntimestamp:1305556042085\nexpires:0\nsubscription:dbbeded6-1182-4658-b076-10a064da31f5\npriority:4\n\nTest2 message (2938 of 5000)\n{quote}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81714","customfield_12312823":null,"summary":"Messages received after unsubscribe/receipt using STOMP protocol.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=izzyalanis","name":"izzyalanis","key":"izzyalanis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Izzy Alanis","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=izzyalanis","name":"izzyalanis","key":"izzyalanis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Izzy Alanis","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12507641/comment/13035583","id":"13035583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"This isn't actually a bug.  The Stomp 1.0 specification states that \"Any client frame other than CONNECT may specify a receipt header with an arbitrary value. This will cause the server to acknowledge receipt of the frame with a RECEIPT frame which contains the value of this header as the value of the receipt-id header in the RECEIPT packet.\"  \n\nAs stated the receipt header only acknowledges to the client that the broker has received the frame, not that its acted upon it in any way.  You client will need to take into account the fact that messages are dispatched asynchronously and can and do sometimes arrive after you've sent the unsubscribe request.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-05-18T18:54:48.439+0000","updated":"2011-05-18T18:54:48.439+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12507641/comment/13036807","id":"13036807","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Working as designed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-05-20T13:11:33.833+0000","updated":"2011-05-20T13:11:33.833+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3327/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ec1r:"}}