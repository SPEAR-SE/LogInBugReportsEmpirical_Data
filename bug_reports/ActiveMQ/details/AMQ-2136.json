{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482819","self":"https://issues.apache.org/jira/rest/api/2/issue/12482819","key":"AMQ-2136","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-02-23T12:29:05.368+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Sep 11 19:35:07 UTC 2009","customfield_12310420":"75059","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_17444584384_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-09-11T19:35:07.216+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2136/watchers","watchCount":0,"isWatching":false},"created":"2009-02-21T21:52:02.832+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-09-11T19:35:07.188+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313899","id":"12313899","name":"Performance Test","description":"Performance Testing Suite"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When upgrading to AMQ 5.2, my application gets 10x slower. This is traced to the usage of reply queue. I have written a test case (will be attached.)\n\nIn 5.1,\nsender: 16.0 seconds spent for sending 8000 times, avg. 500.0msg/s\n\nIn 5.2:\nsender: 432.0 seconds spent for sending 10000 times, avg. 23.148148msg/s\n\nI have tried arrange the steps a bit (see commented out line,) no help.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461354","id":"12461354","filename":"test.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-21T23:39:58.747+0000","size":5272,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461354/test.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161532","customfield_12312823":null,"summary":"Reply queue performance hit upgrading to 5.2","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows Vista, JDK 1.6","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482819/comment/12940810","id":"12940810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"body":"Note: two classes in the file","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-21T23:39:58.788+0000","updated":"2009-02-21T23:39:58.788+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482819/comment/12940835","id":"12940835","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"body":"BTW it seems the problem is with transacted and CLIENT_ACK. With non-transacted session, it gets to 500 msg/s. But I don't understand why.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-21T23:41:47.398+0000","updated":"2009-02-21T23:41:47.398+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482819/comment/12940832","id":"12940832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"body":"OK, I found out the direct cause. The default amqPersistence store somehow slows to a hell.\n\nAfter I change the persistence adaptor to\n\n        <persistenceAdapter>\n\t    <kahaPersistenceAdapter directory=\"activemq-data\" maxDataFileLength=\"33554432\"/>\n            <!--amqPersistenceAdapter syncOnWrite=\"false\" directory=\"${activemq.base}/data\" maxFileLength=\"20 mb\"/-->\n        </persistenceAdapter>\n\nThe performance number goes up to the roof -- 1000 msg/s.\n\ncleaning out the old data/ directory content wouldn't help the poor amq persistence store either.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-22T05:26:53.132+0000","updated":"2009-02-22T05:26:53.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482819/comment/12940831","id":"12940831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"use of a transaction has an impact because a transaction boundary needs to be accompanied with a disk write and disk sync. 5.1 did not honor the need to do a disk sync on a transaction boundary and hence it is faster in this regard. 5.2 does the right thing.\nTransactions will help if you do batch updates, but the overhead of transaction demarcation is noticeable when there is a a small amount of activity (like one message send or consume) in the transaction.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-23T12:29:05.368+0000","updated":"2009-02-23T12:29:05.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482819/comment/12940781","id":"12940781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"body":"Transaction is needed if several messages are sent together. \n\nBut why does the Kaha store (w/ 5.2) work much faster? In any case, 23 msg/s in transact mode seems too slow.  A database can beat it easily.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-24T05:19:00.191+0000","updated":"2009-02-24T05:19:00.191+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482819/comment/12941072","id":"12941072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"body":"Any comment and feedback on this bug?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hackingbear","name":"hackingbear","key":"hackingbear","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"H B","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-29T21:27:43.147+0000","updated":"2009-03-29T21:27:43.147+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482819/comment/12941083","id":"12941083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tschoeftner","name":"tschoeftner","key":"tschoeftner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Schöftner","active":true,"timeZone":"Etc/UTC"},"body":"I have a similar performance problem using ActiveMQ via Spring 2.5.6.\nDue to performance issues, I created a load-test for evaluation of the messaging performance:\n\nThe test basically sends 1000 messages which are later retrieved by 100 simultaneous consumers.\nEach consumer waits 1 sec before returning the acknowledgement - every 10th consumer waits 10 secs.\n\nTheoretically, all messges should be successfully handled in ~20secs.\nWith ActiveMQ 5.1, it takes ~50secs, but with 5.2 it's even slower (90secs).\n\nThis is strange because the server and consumer configuration has not changed.\nSwitching from AmqPersistance to KahaPersistance has no effect either.\nBTW, currently there is no TransactionManager used.\n\nAny ideas where to start looking? - Thx.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tschoeftner","name":"tschoeftner","key":"tschoeftner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Schöftner","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-30T10:41:21.905+0000","updated":"2009-03-30T10:41:21.905+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482819/comment/12941670","id":"12941670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Ran test case against 5.3 - got throughput of 615.38464msg/s","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-11T19:35:07.164+0000","updated":"2009-09-11T19:35:07.164+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2136/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s0cf:"}}