{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12558707","self":"https://issues.apache.org/jira/rest/api/2/issue/12558707","key":"AMQ-3870","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321258","id":"12321258","description":"Next v5 maintenance release","name":"5.7.0","archived":false,"released":true,"releaseDate":"2012-10-08"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2012-05-31T13:15:33.140+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu May 31 13:47:22 UTC 2012","customfield_12310420":"293797","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_45969705_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-05-31T13:15:33.072+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3870/watchers","watchCount":2,"isWatching":false},"created":"2012-05-31T00:29:23.468+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-05-31T13:47:22.484+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Steps to reproduce the issue:\n\n- Unpack clean \"apache-activemq-5.6.0-bin.zip\" to local drive.\n- Change the default configuration to use the mKahaDB adapter and per-destination instances (exactly as given at http://activemq.apache.org/kahadb.html in the very last config snippet). See also attached activemq.xml\n- Start up ActiveMQ from bin/activemq.bat\n- Run a small test program that simply creates a Topic and attempts to consume (that main point here is that the Topic is created and due to \"per-destination\" mKahaDB, a folder is created in the data directory specifically for this Topic.\n- Shutdown ActiveMQ normally.\n- Restart ActiveMQ normally, and the ArrayIndexOutOfBoundsException will be thrown. (see attached activemq.log)\n\n\nI have done some investigation and it seems that on restart when it is attempting to \"registerExistingAdapter\", it wants to register each adapter with one of the destinations (the first in fact) that each adapter applies to (adapter.getDestinations()...[0]). However, in getDestinations(), empty topics get filtered out of the return value, and since we are using per-destination=\"true\" there can be adapters for topics only and so a chance that getDestinations() returns an empty List. Hence causing the Exception when trying to access the first destination from that list.\n\n\nThe reason that I haven't gone further, to supply a patch, is that I am unsure of what would be an appropriate way to register these adapters, or if you could leave them and not register them anyway, since they are empty topics.\n\nNote, that if you extend the configuration of the mKahaDB adapter to provide an explicit adapter for all topics, then the issue goes away. (see commented part of mKahaDB config in activemq.xml attached)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12530310","id":"12530310","filename":"activemq.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mccarl1978","name":"mccarl1978","key":"mccarl1978","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phillip McCarley","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-31T00:38:51.283+0000","size":15953,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12530310/activemq.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12530309","id":"12530309","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mccarl1978","name":"mccarl1978","key":"mccarl1978","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phillip McCarley","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-31T00:38:32.482+0000","size":6344,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12530309/activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12530311","id":"12530311","filename":"TopicConsumer.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mccarl1978","name":"mccarl1978","key":"mccarl1978","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phillip McCarley","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-31T00:39:27.701+0000","size":735,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12530311/TopicConsumer.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172191","customfield_12312823":null,"summary":"ArrayIndexOutOfBoundsException when using Multi kahaDB (mKahaDB) adapter, per-destination adapters and Topics","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mccarl1978","name":"mccarl1978","key":"mccarl1978","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phillip McCarley","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mccarl1978","name":"mccarl1978","key":"mccarl1978","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phillip McCarley","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Java v1.6.0_21\nWindows XP SP3","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12558707/comment/13286550","id":"13286550","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Duplicate of AMQ-3841 which has been resolved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-05-31T13:15:33.140+0000","updated":"2012-05-31T13:15:33.140+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12558707/comment/13286566","id":"13286566","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mccarl1978","name":"mccarl1978","key":"mccarl1978","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phillip McCarley","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for that, I did search for other issues with \"ArrayIndexOutOfBoundsException\" but I somehow missed AMQ-3841. I have looked over the patch for that and I have a comment which I will leave under that issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mccarl1978","name":"mccarl1978","key":"mccarl1978","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phillip McCarley","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-31T13:47:22.440+0000","updated":"2012-05-31T13:47:22.440+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3870/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tu4v:"}}