{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483957","self":"https://issues.apache.org/jira/rest/api/2/issue/12483957","key":"AMQ-2736","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-05-18T11:10:52.095+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 05 12:52:15 UTC 2012","customfield_12310420":"14686","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_17769507_*|*_5_*:*_3_*:*_11101222006_*|*_4_*:*_2_*:*_12671783358","customfield_12312321":null,"resolutiondate":"2011-02-17T18:11:33.092+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2736/watchers","watchCount":21,"isWatching":false},"created":"2010-05-18T09:38:38.253+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"}],"issuelinks":[{"id":"12406946","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12406946","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"outwardIssue":{"id":"12770461","key":"AMQ-5542","self":"https://issues.apache.org/jira/rest/api/2/issue/12770461","fields":{"summary":"KahaDB data files containing acknowledgements are deleted during cleanup","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-02-02T13:07:37.141+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Over time, we're seeing that kahadb doesn't clean up old journal files. As a result, we eventually run out of disk space, or rather, we hit our usage limits and our producers are slowed down by the producer flow control mechanism. Others have experienced this problem too (for example, see http://mail-archives.apache.org/mod_mbox/activemq-users/201002.mbox/%3C27502591.post@talk.nabble.com%3E)\n\nFor now, we're moving back to the old amqPersistenceStore. \n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461844","id":"12461844","filename":"AMQ-2736.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m4c0","name":"m4c0","key":"m4c0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Costa","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-24T13:42:17.939+0000","size":3387,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461844/AMQ-2736.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461836","id":"12461836","filename":"AMQ2736Test_should_with_this_diff.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-08T16:27:09.237+0000","size":9467,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461836/AMQ2736Test_should_with_this_diff.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461834","id":"12461834","filename":"amq-2987.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-07T18:13:30.383+0000","size":1968,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461834/amq-2987.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461839","id":"12461839","filename":"amq-2987-testcase.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-08T15:41:55.763+0000","size":7968,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461839/amq-2987-testcase.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461862","id":"12461862","filename":"MyKahaDBStore.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m4c0","name":"m4c0","key":"m4c0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Costa","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-13T17:28:45.917+0000","size":1463,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461862/MyKahaDBStore.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"3180","customfield_12312823":null,"summary":"KahaDB doesn't clean up old files","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian.trenaman","name":"adrian.trenaman","key":"adrian.trenaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Trenaman","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12483802","key":"AMQ-2983","self":"https://issues.apache.org/jira/rest/api/2/issue/12483802","fields":{"summary":"Sticky KahaDB log files due to concurrent consumer with local transaction","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}},{"id":"12483803","key":"AMQ-2982","self":"https://issues.apache.org/jira/rest/api/2/issue/12483803","fields":{"summary":"Sticky KahaDB log files due to local transaction rollback","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian.trenaman","name":"adrian.trenaman","key":"adrian.trenaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Trenaman","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942663","id":"12942663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Could you provide a test case or scenario description that can reproduce?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-18T11:10:52.095+0000","updated":"2010-05-18T11:10:52.095+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943314","id":"12943314","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian.trenaman","name":"adrian.trenaman","key":"adrian.trenaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Trenaman","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary,\n\nI'm afraid I don't have a test case for this right now; just observed\nbehaviour on our systems here -and- verified by other users via a Google\nSearch.\n\n/Ade\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian.trenaman","name":"adrian.trenaman","key":"adrian.trenaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Trenaman","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-18T12:16:50.917+0000","updated":"2010-05-18T12:16:50.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943313","id":"12943313","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian.trenaman","name":"adrian.trenaman","key":"adrian.trenaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Trenaman","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary,\n\nJust retested against the very latest FUSE distribution (5.3.1-fuse-01-00) and the log files are being deleted. Looks like this may have been fixed. Will mark this as resolved for now, and revisit if we begin to see the errors again. \n\n/Ade","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian.trenaman","name":"adrian.trenaman","key":"adrian.trenaman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Trenaman","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-18T13:17:31.984+0000","updated":"2010-05-18T13:17:31.984+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942928","id":"12942928","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=straun","name":"straun","key":"straun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Straun","active":true,"timeZone":"Etc/UTC"},"body":"I am seeing this with a broker holding transactional persistent messages (100k messages a day 10k per msg), the queue sizes are all around 0 normally so I would expect the files to be cleared. I am using 5.4.0. The consumer of the messages is a .Net client with 'auto acknowledge' set. The KahaDB also appears to slow down as it runs, writes to the queues slows down so that the each commit cycle is taking 10% longer than the last.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=straun","name":"straun","key":"straun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Straun","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-17T06:09:22.134+0000","updated":"2010-09-17T06:09:22.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942912","id":"12942912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Straun, can you provide some sort of test case that can reproduce what you are seeing? Maybe a simple java producer/consumer that mimics what your .Net add does.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-17T08:40:54.488+0000","updated":"2010-09-17T08:40:54.488+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942967","id":"12942967","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m4c0","name":"m4c0","key":"m4c0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Costa","active":true,"timeZone":"Etc/UTC"},"body":"I'm attaching a test case that reproduces what I got here.\n\nI tested with a Producer sending 1mi messages (in 100-message blocks) and a Consumer. After some time, I receive a \"Usage Manager Store is Full, 100% of 1073741824. Stopping producer (...)\" with only a hundred messages on the queue!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m4c0","name":"m4c0","key":"m4c0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Costa","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-24T13:42:18.000+0000","updated":"2010-09-24T13:42:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942779","id":"12942779","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"Looks like there *maybe* a wait/lock condition on multiple \"KahaDB Scheduler\" threads...\n\nI took the attached example and was able to reproduce the problem.  A thread dump showed waits on the \"KahaDB Scheduler\".  I knocked out one of the schedulers and it appears to clean up.\n\nHence... can you please try setting schedulerSupport=\"false\" on the broker configuration and see if the files no longer grow?   This may be a work around for the time being.  Hopefully this is in the right direction...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-07T13:42:33.879+0000","updated":"2010-10-07T13:42:33.879+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942992","id":"12942992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"I ran the attached example and was able to reproduce it and indeed appears to endlessly grow.  I did a thread dump during the condition and there appears to be a possible locking problem with multiple \"KahaDB Scheduler\" threads.\n\nAs an experiment I killed one of the KahaDB Schedulers and it seemed to clean up.  I ran the example several times and it seems to clean up.  So this *may* be the culprit.\n\nSo please try this as a work around...\n\nIn the broker configuration set schedulerSupport=\"false\" and see if the files clean up.  This may help until we identify the waits on multiple schedulers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-07T13:49:37.340+0000","updated":"2010-10-07T13:49:37.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942780","id":"12942780","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"I ran the attached example and was able to reproduce it and indeed appears to endlessly grow.  I did a thread dump during the condition and there appears to be a possible locking problem with multiple \"KahaDB Scheduler\" threads.\n\nAs an experiment I killed one of the KahaDB Schedulers and it seemed to clean up.  I ran the example several times and it seems to clean up.  So this *may* be the culprit.\n\nSo please try this as a work around...\n\nIn the broker configuration set schedulerSupport=\"false\" and see if the files clean up.  This may help until we identify the waits on multiple schedulers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-07T13:49:46.352+0000","updated":"2010-10-07T13:49:46.352+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942782","id":"12942782","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"Oops... sorry for the multiple posts :/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-07T13:50:12.783+0000","updated":"2010-10-07T13:50:12.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942783","id":"12942783","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"My last comment was a red herring.  I found the bug... it s a logic bug.  Patch has been attached.  I will try to create a unit test but wanted to get the patch up since this was a critical bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-07T18:13:30.461+0000","updated":"2010-10-07T18:13:30.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12942986","id":"12942986","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"jeff, committed the fix, thanks. r1005806\nawait the test case to protect it. nice work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-08T12:29:48.513+0000","updated":"2010-10-08T12:29:48.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943021","id":"12943021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"Test case attached","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-08T15:41:55.873+0000","updated":"2010-10-08T15:41:55.873+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943018","id":"12943018","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"attaching the diff with the test case and the fix reverted, in which case the test should fail. but it does not atm.\nJust so we are on the same page, I may be missing something but I would expect it to fail.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-08T16:27:09.313+0000","updated":"2010-10-08T16:27:09.313+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943035","id":"12943035","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"The scenario that needs to be tested, for future reference:{code}ackMessageFileMap = {2=[1], 3=[1, 2], 4=[2, 3, 4], 5=[4, 5], 6=[5, 6], 7=[6, 7], 8=[7, 8]}\n\ngCandidateSet = [2, 3, 4, 5, 6, 7]{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-12T11:26:00.107+0000","updated":"2010-10-12T11:26:00.107+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943064","id":"12943064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m4c0","name":"m4c0","key":"m4c0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Costa","active":true,"timeZone":"Etc/UTC"},"body":"After some evil debugging tricks, I found that there are some pending inflight transactions (even after restarting the server) in my database files. In this scenario, the gcCandidadeSet is empty, since \"metadata.firstInProgressTransactionLocation\" points to the first log file (MessageDatabase.java, lines 1140-1154):\n\n{code}// Don't GC files after the first in progress tx\nLocation firstTxLocation = metadata.lastUpdate;\nif( metadata.firstInProgressTransactionLocation!=null ) {\n  firstTxLocation = metadata.firstInProgressTransactionLocation;\n}\n\nif( firstTxLocation!=null ) {\n  while( !gcCandidateSet.isEmpty() ) {\n    Integer last = gcCandidateSet.last();\n    if( last >= firstTxLocation.getDataFileId() ) {\n      gcCandidateSet.remove(last);\n    } else {\n      break;\n    }\n  }\n}\n{code}\n\nThis leads to the question: why it must discard every log file starting from the one containing the first pending transaction? Any malfunctioning operation (even an one-time little mistake) will trash all log files from that point! \n\nI believe this should happens also on \"kill -9\" or unexpected power down.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m4c0","name":"m4c0","key":"m4c0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Costa","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-13T17:21:06.916+0000","updated":"2010-10-13T17:21:06.916+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943054","id":"12943054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m4c0","name":"m4c0","key":"m4c0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Costa","active":true,"timeZone":"Etc/UTC"},"body":"I'm attaching a nasty workaround that commits the pending transactions and automatically archives (or deletes) the old log files when closing the store. I'm not proud of this thing, but it seems to prove the problem is on the pending transaction, since all useless files are correctly disposed after running it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m4c0","name":"m4c0","key":"m4c0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Costa","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-13T17:28:45.972+0000","updated":"2010-10-13T17:28:45.972+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943127","id":"12943127","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"body":"I'm using ActiveMQ 5.4.1 in production and I have added Gary's patch, but the log files are stilling growing (even if all queues are empty) and finally Activemq crashes. If I restart ActiveMQ then the log files are deleted. \n\nAny suggestions on how to fix the problem? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-25T06:52:25.867+0000","updated":"2010-10-25T06:52:25.867+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943115","id":"12943115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moczarski","name":"moczarski","key":"moczarski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Swen Moczarski","active":true,"timeZone":"Etc/UTC"},"body":"We also had some trouble with growing log files (version 5.4.1). I have two issues identified with similar symptoms (but it seems to be another cause as to this issue):\n* AMQ-2982: sticky log files on a rollback of a local transaction (test case and patch available)\n* AMQ-2983: sticky log files on multiple concurrent consumers with local transacted sessions (test case available)\n\nIf we only use non transacted sessions with auto-acknowledge, we have no problems.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moczarski","name":"moczarski","key":"moczarski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Swen Moczarski","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-25T19:00:47.487+0000","updated":"2010-10-25T19:00:47.487+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943129","id":"12943129","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bezudar","name":"bezudar","key":"bezudar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek C","active":true,"timeZone":"Etc/UTC"},"body":"@Swen Does using non transacted sessions with auto acknowledge clear the log files?\nWe have been facing a similar problem, however we are using Kaha Persistence Adapter on upgrading from 5.3.2 to 5.4.1. We had to upgrade to 5.4.1 because earlier using Durable Subs Topics our data files weren't getting cleaned up. Now our index-subs file are creating an issue. \n\nAny Final fix for this problem?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bezudar","name":"bezudar","key":"bezudar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek C","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-26T08:03:40.917+0000","updated":"2010-10-26T08:03:40.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943113","id":"12943113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"Folks..\n\nPlease try the patch supplied above: https://issues.apache.org/activemq/secure/attachment/19715/amq-2987.patch\n\nThat appears to fix the problem with the AMQ-2736.zip test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-26T17:16:00.292+0000","updated":"2010-10-26T17:16:00.292+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943118","id":"12943118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"@Christer WIkman - Gary's attachment wasn't a patch... it was a revert to the test case to validate the test case fails.  Please try my patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-26T17:26:57.053+0000","updated":"2010-10-26T17:26:57.053+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943112","id":"12943112","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"Here is the 5.4.1 distribution with the patch in it.  This is *not* an official release... could people please test it out?\n\nhttp://people.apache.org/~jgenender/apache-activemq-5.4.1-AMQ2736-bin.tar.gz ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-10-26T23:08:38.251+0000","updated":"2010-10-26T23:08:38.251+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943137","id":"12943137","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"body":"Do not work for me, same issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-27T01:58:52.317+0000","updated":"2010-10-27T01:58:52.317+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943120","id":"12943120","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"body":"I think that the fix AMQ-2982 must fix also this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-27T03:22:54.596+0000","updated":"2010-10-27T03:22:54.596+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943133","id":"12943133","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"AMQ-2982 and AMQ-2983 are fixed now on the trunk, so you can test out if that helps. I spotted one more potential issue in the area and I'm working on it now, so stay tuned.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-27T09:18:43.785+0000","updated":"2010-10-27T09:18:43.785+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943140","id":"12943140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"That potential issue from the last comment was the false alarm. I believe that this issue should be fixed now. Please test the latest snapshot\n\nhttps://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.5-SNAPSHOT/\n\nand reopen if you find any problems.\n\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-27T13:28:07.691+0000","updated":"2010-10-27T13:28:07.691+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943131","id":"12943131","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Just to wrap it all up, there were three issues spotted;\n\n- one spotted by Jeff and fixed by supplied patch and \n- and two covered by AMQ-2982 and AMQ-2983\n\nThanks to all who contributed, especially Jeff and Swen","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-27T14:11:38.417+0000","updated":"2010-10-27T14:11:38.417+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943167","id":"12943167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"body":"We running: http://people.apache.org/~jgenender/apache-activemq-5.4.1-AMQ2736-bin.tar.gz and we are still experience problems with log files that are not deleted. \n\nI deployed the fix yesterday with a new kahadb and this morning I had 155 log files with only 43 messages on two DLQ queues. I deleted the DLQ queues and only 12 log files where deleted. Currently,. I have 144 log files and nothing in the queues. \n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-03T09:33:55.332+0000","updated":"2010-11-03T09:33:55.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943164","id":"12943164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Christer, please validate with the 5.5-SNAPSHOT, that has the required combined fixes.\nhttps://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.5-SNAPSHOT/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-03T09:40:29.930+0000","updated":"2010-11-03T09:40:29.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943195","id":"12943195","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"body":"I deployed yesterday in stage latest 5.5-SNAPSHOT and it seems that the problem is solved. This morning I had 17 log files, but after I deleted DLQ queues with messages I ended up with only 1 log file! When I used 5.4.1 the files grow with approx 50-100 files per day. \n\nWe are not comfortable deploying 5.5-SNAPSHOT in production. Can anyone provide me with a patch for 5.4.1? Currently, I cannot recommend using version 5.4.1 in production without the combined fixes from 5.5-SNAPSHOT.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-09T07:50:28.486+0000","updated":"2010-11-09T07:50:28.486+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943198","id":"12943198","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"@Christer Wlkman - I built one with the following JIRA patches:\n\nhttp://people.apache.org/~jgenender/apache-activemq-5.4.1-AMQ2736-AMQ2982-AMQ2983-AMQ2935-bin.tar.gz\n\nYMMV and this is not an official release.  Post back if this works for you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2010-11-09T17:28:26.703+0000","updated":"2010-11-09T17:28:26.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943200","id":"12943200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"body":"@Jeff - Thanks! I have deployed your fix in our stage environment. It works much better but not 100%. All queues are empty but I still have 4 log files and one contains 0 bytes, last updated yesterday, and other log file was last updated 6 hours ago. When I used 5.5-SNAPSHOT it went down to 1 log file!\n\nI will evaluate it for some more days before I can tell for sure if the log files grows. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-11T09:02:56.020+0000","updated":"2010-11-11T09:02:56.020+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943221","id":"12943221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"body":"I have been running Jeff's fix in stage for 5 days and the log files have not grown. I'm now comfortable to use it in production.\n\nMany thanks for all help!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-16T09:53:09.667+0000","updated":"2010-11-16T09:53:09.667+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943235","id":"12943235","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"BTW. We released a version of Fuse Message Broker that contains a fix for this issue. If anyone is interested, it can be found here \n\nhttp://repo.fusesource.com/nexus/content/repositories/releases/org/apache/activemq/apache-activemq/5.4.1-fuse-01-00/\n\nRelease notes available at: http://fusesource.com/wiki/display/ProdInfo/FUSE+Message+Broker+v5.4.1-fuse+Release+Notes","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-11-16T10:07:03.955+0000","updated":"2010-11-16T10:07:03.955+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943229","id":"12943229","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alisenberg","name":"alisenberg","key":"alisenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Lisenberg","active":true,"timeZone":"Etc/UTC"},"body":"Hi, I really need this fix!!!!. So finally you tested the fix on 5.4.1 or you are going to put 5.5 in production? \n\nexcuse me, but which is the file with the correct patch?\n\nOne more question: After applying this fix, would be any way for deleting old log files in order to reduce unused space? I am at 100G and I need to maintain the current state of the broker...\n\nthanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alisenberg","name":"alisenberg","key":"alisenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Lisenberg","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-16T13:57:42.746+0000","updated":"2010-11-16T13:57:42.746+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943225","id":"12943225","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"body":"Use Jeff's patch for 5.4.1, http://people.apache.org/~jgenender/apache-activemq-5.4.1-AMQ2736-AMQ2982-AMQ2983-AMQ2935-bin.tar.gz\n\nI deployed it in production today and it totally removed the problem with growing log files. It went down from 78 log files to just 1 log file. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwikman","name":"cwikman","key":"cwikman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christer WIkman","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-16T14:16:00.918+0000","updated":"2010-11-16T14:16:00.918+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12943247","id":"12943247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srpietrowicz","name":"srpietrowicz","key":"srpietrowicz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Pietrowicz","active":true,"timeZone":"Etc/UTC"},"body":"I've been trying to track down a solution to a problem similar to this, and the latest snapshot of 5.5 doesn't resolve this for me.\n\nThis is the scenario I've created:\n\n1) a producer starts sending messages\n2) a consumer starts consuming messages, but pauses after 100.\n3) db-##.log files start showing up in the tmp_storage directory as expected.   I let the producer go for a while so a number of db-##.log files are created.\n4) the consumer starts consuming messages again. The db-##.log files start disappearing as they're used up.\n5) everything finishes.\n\nNow, if I do:\n\n1) a producer starts sending messages\n2) a consumer starts consuming messages, but pauses after 100.\n3) db-##.log files start showing up in the tmp_storage directory as expected.   I let the producer go for a while so that a number of db-##.log files are created.\n\nand kill the consumer and the producer.  The db-##.log files remain, and will not get cleaned up, even on subsequent invocations of new consumers and producers.  If a new consumer/producer (as in the first scenario) are created, it all works;  it's just that those old .log files never get cleaned up.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srpietrowicz","name":"srpietrowicz","key":"srpietrowicz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Pietrowicz","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-16T20:52:59.733+0000","updated":"2010-11-16T20:52:59.733+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12978350","id":"12978350","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"Steve, I am having difficulty reproducing this... can you please attach a test case?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2011-01-06T14:49:42.245+0000","updated":"2011-01-06T14:49:42.245+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12980750","id":"12980750","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alisenberg","name":"alisenberg","key":"alisenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Lisenberg","active":true,"timeZone":"Etc/UTC"},"body":"Hi, is this bug fixed on version 5.4.2? or I need to apply the patch too?\n\nthanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alisenberg","name":"alisenberg","key":"alisenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Lisenberg","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-12T15:28:01.268+0000","updated":"2011-01-12T15:28:01.268+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12980752","id":"12980752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=straun","name":"straun","key":"straun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Straun","active":true,"timeZone":"Etc/UTC"},"body":"5.4.2 does include AMQ-2982 and AMQ-2983, whether this solves all of the issue I am unsure but using 5.4.2 worked for me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=straun","name":"straun","key":"straun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Straun","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-12T15:34:54.216+0000","updated":"2011-01-12T15:34:54.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12981888","id":"12981888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matthewvon","name":"matthewvon","key":"matthewvon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Von-Maszewski","active":true,"timeZone":"Etc/UTC"},"body":"No.  Not fixed in 5.4.2 ... just found that out today.  The hard way.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matthewvon","name":"matthewvon","key":"matthewvon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Von-Maszewski","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-14T19:29:16.281+0000","updated":"2011-01-14T19:29:16.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12981894","id":"12981894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alisenberg","name":"alisenberg","key":"alisenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Lisenberg","active":true,"timeZone":"Etc/UTC"},"body":"I think the same. I installed 5.4.2 but still growing. I will rollback to 5.4.1 with patches :(\n\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alisenberg","name":"alisenberg","key":"alisenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Lisenberg","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-14T19:38:40.342+0000","updated":"2011-01-14T19:38:40.342+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12985827","id":"12985827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgreen","name":"jgreen","key":"jgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Etc/UTC"},"body":"Hmm something's not right on our 5.4.2 instance either. A 5GB store reporting itself (after purging some queues) ~89% full. On disk 4.4G. Restarted AMQ it went down to 1.6G and 29% full.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgreen","name":"jgreen","key":"jgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-24T17:24:02.370+0000","updated":"2011-01-24T17:24:02.370+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12988713","id":"12988713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Can anyone create a test case, or provide a steps to reproduce the problem with 5.4.2 release? Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2011-01-31T09:55:52.056+0000","updated":"2011-01-31T09:55:52.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12994338","id":"12994338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcekal","name":"mcekal","key":"mcekal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Cekal","active":true,"timeZone":"Etc/UTC"},"body":"Hello Dejan,\nWe noticed StorageFull on KahaDb several times so I played a little and found two reasons for this (second seems to be a AMQ bug):\n1) unconsumed message(s) in any datafile blocks the datafile forever there. So if you keep default setup 33mb per file and 1gb limit roughly 30 small messages spread one to each datafile can block whole system\n(I assume this is not a bug, just not nice feature - Why not to reply(=rewrite) messages at least during AMQ restart to latest datafile?)\n\n2) second issue seems to me as a bug. If you open transacted session and send a message, but do not commit it a datafile is blocked. Again if you spread such uncommited messages over all datafiles you gets \"storage is full\". That is ok - someone forget to commit - but problem comes if you kill AMQ using -9 signal (or via TaskManager on Windows). If you do this non-standard kill (=like a hw failure) the uncommited transaction seems to be blocking datafiles forever. New start of AMQ somehow reads again the transaction and still waiting for commit although the producer is not live any more. If you do regular shutdown so ShutdownHook on the Broker is fully executed, next AMQ start correctly recognize whether producer of uncommited transaction (with failover transport) is still up (then transaction is kept, messages are replayed to new/last datafile) or down (then transaction is rollbacked).\nI think AMQ should be able to behave this way even if previously someone killed it brutally(kill -9).\n\nI have tested these two scenarios on both 5.3.2 and 5.4.2 with same result. We would like to get a patch for 5.3.2 version. Is it possible?\n\nThanks a lot\nMartin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcekal","name":"mcekal","key":"mcekal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Cekal","active":true,"timeZone":"Etc/UTC"},"created":"2011-02-14T15:28:21.958+0000","updated":"2011-02-14T15:28:21.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12994381","id":"12994381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@Martin, thanks for the feedback. The second issue is indeed a problem, on normal shutdown, inflight (non xa) transactions are rolledback. The same (rollback) should happen after recovery, to deal with the abortive shutdown case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-02-14T17:50:02.318+0000","updated":"2011-02-14T17:50:02.318+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/12995958","id":"12995958","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Fixed up abortive shutdown case such that recovered local transactions are auto rolledback.\n\nhttp://svn.apache.org/viewvc?rev=1071732&view=rev\n\nI think the compact journal data files feature needs another issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-02-17T18:11:33.105+0000","updated":"2011-02-17T18:11:33.105+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/13044921","id":"13044921","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcarpella","name":"mcarpella","key":"mcarpella","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Carpella","active":true,"timeZone":"Etc/UTC"},"body":"I am seeing this or a similar issue on a 5.5.0 broker as well, log files are not being deleted. I now deleted all queues, but I am still seeing the checkpoint task \"DEBUG | queue://a.deleted.queue expiring messages ..\" in the logs.\n\nI stopped ActiveMQ afterwards and restartet it, after I deleted all queues and still the space being occupied.\n\nDuring the restart, even after I deleted all queues, I had:\n{code}\nDEBUG | XA Transaction new/begin : XID:1096044365:3137322e31372e312e352e746d31353531373030333432:3137322e31372e312e352e746d37313330363334\nDEBUG | Ack for non existent subscription in recovery, ack:MessageAck {commandId = 66898301, responseRequired = false, ackType = 2, consumerId = ID:CLIENT-001-40008-1306310098527-2:5:10553821:1, firstMessageId = e041a486-8c88-3855-304e-4c9eac0f85b1:0:61129:61129, lastMessageId = e041a486-8c88-3855-304e-4c9eac0f85b1:0:61129:61129, destination = queue://a.deleted.queue, transactionId = XID:1096044365:3137322e31372e312e352e746d31353531373030333432:3137322e31372e312e352e746d37313330363334, messageCount = 1, poisonCause = null}\n{code}\n\nAfter the restart, all the space was still occupied and log-files were never deleted. But at least no more expiry entries for the now deleted queues any more.\n\nKahaDB is 3 according to startup logs. Unfortunately I cannot provide steps to reproduce for 5.5.0 at the moment and the store in question is several GB in size and contains sensitive information I cannot share. \n\nShould I re-open this issue or a file this as a new issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcarpella","name":"mcarpella","key":"mcarpella","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Carpella","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-06T15:51:01.783+0000","updated":"2011-06-06T15:51:26.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/13049295","id":"13049295","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kokushibyou","name":"kokushibyou","key":"kokushibyou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephanie M","active":true,"timeZone":"America/Los_Angeles"},"body":"This does not appear to be fixed in 5.5. \n\nI have a queue that holds onto a message every once in a while due to bad formatting or what-have-you (not something I can immediately correct). Since KahaDB requires the need to retain the full contents of the DB file while one message persists, it will cause the file system to grow dramatically if you alter the default kahaDB file size at all. With a DB file of 96 megs each I've eaten up almost 5 gigs of disk space in 34 pending messages all less than 2000 bytes each. I'm going to begin auto purging the offending queue (since we don't require those messages), however it would be preferred to have some automatic process possibly automatically consolidate the DB once its reached a pre-configured limit? \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kokushibyou","name":"kokushibyou","key":"kokushibyou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephanie M","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-14T17:27:57.561+0000","updated":"2011-06-14T17:27:57.561+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/13053867","id":"13053867","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Auto consolidation would be a nice enhancement. Can you open a new issue to track that.\n\nAs you know, you can also reduce the journal data file size to reduce the overall disk usage in this case.\n\nOne other thought, using a camel route, you can easily consume and re-submit messages so that they are moved to the current journal data file. Have a look at the route from the dlq back the the original destination for inspiration. https://issues.apache.org/jira/browse/AMQ-2710. The idea would be to periodically fire a consumer, using quarts, that removes and adds messages. See the test that pulls the original destination from the message.\n\nhttp://svn.apache.org/viewvc/activemq/trunk/activemq-camel/src/test/resources/org/apache/activemq/camel/CamelRedeliveryTest-context.xml?view=markup\nhttp://svn.apache.org/viewvc/activemq/trunk/activemq-camel/src/test/java/org/apache/activemq/camel/CamelRedeliveryTest.java?view=markup","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-23T14:02:00.629+0000","updated":"2011-06-23T14:02:00.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/13469411","id":"13469411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vmirea","name":"vmirea","key":"vmirea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vasile M","active":true,"timeZone":"Etc/UTC"},"body":"Hi guys,\n\nI am using the version 5.5.1 of ActiveMQ and I can still reproduce this problem.\nI saw you have fixed some problems but I think my case is different.\nThe most connected bug with my issue is :https://issues.apache.org/jira/browse/AMQ-2983\n\nIn my case I am no using local transactions, I am using global transaction (XATransactions) and then I always comit the transactions and still the log files are not deleted.\nThe JMS Connections Pool in my case it is defined in glassfish using the ActiveMQ Resource Adapter.\nHave you tested with global transactions too ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vmirea","name":"vmirea","key":"vmirea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vasile M","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-04T14:37:04.575+0000","updated":"2012-10-04T14:37:04.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/13469431","id":"13469431","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@Vasile\nIf you can reproduce at will, and can provide a tests case, please open a new jira issue to track your use case. Also, validate that your use case fails on trunk using the latest snapshot.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-04T14:58:58.174+0000","updated":"2012-10-04T14:58:58.174+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/13469447","id":"13469447","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vmirea","name":"vmirea","key":"vmirea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vasile M","active":true,"timeZone":"Etc/UTC"},"body":"I want to add to my previous comment that we are using the CPP library CMS for ActiveMQ with stomp too.\nThis is the second use-case.\nWe have one producer and one subscriber and this is already causing problems.\nThe logs are growing.\nIn C++ we use Session::AUTO_ACKNOWLEDGE and even in this case the log files are not deleted.\nWe write(using a producer) in the queue and and another process is reading(using a listener) we never have many messages in the queue.\nQueueName       Number of pending messages   Number of listener       Messages Enqueued     Messages Dequeued \nqueuename \t0 \t                           1 \t               21522 \t            21522\nThis is maybe a new use-case too ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vmirea","name":"vmirea","key":"vmirea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vasile M","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-04T15:10:43.150+0000","updated":"2012-10-05T13:18:17.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483957/comment/13470277","id":"13470277","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vmirea","name":"vmirea","key":"vmirea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vasile M","active":true,"timeZone":"Etc/UTC"},"body":"I just downloaded the version 5.6.0 of ActiveMQ.\nI took the old configuration I was using for 5.5.1 and repeat the tests with my application.\nIt seems the problems are fixed!\nIt means the fixed is not made in version 5.5.0 (like the bug is describing).\nSo please modify the description(Fix Versions field) so the people should know that the version 5.6.0 it contains the fix.\nI won't open a new bug because it makes no sense.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vmirea","name":"vmirea","key":"vmirea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vasile M","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-05T12:52:15.332+0000","updated":"2012-10-05T12:52:57.336+0000"}],"maxResults":55,"total":55,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2736/votes","votes":12,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i00we7:"}}