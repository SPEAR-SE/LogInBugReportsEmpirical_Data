{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13005879","self":"https://issues.apache.org/jira/rest/api/2/issue/13005879","key":"AMQ-6432","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338054","id":"12338054","name":"5.15.0","archived":false,"released":true,"releaseDate":"2017-07-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12338909","id":"12338909","name":"5.14.4","archived":false,"released":true,"releaseDate":"2017-03-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-09-19T16:15:51.092+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Feb 06 14:05:45 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_11857101554_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-02-03T17:02:39.182+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6432/watchers","watchCount":12,"isWatching":false},"created":"2016-09-19T11:24:17.673+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334188","id":"12334188","name":"5.14.0","archived":false,"released":true,"releaseDate":"2016-08-05"}],"issuelinks":[{"id":"12493396","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12493396","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12967407","key":"AMQ-6288","self":"https://issues.apache.org/jira/rest/api/2/issue/12967407","fields":{"summary":"Message ack compaction needs to acquire the checkpoint lock","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-02-06T14:06:07.266+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Seeing\n\n{noformat}\n2016-09-19 15:11:30,270 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | \n   emq.store.kahadb.MessageDatabase 2104 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | \n   Failed to load next journal location: null\n{noformat}\nit'd be great to improve the output in such a case (Journal Checkpoint Worker ).\n\nWhy not show the exception stack (it seems weird to only show the stack when debug level is enabled).\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Improve 'Failed to load next journal location: null' warning output","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15503885","id":"15503885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"That error message would only happen during an ack compaction (which is a new feature) so I guess the question is what happened that the location couldn't be read from the journal file during ack compaction. It is a bit annoying that the message form the exception is null so we don't have any idea what is up.  I think it would be fine to log the stack trace at the warning level here in case it happens again to try and track down the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-09-19T16:15:51.092+0000","updated":"2016-09-19T16:15:51.092+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15504268","id":"15504268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"body":"Agree with your thinking. A few reoccurences since:\n{noformat}\n2016-09-19 15:11:30,270 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n2016-09-19 15:36:32,156 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n2016-09-19 16:01:33,572 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n2016-09-19 17:08:07,707 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n{noformat}\nSomething's fishy with the system time on this machine. Could it be a result of the time being re-set? Eg. going back in time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"created":"2016-09-19T18:35:28.511+0000","updated":"2016-09-19T18:35:28.511+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15506902","id":"15506902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Time shouldn't have anything to do with it because a Location in the journal is essentially just 2 pieces of information, the file and the offset and time isn't involved.  Since this issue has happened a few more times can you enable debug logging for the MessageDatabase class to try and capture the stack trace?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-09-20T15:35:40.371+0000","updated":"2016-09-20T15:35:40.371+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15519632","id":"15519632","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"body":"Could capture it:\n{noformat}\n2016-09-21 09:50:37,188 | DEBUG | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 1710 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Checkpoint started.\n2016-09-21 09:50:37,190 | DEBUG | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 1943 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Checkpoint done.\n2016-09-21 09:50:40,269 | DEBUG | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 1710 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Checkpoint started.\n2016-09-21 09:50:40,273 | DEBUG | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 1943 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Checkpoint done.\n2016-09-21 09:50:40,800 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n2016-09-21 09:50:40,801 | DEBUG | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2106 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location\njava.io.EOFException\n        at java.io.RandomAccessFile.readInt(RandomAccessFile.java:803)[:1.8.0_92]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.readInt(RecoverableRandomAccessFile.java:165)[102:org.apache.activemq.activemq-osgi:5.14.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAccessor.readLocationDetails(DataFileAccessor.java:113)[102:org.apache.activemq.activemq-osgi:5.14.0]\n        at org.apache.activemq.store.kahadb.disk.journal.Journal.getNextLocation(Journal.java:853)[102:org.apache.activemq.activemq-osgi:5.14.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.getNextLocationForAckForward(MessageDatabase.java:2102)[102:org.apache.activemq.activemq-osgi:5.14.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.forwardAllAcks(MessageDatabase.java:2066)[102:org.apache.activemq.activemq-osgi:5.14.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.access$600(MessageDatabase.java:121)[102:org.apache.activemq.activemq-osgi:5.14.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase$AckCompactionRunner.run(MessageDatabase.java:2005)[102:org.apache.activemq.activemq-osgi:5.14.0]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)[:1.8.0_92]\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)[:1.8.0_92]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)[:1.8.0_92]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)[:1.8.0_92]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)[:1.8.0_92]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)[:1.8.0_92]\n        at java.lang.Thread.run(Thread.java:745)[:1.8.0_92]\n2016-09-21 09:50:40,835 | DEBUG | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 1710 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Checkpoint started.\n2016-09-21 09:50:40,835 | DEBUG | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 1943 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Checkpoint done.\n2016-09-21 09:50:42,192 | DEBUG | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 1710 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Checkpoint started.\n2016-09-21 09:50:42,193 | DEBUG | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 1943 | 102 - org.apache.activemq.activemq-osgi - 5.14.0 | Checkpoint done.\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"created":"2016-09-24T21:07:59.131+0000","updated":"2016-09-24T21:07:59.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15523079","id":"15523079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Essentially the ack compaction works by just sequentially scanning the journal file commands and rewriting any acknowledgements to a new journal file.  The fact that trying to find the next location is giving an EOFException would seem to indicate some kind of journal file corruption.\n\nAre you seeing errors during any other times or just during the compaction task? I would think you'd see errors other times as well if the file was truly corrupted.  Also, do you have enableJournalDiskSyncs set to true?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-09-26T13:37:41.027+0000","updated":"2016-09-26T13:37:41.027+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15525463","id":"15525463","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"body":"Not seeing the errors all day long, likely just during compaction. We run with the default for enableJournalDiskSyncs (true).\nOne observation, it could be that the issue appears when we purge (via the MBean) and reset stats for all destinations.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"created":"2016-09-27T08:21:28.745+0000","updated":"2016-09-27T08:21:28.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15844636","id":"15844636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"body":"Another pattern seen, it happened 6 times, every 20mins:\n\n{noformat}\n2017-01-27 14:29:48,147 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 98 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n2017-01-27 14:49:57,956 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 98 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n2017-01-27 15:10:07,635 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 98 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n2017-01-27 15:30:41,002 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 98 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n2017-01-27 15:50:50,964 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 98 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n2017-01-27 16:16:07,428 | WARN  | ournal Checkpoint Worker | MessageDatabase                  | emq.store.kahadb.MessageDatabase 2104 | 98 - org.apache.activemq.activemq-osgi - 5.14.0 | Failed to load next journal location: null\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichtin","name":"lichtin","key":"lichtin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lichtin&avatarId=12645","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lichtin&avatarId=12645","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lichtin&avatarId=12645","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lichtin&avatarId=12645"},"displayName":"Martin Lichtin","active":true,"timeZone":"Europe/Berlin"},"created":"2017-01-29T20:31:43.089+0000","updated":"2017-01-29T20:31:43.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15849848","id":"15849848","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit e3b529129a490d760d21692736e7c0dda7e615e2 in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e3b5291 ]\n\n[AMQ-6432] improve the logging to see the current offset\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-02T12:14:43.021+0000","updated":"2017-02-02T12:14:43.021+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15849851","id":"15849851","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I think this should only occur if there is no disk sync, and thinking more if sync is not disabled via enableJournalDiskSync=false then any non sync journal write could lead to this. However, the gc should never try an read the current journal file so it may have to coincide with a journal flip.\nHaving ack compaction force a sync before trying to scan may help here.\nGetting better info out of the logging will be a first step, as would having a reproducer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-02T12:18:38.171+0000","updated":"2017-02-02T12:18:38.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15849854","id":"15849854","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"if the trigger is a purge, it may be that the acks are not synced, and doing a sync write after a purge could sort this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-02T12:21:23.740+0000","updated":"2017-02-02T12:21:23.740+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15851726","id":"15851726","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 9b64e188b59a395300a2f5d6022df9dbbae2f426 in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9b64e18 ]\n\n[AMQ-6432] issue was journal scan on newly created ack file. I left the relevant braces from AMQ-6288 in place. Fix and test\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-03T16:59:18.776+0000","updated":"2017-02-03T16:59:18.776+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15851735","id":"15851735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"issue was not related to syncs but doing a scan for acks that could venture into the newly created data file for the acks. \nAdding a limit to the getNextLocation scan provides the necessary restriction and avoids the EOF and warn.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-03T17:02:39.215+0000","updated":"2017-02-03T17:02:39.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15851771","id":"15851771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Gary, may I ask,  by setting enableAckCompaction=false, would I avoid this error in 5.14.x release?  We're considering going live with 5.14.3.  Thank you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-03T17:24:52.011+0000","updated":"2017-02-03T17:24:52.011+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15851789","id":"15851789","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Yes, turning off ack compaction will ensure you don't see this warning in you logs. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-02-03T17:35:02.692+0000","updated":"2017-02-03T17:35:02.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15854042","id":"15854042","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 3a848971ff80540ae9af2b1008f90b7e4f3014ef in activemq's branch refs/heads/activemq-5.14.x from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=3a84897 ]\n\n[AMQ-6432] improve the logging to see the current offset\n\n(cherry picked from commit e3b529129a490d760d21692736e7c0dda7e615e2)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-06T14:05:44.559+0000","updated":"2017-02-06T14:05:44.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005879/comment/15854043","id":"15854043","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 93715d1bd605bc61149505d4df2ebc223ae371af in activemq's branch refs/heads/activemq-5.14.x from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=93715d1 ]\n\n[AMQ-6432] issue was journal scan on newly created ack file. I left the relevant braces from AMQ-6288 in place. Fix and test\n\n(cherry picked from commit 9b64e188b59a395300a2f5d6022df9dbbae2f426)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-06T14:05:45.784+0000","updated":"2017-02-06T14:05:45.784+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6432/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i33sfr:"}}