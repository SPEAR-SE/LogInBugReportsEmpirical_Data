{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12552088","self":"https://issues.apache.org/jira/rest/api/2/issue/12552088","key":"AMQ-3816","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2012-04-24T18:31:11.330+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jul 09 19:21:48 UTC 2012","customfield_12310420":"237450","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_6698137140_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-07-09T19:21:48.714+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3816/watchers","watchCount":5,"isWatching":false},"created":"2012-04-23T06:46:11.653+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318549","id":"12318549","name":"5.5.1","archived":false,"released":true,"releaseDate":"2011-10-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-09T19:21:48.788+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12315706","id":"12315706","name":"stomp"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have noticed that the broker does not deliver some messages to a durable consumer in the following scenario.\n\n1/ Start ActiveMQ broker, Perl STOMP producer on topics with persistence and Perl STOMP consumer with durable topics.\n2/ Kill the broker while the consumer and producer are running.\n3/ Kill the consumer. We have kept the producer running all these while.\n4/ Restart the broker and producer will connect to it and continue to send the messages.\n5/ Restart the consumer. We have noticed that the consumer was missing big chunk of messages sent by the producer when the consumer was down. But, we expect the consumer to receive these messages since it's a durable consumer and did not unsubscribe from these topics.\n\nI have enabled TRACE level logging for the broker and checked that the broker is recovering the durable subscription information from the kaha db logs when it restarts and marks the durable consumer as inactive durable subscription. However, broker does not seem to retain the messages for this durable consumer until the consumer comes up again.\n\nIs this expected? Does not broker guarantee message redelivery for durable consumers when the broker itself restarts?\n\nPlease let me know if we have any configurations on the broker/client side to avoid these kind of issues.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172308","customfield_12312823":null,"summary":"Broker does not retain messages for a STOMP durable consumer if the broker restarts while the consumer was running","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=buchi","name":"buchi","key":"buchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=buchi&avatarId=29139","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=buchi&avatarId=29139","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=buchi&avatarId=29139","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=buchi&avatarId=29139"},"displayName":"Buchi Reddy B","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=buchi","name":"buchi","key":"buchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=buchi&avatarId=29139","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=buchi&avatarId=29139","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=buchi&avatarId=29139","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=buchi&avatarId=29139"},"displayName":"Buchi Reddy B","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Perl STOMP clients on UNIX OS.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12552088/comment/13260799","id":"13260799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"What could be happening here is that your consumer is using an ack mode of auto, and the broker has sent the consumer all the pending messages because its prefetch limit has not been set.  You should try setting the prefetch limit to 1, or using client ack.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-04-24T18:31:11.330+0000","updated":"2012-04-24T18:31:11.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12552088/comment/13264701","id":"13264701","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=buchi","name":"buchi","key":"buchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=buchi&avatarId=29139","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=buchi&avatarId=29139","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=buchi&avatarId=29139","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=buchi&avatarId=29139"},"displayName":"Buchi Reddy B","active":true,"timeZone":"America/Los_Angeles"},"body":"@Timothy\n\nI have tried with 'client' ack mode as well and also tried by setting prefetch limit to 1 but I'm still seeing this issue.\n\nCan you please check this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=buchi","name":"buchi","key":"buchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=buchi&avatarId=29139","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=buchi&avatarId=29139","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=buchi&avatarId=29139","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=buchi&avatarId=29139"},"displayName":"Buchi Reddy B","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-04-30T07:35:41.242+0000","updated":"2012-04-30T07:35:41.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12552088/comment/13264898","id":"13264898","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Recommend you try and create a JUnit test that demonstrates the issue, testing here indicates that things are working as expected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-04-30T12:38:33.700+0000","updated":"2012-04-30T12:38:33.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12552088/comment/13276667","id":"13276667","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=buchi","name":"buchi","key":"buchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=buchi&avatarId=29139","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=buchi&avatarId=29139","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=buchi&avatarId=29139","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=buchi&avatarId=29139"},"displayName":"Buchi Reddy B","active":true,"timeZone":"America/Los_Angeles"},"body":"@Timothy did you test this case with Perl code? I personally feel that there are some differences in Perl and Java STOMP implementations and some issues (like this one) might be real issues only in Perl STOMP clients.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=buchi","name":"buchi","key":"buchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=buchi&avatarId=29139","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=buchi&avatarId=29139","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=buchi&avatarId=29139","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=buchi&avatarId=29139"},"displayName":"Buchi Reddy B","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-16T11:30:04.123+0000","updated":"2012-05-16T11:30:04.123+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12552088/comment/13276684","id":"13276684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Problem ActiveMQ can't be responsible for client code that we didn't write, and a perl module wouldn't go into the unit tests to ensure that anything that did get fixed stayed fixed in the future.  I haven't had time to look any further at this but from the testing I did I could not find any issues on the broker side.  You can use the numerous test cases already present in AMQ to try to create something that reproduces your problem if you want to contribute.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-05-16T12:08:29.557+0000","updated":"2012-05-16T12:08:29.557+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12552088/comment/13409755","id":"13409755","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Couldn't reproduce this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-07-09T19:21:48.761+0000","updated":"2012-07-09T19:21:48.761+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3816/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tuuv:"}}