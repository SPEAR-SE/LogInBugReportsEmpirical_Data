{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483844","self":"https://issues.apache.org/jira/rest/api/2/issue/12483844","key":"AMQ-2956","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-04-13T16:29:57.808+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jun 30 14:56:26 UTC 2011","customfield_12310420":"69618","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_23490495274_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-06-30T14:56:26.631+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2956/watchers","watchCount":1,"isWatching":false},"created":"2010-10-01T17:48:11.428+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"}],"issuelinks":[{"id":"12339145","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12339145","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12483433","key":"AMQ-2696","self":"https://issues.apache.org/jira/rest/api/2/issue/12483433","fields":{"summary":"DefaultJDBCAdapter returns incorrect value that prevents ActiveMQ from starting.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-06-30T14:56:26.697+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Broker fails to restart due to a java.lang.NullPointerException. It looks like it has to do with the JDBC persistance adapter. \nI'm using: \n\n<journaledJDBC journalLogFiles=\"5\" dataDirectory=\"${activemq.base}/activemq-data\" dataSource=\"#mysql-ds\"/>\n        <bean id=\"mysql-ds\" class=\"org.apache.commons.dbcp.BasicDataSource\" destroy-method=\"close\">\n                <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\"/>\n                <property name=\"url\" value=\"jdbc:mysql://myhostname.com/activemq?relaxAutoCommit=true\"/>\n                <property name=\"username\" value=\"myusername\"/>\n                <property name=\"password\" value=\"mypassword\"/>\n                <property name=\"poolPreparedStatements\" value=\"true\"/>\n\nI can solve this by emptying the table ACTIVEMQ_ACKS. It looks like there are some acks that exist for messages that aren't in the database.\n\nDetails below:\n\nRunning ActiveMQ Broker...\nwrapper  | --> Wrapper Started as Console\nwrapper  | Launching a JVM...\njvm 1    | Wrapper (Version 3.2.3) http://wrapper.tanukisoftware.org\njvm 1    |   Copyright 1999-2006 Tanuki Software, Inc.  All Rights Reserved.\njvm 1    | \njvm 1    | \njvm 1    | WARNING - Unable to load the Wrapper's native library because none of the\njvm 1    |           following files:\njvm 1    |             libwrapper-linux-x86-64.so\njvm 1    |             libwrapper.so\njvm 1    |           could be located on the following java.library.path:\njvm 1    |             /var/lib/activemq/bin/linux-x86-64/../../bin/linux\njvm 1    |           Please see the documentation for the wrapper.java.library.path\njvm 1    |           configuration property.\njvm 1    |           System signals will not be handled correctly.\njvm 1    | \njvm 1    | Java Runtime: Sun Microsystems Inc. 1.6.0_21 /usr/java/jdk1.6.0_21/jre\njvm 1    |   Heap sizes: current=117888k  free=111741k  max=466048k\njvm 1    |     JVM args: -Dactivemq.home=../.. -Dactivemq.base=../.. -Djavax.net.ssl.keyStorePassword=password -Djavax.net.ssl.trustStorePassword=password -Djavax.net.ssl.keyStore=../../conf/broker.ks -Djavax.net.ssl.trustStore=../../conf/broker.ts -Dcom.sun.management.jmxremote -Dorg.apache.activemq.UseDedicatedTaskRunner=true -Djava.util.logging.config.file=logging.properties -Dcom.sun.management.jmxremote.port=1616 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Xmx512m -Djava.library.path=../../bin/linux/ -Dwrapper.key=dafM8UrD_1bFGoNX -Dwrapper.port=32000 -Dwrapper.jvm.port.min=31000 -Dwrapper.jvm.port.max=31999 -Dwrapper.pid=24752 -Dwrapper.version=3.2.3 -Dwrapper.native_library=wrapper -Dwrapper.cpu.timeout=10 -Dwrapper.jvmid=1\njvm 1    | ACTIVEMQ_HOME: ../..\njvm 1    | ACTIVEMQ_BASE: ../..\njvm 1    | Loading message broker from: xbean:activemq.xml\njvm 1    |  INFO | Using Persistence Adapter: JournalPersistenceAdapator(JDBCPersistenceAdapter(org.apache.commons.dbcp.BasicDataSource@4762d950))\njvm 1    |  INFO | JMX consoles can connect to service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi\njvm 1    |  INFO | Database adapter driver override recognized for : [mysql-ab_jdbc_driver] - adapter: class org.apache.activemq.store.jdbc.adapter.MySqlJDBCAdapter\njvm 1    |  INFO | Database lock driver override not found for : [mysql-ab_jdbc_driver].  Will use default implementation.\njvm 1    |  INFO | Attempting to acquire the exclusive lock to become the Master broker\njvm 1    |  INFO | Becoming the master on dataSource: org.apache.commons.dbcp.BasicDataSource@4762d950\njvm 1    |  INFO | ActiveMQ 5.3.2 JMS Message Broker (apollo) is starting\njvm 1    |  INFO | For help or more information please see: http://activemq.apache.org/\njvm 1    | ERROR | Failed to start ActiveMQ JMS Message Broker. Reason: java.lang.NullPointerException\njvm 1    | java.lang.NullPointerException\njvm 1    | \tat org.apache.activemq.util.ByteSequence.<init>(ByteSequence.java:29)\njvm 1    | \tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.getLastMessageBrokerSequenceId(JDBCPersistenceAdapter.java:232)\njvm 1    | \tat org.apache.activemq.store.journal.JournalPersistenceAdapter.getLastMessageBrokerSequenceId(JournalPersistenceAdapter.java:222)\njvm 1    | \tat org.apache.activemq.broker.region.DestinationFactoryImpl.getLastMessageBrokerSequenceId(DestinationFactoryImpl.java:140)\njvm 1    | \tat org.apache.activemq.broker.region.RegionBroker.<init>(RegionBroker.java:106)\njvm 1    | \tat org.apache.activemq.broker.jmx.ManagedRegionBroker.<init>(ManagedRegionBroker.java:94)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1734)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1728)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:1688)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:706)\njvm 1    | \tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.start(JDBCPersistenceAdapter.java:276)\njvm 1    | \tat org.apache.activemq.store.journal.JournalPersistenceAdapter.start(JournalPersistenceAdapter.java:265)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.start(BrokerService.java:466)\njvm 1    | \tat org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:85)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\njvm 1    | \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\njvm 1    | \tat java.lang.reflect.Method.invoke(Method.java:597)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1414)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1375)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)\njvm 1    | \tat java.security.AccessController.doPrivileged(Native Method)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)\njvm 1    | \tat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)\njvm 1    | \tat org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:429)\njvm 1    | \tat org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:728)\njvm 1    | \tat org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:380)\njvm 1    | \tat org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:64)\njvm 1    | \tat org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:52)\njvm 1    | \tat org.apache.activemq.xbean.XBeanBrokerFactory.createApplicationContext(XBeanBrokerFactory.java:96)\njvm 1    | \tat org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:52)\njvm 1    | \tat org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:71)\njvm 1    | \tat org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:54)\njvm 1    | \tat org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:115)\njvm 1    | \tat org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:74)\njvm 1    | \tat org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\njvm 1    | \tat org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136)\njvm 1    | \tat org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\njvm 1    | \tat org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\njvm 1    | \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\njvm 1    | \tat java.lang.reflect.Method.invoke(Method.java:597)\njvm 1    | \tat org.apache.activemq.console.Main.runTaskClass(Main.java:251)\njvm 1    | \tat org.apache.activemq.console.Main.main(Main.java:107)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\njvm 1    | \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\njvm 1    | \tat java.lang.reflect.Method.invoke(Method.java:597)\njvm 1    | \tat org.tanukisoftware.wrapper.WrapperSimpleApp.run(WrapperSimpleApp.java:240)\njvm 1    | \tat java.lang.Thread.run(Thread.java:619)\njvm 1    |  INFO | ActiveMQ Message Broker (apollo, null) is shutting down\njvm 1    |  INFO | Connector openwire Stopped\njvm 1    |  INFO | Connector stomp Stopped\njvm 1    |  INFO | ActiveMQ JMS Message Broker (apollo, null) stopped\njvm 1    | ERROR: java.lang.RuntimeException: Failed to execute start task. Reason: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\njvm 1    | java.lang.RuntimeException: Failed to execute start task. Reason: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\njvm 1    | \tat org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:98)\njvm 1    | \tat org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\njvm 1    | \tat org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136)\njvm 1    | \tat org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\njvm 1    | \tat org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\njvm 1    | \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\njvm 1    | \tat java.lang.reflect.Method.invoke(Method.java:597)\njvm 1    | \tat org.apache.activemq.console.Main.runTaskClass(Main.java:251)\njvm 1    | \tat org.apache.activemq.console.Main.main(Main.java:107)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\njvm 1    | \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\njvm 1    | \tat java.lang.reflect.Method.invoke(Method.java:597)\njvm 1    | \tat org.tanukisoftware.wrapper.WrapperSimpleApp.run(WrapperSimpleApp.java:240)\njvm 1    | \tat java.lang.Thread.run(Thread.java:619)\njvm 1    | Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1338)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)\njvm 1    | \tat java.security.AccessController.doPrivileged(Native Method)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)\njvm 1    | \tat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)\njvm 1    | \tat org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:429)\njvm 1    | \tat org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:728)\njvm 1    | \tat org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:380)\njvm 1    | \tat org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:64)\njvm 1    | \tat org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:52)\njvm 1    | \tat org.apache.activemq.xbean.XBeanBrokerFactory.createApplicationContext(XBeanBrokerFactory.java:96)\njvm 1    | \tat org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:52)\njvm 1    | \tat org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:71)\njvm 1    | \tat org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:54)\njvm 1    | \tat org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:115)\njvm 1    | \tat org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:74)\njvm 1    | \t... 16 more\njvm 1    | Caused by: java.lang.NullPointerException\njvm 1    | \tat org.apache.activemq.util.ByteSequence.<init>(ByteSequence.java:29)\njvm 1    | \tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.getLastMessageBrokerSequenceId(JDBCPersistenceAdapter.java:232)\njvm 1    | \tat org.apache.activemq.store.journal.JournalPersistenceAdapter.getLastMessageBrokerSequenceId(JournalPersistenceAdapter.java:222)\njvm 1    | \tat org.apache.activemq.broker.region.DestinationFactoryImpl.getLastMessageBrokerSequenceId(DestinationFactoryImpl.java:140)\njvm 1    | \tat org.apache.activemq.broker.region.RegionBroker.<init>(RegionBroker.java:106)\njvm 1    | \tat org.apache.activemq.broker.jmx.ManagedRegionBroker.<init>(ManagedRegionBroker.java:94)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1734)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1728)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:1688)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:706)\njvm 1    | \tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.start(JDBCPersistenceAdapter.java:276)\njvm 1    | \tat org.apache.activemq.store.journal.JournalPersistenceAdapter.start(JournalPersistenceAdapter.java:265)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.start(BrokerService.java:466)\njvm 1    | \tat org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:85)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\njvm 1    | \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\njvm 1    | \tat java.lang.reflect.Method.invoke(Method.java:597)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1414)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1375)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335)\njvm 1    | \t... 36 more\njvm 1    | ERROR: java.lang.Exception: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\njvm 1    | java.lang.Exception: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\njvm 1    | \tat org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:99)\njvm 1    | \tat org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\njvm 1    | \tat org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136)\njvm 1    | \tat org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\njvm 1    | \tat org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\njvm 1    | \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\njvm 1    | \tat java.lang.reflect.Method.invoke(Method.java:597)\njvm 1    | \tat org.apache.activemq.console.Main.runTaskClass(Main.java:251)\njvm 1    | \tat org.apache.activemq.console.Main.main(Main.java:107)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\njvm 1    | \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\njvm 1    | \tat java.lang.reflect.Method.invoke(Method.java:597)\njvm 1    | \tat org.tanukisoftware.wrapper.WrapperSimpleApp.run(WrapperSimpleApp.java:240)\njvm 1    | \tat java.lang.Thread.run(Thread.java:619)\njvm 1    | Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1338)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)\njvm 1    | \tat java.security.AccessController.doPrivileged(Native Method)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)\njvm 1    | \tat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)\njvm 1    | \tat org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:429)\njvm 1    | \tat org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:728)\njvm 1    | \tat org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:380)\njvm 1    | \tat org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:64)\njvm 1    | \tat org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:52)\njvm 1    | \tat org.apache.activemq.xbean.XBeanBrokerFactory.createApplicationContext(XBeanBrokerFactory.java:96)\njvm 1    | \tat org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:52)\njvm 1    | \tat org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:71)\njvm 1    | \tat org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:54)\njvm 1    | \tat org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:115)\njvm 1    | \tat org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:74)\njvm 1    | \t... 16 more\njvm 1    | Caused by: java.lang.NullPointerException\njvm 1    | \tat org.apache.activemq.util.ByteSequence.<init>(ByteSequence.java:29)\njvm 1    | \tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.getLastMessageBrokerSequenceId(JDBCPersistenceAdapter.java:232)\njvm 1    | \tat org.apache.activemq.store.journal.JournalPersistenceAdapter.getLastMessageBrokerSequenceId(JournalPersistenceAdapter.java:222)\njvm 1    | \tat org.apache.activemq.broker.region.DestinationFactoryImpl.getLastMessageBrokerSequenceId(DestinationFactoryImpl.java:140)\njvm 1    | \tat org.apache.activemq.broker.region.RegionBroker.<init>(RegionBroker.java:106)\njvm 1    | \tat org.apache.activemq.broker.jmx.ManagedRegionBroker.<init>(ManagedRegionBroker.java:94)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1734)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1728)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:1688)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:706)\njvm 1    | \tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.start(JDBCPersistenceAdapter.java:276)\njvm 1    | \tat org.apache.activemq.store.journal.JournalPersistenceAdapter.start(JournalPersistenceAdapter.java:265)\njvm 1    | \tat org.apache.activemq.broker.BrokerService.start(BrokerService.java:466)\njvm 1    | \tat org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:85)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\njvm 1    | \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\njvm 1    | \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\njvm 1    | \tat java.lang.reflect.Method.invoke(Method.java:597)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1414)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1375)\njvm 1    | \tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335)\njvm 1    | \t... 36 more\nwrapper  | <-- Wrapper Stopped\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"171895","customfield_12312823":null,"summary":"ActiveMQ broker fails to start due to java.lang.NullPointerException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jjanyan","name":"jjanyan","key":"jjanyan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"josh anyan","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jjanyan","name":"jjanyan","key":"jjanyan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"josh anyan","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux hostname-removed 2.6.21.7-2.fc8xen #1 SMP Fri Feb 15 12:34:28 EST 2008 x86_64 x86_64 x86_64 GNU/Linux\n\njava version \"1.6.0_21\"\nJava(TM) SE Runtime Environment (build 1.6.0_21-b06)\nJava HotSpot(TM) 64-Bit Server VM (build 17.0-b16, mixed mode)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483844/comment/13019420","id":"13019420","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muellerc","name":"muellerc","key":"muellerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=muellerc&avatarId=12331","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=muellerc&avatarId=12331","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=muellerc&avatarId=12331","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=muellerc&avatarId=12331"},"displayName":"Christian Müller","active":true,"timeZone":"Europe/Berlin"},"body":"We running in the same issue. Any updates here?\n\nEnv:\napache-activemq-5.3.1-fuse-02-01\n\nWe are using the jdbc persistence store (Oracle).\n{code}\n<persistenceAdapter>\n    <jdbcPersistenceAdapter dataSource=\"#oracle-ds\"/>\n</persistenceAdapter>\n\n<bean id=\"oracle-ds\" class=\"org.apache.commons.dbcp.BasicDataSource\" destroy-method=\"close\">\n    <property name=\"driverClassName\" value=\"oracle.jdbc.driver.OracleDriver\"/>\n    <property name=\"url\" value=\"jdbc:oracle:thin:@127.0.0.1:1521:SID\"/>\n    <property name=\"username\" value=\"user\"/>\n    <property name=\"password\" value=\"password\"/>\n    <property name=\"poolPreparedStatements\" value=\"true\"/>\n    <property name=\"initialSize\" value=\"5\"/>\n    <property name=\"maxActive\" value=\"7\"/>\n    <property name=\"minIdle\" value=\"2\"/>\n    <property name=\"maxIdle\" value=\"5\"/>\n    <property name=\"validationQuery\" value=\"SELECT 1 FROM DUAL\"/>\n    <property name=\"testOnBorrow\" value=\"true\"/>\n</bean>\n{code}\n\nThanks in advance,\nChristian","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muellerc","name":"muellerc","key":"muellerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=muellerc&avatarId=12331","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=muellerc&avatarId=12331","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=muellerc&avatarId=12331","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=muellerc&avatarId=12331"},"displayName":"Christian Müller","active":true,"timeZone":"Europe/Berlin"},"created":"2011-04-13T16:29:57.808+0000","updated":"2011-04-13T16:29:57.808+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483844/comment/13019422","id":"13019422","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muellerc","name":"muellerc","key":"muellerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=muellerc&avatarId=12331","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=muellerc&avatarId=12331","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=muellerc&avatarId=12331","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=muellerc&avatarId=12331"},"displayName":"Christian Müller","active":true,"timeZone":"Europe/Berlin"},"body":"Our complete stack trace looks like:\n{noformat}\nava Runtime: Sun Microsystems Inc. 1.6.0_21 /opt/sia/java/jre1.6.0_21\n  Heap sizes: current=203136k  free=199951k  max=699072k\n    JVM args: -Xmx768M -Dorg.apache.activemq.UseDedicatedTaskRunner=true -Djava.util.logging.config.file=logging.properties -Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.port=11119 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=10.51.44.35 -Dactivemq.classpath=/opt/sia/apache-activemq-5.3.1-fuse-02-01/conf; -Dactivemq.home=/opt/sia/apache-activemq-5.3.1-fuse-02-01 -Dactivemq.base=/opt/sia/apache-activemq-5.3.1-fuse-02-01\nACTIVEMQ_HOME: /opt/sia/apache-activemq-5.3.1-fuse-02-01\nACTIVEMQ_BASE: /opt/sia/apache-activemq-5.3.1-fuse-02-01\nLoading message broker from: xbean:activemq.xml\nINFO | Using Persistence Adapter: JDBCPersistenceAdapter(org.apache.commons.dbcp.BasicDataSource@628f9a32)\nINFO | Database adapter driver override recognized for : [oracle_jdbc_driver] - adapter: class org.apache.activemq.store.jdbc.adapter.OracleJDBCAdapter\nINFO | Database lock driver override not found for : [oracle_jdbc_driver].  Will use default implementation.\nINFO | Attempting to acquire the exclusive lock to become the Master broker\nINFO | Becoming the master on dataSource: org.apache.commons.dbcp.BasicDataSource@628f9a32\nINFO | ActiveMQ 5.3.1-fuse-02-01 JMS Message Broker (amqcat02) is starting\nINFO | For help or more information please see: http://activemq.apache.org/\nERROR | Failed to start ActiveMQ JMS Message Broker. Reason: java.lang.NullPointerException\njava.lang.NullPointerException\n        at org.apache.activemq.util.ByteSequence.<init>(ByteSequence.java:29)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.getLastMessageBrokerSequenceId(JDBCPersistenceAdapter.java:232)\n        at org.apache.activemq.broker.region.DestinationFactoryImpl.getLastMessageBrokerSequenceId(DestinationFactoryImpl.java:140)\n        at org.apache.activemq.broker.region.RegionBroker.<init>(RegionBroker.java:106)\n        at org.apache.activemq.broker.jmx.ManagedRegionBroker.<init>(ManagedRegionBroker.java:95)\n        at org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1740)\n        at org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1734)\n        at org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:1694)\n        at org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:712)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.start(JDBCPersistenceAdapter.java:276)\n        at org.apache.activemq.broker.BrokerService.start(BrokerService.java:469)\n        at org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:85)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1414)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1375)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)\n        at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)\n        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:429)\n        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:728)\n        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:380)\n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:64)\n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:52)\n        at org.apache.activemq.xbean.XBeanBrokerFactory.createApplicationContext(XBeanBrokerFactory.java:96)\n        at org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:52)\n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:71)\n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:54)\n        at org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:115)\n        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:74)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at org.apache.activemq.console.Main.runTaskClass(Main.java:251)\n        at org.apache.activemq.console.Main.main(Main.java:107)\nINFO | ActiveMQ Message Broker (amqcat02, null) is shutting down\nINFO | Network Connector F_TO_B Stopped\nINFO | Connector openwire Stopped\nINFO | Connector open2 Stopped\nINFO | Connector ssl Stopped\nINFO | ActiveMQ JMS Message Broker (amqcat02, null) stopped\nERROR: java.lang.RuntimeException: Failed to execute start task. Reason: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\njava.lang.RuntimeException: Failed to execute start task. Reason: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\n        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:98)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at org.apache.activemq.console.Main.runTaskClass(Main.java:251)\n        at org.apache.activemq.console.Main.main(Main.java:107)\nCaused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1338)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)\n        at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)\n        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:429)\n        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:728)\n        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:380)\n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:64)\n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:52)\n        at org.apache.activemq.xbean.XBeanBrokerFactory.createApplicationContext(XBeanBrokerFactory.java:96)\n        at org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:52)\n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:71)\n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:54)\n        at org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:115)\n        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:74)\n        ... 10 more\nCaused by: java.lang.NullPointerException\n        at org.apache.activemq.util.ByteSequence.<init>(ByteSequence.java:29)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.getLastMessageBrokerSequenceId(JDBCPersistenceAdapter.java:232)\n        at org.apache.activemq.broker.region.DestinationFactoryImpl.getLastMessageBrokerSequenceId(DestinationFactoryImpl.java:140)\n        at org.apache.activemq.broker.region.RegionBroker.<init>(RegionBroker.java:106)\n        at org.apache.activemq.broker.jmx.ManagedRegionBroker.<init>(ManagedRegionBroker.java:95)\n        at org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1740)\n        at org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1734)\n        at org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:1694)\n        at org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:712)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.start(JDBCPersistenceAdapter.java:276)\n        at org.apache.activemq.broker.BrokerService.start(BrokerService.java:469)\n        at org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:85)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1414)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1375)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335)\n        ... 30 more\nERROR: java.lang.Exception: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\njava.lang.Exception: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\n        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:99)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136)\n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)\n        at org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at org.apache.activemq.console.Main.runTaskClass(Main.java:251)\n        at org.apache.activemq.console.Main.main(Main.java:107)\nCaused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.apache.activemq.xbean.XBeanBrokerService#0' defined in class path resource [activemq.xml]: Invocation of init method failed; nested exception is java.lang.NullPointerException\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1338)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)\n        at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)\n        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:429)\n        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:728)\n        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:380)\n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:64)\n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.<init>(ResourceXmlApplicationContext.java:52)\n        at org.apache.activemq.xbean.XBeanBrokerFactory.createApplicationContext(XBeanBrokerFactory.java:96)\n        at org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:52)\n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:71)\n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:54)\n        at org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:115)\n        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:74)\n        ... 10 more\nCaused by: java.lang.NullPointerException\n        at org.apache.activemq.util.ByteSequence.<init>(ByteSequence.java:29)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.getLastMessageBrokerSequenceId(JDBCPersistenceAdapter.java:232)\n        at org.apache.activemq.broker.region.DestinationFactoryImpl.getLastMessageBrokerSequenceId(DestinationFactoryImpl.java:140)\n        at org.apache.activemq.broker.region.RegionBroker.<init>(RegionBroker.java:106)\n        at org.apache.activemq.broker.jmx.ManagedRegionBroker.<init>(ManagedRegionBroker.java:95)\n        at org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1740)\n        at org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1734)\n        at org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:1694)\n        at org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:712)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.start(JDBCPersistenceAdapter.java:276)\n        at org.apache.activemq.broker.BrokerService.start(BrokerService.java:469)\n        at org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:85)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1414)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1375)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335)\n        ... 30 more\n\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muellerc","name":"muellerc","key":"muellerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=muellerc&avatarId=12331","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=muellerc&avatarId=12331","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=muellerc&avatarId=12331","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=muellerc&avatarId=12331"},"displayName":"Christian Müller","active":true,"timeZone":"Europe/Berlin"},"created":"2011-04-13T16:32:14.518+0000","updated":"2011-04-13T16:32:14.518+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483844/comment/13019532","id":"13019532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muellerc","name":"muellerc","key":"muellerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=muellerc&avatarId=12331","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=muellerc&avatarId=12331","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=muellerc&avatarId=12331","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=muellerc&avatarId=12331"},"displayName":"Christian Müller","active":true,"timeZone":"Europe/Berlin"},"body":"I think the problem is related to this piece of code. The call to \"getAdapter().doGetLastMessageStoreSequenceId(c)\" returns the \"Math.max(lastSequenceIdInMsg, lastSequenceIdInAcks)\". In the case the broker was not shut down right, the sequenceId from lastSequenceIdInAcks is higher than the lastSequenceIdInMsg. But the JDBCPersistenceAdapter does not care about this and try to load the message with this id and fails with a NPE.\n\n{code:title=org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.java}\n    public long getLastMessageBrokerSequenceId() throws IOException {\n        // Get a connection and insert the message into the DB.\n        TransactionContext c = getTransactionContext();\n        try {\n            long seq =  getAdapter().doGetLastMessageStoreSequenceId(c);\n            sequenceGenerator.setLastSequenceId(seq);\n            long brokerSeq = 0;\n            if (seq != 0) {\n            \tMessage last = (Message)wireFormat.unmarshal(new ByteSequence(getAdapter().doGetMessageById(c, seq)));\n            \tbrokerSeq = last.getMessageId().getBrokerSequenceId();\n            }\n            return brokerSeq;\n        } catch (SQLException e) {\n            JDBCPersistenceAdapter.log(\"JDBC Failure: \", e);\n            throw IOExceptionSupport.create(\"Failed to get last broker message id: \" + e, e);\n        } finally {\n            c.close();\n        }\n    }\n{code}\n\nIf someone could tell me what the right behavior is, I could provide a patch for this issue...\n\nChristian","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muellerc","name":"muellerc","key":"muellerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=muellerc&avatarId=12331","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=muellerc&avatarId=12331","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=muellerc&avatarId=12331","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=muellerc&avatarId=12331"},"displayName":"Christian Müller","active":true,"timeZone":"Europe/Berlin"},"created":"2011-04-13T20:29:34.582+0000","updated":"2011-04-13T20:29:34.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483844/comment/13019740","id":"13019740","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Hmm, that is a problem, i think the message corresponding to the seqId from the acks may not be in the store because it could already have been removed.\nI think the brokerSeq should be set to the 'seq' in that case as a fallback.\n\nOn trunk there is a null check but brokerSeq defaults to 0, which means that ids will be reused, in a failover message producer this could lead to duplicates.\n\nI think trunk needs to default the brokerSeq to the seq value returned from the store.\n\nfyi: the root problem is that the brokerSeq, incremented when a messages is received cannot be used as the orderId/seqId in the store because they values get out of sync when transactions are used, commits may be out of order w.r.t to initial sends. For that reason, the next brokerSeq needs to be derived from what is stored on a restart.\nIn the case that the value comes from what is acked and the message is no longer available, using the value from the ack table as the new value makes sense.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-14T09:03:39.559+0000","updated":"2011-04-14T09:04:58.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483844/comment/13035069","id":"13035069","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muellerc","name":"muellerc","key":"muellerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=muellerc&avatarId=12331","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=muellerc&avatarId=12331","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=muellerc&avatarId=12331","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=muellerc&avatarId=12331"},"displayName":"Christian Müller","active":true,"timeZone":"Europe/Berlin"},"body":"I think this issue is solved. The code in trunk is:\n\n{code:title=org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.java}\n    public long getLastMessageBrokerSequenceId() throws IOException {\n        TransactionContext c = getTransactionContext();\n        try {\n            long seq =  getAdapter().doGetLastMessageStoreSequenceId(c);\n            sequenceGenerator.setLastSequenceId(seq);\n            long brokerSeq = 0;\n            if (seq != 0) {\n                byte[] msg = getAdapter().doGetMessageById(c, seq);\n                if (msg != null) {\n                    Message last = (Message)wireFormat.unmarshal(new ByteSequence(msg));\n                    brokerSeq = last.getMessageId().getBrokerSequenceId();\n                } else {\n                   LOG.warn(\"Broker sequence id wasn't recovered properly, possible duplicates!\");\n                }\n            }\n            return brokerSeq;\n        } catch (SQLException e) {\n            JDBCPersistenceAdapter.log(\"JDBC Failure: \", e);\n            throw IOExceptionSupport.create(\"Failed to get last broker message id: \" + e, e);\n        } finally {\n            c.close();\n        }\n    }\n{code}\n\nSo it's no longer possible to get the NPE by creating the ByteSequence. This issue is a duplicate to [AMQ-2696|https://issues.apache.org/jira/browse/AMQ-2696] which is already solved and can be closed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muellerc","name":"muellerc","key":"muellerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=muellerc&avatarId=12331","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=muellerc&avatarId=12331","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=muellerc&avatarId=12331","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=muellerc&avatarId=12331"},"displayName":"Christian Müller","active":true,"timeZone":"Europe/Berlin"},"created":"2011-05-17T21:27:57.829+0000","updated":"2011-05-17T21:27:57.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483844/comment/13057860","id":"13057860","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Issue ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-06-30T14:56:26.640+0000","updated":"2011-06-30T14:56:26.640+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2956/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tsb3:"}}