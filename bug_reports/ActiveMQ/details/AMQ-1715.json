{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482734","self":"https://issues.apache.org/jira/rest/api/2/issue/12482734","key":"AMQ-1715","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2008-05-23T05:38:50.499+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 16 20:12:55 UTC 2010","customfield_12310420":"84794","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_69035055811_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-07-16T20:12:55.370+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1715/watchers","watchCount":2,"isWatching":false},"created":"2008-05-08T19:48:39.559+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-07-16T20:12:55.364+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I started getting this following error again in AMQ 5.1.0 stable release. I used to get this error on 4.1.0 and 5.0.0. This error disapeard for a while in AMQ 4.1.2 but came back again in 5.1.0. \n\nMy client also gets this exception. at the AMQ side it shows up as a WARN but to the C STOMP client it goes an ugly java stacktrace. \n\nAMQ Log:\n\njavax.jms.InvalidClientIDException: Broker: localhost - Client: WRK_batch01_9121 already connected from /xx.xxx.xxx.xx:51577\n        at org.apache.activemq.broker.region.RegionBroker.addConnection(RegionBroker.java:211)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:81)\n        at org.apache.activemq.advisory.AdvisoryBroker.addConnection(AdvisoryBroker.java:75)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:81)\n        at org.apache.activemq.broker.MutableBrokerFilter.addConnection(MutableBrokerFilter.java:88)\n        at org.apache.activemq.broker.TransportConnection.processAddConnection(TransportConnection.java:662)\n        at org.apache.activemq.broker.jmx.ManagedTransportConnection.processAddConnection(ManagedTransportConnection.java:86)\n        at org.apache.activemq.command.ConnectionInfo.visit(ConnectionInfo.java:125)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:80)\n        at org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:134)\n        at org.apache.activemq.transport.stomp.ProtocolConverter.onStompConnect(ProtocolConverter.java:461)\n        at org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommad(ProtocolConverter.java:186)\n        at org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:70)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:196)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:183)\n        at java.lang.Thread.run(Thread.java:619)\n\n\nC STOMP Client END: \n\nResponse: ERROR, javax.jms.InvalidClientIDException: Broker: localhost - Client: WRK_batch01_9121 already connected from /xx.xxx.xxx.xx:51577\n    at org.apache.activemq.broker.region.RegionBroker.addConnection(RegionBroker.java:211)\n  at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:81)\n  at org.apache.activemq.advisory.AdvisoryBroker.addConnection(AdvisoryBroker.java:75)\n    at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:81)\n  at org.apache.activemq.broker.MutableBrokerFilter.addConnection(MutableBrokerFilter.java:88)\n    at org.apache.activemq.broker.TransportConnection.processAddConnection(TransportConnection.java:662)\n    at org.apache.activemq.broker.jmx.ManagedTransportConnection.processAddConnection(ManagedTransportConnection.java:86)\n   at org.apache.activemq.command.ConnectionInfo.visit(ConnectionInfo.java:125)\n    at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)\n     at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n     at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:80)\n        at org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:134)\n     at org.apache.activemq.transport.stomp.ProtocolConverter.onStompConnect(ProtocolConverter.java:461)\n     at org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommad(ProtocolConverter.java:186)\n      at org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:70)\n     at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n   at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:196)\n  at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:183)\n    at java.lang.Thread.run(Thread.java:619)\n, SessionId=unknown\n\nPlease help!\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59839","customfield_12312823":null,"summary":"Still getting STOMP Client connect error in AMQ 5.1.0 Release ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikdhawan","name":"vikdhawan","key":"vikdhawan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"vik dhawan","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikdhawan","name":"vikdhawan","key":"vikdhawan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"vik dhawan","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Sun Solaris 10 ","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482734/comment/12939732","id":"12939732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haribaasha","name":"haribaasha","key":"haribaasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari","active":true,"timeZone":"Etc/UTC"},"body":"hi, i am encountering the same issue:\n\ni am using a .Net client which connects to the broker fine. on a reconnect from the client (network issue or if broker restarts) , also when reconnection happens the old connection does not close on the linux side at all, netstat shows no of connections to 10.1.30.176 is increasing linearly..\n\nstacktrace :-\n\njavax.jms.InvalidClientIDException: Broker: localhost - Client: 694bd87b-2941-462a-9e7a-33860fb491bf already connected from /10.1.30.176:1318\n        at org.apache.activemq.broker.region.RegionBroker.addConnection(RegionBroker.java:211)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:81)\n        at org.apache.activemq.advisory.AdvisoryBroker.addConnection(AdvisoryBroker.java:75)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:81)\n        at org.apache.activemq.broker.MutableBrokerFilter.addConnection(MutableBrokerFilter.java:88)\n        at org.apache.activemq.broker.TransportConnection.processAddConnection(TransportConnection.java:662)\n        at org.apache.activemq.broker.jmx.ManagedTransportConnection.processAddConnection(ManagedTransportConnection.java:86)\n        at org.apache.activemq.command.ConnectionInfo.visit(ConnectionInfo.java:125)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:196)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:183)\n        at java.lang.Thread.run(Thread.java:595)\n\n\nNow in RegionBroker.java i see - \n synchronized (clientIdSet) {\n            ConnectionContext oldContext = clientIdSet.get(clientId);\n            if (oldContext != null) {\n\t\tSystem.out.println( \"heyyyy\" + context.isFaultTolerant() + \"||\" + context.isNetworkConnection() );\n            \tif (context.isFaultTolerant() || context.isNetworkConnection()){\n            \t\t//remove the old connection\n            \t\ttry{\n            \t\t\tremoveConnection(oldContext, info, new Exception(\"remove stale client\"));\n            \t\t}catch(Exception e){\n            \t\t\tLOG.warn(\"Failed to remove stale connection \",e);\n            \t\t}\n            \t}else{\n                throw new InvalidClientIDException(\"Broker: \" + getBrokerName() + \" - Client: \" + clientId + \" already connected from \"\n                                                   + oldContext.getConnection().getRemoteAddress());\n            \t}\n            } else {\n                clientIdSet.put(clientId, context);\n            }\n        }\n\nIt seems like isnetworkconnection and isfaulttolerant are false and hence goes into the else throwing the exception.\nOn setting the faulttolerant as true in TransportConnection.java (lines 650-655)\n       context.setConnector(connector);\n        context.setMessageAuthorizationPolicy(getMessageAuthorizationPolicy());\n        context.setNetworkConnection(networkConnection);\n        //context.setFaultTolerant(faultTolerantConnection);\n\tcontext.setFaultTolerant(true);\n\nthe exception does not happen anymore and also the network connections being open problem is solved, which makes sense considering it goes into the if condition and the oldcontext is removed from the clienthashset.\n\nIs this a fix ? or am i doing something wrong setting the flag as true when it gets set false by itself ?? \nBy default RegionBroker seems to return faulttolerantconfig as false.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haribaasha","name":"haribaasha","key":"haribaasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari","active":true,"timeZone":"Etc/UTC"},"created":"2008-05-23T05:38:50.499+0000","updated":"2008-05-23T05:38:50.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482734/comment/12939730","id":"12939730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haribaasha","name":"haribaasha","key":"haribaasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari","active":true,"timeZone":"Etc/UTC"},"body":"On upgrading the apache.NMS.net client to the latest there is no exception on the server side. The latest NMS client creates a new clientid for a reconnect and hence it makes sense that i dont see the exception on the server side. \nThere is a problem with the no of connections. The NMS client is connected first with the server(running on 51616) on port 3000. On a reconnect its connected on 3002, but the old connection is also alive ??. On invoking the stop method from the jconsole on the connection(3000) the connection is killed (monitoring using netstat on the machine). Should the activemq server automatically know that a connection is stale and disconnect/kill the old connection ?\n\non the client side a netstat shows only one connection(3002) , we did a reconnect by disabling and enabling the lan connection in the windows tray.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=haribaasha","name":"haribaasha","key":"haribaasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari","active":true,"timeZone":"Etc/UTC"},"created":"2008-05-26T05:34:22.035+0000","updated":"2008-05-26T05:34:22.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482734/comment/12940887","id":"12940887","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I've tested some simillar problem reports this week and cannot reproduce this using the latest AMQ broker and NMS clients.  If the problem is still present then a Test case and instructions for reproducing the error would be helpful.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2010-07-16T20:12:55.336+0000","updated":"2010-07-16T20:12:55.336+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1715/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0am0f:"}}