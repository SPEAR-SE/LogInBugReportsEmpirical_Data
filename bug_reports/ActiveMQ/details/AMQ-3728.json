{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12543322","self":"https://issues.apache.org/jira/rest/api/2/issue/12543322","key":"AMQ-3728","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315631","id":"12315631","description":"Issues that are getting ready to be kicked - review 'em once more if you like","name":"AGING_TO_DIE","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2012-02-21T20:46:28.897+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 07 21:27:12 UTC 2015","customfield_12310420":"228568","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_109249198594_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-08-07T21:27:12.494+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3728/watchers","watchCount":4,"isWatching":false},"created":"2012-02-20T10:27:13.944+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-08-07T21:27:12.535+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have following configuration:\n1.One producer\n2.One broker on the same machine as producer.\n3.One offline durable subscriber but I have enough storage size so it should not overflow.\n\nI run our import test and it sends about 10 messages/s. After some hours of run I start to get:\nmany \n{code}javax.jms.JMSException: org.apache.activemq.transport.RequestTimedOutIOException{code}\n (I set send timeout 2s to avoid infinite block in case that broker storage is full. So first question is why it happens when there should be enough space. I will provide my broker configuration below.)\n\nThen I get:\n{code}\njavax.jms.JMSException: Cannot send, channel has already failed: usfr-cmsnpdev.insideidc.com/10.1.4.42:61616\njavax.jms.JMSException: Cannot send, channel has already failed: usfr-cmsnpdev.insideidc.com/10.1.4.42:61616\n(ActiveMQ Connection Executor: tcp://usfr-cmsnpdev.insideidc.com/10.1.4.42:61616) Failed to send message.: javax.jms.JMSException: Broken pipe\n{code}\nsome more\n{code}\njavax.jms.JMSException: Cannot send, channel has already failed: usfr-cmsnpdev.insideidc.com/10.1.4.42:61616\n{code}\nand then all the time:\n{code}\njavax.jms.IllegalStateException: The Session is closed\n{code}\nI have simple producer code. It is Spring bean. I create connection and session when bean is created. For every send message I create producer and close it:\n{code}\n//Init code\nconnection = connectionFactory.createConnection();\nconnection.setExceptionListener(new ExceptionListener() {\n    public void onException(JMSException ex) {\n        logger.error(\"Failed to send message.\", ex);\n    }\n});\nsession = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\n....\n//Send code\n    private void sendMessage(String xmlMessage, Topic topic, String containerId) {\n        MessageProducer producer = null;\n        try {\n            // Create the producer.\n            producer = session.createProducer(topic);\n            TextMessage txtMessage = session.createTextMessage(xmlMessage);\n            producer.send(txtMessage);\n        } catch (JMSException ex) {\n            logger.error(\"\", ex);\n        } finally {\n            try {\n                if (producer != null) {\n                    producer.close();\n                }\n            } catch (JMSException ex) {\n            }\n        }\n    }\n{code}\nUse default connection factory:\n{code}\n    <bean id=\"idc_metacop_jmsFactory.prototype\"\n          class=\"org.apache.activemq.ActiveMQConnectionFactory\"\n          abstract=\"true\">\n        <property name=\"brokerURL\" value=\"${metacop.jms.brokerURL}\"/>\n        <property name=\"sendTimeout\" value=\"2000\"/>\n    </bean>\n{code}\nLog from broker:\n{code}\n2012-02-17 21:55:40,389 | INFO  | Transport failed: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (>30000) long: /10.1.4.42:56166 | org.apache.activemq.broker.TransportConnection.Transport | InactivityMonitor Async Task: java.util.concurrent.ThreadPoolExecutor$Worker@fcc9c76\n2012-02-17 21:55:42,445 | INFO  | Transport failed: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (>30000) long: /10.1.4.42:39395 | org.apache.activemq.broker.TransportConnection.Transport | InactivityMonitor Async Task: java.util.concurrent.ThreadPoolExecutor$Worker@fcc9c76\n{code}\nBroker configuration:\n{code}\n   <broker xmlns=\"http://activemq.apache.org/schema/core\" brokerName=\"localhost\" dataDirectory=\"${activemq.base}/data\" destroyApplicationContextOnStop=\"true\">\n        <destinationPolicy>\n            <policyMap>\n              <policyEntries>\n                <policyEntry topic=\">\" producerFlowControl=\"true\" memoryLimit=\"200mb\">\n                </policyEntry>\n                <policyEntry queue=\">\" producerFlowControl=\"true\" memoryLimit=\"200mb\">\n                </policyEntry>\n              </policyEntries>\n            </policyMap>\n        </destinationPolicy>\n\n        <managementContext>\n            <managementContext createConnector=\"false\"/>\n        </managementContext>\n\n        <persistenceAdapter>\n            <kahaDB directory=\"${activemq.base}/data/kahadb\"/>\n        </persistenceAdapter>\n        <systemUsage>\n            <systemUsage>\n                <memoryUsage>\n                    <memoryUsage limit=\"500 mb\"/>\n                </memoryUsage>\n                <storeUsage>\n                    <storeUsage limit=\"2 gb\"/>\n                </storeUsage>\n                <tempUsage>\n                    <tempUsage limit=\"2 gb\"/>\n                </tempUsage>\n            </systemUsage>\n        </systemUsage>\n\n        <transportConnectors>\n            <transportConnector name=\"openwire\" uri=\"tcp://0.0.0.0:61616\"/>\n        </transportConnectors>\n\n    </broker>\n{code}\nI can provide full call stacks if necessary. One thing which comes to my mind: When I have just one connection is call of producer.send thread safe? I do not have any synchronization there.\n\nBTW is there any way how to purge even undelivered messages from broker storage? Or how to monitor number of messages in storage? I tried to delete offline durable subscribers from Web Admin but data folder size does not change but I have no way how to see if messages was really removed from storage (and db is not compacted only or if messages stay in storage.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81449","customfield_12312823":null,"summary":"Broker stops to accept messages","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux, 64bit, JDK 6u30 64bit","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13212935","id":"13212935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Have you tested using a 5.6-SNAPSHOT to see if your issue has already been resolved?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-02-21T20:46:28.897+0000","updated":"2012-02-21T20:46:28.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13212962","id":"13212962","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"body":"No not yet. I will test. I just run another test tonight. I will see tomorrow.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-21T21:19:28.626+0000","updated":"2012-02-21T21:19:28.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13214484","id":"13214484","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"body":"So I tested last snapshot (I downloaded latest binary broker build and for my producer I set URL for ActiveMQ snapshot repository), I reviewed my code to make sure Session is used from one thread only, I cache producers (I have 3 producers for 3 topics), I even created Session and MessageProducers in worker thread and then call send from this worker thread. Still after 23000 messages sent it again fails. This time there is no subscriber. Only producer and broker. This time it starts with:\n{code}\n2012-02-22 21:37:43,224 ERROR [com.idc.publishing.metacop.jms.JmsProducer] (JmsProducerWorker-1) MetaCop Error > Could not send message to JMS topic:idc.publishing.metacop.Company2: javax.jms.JMSException: java.io.EOFException\n        at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:62) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.ActiveMQConnection.doSyncSendPacket(ActiveMQConnection.java:1360) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1340) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1777) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:247) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:241) [activemq-core-5.6-20120104.153301-1.jar:]\n        at com.idc.publishing.metacop.jms.JmsProducer$3.run(JmsProducer.java:210) [classes:]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) [:1.6.0_30]\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) [:1.6.0_30]\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138) [:1.6.0_30]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) [:1.6.0_30]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) [:1.6.0_30]\n        at java.lang.Thread.run(Thread.java:662) [:1.6.0_30]\nCaused by: java.io.EOFException\n        at java.io.DataInputStream.readInt(DataInputStream.java:375) [:1.6.0_30]\n        at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:275) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:229) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:221) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:204) [activemq-core-5.6-20120104.153301-1.jar:]\n        ... 1 more\n{code}\nIt is after I sent about 110000 messages successfully.\n\nAfter a while it tries to recover:\n{code}\n2012-02-22 21:37:43,698 INFO  [org.springframework.jms.listener.SimpleMessageListenerContainer] (ActiveMQ Connection Executor: tcp://usfr-cmsnpdev.insideidc.com/10.1.4.42:61616) Trying to recover from JMS Connection exception: javax.jms.JMSException: java.io.EOFException\n2012-02-22 21:37:43,698 DEBUG [com.idc.publishing.metacop.repository.DocumentRepositoryImpl] (CalaisWorker-11) Update classification with 38 categories for document:HW62R9\n2012-02-22 21:37:43,705 ERROR [stderr] (InactivityMonitor WriteCheck) Exception in thread \"InactivityMonitor WriteCheck\" java.util.concurrent.RejectedExecutionException\n2012-02-22 21:37:43,705 ERROR [stderr] (InactivityMonitor WriteCheck)   at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:1768)\n2012-02-22 21:37:43,705 ERROR [stderr] (InactivityMonitor WriteCheck)   at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:767)\n2012-02-22 21:37:43,705 ERROR [stderr] (InactivityMonitor WriteCheck)   at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:658)\n2012-02-22 21:37:43,705 ERROR [stderr] (InactivityMonitor WriteCheck)   at org.apache.activemq.transport.AbstractInactivityMonitor.writeCheck(AbstractInactivityMonitor.java:142)\n2012-02-22 21:37:43,705 ERROR [stderr] (InactivityMonitor WriteCheck)   at org.apache.activemq.transport.AbstractInactivityMonitor$2.run(AbstractInactivityMonitor.java:111)\n2012-02-22 21:37:43,705 ERROR [stderr] (InactivityMonitor WriteCheck)   at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\n2012-02-22 21:37:43,720 ERROR [stderr] (InactivityMonitor WriteCheck)   at java.util.TimerThread.mainLoop(Timer.java:512)\n2012-02-22 21:37:43,720 ERROR [stderr] (InactivityMonitor WriteCheck)   at java.util.TimerThread.run(Timer.java:462)\n{code}\nand next session gets closed:\n{code}\n2012-02-22 21:37:45,229 ERROR [com.idc.publishing.metacop.jms.JmsProducer] (JmsProducerWorker-1) MetaCop Error > Could not send message to JMS topic:idc.publishing.metacop.Document2: javax.jms.IllegalStateException: The Session is closed\n        at org.apache.activemq.ActiveMQSession.checkClosed(ActiveMQSession.java:727) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.ActiveMQSession.configureMessage(ActiveMQSession.java:715) [activemq-core-5.6-20120104.153301-1.jar:]\n        at org.apache.activemq.ActiveMQSession.createTextMessage(ActiveMQSession.java:428) [activemq-core-5.6-20120104.153301-1.jar:]\n        at com.idc.publishing.metacop.jms.JmsProducer$3.run(JmsProducer.java:209) [classes:]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) [:1.6.0_30]\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) [:1.6.0_30]\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138) [:1.6.0_30]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) [:1.6.0_30]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) [:1.6.0_30]\n        at java.lang.Thread.run(Thread.java:662) [:1.6.0_30]\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-23T09:11:53.886+0000","updated":"2012-02-23T09:14:20.598+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13223824","id":"13223824","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Since there is an offline durable subscriber the store will eventually fill up and the send will fail since you have a send timeout configured.  All appears to be working as designed.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-03-06T23:45:32.939+0000","updated":"2012-03-06T23:45:32.939+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13224191","id":"13224191","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"body":"I see the same problem even without ANY subscriber.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-07T10:14:06.648+0000","updated":"2012-03-07T10:14:06.648+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13224231","id":"13224231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Are you seeing a variant of http://activemq.apache.org/slow-networks-drop-large-messages.html - as in you need to configure the inactivity monitor?\n\nI think the{code}2012-02-22 21:37:43,705 ERROR [stderr] (InactivityMonitor WriteCheck) Exception in thread \"InactivityMonitor WriteCheck\" java.util.concurrent.RejectedExecutionException\n{code} issues is resolved on trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-07T12:26:52.029+0000","updated":"2012-03-07T12:26:52.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13224238","id":"13224238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"body":"In this test producer and broker are on the same machine and messages are small (few KBs). Any idea at what date recovery was fixed? I tested latest snapshot build at that day. First problem is why connection fails/is lost. Recommended usage is to keep connection and reuse it but in my case it does not work. Currently only workaround I see is to periodically recreate connection.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-07T12:39:13.635+0000","updated":"2012-03-07T12:39:13.635+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13458632","id":"13458632","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Have you tried using the activemq-pool or other pooling (Spring has a CachedPoolingConnectionFactory i think its name is) for the producer.\nThat is the generally recommendation for a client if they are not reusing the same producer instance to send many messages.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-19T12:27:32.224+0000","updated":"2012-09-19T12:27:32.224+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13458666","id":"13458666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"body":"I create new producer for every message send. I use org.apache.activemq.ActiveMQConnectionFactory as connection factory. Code sample for sending message is as follows:\n{code}\n    private void sendMessage(String xmlMessage, Topic topic, String containerId) {\n        String topicName = null;\n        MessageProducer producer = null;\n        try {\n            topicName = topic.getTopicName();\n            // Create the producer.\n            producer = session.createProducer(topic);\n            TextMessage txtMessage = session.createTextMessage(xmlMessage);\n            producer.send(txtMessage);\n        } catch (JMSException ex) {\n            //Exception handling....\n        } finally {\n            //Closing producer ...\n        }\n    }\n{code}\nConnection and session are created in init method. So it does not use any connection pooling.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mslama","name":"mslama","key":"mslama","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marek Slama","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-19T13:07:14.239+0000","updated":"2012-09-19T13:14:42.600+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/13460236","id":"13460236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"If you are still seeing an issue using the latest release or one of the latest nightlies than I'd recommend putting together a JUnit test case that reproduces your problem so that someone can look into it further.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-09-21T05:44:47.153+0000","updated":"2012-09-21T05:44:47.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543322/comment/14662492","id":"14662492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"A unit test was never provided to validate this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-08-07T21:27:12.520+0000","updated":"2015-08-07T21:27:12.520+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3728/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0eaev:"}}