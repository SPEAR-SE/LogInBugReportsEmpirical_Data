{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12745540","self":"https://issues.apache.org/jira/rest/api/2/issue/12745540","key":"AMQ-5382","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-11-01T13:05:50.166+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Nov 05 04:44:58 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5382/watchers","watchCount":5,"isWatching":false},"created":"2014-10-02T17:03:19.744+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["MQTT"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324951","id":"12324951","name":"5.11.0","archived":false,"released":true,"releaseDate":"2015-02-04"}],"issuelinks":[{"id":"12400276","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12400276","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12751884","key":"AMQ-5418","self":"https://issues.apache.org/jira/rest/api/2/issue/12751884","fields":{"summary":"MQTT Subscriber is able to receive messages published after unsubscribe()","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-11-05T04:44:58.860+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12318701","id":"12318701","name":"MQTT","description":"MQTT Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Test procedure:\n\nCreate a durable subscription to topic \"durableunsubtest\" with clientid \"durableUnsub\".\nPublish a message with client2 to topic \"durableunsubtest\". Make sure \"retain\" flag is not set.\nVerify that the message is received (confirming creation of durable subscription).\nUnsubscribe from topic \"durableunsubtest\" from clientid \"durableUnsub\". Disconnect client.\n\nPublish another message with client2.  Make sure \"retain\" flag is not set.\n\nConnect \"durableUnsub\" and subscribe to the topic again.\n\nVerify that no messages are received.\n\n\nJUnit Test Case code:\n{noformat}\n    /*\n     * Test unsubscribe on a durable subscription topic\n     */\n    @Test(timeout = 60 * 1000)\n    public void testDurableUnsubscribe() throws Exception {\n\n    \t// Create connection1\n        final String clientId = \"durableUnsub\";\n        MQTT mqtt1 = createMQTTConnection(clientId, false);\n        mqtt1.setKeepAlive((short) 60);\n        final BlockingConnection connection1 = mqtt1.blockingConnection();\n        connection1.connect();\n        \n        // create a durable subscription for client \"durableUnsub\"\n        final String TOPICNAME = \"durableunsubtest\";\n        final String payload = \"durable unsub test\";\n        Topic[] topic = { new Topic(TOPICNAME, QoS.AT_LEAST_ONCE) };\n        connection1.subscribe(topic);\n\n        // Create connection2 and publish a message on the topic\n        MQTT mqtt2 = createMQTTConnection(null, true);\n        mqtt2.setKeepAlive((short) 60);\n        final BlockingConnection connection2 = mqtt2.blockingConnection();\n        connection2.connect();\n        connection2.publish(TOPICNAME, payload.getBytes(), QoS.EXACTLY_ONCE, false);\n\n        // Verify that the durable subscription was created by receiving the message\n        // on connection1\n        Message message = connection1.receive(10, TimeUnit.SECONDS);\n        assertNotNull(message);\n        message.ack();\n        assertEquals(\"Unexpected String received\", payload, new String(message.getPayload()));\n\n        // Unsubscribe the topic on connection1\n        connection1.unsubscribe(new String[]{TOPICNAME});\n\n        // Disconnect connection1\n        connection1.disconnect();\n        \n        // Publish another message on connection2 for the same topic\n        MQTT mqtt2a = createMQTTConnection(null, true);\n        mqtt2a.setKeepAlive((short) 60);\n        final BlockingConnection connection2a = mqtt2a.blockingConnection();\n        connection2a.connect();\n        connection2a.publish(TOPICNAME, payload.getBytes(), QoS.EXACTLY_ONCE, false);\n       \n        // Create connection3 with the same clientid \"durableUnsub\"\n        // and subscribe to the topic\n        MQTT mqtt3 = createMQTTConnection(clientId, false);\n        mqtt3.setKeepAlive((short) 60);\n        BlockingConnection connection3 = mqtt3.blockingConnection();\n        connection3.connect();\n        connection3.subscribe(topic);\n        message = connection3.receive(10, TimeUnit.SECONDS);\n\n        // Since we have unsubscribed before the publish, we should not receive\n        // any message (retain flag was also not set during publish)\n        assertNull(message);     \n    }\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"MQTT messages published after unsubscribe on a durable topic are received","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=workanandr","name":"workanandr","key":"workanandr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AR","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=workanandr","name":"workanandr","key":"workanandr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AR","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745540/comment/14193143","id":"14193143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Root cause is related to the fact that the MQTT subscriptions are made with the retroactive flag turned on in order to meet other requirements of the MQTT spec.  You are welcome to dig into the code and see if you can come up with a workaround for this.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-11-01T13:05:50.166+0000","updated":"2014-11-01T13:05:50.166+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745540/comment/14197477","id":"14197477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=workanandr","name":"workanandr","key":"workanandr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AR","active":true,"timeZone":"America/Los_Angeles"},"body":"What requirements in MQTT are you referring to specifically that require retroactive subs? Pubs with retain=1 ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=workanandr","name":"workanandr","key":"workanandr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AR","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T04:44:58.860+0000","updated":"2014-11-05T04:44:58.860+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5382/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i20qg7:"}}