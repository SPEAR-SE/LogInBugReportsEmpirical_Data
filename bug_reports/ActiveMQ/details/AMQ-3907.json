{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12596549","self":"https://issues.apache.org/jira/rest/api/2/issue/12596549","key":"AMQ-3907","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-07-25T22:39:13.857+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Dec 20 21:00:56 UTC 2013","customfield_12310420":"253877","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_46391787731_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-12-20T21:09:12.862+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3907/watchers","watchCount":4,"isWatching":false},"created":"2012-07-01T22:32:45.164+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[{"id":"12355053","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12355053","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12598654","key":"AMQ-3925","self":"https://issues.apache.org/jira/rest/api/2/issue/12598654","fields":{"summary":"Advisory messages/topics not generated for ActiveMQ.Advisory.FULL or ActiveMQ.Advisory.FastProducer.Queue","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-12-20T21:09:12.890+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I am developing a C-based client that uses the RESTful HTTP protocol to POST and GET messages to and from an ActiveMQ broker.  I have seen my test run successfully.  However, if I run it multiple times back to back in succession, it will usually encounter failures.  The test has two steps, where the first POSTs a number of messages on the queue, then the second step GETs them back off.  When it encounters trouble, it is usually in the first step when posting messages.  When that encounters failures, it appears to be having trouble re-connecting, and kicks-out of that first step, proceeding on to the second step where it GETs the messages off of the queue.  When the first step encounters trouble, the second step usually just gets a portion of the messages before getting a 204(No content).  The 204 notifies my test that it is time to terminate.  I have seen the following in some of the server debug logs:\n-------------------------------------\n2012-06-27 07:44:04,007 | DEBUG | Async client internal exception occurred with no exception listener registered: java.lang.IllegalStateException: REDISPATCHING,initial,resumed | org.apache.activemq.ActiveMQConnection | ActiveMQ Session Task-2 \njava.lang.IllegalStateException: REDISPATCHING,initial,resumed \n        at org.eclipse.jetty.server.AsyncContinuation.dispatch(AsyncContinuation.java:403) \n        at org.eclipse.jetty.server.AsyncContinuation.resume(AsyncContinuation.java:810) \n        at org.apache.activemq.web.MessageServlet$Listener.onMessageAvailable(MessageServlet.java:368) \n        at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1320) \n        at org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:131) \n        at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:202) \n        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122) \n        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43) \n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) \n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) \n        at java.lang.Thread.run(Thread.java:619) \n-------------------------------------\n\nI am thinking that the garbage collector is not able to keep-up, and the broker has trouble when running out of memory.\n\nI have also seen messages like this:\n-------------------------------------\n2012-06-27 07:33:01,435 | DEBUG | Main:memory:queue://myqueue:memory: usage change from: 67% of available memory, to: 68% of available memory | org.apache.activemq.usage.Usage | VMTransport: vm://localhost#71 \n-------------------------------------\n\nWhen the second step terminates prematurely due to the 204 status, the rest of the messages are gone.  Maybe my \"consumer.prefetchSize=1\" is ignored, and the consumer on the server-side grabs the rest of the messages.  Any ideas?\n\nAnother thing I notice, is that the HTTP client code I use reports the following for every message it posts: \n\"Web server requires that we close the current connection and obtain a new connection to continue.\"  Is that normal, or can I change some configuration setting to prevent that?\n\nMy test program is a SAS program.  Note: since my client code in question is not yet production, you will not be able to run the test even if you do have a current version of SAS.  Here is my test program:\n-------------------------------------\ndata _null_;\n    file '' device=activemq lrecl=54\n        url='http://d22275:8161/demo/message/myqueue?type=queue&JMSDeliveryMode=NON_PERSISTENT&JMSTimeToLive=100000'\n        ;\n    do i = 1 to 2000;\n        d = datetime();\n        put i z5. +1 'This is a test msg sent at' +1 d datetime21.2;\n    end;\nrun;\n\ndata _null_;\n    infile '' device=activemq lrecl=54 timeout=1000\n        url='http://d22275:8161/demo/message/myqueue?type=queue&consumer.prefetchSize=1'\n        ;\n    input;\nrun;\n-------------------------------------\n\nThat first DATA step POSTs 2000 messages to a queue, and the second DATA step GETs them back off.  If I change the write loop to just POST 2 messages and I turn on some client-side debug/trace logging, you can see what I am sending and receiving across the wire.  Here is an excerpt from the log: \n-------------------------------------\nINFO 1          data _null_;\nINFO 2              file '' device=activemq lrecl=54\nINFO 3                  url='http://d22275:8161/demo/message/myqueue?type=queue&JMSDeliveryMode=NON_PE\nINFO 3        ! RSISTENT&JMSTimeToLive=100000'\nINFO 4                  ;\nINFO 5              do i = 1 to 2;\nINFO 6                  d = datetime();\nINFO 7                  put i z5. +1 'This is a test msg sent at' +1 d datetime21.2;\nINFO 8              end;\nINFO 9          run;\nINFO \nDEBUG Attempting to connect to Web server 10.23.11.16:8161.\nINFO NOTE: The file '' is:\nINFO       \nINFO       URL=http://d22275:8161/demo/message/myqueue?type=queue&JMSDeliveryMode=NON_PERSISTENT&JMSTi\nINFO       meToLive=100000&clientId=839E8906-E338-4FDE-9818-665B14944874,\nINFO       LRECL=54,TIMEOUT=-1\nINFO \nDEBUG Executing POST request.\nDEBUG >>> POST /demo/message/myqueue?type=queue&JMSDeliveryMode=NON_PERSISTENT&JMSTimeToLive=100000&clientId=839E8906-E338-4FDE-9818-665B14944874 HTTP/1.1\nDEBUG >>> Content-Type: APPLICATION/X-WWW-FORM-URLENCODED\nDEBUG Cache file name used is C:\\DOCUME~1\\sav\\LOCALS~1\\Temp\\SAS Temporary Files\\SAS_util000100001004_d22275\\ut1004000002.utl\nDEBUG >>> Content-Length: 59\nDEBUG >>> Host: d22275:8161\nDEBUG >>> User-Agent: SAS/9\nDEBUG >>> \nTRACE >>> 341c000: 62 6f 64 79 3d 30 30 30 30 31 20 54 68 69 73 20 |body=00001 This |\nTRACE >>> 341c010: 69 73 20 61 20 74 65 73 74 20 6d 73 67 20 73 65 |is a test msg se|\nTRACE >>> 341c020: 6e 74 20 61 74 20 30 31 4a 55 4c 32 30 31 32 3a |nt at 01JUL2012:|\nTRACE >>> 341c030: 31 38 3a 32 36 3a 34 33 2e 36 39                |18:26:43.69     |\nDEBUG <<< HTTP/1.1 200 OK\nDEBUG <<< Set-Cookie: JSESSIONID=1f4dfw7mbb4611ilhiznnkifi3;Path=/demo\nDEBUG <<< Expires: Thu, 01 Jan 1970 00:00:00 GMT\nDEBUG <<< messageID: ID:d22275-1028-1341175648962-3:24:1:1:1\nDEBUG <<< Content-Length: 0\nDEBUG <<< Server: Jetty(7.6.1.v20120215)\nDEBUG <<< \nDEBUG Request POST returns status 200.\nDEBUG Executing POST request.\nDEBUG Web server requires that we close the current connection and obtain a new connection to continue.\nDEBUG Attempting to connect to Web server 10.23.11.16:8161.\nDEBUG >>> POST /demo/message/myqueue?type=queue&JMSDeliveryMode=NON_PERSISTENT&JMSTimeToLive=100000&clientId=839E8906-E338-4FDE-9818-665B14944874 HTTP/1.1\nDEBUG >>> Content-Type: APPLICATION/X-WWW-FORM-URLENCODED\nDEBUG Cache file name used is C:\\DOCUME~1\\sav\\LOCALS~1\\Temp\\SAS Temporary Files\\SAS_util000100001004_d22275\\ut1004000003.utl\nDEBUG >>> Content-Length: 59\nDEBUG >>> Host: d22275:8161\nDEBUG >>> Cookie: $Version=1;JSESSIONID=1f4dfw7mbb4611ilhiznnkifi3;$Path=/demo\nDEBUG >>> User-Agent: SAS/9\nDEBUG >>> \nTRACE >>> 3422000: 62 6f 64 79 3d 30 30 30 30 32 20 54 68 69 73 20 |body=00002 This |\nTRACE >>> 3422010: 69 73 20 61 20 74 65 73 74 20 6d 73 67 20 73 65 |is a test msg se|\nTRACE >>> 3422020: 6e 74 20 61 74 20 30 31 4a 55 4c 32 30 31 32 3a |nt at 01JUL2012:|\nTRACE >>> 3422030: 31 38 3a 32 36 3a 34 33 2e 37 30                |18:26:43.70     |\nDEBUG <<< HTTP/1.1 200 OK\nDEBUG <<< messageID: ID:d22275-1028-1341175648962-3:24:1:1:2\nDEBUG <<< Content-Length: 0\nDEBUG <<< Server: Jetty(7.6.1.v20120215)\nDEBUG <<< \nDEBUG Request POST returns status 200.\nDEBUG Attempting to connect to Web server 10.23.11.16:8161.\nDEBUG Executing POST request.\nDEBUG >>> POST /demo/message/myqueue?type=queue&JMSDeliveryMode=NON_PERSISTENT&JMSTimeToLive=100000&clientId=839E8906-E338-4FDE-9818-665B14944874&action=unsubscribe HTTP/1.1\nDEBUG >>> Content-Type: application/x-www-form-urlencoded\nDEBUG Cache file name used is C:\\DOCUME~1\\sav\\LOCALS~1\\Temp\\SAS Temporary Files\\SAS_util000100001004_d22275\\ut1004000004.utl\nDEBUG >>> Content-Length: 0\nDEBUG >>> Host: d22275:8161\nDEBUG >>> Cookie: $Version=1;JSESSIONID=1f4dfw7mbb4611ilhiznnkifi3;$Path=/demo\nDEBUG >>> User-Agent: SAS/9\nDEBUG >>> \nDEBUG <<< HTTP/1.1 200 OK\nDEBUG <<< Content-Length: 0\nDEBUG <<< Server: Jetty(7.6.1.v20120215)\nDEBUG <<< \nDEBUG Request POST returns status 200.\nDEBUG Destroying connection to Web server d22275:8161.\nINFO NOTE: 2 records were written to the file ''.\nINFO       The minimum record length was 54.\nINFO       The maximum record length was 54.\nDEBUG Destroying connection to Web server d22275:8161.\nINFO NOTE: DATA statement used (Total process time):\nINFO       real time           0.17 seconds\nINFO       cpu time            0.00 seconds\nINFO       \nINFO \nINFO 10         \nINFO 11         data _null_;\nINFO 12             infile '' device=activemq lrecl=54 timeout=1000\nINFO 13                 url='http://d22275:8161/demo/message/myqueue?type=queue&consumer.prefetchSize=\nINFO 13       ! 1'\nINFO 14                 ;\nINFO 15             input;\nINFO 16         run;\nINFO \nDEBUG Attempting to connect to Web server 10.23.11.16:8161.\nINFO NOTE: The infile '' is:\nINFO       \nINFO       URL=http://d22275:8161/demo/message/myqueue?type=queue&consumer.prefetchSize=1&clientId=7BA\nINFO       B771E-AF44-4597-B603-FC018C1069B3&READTIMEOUT=1000,\nINFO 2                                        The SAS System                18:26 Sunday, July 1, 2012\nINFO \nINFO       LRECL=54,TIMEOUT=1000\nINFO \nDEBUG Executing GET request.\nDEBUG >>> GET /demo/message/myqueue?type=queue&consumer.prefetchSize=1&clientId=7BAB771E-AF44-4597-B603-FC018C1069B3&READTIMEOUT=1000 HTTP/1.1\nDEBUG >>> Host: d22275:8161\nDEBUG >>> Accept: */*\nDEBUG >>> Accept-Charset: iso-8859-1,*,utf-8\nDEBUG >>> Accept-Encoding: identity\nDEBUG >>> Accept-Language: en\nDEBUG >>> User-Agent: SAS/9\nDEBUG >>> \nDEBUG <<< HTTP/1.1 200 OK\nDEBUG <<< Set-Cookie: JSESSIONID=171xnui5b43xz1wpgghnpgtiws;Path=/demo\nDEBUG <<< Expires: Thu, 01 Jan 1970 00:00:00 GMT\nDEBUG <<< Content-Type: text/xml;charset=UTF-8\nDEBUG <<< destination: queue://myqueue\nDEBUG <<< id: ID:d22275-1028-1341175648962-3:24:1:1:1\nDEBUG <<< Content-Length: 54\nDEBUG <<< Server: Jetty(7.6.1.v20120215)\nDEBUG <<< \nTRACE <<< 415a740: 30 30 30 30 31 20 54 68 69 73 20 69 73 20 61 20 |00001 This is a |\nTRACE <<< 415a750: 74 65 73 74 20 6d 73 67 20 73 65 6e 74 20 61 74 |test msg sent at|\nTRACE <<< 415a760: 20 30 31 4a 55 4c 32 30 31 32 3a 31 38 3a 32 36 | 01JUL2012:18:26|\nTRACE <<< 415a770: 3a 34 33 2e 36 39                               |:43.69          |\nDEBUG Request GET returns status 200.\nDEBUG Executing GET request.\nDEBUG >>> GET /demo/message/myqueue?type=queue&consumer.prefetchSize=1&clientId=7BAB771E-AF44-4597-B603-FC018C1069B3&READTIMEOUT=1000 HTTP/1.1\nDEBUG >>> Host: d22275:8161\nDEBUG >>> Accept: */*\nDEBUG >>> Accept-Charset: iso-8859-1,*,utf-8\nDEBUG >>> Accept-Encoding: identity\nDEBUG >>> Accept-Language: en\nDEBUG >>> Cookie: $Version=1;JSESSIONID=171xnui5b43xz1wpgghnpgtiws;$Path=/demo\nDEBUG >>> User-Agent: SAS/9\nDEBUG >>> \nDEBUG <<< HTTP/1.1 200 OK\nDEBUG <<< Content-Type: text/xml;charset=UTF-8\nDEBUG <<< destination: queue://myqueue\nDEBUG <<< id: ID:d22275-1028-1341175648962-3:24:1:1:2\nDEBUG <<< Content-Length: 54\nDEBUG <<< Server: Jetty(7.6.1.v20120215)\nDEBUG <<< \nTRACE <<< 415a740: 30 30 30 30 32 20 54 68 69 73 20 69 73 20 61 20 |00002 This is a |\nTRACE <<< 415a750: 74 65 73 74 20 6d 73 67 20 73 65 6e 74 20 61 74 |test msg sent at|\nTRACE <<< 415a760: 20 30 31 4a 55 4c 32 30 31 32 3a 31 38 3a 32 36 | 01JUL2012:18:26|\nTRACE <<< 415a770: 3a 34 33 2e 37 30                               |:43.70          |\nDEBUG Request GET returns status 200.\nDEBUG Executing GET request.\nDEBUG >>> GET /demo/message/myqueue?type=queue&consumer.prefetchSize=1&clientId=7BAB771E-AF44-4597-B603-FC018C1069B3&READTIMEOUT=1000 HTTP/1.1\nDEBUG >>> Host: d22275:8161\nDEBUG >>> Accept: */*\nDEBUG >>> Accept-Charset: iso-8859-1,*,utf-8\nDEBUG >>> Accept-Encoding: identity\nDEBUG >>> Accept-Language: en\nDEBUG >>> Cookie: $Version=1;JSESSIONID=171xnui5b43xz1wpgghnpgtiws;$Path=/demo\nDEBUG >>> User-Agent: SAS/9\nDEBUG >>> \nDEBUG <<< HTTP/1.1 204 No Content\nDEBUG <<< Content-Type: text/xml;charset=UTF-8\nDEBUG <<< Server: Jetty(7.6.1.v20120215)\nDEBUG <<< \nDEBUG Request GET returns status 204.\nDEBUG Attempting to connect to Web server 10.23.11.16:8161.\nDEBUG Executing POST request.\nDEBUG >>> POST /demo/message/myqueue?type=queue&consumer.prefetchSize=1&clientId=7BAB771E-AF44-4597-B603-FC018C1069B3&READTIMEOUT=1000&action=unsubscribe HTTP/1.1\nDEBUG >>> Content-Type: application/x-www-form-urlencoded\nDEBUG Cache file name used is C:\\DOCUME~1\\sav\\LOCALS~1\\Temp\\SAS Temporary Files\\SAS_util000100001004_d22275\\ut1004000005.utl\nDEBUG >>> Content-Length: 0\nDEBUG >>> Host: d22275:8161\nDEBUG >>> Cookie: $Version=1;JSESSIONID=171xnui5b43xz1wpgghnpgtiws;$Path=/demo\nDEBUG >>> User-Agent: SAS/9\nDEBUG >>> \nDEBUG <<< HTTP/1.1 200 OK\nDEBUG <<< Content-Length: 0\nDEBUG <<< Server: Jetty(7.6.1.v20120215)\nDEBUG <<< \nDEBUG Request POST returns status 200.\nDEBUG Destroying connection to Web server d22275:8161.\nINFO NOTE: 2 records were read from the infile ''.\nINFO       The minimum record length was 54.\nINFO       The maximum record length was 54.\nDEBUG Destroying connection to Web server d22275:8161.\n-------------------------------------\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81411","customfield_12312823":null,"summary":"Restful HTTP MessageServlet causing trouble.  May be a garbage collection issue.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"32-bit Windows","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13407446","id":"13407446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"body":"In my originating comment, I mention four things:\n\n   1) Failure during a series of POSTs to the server over HTTP.\n\n   2) When GETing messages off the queue just after the POST failure mentioned in item (1), my series of GETs ends prematurely due to an unexpected 204 - no content response.\n\n   3) When my loop of GETs ends prematurely due to 204, the remaining messages still get consumed on the server side even though I specify the \"&consumer.prefetchSize=1\" parameter.\n\n   4) My HTTP client code reports \"Web server requires that we close the current connection...\"\n\nI found the answer to item (4).  I learned that can be caused by the server sending a \"connection: close\" header.  However, that is not happening in my test case.  Instead, the http client code I am using is explicitly closing the socket and re-connecting between posts.  The person who wrote that http client code sits across the hall from me; so I will discuss item (4) with him.\n\n     ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-05T20:13:50.382+0000","updated":"2012-07-05T20:13:50.382+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13407468","id":"13407468","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"body":"I changed my HTTP client code to refrain from closing the socket and re-connecting between posts and it performs better, but I still encounter the failure.  Also, in an attempt to avoid the premature 204, I increased the readTimeout to 6000000.  Here is a recent excerpt from the broker log.\n--------------------------------\n2012-07-05 16:32:14,002 | DEBUG | myqueue toPageIn: 200, Inflight: 636, pagedInMessages.size 646, enqueueCount: 39015, dequeueCount: 37794 | org.apache.activemq.broker.region.Queue | BrokerService[localhost] Task-29\n2012-07-05 16:32:14,018 | DEBUG | Async client internal exception occurred with no exception listener registered: java.lang.IllegalStateException: REDISPATCHING,initial,resumed | org.apache.activemq.ActiveMQConnection | ActiveMQ Session Task-3\njava.lang.IllegalStateException: REDISPATCHING,initial,resumed\n\tat org.eclipse.jetty.server.AsyncContinuation.dispatch(AsyncContinuation.java:403)\n\tat org.eclipse.jetty.server.AsyncContinuation.resume(AsyncContinuation.java:810)\n\tat org.apache.activemq.web.MessageServlet$Listener.onMessageAvailable(MessageServlet.java:368)\n\tat org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1320)\n\tat org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:131)\n\tat org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:202)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\n2012-07-05 16:32:14,018 | DEBUG | Received 0 message(s) | org.apache.activemq.web.MessageServlet | qtp1690651-31 - /demo/message/myqueue?type=queue&clientId=81D46EA5-6113-488E-9E8B-089A8C1C2CF0&readTimeout=6000000\n2012-07-05 16:32:14,002 | DEBUG | default:memory:queue://myqueue:memory: usage change from: 69% of available memory, to: 68% of available memory | org.apache.activemq.usage.Usage | ActiveMQ Task-18\n2012-07-05 16:32:14,018 | DEBUG | Async client internal exception occurred with no exception listener registered: java.lang.IllegalStateException: REDISPATCHING,initial,resumed | org.apache.activemq.ActiveMQConnection | ActiveMQ Session Task-3\njava.lang.IllegalStateException: REDISPATCHING,initial,resumed\n\tat org.eclipse.jetty.server.AsyncContinuation.dispatch(AsyncContinuation.java:403)\n\tat org.eclipse.jetty.server.AsyncContinuation.resume(AsyncContinuation.java:810)\n\tat org.apache.activemq.web.MessageServlet$Listener.onMessageAvailable(MessageServlet.java:368)\n\tat org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1320)\n\tat org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:131)\n\tat org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:202)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\n--------------------------------\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-05T20:39:59.291+0000","updated":"2012-07-05T20:39:59.291+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13409647","id":"13409647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"body":"Regarding item number (2), the premature 204 status can occur even when the first part(POSTing 6000 messages) succeeds.  I see the trouble encountered when POSTing messages, and the premature 204 as two separate issues.  I would not be surprised if they are both due to the same root problem; which is why I mention them both in this one jira(AMQ-3907).  If you want me to enter a separate jira for the GET--204 issue, let me know.  \n\nIs there anything you need from me? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-09T17:10:25.645+0000","updated":"2012-07-09T17:10:25.645+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13422689","id":"13422689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"body":"   Just noticed that this jira was dup'd to AMQ3925, so I downloaded the 5.7 snapshot and it does appear to solve item (1), where I was encountering trouble when attempt to write a bunch of messages via http.  Thank you, I sincerely appreciate it.\n\n   I am able still able to reproduce items (2) and (3), where my read loop kicks-out and the consumer gobbles up some messages.  I am able to produced it with a freshly started broker.  However, even though the first test attempt encounters the problem, subsequent attempts seem to run fine.  On the first attempt(run of my test against a just-started broker), I notice the following info message reported by the broker:\n\n  INFO | PListStore:[C:\\amq\\apache-activemq-5.7-SNAPSHOT\\bin\\..\\data\\localhost\\tmp_storage ] initialized\n\nI think that has something to do with it.  If my test pgm only puts 300 messages(54 bytes of text in the body), then that storage is not needed, and my read loop does *not* kick-out prematurely.  However, if I put 3000 messages, then I encounter the above \"tmp_storage\" log msg, and my read loop kicks-out early.  Even though the URL is specify includes \"&consumer.prefetchSize=1\", I can lose a large number of messages when my read loop kicks-out.\n\nWould you like me to open a new jira for items (2) and (3)?  Thanks in advance.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-25T22:30:16.511+0000","updated":"2012-07-25T22:30:16.511+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13422696","id":"13422696","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Best thing you can do to help is to create JUnit test cases that can reproduce the issues you are seeing, that way someone can look into them when they have the time. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-07-25T22:39:13.857+0000","updated":"2012-07-25T22:39:13.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13422703","id":"13422703","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"body":"I am primarily a C programmer, and just an novice-intermediate Java programmer.  I can try to develop a jUnit test, but it will take some time.  Mainly because I am behind on another project and will not be able to work on a junit test for a while.  If someone could point me to an example/sample junit test that uses the RESTful HTTP protocol when communicating with the broker, that will help me get a leg-up.\n\nMy test program, written in SAS, just POSTs a bunch of messages using HTTP, then GETs them.  When I attempt to write a junit test, I will be doing the same -- post then get a bunch of messages over HTTP.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-25T22:49:26.381+0000","updated":"2012-07-25T22:49:26.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13424589","id":"13424589","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"body":"Well, I may have spoke too soon.  Even with a snapshot of 5.7.0, I sometimes still see:\n\n\n2012-07-29 13:11:27,303 | DEBUG | scope null||/demo/message/myqueue @ o.e.j.w.WebAppContext{/demo,file:/C:/amq/apache-activemq-5.7-SNAPSHOT/webapps/demo/} | org.eclipse.jetty.server.handler.ContextHandler | qtp10344162-27 - /demo/message/myqueue?type=queue&consumer.prefetchSize=1&clientId=DBF16CAB-FBB1-4B20-A3A0-323B17F4302E&readTimeout=60000\n2012-07-29 13:11:27,319 | DEBUG | context=/demo||/message/myqueue @ o.e.j.w.WebAppContext{/demo,file:/C:/amq/apache-activemq-5.7-SNAPSHOT/webapps/demo/} | org.eclipse.jetty.server.handler.ContextHandler | qtp10344162-27 - /demo/message/myqueue?type=queue&consumer.prefetchSize=1&clientId=DBF16CAB-FBB1-4B20-A3A0-323B17F4302E&readTimeout=60000\n2012-07-29 13:11:27,319 | DEBUG | Async client internal exception occurred with no exception listener registered: java.lang.IllegalStateException: DISPATCHED,initial | org.apache.activemq.ActiveMQConnection | ActiveMQ Session Task-2\njava.lang.IllegalStateException: DISPATCHED,initial\n\tat org.eclipse.jetty.server.AsyncContinuation.dispatch(AsyncContinuation.java:403)\n\tat org.eclipse.jetty.server.AsyncContinuation.resume(AsyncContinuation.java:810)\n\tat org.apache.activemq.web.MessageServlet$Listener.onMessageAvailable(MessageServlet.java:376)\n\tat org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1324)\n\tat org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:131)\n\tat org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:202)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\n2012-07-29 13:11:27,319 | DEBUG | Got Session ID ja7jreqwys5t1sfeqdgq872e0 from cookie | org.eclipse.jetty.server.session | qtp10344162-27 - /demo/message/myqueue?type=queue&consumer.prefetchSize=1&clientId=DBF16CAB-FBB1-4B20-A3A0-323B17F4302E&readTimeout=60000\n2012-07-29 13:11:27,319 | DEBUG | Async client internal exception occurred with no exception listener registered: java.lang.IllegalStateException: DISPATCHED,initial | org.apache.activemq.ActiveMQConnection | ActiveMQ Session Task-2\njava.lang.IllegalStateException: DISPATCHED,initial\n\tat org.eclipse.jetty.server.AsyncContinuation.dispatch(AsyncContinuation.java:403)\n\tat org.eclipse.jetty.server.AsyncContinuation.resume(AsyncContinuation.java:810)\n\tat org.apache.activemq.web.MessageServlet$Listener.onMessageAvailable(MessageServlet.java:376)\n\tat org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1324)\n\tat org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:131)\n\tat org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:202)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\n...\n...snip...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-29T17:18:05.547+0000","updated":"2012-07-29T17:18:05.547+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13424626","id":"13424626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"body":"I seem to be able to avoid problems if I prevent the Non-Persistent Pending Cursor from filling up.  I think I have been able to accomplish that in a number of ways:  1) Turning off Flow Control, 2) Increasing my prefetch size, and 3) Using a pending queue VMQueueCursor.  In all three of those uses cases, I do not see it initializing temporary disk storage, so I assume those configurations prevent the Non-Persistent Pending Cursor from exhausting its RAM when running my test case.  Remember my test case is put 10000 non-persistent messages and then get them back off.  I assume that test case constitutes a slow-consumer scenario.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-29T20:50:36.895+0000","updated":"2012-07-29T20:50:36.895+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13831350","id":"13831350","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gzres","name":"gzres","key":"gzres","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gzres&avatarId=16612","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gzres&avatarId=16612","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gzres&avatarId=16612","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gzres&avatarId=16612"},"displayName":"Grzegorz Grzybek","active":true,"timeZone":"Europe/Berlin"},"body":"I've recreated your scenario and received the same problems - 2000 POSTS works fine, then single GET dequeues all 2000 messages and then everything breaks.\n\nThe problem is resolved in 5.9.0.\nSee commit https://github.com/apache/activemq/commit/de49f2e8 and AMQ-4629.\n\nregards\nGrzegorz Grzybek","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gzres","name":"gzres","key":"gzres","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gzres&avatarId=16612","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gzres&avatarId=16612","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gzres&avatarId=16612","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gzres&avatarId=16612"},"displayName":"Grzegorz Grzybek","active":true,"timeZone":"Europe/Berlin"},"created":"2013-11-25T10:48:58.034+0000","updated":"2013-11-25T10:50:31.697+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12596549/comment/13854557","id":"13854557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"body":"Thanks!  It does appear to be fixed in 5.9.0.  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve.v","name":"steve.v","key":"steve.v","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Vincent","active":true,"timeZone":"Etc/UTC"},"created":"2013-12-20T21:00:56.337+0000","updated":"2013-12-20T21:00:56.337+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3907/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ea6f:"}}