{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12613572","self":"https://issues.apache.org/jira/rest/api/2/issue/12613572","key":"AMQ-4136","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2012-12-07T14:58:16.965+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Dec 07 19:26:01 UTC 2012","customfield_12310420":"251128","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_28329362641_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-09-18T18:50:53.134+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4136/watchers","watchCount":5,"isWatching":false},"created":"2012-10-25T21:34:50.525+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-09-18T18:50:53.163+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Expected: throttled messages when tempStorage reaches 100%\nActual: broker hangs and no longer delivers messages and cannot be cleanly shutdown\n\nConfiguration:\n- /conf/activemq.xml (attached) configuration: memoryUsage: 200MB, storeUsage: 1GB, tempUsage: 400MB\n- test configuration (/example/build.xml): max (# of messages): 65000, messageSize: 10000 -> total message size: 65000 * 10000 bytes = 650 MB\n\nResult: \n- burst of 65000 messages to queue, initially loads into memory but quickly gets dumped to tempStorage (12% memoryUsage)\n- messages persisted in database\n- producer throttling does NOT occur, potentially b/c memoryUsage is at 0% in this peak/burst scenario when activmq stops responding\n- activemq process hangs at 104% tempUsage, 0% memoryUsage, and can't be shutdown without force kill\n\ncommands from standard release examples:\nStart amq:\n/bin$ ./activemq console\n\nstart producer:\nant producer -Ddurable=true -DsleepTime=0\n\n(Bug experienced with higher sleep times also.)\n\nif you want to use consumers:\nant consumer -Durl=tcp://localhost:61616?jms.prefetchPolicy.queuePrefetch=1\n\n- watch memory and disk usage in jconsole\nhttp://tmielke.blogspot.com/2011/02/observations-on-activemqs-temp-storage.html\n\n\nworkarounds:\n\n1) no tempUsage storage at all\n\\conf\\activemq.xml -> <tempUsage limit=\"0 mb\"/>\n\n2) try to hide tempUsage\n\\conf\\activemq.xml -> <tempUsage limit=\"4 gb\"/> -> 4 gb being much, much larger than uninterrupted usage will fill","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12550879","id":"12550879","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.israel%40zuora.com","name":"david.israel@zuora.com","key":"david.israel@zuora.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Israel","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-25T22:02:30.531+0000","size":7303,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12550879/activemq.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"62910","customfield_12312823":null,"summary":"Broker freezes on peak burst producer persistent message delivery","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.israel%40zuora.com","name":"david.israel@zuora.com","key":"david.israel@zuora.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Israel","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.israel%40zuora.com","name":"david.israel@zuora.com","key":"david.israel@zuora.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Israel","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Java 1.6.0_35\nMac OSX 10.7.5","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613572/comment/13484532","id":"13484532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.israel%40zuora.com","name":"david.israel@zuora.com","key":"david.israel@zuora.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Israel","active":true,"timeZone":"Etc/UTC"},"body":"Similar behavior to the already fixed AMQ-2475","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.israel%40zuora.com","name":"david.israel@zuora.com","key":"david.israel@zuora.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Israel","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-25T22:06:40.724+0000","updated":"2012-10-25T22:06:40.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613572/comment/13484668","id":"13484668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.israel%40zuora.com","name":"david.israel@zuora.com","key":"david.israel@zuora.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Israel","active":true,"timeZone":"Etc/UTC"},"body":"Looks like ActiveMQ has had some variant of this problem since 5.4.2\n\nhttp://activemq.2283324.n4.nabble.com/Senders-blocked-when-temp-store-100-and-memory-leak-in-temp-store-td3467749.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.israel%40zuora.com","name":"david.israel@zuora.com","key":"david.israel@zuora.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Israel","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-26T03:24:45.681+0000","updated":"2012-10-26T03:24:45.681+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613572/comment/13484670","id":"13484670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.israel%40zuora.com","name":"david.israel@zuora.com","key":"david.israel@zuora.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Israel","active":true,"timeZone":"Etc/UTC"},"body":"there are temp files in conjunction w/persisted messages that\nare only enqueued w/ tempUsage=0\n\nIf I clear the db the tmp files remain until I restart amq (cleans\nthem up on startup)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.israel%40zuora.com","name":"david.israel@zuora.com","key":"david.israel@zuora.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Israel","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-26T03:27:35.185+0000","updated":"2012-10-26T03:27:35.185+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613572/comment/13526429","id":"13526429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I've tried reproducing this on v5.8-SNAPSHOT without success.  Would be nice if you can test on a newer version and also a JUnit test would help in testing. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-12-07T14:58:16.965+0000","updated":"2012-12-07T14:58:16.965+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613572/comment/13526669","id":"13526669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel_","name":"joel_","key":"joel_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Fischer","active":true,"timeZone":"Etc/UTC"},"body":"Timothy: for this issue enable fileQueueCursor to trigger temp storage.\n\nconf/activemq.xml:\n<destinationPolicy>\n...\n    <policyEntry queue=\">\" producerFlowControl=\"true\" memoryLimit=\"100mb\">\n    ...\n      <pendingQueuePolicy>\n        <fileQueueCursor/>\n      </pendingQueuePolicy>\n\nWe stopped seeing this issue occur after completely disabling pendingQueuePolicy.\n\nI noticed that while the broker is frozen/hanging that producers and consumers can still connect to it but cannot queue/dequeue to/from it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel_","name":"joel_","key":"joel_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Fischer","active":true,"timeZone":"Etc/UTC"},"created":"2012-12-07T19:17:01.096+0000","updated":"2012-12-07T19:17:01.096+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613572/comment/13526681","id":"13526681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Would be great if you could create a unit test to demonstrate what you are seeing, won't have time myself to try to reproduce this for a bit. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-12-07T19:26:01.884+0000","updated":"2012-12-07T19:26:01.884+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4136/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0b4xb:"}}