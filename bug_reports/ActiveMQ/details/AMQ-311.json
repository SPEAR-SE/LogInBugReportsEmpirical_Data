{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481376","self":"https://issues.apache.org/jira/rest/api/2/issue/12481376","key":"AMQ-311","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2005-07-19T11:06:33.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 19 13:31:53 UTC 2005","customfield_12310420":"84259","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_879000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_1050000_*|*_4_*:*_1_*:*_7670000","customfield_12312321":null,"resolutiondate":"2005-07-19T13:31:53.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-311/watchers","watchCount":0,"isWatching":false},"created":"2005-07-19T10:51:54.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315600","id":"12315600","name":"3.0","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2005-07-19T13:31:53.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The same code works without a problem when using all Windows 2003 servers.  However, when the same producer is run on Fedora, no JMS messages are passed to the consumer.   Here are the error messages on Linux producer server (no messages in the Windows consumer logs):\n\nJul 19, 2005 7:41:34 AM org.activemq.broker.impl.BrokerContainerImpl stop\nINFO: ActiveMQ Message Broker (ID:os4.gatherplace.com-32773-1121729492019-0:0) is shutting down\nJul 19, 2005 7:41:34 AM org.activemq.broker.impl.BrokerContainerImpl deregisterConnection\nINFO: Removing client: gwjmsproducer on transport: TcpTransportChannel: Socket[addr=/127.0.0.1,port=60733,localport=61616]\nJul 19, 2005 7:41:35 AM org.activemq.transport.tcp.TcpTransportChannel doClose\nWARNING: Peer closed connection\njava.io.EOFException\n        at java.io.DataInputStream.readByte(DataInputStream.java:243)\n        at org.activemq.io.impl.AbstractDefaultWireFormat.readPacket(AbstractDefaultWireFormat.java:169)\n        at org.activemq.transport.tcp.TcpTransportChannel.run(TcpTransportChannel.java:308)\n        at java.lang.Thread.run(Thread.java:595)\nJul 19, 2005 7:41:35 AM org.activemq.ActiveMQConnection statusChanged\nINFO: channel status changed: Channel: TcpTransportChannel: Socket[addr=localhost/127.0.0.1,port=61616,localport=60733] has disconnected\nJul 19, 2005 7:41:35 AM org.activemq.broker.impl.BrokerConnectorImpl stop\nINFO: ActiveMQ connector stopped: TcpTransportServerChannel@tcp://os4.gatherplace.com:61616\nJul 19, 2005 7:41:35 AM com.gatherworks.server.Server removeSession\nINFO: Removing session {00000000-0000-0000-0000-000000000001}\nJul 19, 2005 7:41:35 AM org.activemq.transport.TransportChannelSupport onAsyncException\nWARNING: Caught exception dispatching message and no ExceptionListener registered: javax.jms.JMSException: asyncSend failed: java.io.EOFException: Cannot write to the stream any \nmore it has already been closed\njavax.jms.JMSException: asyncSend failed: java.io.EOFException: Cannot write to the stream any more it has already been closed\n        at org.activemq.util.JMSExceptionHelper.newJMSException(JMSExceptionHelper.java:49)\n        at org.activemq.transport.tcp.TcpTransportChannel.doAsyncSend(TcpTransportChannel.java:473)\n        at org.activemq.transport.tcp.TcpTransportChannel.asyncSend(TcpTransportChannel.java:285)\n        at org.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:956)\n        at org.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:935)\n        at org.activemq.ActiveMQSession.send(ActiveMQSession.java:1458)\n        at org.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:426)\n        at org.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:337)\n        at com.gatherworks.server.billing.Jms.sendMessage(Jms.java:156)\n        at com.gatherworks.server.billing.Collector.processOnEvent(Collector.java:193)\n        at com.gatherworks.server.billing.ConsumerThread.run(ConsumerThread.java:14)\nCaused by: java.io.EOFException: Cannot write to the stream any more it has already been closed\n        at org.activemq.transport.tcp.TcpBufferedOutputStream.checkClosed(TcpBufferedOutputStream.java:132)\n        at org.activemq.transport.tcp.TcpBufferedOutputStream.write(TcpBufferedOutputStream.java:70)\n        at java.io.DataOutputStream.writeByte(DataOutputStream.java:136)\n        at org.activemq.io.impl.DefaultWireFormat.writePacket(DefaultWireFormat.java:108)\n        at org.activemq.transport.tcp.TcpTransportChannel.doAsyncSend(TcpTransportChannel.java:464)\n        ... 9 more\njavax.jms.JMSException: asyncSend failed: java.io.EOFException: Cannot write to the stream any more it has already been closed\n        at org.activemq.util.JMSExceptionHelper.newJMSException(JMSExceptionHelper.java:49)\n        at org.activemq.transport.tcp.TcpTransportChannel.doAsyncSend(TcpTransportChannel.java:473)\n        at org.activemq.transport.tcp.TcpTransportChannel.asyncSend(TcpTransportChannel.java:285)\n        at org.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:956)\n        at org.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:935)\n        at org.activemq.ActiveMQSession.send(ActiveMQSession.java:1458)\n        at org.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:426)\n        at org.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:337)\n        at com.gatherworks.server.billing.Jms.sendMessage(Jms.java:156)\n        at com.gatherworks.server.billing.Collector.processOnEvent(Collector.java:193)\n        at com.gatherworks.server.billing.ConsumerThread.run(ConsumerThread.java:14)\nCaused by: java.io.EOFException: Cannot write to the stream any more it has already been closed\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172166","customfield_12312823":null,"summary":"Linux broker has problem with Windows client","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frik","name":"frik","key":"frik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frik Strecker","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frik","name":"frik","key":"frik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frik Strecker","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Producer is on Fedora 3 and consumer on Windows 2003 - JMS setup is using J2EE from SUN","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481376/comment/12937261","id":"12937261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"Hi Frik\n\nI don't think this is actually a problem with ActiveMQ -its more an effect of a different threading/scheduler implementation on Linux versus Windows. i.e. you have a thread which is attempting to send a message on a connection that another thread has closed. It doesn't look like any kind of bug in ActiveMQ - if its really an issue we can reopen this  - but its looking like a multi-threaded programming bug in the application code I think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2005-07-19T11:06:33.000+0000","updated":"2005-07-19T11:06:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481376/comment/12937313","id":"12937313","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frik","name":"frik","key":"frik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frik Strecker","active":true,"timeZone":"Etc/UTC"},"body":"\nThe problem is that I am not closing the connection.  This is the problem:\n\n> INFO: ActiveMQ Message Broker (ID:os4.gatherplace.com-32773-1121729492019-0:0) is shutting down\n> Jul 19, 2005 7:41:34 AM org.activemq.broker.impl.BrokerContainerImpl deregisterConnection\n> INFO: Removing client: gwjmsproducer on transport: TcpTransportChannel: Socket[addr=/127.0.0.1,port=60733,localport=61616]\n> Jul 19, 2005 7:41:35 AM org.activemq.transport.tcp.TcpTransportChannel doClose\n\nBecause ActiveMQ decides to shut down the broker for some unknown reason, all subsequent sends fail.\n\nFrom the time stamps this connection is not closed until the first message is ready to be sent.  So this connection has been open for a few minutes without a problem.  Then mysteriously just before the first message is to be sent, ActiveMQ decides it is time to shut down the broker and close the connnection.\n\nI am not saying that there is not a bug in my code :) but I am not closing the JMS connections - they are opened and kept open.  The code is also pretty simple and works fine on Windows.\n\nIt is interesting that the logs shows an IP address of 127.0.0.1 for the connection to be closed.  Could that be a problem?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frik","name":"frik","key":"frik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frik Strecker","active":true,"timeZone":"Etc/UTC"},"created":"2005-07-19T11:24:03.000+0000","updated":"2005-07-19T11:24:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481376/comment/12936245","id":"12936245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frik","name":"frik","key":"frik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frik Strecker","active":true,"timeZone":"Etc/UTC"},"body":"caused by reconnect workaround bug.  Use this instead:\nreliable:tcp://host:port\n\nsee http://activemq.org/Configuring+Transports","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frik","name":"frik","key":"frik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frik Strecker","active":true,"timeZone":"Etc/UTC"},"created":"2005-07-19T13:31:53.000+0000","updated":"2005-07-19T13:31:53.000+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-311/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ttzb:"}}