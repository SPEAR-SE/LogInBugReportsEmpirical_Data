{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481745","self":"https://issues.apache.org/jira/rest/api/2/issue/12481745","key":"AMQ-696","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315610","id":"12315610","name":"4.0","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-05-01T16:32:22.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Jun 18 03:14:57 UTC 2006","customfield_12310420":"84297","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_275496000_*|*_5_*:*_2_*:*_11433000_*|*_4_*:*_1_*:*_85612000","customfield_12312321":null,"resolutiondate":"2006-05-02T19:29:47.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-696/watchers","watchCount":1,"isWatching":false},"created":"2006-04-28T12:00:46.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315608","id":"12315608","description":"","name":"4.0 RC2","archived":false,"released":true,"releaseDate":"2006-04-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315609","id":"12315609","description":"","name":"4.0 RC3","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-06-18T03:14:57.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"While using the new Spring-2.0 DefaultMessageListenerContainer I can reliably reproduce the following exception on the broker side which usually results in a hang on the client side:\n \nThe broker logs the following exception:\n \nINFO  Service                        - Sync error occurred: javax.jms.InvalidClientIDException: Broker: localhost - Client: ID:inspiron-1410-114619274\n7453-2:1 already connected\njavax.jms.InvalidClientIDException: Broker: localhost - Client: ID:inspiron-1410-1146192747453-2:1 already connected\n        at org.apache.activemq.broker.region.RegionBroker.addConnection(RegionBroker.java:154)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:65)\n        at org.apache.activemq.advisory.AdvisoryBroker.addConnection(AdvisoryBroker.java:69)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:65)\n        at org.apache.activemq.broker.MutableBrokerFilter.addConnection(MutableBrokerFilter.java:77)\n        at org.apache.activemq.broker.AbstractConnection.processAddConnection(AbstractConnection.java:500)\n        at org.apache.activemq.broker.jmx.ManagedTransportConnection.processAddConnection(ManagedTransportConnection.java:82)\n        at org.apache.activemq.command.ConnectionInfo.visit(ConnectionInfo.java:106)\n        at org.apache.activemq.broker.AbstractConnection.service(AbstractConnection.java:196)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:62)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:93)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:70)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:114)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:122)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:87)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:139)\n        at java.lang.Thread.run(Thread.java:595)\n \nI have extrapolated the sequence of calls that DefaultMessageListenerContainer is making and managed to produce a simple test case that reproduces the problem:\n \nimport junit.framework.TestCase;\nimport org.apache.activemq.ActiveMQConnectionFactory;\nimport org.apache.activemq.command.ActiveMQQueue;\n \nimport javax.jms.*;\n \npublic class TestActiveMQ extends TestCase {\n \n    public void testConnectionFactory() throws Exception {\n        final ActiveMQConnectionFactory cf = new ActiveMQConnectionFactory(\"tcp://localhost:61616\");\n        final ActiveMQQueue queue = new ActiveMQQueue(\"testqueue\");\n        final Connection conn = cf.createConnection();\n \n        Runnable r = new Runnable() {\n            public void run() {\n                try {\n                    Session session = conn.createSession(false, 1);\n                    MessageConsumer consumer = session.createConsumer(queue, null);\n                    Message msg = consumer.receive(1000);\n                } catch (JMSException e) {\n                    e.printStackTrace();\n                }\n            }\n        };\n        new Thread(r).start();\n        conn.start();\n \n        try {\n            synchronized (this) {\n                wait(3000);\n            }\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n \nLet us know if you need anymore information. Dont want to scrub ActiveMQ from my list of candidates If I can help it.\n \ncheers\ncraig\n \n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161909","customfield_12312823":null,"summary":"Client: XXX already connected exception when connection started after consumers added","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=craigday","name":"craigday","key":"craigday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig Day","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=craigday","name":"craigday","key":"craigday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig Day","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"WinXP","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481745/comment/12937998","id":"12937998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"I've added your test case to SVN\n\nhttps://svn.apache.org/repos/asf/incubator/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/bugs/CraigsBugTest.java\n\nand unfortunately it works perfectly.\n\nI suspect the bug is caused by Spring reusing a clientID on 2 JMS connections? Can you get a JUnit test case to fail by itself? I suspect some other node in the network is causing the problem, not this test case","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-05-01T16:32:22.000+0000","updated":"2006-05-01T16:32:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481745/comment/12937989","id":"12937989","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=craigday","name":"craigday","key":"craigday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig Day","active":true,"timeZone":"Etc/UTC"},"body":"The attached test case fails for me everytime. I can get it to not fail by sleeping a bit before the conn.start() call, so its obviously a problem related to connection starting concurrently with one of the other operations in the other thread. This is against a single broker.\n\nI have analysed the way Spring is using/setting clientID, and in short, it isnt unless I tell it to. Im only opening one connection anyway, and you can see just one connection in the test case i provided.\n\nSwitching to another JMS provider with the same code/config works fine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=craigday","name":"craigday","key":"craigday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig Day","active":true,"timeZone":"Etc/UTC"},"created":"2006-05-01T18:58:35.000+0000","updated":"2006-05-01T18:58:35.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481745/comment/12937819","id":"12937819","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"I'm wondering if this is a timing issue between one thread calling connection.start() and another calling createSession().\n\nMaybe it only fails on your OS, processor & JVM etc?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-05-01T19:42:55.000+0000","updated":"2006-05-01T19:42:55.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481745/comment/12937864","id":"12937864","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=craigday","name":"craigday","key":"craigday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig Day","active":true,"timeZone":"Etc/UTC"},"body":"\nSome further information for you. I attached a debugger to the broker and the testcase.\n\nHere is the problem:\n\nThe testcase calls createSession() resulting in the following stack of calls:\n\nwait():-1, java.lang.Object\nwait():474, java.lang.Object\nwaitFor():267, edu.emory.mathcs.backport.java.util.concurrent.FutureTask\nget():117, edu.emory.mathcs.backport.java.util.concurrent.FutureTask\ngetResult():44, org.apache.activemq.transport.FutureResponse\nrequest():69, org.apache.activemq.transport.ResponseCorrelator\nsyncSendPacket():1108, org.apache.activemq.ActiveMQConnection\nensureConnectionInfoSent():1196, org.apache.activemq.ActiveMQConnection\ncreateSession():252, org.apache.activemq.ActiveMQConnection\nrun():28, test.click.TestActiveMQ$1\nrun():595, java.lang.Thread\n\non the server this ends up at:\n\naddConnection():148, org.apache.activemq.broker.region.RegionBroker\naddConnection():65, org.apache.activemq.broker.BrokerFilter\naddConnection():69, org.apache.activemq.advisory.AdvisoryBroker\naddConnection():65, org.apache.activemq.broker.BrokerFilter\naddConnection():77, org.apache.activemq.broker.MutableBrokerFilter\nprocessAddConnection():500, org.apache.activemq.broker.AbstractConnection\nprocessAddConnection():82, org.apache.activemq.broker.jmx.ManagedTransportConnection\nvisit():106, org.apache.activemq.command.ConnectionInfo\nservice():196, org.apache.activemq.broker.AbstractConnection\nonCommand():62, org.apache.activemq.broker.TransportConnection$1\nonCommand():93, org.apache.activemq.transport.ResponseCorrelator\nonCommand():70, org.apache.activemq.transport.TransportFilter\nonCommand():114, org.apache.activemq.transport.WireFormatNegotiator\nonCommand():122, org.apache.activemq.transport.InactivityMonitor\ndoConsume():87, org.apache.activemq.transport.TransportSupport\nrun():139, org.apache.activemq.transport.tcp.TcpTransport\nrun():595, java.lang.Thread\n\nwhere RegionBroker adds the generated clientID to the clientIDSet.\n\nNote that I havent called conn.start() yet!\n\nThe main thread then calls conn.start() resulting in the following stack of calls:\n\nwait():-1, java.lang.Object\nwait():474, java.lang.Object\nwaitFor():267, edu.emory.mathcs.backport.java.util.concurrent.FutureTask\nget():117, edu.emory.mathcs.backport.java.util.concurrent.FutureTask\ngetResult():44, org.apache.activemq.transport.FutureResponse\nrequest():69, org.apache.activemq.transport.ResponseCorrelator\nsyncSendPacket():1108, org.apache.activemq.ActiveMQConnection\nensureConnectionInfoSent():1196, org.apache.activemq.ActiveMQConnection\nstart():412, org.apache.activemq.ActiveMQConnection\ntestConnectionFactory():38, test.click.TestActiveMQ\ninvoke0():-1, sun.reflect.NativeMethodAccessorImpl\ninvoke():39, sun.reflect.NativeMethodAccessorImpl\ninvoke():25, sun.reflect.DelegatingMethodAccessorImpl\ninvoke():585, java.lang.reflect.Method\nrunTest():154, junit.framework.TestCase\n\ni.e. another call to ensureConnectionInfoSent()!!! resulting in the broker stack of calls:\n\naddConnection():148, org.apache.activemq.broker.region.RegionBroker\naddConnection():65, org.apache.activemq.broker.BrokerFilter\naddConnection():69, org.apache.activemq.advisory.AdvisoryBroker\naddConnection():65, org.apache.activemq.broker.BrokerFilter\naddConnection():77, org.apache.activemq.broker.MutableBrokerFilter\nprocessAddConnection():500, org.apache.activemq.broker.AbstractConnection\nprocessAddConnection():82, org.apache.activemq.broker.jmx.ManagedTransportConnection\nvisit():106, org.apache.activemq.command.ConnectionInfo\nservice():196, org.apache.activemq.broker.AbstractConnection\nonCommand():62, org.apache.activemq.broker.TransportConnection$1\nonCommand():93, org.apache.activemq.transport.ResponseCorrelator\nonCommand():70, org.apache.activemq.transport.TransportFilter\nonCommand():114, org.apache.activemq.transport.WireFormatNegotiator\nonCommand():122, org.apache.activemq.transport.InactivityMonitor\ndoConsume():87, org.apache.activemq.transport.TransportSupport\nrun():139, org.apache.activemq.transport.tcp.TcpTransport\nrun():595, java.lang.Thread\n\nwhere the clientID is checked and collides with the clientID deposited from the first call.\n\nIts pretty obvious looking at it that ensureConnectionInfo() and the setting of the boolean \nisConnectionInfoSentToBroker is not thread safe:\n\n    /**\n     * Send the ConnectionInfo to the Broker\n     * \n     * @throws JMSException\n     */\n    protected void ensureConnectionInfoSent() throws JMSException {\n        // Can we skip sending the ConnectionInfo packet??\n        if (isConnectionInfoSentToBroker || closed.get()) {\n            return;\n        }\n\n        if (info.getClientId() == null || info.getClientId().trim().length() == 0) {\n            info.setClientId(clientIdGenerator.generateId());\n        }\n        syncSendPacket(info);\n        \n        this.isConnectionInfoSentToBroker = true;\n        // Add a temp destination advisory consumer so that \n        // We know what the valid temporary destinations are on the \n        // broker without having to do an RPC to the broker.\n        \n        ConsumerId consumerId = new ConsumerId(new SessionId(info.getConnectionId(), -1),consumerIdGenerator.getNextSequenceId());\n        advisoryConsumer = new AdvisoryConsumer(this, consumerId);\n        \n    }\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=craigday","name":"craigday","key":"craigday","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig Day","active":true,"timeZone":"Etc/UTC"},"created":"2006-05-01T20:19:57.000+0000","updated":"2006-05-01T20:19:57.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481745/comment/12937840","id":"12937840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"Great catch Craig - thanks for figuring all that out - I was starting to suspect something like this could be the cause of your error.\n\nI've made the ensureConnectionInfoSent() method synchronized now so that this loophole should be now fixed. Could you test its working for you now please? Let us know if its not and we can reopen this issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-05-02T19:29:47.000+0000","updated":"2006-05-02T19:29:47.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481745/comment/12936290","id":"12936290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjivan","name":"sjivan","key":"sjivan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sanjiv Jivan","active":true,"timeZone":"Etc/UTC"},"body":"fyi I ran into the very same issue with 4.0 RC3. After upgrading to the 4.0 release jar (dated jun 13, 2006), I no longer see this error.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjivan","name":"sjivan","key":"sjivan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sanjiv Jivan","active":true,"timeZone":"Etc/UTC"},"created":"2006-06-16T03:22:49.000+0000","updated":"2006-06-16T03:22:49.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481745/comment/12938177","id":"12938177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjivan","name":"sjivan","key":"sjivan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sanjiv Jivan","active":true,"timeZone":"Etc/UTC"},"body":"oops, looks like I spoke too soon. With Active MQ 4.0 RC3, I used to get this exception as soon as the brokers were started. However with 4.0 final, on startup this exception does not occur. It shows up when messages are received by the broker. I'm using Spring-2.0 with DefaultMessageListenerContainer as well.\n\nHere's the stacktrace :\n\n2006-06-15 22:06:35,017 INFO [org.apache.activemq.broker.AbstractConnection.Service] - <Sync error occurred: javax.jms.InvalidClientIDException: Broker: localhost - Client: ID:weston-2030-1150416833580-1:0 already connected>\njavax.jms.InvalidClientIDException: Broker: localhost - Client: ID:weston-2030-1150416833580-1:0 already connected\n        at org.apache.activemq.broker.region.RegionBroker.addConnection(RegionBroker.java:176)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:69)\n        at org.apache.activemq.advisory.AdvisoryBroker.addConnection(AdvisoryBroker.java:69)\n        at org.apache.activemq.broker.BrokerFilter.addConnection(BrokerFilter.java:69)\n        at org.apache.activemq.broker.MutableBrokerFilter.addConnection(MutableBrokerFilter.java:82)\n        at org.apache.activemq.broker.AbstractConnection.processAddConnection(AbstractConnection.java:507)\n        at org.apache.activemq.command.ConnectionInfo.visit(ConnectionInfo.java:118)\n        at org.apache.activemq.broker.AbstractConnection.service(AbstractConnection.java:201)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:62)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:97)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:63)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:114)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:122)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:87)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:143)\n        at java.lang.Thread.run(Thread.java:534)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjivan","name":"sjivan","key":"sjivan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sanjiv Jivan","active":true,"timeZone":"Etc/UTC"},"created":"2006-06-16T09:08:28.000+0000","updated":"2006-06-16T09:08:28.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481745/comment/12938115","id":"12938115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"Sanjiv - can you provide some kind of test case to demonstrate the problem - I'm not sure what you are doing and generally don't use the Spring DefaultMessageListenerContainer","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-06-16T15:23:46.000+0000","updated":"2006-06-16T15:23:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481745/comment/12938193","id":"12938193","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjivan","name":"sjivan","key":"sjivan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sanjiv Jivan","active":true,"timeZone":"Etc/UTC"},"body":"I've created a separate issue : http://issues.apache.org/activemq/browse/AMQ-760 and uplaoded a test app to demonstrate this and some other issues as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjivan","name":"sjivan","key":"sjivan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sanjiv Jivan","active":true,"timeZone":"Etc/UTC"},"created":"2006-06-18T03:14:57.000+0000","updated":"2006-06-18T03:14:57.000+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-696/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s2o7:"}}