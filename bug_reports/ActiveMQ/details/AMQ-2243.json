{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482163","self":"https://issues.apache.org/jira/rest/api/2/issue/12482163","key":"AMQ-2243","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315624","id":"12315624","description":"Maintenance release for 5.4.0","name":"5.4.1","archived":false,"released":true,"releaseDate":"2010-09-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2010-08-17T14:47:54.449+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Aug 16 06:08:36 UTC 2011","customfield_12310420":"64950","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_40551182343_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-08-17T14:47:54.465+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2243/watchers","watchCount":0,"isWatching":false},"created":"2009-05-05T06:34:52.122+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-08-16T06:08:36.111+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Demonstration of problem:\n\nMyQueue contains MSG1, MSG2.\n\nStomp:\n- CONNECT\n- SUBSCRIBE MyQueue (ack = client)\n- BEGIN tx1\n- <reads a message coming from MyQueue> message-id: MSG1\n- ACK message-id: MSG1 \n- *disconnect TCP session*\n\nUpon reconnecting and subscribing, MSG2 is received.  MSG1 still appears in the queue under the admin web interface but does not get retransmitted (is it still being locked by the now-dead transaction?)\nIf the above example finished with an ABORT tx1 before disconnecting, the problem does not occur.\n\nFurther to this, if I restart activemq, MSG1 will now get retransmitted correctly (ie. it is no longer locked by the transaction).\n\nI suspect that the stomp implementation does not roll back all open transactions when the client unexpectedly disconnects.\n\nI have attached a telnet session demonstrating the exact problem.\n\nI've also attached a unit test for transport/stomp/ which contains two tests:\n* testDisconnectRetransmit() - tests that an unacknowledged message is re-transmitted if the client disconnects before ACKing it - SUCCEEDS\n* testTransactionDisconnectRetransmit() - same as above except the message gets ACK'd inside an incomplete transaction before disconnecting - FAILS","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461508","id":"12461508","filename":"AMQ-2243-telnetExample.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-05T06:37:30.096+0000","size":1388,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461508/AMQ-2243-telnetExample.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461507","id":"12461507","filename":"AshStompTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-05T06:36:12.647+0000","size":9853,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461507/AshStompTest.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"159785","customfield_12312823":null,"summary":"Stomp does not retransmit message if client ACKs inside disconnected transaction","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482163/comment/12941249","id":"12941249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"body":"Unit test","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-05T06:36:12.693+0000","updated":"2009-05-05T06:36:12.693+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482163/comment/12941257","id":"12941257","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"body":"Demonstration of the issue using telnet.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-05T06:37:30.131+0000","updated":"2009-05-05T06:37:30.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482163/comment/12938366","id":"12938366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Tests pass when run against the 5.4.0 release.  If you still see this issue when using 5.4.0 please reopen and report on how you reproduced it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2010-08-17T14:47:54.449+0000","updated":"2010-08-17T14:47:54.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482163/comment/13085556","id":"13085556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"body":"Confirming this is no longer an issue 5.5.  Thank you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashleyholman","name":"ashleyholman","key":"ashleyholman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashley Holman","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-16T06:08:36.044+0000","updated":"2011-08-16T06:08:36.044+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2243/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rpk7:"}}