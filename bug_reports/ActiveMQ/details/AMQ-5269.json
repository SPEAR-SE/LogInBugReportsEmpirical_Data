{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12726598","self":"https://issues.apache.org/jira/rest/api/2/issue/12726598","key":"AMQ-5269","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324951","id":"12324951","name":"5.11.0","archived":false,"released":true,"releaseDate":"2015-02-04"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-07-10T19:22:53.647+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jul 10 20:38:47 UTC 2014","customfield_12310420":"404705","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_20294832_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-07-10T20:34:03.451+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5269/watchers","watchCount":4,"isWatching":false},"created":"2014-07-10T14:55:48.669+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-07-10T20:38:47.096+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"\nCurrently, all the TCP based transports are using the old blocking style of socket.accept() to accept connections.   This works \"OK\" except that for sockets that have a channel associated with them, the socket.close() doesn't cause it to return immediately.  It still waits for the SoTimeout which is currently set a 2 seconds.   That can cause 2 second delays for any shutdown which causes long, unnecessary delays, particularly in the tests.\n\nOne possible \"fix\" is to drop the socket.setSoTimeout(2000) call to something much smaller.   However, that would turn the accept thread into a more \"busy wait\" scenario which is undesirable.\n\nA better fix is to change the accepts for the sockets that have a ServerSocketChannel to use the NIO based selectors for the accept operations.   The selector.disable()/selector.close() allows the socket and everything to close immediately.  The result is that the NIO based tests now take the same amount of time as the non-NIO based tests (for which socket.close() causes the accept to return immediately).\n\nPull request forthcoming.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12655028","id":"12655028","filename":"AMQ-5269.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"created":"2014-07-10T16:34:07.304+0000","size":9502,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12655028/AMQ-5269.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"404743","customfield_12312823":null,"summary":"NIO transports using blocking accept calls, very slow shutdown","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726598/comment/14057645","id":"14057645","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"body":"Attaching a patch for now as my \"git\" stuff is in a bit of a mess and I need to clean that up.   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"created":"2014-07-10T16:34:07.308+0000","updated":"2014-07-10T16:34:07.308+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726598/comment/14057830","id":"14057830","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user dkulp opened a pull request:\n\n    https://github.com/apache/activemq/pull/33\n\n    [AMQ-5269] Update NIO based transports to use a Select mechanism\n\n    Update NIO based transports to use a Select mechanism for the accepts instead of the blocking select.\n    \n    Cuts about 10 minutes off the activemq-stomp tests, drops the NIO test execution time down to equal to the non-NIO based tests.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/dkulp/activemq AMQ-5269\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/33.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #33\n    \n----\ncommit 52ef9745d9bafbeab940ed4937c014be3abc9655\nAuthor: Daniel Kulp <dkulp@apache.org>\nDate:   2014-07-10T14:57:44Z\n\n    [AMQ-5269] Update NIO based transports to use a Select mechanism for the accepts instead of the blocking select.\n    Cuts about 10 minutes off the activemq-stomp tests, drops the NIO test execution time down to equal to the non-NIO based tests.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-10T19:22:53.647+0000","updated":"2014-07-10T19:22:53.647+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726598/comment/14057831","id":"14057831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"body":"On my Mac:\n\nBefore:\n{code}\nRunning org.apache.activemq.transport.stomp.Stomp11NIOSSLTest\nTests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 126.509 sec - in org.apache.activemq.transport.stomp.Stomp11NIOSSLTest\nRunning org.apache.activemq.transport.stomp.Stomp11NIOTest\nTests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 124.051 sec - in org.apache.activemq.transport.stomp.Stomp11NIOTest\nRunning org.apache.activemq.transport.stomp.Stomp11SslAuthTest\nTests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 73.105 sec - in org.apache.activemq.transport.stomp.Stomp11SslAuthTest\n{code}\n\nAfter:\n{code}\nRunning org.apache.activemq.transport.stomp.Stomp11NIOSSLTest\nTests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 71.824 sec - in org.apache.activemq.transport.stomp.Stomp11NIOSSLTest\nRunning org.apache.activemq.transport.stomp.Stomp11NIOTest\nTests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 70.408 sec - in org.apache.activemq.transport.stomp.Stomp11NIOTest\nRunning org.apache.activemq.transport.stomp.Stomp11SslAuthTest\nTests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 72.747 sec - in org.apache.activemq.transport.stomp.Stomp11SslAuthTest\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dkulp","name":"dkulp","key":"dkulp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dkulp&avatarId=10090","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dkulp&avatarId=10090","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dkulp&avatarId=10090","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dkulp&avatarId=10090"},"displayName":"Daniel Kulp","active":true,"timeZone":"America/New_York"},"created":"2014-07-10T19:24:05.709+0000","updated":"2014-07-10T19:24:05.709+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726598/comment/14057864","id":"14057864","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Reviewed and ran a bunch of the tests here and everything seems good, can commit if you are satisfied with the current changeset","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-07-10T20:01:32.397+0000","updated":"2014-07-10T20:01:32.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726598/comment/14057917","id":"14057917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Fixed on trunk, thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-07-10T20:34:03.484+0000","updated":"2014-07-10T20:34:03.484+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726598/comment/14057927","id":"14057927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user dkulp closed the pull request at:\n\n    https://github.com/apache/activemq/pull/33\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-10T20:38:47.096+0000","updated":"2014-07-10T20:38:47.096+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5269/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1xnfb:"}}