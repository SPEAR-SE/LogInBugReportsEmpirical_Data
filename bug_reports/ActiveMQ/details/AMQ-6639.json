{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13059712","self":"https://issues.apache.org/jira/rest/api/2/issue/13059712","key":"AMQ-6639","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-03-28T14:54:47.297+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 29 14:44:24 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6639/watchers","watchCount":4,"isWatching":false},"created":"2017-03-28T12:05:17.815+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335045","id":"12335045","name":"5.13.3","archived":false,"released":true,"releaseDate":"2016-05-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12338909","id":"12338909","name":"5.14.4","archived":false,"released":true,"releaseDate":"2017-03-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-03-29T14:44:24.259+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12318701","id":"12318701","name":"MQTT","description":"MQTT Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Hello,\nWe have an issue with the MQTT ActiveMQ.\nThis is our situation:\nOur mobile applications are connected to our ActiveMQ MQTT server.\nWe use the LWT message to detect the mobile \"network lost\".\nWe noticed that when we got a mobile \"network lost\", the LWT message is sent 90s after the disconnect.  If the network comes back before 90s, a retained message is sent to alert the server. But we saw that the \"network lost\" LWT message is STILL sent even if we received the retained message.\nFor me, the LWT message \"network lost\" should be cancelled if we received a new retained message. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12861056","id":"12861056","filename":"issues.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-29T14:44:24.241+0000","size":8222,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12861056/issues.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"MQTT : \"Lost Connection\" LWT message are not cancelled after network come back","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"linux.\nApplication android and ios","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13059712/comment/15945316","id":"15945316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"5.14.4 is the latest release, you should test against that and if there's still an issue create a unit test that can reproduce the problem.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-03-28T14:54:47.297+0000","updated":"2017-03-28T14:54:47.297+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13059712/comment/15945429","id":"15945429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"body":"Unfortunately we did a test with the last version 5.14.4: we got exactly\nthe same result. I am going to give a unit test as soon as possible.\nLe mar. 28 mars 2017 Ã  16:55, Timothy Bish (JIRA) <jira@apache.org> a\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-28T15:53:40.690+0000","updated":"2017-03-28T15:53:40.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13059712/comment/15947153","id":"15947153","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"body":"Hello,\nWe cannot give a TU because we noticed the issue with a mobile phone that lose the network. it is hard for us to simulate that event.\nBut I can give you the steps to reproduce it with some piece of code.\nStep 1) use a tool P(ex mosquitto_sub) listening the topic X.\nStep 2)  connect your mobile to the MQTT server. Mobile send a retain message to the topic X\nStep 3) MQTT server push the retain message to the tool P.\nStep 4)  Activate \"AirPlane\" mode on the mobile\nStep 5) 10 seconds after, unactivate \"AirPlane\" mode. A retain message must be  send again to topic X.\nStep 6) MQTT server push the retain message to the tool P.\nStep 7) wait for 2 minutes. MQTT push a LWT to tool P\n\nThis is an example the code used on our mobile application to send message to MQTT server\n{code:javascript}\nvar i_am_connected = new Paho.MQTT.Message(JSON.stringify({\n        version: 1,\n        state: 2,\n        timestamp: startListeningTimeInS,\n        deverylight: Version,\n        os: ionic.Platform.platform(),\n        release: ionic.Platform.version()\n      }));\n      i_am_connected.destinationName = \"device/\" + LoginService.userData.token + \"/ping\";\n      i_am_connected.retained = true;\n      i_am_connected.qos = 1;\n\n\nvar i_am_connected = new Paho.MQTT.Message(JSON.stringify({\n        version: 1,\n        state: 2,\n        timestamp: startListeningTimeInS,\n        deverylight: Version,\n        os: ionic.Platform.platform(),\n        release: ionic.Platform.version()\n      }));\n      i_am_connected.destinationName = \"device/\" + LoginService.userData.token + \"/ping\";\n      i_am_connected.retained = true;\n      i_am_connected.qos = 1;\n\nclient.connect({\n        timeout: 3,\n        useSSL: false,\n        cleanSession: true,\n        userName: LoginService.userData.token,\n        password: '',\n        willMessage: i_am_disconnected,\n        onSuccess: function() {\n          timeOfConnectionLoss = 0;\n          service.connected = 2;\n          client.send(i_am_connected);\n          //resubscribing\n          Object.keys(subscriptions).forEach(function (topic) {\n            client.subscribe(topic);\n          });\n\n          window.addEventListener('unload', disconnect);\n          deferred.resolve();\n        },\n        onFailure: onConnectionLost\n      });\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-29T13:50:05.869+0000","updated":"2017-03-29T13:50:05.869+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13059712/comment/15947246","id":"15947246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"body":"Hello. \nAnother detail: we did a test with Mosquitto rather then ActiveMQ: it works well with Mosquitto","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-29T14:40:36.134+0000","updated":"2017-03-29T14:40:36.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13059712/comment/15947253","id":"15947253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"body":"example of getting message with mosquitto_sub","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=avaldor","name":"avaldor","key":"avaldor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aland Valdor","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-29T14:44:24.251+0000","updated":"2017-03-29T14:44:24.251+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6639/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3cw27:"}}