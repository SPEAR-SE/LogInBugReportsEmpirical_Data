{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483556","self":"https://issues.apache.org/jira/rest/api/2/issue/12483556","key":"AMQ-1999","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316331","id":"12316331","description":"Next unplanned v5 maintenance release","name":"5.x","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2008-11-18T11:22:42.209+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jun 02 11:40:40 UTC 2015","customfield_12310420":"44204","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1999/watchers","watchCount":6,"isWatching":false},"created":"2008-11-10T17:44:09.126+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-06-02T11:40:40.209+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"On the master:\n\n2008-11-10 18:34:17,001 [44.161.71:41260] WARN  XATransaction                  - POST COMMIT FAILED: \njava.lang.NullPointerException\n        at org.apache.activemq.transaction.Transaction.fireAfterCommit(Transaction.java:87)\n        at org.apache.activemq.transaction.XATransaction.doPostCommit(XATransaction.java:110)\n        at org.apache.activemq.transaction.XATransaction.commit(XATransaction.java:65)\n        at org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:170)\n        at org.apache.activemq.broker.BrokerFilter.commitTransaction(BrokerFilter.java:94)\n        at org.apache.activemq.broker.BrokerFilter.commitTransaction(BrokerFilter.java:94)\n        at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:101)\n        at org.apache.activemq.broker.ft.MasterBroker.commitTransaction(MasterBroker.java:285)\n        at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:101)\n        at org.apache.activemq.broker.TransportConnection.processCommitTransactionOnePhase(TransportConnection.java:413)\n        at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:100)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:305)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)\n        at java.lang.Thread.run(Thread.java:619)\n2008-11-10 18:34:17,005 [44.161.71:41260] DEBUG Service                        - Error occured while processing sync command: javax.transaction.xa.XAException: POST COMMIT FAILED\n\njavax.transaction.xa.XAException: POST COMMIT FAILED\n        at org.apache.activemq.transaction.XATransaction.doPostCommit(XATransaction.java:115)\n        at org.apache.activemq.transaction.XATransaction.commit(XATransaction.java:65)\n        at org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:170)\n        at org.apache.activemq.broker.BrokerFilter.commitTransaction(BrokerFilter.java:94)\n        at org.apache.activemq.broker.BrokerFilter.commitTransaction(BrokerFilter.java:94)\n        at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:101)\n        at org.apache.activemq.broker.ft.MasterBroker.commitTransaction(MasterBroker.java:285)\n        at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:101)\n        at org.apache.activemq.broker.TransportConnection.processCommitTransactionOnePhase(TransportConnection.java:413)\n        at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:100)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:305)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)\n        at java.lang.Thread.run(Thread.java:619)\nCaused by: java.lang.NullPointerException\n        at org.apache.activemq.transaction.Transaction.fireAfterCommit(Transaction.java:87)\n        at org.apache.activemq.transaction.XATransaction.doPostCommit(XATransaction.java:110)\n        ... 18 more\n\n2008-11-10 18:34:17,100 [44.161.71:41260] DEBUG Service                        - Error occured while processing sync command: javax.transaction.xa.XAException: Transaction 'XID:257:7370656e63652e6d61726b657478732\ne636f6d2f3137390000000000000000000000000000000000000000000000000000000000000000000000000000000000:310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n00000000000000' has not been started.\njavax.transaction.xa.XAException: Transaction 'XID:257:7370656e63652e6d61726b657478732e636f6d2f3137390000000000000000000000000000000000000000000000000000000000000000000000000000000000:3100000000000000000000000000\n0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' has not been started.\n        at org.apache.activemq.broker.TransactionBroker.getTransaction(TransactionBroker.java:266)\n        at org.apache.activemq.broker.TransactionBroker.rollbackTransaction(TransactionBroker.java:174)\n        at org.apache.activemq.broker.BrokerFilter.rollbackTransaction(BrokerFilter.java:122)\n        at org.apache.activemq.broker.BrokerFilter.rollbackTransaction(BrokerFilter.java:122)\n        at org.apache.activemq.broker.MutableBrokerFilter.rollbackTransaction(MutableBrokerFilter.java:129)\n        at org.apache.activemq.broker.ft.MasterBroker.rollbackTransaction(MasterBroker.java:271)\n        at org.apache.activemq.broker.MutableBrokerFilter.rollbackTransaction(MutableBrokerFilter.java:129)\n        at org.apache.activemq.broker.TransportConnection.processRollbackTransaction(TransportConnection.java:429)\n        at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:104)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:305)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)\n        at java.lang.Thread.run(Thread.java:619)\n\nOn the slave:\n\n2008-11-10 18:34:17,104 [.cluster#1] ERROR Service                        - Async error occurred: javax.transaction.xa.XAException: Transaction 'XID:257:7370656e63652e6d61726b657478732e636f6d2f31373900000000\n00000000000000000000000000000000000000000000000000000000000000000000000000:31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' has not\n been started.\njavax.transaction.xa.XAException: Transaction 'XID:257:7370656e63652e6d61726b657478732e636f6d2f3137390000000000000000000000000000000000000000000000000000000000000000000000000000000000:3100000000000000000000000000\n0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' has not been started.\n        at org.apache.activemq.broker.TransactionBroker.getTransaction(TransactionBroker.java:266)\n        at org.apache.activemq.broker.TransactionBroker.rollbackTransaction(TransactionBroker.java:174)\n        at org.apache.activemq.broker.BrokerFilter.rollbackTransaction(BrokerFilter.java:122)\n        at org.apache.activemq.broker.BrokerFilter.rollbackTransaction(BrokerFilter.java:122)\n        at org.apache.activemq.broker.MutableBrokerFilter.rollbackTransaction(MutableBrokerFilter.java:129)\n        at org.apache.activemq.broker.TransportConnection.processRollbackTransaction(TransportConnection.java:429)\n        at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:104)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:305)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:104)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:205)\n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12658149","id":"12658149","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philippe_tseyen","name":"philippe_tseyen","key":"philippe_tseyen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"philippe tseyen","active":true,"timeZone":"Europe/Berlin"},"created":"2014-07-28T15:38:13.925+0000","size":2549,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12658149/activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461279","id":"12461279","filename":"AMQ-1999.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T11:25:51.148+0000","size":2539,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461279/AMQ-1999.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12658150","id":"12658150","filename":"debug.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philippe_tseyen","name":"philippe_tseyen","key":"philippe_tseyen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"philippe tseyen","active":true,"timeZone":"Europe/Berlin"},"created":"2014-07-28T15:38:13.930+0000","size":19238,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12658150/debug.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59808","customfield_12312823":null,"summary":"XAException: POST COMMIT FAILED (NPE in Pure master/slave setup)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12482650","key":"AMQ-1983","self":"https://issues.apache.org/jira/rest/api/2/issue/12482650","fields":{"summary":"Async error occurred - Slave broker out of sync with master","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Pure master/slave setup with 5.2.0-RC3\njava version \"1.6.0_03\"\nJBoss 4.0.5 GA","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483556/comment/12940470","id":"12940470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"body":"I used the \"activemqjee-0.0.9-src.tar.gz\" from AMQ-1983, because I tried to reproduce the first issue (Slave broker out of sync with master).\n\nI think it's another that the transaction ack, that was missing in the same log.\n\nSame setup, but the app gets a bit closer to our real application code.\n\nWith the ActiveMQ console of the master:\n- Specify a reply queue.\n- Send a message to Queue A. \n- The MDB will forward it to queue B, queue C and topic A.\n- It also sends a reply to the reply queue.\n\nI've tried this a few times with 20 messages at a time without any failure.\nWhen I tried it with 50 messages, the NPE happened.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-10T17:53:56.151+0000","updated":"2008-11-10T17:53:56.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483556/comment/12940491","id":"12940491","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Hans, reproducing is causing a problem.\n\nIn an effort to reproduce with no intervention and with master slave I added the following code to the StandalonApp but it does not reproduce the problem.\n{code}\n7d6\n< import java.util.Vector;\n23,24d21\n< import org.apache.activemq.ActiveMQConnectionFactory;\n< import org.apache.activemq.broker.BrokerService;\n71c68\n<         int nMessagesToSend = 50;\n---\n>         int nMessagesToSend = 0;\n286c283\n< \tpublic static void main(String[] args) throws Exception {\n---\n> \tpublic static void main(String[] args) {\n288,303d284\n< \t       \n<         Vector<BrokerService> brokers = new Vector<BrokerService>();\n<         \n<         BrokerService service = new BrokerService();\n<         service.setDeleteAllMessagesOnStartup(true);\n<         service.addConnector(ActiveMQConnectionFactory.DEFAULT_BROKER_BIND_URL);\n<         service.start();\n<         brokers.add(service);\n<             \n<         BrokerService slave = new BrokerService();\n<         service.setDeleteAllMessagesOnStartup(true);\n<         slave.setBrokerName(\"slave\");\n<         slave.setMasterConnectorURI(ActiveMQConnectionFactory.DEFAULT_BROKER_BIND_URL);\n<         slave.start();\n<         brokers.add(slave);\n< \n311,319d291\n< \t\t        \n<         for (BrokerService b: brokers) {\n<             try {\n<                 b.stop();\n<             } catch (Exception e) {\n<                 e.printStackTrace();\n<             }\n<         }\n< \n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T11:22:42.209+0000","updated":"2008-11-18T11:22:42.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483556/comment/12940482","id":"12940482","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"From code inspection, there is a synchronisation issue in a transaction between async send and transaction completion when there is a duplicate message delivery.\nThe following patch, which ensures that a duplicate is detected early, will remove the NPE.\nCan you build trunk with this patch to validate?\n\nIf this works, where does the duplicate message come from is the next question?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T11:25:51.232+0000","updated":"2008-11-18T11:25:51.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483556/comment/12940479","id":"12940479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"body":"The stand-alone application should have XA transactions added to reproduce the problem.\n\nIs there something I can check in the logs?\n\nI wanted to include logs, but the master log was rolled over already. I should increase the maximum size or maximum number of files.\nI still have the ActiveMQ slave log (DEBUG level) and the JBoss logs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T11:35:36.112+0000","updated":"2008-11-18T11:35:36.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483556/comment/12940480","id":"12940480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Check out the debug trace statement that is moved around in the patch, this should be present in the log.\norg.apache.activemq.broker.TransactionBroker\nLOG.debug(\"IGNORING duplicate message \" + message);\n\nIf you can modify the StandaloneApp to reproduce with XA transactions I will have a look.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T14:47:34.947+0000","updated":"2008-11-18T14:47:34.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483556/comment/12943307","id":"12943307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dumitriu","name":"dumitriu","key":"dumitriu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Mihai Dumitriu","active":true,"timeZone":"Etc/UTC"},"body":"I also just ran into this issue, while testing the Progress (Iona) build of FUSE version 5.3.0.1.  I am also using MasterSlave setup, with the amqPersistenceAdapter configured to syncOnWrite.  What I am actually doing is using XA with 2 resources: the AMQ broker, and an MS SQL database, via the JTDS driver.  The JTA TM is SimpleJTA, which I've modified somewhat.\n\nAnyone have a solution for this, or is it still unresolved?  Does anyone out there [successfully] use XA with MasterSlave?\n\nERROR MasterBroker                   - Slave Failed\njavax.transaction.xa.XAException: Transaction 'XID:471014666:6d79544d32202020202020202020202020202020202020202020202020202020000001210cd7b658000001210cd8cd95000\n000000000001f:00000001' has not been started.\n        at org.apache.activemq.broker.TransactionBroker.getTransaction(TransactionBroker.java:266)\n        at org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:190)\n        at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:74)\n        at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:74)\n        at org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:85)\n        at org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:461)\n        at org.apache.activemq.command.MessageAck.visit(MessageAck.java:205)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:308)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:182)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:104)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:204)\n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\nWARN  Service                        - Async error occurred: javax.transaction.xa.XAException: Transaction 'XID:471014666:6d79544d322020202020202020202020202020\n20202020202020202020202020000001210cd7b658000001210cd8cd95000000000000001f:00000001' has not been started.\njavax.transaction.xa.XAException: Transaction 'XID:471014666:6d79544d32202020202020202020202020202020202020202020202020202020000001210cd7b658000001210cd8cd95000\n000000000001f:00000001' has not been started.\n        at org.apache.activemq.broker.TransactionBroker.getTransaction(TransactionBroker.java:266)\n        at org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:190)\n        at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:74)\n        at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:74)\n        at org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:85)\n        at org.apache.activemq.broker.ft.MasterBroker.acknowledge(MasterBroker.java:357)\n        at org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:85)\n        at org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:461)\n        at org.apache.activemq.command.MessageAck.visit(MessageAck.java:205)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:308)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:182)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:210)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)\n        at java.lang.Thread.run(Thread.java:619)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dumitriu","name":"dumitriu","key":"dumitriu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Mihai Dumitriu","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-04T18:24:05.568+0000","updated":"2009-05-04T18:24:05.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483556/comment/12943006","id":"12943006","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"body":"I also run the same issue with 5.4.0 / 5.4.1 but with the jdbcAdapter (Oracle 11g) in stand alone server.\n\nThe main cause was because client application use XA Transaction Manager (jencks) and JMSTemplate without using TransactionTemplate or Spring annotation.\n\nUse transactionManager.begin, send 1000 messages using JmsTemplate, wait more than 30 sec, and do a TransactionManager.commit.\n\nThe effect is that jmsTemplate create 1000 jms sessions that take long to commit, sometimes during the commit the NPE occur and only a part of message are really stored in database the\nrest stay in cursor memory and lost at server restart.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tranchida","name":"tranchida","key":"tranchida","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Giampaolo Tranchida","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-07T02:36:33.220+0000","updated":"2010-10-07T02:36:33.220+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483556/comment/14568986","id":"14568986","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pawelz","name":"pawelz","key":"pawelz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pawel Zalejko","active":true,"timeZone":"Etc/UTC"},"body":"Hi all, \n\nI just ran into the same issue with 5.9.0. Is there any chance to fix this issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pawelz","name":"pawelz","key":"pawelz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pawel Zalejko","active":true,"timeZone":"Etc/UTC"},"created":"2015-06-02T11:40:40.209+0000","updated":"2015-06-02T11:40:40.209+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1999/votes","votes":4,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0altj:"}}