{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483345","self":"https://issues.apache.org/jira/rest/api/2/issue/12483345","key":"AMQ-1868","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2008-07-23T20:35:40.073+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 01 20:08:49 UTC 2011","customfield_12310420":"69437","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_92722612837_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-01T20:08:49.110+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1868/watchers","watchCount":1,"isWatching":false},"created":"2008-07-23T15:51:56.288+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-07-01T20:08:49.122+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Hallo\n I'm using the attached source  code  to test  AMQ 5.1.0 \n\nI'm using following setting:\n       //SESSION\n    ackMode = Session.AUTO_ACKNOWLEDGE;\n        //FACTORY\n    dispatchAsync = true;\n    useAsyncSend  = false;  \n       //PRODUCERS\n    DelveryMode=Pesrsistent \n    timeToLive = 21600000; //6h\n\n\n\n If I use the following configuration in activemq.xml:  \n\n  <memoryUsage limit=\"20 mb\"/>\n  <policyEntry queue=\">\" memoryLimit=\"5mb\"/>\n\n I noted this behaviour:\n\n if producer  starts a loop of  sendMessage  on a queue where no consumer is listen, after N messages, when the 5Mb are full, producer is blocked.\n\n Block ends when some consumer registers a listener on this queue and start to conuming messages.\n\n \n\n\n  If I change the configuration, removing queue memory limit like below:  \n\n  <memoryUsage limit=\"20 mb\"/>\n  <policyEntry queue=\">\"   />\n\n   and producer  starts a loop of  sendMessage  on a queue where no consumer is listen, producer is NEVER blocked.\n\n   Memory usage percentage go up until 90% and then remains steady, but producer continues to send.\n\n    I expected this same behaviour when queue memory limit was 5Mb, also. \n\n\n   Further, I set values for  queue memory limit higher than 5Mb   and repeated the test :\n\n   memoryLimit=\"10 mb\"    =>      producer was blocked\n\n  memoryLimit=\"18 mb\"   (=90% of 20Mb)   =>      producer was blocked\n\n  memoryLimit=\"19 mb\"   ( >90% of 20Mb)   =>      producer NEVER blocked\n\n\n\n   I expected that  producer NEVER blocked in every cases.\n\n   Please can you help me for this issue?\n   Feel free to ask me other details. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461229","id":"12461229","filename":"ASF.LICENSE.NOT.GRANTED--activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azanfardino","name":"azanfardino","key":"azanfardino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Zanfardino","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-23T15:51:56.363+0000","size":8903,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461229/ASF.LICENSE.NOT.GRANTED--activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461125","id":"12461125","filename":"ASF.LICENSE.NOT.GRANTED--AMQTester.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azanfardino","name":"azanfardino","key":"azanfardino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Zanfardino","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-23T15:51:56.360+0000","size":5501598,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461125/ASF.LICENSE.NOT.GRANTED--AMQTester.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172406","customfield_12312823":null,"summary":"Producer block when queue memory limit is setted to 5Mb and no consumer is actived","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azanfardino","name":"azanfardino","key":"azanfardino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Zanfardino","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azanfardino","name":"azanfardino","key":"azanfardino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Zanfardino","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Unix, jdk 1.5.0_12,  AMQ 5.1.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483345/comment/12939996","id":"12939996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"body":"Other people expect that messages are never lost!\n\nDo you have a solution? An infinite amount of memory?\n\nThis describes the issue more or less:\n\n  http://activemq.apache.org/slow-consumer-handling.html\n\n\nIt depends very much on your application, what's the best solution.\n\nI'd say, if you need long term storage, use a database.\n\nIn many cases you can use the size of the queue as a signal that something is going terribly wrong.\nAlso it could be that messages become worthless as they get old. (... and \"old\" could be \"seconds\").\n\nIn a dynamic application a blocked producer is usually the best. As soon as messages can be delivered, it will be unblocked and continue producing more messages. \n\nIf producer and consumers are on the same machine or use the same resources it's a nice way to distribute the load in a proper way. A blocked producer does not cost resources, so they are available for the consumers.\n\nHans\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-23T20:35:40.073+0000","updated":"2008-07-23T20:35:40.073+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483345/comment/12939985","id":"12939985","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"body":"Maybe you've found a bug if the producer was not blocked, when the memory limit was reached.\nIn that case messages would be lost.\n\nI'm not sure whether I completely understand your issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-23T20:41:37.914+0000","updated":"2008-07-23T20:41:37.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483345/comment/12940002","id":"12940002","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"body":"One more:\n\n  http://activemq.apache.org/slow-consumers.html\n\nI think persistent queue messages should be saved to disk, so the memory limit should not be an issue.\nMaybe one of the developers can say something better about this?\n\nBut in the end you'll probably have the same issue: when the disk limit is reached, your producer will block.\n\n... until a consumer takes some messages.\n\nHans\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-24T04:52:22.975+0000","updated":"2008-07-24T04:52:22.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483345/comment/12939978","id":"12939978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azanfardino","name":"azanfardino","key":"azanfardino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Zanfardino","active":true,"timeZone":"Etc/UTC"},"body":"Hi Hans,\nthank you for your answer.\n\nI'm using the default message cursor type: Store based. \n\nhttp://activemq.apache.org/message-cursors.html\n\n\nWhen my Producer starts, broker works like in the picture \"Dispatching Messages for Fast Customer\".\n\nWhen Dispatch Queue becomes full, broker should work like in the picture \"Dispatching Messages if Dispatch Queue is Full\".\n\nIt seems that \n\n-  If I use no memory limit for queue, or I use memory limit close to Total Memory\n     When Dispatch Queue becomes full then messages are paged in to the dispatch queue from a pending cursor on demand,\n     and producer is not blocked (limited only from disk sapce) \n\n-  If I use 5Mb memory limit for queue, \n     When Dispatch Queue becomes full producer is blocked, rather than to swith to model that use Pending Cursor \n\n\nSo, my question is: why if I use 5Mb memory limit for queue,  broker doesn't work like when I use no limit (or use high limit)?\n\n\n\nAlessandro","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azanfardino","name":"azanfardino","key":"azanfardino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Zanfardino","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-24T08:45:57.972+0000","updated":"2008-07-24T08:45:57.972+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483345/comment/13058759","id":"13058759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Simple case of producer flow control kicking in when low memory limits are set and no consumer present on the queue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-07-01T20:08:49.119+0000","updated":"2011-07-01T20:08:49.119+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1868/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tvgn:"}}