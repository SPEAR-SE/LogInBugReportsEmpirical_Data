{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13085975","self":"https://issues.apache.org/jira/rest/api/2/issue/13085975","key":"AMQ-6766","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2017-07-11T19:40:14.835+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 12 13:26:02 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_167342783_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-07-12T13:26:02.597+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6766/watchers","watchCount":2,"isWatching":false},"created":"2017-07-10T14:56:59.874+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338822","id":"12338822","name":"5.14.3","archived":false,"released":true,"releaseDate":"2016-12-22"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-12T13:26:02.647+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"In the HttpsClientTransport in the createSchemeRegistry method on line 51 a new Scheme is instantiated. The port fed to the constructor of Scheme is gotten from the remoteUrl URI, which will be set to -1 if the port wasn't explicitly included in the broker url.\n\nThe code should be able to deal with this scenario. For instance fallback to 443 when the port on the URI is undefined.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HttpsClientTransport broken when port isn't explicitly included in the broker url","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harmen.renkema","name":"harmen.renkema","key":"harmen.renkema","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harmen Renkema","active":true,"timeZone":"Europe/Amsterdam"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harmen.renkema","name":"harmen.renkema","key":"harmen.renkema","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harmen Renkema","active":true,"timeZone":"Europe/Amsterdam"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13085975/comment/16082836","id":"16082836","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Please provide the simplest possible unit test demonstrating the issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-07-11T19:40:14.835+0000","updated":"2017-07-11T19:40:14.835+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13085975/comment/16083935","id":"16083935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harmen.renkema","name":"harmen.renkema","key":"harmen.renkema","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harmen Renkema","active":true,"timeZone":"Europe/Amsterdam"},"body":"Quick and dirty test. \n\nThe first will fail because the Scheme constructor being called with -1 as port from HttpsClientTransport.\n\n{code:java}\npackage org.apache.activemq.bugs;\n\nimport static org.junit.Assert.fail;\n\nimport javax.jms.Connection;\nimport javax.jms.JMSException;\n\nimport org.apache.activemq.ActiveMQConnectionFactory;\nimport org.junit.Test;\n\npublic class AMQ6766Test {\n\n\t@Test\n\tpublic void https_broker_url_without_port_number() throws JMSException {\n\t\tActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(\"https://localhost\");\n\t\ttry {\n\t\t\tConnection connection = connectionFactory.createConnection();\n\t\t} catch (JMSException e) {\n\t\t\tif (e.getCause() instanceof IllegalStateException && \"Failure trying to create scheme registry\"\n\t\t\t\t\t.equals(e.getCause().getMessage()) && \"Port is invalid\".equals(e.getCause().getCause().getMessage())) {\n\t\t\t\tfail();\n\t\t\t}\n\t\t}\n\t}\n\n\t@Test\n\tpublic void https_broker_url_with_port_number() throws JMSException {\n\t\tActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(\"https://localhost:123\");\n\t\ttry {\n\t\t\tConnection connection = connectionFactory.createConnection();\n\t\t} catch (JMSException e) {\n\t\t\tif (e.getCause() instanceof IllegalStateException && \"Failure trying to create scheme registry\"\n\t\t\t\t\t.equals(e.getCause().getMessage()) && \"Port is invalid\".equals(e.getCause().getCause().getMessage())) {\n\t\t\t\tfail();\n\t\t\t}\n\t\t}\n\t}\n\n}\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harmen.renkema","name":"harmen.renkema","key":"harmen.renkema","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harmen Renkema","active":true,"timeZone":"Europe/Amsterdam"},"created":"2017-07-12T13:00:17.196+0000","updated":"2017-07-12T13:00:17.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13085975/comment/16083968","id":"16083968","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"All the transport types require and explicit port definition, this is by design as the user should be aware of what they are connecting to, none of the transport types assume a default port.  It's rather unlikely that an ActiveMQ broker will be sitting on the default HTTP port on most systems in any case.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2017-07-12T13:26:02.639+0000","updated":"2017-07-12T13:26:02.639+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6766/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3hbon:"}}