{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12726798","self":"https://issues.apache.org/jira/rest/api/2/issue/12726798","key":"AMQ-5274","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324951","id":"12324951","name":"5.11.0","archived":false,"released":true,"releaseDate":"2015-02-04"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-07-11T15:03:47.413+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Sep 12 09:20:00 UTC 2014","customfield_12310420":"404905","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_364738542_*|*_6_*:*_1_*:*_49386052_*|*_5_*:*_1_*:*_0_*|*_4_*:*_1_*:*_4970110694","customfield_12312321":null,"resolutiondate":"2014-09-11T20:25:54.198+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5274/watchers","watchCount":5,"isWatching":false},"created":"2014-07-11T12:48:38.950+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326455","id":"12326455","name":"5.9.1","archived":false,"released":true,"releaseDate":"2014-04-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[{"id":"12488820","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12488820","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13027334","key":"AMQ-6534","self":"https://issues.apache.org/jira/rest/api/2/issue/13027334","fields":{"summary":"QueueBrowser can view messages being processed by consumers which are not yet acknowledged","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-12-12T11:21:47.981+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The test case is a simple producer/consumer:\n\nProducer: 20 messages are injected, with a timeout of 10s.\n\nConsumer: The redelivery policy is set to 0 retries (the issue exists with other values). The consumer uses transactions and throws a runtime exception on each message received.\n\nqueue stats show 20 enqueue, 19 dequeue, 1 pending\n\nDLQ stat show 20 enqueue: all 20 messages go to DLQ, IDs ending in 1-10 for failing, 11-20 for expiry (approx)\n\nthe pending item (ID ending in 10) is a \"ghost message\" , and remains stuck indefinitely in queue.test\n\nif you browse, the message is not shown\n\nA) if you restart the broker, after a short while the message is cleaned:\n\njvm 1    |  WARN | Duplicate message add attempt rejected. Destination: QUEUE://ActiveMQ.DLQ, Message id: ID:REDACTED-52872-1405079629779-1:1:1:1:10\njvm 1    |  WARN | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@5b427f3c:ActiveMQ.DLQ,batchResetNeeded=false,storeHasMessages=true,size=0,cacheEnabled=true,maxBatchSize:20,hasSpace:tru\ne - cursor got duplicate: ID:REDACTED--52872-1405079629779-1:1:1:1:10, 4\njvm 1    |  WARN | duplicate message from store ID:REDACTED--52872-1405079629779-1:1:1:1:10, redirecting for dlq processing\n\n\nB) if you purge, ActiveMQ logs a warning: \"WARN | queue://queue.test after purge complete, message count stats report: 1\"\n\tthe queue is marked as being empty.\n\thowever if you restart the broker, the message re-appears shorty, before being cleaned as above\n\t\n\t\nSUPPLEMENTARY: with activeMQ 5.9.0 and above , if you run the injection several times, the CPU usage of ActiveMQ climbs drastically until the queue is purged.\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12655206","id":"12655206","filename":"AMQ-5274.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-11T12:50:29.911+0000","size":7031,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12655206/AMQ-5274.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12655826","id":"12655826","filename":"AMQ5274Test.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-07-15T18:07:29.353+0000","size":5741,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12655826/AMQ5274Test.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12664632","id":"12664632","filename":"AMQ-5274v2.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2014-08-27T12:33:56.657+0000","size":11265,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12664632/AMQ-5274v2.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12655210","id":"12655210","filename":"logs_extract.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-11T13:53:18.021+0000","size":3282,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12655210/logs_extract.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"404943","customfield_12312823":null,"summary":"Stuck messages and CPU churn when aborted transacted message expires","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"win64, RHEL11","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14058729","id":"14058729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"body":"test case and readme","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-11T12:50:29.918+0000","updated":"2014-07-11T12:50:29.918+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14058794","id":"14058794","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"body":"debug log file","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-11T13:53:18.028+0000","updated":"2014-07-11T13:53:18.028+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14058838","id":"14058838","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"body":"see attached log - this seems to be due to the \"sync with message expiry processing\" if clause in queuesubscription.acknowledge()\n\nit seems that if the message is expired it is not removed - but that the expiry doesn't remove it either","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-11T14:32:55.168+0000","updated":"2014-07-11T14:32:55.168+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14058864","id":"14058864","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"See if you can work out a JUnit test case that shows the issue, then when it's fixed the test will ensure that it remains fixed into the future. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-07-11T15:03:47.413+0000","updated":"2014-07-11T15:03:47.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14062419","id":"14062419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Attempted to create test to reproduce could not find any problems with this or the provided test against 5.11-SNAPSHOT.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-07-15T18:07:29.360+0000","updated":"2014-07-15T18:07:29.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14063257","id":"14063257","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"body":"Hi Tim,\n\nI just ran my test against apache-activemq-5.11-20140715.223633-34 on win64 , and I got exactly the same issue.\n\nThe test script prints that it rejects messages 1->10 (the others have already expired), and after it closes, when you go to:\n\nhttp://localhost:8161/admin/queues.jsp\n\nyou see:\n\nActiveMQ.DLQ\t20\t0\t20\t0\tBrowse Active Consumers\nActive Producers\n  \tSend To Purge Delete\nqueue.test\t1\t0\t20\t19\tBrowse Active Consumers\nActive Producers\n  \tSend To Purge Delete\n\nThere is one \"ghost\" message stuck in queue.test\n\nI will try integrating your junit and running that to see if I can reproduce with that, it will make things easier indeed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-16T07:50:43.528+0000","updated":"2014-07-16T07:50:43.528+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14076349","id":"14076349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"body":"OK, I found some time to integrate the junit test. It seems something in the config is wrong, because if I change the dlq statisfaction method to the following:\n\n      @Override\n      public boolean isSatisified() throws Exception {\n        long size = dlqView.getQueueSize();\n        LOG.info(\"DLQ Size: {}\", size);\n        if (size == 20) {\n          for (Object O : dlqView.browseMessages()) {\n            LOG.info(((ActiveMQTextMessage) O).toString());\n          }\n          return true;\n        }\n        return false;\n      }\n\nI notice that all the messages have dlqDeliveryFailureCause=expired , which should only be the case for the untreated messages. The others should have session rollback/abort as the fail reason.\n\nI will try to see what we are missing","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-28T16:25:26.526+0000","updated":"2014-07-28T16:25:26.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14109150","id":"14109150","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"body":"Also reproduced with jboss-a-mq-6.1.0.redhat-379 , the only difference to the maven test case is adding the configured user/pass in the connection factory defined in context-jms.xml","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-25T14:36:37.129+0000","updated":"2014-08-25T14:36:37.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14112193","id":"14112193","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"body":"Uploading a modified version AMQ-5274v2.zip that runs a JUnit test. Simply run mvn test to reproduce the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2014-08-27T12:23:15.953+0000","updated":"2014-08-27T12:23:54.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14130650","id":"14130650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"fix in https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=commit;h=26807cd4\n\ninflight messages are not expired by the broker side background periodic check. In this way, acks do not compete with expiry.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-11T20:25:54.227+0000","updated":"2014-09-11T20:25:54.227+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12726798/comment/14131318","id":"14131318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"body":"Validated the fix on last night's snapshot! Thanks Gary","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yannick.malins","name":"yannick.malins","key":"yannick.malins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yannick Malins","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-12T09:20:00.588+0000","updated":"2014-09-12T09:20:00.588+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5274/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1xonb:"}}