{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482192","self":"https://issues.apache.org/jira/rest/api/2/issue/12482192","key":"AMQ-2857","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315624","id":"12315624","description":"Maintenance release for 5.4.0","name":"5.4.1","archived":false,"released":true,"releaseDate":"2010-09-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-08-13T10:24:11.721+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 13 19:34:53 UTC 2010","customfield_12310420":"74775","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_936346946_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-08-13T10:24:11.800+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2857/watchers","watchCount":1,"isWatching":false},"created":"2010-08-02T14:18:24.854+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-08-13T19:34:53.931+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Running an embedded ActiveMQ database, using MySQL as the JDBC data source worked fine under MySQL 5.4.  After upgrading to MySQL 5.5.5, ActiveMQ works fine as long as the three required tables in the activemq database already exist (activemq_acks, activemq_lock, activemq_msgs).  However, if they don't exist, it fails to create the tables, whereas the tables would be automatically created under MySQL 5.4.\n\nThe problem appears to be in the create table script that's used.  In previous versions of MySQL, it was legal (though deprecated as of 4.1) to specify the engine using the \"TYPE=INNODB\" syntax.  The preferred non-deprecated way to do it was to use \"ENGINE=INNODB\" instead.  Under 5.5.5, it appears that the \"TYPE\" syntax is now completely illegal, requiring use of the \"ENGINE\" syntax instead.\n\nA relevant MySQL bug discussing the issue: http://bugs.mysql.com/bug.php?id=17501\n\nThe following is an example of the actual SQL that is generated by ActiveMQ:\n\nCREATE TABLE ACTIVEMQ_MSGS(ID BIGINT NOT NULL, CONTAINER VARCHAR(250),\nMSGID_PROD VARCHAR(250), MSGID_SEQ BIGINT, EXPIRATION BIGINT, MSG LONGBLOB, PRIMARY KEY ( ID ) ) TYPE=INNODB\n\nI have not yet tested it, but it seems likely that the culprit is MySqlJDBCAdapter.java.  It includes the line:\n\nString typeClause = \" TYPE=\"+type;\n\nwhich should probably change to\n\nString typeClause = \" ENGINE=\"+type;","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461796","id":"12461796","filename":"mysqlpatch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matthewj","name":"matthewj","key":"matthewj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew J.","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-12T22:19:20.790+0000","size":900,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461796/mysqlpatch.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"159784","customfield_12312823":null,"summary":"ActiveMQ fails to create tables in MySQL 5.5.5","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matthewj","name":"matthewj","key":"matthewj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew J.","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matthewj","name":"matthewj","key":"matthewj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew J.","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"MySQL 5.5.5","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482192/comment/12938795","id":"12938795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matthewj","name":"matthewj","key":"matthewj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew J.","active":true,"timeZone":"Etc/UTC"},"body":"Attaching patch file which fixes MySqlJDBCAdapter.java.  Tested this locally, and it did appear to fix the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matthewj","name":"matthewj","key":"matthewj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew J.","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-12T22:19:20.857+0000","updated":"2010-08-12T22:19:20.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482192/comment/12938901","id":"12938901","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"variant of patch applied in r985151\nadded typeStatement attribute to make this configurable for backwards compatibility, default to new ENGINE statement so it will work out of the box with MySQL 5.5\nTanks for the patch. Would be great if you could validate a 5.5 snapshot over the next few days.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-13T10:24:11.721+0000","updated":"2010-08-13T10:24:11.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482192/comment/12939042","id":"12939042","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matthewj","name":"matthewj","key":"matthewj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew J.","active":true,"timeZone":"Etc/UTC"},"body":"Downloaded the latest snapshot, and it does appear to be working correctly for me.\n\nOne thing I noticed in the class was that the \"ENGINE\" string is still being used directly when using NDBCLUSTER:\n\n{code}           \nl.add(\"ALTER TABLE \"+statements.getFullMessageTableName()+\" ENGINE=\"+NDBCLUSTER);\nl.add(\"ALTER TABLE \"+statements.getFullAckTableName()+\" ENGINE=\"+NDBCLUSTER);\nl.add(\"ALTER TABLE \"+statements.getFullLockTableName()+\" ENGINE=\"+NDBCLUSTER);\n{code}\n\nIt looks like NDBCLUSTER was added in MySQL 5.x, so the ENGINE statement will always be correct in the MySQL versions that support it.    It just looks strange that we're using the \"typeStatement\" variable in some cases but not in others.  Would it be worth changing these lines as well merely for the sake of consistency?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matthewj","name":"matthewj","key":"matthewj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew J.","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-13T19:34:53.887+0000","updated":"2010-08-13T19:34:53.887+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2857/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rpjz:"}}