{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12527106","self":"https://issues.apache.org/jira/rest/api/2/issue/12527106","key":"AMQ-3543","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-10-14T20:54:10.802+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 14 21:46:50 UTC 2011","customfield_12310420":"85477","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_83506341_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-10-14T20:54:10.762+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3543/watchers","watchCount":1,"isWatching":false},"created":"2011-10-13T21:42:24.480+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316331","id":"12316331","description":"Next unplanned v5 maintenance release","name":"5.x","archived":false,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-10-14T21:46:50.806+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315706","id":"12315706","name":"stomp"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The reply-to header on a MESSAGE frame resulting from the sending of a message (SEND) with the reply-to header set to a temporary topic is in the form /temp-topic/<local-temp-topic-name> rather than the expected \n/remote-temp-topic/<system_generated_name>\n\nThis only happens when the same connection is used for sending and receiving messages. When a temporary queue is used, the reply-to appears as /remote-temp-queue/xxx as expected. So even if one takes the position that it is reasonable for the local name to be used given that everything is on the same connection, there is an inconsistency between the topic and queue cases. For our purposes we would prefer that the remote form be used always, because we are actually servicing two different users on the same connection (first user does the SEND, second user receives the MESSAGE).\n\nTest case for the underlying ActiveMQ bug is attached: StompRemoteTempTopic.java\n\nTo reproduce, drop this file into $ACTIVEMQ_HOME/example/src, edit build.xml in the example\ndirectory to add the following:\n\n<target name=\"bug\" depends=\"compile\" description=\"Runs test case for replyTo TempTopic bug\">\n<echo>Running a Stomp example</echo>\n<java classname=\"StompRemoteTempTopic\" fork=\"yes\" maxmemory=\"100M\">\n<classpath refid=\"javac.classpath\" />\n<jvmarg value=\"-server\" />\n</java>\n</target>\n\nand run by issuing the command \"ant bug\". Output is as follows:\n\n[echo] Running a Stomp example\n[java] =====================================================\n[java] Test run using temporary topic\n[java] -----------------------------------------------------\n[java] Sending request message: SEND with reply-to=/temp-topic/2C26441740C0ECC9tt1\n[java] Received request message: MESSAGE with reply-to=/temp-topic/2C26441740C0ECC9tt1\n[java] Response MESSAGE received\n[java] =====================================================\n[java] Test run using temporary queue\n[java] -----------------------------------------------------\n[java] Sending request message: SEND with reply-to=/temp-queue/2C26441740C0ECC9tt1\n[java] Received request message: MESSAGE with reply-to=/remote-temp-queue/ID:ChrisBarrow-lap-61815-1318539910206-4:6:1\n[java] Response MESSAGE received\n\nThis makes it easy to see that for the queue case the reply-to is set to the remote temporary queue but for the topic case the local temporary topic is specified.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12498936","id":"12498936","filename":"StompRemoteTempTopic.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.barrow","name":"chris.barrow","key":"chris.barrow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Barrow","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-13T21:46:42.084+0000","size":4374,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12498936/StompRemoteTempTopic.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59304","customfield_12312823":null,"summary":"STOMP connector: unexpected reply-to value for remote temporary topic","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.barrow","name":"chris.barrow","key":"chris.barrow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Barrow","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.barrow","name":"chris.barrow","key":"chris.barrow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Barrow","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527106/comment/13127853","id":"13127853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Fix applied in trunk, the reply-to destinations will be set to the same as what was given in the original message.  The remote names shouldn't leak from the Stomp transport.  Test case added.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-10-14T20:54:10.802+0000","updated":"2011-10-14T20:54:10.802+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527106/comment/13127876","id":"13127876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.barrow","name":"chris.barrow","key":"chris.barrow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Barrow","active":true,"timeZone":"Etc/UTC"},"body":"Wow, thanks for such a quick response! Just want to check my understanding of your fix. Does it mean the received MESSAGE with reply-to ( received as a result of the SEND) will now have reply-to = '/temp-queue/...' or '/temp-topic/...'? \n\nWhat about the case where two connections are used (one connection owns the temporary destination and emits the SEND with reply-to, a second connection receives the MESSAGE). Presumably in that case the reply-to would have to be '/remote-temp-queue/...' or '/remote-temp-topic/...' since the temporary destination actually belongs to the other connection?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.barrow","name":"chris.barrow","key":"chris.barrow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Barrow","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-14T21:34:43.174+0000","updated":"2011-10-14T21:35:35.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527106/comment/13127892","id":"13127892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"From the client side the replyTo destination's parent connection should be opaque, so all connections would receive the same /temp-topic/ or /temp-queue/ values.  Its up to your clients to ensure that the name's of the temp destinations that they create are unique, using a UUID for instance.  The remote prefix is used internally by amq to match up its own destination structures and shouldn't have been leaking out of the Stomp transport.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-10-14T21:46:50.753+0000","updated":"2011-10-14T21:46:50.753+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3543/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0aipj:"}}