{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483901","self":"https://issues.apache.org/jira/rest/api/2/issue/12483901","key":"AMQ-2446","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-10-09T11:49:34.571+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 20 20:30:23 UTC 2012","customfield_12310420":"74942","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_60090196_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-10-09T16:30:58.496+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2446/watchers","watchCount":2,"isWatching":false},"created":"2009-10-08T23:49:28.300+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-20T20:30:23.922+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Start ActiveMQ\n\ncreate a message consumer and make a receive(30000) call for example.\n\nstop ActiveMQ (CTRL-C)\n\nThere is an error reported on the console:\n\n2009-10-08 19:23:54,978 [ActiveMQ Transport: tcp://localhost/127.0.0.1:61616] DEBUG org.apache.activemq.ActiveMQConnection - Async exception with no exception listener: java.io.EOFException\njava.io.EOFException\n\tat java.io.DataInputStream.readInt(DataInputStream.java:358)\n\tat org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:269)\n\tat org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:210)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:202)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)\n\tat java.lang.Thread.run(Thread.java:595)\n2009-10-08 19:23:54,978 [ActiveMQ Connection Worker: tcp://localhost/127.0.0.1:61616] DEBUG org.apache.activemq.transport.tcp.TcpTransport - Stopping transport tcp://localhost/127.0.0.1:61616\n\nThe thread making the receive call is waiting on a mutex that the ActiveMQ Connection Worker thread that reported that log has (I guess):\n\nclass MessageDispatchChannel\n    public MessageDispatch dequeue(long timeout) throws InterruptedException {\n        synchronized (mutex) {\n            // Wait until the consumer is ready to deliver messages.\n            while (timeout != 0 && !closed && (list.isEmpty() || !running)) {\n                if (timeout == -1) {\n                    mutex.wait(); <-----------------------------------------------------------\n                } else {\n                    mutex.wait(timeout);\n                    break;\n                }\n            }\n            if (closed || !running || list.isEmpty()) {\n                return null;\n            }\n            return list.removeFirst();\n        }\n    }\n\nWhat is also strange to me is that my timeout of 30000 ms is silently converted to an infinite timeout if the preFetchSize == 0 by this code? Why?\n\nclass ActiveMQMessageConsumer\n...\n            MessageDispatch md;\n            if (info.getPrefetchSize() == 0) {\n                md = dequeue(-1); // We let the broker let us know when we\n                // timeout.\n            } else {\n                md = dequeue(timeout);\n            }\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461326","id":"12461326","filename":"AMQ2446Test.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T16:29:06.500+0000","size":3044,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461326/AMQ2446Test.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461325","id":"12461325","filename":"AMQ-2446-Test.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T16:18:32.109+0000","size":1645,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461325/AMQ-2446-Test.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"252258","customfield_12312823":null,"summary":"Client hangs on receive call with timeout value > 0 when activemq is shutdown (CTRL-C)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP SP3, ActiveMQ 5.2, prefetchSize=0 (java.naming.provider.url = tcp://localhost:61616?jms.prefetchPolicy.queuePrefetch=0)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/12941477","id":"12941477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"I think this may be linked to https://issues.apache.org/activemq/browse/AMQ-2044.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T00:05:41.580+0000","updated":"2009-10-09T00:05:41.580+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/12941626","id":"12941626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"would it be possible to run your test case against the current 5.3 release candidate to see if it is resolved. Details of where to find the kits are in the current vote message to the dev list: see: http://www.nabble.com/-VOTE--Apache-ActiveMQ-5.3.0-RC4-ts25802076.html\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T11:49:34.571+0000","updated":"2009-10-09T11:49:34.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/12941685","id":"12941685","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Hi. I D/L 5.3 RC4 from the link above. I took my application, added the activemq-all-5.3.0.jar jar in my classpath (before other jars) and I still have the same problem (client hangs). I can't vote for a 5.3 RC4 without this being fixed ;-). It is just normal that sometimes, the broker has to be stopped and clients should really not hang like that.\n\nIn the mean time, I redesigned portions of my app to use receiveNoWait() + my own thread sleeping logic (more latency though on new messages added to an empty queue of course) instead of receive(timeout) and with that, event with the 5.2 version, I get some exceptions that I can use to recover lost connections, and still use the prefetchSize=0 option on my connection URL.\n\nStill, we have an integration component using Camel on top of ActiveMQ, and for that one, there is not much I can do.\n\nThanks.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T14:23:38.765+0000","updated":"2009-10-09T14:23:38.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/12941715","id":"12941715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Contains an Eclipse 3.3 project.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T16:18:32.221+0000","updated":"2009-10-09T16:18:32.221+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/12941712","id":"12941712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Good news! I wrote down the simplest test case I could come with:\n\nimport java.util.Properties;\n\nimport javax.jms.Connection;\nimport javax.jms.ConnectionFactory;\nimport javax.jms.Destination;\nimport javax.jms.MessageConsumer;\nimport javax.jms.Session;\nimport javax.naming.Context;\nimport javax.naming.InitialContext;\n\npublic class TestActiveMQShutdown {\n\n    /**\n     * Start ActiveMQ on default port\n     * Run the main program, it will make a receive with a timeout of 30 seconds\n     * During that time, shutdown ActiveMQ.  \n     * The system.out below will never happen and you will need to kill the java process\n     */\n    public static void main(String[] args) throws Exception {\n\n        Properties props = new Properties();\n        props.put(Context.INITIAL_CONTEXT_FACTORY, \"org.apache.activemq.jndi.ActiveMQInitialContextFactory\");\n        // Please not the prefetch policy here\n        props.put(Context.PROVIDER_URL, \"tcp://localhost:61616?jms.prefetchPolicy.queuePrefetch=0\");\n        props.put(\"queue.test1\", \"test1.q\");\n\n        InitialContext initialContext = new javax.naming.InitialContext(props);\n\n        ConnectionFactory connectionFactory = (ConnectionFactory) initialContext.lookup(\"ConnectionFactory\");\n\n        Connection connection = (Connection) connectionFactory.createConnection();\n\n        Session session = connection.createSession(true, Session.AUTO_ACKNOWLEDGE);\n\n        Destination destination = (Destination) initialContext.lookup(\"test1\");\n\n        MessageConsumer messageConsumer = session.createConsumer(destination);\n\n        messageConsumer.receive(30000);\n\n        System.out.println(\"Will never get there if ActiveMQ is shutdown while we were in the receive call above\");\n\n        // I don't care about closing all resources in that test and about the message received\n\n    }\n\n}\n\nAnd with that, I can reproduce the problem in 5.2 (using activemq-all-5.2.0.jar) , but not in 5.3 (using activemq-all-5.3.0.jar). I used jms-1.1.jar in both cases.\n\nI must have made a mistake or something with my full application when I tried to modify. If you guys can confirm that my test case works for you too, reproducing the problem in 5.2 and seeing 5.3 fixes it, the we could all vote for 5.3 RC4!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T16:22:09.717+0000","updated":"2009-10-09T16:22:09.717+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/12941714","id":"12941714","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"body":"Of course, when using activemq-all-5.2.0.jar, I was running ActiveMQ 5.2 server and when using activemq-all-5.3.0.jar, I was running 5.3.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=callain_conceptum","name":"callain_conceptum","key":"callain_conceptum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Allain","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T16:22:57.840+0000","updated":"2009-10-09T16:22:57.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/12941717","id":"12941717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"junit tests case that demos that this works with trunk and hence 5.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T16:29:06.565+0000","updated":"2009-10-09T16:29:06.565+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/12941711","id":"12941711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"glad to see we both came to the same conclusion :-) I had just run my junit tests case that worked fine against trunk. thanks,","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-09T16:30:58.381+0000","updated":"2009-10-09T16:30:58.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/12943239","id":"12943239","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alisenberg","name":"alisenberg","key":"alisenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Lisenberg","active":true,"timeZone":"Etc/UTC"},"body":"Hi, I am using 5.4.1 and still have the same situation. I use prefetch=0, failover and connection pool. \n\nSometimes when I call receive(1000), the consumer hangs at this line:\n\norg.apache.activemq.SimplePriorityMessageDispatchChannel.dequeue(SimplePriorityMessageDispatchChannel.java:87)\norg.apache.activemq.ActiveMQMessageConsumer.dequeue(ActiveMQMessageConsumer.java:452)\n\nIt's very difficult to reproduce with a test case.\n\nthanks,\nadrian","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alisenberg","name":"alisenberg","key":"alisenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Lisenberg","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-23T03:01:27.930+0000","updated":"2010-11-23T03:01:27.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483901/comment/13419534","id":"13419534","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ll121555","name":"ll121555","key":"ll121555","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lucy Loftin","active":true,"timeZone":"America/Los_Angeles"},"body":"I wanted to add that we are using 5.6.0 and hit this hang also using prefetch=0, failoverTransport and Spring CachingConnectionFactory with a DMLC consumer.  We aren't sure where in the process the disconnect happens, but after killing the broker, some (but not ALL) of our consumers hung on this wait.  Looking at the Java thread dump, they were on the mutex.wait() call that is mentioned in this JIRA.\n\nWe were doing failover testing for our clustered solution hence the reason for stopping the broker during testing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ll121555","name":"ll121555","key":"ll121555","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lucy Loftin","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-07-20T20:30:23.772+0000","updated":"2012-07-20T20:30:23.772+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2446/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i17kav:"}}