{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12671230","self":"https://issues.apache.org/jira/rest/api/2/issue/12671230","key":"AMQ-4753","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-09-29T14:06:46.336+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 09 15:13:21 UTC 2013","customfield_12310420":"350936","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_918307422_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-10-09T15:13:21.155+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4753/watchers","watchCount":4,"isWatching":false},"created":"2013-09-29T00:08:13.762+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["amqp","nio","ssl"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-09-25T07:46:00.766+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Start with a client application running qpid v0.24 connecting to activemq v5.8.0 server over amqps. Configure the activemq server to use client SSL certificates for authentication.\n\n{code}\n                <!-- aqmp with SSL client certs -->\n         <transportConnector name=\"amqps\" uri=\"amqp+ssl://0.0.0.0:5672?maximumConnections=1000&amp;wireformat.maxFrameSize=104857600&amp;transport.transformer=jms&amp;needClientAuth=true\"/>\n{code}\n\nThis works and messages successfully flow from server to client. Qpid however has a fatal bug where it cannot recover from broken connections, and so attempt to switch to the activemq amqp client to work around this problem.\n\nOn the client, we initialise activemq-amqp with the following parameters:\n\n{code}\n<!-- activemq -->\n  <Parameter name=\"java.naming.factory.initial\" value=\"org.apache.activemq.jndi.ActiveMQInitialContextFactory\" />\n  <Parameter name=\"connectionFactoryNames\" value=\"ConnectionFactory, QueueConnectionFactory, TopicConnectionFactory\" />\n\n  <!-- Server to connect to -->\n<!-- activemq -->\n  <Parameter name=\"java.naming.provider.url\" value=\"amqp+nio+ssl://amqp.${env:SERVER_ENV}.example.com:5672\" />\n{code}\n\nWith activemq-amqp in place instead of qpid, the client starts up, but no messages are processed. Instead, it is found that the aqmp+nio+ssl provider is spinning the CPU at 100% part of the way through the SSL handshake process.\n\nA thread dump of the spinning thread is as follows:\n\n{code}\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (23.25-b01 mixed mode):\n\n\"localhost-startStop-1\" daemon prio=10 tid=0x000000000179b800 nid=0x638e runnable [0x00007fd1fd84a000]\n   java.lang.Thread.State: RUNNABLE\n        at sun.nio.ch.FileDispatcherImpl.read0(Native Method)\n        at sun.nio.ch.SocketDispatcher.read(SocketDispatcher.java:39)\n        at sun.nio.ch.IOUtil.readIntoNativeBuffer(IOUtil.java:225)\n        at sun.nio.ch.IOUtil.read(IOUtil.java:198)\n        at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:375)\n        - locked <0x00000000c4da50e8> (a java.lang.Object)\n        at org.apache.activemq.transport.nio.NIOSSLTransport.secureRead(NIOSSLTransport.java:285)\n        at org.apache.activemq.transport.nio.NIOSSLTransport.doHandshake(NIOSSLTransport.java:333)\n        at org.apache.activemq.transport.nio.NIOSSLTransport.initializeStreams(NIOSSLTransport.java:128)\n        at org.apache.activemq.transport.amqp.AmqpNioSslTransport.initializeStreams(AmqpNioSslTransport.java:43)\n        at org.apache.activemq.transport.tcp.TcpTransport.connect(TcpTransport.java:514)\n        at org.apache.activemq.transport.nio.NIOTransport.doStart(NIOTransport.java:156)\n        at org.apache.activemq.transport.nio.NIOSSLTransport.doStart(NIOSSLTransport.java:356)\n        at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\n        at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:273)\n        at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:238)\n        at org.apache.activemq.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:184)\n...\n{code}\n\nIf an attempt is made to restart the activemq server, despite the spinning thread on the client the server side disconnection is detected by the client and the following exception is logged and the connection is successfully aborted:\n\n{code}\nCaused by: java.io.IOException: javax.net.ssl.SSLException: Received close_notify during handshake\n        at org.apache.activemq.transport.nio.NIOSSLTransport.initializeStreams(NIOSSLTransport.java:130)\n        at org.apache.activemq.transport.amqp.AmqpNioSslTransport.initializeStreams(AmqpNioSslTransport.java:43)\n        at org.apache.activemq.transport.tcp.TcpTransport.connect(TcpTransport.java:514)\n        at org.apache.activemq.transport.nio.NIOTransport.doStart(NIOTransport.java:156)\n        at org.apache.activemq.transport.nio.NIOSSLTransport.doStart(NIOSSLTransport.java:356)\n        at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\n        at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:273)\n        ... 33 more\nCaused by: javax.net.ssl.SSLException: Received close_notify during handshake\n        at sun.security.ssl.Alerts.getSSLException(Alerts.java:208)\n        at sun.security.ssl.SSLEngineImpl.fatal(SSLEngineImpl.java:1619)\n        at sun.security.ssl.SSLEngineImpl.fatal(SSLEngineImpl.java:1587)\n        at sun.security.ssl.SSLEngineImpl.recvAlert(SSLEngineImpl.java:1732)\n        at sun.security.ssl.SSLEngineImpl.readRecord(SSLEngineImpl.java:1060)\n        at sun.security.ssl.SSLEngineImpl.readNetRecord(SSLEngineImpl.java:884)\n        at sun.security.ssl.SSLEngineImpl.unwrap(SSLEngineImpl.java:758)\n        at javax.net.ssl.SSLEngine.unwrap(SSLEngine.java:624)\n        at org.apache.activemq.transport.nio.NIOSSLTransport.secureRead(NIOSSLTransport.java:304)\n        at org.apache.activemq.transport.nio.NIOSSLTransport.doHandshake(NIOSSLTransport.java:333)\n        at org.apache.activemq.transport.nio.NIOSSLTransport.initializeStreams(NIOSSLTransport.java:128)\n        ... 42 more\n{code}\n\nWhat seems to be happening is that amqp+nio+ssl gets part of the way through the handshake fails and goes into a spin, continuing the spin until the TCP connection is killed from the other side, at which point the client aborts and continues as if nothing had happened.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12606287","id":"12606287","filename":"AMQ-4753.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"created":"2013-10-02T13:29:41.032+0000","size":7188,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12606287/AMQ-4753.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12607547","id":"12607547","filename":"AMQ-4753Joram.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"created":"2013-10-09T12:31:12.934+0000","size":10112,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12607547/AMQ-4753Joram.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"351227","customfield_12312823":null,"summary":"amqp+nio+ssl: infinite loop during inital handshake with SSL + client certs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=minfrin","name":"minfrin","key":"minfrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Graham Leggett","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=minfrin","name":"minfrin","key":"minfrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Graham Leggett","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"java version \"1.7.0_25\"\nJava(TM) SE Runtime Environment (build 1.7.0_25-b15)\nJava HotSpot(TM) 64-Bit Server VM (build 23.25-b01, mixed mode)\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12671230/comment/13781380","id":"13781380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Did you try a 5.9 SNAPSHOT?  There are many AMQP fixes in there so testing on 5.8 at this point doesn't really tell us if its really an issue any more.  Provide a unit test if you want us to look at it.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-09-29T14:06:46.336+0000","updated":"2013-09-29T14:06:46.336+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12671230/comment/13781533","id":"13781533","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=minfrin","name":"minfrin","key":"minfrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Graham Leggett","active":true,"timeZone":"Etc/UTC"},"body":"I just tried to build 5.9-SNAPSHOT, but the build is currently broken using a completely fresh repository:\n\n{code}\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary:\n[INFO] \n[INFO] ActiveMQ .......................................... SUCCESS [16.037s]\n[INFO] ActiveMQ :: Openwire Generator .................... SUCCESS [20.278s]\n[INFO] ActiveMQ :: Client ................................ SUCCESS [54.251s]\n[INFO] ActiveMQ :: Openwire Legacy Support ............... SUCCESS [9.361s]\n[INFO] ActiveMQ :: JAAS .................................. SUCCESS [23.332s]\n[INFO] ActiveMQ :: Broker ................................ SUCCESS [18.701s]\n[INFO] ActiveMQ :: KahaDB Store .......................... SUCCESS [11.139s]\n[INFO] ActiveMQ :: STOMP Protocol ........................ SUCCESS [2.583s]\n[INFO] ActiveMQ :: MQTT Protocol ......................... SUCCESS [34.112s]\n[INFO] ActiveMQ :: JDBC Store ............................ SUCCESS [13.440s]\n[INFO] ActiveMQ :: LevelDB Store ......................... SUCCESS [6:16.778s]\n[INFO] ActiveMQ :: RA .................................... SUCCESS [28.812s]\n[INFO] ActiveMQ :: Pool .................................. SUCCESS [11.768s]\n[INFO] ActiveMQ :: Spring ................................ SUCCESS [2:15.342s]\n[INFO] ActiveMQ :: AMQP .................................. SUCCESS [31.109s]\n[INFO] ActiveMQ :: Console ............................... SUCCESS [13.578s]\n[INFO] ActiveMQ :: Unit Tests ............................ SUCCESS [34.303s]\n[INFO] ActiveMQ :: Camel ................................. FAILURE [54.012s]\n[INFO] ActiveMQ :: HTTP Protocol Support ................. SKIPPED\n[INFO] ActiveMQ :: All JAR bundle ........................ SKIPPED\n[INFO] ActiveMQ :: File Server ........................... SKIPPED\n[INFO] ActiveMQ :: Log4j Appender ........................ SKIPPED\n[INFO] ActiveMQ :: Apache Karaf .......................... SKIPPED\n[INFO] ActiveMQ :: RAR ................................... SKIPPED\n[INFO] ActiveMQ :: Run Jar ............................... SKIPPED\n[INFO] ActiveMQ :: Runtime Configuration ................. SKIPPED\n[INFO] ActiveMQ :: Tooling ............................... SKIPPED\n[INFO] ActiveMQ :: Memory Usage Test Plugin .............. SKIPPED\n[INFO] ActiveMQ :: Performance Test Plugin ............... SKIPPED\n[INFO] ActiveMQ :: StartUp Plugin ........................ SKIPPED\n[INFO] ActiveMQ :: Web ................................... SKIPPED\n[INFO] ActiveMQ :: OSGi bundle ........................... SKIPPED\n[INFO] ActiveMQ :: Blueprint ............................. SKIPPED\n[INFO] ActiveMQ :: Web Demo .............................. SKIPPED\n[INFO] ActiveMQ :: Web Console ........................... SKIPPED\n[INFO] ActiveMQ :: Karaf Integration Tests ............... SKIPPED\n[INFO] ActiveMQ :: Integration Test :: Spring 3.1 ........ SKIPPED\n[INFO] ActiveMQ :: Assembly .............................. SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 15:03.987s\n[INFO] Finished at: Sun Sep 29 15:39:32 GMT+00:00 2013\n[INFO] Final Memory: 98M/235M\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal on project activemq-camel: Could not resolve dependencies for project org.apache.activemq:activemq-camel:bundle:5.9-SNAPSHOT: Could not find artifact org.apache.activemq:activemq-unit-tests:jar:tests:5.9-SNAPSHOT in com.fusesource.m2.snapshot (http://repo.fusesource.com/nexus/content/repositories/snapshots/) -> [Help 1]\n{code}\n\nIt looks like the activemq-unit-tests project is build without a classifier, but the dependency above requires the classifier:\n\n{code}\n[minfrin@localhost activemq]$ pushd ~/.m2/repository/org/apache/activemq/activemq-unit-tests/5.9-SNAPSHOT/ \n[minfrin@localhost 5.9-SNAPSHOT]$ ls -al\ntotal 100\ndrwxrwxr-x 2 minfrin minfrin  4096 Sep 29 16:39 .\ndrwxrwxr-x 3 minfrin minfrin  4096 Sep 29 15:38 ..\n-rw-rw-r-- 1 minfrin minfrin   210 Sep 29 16:38 _maven.repositories\n-rw-rw-r-- 1 minfrin minfrin   412 Sep 29 16:39 activemq-unit-tests-5.9-SNAPSHOT-tests.jar.lastUpdated\n-rw-rw-r-- 1 minfrin minfrin 17159 Sep 29 16:38 activemq-unit-tests-5.9-SNAPSHOT.jar\n-rw-rw-r-- 1 minfrin minfrin 59725 Sep 29 13:23 activemq-unit-tests-5.9-SNAPSHOT.pom\n-rw-rw-r-- 1 minfrin minfrin   718 Sep 29 16:38 maven-metadata-local.xml\n{code}\n\nIt seems the current build is relying on stale SNAPSHOT jars in order to build successfully.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=minfrin","name":"minfrin","key":"minfrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Graham Leggett","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-29T23:44:32.291+0000","updated":"2013-09-29T23:44:32.291+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12671230/comment/13781548","id":"13781548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=minfrin","name":"minfrin","key":"minfrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Graham Leggett","active":true,"timeZone":"Etc/UTC"},"body":"Commenting out the activemq-camel module allows the build to get far enough to build the activemq-amqp module, and this is enough to swap the jar in and test. From this I found that there was no difference in behaviour, NIO still spins at 100% as before.\n\nLooking closer in the code, I am not seeing any kind of clear mechanism to switch from a read to a write, or a write to a read during the handshake, as required by the SSL protocol. I suspect this lack of support is causing the spin as an attempt is made to read when SSL wants us to write instead. I am going to have to get this code up onto a debugger first to see what it is doing in detail.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=minfrin","name":"minfrin","key":"minfrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Graham Leggett","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-30T00:24:40.473+0000","updated":"2013-09-30T00:24:40.473+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12671230/comment/13783918","id":"13783918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"body":"Here's a unit test which should reproduce this.  (Note the test hangs using qpid 0.22, I haven't tried it with 0.24 yet)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"created":"2013-10-02T13:29:41.036+0000","updated":"2013-10-02T13:29:41.036+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12671230/comment/13789661","id":"13789661","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"From a brief glance it looks as though the NIOSSL AMQP Transport is not complete, it appears to be passing a raw ByteBuffer onto the protocol converter before processing it into an AMQPHeader so an IllegalStateException is being thrown. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-10-08T20:33:07.766+0000","updated":"2013-10-08T20:33:07.766+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12671230/comment/13789753","id":"13789753","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Submitted a patch to the AmqpNIOSSLTransport to get things working a bit better.  There's still no real tests there for this one so wouldn't count on this being a complete fix but it gets past the initial protocol discriminator phase and starts passing down proper Buffers to the protocol converter.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-10-08T21:55:30.295+0000","updated":"2013-10-08T21:55:30.295+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12671230/comment/13790298","id":"13790298","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"body":"This runs the JoramJmsTests with amqp+nio+ssl\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"created":"2013-10-09T12:31:12.937+0000","updated":"2013-10-09T12:31:12.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12671230/comment/13790447","id":"13790447","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Test patch applied with thanks.  Tests are passing.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-10-09T15:13:21.176+0000","updated":"2013-10-09T15:13:21.176+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4753/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1oiav:"}}