{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13144635","self":"https://issues.apache.org/jira/rest/api/2/issue/13144635","key":"AMQ-6926","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2018-03-13T11:36:42.229+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 13 13:55:14 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_26817007_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-03-13T14:09:24.022+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6926/watchers","watchCount":2,"isWatching":false},"created":"2018-03-13T06:42:27.037+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341947","id":"12341947","name":"5.15.3","archived":false,"released":true,"releaseDate":"2018-02-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-03-13T14:09:24.041+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12324803","id":"12324803","name":"JDBC"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We are using ActiveMQ 5.15.3 with Wildfly 10.1.0.\r\n\r\nActiveMQ was integrated as resource adapter as \r\ninstructed here: \r\n\r\n[http://www.mastertheboss.com/jboss-server/jboss-jms/integrate-activemq-with-wildfly]\r\n\r\nIn general it is working fine, but we have found an issue with JDBC \r\npersistence. \r\n\r\nIf the password of our db user is wrong, wildfly logs that error, but \r\ndeployment of active.rar succeed and afterwards it is using KahaDB. So \r\nnobody will recognize, that messages gets persisted to file system instead \r\nof database.\r\n\r\nThe issue only occurs, if the VM connector is used.\r\n\r\nResource adapter was configured as follows:\r\n\r\n \r\n{code:java}\r\n        <subsystem xmlns=\"urn:jboss:domain:resource-adapters:4.0\">\r\n            <resource-adapters>\r\n                <resource-adapter id=\"activemq\">\r\n                    <archive>\r\n                        activemq.rar\r\n                    </archive>\r\n                    <transaction-support>XATransaction</transaction-support>\r\n                    <config-property name=\"ServerUrl\">\r\n                        vm://localhost\r\n                    </config-property>\r\n                    <config-property name=\"UserName\">\r\n                        admin\r\n                    </config-property>\r\n                    <config-property name=\"UseInboundSession\">\r\n                        false\r\n                    </config-property>\r\n                    <config-property name=\"BrokerXmlConfig\">\r\n                        xbean:broker-config.xml\r\n                    </config-property>\r\n                    <config-property name=\"Password\">\r\n                        xxxxx\r\n                    </config-property>\r\n                    <connection-definitions>\r\n                        <connection-definition class-name=\"org.apache.activemq.ra.ActiveMQManagedConnectionFactory\" jndi-name=\"java:/JmsXA\" enabled=\"true\" pool-name=\"ConnectionFactory\">\r\n                            <xa-pool>\r\n                                <min-pool-size>1</min-pool-size>\r\n                                <max-pool-size>20</max-pool-size>\r\n                                <prefill>false</prefill>\r\n                                <is-same-rm-override>false</is-same-rm-override>\r\n                            </xa-pool>\r\n                            <recovery no-recovery=\"false\">\r\n                                <recover-credential>\r\n                                    <user-name>recovery-user</user-name>\r\n                                    <password>secret</password>\r\n                                </recover-credential>\r\n                            </recovery>\r\n                        </connection-definition>\r\n                    </connection-definitions>\r\n                    <admin-objects>\r\n                        <admin-object class-name=\"org.apache.activemq.command.ActiveMQQueue\" jndi-name=\"java:/app/jms/mySyncAppQueue\" use-java-context=\"true\" pool-name=\"mySyncAppQueue\">\r\n                            <config-property name=\"PhysicalName\">\r\n                                app/jms/mySyncAppQueue\r\n                            </config-property>\r\n                        </admin-object>\r\n                        <admin-object class-name=\"org.apache.activemq.command.ActiveMQQueue\" jndi-name=\"java:/app/jms/myAsyncQueue\" use-java-context=\"true\" pool-name=\"myAsyncQueue\">\r\n                            <config-property name=\"PhysicalName\">\r\n                                app/jms/myAsyncQueue\r\n                            </config-property>\r\n                        </admin-object>\r\n                        <admin-object class-name=\"org.apache.activemq.command.ActiveMQQueue\" jndi-name=\"java:/app/jms/mySyncContainerQueue\" use-java-context=\"true\" pool-name=\"mySyncContainerQueue\">\r\n                            <config-property name=\"PhysicalName\">\r\n                                app/jms/mySyncContainerQueue\r\n                            </config-property>\r\n                        </admin-object>\r\n                        <admin-object class-name=\"org.apache.activemq.command.ActiveMQQueue\" jndi-name=\"java:/app/jms/classicQueue\" use-java-context=\"true\" pool-name=\"classicQueue\">\r\n                            <config-property name=\"PhysicalName\">\r\n                                app/jms/classicQueue\r\n                            </config-property>\r\n                        </admin-object>\r\n                    </admin-objects>\r\n                </resource-adapter>\r\n            </resource-adapters>\r\n        </subsystem>\r\n{code}\r\nWe are now using the tcp connector to workaround. In case that password \r\nis wrong, no broker is available and incoming requests are refused as expected. \r\n\r\nAdditional we will use a startup Singleton bean to check, if broker is available, so \r\nthat startup fails, if there is something wrong.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12914224","id":"12914224","filename":"broker-config.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Harder","name":"Harder","key":"harder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clemens","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-13T06:35:13.920+0000","size":3379,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12914224/broker-config.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12914223","id":"12914223","filename":"ra.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Harder","name":"Harder","key":"harder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clemens","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-13T06:36:12.894+0000","size":12888,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12914223/ra.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"JDBC persistence is silently falling back to KahaDB, if an error occurs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Harder","name":"Harder","key":"harder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clemens","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Harder","name":"Harder","key":"harder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clemens","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"ActiveMQ 5.15.3\r\n\r\nWildfly 10.1.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13144635/comment/16396615","id":"16396615","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Harder","name":"Harder","key":"harder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clemens","active":true,"timeZone":"Etc/UTC"},"body":"Additional information are available at [http://activemq.2283324.n4.nabble.com/JDBC-persistence-is-silently-falling-back-to-KahaDB-if-an-error-occurs-td4737644.html]\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Harder","name":"Harder","key":"harder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clemens","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-13T06:44:22.849+0000","updated":"2018-03-13T06:44:22.849+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13144635/comment/16396848","id":"16396848","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"there is a vm: create=false option that will cause the vm transport to fail rather than create an embedded broker with default config. That may be what you need.\r\nhttp://activemq.apache.org/vm-transport-reference.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-13T11:36:42.229+0000","updated":"2018-03-13T11:36:42.229+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13144635/comment/16396964","id":"16396964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Harder","name":"Harder","key":"harder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clemens","active":true,"timeZone":"Etc/UTC"},"body":"Thank you very much for the hint. It is working now.\r\n\r\nWe have set server URL in standalone.xml to vm://localhost?create=false\r\n\r\nThe behavior with vm://localhost?create=true is incomprehensible. It would be better to leave the default configuration with create=false or to use the same broker-config.xml as it was used for the first initialization instead of using some default config on the second try.\r\n\r\nFeel free to close the ticket.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Harder","name":"Harder","key":"harder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clemens","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-13T13:55:14.545+0000","updated":"2018-03-13T13:55:50.019+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6926/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3r7vj:"}}