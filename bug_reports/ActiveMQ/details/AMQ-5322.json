{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12733992","self":"https://issues.apache.org/jira/rest/api/2/issue/12733992","key":"AMQ-5322","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-08-14T17:37:40.241+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jun 06 22:28:45 UTC 2015","customfield_12310420":"412020","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5322/watchers","watchCount":8,"isWatching":false},"created":"2014-08-14T07:47:25.801+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326455","id":"12326455","name":"5.9.1","archived":false,"released":true,"releaseDate":"2014-04-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-06-06T22:28:45.841+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I discovered since AMQ 5.9, message could be sent to different consumer even with JMSXGroupID is set.\n\nHere is how to reproduce.\n1. start 10 consumers to connect to server (consumer 1-10)\n2. send 1025 messages with JMSXGroupID set from 0 - 1024 \n3. add other 10 consumers to connect to server (consumer 11-20)\n4. send several messages with JMSXGroup set from 0 - 1024\n\nNow, you can observe consumers added lately ( 11 - 20 ) will also receive messages even JMSXGroupID have been dispatched to first consumer group( 1 - 10).\n \nnote:  In step2 , there should have more than 1024 different kind of JMSXGroupID to reproduce this bug.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12662065","id":"12662065","filename":"AMQ5322Test.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-08-15T14:26:04.267+0000","size":5536,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12662065/AMQ5322Test.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12678182","id":"12678182","filename":"Consumer.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samara","name":"samara","key":"samara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Samardzija","active":true,"timeZone":"Europe/Belgrade"},"created":"2014-10-30T14:08:36.742+0000","size":3596,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12678182/Consumer.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12661969","id":"12661969","filename":"GroupIdTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lcamel","name":"lcamel","key":"lcamel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luoh Ren-Shan","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-15T01:34:03.428+0000","size":4578,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12661969/GroupIdTest.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12678183","id":"12678183","filename":"Producer.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samara","name":"samara","key":"samara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Samardzija","active":true,"timeZone":"Europe/Belgrade"},"created":"2014-10-30T14:08:36.750+0000","size":2122,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12678183/Producer.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12678184","id":"12678184","filename":"TestGroups.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samara","name":"samara","key":"samara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Samardzija","active":true,"timeZone":"Europe/Belgrade"},"created":"2014-10-30T14:08:36.757+0000","size":2376,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12678184/TestGroups.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"412009","customfield_12312823":null,"summary":"Message is assigned to different client with the same JMSXGroupID","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bagameow","name":"bagameow","key":"bagameow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wesley lin","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bagameow","name":"bagameow","key":"bagameow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wesley lin","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14097261","id":"14097261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"It would be a good idea for you to try and create a JUnit test to reproduce","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-08-14T17:37:40.241+0000","updated":"2014-08-14T17:37:40.241+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14098036","id":"14098036","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lcamel","name":"lcamel","key":"lcamel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luoh Ren-Shan","active":true,"timeZone":"Etc/UTC"},"body":"Here is a JUnit test case to reproduce it.\nPlease see the attached file.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lcamel","name":"lcamel","key":"lcamel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luoh Ren-Shan","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-15T01:32:44.433+0000","updated":"2014-08-15T01:32:44.433+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14098038","id":"14098038","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lcamel","name":"lcamel","key":"lcamel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luoh Ren-Shan","active":true,"timeZone":"Etc/UTC"},"body":"fails when N > 1024","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lcamel","name":"lcamel","key":"lcamel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luoh Ren-Shan","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-15T01:34:03.432+0000","updated":"2014-08-15T01:34:03.432+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14098052","id":"14098052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lcamel","name":"lcamel","key":"lcamel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luoh Ren-Shan","active":true,"timeZone":"Etc/UTC"},"body":"We suspect that MessageGroupHashBucket should not use a LRUMap. It may cause old goupIds being evicted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lcamel","name":"lcamel","key":"lcamel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luoh Ren-Shan","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-15T01:53:52.094+0000","updated":"2014-08-15T01:53:52.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14098568","id":"14098568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Test that passes using indicated scenario.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-08-15T14:26:04.271+0000","updated":"2014-08-15T14:26:04.271+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14098569","id":"14098569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You can configure the cache size in your Broker configuration as needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-08-15T14:26:48.721+0000","updated":"2014-08-15T14:26:48.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14123478","id":"14123478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kalki70","name":"kalki70","key":"kalki70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luis Rojas","active":true,"timeZone":"Etc/UTC"},"body":"I came across the code looking for a solution to our problems in production. We open many JMSXGroupIds simultaneously, and messages that should arrive to only one consumer arrive to any other consumer, like there was no previous association for that GroupId.\n\nI saw the implementation of MessageGroupHashBucket and it is just plain wrong. That is a very bad implemented Hash.\nIt does not consider that independent of the value of bucketCount, the hashCode() can be the same for two different groupIds.\n\nIf we see the code here :\n\nhttp://activemq.apache.org/maven/5.10.0/apidocs/src-html/org/apache/activemq/broker/region/group/MessageGroupHashBucket.html\n\n134    protected int getBucketNumber(String groupId) {\n135        int bucket = groupId.hashCode() % bucketCount;\n136        // bucket could be negative\n137        if (bucket < 0) {\n138            bucket *= -1;\n139        }\n140        return bucket;\n141    }\n \nFor two different groupIds, the value returned by getBucketNumber() can be the same. That is called a \"collision\" in a hash.\nNow, what happens if we want to put a new GroupId associated with a different ConsumerId into an already used bucket  ?\n\n041    public synchronized void put(String groupId, ConsumerId consumerId) {\n042        int bucket = getBucketNumber(groupId);\n043        consumers[bucket] = consumerId;\n044        if (consumerId != null){\n045          cache.put(groupId,consumerId.toString());\n046        }\n047    }\n\nOMG!!! There is no validation at all. The previous value is simply overwriten !!\nWe use UUID as GroupIds, and no matter that they are all different, many times the getBucketNumber() is the same, the value overwritten and the previous association is lost.\nIt is not a solution to increase the value of bucketCount, it is not a matter of size of the Hash, it is really a bad implementation.\n\nMore about collisions here :\n\nhttps://www.princeton.edu/~achaney/tmve/wiki100k/docs/Hash_collision.html\n\nA hash should deal with collisions, it is part of problems of a hash, and there are different solutions. For instance, each bucket could be a list of associated GroupIds. Unfortunately then a lineal search is needed and performance is affected. That is why the Hashes are usually so dependant of the hashCode() implementation.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kalki70","name":"kalki70","key":"kalki70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luis Rojas","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-05T19:58:26.187+0000","updated":"2014-09-05T19:58:26.187+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14190095","id":"14190095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samara","name":"samara","key":"samara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Samardzija","active":true,"timeZone":"Europe/Belgrade"},"body":"Java classes attached. Test provided.\nListener scenario with message groups (3 consumers)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samara","name":"samara","key":"samara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Samardzija","active":true,"timeZone":"Europe/Belgrade"},"created":"2014-10-30T14:08:36.764+0000","updated":"2014-10-31T08:31:23.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14190097","id":"14190097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samara","name":"samara","key":"samara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Samardzija","active":true,"timeZone":"Europe/Belgrade"},"body":"I have tried solution provided by Timothy Bish but it does not work in listener scenario.\nTest classes attached\n\nSummary:\nWhen using bellow 1024 groups everything is fine, no missfires:\n[14:55:03.181] DEBUG [main] (TestGroups.java:37) - Using: MessageGroupHashBucketFactory and setting bucketCount to 2000\n[14:55:03.733] DEBUG [main] (Producer.java:52) - Sending 3 messages in 1024 groups\n[14:55:04.111] DEBUG [main] (Producer.java:66) - Total messages sent: 3072\n[14:55:07.111] DEBUG [main] (Consumer.java:77) - received messages per consumer: 342\n[14:55:07.112] DEBUG [main] (Consumer.java:77) - received messages per consumer: 341\n[14:55:07.113] DEBUG [main] (Consumer.java:77) - received messages per consumer: 341\n[14:55:07.113] DEBUG [main] (Consumer.java:82) - received total messages: 1024\n[14:55:07.113] DEBUG [main] (Consumer.java:84) - dataCounter (total messages): 3072\n[14:55:07.113] DEBUG [main] (Consumer.java:85) - missfires: 0\n\n\nBut when using more, every msg goes to different consumer, there is no grouping!\n[14:54:26.269] DEBUG [main] (TestGroups.java:37) - Using: MessageGroupHashBucketFactory and setting bucketCount to 2000\n[14:54:26.815] DEBUG [main] (Producer.java:52) - Sending 3 messages in 1025 groups\n[14:54:27.195] DEBUG [main] (Producer.java:66) - Total messages sent: 3075\n[14:54:30.196] DEBUG [main] (Consumer.java:77) - received messages per consumer: 1025\n[14:54:30.198] DEBUG [main] (Consumer.java:77) - received messages per consumer: 1025\n[14:54:30.199] DEBUG [main] (Consumer.java:77) - received messages per consumer: 1025\n[14:54:30.199] DEBUG [main] (Consumer.java:82) - received total messages: 3075\n[14:54:30.200] DEBUG [main] (Consumer.java:84) - dataCounter (total messages): 3075\n[14:54:30.200] DEBUG [main] (Consumer.java:85) - missfires: 3075","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samara","name":"samara","key":"samara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Samardzija","active":true,"timeZone":"Europe/Belgrade"},"created":"2014-10-30T14:09:13.603+0000","updated":"2014-10-30T14:09:13.603+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14191583","id":"14191583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samara","name":"samara","key":"samara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Samardzija","active":true,"timeZone":"Europe/Belgrade"},"body":"When I tried solution described at http://scott.cranton.com/2010/09/activemq-message-groups.html it is working.\nI do not understand why configuration via xml and java code are not the same!?\n\nLog with updated activemq.xml configuration:\n[09:26:24.115] DEBUG [main] (Producer.java:52) - Sending 3 messages in 1025 groups\n[09:26:24.535] DEBUG [main] (Producer.java:65) - Total messages sent: 3075\n[09:26:27.536] DEBUG [main] (Consumer.java:77) - received messages per consumer: 342\n[09:26:27.536] DEBUG [main] (Consumer.java:77) - received messages per consumer: 342\n[09:26:27.536] DEBUG [main] (Consumer.java:77) - received messages per consumer: 341\n[09:26:27.536] DEBUG [main] (Consumer.java:82) - received total messages: 1025\n[09:26:27.536] DEBUG [main] (Consumer.java:84) - dataCounter (total messages): 3075\n[09:26:27.536] DEBUG [main] (Consumer.java:85) - missfires: 0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samara","name":"samara","key":"samara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Samardzija","active":true,"timeZone":"Europe/Belgrade"},"created":"2014-10-31T08:28:24.377+0000","updated":"2014-10-31T08:28:24.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12733992/comment/14575979","id":"14575979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaun.guth","name":"shaun.guth","key":"shaun.guth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shaun Guth","active":true,"timeZone":"America/Los_Angeles"},"body":"I deleted my comments. It turns out that my issue was with the C# NMS client and not AMQ directly. If you set JMSXGroupID via the Properties[] in that client, they do not get assigned to the header correctly. The java client does not have this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaun.guth","name":"shaun.guth","key":"shaun.guth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shaun Guth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-06T22:28:45.841+0000","updated":"2015-06-06T22:28:45.841+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5322/votes","votes":4,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1yvqv:"}}