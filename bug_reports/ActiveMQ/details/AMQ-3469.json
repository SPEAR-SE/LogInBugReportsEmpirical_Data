{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12519922","self":"https://issues.apache.org/jira/rest/api/2/issue/12519922","key":"AMQ-3469","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 24 13:57:50 UTC 2011","customfield_12310420":"63877","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3469/watchers","watchCount":3,"isWatching":false},"created":"2011-08-24T07:58:19.238+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-08-24T13:57:50.187+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313904","id":"12313904","name":"JMX","description":"The JMX support in ActiveMQ"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Please see this arch diagram: http://activemq.2283324.n4.nabble.com/file/n3762364/ActiveMQ_-_Composite_Queues.png\n\nThere are two brokers: broker1 & broker2. Messages arriving at Q.Index.Transit.DC2 on broker1 is forwarded to broker2. Configuration files for both brokers are below.\n\nScenario:\n1. Start both brokers in separate consoles\n2. Send 3000 messages in AcknowledgementMode.Transactional to broker1 (Q.Index.Replication).\n3. While messages are flowing kill (shutdown console) broker2 and then broker1.\n4. Start broker1 and then broker2.\n5. Repeat 3&4 while messages are still flowing.\n6. When all messages are published from producer to broker1, observe message counts in broker1 Transit and broker2 Indexing queues. \n\nYou will see that both admin console and JConsole reporting more messages than there actually are in Q.A.Indexing and Q.B.Indexing queues. \n\nTake a look at this screenshot: http://activemq.2283324.n4.nabble.com/file/n3762364/ActiveMQ_-_Admin_Console.png\n\nAll queues had 3003 messages (instead of 3000). When I consumed all messages in Q.A.Indexing with my consumer, it successfully consumed 3000 messages (as expected) but admin console still reports there are additional 3 messages pending in the queue. When I click on \"Browse\" to inspect the messages in admin console it reports that there are no messages. When I restart this broker, pending message count corrects itself and reports 0. \n\nThis is a problem for the monitoring and operations: There is no way of knowing whether there are really 3 messages left and consumer is experiencing problems or consumer is alive but there are no messages to consume.\n\nHere are the configuration files for both brokers:\nBroker1 configuration: http://activemq.2283324.n4.nabble.com/file/n3762374/activemq_-_broker1.xml\nBroker2 configuration: http://activemq.2283324.n4.nabble.com/file/n3762374/activemq_-_broker2.xml","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81468","customfield_12312823":null,"summary":"Number of Pending Messages in Transactional Send to Composite Destination via Network of Brokers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oseymen","name":"oseymen","key":"oseymen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ozan Seymen","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oseymen","name":"oseymen","key":"oseymen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ozan Seymen","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows OS using NMS for C#","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519922/comment/13090186","id":"13090186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oseymen","name":"oseymen","key":"oseymen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ozan Seymen","active":true,"timeZone":"Etc/UTC"},"body":"Zombie messages count seems to be consistent with \"Duplicate message add attempt rejected\" messages.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oseymen","name":"oseymen","key":"oseymen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ozan Seymen","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-24T13:04:42.581+0000","updated":"2011-08-24T13:04:42.581+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519922/comment/13090231","id":"13090231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oseymen","name":"oseymen","key":"oseymen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ozan Seymen","active":true,"timeZone":"Etc/UTC"},"body":"...And zombie messages count seems to be the same as the output of cursorSize operation in JMX (via JConsole). I'd appreciate _any_ feedback.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oseymen","name":"oseymen","key":"oseymen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ozan Seymen","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-24T13:57:50.149+0000","updated":"2011-08-24T13:57:50.149+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3469/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0eaj3:"}}