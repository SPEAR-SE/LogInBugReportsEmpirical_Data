{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481394","self":"https://issues.apache.org/jira/rest/api/2/issue/12481394","key":"AMQ-377","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2005-10-14T01:36:03.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 04 20:39:26 UTC 2006","customfield_12310420":"49071","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_8268638000_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2006-01-04T20:39:26.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-377/watchers","watchCount":0,"isWatching":false},"created":"2005-10-01T03:48:48.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315602","id":"12315602","name":"3.2","archived":false,"released":true}],"issuelinks":[{"id":"12335004","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335004","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12481950","key":"AMQ-368","self":"https://issues.apache.org/jira/rest/api/2/issue/12481950","fields":{"summary":"Database Connection Leaks","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dflores","name":"dflores","key":"dflores","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Darwin Flores","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-01-04T20:39:26.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Scenarion:\n\n1. 10 consumer is created (each has its own connection) then closes the connection right away. The application is executed several times.\n\nExpected behaviour: A \"postgres process\" is created when a consumer creates a connection. Subsequently, when the consumer closes/stops the connection, the \"postgres process\" should also closes/stops.\nActual behaviour: Inconsistent, most of the time, postgres process remains active even though the consumer is already disconnected. So, creating new consumer eventually leads to exception where it disallows further connection to postgres. The solution here is to restart the broker to kill all \"postgres processes\" the was created by disconnected consumers.\n\n\"Failed to create transaction: org.postgresql.util.PSQLException: Backend start-up failed: FATAL: sorry, too many clients already.\" (see attached log file).\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"171983","customfield_12312823":null,"summary":"Unbounded number of jdbc connections created to postgresql","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=foconer","name":"foconer","key":"foconer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fritz Oconer","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=foconer","name":"foconer","key":"foconer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fritz Oconer","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Postgres 8.03 with the provided JDBC3 driver on a Windows machine.\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481394/comment/12937331","id":"12937331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dub","name":"dub","key":"dub","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wendel Schultz","active":true,"timeZone":"Etc/UTC"},"body":"Is this related to AMQ-368 ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dub","name":"dub","key":"dub","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wendel Schultz","active":true,"timeZone":"Etc/UTC"},"created":"2005-10-14T01:36:03.000+0000","updated":"2005-10-14T01:36:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481394/comment/12937112","id":"12937112","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=foconer","name":"foconer","key":"foconer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fritz Oconer","active":true,"timeZone":"Etc/UTC"},"body":"From my understanding this is a bit different from amq-368 in terms of case scenario. There is no actual message sent or received, it continually just creates and disconnects a consumer which eventually leads to the exception above. The similarity is it doesn't destroy the connection on the database right away when it's supposed to have been destroyed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=foconer","name":"foconer","key":"foconer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fritz Oconer","active":true,"timeZone":"Etc/UTC"},"created":"2005-10-14T02:25:25.000+0000","updated":"2005-10-14T02:25:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481394/comment/12937527","id":"12937527","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.howe.gs","name":"david.howe.gs","key":"david.howe.gs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Howe","active":true,"timeZone":"Etc/UTC"},"body":"We are also experiencing this problem using Oracle 9i as the backend.  Over the course of the day, the number of sessions open from ActiveMQ slowly gets larger and larger.  Eventually (approx 24 hours), it exhausts all of the processes available in Oracle and nothing else can connect.  Re-starting ActiveMQ then clears all of the Oracle sessions and everything goes back to normal.  Our ActiveMQ server isn't actually doing much at the moment as we've only just installed it and haven't started using it for anything serious.\n\nThe relevant sections of our configuration file are below.  I've deliberately only got a small number of connections in the pool to try and alleviate the running out of connections problem.  It's strange that it can keep getting connections without exhausting the pool, which is what I thought would happen if you reach the maxActive number of connections and wait the maxWait time for one to become available.\n\n    <persistence>\n      <cachePersistence>\n        <journalPersistence directory=\"../var/journal\">\n          <jdbcPersistence dataSourceRef=\"oracle-ds\"/>\n        </journalPersistence>\n      </cachePersistence>\n    </persistence>\n\n  <bean id=\"oracle-ds\" class=\"org.apache.commons.dbcp.BasicDataSource\" destroy-method=\"close\">\n    <property name=\"driverClassName\">\n      <value>oracle.jdbc.OracleDriver</value>\n    </property>\n    <property name=\"url\">\n      <!-- Use a URL like 'jdbc:hsqldb:hsql://localhost:9001' if you want to connect to a remote hsqldb -->\n      <value>jdbc:oracle:thin:@//host:1521/SID</value>\n    </property>\n    <property name=\"username\">\n      <value>user</value>\n    </property>\n    <property name=\"password\">\n      <value>password</value>\n    </property>\n    <property name=\"defaultAutoCommit\">\n      <value>false</value>\n    </property>\n    <property name=\"poolPreparedStatements\">\n      <value>true</value>\n    </property>\n    <property name=\"initialSize\">\n        <value>1</value>\n    </property>\n    <property name=\"maxActive\">\n        <value>2</value>\n    </property>\n    <property name=\"minIdle\">\n        <value>0</value>\n    </property>\n    <property name=\"maxIdle\">\n        <value>1</value>\n    </property>\n    <property name=\"maxWait\">\n        <value>2000</value>\n    </property>\n  </bean>\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=david.howe.gs","name":"david.howe.gs","key":"david.howe.gs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Howe","active":true,"timeZone":"Etc/UTC"},"created":"2005-12-12T05:59:55.000+0000","updated":"2005-12-12T05:59:55.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481394/comment/12937507","id":"12937507","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Jonas,\n\nIf you get a chance, can you try to recreate this problem using the latest 4.0-SNAPSHOT?\n\nThanks,\nHiram","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2005-12-21T20:49:24.000+0000","updated":"2005-12-21T20:49:24.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481394/comment/12937108","id":"12937108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"duplicate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2006-01-04T20:39:26.000+0000","updated":"2006-01-04T20:39:26.000+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-377/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tsun:"}}