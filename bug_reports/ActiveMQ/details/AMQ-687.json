{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481683","self":"https://issues.apache.org/jira/rest/api/2/issue/12481683","key":"AMQ-687","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315609","id":"12315609","description":"","name":"4.0 RC3","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-04-11T01:19:02.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Apr 11 01:19:02 UTC 2006","customfield_12310420":"84300","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3963000_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2006-04-11T01:19:02.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-687/watchers","watchCount":1,"isWatching":false},"created":"2006-04-11T00:12:59.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315608","id":"12315608","description":"","name":"4.0 RC2","archived":false,"released":true,"releaseDate":"2006-04-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-04-11T01:19:02.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"There is a problem with a network of brokers with regards to a single consumer subscribing to multiple durable topics.  \n\nTo recreate the issue, I changed examples/ConsumerTool.java to subscribe to two durable topics, with the createDurableSubscriber calls changed to look like this:\n                consumer = session.createDurableSubscriber(topic1, topic1.getTopicName() );\n                consumer2 = session.createDurableSubscriber( topic2, topic2.getTopicName() );\nThis ensures that the name of the durable subscriptions are unique, rather than using the \"consumerName\" as the base example code does.\n\nThe problem is with any remote brokers: it appears that the broker-to-broker code for durable subscriptions does not *uniquely* set the subscription name for multiple durable subscriptions to different topics.  Here is the message and exception information from the remote broker:\n\n<INFO> <org.apache.activemq.broker.AbstractConnection.Service> < Mon 2006/04/10 10:50:52:660 > <org.apache.activemq.broker.AbstractConnection.se\nrviceException> <Thread[tcp://sbtmdgca/170.137.15.64:61618,5,main]> Async error occurred: javax.jms.JMSException: Durable consumer is in use for\n client: NC_ProdDN3AsbtmdgcasbtmdgcAMQDN_inboundProdDN3Bsbtgc0bsbtgc0AMQDN and subscriptionName: ProdDN3Bsbtgc0bsbtgc0AMQDN\n<INFO> Stack Trace follows:\njavax.jms.JMSException: Durable consumer is in use for client: NC_ProdDN3AsbtmdgcasbtmdgcAMQDN_inboundProdDN3Bsbtgc0bsbtgc0AMQDN and subscriptio\nnName: ProdDN3Bsbtgc0bsbtgc0AMQDN\n        at org.apache.activemq.broker.region.TopicRegion.addConsumer(TopicRegion.java:81)\n        at org.apache.activemq.broker.region.RegionBroker.addConsumer(RegionBroker.java:276)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:69)\n        at org.apache.activemq.advisory.AdvisoryBroker.addConsumer(AdvisoryBroker.java:75)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:69)\n        at org.apache.activemq.broker.MutableBrokerFilter.addConsumer(MutableBrokerFilter.java:81)\n        at org.apache.activemq.broker.AbstractConnection.processAddConsumer(AbstractConnection.java:422)\n        at org.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:291)\n        at org.apache.activemq.broker.AbstractConnection.service(AbstractConnection.java:196)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:62)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:88)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:70)\n        at org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:75)\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:44)\n        at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:55)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport.addSubscription(DemandForwardingBridgeSupport.java:344)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport.serviceRemoteConsumerAdvisory(DemandForwardingBridgeSupport.java:324)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport.serviceRemoteCommand(DemandForwardingBridgeSupport.java:274)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport$2.onCommand(DemandForwardingBridgeSupport.java:120)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:88)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:70)\n        at org.apache.activemq.transport.failover.FailoverTransport$1.onCommand(FailoverTransport.java:103)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:114)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:122)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:87)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:139)\n        at java.lang.Thread.run(Thread.java:595)\n\n\nYou can see that the \"subscriptionName\" used from the originating broker is the brokerName.  This will never handle multiple durable subscriptions (different topics) from the same consumer.\n\nPerhaps in addition to the brokerName, the original topic name could be used?  Or, just the topic name, since clientId is supposed to make it unique anyway.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161481","customfield_12312823":null,"summary":"Multiple durable topics don't work with network of brokers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yaussy","name":"yaussy","key":"yaussy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Yaussy","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yaussy","name":"yaussy","key":"yaussy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Yaussy","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"AMQ RC2, Solaris 8 / 10, JDK 1.5","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481683/comment/12937732","id":"12937732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"fix applied to generate subscriberName based on brokerName plus destination name","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2006-04-11T01:19:02.000+0000","updated":"2006-04-11T01:19:02.000+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-687/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s013:"}}