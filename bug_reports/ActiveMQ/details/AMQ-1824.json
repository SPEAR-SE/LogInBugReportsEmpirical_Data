{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482716","self":"https://issues.apache.org/jira/rest/api/2/issue/12482716","key":"AMQ-1824","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2008-08-14T22:45:46.728+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 06 10:47:07 UTC 2008","customfield_12310420":"95916","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_11349689339_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2008-11-03T12:04:18.746+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1824/watchers","watchCount":3,"isWatching":false},"created":"2008-06-25T03:22:49.407+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-11-06T10:47:07.862+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"With a single producer and multiple consumer processes using the ActiveMQResourceAdapter (inside Jencks), some consumers stop getting messages. If you look at the JMX counters inside jconsole you can see the stuck subscription's pending queue size increasing. Nearly every time this exception is thrown by one of the failing consumers:\n{noformat}\n2008-06-25 12:07:29,297 [pool-1-thread-7] WARN  Transaction  - Error ending association for XAResource org.apache.geronimo.transaction.manager.WrapperNamedXAResource@17918f0; transaction will roll back. XA error code: -7\njavax.transaction.xa.XAException: The connection is already closed\n\tat org.apache.activemq.TransactionContext.toXAException(TransactionContext.java:624)\n\tat org.apache.activemq.TransactionContext.setXid(TransactionContext.java:559)\n\tat org.apache.activemq.TransactionContext.end(TransactionContext.java:339)\n\tat org.apache.activemq.ra.LocalAndXATransaction.end(LocalAndXATransaction.java:90)\n\tat org.apache.geronimo.transaction.manager.WrapperNamedXAResource.end(WrapperNamedXAResource.java:51)\n\tat org.apache.geronimo.transaction.manager.TransactionImpl.endResources(TransactionImpl.java:563)\n\tat org.apache.geronimo.transaction.manager.TransactionImpl.endResources(TransactionImpl.java:542)\n\tat org.apache.geronimo.transaction.manager.TransactionImpl.beforePrepare(TransactionImpl.java:401)\n\tat org.apache.geronimo.transaction.manager.TransactionImpl.commit(TransactionImpl.java:257)\n\tat org.apache.geronimo.transaction.manager.TransactionManagerImpl.commit(TransactionManagerImpl.java:238)\n\tat org.jencks.XAEndpoint.afterDelivery(XAEndpoint.java:105)\n\tat org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.afterDelivery(MessageEndpointProxy.java:121)\n\tat org.apache.activemq.ra.MessageEndpointProxy.afterDelivery(MessageEndpointProxy.java:63)\n\tat org.apache.activemq.ra.ServerSessionImpl.afterDelivery(ServerSessionImpl.java:217)\n\tat org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:785)\n\tat org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:165)\n\tat org.apache.geronimo.connector.work.WorkerContext.run(WorkerContext.java:290)\n\tat org.apache.geronimo.connector.work.pool.NamedRunnable.run(NamedRunnable.java:32)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n\tat java.lang.Thread.run(Unknown Source)\nCaused by: org.apache.activemq.ConnectionClosedException: The connection is already closed\n\tat org.apache.activemq.ActiveMQConnection.checkClosed(ActiveMQConnection.java:1271)\n\tat org.apache.activemq.ActiveMQConnection.checkClosedOrFailed(ActiveMQConnection.java:1258)\n\tat org.apache.activemq.TransactionContext.setXid(TransactionContext.java:556)\n\t... 19 more\n2008-06-25 12:07:29,297 [pool-1-thread-7] ERROR Transaction  - Unexpected exception rolling back org.apache.geronimo.transaction.manager.WrapperNamedXAResource@17918f0; continuing with rollback\njavax.transaction.xa.XAException: The connection is already closed\n\tat org.apache.activemq.TransactionContext.toXAException(TransactionContext.java:624)\n\tat org.apache.activemq.TransactionContext.rollback(TransactionContext.java:423)\n\tat org.apache.activemq.ra.LocalAndXATransaction.rollback(LocalAndXATransaction.java:128)\n\tat org.apache.geronimo.transaction.manager.WrapperNamedXAResource.rollback(WrapperNamedXAResource.java:78)\n\tat org.apache.geronimo.transaction.manager.TransactionImpl.rollbackResources(TransactionImpl.java:581)\n\tat org.apache.geronimo.transaction.manager.TransactionImpl.commit(TransactionImpl.java:267)\n\tat org.apache.geronimo.transaction.manager.TransactionManagerImpl.commit(TransactionManagerImpl.java:238)\n\tat org.jencks.XAEndpoint.afterDelivery(XAEndpoint.java:105)\n\tat org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.afterDelivery(MessageEndpointProxy.java:121)\n\tat org.apache.activemq.ra.MessageEndpointProxy.afterDelivery(MessageEndpointProxy.java:63)\n\tat org.apache.activemq.ra.ServerSessionImpl.afterDelivery(ServerSessionImpl.java:217)\n\tat org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:785)\n\tat org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:165)\n\tat org.apache.geronimo.connector.work.WorkerContext.run(WorkerContext.java:290)\n\tat org.apache.geronimo.connector.work.pool.NamedRunnable.run(NamedRunnable.java:32)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n\tat java.lang.Thread.run(Unknown Source)\nCaused by: org.apache.activemq.ConnectionClosedException: The connection is already closed\n\tat org.apache.activemq.ActiveMQConnection.checkClosed(ActiveMQConnection.java:1271)\n\tat org.apache.activemq.ActiveMQConnection.checkClosedOrFailed(ActiveMQConnection.java:1258)\n\tat org.apache.activemq.TransactionContext.rollback(TransactionContext.java:407)\n\t... 16 more\n2008-06-25 12:07:29,297 [pool-1-thread-7] INFO  org.apache.activemq.ra.ServerSessionImpl:0  - Endpoint failed to process message. Reason: java.lang.RuntimeException: Endpoint after delivery notification failure\n{noformat}\n\nI've written some code to reproduce this problem. Instructions:\n1. unpack the attached source\n2. build with 'mvn compile package'\n3. start with ./startAll.sh (I used cygwin) - this will start 1 producer and 3 consumer processes. These programs are pointing to tcp://localhost:62616 (you can change this in spring config file)\nLook in jconsole under subscriptions and you will probably see within 1 or 2 runs, only 2 consumers being created, or possibly 3 consumers but 1 of them with an increasing pending queue size.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461178","id":"12461178","filename":"repro_AMQ_rf.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-15T05:33:01.618+0000","size":13204,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461178/repro_AMQ_rf.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461227","id":"12461227","filename":"repro_AMQ.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-02T11:33:58.393+0000","size":10994,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461227/repro_AMQ.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"255155","customfield_12312823":null,"summary":"Single producer and multiple consumer processes, some consumers stop getting messages.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP SP2, Sun JDK 1.6.03 and RHEL 64 bit Sun 1.6.05","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12939853","id":"12939853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"body":"Reproduction test case","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-25T03:24:35.918+0000","updated":"2008-06-25T03:24:35.918+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12939883","id":"12939883","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"body":"Here's a better test case i.e. this one compiles from clean (sorry about the last one!)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-02T11:33:58.538+0000","updated":"2008-07-02T11:33:58.538+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940004","id":"12940004","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"body":"I have managed to work around this issue by not using Jencks and instead using Spring JmsTemplate and SingleConnectionFactory","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-30T23:45:35.434+0000","updated":"2008-07-30T23:45:35.434+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940047","id":"12940047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"The fact that consumer stopped receiving messages was caused by the \"transaction has not been started error\" \n\nthis was caused by the default JMS template in Spring would open and close the connection for each message.\n\nSwitching to the single connection factory where a single connection is reused works around this,\n\nit is possible that using\nTransactionAwareConnectionFactoryProxy will help out with this as well, when using Spring managed transactions\n\nFilip","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-08-14T22:45:46.728+0000","updated":"2008-08-14T22:45:46.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940340","id":"12940340","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"body":"Given Filip's comment, is this still an open issue? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2008-10-14T22:01:47.748+0000","updated":"2008-10-14T22:01:47.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940366","id":"12940366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"body":"I don't know if the comment is quite right - apologies for not giving feedback before.   Incoming messages do not use a spring JmsTemplate at all - they use xml as below as recommended on jencks website. I've uploaded a slightly refactored version of the reproduction code to make this clearer. \n\n\t<bean id=\"inboundConnector\" class=\"org.jencks.JCAConnector\">\n\t\t<property name=\"jcaContainer\" ref=\"jencks\" />\n\t\t<property name=\"activationSpec\" ref=\"activationSpec\"/>\n\t\t<property name=\"ref\" value=\"echoBean\" />\n\t</bean>\n\n\t<bean id=\"echoBean\" class=\"com.repro.EchoBean\" scope=\"prototype\"/>\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-15T05:33:01.884+0000","updated":"2008-10-15T05:33:01.884+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940347","id":"12940347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I just gave your test case a run with trunk and it works as expected. Each listen gets an even distribution of messages.\nI know that at least one instance of \"transaction has not started\" has been fixed since 5.1 as have a bunch of other high through put issues.\nCan you verify that the problem still exists with trunk or with the current 5.2 RC2 - http://people.apache.org/~gtully/staging-repos/activemq-5.2.0/org/apache/activemq/apache-activemq/5.2.0 or the latest apache 5.3-SNAPSHOT build http://people.apache.org/repo/m2-snapshot-repository/org/apache/activemq/apache-activemq/5.3-SNAPSHOT/\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-17T16:21:52.307+0000","updated":"2008-10-17T16:21:52.307+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940387","id":"12940387","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"body":"I ran this up to 6500 messages/second and I'm still not seeing any issues. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsnyder","name":"bsnyder","key":"bsnyder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Snyder","active":true,"timeZone":"America/Denver"},"created":"2008-10-17T16:46:38.194+0000","updated":"2008-10-17T16:46:38.194+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940372","id":"12940372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"body":"I've tried this with 5.2.0RC2 and still the same problem","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-18T10:15:28.680+0000","updated":"2008-10-18T10:15:28.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940345","id":"12940345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"body":"and same problem with 5.3.SNAPSHOT I'm afraid","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jerryshea","name":"jerryshea","key":"jerryshea","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jerry Shea","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-18T10:20:39.996+0000","updated":"2008-10-18T10:20:39.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940388","id":"12940388","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I can now reproduce. tx not started error on broker.  thx.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-24T16:47:12.820+0000","updated":"2008-10-24T16:47:12.820+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940398","id":"12940398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"This test is a demonstration of a limitation of the current geronimo transaction manager xid factory. With three JMVs on the same machine executing the same code, the transaction identifiers are identical.\nThe broker sees the same Xid on three connections instead of three separate transactions. The problem occurs when a transaction commit occurs before the last ack on a connection.\n\nThe default geronimo xidFactory impl needs to add some entropy in the form of a random to the baseId. The current use of HashCode and IP address for baseId is not sufficient. Typically nodes will be on different IP addresses so this will not be an issue.\nI raised a geronimo issue with a suggested patch:  https://issues.apache.org/jira/browse/GERONIMO-4393\n\nAs a workaround:\nthere is a constructor argument that allows the baseId to be specified, if this makes use of the clientId property, the test works as expected.\n\n{code}\n  <bean id=\"xidFactory\" class=\"org.apache.geronimo.transaction.manager.XidFactoryImpl\">\n  \t<constructor-arg><value>bla-bla-${clientId}</value></constructor-arg>\n  </bean>\n\n  <bean id=\"transactionManager\" class=\"org.jencks.factory.TransactionManagerFactoryBean\" lazy-init=\"default\" autowire=\"default\" dependency-check=\"default\" >\n  \t<property name=\"xidFactory\" ref=\"xidFactory\" />\n  </bean>\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T12:04:18.679+0000","updated":"2008-11-03T12:04:18.679+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482716/comment/12940452","id":"12940452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"These fixes will now make 5.2.0 rc3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-06T10:47:07.860+0000","updated":"2008-11-06T10:47:07.860+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1824/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1826f:"}}