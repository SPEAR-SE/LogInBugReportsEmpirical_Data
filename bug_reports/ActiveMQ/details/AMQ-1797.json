{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482917","self":"https://issues.apache.org/jira/rest/api/2/issue/12482917","key":"AMQ-1797","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-06-14T07:00:05.751+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 01 11:06:08 UTC 2009","customfield_12310420":"84766","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_133675617_*|*_5_*:*_2_*:*_12477399966_*|*_4_*:*_1_*:*_20542160640","customfield_12312321":null,"resolutiondate":"2009-07-01T11:06:08.805+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1797/watchers","watchCount":4,"isWatching":false},"created":"2008-06-12T17:52:12.582+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-01T11:06:53.256+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have some problems with multiple durable subscribers while persistent delivery is used.\nMessage should be deleted from disc storage (periodically) after all interested subscribers have received it. In case there was one durable subscriber everything woks just fine. However when I tested this scenerio with two durable subscribers on topic,  the messages were never deleted (disc usage is continously consumed and never purged). \n\n\nTest case description:\n-using default activemq.xml configuration file from binary distribution \n-TopicConsumers.java creates two separetes durable consumers\n-textMessageFile.txt is file which text is sent by producer (place it on classpath)\n\nResult:\n-all messages there were send were also received by both subscribers\n-after more then 100k messages data directory is about 1GB. \n-restarting activemq with so big persistent storage takes very long time","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461319","id":"12461319","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-25T12:55:42.491+0000","size":4628,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461319/activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461119","id":"12461119","filename":"ASF.LICENSE.NOT.GRANTED--textMessageFile.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-12T17:52:12.595+0000","size":8846,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461119/ASF.LICENSE.NOT.GRANTED--textMessageFile.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461054","id":"12461054","filename":"ASF.LICENSE.NOT.GRANTED--TopicConsumers.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-12T17:52:12.591+0000","size":3172,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461054/ASF.LICENSE.NOT.GRANTED--TopicConsumers.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460986","id":"12460986","filename":"ASF.LICENSE.NOT.GRANTED--TopicProducer.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-12T17:52:12.593+0000","size":4030,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12460986/ASF.LICENSE.NOT.GRANTED--TopicProducer.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461355","id":"12461355","filename":"kaha_amq.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-25T12:53:01.966+0000","size":9459,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461355/kaha_amq.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461192","id":"12461192","filename":"Storage_cleanup_Redelivery_test.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-05T16:54:12.551+0000","size":9150,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461192/Storage_cleanup_Redelivery_test.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161849","customfield_12312823":null,"summary":"persistent messages for durable subscribers are not purged from disc storage","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12481900","key":"AMQ-2123","self":"https://issues.apache.org/jira/rest/api/2/issue/12481900","fields":{"summary":"Intermittent Test failure: DuplexNetworkTest.testDurableStoreAndForward  (org.apache.activemq.network) - java.lang.IllegalStateException: Message id ID:... could not be recovered from the data store - already dispatched","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}},{"id":"12482921","key":"AMQ-2303","self":"https://issues.apache.org/jira/rest/api/2/issue/12482921","fields":{"summary":"Durable consumers recovery ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"WinXP,\njava version \"1.6.0_05\"\nJava(TM) SE Runtime Environment (build 1.6.0_05-b13)\nJava HotSpot(TM) Client VM (build 10.0-b19, mixed mode, sharing)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482917/comment/12939806","id":"12939806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"body":"It looks that there is a problem in activemq journal wich is used by default amqPersistenceAdapter.  I have tested this also on amq 4.1.1 journaledJDBC adapter with same bug.\nWhen jdbcPersistenceAdapter with 4.1.1(non-journal) or kahaPersistenceAdapter with 5.1 are used with 2 durable topic subscribers, disc storage is periodically emptied.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-13T15:01:52.890+0000","updated":"2008-06-13T15:01:52.890+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482917/comment/12939820","id":"12939820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed by SVN revision 667752 and revision 667756","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2008-06-14T07:00:05.751+0000","updated":"2008-06-14T08:34:41.352+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482917/comment/12940525","id":"12940525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"body":"I've tested AMQ 5.2 SNAPSHOT for this fix with partial success. There isn't any problem every message from Topic is acknoledged but solution doesn't work when some of messages are regulary received by durable subscribers and some of them are redeliverd till they get to ActiveMQ.DLQ due to exceeding max redelivery count.\nTo duplicate error see attached zip .\n\n-TopicRedeliver creates two separetes durable consumers, which consumes every odd message and recover session if message number is even. Parameter \"jms.redeliveryPolicy.maximumRedeliveries=1\" causes that after first redelivery message goes to dead letter queue.\n-DlqConsumer consumes messages from ActiveMQ.DLQ\n-TopicProducer sends messages to testTopic\n\nReproducing steps:\n1. run DlqConsumer\n2. run TopicRedeliver\n3. run TopicProducer\n\nResults:\n1.\n%ACTIVEMQ_HOME%/data/journal dir contains several data-x files. More messages you send more data-x files stays in mentioned dir and consumes disc space.(however some of them are deleted this behaviour isn't predictible)\nSomething is going obviously wrong because all messages are consumed from destinations (testTopic and ActiveMQ.DLQ).\n2.\nSize of ActiveMQ.DLQ shown in jConsole is possitive number, despite that DlqConsumer doesn't consume messages anymore.\n3.\nIf TopicRedeliver and DlqConsumer are restarted, any further sending of messages may causes folowing exception:\nERROR RecoveryListenerAdapter        - Message id ID:sk1d069c-4253-1225900870814-0:0:1:1:42 could not be recovered from the data store - already dispatched\n\nUsing AMQ 5.2. stable release is even not possible run this test - after couple hundred messages one of durable subscriber get stuck (see https://issues.apache.org/activemq/browse/AMQ-2021 ) .\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-05T16:54:12.596+0000","updated":"2008-12-02T13:11:07.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482917/comment/12940846","id":"12940846","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"body":"Tests on amq revision number 729038 with amqPersistenceAdapter as well as with kahaPersistenceAdapter but none of them was sucessful\nfrom different reasons.\n\nWith amqPersistenceAdapter, 100k msgs have been sent and data directory size is 1.1 GB. \nFurther message sending make any difference - message store still grows. For addition following error occures several times:\nERROR RecoveryListenerAdapter        - Message id ... could not be recovered from the data store - already dispatched\n\nUsing kahaPersistenceAdapter, after 100k msgs one of the consumer receives 100k second 99999 msgs.After another 300k msgs data directory size is 410MB. Also some errors are logged by AMQ:\n\nERROR DataManagerImpl                - Looking for key 15 but not found in fileMap: {17=data-queue-data-17 number = 17 , length = 177868 refCount = 6, 16=data-queue-data-16 number = 16 , length = 33546816 refCount = 86}\nERROR MapContainerImpl               - Failed to get value for offset=4845, key=(15, 29641420, 47), value=(15, 29641472, 8839), previousItem=-1, nextItem=-1\njava.io.IOException: Could not locate data file data-queue-data-15\n        at org.apache.activemq.kaha.impl.data.DataManagerImpl.getDataFile(DataManagerImpl.java:129)\n        at org.apache.activemq.kaha.impl.data.SyncDataFileReader.readItem(SyncDataFileReader.java:65)\n        at org.apache.activemq.kaha.impl.data.DataManagerImpl.readItem(DataManagerImpl.java:141)\n        at org.apache.activemq.kaha.impl.container.MapContainerImpl.getValue(MapContainerImpl.java:481)\n        at org.apache.activemq.store.kahadaptor.KahaMessageStore.recoverNextMessages(KahaMessageStore.java:166)\n        at org.apache.activemq.store.ProxyMessageStore.recoverNextMessages(ProxyMessageStore.java:83)\n        at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.doFillBatch(QueueStorePrefetch.java:92)\n        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.fillBatch(AbstractStoreCursor.java:236)\n        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.hasNext(AbstractStoreCursor.java:136)\n        at org.apache.activemq.broker.region.cursors.StoreQueueCursor.hasNext(StoreQueueCursor.java:131)\n        at org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1180)\n        at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1308)\n        at org.apache.activemq.broker.region.Queue.iterate(Queue.java:1008)\n        at org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)\n        at org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)\n        at java.lang.Thread.run(Thread.java:619)\nERROR AbstractStoreCursor            - Failed to fill batch for more see atached log - kaha_amq.log\n\nFor this tests it was necessary to adjust memory usage and limit settings - view attached activemq.xml.\nTested on SUSE Linux Enterprise Server 10.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-25T12:51:59.315+0000","updated":"2009-02-25T12:51:59.315+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482917/comment/12940844","id":"12940844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"body":"config file used to test rev. number 729038","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-25T12:55:42.629+0000","updated":"2009-02-25T12:55:42.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482917/comment/12940821","id":"12940821","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"the fix for http://issues.apache.org/activemq/browse/AMQ-2123 will help with the \"could not be recovered from the data store - already dispatched\" issue. This should also help with store management as it ensures that references are correctly cleaned up.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-25T23:24:13.070+0000","updated":"2009-02-25T23:24:56.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482917/comment/12940869","id":"12940869","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"body":"I've tested amq revision number 747951. Cleaning storage using amqPersistenceAdapter is better now, but there are still files that, in my opinion, need to be deleted  - in data/journal/ directory after receiving sotps there are still files data-47 and data-87 and no other number between (I guess that in optimal state should be file numbering continous).\nThere is also problem that from 100k msgs sent message  have been only 97208 acknowledged (it should be 100k on both receivers, while every odd message is ack) and  \"already dispatched\" error is still there.\n\nwith kahaPersistenceAdapter is behaviour very similar as before.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=durokuruc","name":"durokuruc","key":"durokuruc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Juraj Kuruc","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-27T13:25:25.304+0000","updated":"2009-02-27T13:25:25.304+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482917/comment/12941029","id":"12941029","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"test latest trunk 756591\n\nin network of broker setup( 4 pair master/slave), if I kill TopicConsumers during processing messages and restart it, i will see \"Message id ... could not be recovered from the data store - already dispatched\"\n\ni also see \"ERROR MasterBroker                   - Slave Failed\njavax.jms.JMSException: Unmatched acknowledege: MessageAck {commandId = 62608, responseRequired = true, ackType = 2, consumerId = ID:host-2343-1237580790173-0:1:1:1, firstMessageId = ID:host-2341-1237580773986-0:0:1:1:1341, lastMessageId = ID:host-2341-1237580773986-0:0:1:1:1341, destination = topic://testTopic, transactionId = null, messageCount = 1}; Could not find Message-ID ID:host-2341-1237580773986-0:0:1:1:1341 in dispatched-list (start of ack)\"\n\none pair of master/slave, the results are much better. topic consumer seems to recover and continue processing ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-20T21:07:06.225+0000","updated":"2009-03-20T21:07:06.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482917/comment/12941664","id":"12941664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Some of the commits for the AMQ-2303 seems to fixed this one as well (at least as far as I can test it). Please reopen if doesn't work with svn revision 790113","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2009-07-01T11:06:08.800+0000","updated":"2009-07-01T11:06:08.800+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1797/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s2av:"}}