{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483522","self":"https://issues.apache.org/jira/rest/api/2/issue/12483522","key":"AMQ-1548","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2010-09-09T17:49:32.513+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Oct 29 20:01:00 UTC 2012","customfield_12310420":"84657","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_151107263576_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-10-29T20:01:00.294+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1548/watchers","watchCount":2,"isWatching":false},"created":"2008-01-15T21:46:36.751+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-10-29T20:01:00.325+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"After bringing the brokers up and down a few times, I'll get the following errors:\n\nINFO  DemandForwardingBridge         - Network connection between vm://activemq2#0 and tcp://activemq1/192.168.2.129:61616(activemq1) has been established.\nERROR Service                        - Async error occurred: javax.jms.JMSException: Durable consumer is in use for client: NC_activemq1_inboundactivemq2 and subscriptionName: activemq2_fof\njavax.jms.JMSException: Durable consumer is in use for client: NC_activemq1_inboundactivemq2 and subscriptionName: activemq2_fof\n        at org.apache.activemq.broker.region.TopicRegion.addConsumer(TopicRegion.java:75)\n        at org.apache.activemq.broker.region.RegionBroker.addConsumer(RegionBroker.java:338)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:85)\n        at org.apache.activemq.advisory.AdvisoryBroker.addConsumer(AdvisoryBroker.java:80)\n        at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:85)\n        at org.apache.activemq.broker.MutableBrokerFilter.addConsumer(MutableBrokerFilter.java:95)\n        at org.apache.activemq.broker.TransportConnection.processAddConsumer(TransportConnection.java:525)\n        at org.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:334)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:281)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:178)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:100)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:67)\n        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:202)\n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\nINFO  DemandForwardingBridge         - Network connection between vm://activemq2#0 and tcp://activemq1/192.168.2.129:61616 shutdown due to a local error: javax.jms.JMSException: Durable consumer is in use for client: NC_activemq1_inboundactivemq2 and subscriptionName: activemq2_fof\nINFO  TransportConnector             - Connector vm://activemq2 Stopped\nINFO  DemandForwardingBridge         - activemq2 bridge to activemq1 stopped\n\nMy two servers are activemq1 and activemq2.  The queue is specified in the activemq.xml using:\n<destinations>\n        <topic physicalName=\"fof\" />\n</destinations>\n\nThrough debugging, I tracked this down to a race condition between the listening port (61616) and the created port (incremental) creating the connection.  In the one case, it creates a durable topic, in the other it doesn't (I can't remember which is which).  Regardless, when the connection fails (or is shutdown) the durable topic isn't stopped, and thus the reconnection fails.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461854","id":"12461854","filename":"activemq-broker.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lekkie","name":"lekkie","key":"lekkie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lekan Omotayo","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-09T17:49:32.336+0000","size":6137,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461854/activemq-broker.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461832","id":"12461832","filename":"activemq-broker2.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lekkie","name":"lekkie","key":"lekkie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lekan Omotayo","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-09T17:49:32.383+0000","size":6137,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461832/activemq-broker2.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461833","id":"12461833","filename":"jms configuration.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lekkie","name":"lekkie","key":"lekkie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lekan Omotayo","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-09T17:49:32.468+0000","size":4231,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461833/jms+configuration.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461855","id":"12461855","filename":"log.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lekkie","name":"lekkie","key":"lekkie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lekan Omotayo","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-09T17:50:50.760+0000","size":4147,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461855/log.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59849","customfield_12312823":null,"summary":"Mutlicast discovery with persistent topics leads to errors","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeff.ward","name":"jeff.ward","key":"jeff.ward","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Ward","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeff.ward","name":"jeff.ward","key":"jeff.ward","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Ward","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"2 Ubuntu machines running virualized named activemq1 and activemq2 set up for multicast discovery.  Broker names are set to be the same as the host name","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483522/comment/12942873","id":"12942873","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lekkie","name":"lekkie","key":"lekkie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lekan Omotayo","active":true,"timeZone":"Etc/UTC"},"body":"I have two brokers A & B.\n\nI have attached both activemq config file, my jms provider configuration in camel and the log that comes from servicemix.\n\nWhenever I send a request from camel into a queue in brokerA, which a consumer in brokerB is listening to, the request never gets to the consumer, instead it goes into DLQ.retailpay.\n\nIt appends DLQ to the queue because somewhere in my activemq config file, I ad specify this:\n\n\t<destinationPolicy xmlns=\"http://activemq.apache.org/schema/core\">\n\t    <policyMap>\n\t\t<policyEntries>\n\t\t    <policyEntry queue=\">\" producerFlowControl=\"true\" memoryLimit=\"20mb\">\n\t\t\t<deadLetterStrategy>\n\t\t\t  <individualDeadLetterStrategy queuePrefix=\"DLQ.\" useQueueForQueueMessages=\"true\" />\n\t\t\t</deadLetterStrategy>\n\t\t    </policyEntry>\n\t\t    <policyEntry topic=\">\" producerFlowControl=\"true\" memoryLimit=\"20mb\">\n\t\t    </policyEntry>\n\t\t</policyEntries>\n\t    </policyMap>\n\t</destinationPolicy>\n\t\nIts quite strange, because when I insert message into brokerA's queue from activemq web console, the consumer listening for the message on the queue in brokerB gets the message and samething when I sent the message from \"ant producer -Durl=tcp://broker1:61616 -Dtopic=false -Dsubject=myqueue -Ddurable=true -Dmax=1\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lekkie","name":"lekkie","key":"lekkie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lekan Omotayo","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-09T17:49:32.513+0000","updated":"2010-09-09T17:49:32.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483522/comment/12942893","id":"12942893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Lekan, you will need to come up with a test case. I had a cursory look at the two broker configs, both use the same brokerName which is not advisable and both include duplex network connectors, because both have network connectors configured they don't need to be duplex. Not sure if any of that is the root cause though.\nThe odd think is that in the servicemix log, some component is connecting to a broker with name testESB which does not seem to be related to either config. It uses the vm://localhost url and can only find a broker with name testESB, where does that broker come from?\n\nOne plan of attack may be to try and reproduce with just camel and activemq, leaving service mix out of the equation to see if the issue can be isolated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-10T10:24:48.497+0000","updated":"2010-09-10T10:24:48.497+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483522/comment/13486298","id":"13486298","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Without a test case there's little else we can do here.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-10-29T20:01:00.309+0000","updated":"2012-10-29T20:01:00.309+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1548/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0am2n:"}}