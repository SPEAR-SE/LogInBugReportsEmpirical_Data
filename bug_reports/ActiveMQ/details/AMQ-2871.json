{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481063","self":"https://issues.apache.org/jira/rest/api/2/issue/12481063","key":"AMQ-2871","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2010-08-17T10:32:04.563+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jul 11 20:14:54 UTC 2011","customfield_12310420":"43753","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_28375419657_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-11T20:14:54.172+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2871/watchers","watchCount":1,"isWatching":false},"created":"2010-08-17T10:11:14.532+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-07-11T20:14:54.183+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have a fairly simple set-up with a single Activemq.\n\nOn that AMQ we have a few queue's and topics, where the topics are filled using PHP producers with Stomp and four Java subscribers with the normal openwire protocol (via a Spring jms listener container). The PHP producers are created on demand and send a single, tiny text message when some data needs to be adjusted in the Java subscribers.\n\nThe problem is that all four consumers sometimes receive a message without such a text body. Using tcpdump I deciphered that the incoming Stomp-message actually did have a body, so the senders work correctly. Again using tcpdump I noticed the messages on the openwire channel are sometimes empty, so the problem seems to be with the ActiveMQ server part.\n\nNot all messages fail, but its way too common (a rough estimate would be one in ten or so). I also didn't see any message empty when using a OpenWire-producer.\n\nMy configuration is rather trivial, its the default config without systemusage and destinationpolicy. With the stomp and openwire transporters like so:\n<transportConnector name=\"stomp\" uri=\"stomp://0.0.0.0:61613?transport.closeAsync=false\"/>\n\n\nWhen logging the messages in the subscribers, it looks like this for a correct one:\nActiveMQTextMessage {commandId = 3, responseRequired = false, messageId = ID:argus-38958-1279890714168-2:66257231:-1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:argus-38958-1279890714168-2:66257231:-1:1, destination = topic://pw_cache_products, transactionId = null, expiration = 0, timestamp = 1281801902987, arrival = 0, brokerInTime = 1281801902987, brokerOutTime = 1281801902988, correlationId = null, replyTo = null, persistent = false, type = null, priority = 0, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, text = views 0}\n\nAnd like this for an incorrect one:\nActiveMQTextMessage {commandId = 3, responseRequired = false, messageId = ID:argus-38958-1279890714168-2:66384399:-1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:argus-38958-1279890714168-2:66384399:-1:1, destination = topic://pw_cache_products, transactionId = null, expiration = 0, timestamp = 1281805503252, arrival = 0, brokerInTime = 1281805503252, brokerOutTime = 1281805503252, correlationId = null, replyTo = null, persistent = false, type = null, priority = 0, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, text = null}\n\nI.e. text = null vs text = views 0\n\nI couldn't reproduce this on another system so far. And my production ActiveMQ that displays this behaviour gets way to much traffic to put in in debug-logging-mode (and I doubt that will offer much insight anyway?). I can reproduce it on a newly created topic on the same activemq with only one consumer and producer, but not on a separate activemq. Whether that is because it has less load or whatever I don't know, the original activemq that does exhibit this behaviour has been upgraded and restarted several times since we first started noticing the problems that led to this discovery.\n\nMy consumers and producers are about the most trivial variants you can think off, but the other producers and consumers obviously aren't.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172326","customfield_12312823":null,"summary":"Activemq loses Stomp text message body on topic","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acm","name":"acm","key":"acm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjen","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acm","name":"acm","key":"acm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjen","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Debian linux 64bit, with:\n java version \"1.6.0_18\"\nOpenJDK Runtime Environment (IcedTea6 1.8) (6b18-1.8-1)\nOpenJDK 64-Bit Server VM (build 14.0-b16, mixed mode)\n\nActiveMQ 5.3.2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481063/comment/12938178","id":"12938178","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Arjen,\n\ncan you turn on debugging on the stomp connector and trace stomp frames coming to the broker\n\nhttp://activemq.apache.org/stomp.html#Stomp-Debugging","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-08-17T10:32:04.563+0000","updated":"2010-08-17T10:32:04.563+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481063/comment/12938289","id":"12938289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acm","name":"acm","key":"acm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjen","active":true,"timeZone":"Europe/Berlin"},"body":"I did (it gave me 105MB of logfile) but it all looks correct to me, all of them are like:\n\n-----\n2010-08-17 13:36:00,176 [10.0.1.15:34486] TRACE StompTransportFilter           - Received:\nCONNECT\npasscode:\nlogin:\n\n\n2010-08-17 13:36:00,176 [10.0.1.15:34486] TRACE StompTransportFilter           - Sending:\nCONNECTED\nsession:ID:argus-54091-1282044328525-2:39536\n\n\n2010-08-17 13:36:00,176 [10.0.1.15:34486] TRACE StompTransportFilter           - Received:\nSEND\ndestination:/topic/pw_cache_products\n\nbogus\n2010-08-17 13:36:00,177 [10.0.1.15:34486] TRACE StompTransportFilter           - Received:\nDISCONNECT\n\n\n2010-08-17 13:36:00,206 [10.0.1.33:37464] TRACE StompTransportFilter           - Received:\nCONNECT\npasscode:\nlogin:\n\n-----","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acm","name":"acm","key":"acm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjen","active":true,"timeZone":"Europe/Berlin"},"created":"2010-08-17T11:47:08.493+0000","updated":"2010-08-17T11:47:08.493+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481063/comment/12936359","id":"12936359","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acm","name":"acm","key":"acm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjen","active":true,"timeZone":"Europe/Berlin"},"body":"Btw, I can only reproduce the behaviour when multiple listeners are connected to the test-topic. A single one doesn't exhibit the behaviour. When it does happen then, all listeners get the null-message.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acm","name":"acm","key":"acm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjen","active":true,"timeZone":"Europe/Berlin"},"created":"2010-08-25T20:02:20.416+0000","updated":"2010-08-25T20:02:20.416+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481063/comment/13025691","id":"13025691","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ipechorin","name":"ipechorin","key":"ipechorin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Pechorin","active":true,"timeZone":"Asia/Dubai"},"body":"I believe, \"Stomp\" in the subject is misleading: the problem is on the consumer side, with consumers connected via OpenWire. \n\nWe face the same problem without using Stomp at all: both the producer and the multiple consumers are Java clients connected via OpenWire.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ipechorin","name":"ipechorin","key":"ipechorin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Pechorin","active":true,"timeZone":"Asia/Dubai"},"created":"2011-04-27T09:36:38.152+0000","updated":"2011-04-27T09:36:38.152+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481063/comment/13025693","id":"13025693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ipechorin","name":"ipechorin","key":"ipechorin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Pechorin","active":true,"timeZone":"Asia/Dubai"},"body":"in addition to 5.3.2, the same is reproduced on 5.4.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ipechorin","name":"ipechorin","key":"ipechorin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Pechorin","active":true,"timeZone":"Asia/Dubai"},"created":"2011-04-27T09:38:19.131+0000","updated":"2011-04-27T09:38:19.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481063/comment/13025694","id":"13025694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acm","name":"acm","key":"acm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjen","active":true,"timeZone":"Europe/Berlin"},"body":"Actually, in my bug investigation it was neither the consumer nor producer side, the Broker just lost the contents somewhere in those occasions. So when printing the received contents of the message, the body was there. But tracing the dataflow afterwards, when it was sent to either a OpenWire or Stomp consumer, it had no body anymore.\n\nI was only able to reproduce it in a very complicated scenario using Stomp-producers, but if you have a scenario where OpenWire-producers yield the same result... than its appearanlty somewhere deeper inside ActiveMQ.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acm","name":"acm","key":"acm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arjen","active":true,"timeZone":"Europe/Berlin"},"created":"2011-04-27T09:43:43.110+0000","updated":"2011-04-27T09:43:43.110+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481063/comment/13063502","id":"13063502","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Several fixes in trunk may have resolved this issue, such as AMQ-2966.  Reopen if you can provide a test case that shows the error using a 5.6 SNAPSHOT build.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-07-11T20:14:54.180+0000","updated":"2011-07-11T20:14:54.180+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2871/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tuyv:"}}