{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482681","self":"https://issues.apache.org/jira/rest/api/2/issue/12482681","key":"AMQ-2270","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-09-09T10:03:53.409+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 10 16:05:33 UTC 2011","customfield_12310420":"65572","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_8937126487_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-09-09T10:03:53.452+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2270/watchers","watchCount":1,"isWatching":false},"created":"2009-05-28T23:31:46.965+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-08-10T16:05:33.872+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Hi , \n   Have two brokers in network AMQ1 and AMQ2 and have lots of virtual topics configured , Some consumers exists on some queues on AMQ1 and vice versa . On some queues AMQ2 have a consumers with a selector and hence consume a certain percentage of messages and the queue gets filled up every time my test program runs . After a certain number of test runs when the queues on AMQ2 have about 2800 pending messages , I have observerd that the messages got forwarded over to AMQ1 though AMQ1 have no consumers on these queues .\nAfter certain point producer cannot send any more messages to AMQ1 and dint see any exceptions on the producer side (no activity on Queues in admin console) .\nKilled AMQ1 and tried to restart it , It took long time to restart and issued a kill command again and then restarted .\nNow all my pending messages on AMQ1 have disappeared and this is what i see on console during start up .\n\n\nINFO  BrokerService                  - Using Persistence Adapter: AMQPersistenceAdapter(/home/prem/software/apache-activemq-5.2.0/data.1)\nINFO  AMQPersistenceAdapter          - AMQStore starting using directory: /home/prem/software/apache-activemq-5.2.0/data.1\nINFO  KahaStore                      - Kaha Store using data directory /home/prem/software/apache-activemq-5.2.0/data.1/kr-store/state\nINFO  AMQPersistenceAdapter          - Active data files: []\nWARN  AMQPersistenceAdapter          - The ReferenceStore is not valid - recovering ...\nINFO  KahaStore                      - Kaha Store successfully deleted data directory /home/prem/software/apache-activemq-5.2.0/data.1/kr-store/data\nINFO  AMQPersistenceAdapter          - Journal Recovery Started from: DataManager:(data-)\nINFO  KahaStore                      - Kaha Store using data directory /home/prem/software/apache-activemq-5.2.0/data.1/kr-store/data\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161816","customfield_12312823":null,"summary":"Activemq lost messages on restart","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mprem74","name":"mprem74","key":"mprem74","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"madderla prem kumar","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mprem74","name":"mprem74","key":"mprem74","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"madderla prem kumar","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482681/comment/12941049","id":"12941049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"This is issue will be resolved in 5.3 by using the KahaDB","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-09T10:03:53.409+0000","updated":"2009-09-09T10:03:53.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482681/comment/13081684","id":"13081684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rasitha1","name":"rasitha1","key":"rasitha1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rasitha Wijesinghe","active":true,"timeZone":"America/Chicago"},"body":"Do you know if there is a fix for this when using jdbcPersistenceAdapter? \n\nI'm using 5.4.2 broker with jdbcPersistenceAdapter and was able to reproduce this bug. I created a Consumer.*.VirtualTopic.FOO and published a message to VirtualTopic.FOO with Persistent Delivery. Message correctly got to the queue and then I restarted the broker. Now the queue and the message are gone. When I query ACTIVEMQ_MSGS table, I see the message and the queue but upon restarting broker does not pick that up.\n\nTried the same with KahaDB and that works.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rasitha1","name":"rasitha1","key":"rasitha1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rasitha Wijesinghe","active":true,"timeZone":"America/Chicago"},"created":"2011-08-09T15:04:57.463+0000","updated":"2011-08-09T15:04:57.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482681/comment/13081721","id":"13081721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"can you validate 5.5.0 for the jdbc persistence adapter and open a new issue if you still see a problem?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-09T16:05:33.939+0000","updated":"2011-08-09T16:05:33.939+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482681/comment/13082429","id":"13082429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rasitha1","name":"rasitha1","key":"rasitha1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rasitha Wijesinghe","active":true,"timeZone":"America/Chicago"},"body":"The same issue exists in 5.5 broker.\n\nJust to note: Both 5.4.2 and 5.5 will show the message in the database once you create the queue (Consumer.MyClient.VirtualTopic.FOO) manually. Then all messages in the DB shows up in the queue. But the problem is, any message published to the virtual topic since the restart is lost to that consumer (until it connects next time which creates the queue).\n\nWith KahaDB this is not the case. It will correctly show the queue right after the restart with existing messages so any newly published messages will continue coming to the queue.\n\nI'll open a new issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rasitha1","name":"rasitha1","key":"rasitha1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rasitha Wijesinghe","active":true,"timeZone":"America/Chicago"},"created":"2011-08-10T16:05:33.841+0000","updated":"2011-08-10T16:05:33.841+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2270/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s23j:"}}