{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12724267","self":"https://issues.apache.org/jira/rest/api/2/issue/12724267","key":"AMQ-5249","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-07-02T10:29:24.157+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 13 11:12:12 UTC 2017","customfield_12310420":"402452","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4464617277_*|*_4_*:*_1_*:*_80423166749_*|*_6_*:*_2_*:*_717138563","customfield_12312321":null,"resolutiondate":"2017-03-14T21:08:19.935+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5249/watchers","watchCount":16,"isWatching":false},"created":"2014-06-28T01:59:37.393+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326455","id":"12326455","name":"5.9.1","archived":false,"released":true,"releaseDate":"2014-04-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[{"id":"12491091","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12491091","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13034590","key":"AMQ-6562","self":"https://issues.apache.org/jira/rest/api/2/issue/13034590","fields":{"summary":"WARN TopicStorePrefetch cursor got duplicate from store","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-03-14T21:08:19.975+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I was using 5.9.0 and meet one problem so I tried to upgrade activemq. I tried both 5.9.1 and 5.10.0 and encouterred a same problem. I saw messages filled DLQ very quickly. I checked the clients both producer and consumer but there was no error. I checked activemq log and found the log is full of these warnings:\n2014-06-27 23:22:09,337 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@19117501:com.cyyun.webmon.spider.update,batchResetNeeded=false,storeHasMessages=true,size=211,cacheEnabled=true,maxBatchSize:200,hasSpace:true - cursor got duplicate: ID:211.com-52399-1400732399425-1:1:235992:1:1, 4 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ Broker[localhost] Scheduler\n2014-06-27 23:22:09,337 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@19117501:com.xxxx.update,batchResetNeeded=false,storeHasMessages=true,size=211,cacheEnabled=true,maxBatchSize:200,hasSpace:true - cursor got duplicate: ID:nbzjjf22805-34129-1403880308671-1:1:28:1:1, 4 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ Broker[localhost] Scheduler\n2014-06-27 23:22:09,338 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@19117501:com.xxxxx.update,batchResetNeeded=false,storeHasMessages=true,size=211,cacheEnabled=true,maxBatchSize:200,hasSpace:true - cursor got duplicate: ID:jxncxnj2-48598-1403856107346-1:1:6007:1:1, 4 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ Broker[localhost] Scheduler\n2014-06-27 23:22:09,338 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@19117501:com.xxxx.update,batchResetNeeded=false,storeHasMessages=true,size=211,cacheEnabled=true,maxBatchSize:200,hasSpace:true - cursor got duplicate: ID:jxnc17-60227-1400730816361-1:1:149072:1:1, 4 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ Broker[localhost] Scheduler\n2014-06-27 23:22:09,339 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@19117501:com.xxxx.update,batchResetNeeded=false,storeHasMessages=true,size=211,cacheEnabled=true,maxBatchSize:200,hasSpace:true - cursor got duplicate: ID:cyyun-46954-1403800808565-1:1:9765:1:1, 4 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ Broker[localhost] Scheduler\n2014-06-27 23:22:09,339 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@19117501:com.xxxx.update,batchResetNeeded=false,storeHasMessages=true,size=211,cacheEnabled=true,maxBatchSize:200,hasSpace:true - cursor got duplicate: ID:ubuntu-55495-1403497638437-1:1:53086:1:1, 4 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ Broker[localhost] Scheduler\n2014-06-27 23:22:09,340 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@19117501:com.xxxx.update,batchResetNeeded=false,storeHasMessages=true,size=211,cacheEnabled=true,maxBatchSize:200,hasSpace:true - cursor got duplicate: ID:cyyun-39030-1403880008363-1:1:70:1:1, 4 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ Broker[localhost] Scheduler\n\nThe problem mostly happens right after activemq starts and sometimes happened after activemq worked normally for a while.\n\nFor now I have to roll back to 5.9.0 and the problem doesn't occure.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"402519","customfield_12312823":null,"summary":"\"cursor got duplicate\" error after upgrade","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14049808","id":"14049808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Can you describe the nature of your usecase?\nThe fix for https://issues.apache.org/jira/browse/AMQ-5212 may be what you need. It narrows down the dlq processing on duplicates from the store. You would need to verify against a 5.11-SNAPSHOT to confirm.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-02T10:29:24.157+0000","updated":"2014-07-02T10:29:24.157+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14051275","id":"14051275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"body":"I'm not sure how to describe the usercase. I checked the messages in DLQ and they are from a same queue. The queue is populated by activemq component in apache camel and consumed by another java application.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-07-03T09:53:07.614+0000","updated":"2014-07-03T09:53:07.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14078524","id":"14078524","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/activemq/pull/36\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-29T22:37:45.823+0000","updated":"2014-07-29T22:37:45.823+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14100972","id":"14100972","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The use case and broker configuration are not given.  There is not enough information to investigate this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-08-18T18:09:54.664+0000","updated":"2014-08-18T18:09:54.664+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14111712","id":"14111712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"body":"This happens again today. Please check  my broker configuration below:\n<broker xmlns=\"http://activemq.apache.org/schema/core\" brokerName=\"localhost\" dataDirectory=\"${activemq.data}\">\n\n        <destinationPolicy>\n            <policyMap>\n              <policyEntries>\n                <policyEntry topic=\">\" >\n                    <!-- The constantPendingMessageLimitStrategy is used to prevent\n                         slow topic consumers to block producers and affect other consumers\n                         by limiting the number of messages that are retained\n                         For more information, see:\n\n                         http://activemq.apache.org/slow-consumer-handling.html\n\n                    -->\n                  <pendingMessageLimitStrategy>\n                    <constantPendingMessageLimitStrategy limit=\"1000\"/>\n                  </pendingMessageLimitStrategy>\n                </policyEntry>\n              </policyEntries>\n            </policyMap>\n        </destinationPolicy>\n\n\n        <!--\n            The managementContext is used to configure how ActiveMQ is exposed in\n            JMX. By default, ActiveMQ uses the MBean server that is started by\n            the JVM. For more information, see:\n\n            http://activemq.apache.org/jmx.html\n        -->\n        <managementContext>\n            <managementContext createConnector=\"false\"/>\n        </managementContext>\n\n        <!--\n            Configure message persistence for the broker. The default persistence\n            mechanism is the KahaDB store (identified by the kahaDB tag).\n            For more information, see:\n\n            http://activemq.apache.org/persistence.html\n        -->\n        <persistenceAdapter>\n            <!--<levelDB directory=\"${activemq.data}/leveldb\"/>-->\n\t\t<kahaDB directory=\"${activemq.data}/kahadb\"/>\n        </persistenceAdapter>\n\n\n          <!--\n            The systemUsage controls the maximum amount of space the broker will\n            use before disabling caching and/or slowing down producers. For more information, see:\n            http://activemq.apache.org/producer-flow-control.html\n          -->\n          <systemUsage>\n            <systemUsage>\n                <memoryUsage>\n                    <memoryUsage percentOfJvmHeap=\"70\" />\n                </memoryUsage>\n                <storeUsage>\n                    <storeUsage limit=\"100 gb\"/>\n                </storeUsage>\n                <tempUsage>\n                    <tempUsage limit=\"50 gb\"/>\n                </tempUsage>\n            </systemUsage>\n        </systemUsage>\n\n        <!--\n            The transport connectors expose ActiveMQ over a given protocol to\n            clients and other brokers. For more information, see:\n\n            http://activemq.apache.org/configuring-transports.html\n        -->\n        <transportConnectors>\n            <!-- DOS protection, limit concurrent connections to 1000 and frame size to 100MB -->\n            <transportConnector name=\"openwire\" uri=\"tcp://0.0.0.0:61616?maximumConnections=5000&amp;wireFormat.maxFrameSize=104857600\"/>\n            <transportConnector name=\"amqp\" uri=\"amqp://0.0.0.0:5672?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600\"/>\n            <transportConnector name=\"stomp\" uri=\"stomp://0.0.0.0:61613?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600\"/>\n            <transportConnector name=\"mqtt\" uri=\"mqtt://0.0.0.0:1883?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600\"/>\n            <transportConnector name=\"ws\" uri=\"ws://0.0.0.0:61614?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600\"/>\n\t    <transportConnector name=\"nio\" uri=\"nio://0.0.0.0:62626?maximumConnections=10000&amp;wireFormat.maxFrameSize=104857600\"/>\n        </transportConnectors>\n\n        <!-- destroy the spring context on shutdown to stop jetty -->\n        <shutdownHooks>\n            <bean xmlns=\"http://www.springframework.org/schema/beans\" class=\"org.apache.activemq.hooks.SpringContextHook\" />\n        </shutdownHooks>\n\n    </broker>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-08-27T01:22:13.213+0000","updated":"2014-08-27T01:22:13.213+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14111723","id":"14111723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"body":"This usually can be fixed by restarting activemq","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-08-27T01:39:27.210+0000","updated":"2014-08-27T01:39:27.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14169031","id":"14169031","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal","name":"anujkhandelwal","key":"anujkhandelwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"body":"I saw same warnings in my broker today. Broker is running with ActiveMQ 5.10. and in my configuration I am using discardingDLQplugin. \n\n       <amq:plugins>\n            <amq:discardingDLQBrokerPlugin dropAll=\"true\"/>          \n        </amq:plugins>\n\n\nThanks,\nAnuj\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal","name":"anujkhandelwal","key":"anujkhandelwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-13T07:22:48.308+0000","updated":"2014-10-13T07:22:48.308+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14186682","id":"14186682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski_","name":"pbruski_","key":"pbruski_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Europe/Warsaw"},"body":"We're seeing this too on 5.10. If there's anything we can do to help, let us know.\nWe've upgraded from 5.9.0, which was rock stable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski_","name":"pbruski_","key":"pbruski_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Europe/Warsaw"},"created":"2014-10-28T10:42:13.481+0000","updated":"2014-10-28T10:42:41.618+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14188234","id":"14188234","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski_","name":"pbruski_","key":"pbruski_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Europe/Warsaw"},"body":"This is our broker definition\n{code}\n    <bean id=\"broker\" class=\"com.atlassian.bamboo.amq.BambooBrokerService\"\n          init-method=\"start\" destroy-method=\"stop\">\n      <property name=\"useJmx\" value=\"${bamboo.broker.useJmx}\" />\n      <property name=\"brokerName\" value=\"bamboo\" />\n      <property name=\"deleteAllMessagesOnStartup\" value=\"${bamboo.ignore.server.state.on.restart}\" />\n      <property name=\"persistent\" value=\"true\" />\n      <property name=\"dataDirectory\" value=\"${bamboo.home}/jms-store\" />\n      <property name=\"destinationPolicy\">\n        <amq:policyMap>\n          <amq:policyEntries>\n            <amq:policyEntry queue=\">\" producerFlowControl=\"false\">\n              <amq:deadLetterStrategy>\n                <amq:sharedDeadLetterStrategy processExpired=\"false\"/>  <!-- discard expired messages: -->\n              </amq:deadLetterStrategy>\n            </amq:policyEntry>\n          </amq:policyEntries>\n        </amq:policyMap>\n      </property>\n      <property name=\"systemUsage\">\n        <amq:systemUsage>\n          <amq:memoryUsage>\n            <amq:memoryUsage limit=\"128 mb\"/>\n          </amq:memoryUsage>\n          <amq:storeUsage>\n            <amq:storeUsage limit=\"100 gb\"/>\n          </amq:storeUsage>\n          <amq:tempUsage>\n            <amq:tempUsage limit=\"50 gb\"/>\n          </amq:tempUsage>\n        </amq:systemUsage>\n      </property>\n\n    </bean>\n\n  <bean id=\"connectionFactory\" class=\"org.apache.activemq.pool.PooledConnectionFactory\" destroy-method=\"stop\" depends-on=\"broker\">\n    <constructor-arg>\n      <bean class=\"com.atlassian.bamboo.v2.build.agent.BambooActiveMQConnectionFactory\">\n        <constructor-arg value=\"vm://bamboo\"/>\n        <property name=\"prefetchPolicy\">\n          <amq:prefetchPolicy queuePrefetch=\"1\"/>\n        </property>\n        <property name=\"sendTimeout\" value=\"${activemq.sync.response.timeout}\"/>\n      </bean>\n    </constructor-arg>\n  </bean>\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski_","name":"pbruski_","key":"pbruski_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Europe/Warsaw"},"created":"2014-10-29T10:55:30.981+0000","updated":"2014-10-29T10:55:30.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14188254","id":"14188254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"can you validate a 5.11 snapshot. There has been a bunch of refactoring to the queue/cursor/store interaction with a view to resolving the occurrence of duplicates from the store. With concurrentStoreAndDispatch=true for kahadb(true by default) there is the possibility of duplicates when the cache becomes exhausted and the cursor reverts to the store. These are now identified and suppressed they don't clutter the DLQ.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-29T11:24:01.673+0000","updated":"2014-10-29T11:24:01.673+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14188299","id":"14188299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski_","name":"pbruski_","key":"pbruski_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Europe/Warsaw"},"body":"Thank you for you response. The problem is that I'd have to push it out to production (we can't reproduce it on our test servers).\nIs current 5.11-SNAPSHOT stable enough to do that? Is 5.11 final far away?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski_","name":"pbruski_","key":"pbruski_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Europe/Warsaw"},"created":"2014-10-29T12:23:05.879+0000","updated":"2014-10-29T12:23:05.879+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14188571","id":"14188571","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"5.11 is in very good shape. Looking to close it down in the next week or so.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-29T16:58:49.847+0000","updated":"2014-10-29T16:58:49.847+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14190438","id":"14190438","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski_","name":"pbruski_","key":"pbruski_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Europe/Warsaw"},"body":"OK, we'll upgrade as soon as it's available. It will take some time before it ends up on production and then we should wait for at least two weeks before confirming the fix - the rate of occurrence is roughly once per week.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski_","name":"pbruski_","key":"pbruski_","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Europe/Warsaw"},"created":"2014-10-30T17:34:26.836+0000","updated":"2014-10-30T17:34:26.836+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14256730","id":"14256730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=achernyakhovsky","name":"achernyakhovsky","key":"achernyakhovsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Chernyakhovsky","active":true,"timeZone":"America/Los_Angeles"},"body":"I am seeing:\n2014-12-23 07:19:32,491 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@4eed1516:xstomp.request,batchResetNeeded=false,size=1,cacheEnabled=false,maxBatchSize:1,hasSpace:false,pendingCachedIds.size:0,lastSyncCachedId:null,lastSyncCachedId-seq:null,lastAsyncCachedId:null,lastAsyncCachedId-seq:null,store=org.apache.activemq.store.memory.MemoryMessageStore@2f037fd5 - cursor got duplicate from store ID:ip-10-140-168-52-43583-1419289565347-1:1:4:1:46539 seq: 974372 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ NIO Worker 11233\n2014-12-23 07:19:32,492 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@4eed1516:xstomp.request,batchResetNeeded=false,size=1,cacheEnabled=false,maxBatchSize:1,hasSpace:false,pendingCachedIds.size:0,lastSyncCachedId:null,lastSyncCachedId-seq:null,lastAsyncCachedId:null,lastAsyncCachedId-seq:null,store=org.apache.activemq.store.memory.MemoryMessageStore@2f037fd5 - cursor got duplicate from store ID:ip-10-45-179-71-55811-1419289516957-1:1:7:1:46574 seq: 974373 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ NIO Worker 11233\n2014-12-23 07:19:32,492 | WARN  | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@4eed1516:xstomp.request,batchResetNeeded=false,size=1,cacheEnabled=false,maxBatchSize:1,hasSpace:false,pendingCachedIds.size:0,lastSyncCachedId:null,lastSyncCachedId-seq:null,lastAsyncCachedId:null,lastAsyncCachedId-seq:null,store=org.apache.activemq.store.memory.MemoryMessageStore@2f037fd5 - cursor got duplicate from store ID:ip-10-140-168-52-43583-1419289565347-1:1:9:1:46540 seq: 974374 | org.apache.activemq.broker.region.cursors.AbstractStoreCursor | ActiveMQ NIO Worker 11233\n2014-12-23 07:19:32,493 | WARN  | duplicate message from store ID:ip-10-140-168-52-43583-1419289565347-1:1:7:1:46411, redirecting for dlq processing | org.apache.activemq.broker.region.Queue | ActiveMQ NIO Worker 11233\n2014-12-23 07:19:32,495 | WARN  | duplicate message from store ID:ip-10-140-168-52-43583-1419289565347-1:1:7:1:46414, redirecting for dlq processing | org.apache.activemq.broker.region.Queue | ActiveMQ NIO Worker 11233\n2014-12-23 07:19:32,496 | WARN  | duplicate message from store ID:ip-10-140-168-52-43583-1419289565347-1:1:4:1:46405, redirecting for dlq processing | org.apache.activemq.broker.region.Queue | ActiveMQ NIO Worker 11233\n2014-12-23 07:19:32,497 | WARN  | duplicate message from store ID:ip-10-140-168-52-43583-1419289565347-1:1:9:1:46406, redirecting for dlq processing | org.apache.activemq.broker.region.Queue | ActiveMQ NIO Worker 11233\n\nMy confifuration is different though. I run 2 static brokers. \nI see these messages on both 5.10.0 and apache-activemq-5.11-20141222.222708-183. 5.9.0 works fine under exactly the same test hardware and configuration. It is highly reproducible.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=achernyakhovsky","name":"achernyakhovsky","key":"achernyakhovsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Chernyakhovsky","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-23T08:11:55.088+0000","updated":"2014-12-23T08:11:55.088+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14256731","id":"14256731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=achernyakhovsky","name":"achernyakhovsky","key":"achernyakhovsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Chernyakhovsky","active":true,"timeZone":"America/Los_Angeles"},"body":"Feel free to contact me for the details. I will be glad if I can be of any help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=achernyakhovsky","name":"achernyakhovsky","key":"achernyakhovsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Chernyakhovsky","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-23T08:15:44.110+0000","updated":"2014-12-23T08:15:44.110+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14256918","id":"14256918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@Alex - can you work on a unit test case. There are a bunch of related test in the activemq-unit-test module that you could use for inspiration.\nThe warnings in themselves are not a bad thing, there may actually be some duplicate sends under various conditions that need to be suppressed by the cursor if the producer audit is exhausted or a message is replayed across a network.\nWhen you suggest that it works fine in 5.9, do you use the same metric? as in all messages sent are consumed? \nA valid test would need to verify each message is received once and once only.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-23T12:11:32.169+0000","updated":"2014-12-23T12:11:32.169+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14258155","id":"14258155","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=achernyakhovsky","name":"achernyakhovsky","key":"achernyakhovsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Chernyakhovsky","active":true,"timeZone":"America/Los_Angeles"},"body":"Gary,\n\nI will check the unit test module but I am afraid it might prove hard to replicate our environment.\nMaybe it will be more productive if I work with you or someone assigned to this issue to understand what exactly is happening and then proceed with the test.\n\nHere is some info:\n1) Our production system consists of about half a dozen of servers running clients producing messages, then another set of about 10 consuming the load while producing some messages for consumption by themselves and another set of about 5 servers running apache storm. (The numbers change as we scale). 8 queues are created across the board.\n2) We've ran into some reliability issues with the network of brokers while using AMQ 5.8.0 (transient) so we resorted to a single beefed up server.\n3) Now we are on 5.10.0 and it is able to keep up with the current load but the load tends to grow and we would want to have some failover capability too.\n4) I am running a load test for the same configuration as in production with 5, 7, 6 servers and again a beefy AMQ 5.10.0 server works fine.\n5) When I add another AMQ server using static connector everything seems to work fine under lighter load. As load grows, even before the message consumption starts falling behind I am seeing a flood of the \"duplicate\" messages. They of course are not a problem by themselves but the DLQ fills up really quickly and AMQs die horrible out of memory death. Exactly the same behavior under the same setup and load is observed for the 5 or .11-SNAPSHOT (I basically swap the activemq link in the /opt folder)\n6) Keeping the whole system the same, when I switch to 5.9.0 the issue disappears - no \"duplicate\" in the log, DLQ does not get populated.\n\nSo the question is what gives? The consumers seem to process all the messages at least it shouldn't be different from 5.9 to 5.10 to 5.11. Do you believe something has changed in 5.10 and it might be a legit behavior?\n\nLet me know. I can provide additional details and assist with debugging if needed.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=achernyakhovsky","name":"achernyakhovsky","key":"achernyakhovsky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Chernyakhovsky","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-24T10:06:57.075+0000","updated":"2014-12-24T10:06:57.075+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14267512","id":"14267512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=syberyan","name":"syberyan","key":"syberyan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Tytgat","active":true,"timeZone":"Europe/Berlin"},"body":"Same problem over here with 5.10.0. Happens on a topic for us.\nDLQ suddenly starts filling up with these messages:\n\n2015-01-06 04:58:58,331 [10.29.0.4:46476] WARN  Topic                          - duplicate message from store ID:svlumipmq01.x.y.be-59515-1420515005092-3:975:-1:1:107, redirecting for dlq processing\n2015-01-06 04:58:58,475 [10.29.0.4:46476] WARN  AbstractStoreCursor            - TopicStorePrefetch(m2mGatewayEventClient,m2mGatewayDurableEventSubscription) ID:svlumipweb01.x.y.be-47894-1419262838671-5:1:1:3 - org.apache.activemq.broker.region.cursors.TopicStorePrefetch@7ec6ea1b:m2mbox.IT-LUMI-9-MB-Herdi1.event.cogen.level/changed,batchResetNeeded=false,storeHasMessages=true,size=0,cacheEnabled=true,maxBatchSize:200,hasSpace:true - cursor got duplicate: ID:svlumipmq01.x.y.be-59515-1420515005092-3:975:-1:1:109, 4","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=syberyan","name":"syberyan","key":"syberyan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Tytgat","active":true,"timeZone":"Europe/Berlin"},"created":"2015-01-07T10:56:38.275+0000","updated":"2015-01-07T10:57:44.580+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14267560","id":"14267560","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@Alex - there was a change of behaviour in 5.10 - to treat duplicates from the store a as problem - in the past, they were ignored by the cursor but could get redispatched on a restart or if the audit was exhausted, they would be redispatched as duplicates. in 5.10, if the page in logic from the store gets a duplicate if does the DLQ thing. So in some ways the difference between 5.9 and 5.10 is expected.\nWhat is unknown is what exact scenario causes the behaviour you see.\nThe trigger for the duplicates I tracked in the past was queue memory limit being reached with concurrent producers to the same destination, some of which were transactional. The interleaving could leave the cursor and store out of sync, such that when the cursor needed to page in from the store, it would use the wrong start point.\nYour trigger seems to be related to the network bridge, which would introduce a non transacted client ack consumer and non transacted producer. Maybe you can simulate that at load without the bridge.\nWe need to determine the sequence of events that lead to the duplicate from the store to understand if it is legitimate or not and if not, to ensure we don't fill the DLQ in this case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-07T12:09:30.899+0000","updated":"2015-01-07T12:09:30.899+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14267563","id":"14267563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@Christian - can you verify against 5.11-SNAPSHOT and if the problem persists try and build a simple reproducible test case? There are a bunch of tests around https://issues.apache.org/jira/browse/AMQ-5266 - peek at the activity tab. They may give inspiration.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-07T12:14:11.044+0000","updated":"2015-01-07T12:14:11.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14267631","id":"14267631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=syberyan","name":"syberyan","key":"syberyan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Tytgat","active":true,"timeZone":"Europe/Berlin"},"body":"@Gary: I managed to reproduce the problem with a local instance, maybe the following info might give you some insights.\n\n- started a client publishing messages to a topic continuously \n- our camel application was consuming from that topic\n- while everything was running ok, I restarted activemq\n- the duplicate message warnings started appearing immediately after startup\n- even after killing the client, the broker seems to be 'stuck' in this state. Each single message will trigger the warning from then on.\n- not all 'duplicate' messages end up in the DLQ. Seems to be timing related. (Looks like the faster the machine, the less messages end up in the DLQ.)  \n- reproducable both with an oracle and a kahadb store\n\nI connected a debugger and noticed that the handling thread enters AbstractStoreCursor.recoverMessage() twice, hence the duplicate warning because it already exists in the audit map. PrefetchSubscription.add() seems to trigger the 2 executions, once through pending.addMessageLast(node) and once through dispatchPending()...\n\nHere are 2 stacktraces showing how it enters that method.\n{code}\n\nActiveMQ Transport: tcp:///0:0:0:0:0:0:0:1:56106@1883@10055 daemon, prio=5, in group 'main', status: 'RUNNING'\n\t  at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.recoverMessage(AbstractStoreCursor.java:90)\n\t  at org.apache.activemq.broker.region.cursors.TopicStorePrefetch.recoverMessage(TopicStorePrefetch.java:77)\n\t  at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.addMessageLast(AbstractStoreCursor.java:194)\n\t  at org.apache.activemq.broker.region.cursors.StoreDurableSubscriberCursor.addMessageLast(StoreDurableSubscriberCursor.java:198)\n\t  at org.apache.activemq.broker.region.PrefetchSubscription.add(PrefetchSubscription.java:159)\n\t  at org.apache.activemq.broker.region.DurableTopicSubscription.add(DurableTopicSubscription.java:272)\n\t  at org.apache.activemq.broker.region.policy.SimpleDispatchPolicy.dispatch(SimpleDispatchPolicy.java:48)\n\t  at org.apache.activemq.broker.region.Topic.dispatch(Topic.java:717)\n\t  at org.apache.activemq.broker.region.Topic.doMessageSend(Topic.java:510)\n\t  at org.apache.activemq.broker.region.Topic.send(Topic.java:441)\n\t  at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:424)\n\t  at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:445)\n\t  at org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:297)\n\t  at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:147)\n\t  at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\t  at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:307)\n\t  at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:147)\n\t  at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:152)\n\t  at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:496)\n\t  at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:756)\n\t  at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n\t  at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:148)\n\t  at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:45)\n\t  at org.apache.activemq.transport.mqtt.MQTTInactivityMonitor.onCommand(MQTTInactivityMonitor.java:123)\n\t  at org.apache.activemq.transport.mqtt.MQTTTransportFilter.sendToActiveMQ(MQTTTransportFilter.java:91)\n\t  at org.apache.activemq.transport.mqtt.MQTTProtocolConverter.sendToActiveMQ(MQTTProtocolConverter.java:132)\n\t  at org.apache.activemq.transport.mqtt.MQTTProtocolConverter.onMQTTPublish(MQTTProtocolConverter.java:566)\n\t  at org.apache.activemq.transport.mqtt.MQTTProtocolConverter.onMQTTCommand(MQTTProtocolConverter.java:175)\n\t  at org.apache.activemq.transport.mqtt.MQTTTransportFilter.onCommand(MQTTTransportFilter.java:79)\n\t  at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\t  at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n\t  at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n\t  at java.lang.Thread.run(Thread.java:745)\n{code}\n\n\n{code}\n\nActiveMQ Transport: tcp:///0:0:0:0:0:0:0:1:56106@1883@10055 daemon, prio=5, in group 'main', status: 'RUNNING'\n\t blocks ActiveMQ Transport: tcp:///127.0.0.1:56056@61616@9345\n\t blocks ActiveMQ BrokerService[localhost] Task-178@8926\n\t  at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.recoverMessage(AbstractStoreCursor.java:103)\n\t  at org.apache.activemq.broker.region.cursors.TopicStorePrefetch.recoverMessage(TopicStorePrefetch.java:77)\n\t  at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.recoverMessage(AbstractStoreCursor.java:85)\n\t  at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBTopicMessageStore$5.execute(KahaDBStore.java:931)\n\t  at org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779)\n\t  at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBTopicMessageStore.recoverNextMessages(KahaDBStore.java:905)\n\t  at org.apache.activemq.store.ProxyTopicMessageStore.recoverNextMessages(ProxyTopicMessageStore.java:115)\n\t  at org.apache.activemq.broker.region.cursors.TopicStorePrefetch.doFillBatch(TopicStorePrefetch.java:113)\n\t  at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.fillBatch(AbstractStoreCursor.java:277)\n\t  at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.hasNext(AbstractStoreCursor.java:162)\n\t  at org.apache.activemq.broker.region.cursors.StoreDurableSubscriberCursor.hasNext(StoreDurableSubscriberCursor.java:255)\n\t  at org.apache.activemq.broker.region.PrefetchSubscription.dispatchPending(PrefetchSubscription.java:646)\n\t  at org.apache.activemq.broker.region.DurableTopicSubscription.dispatchPending(DurableTopicSubscription.java:278)\n\t  at org.apache.activemq.broker.region.PrefetchSubscription.add(PrefetchSubscription.java:161)\n\t  at org.apache.activemq.broker.region.DurableTopicSubscription.add(DurableTopicSubscription.java:272)\n\t  at org.apache.activemq.broker.region.policy.SimpleDispatchPolicy.dispatch(SimpleDispatchPolicy.java:48)\n\t  at org.apache.activemq.broker.region.Topic.dispatch(Topic.java:717)\n\t  at org.apache.activemq.broker.region.Topic.doMessageSend(Topic.java:510)\n\t  at org.apache.activemq.broker.region.Topic.send(Topic.java:441)\n\t  at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:424)\n\t  at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:445)\n\t  at org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:297)\n\t  at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:147)\n\t  at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\t  at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:307)\n\t  at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:147)\n\t  at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:152)\n\t  at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:496)\n\t  at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:756)\n\t  at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n\t  at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:148)\n\t  at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:45)\n\t  at org.apache.activemq.transport.mqtt.MQTTInactivityMonitor.onCommand(MQTTInactivityMonitor.java:123)\n\t  at org.apache.activemq.transport.mqtt.MQTTTransportFilter.sendToActiveMQ(MQTTTransportFilter.java:91)\n\t  at org.apache.activemq.transport.mqtt.MQTTProtocolConverter.sendToActiveMQ(MQTTProtocolConverter.java:132)\n\t  at org.apache.activemq.transport.mqtt.MQTTProtocolConverter.onMQTTPublish(MQTTProtocolConverter.java:566)\n\t  at org.apache.activemq.transport.mqtt.MQTTProtocolConverter.onMQTTCommand(MQTTProtocolConverter.java:175)\n\t  at org.apache.activemq.transport.mqtt.MQTTTransportFilter.onCommand(MQTTTransportFilter.java:79)\n\t  at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\t  at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n\t  at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n\t  at java.lang.Thread.run(Thread.java:745)\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=syberyan","name":"syberyan","key":"syberyan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Tytgat","active":true,"timeZone":"Europe/Berlin"},"created":"2015-01-07T13:45:44.506+0000","updated":"2015-01-07T13:45:44.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14268871","id":"14268871","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal","name":"anujkhandelwal","key":"anujkhandelwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nWe are using 5.10 broker. \nWe saw this error messages. \n[20150107 15:01:52.282 EST (ActiveMQ Transport: tcp:///10.79.26.196:41859@61613) org.apache.activemq.broker.region.cursors.AbstractStoreCursor#recoverMess\nage 103 WARN] - TopicStorePrefetch(cas_stuff_price_info_to_jsh,new_golden_price_message) ID:kepler47.com-49402-1420406276070-1:22507:-1:1 - org\n.apache.activemq.broker.region.cursors.TopicStorePrefetch@7524aad9:pricing.goldenPriceFeed,batchResetNeeded=false,storeHasMessages=true,size=52586,cacheEn\nabled=false,maxBatchSize:200,hasSpace:true - cursor got duplicate: ID:helium16.nyc-49994-1420473196066-5:6690:1:1:4257, 4 \n\nFrom the source code of org.apache.activemq.broker.region.cursors.AbstractStoreCursor#recoverMess\nage it looks like duplicates messages got stored in kahadb for same destination. The topic for which it happend has a durable subscriber. \nI want to understand in what cases kahadb stores duplicate messages ? Is this a bug? \n\n\nThanks,\nAnuj\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anujkhandelwal","name":"anujkhandelwal","key":"anujkhandelwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"Anuj Khandelwal","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-08T06:11:12.487+0000","updated":"2015-01-08T06:11:12.487+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14278500","id":"14278500","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=barlabanov","name":"barlabanov","key":"barlabanov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergiy Barlabanov","active":true,"timeZone":"Europe/Berlin"},"body":"In our case after getting quite a lot of \"cursor got duplicate\" in a DQL, we start to observe \"Problem retrieving message for browse\" error with NullPointerException for that DLQ when trying to browse the queue. Restart helps.\n\n2015-01-14 20:26:00,659 | ERROR | Problem retrieving message for browse | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[dcdng] Scheduler\njava.lang.NullPointerException","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=barlabanov","name":"barlabanov","key":"barlabanov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergiy Barlabanov","active":true,"timeZone":"Europe/Berlin"},"created":"2015-01-15T09:50:48.666+0000","updated":"2015-01-15T09:51:03.372+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/14539485","id":"14539485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jogeraerts","name":"jogeraerts","key":"jogeraerts","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jo Geraerts","active":true,"timeZone":"Europe/Berlin"},"body":"Bouncing into the same issue on activemq 5.9.0\n\n{code}\nJBossFuse:admin@root> list -t 0 | grep active\n[ 131] [Active     ] [Created     ] [       ] [   50] activemq-osgi (5.9.0.redhat-610379)\n[ 137] [Active     ] [            ] [       ] [   50] activeio-core (3.1.4)\n[ 139] [Active     ] [Created     ] [       ] [   50] activemq-karaf (5.9.0.redhat-610379)\n[ 207] [Active     ] [            ] [       ] [   60] activemq-camel (5.9.0.redhat-610379)\n{code}\n\n{code}\nfuseesb.log.2015-04-30.gz:13:15:35,941 | WARN  | 344189615-182566 | AbstractStoreCursor              | 131 - org.apache.activemq.activemq-osgi - 5.9.0.redhat-610379 | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@8ec707b:Pim.Plu.Hybris,batchResetNeeded=false,storeHasMessages=false,size=5,cacheEnabled=true,maxBatchSize:5,hasSpace:true - cursor got duplicate: ID:prd-esb-inno1-37535-1429248180616-5:4:6:1:3, 4\nfuseesb.log.2015-04-30.gz:13:15:36,003 | WARN  | 344189615-182566 | AbstractStoreCursor              | 131 - org.apache.activemq.activemq-osgi - 5.9.0.redhat-610379 | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@8ec707b:Pim.Plu.Hybris,batchResetNeeded=false,storeHasMessages=false,size=6,cacheEnabled=true,maxBatchSize:6,hasSpace:true - cursor got duplicate: ID:prd-esb-inno1-37535-1429248180616-5:5:7:1:62, 4\nfuseesb.log.2015-04-30.gz:13:15:36,066 | WARN  | 344189615-182566 | AbstractStoreCursor              | 131 - org.apache.activemq.activemq-osgi - 5.9.0.redhat-610379 | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@8ec707b:Pim.Plu.Hybris,batchResetNeeded=false,storeHasMessages=false,size=7,cacheEnabled=true,maxBatchSize:7,hasSpace:true - cursor got duplicate: ID:prd-esb-inno1-60724-1429933192681-1:3:5:1:837, 4\n{code}\n\nOccurs both for topics as queues. \n\nWe are using mysql as store, with 2 nodes in failover. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jogeraerts","name":"jogeraerts","key":"jogeraerts","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jo Geraerts","active":true,"timeZone":"Europe/Berlin"},"created":"2015-05-12T08:12:19.011+0000","updated":"2015-05-12T08:12:19.011+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724267/comment/15821635","id":"15821635","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"For the durable topic sub case this scenario is captured in https://issues.apache.org/jira/browse/AMQ-6562 and the \"cursor got duplicate from store\" warn is now suppressed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-13T11:12:12.430+0000","updated":"2017-01-13T11:13:26.188+0000"}],"maxResults":25,"total":25,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5249/votes","votes":7,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1x9rb:"}}