{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483667","self":"https://issues.apache.org/jira/rest/api/2/issue/12483667","key":"AMQ-2734","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-01-20T00:48:25.661+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 15 20:58:12 UTC 2011","customfield_12310420":"74822","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_26144727479_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-03-15T20:58:12.566+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2734/watchers","watchCount":3,"isWatching":false},"created":"2010-05-17T06:32:45.111+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-03-15T20:58:12.576+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We are able to successfully publish a large number of messages to an embedded ActiveMQ instance via the VM protocol/transport. After a while, however, further publishing starts to fail with IOExceptions (caused by InterruptedExceptions). For some (unknown) reason the invocation of LinkedBlockingQueue#put() in the VMTransport#oneway() method starts to fail with InterruptedExceptions. Please find the full stack trace below.\n\nSince we use the VM transport together with the FAILOVER transport the connection is recovered automatically (a fraction of a second later). Our connection URL currently is as follows:\n\nfailover:(vm://amqmasterbroker?create=false&amp;waitForStart=10000)?initialReconnectDelay=100&amp;maxReconnectAttempts=5\n\nWe intend to set the transport parameters backup=true&timeout=100 on the FAILOVER protocol to work around the problem of stuck publishing threads and message publishing errors in case of the IOException (not sure if this will help) but would want see the root-cause to be fixed by ActiveMQ as this issue is causing a lot of troubles for us in production.\n\n2010-05-14 18:19:13,950 [EventServiceChannel$ReceiverThread[daemon]_357] DEBUG failover.FailoverTransport - Send oneway attempt: 0 failed for command:ActiveMQObjectMessage {commandId = 1929587556, responseRequired = false, messageId = ID:saturntstsgp-40467-1273493117026-2:0:35:2:8847665, originalDestination = null, originalTransactionId = null, producerId = ID:saturntstsgp-40467-127349311702\n2010-05-14 18:19:13,950 [EventServiceChannel$ReceiverThread[daemon]_357] WARN  failover.FailoverTransport - Transport failed to vm://amqmasterbroker?create=false&waitForStart=10000 , attempting to automatically reconnect due to: java.io.IOException\n2010-05-14 18:19:13,951 [EventServiceChannel$ReceiverThread[daemon]_357] DEBUG failover.FailoverTransport - Transport failed with the following exception:\njava.io.IOException\n        at org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:45)\n        at org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:104)\n        at org.apache.activemq.transport.failover.FailoverTransport.oneway(FailoverTransport.java:471)\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\n        at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\n        at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1225)\n        at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1219)\n        at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1680)\n        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:231)\n        at org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:269)\n        at org.springframework.jms.connection.CachedMessageProducer.send(CachedMessageProducer.java:117)\n        at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:597)\n        at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:574)\n        at org.springframework.jms.core.JmsTemplate$3.doInJms(JmsTemplate.java:541)\n        at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:471)\n        at org.springframework.jms.core.JmsTemplate.send(JmsTemplate.java:539)\n        at com.scb.saturn.services.messagebroker.MessageBrokerImpl.publishMessage(MessageBrokerImpl.java:118)\n        at com.scb.saturn.services.messagebroker.MessageBrokerImpl.publishMessage(MessageBrokerImpl.java:102)\n        at sun.reflect.GeneratedMethodAccessor38.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at org.springframework.osgi.service.importer.support.internal.aop.ServiceInvoker.doInvoke(ServiceInvoker.java:64)\n        at org.springframework.osgi.service.importer.support.internal.aop.ServiceInvoker.invoke(ServiceInvoker.java:78)\n        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)\n        at org.springframework.aop.support.DelegatingIntroductionInterceptor.doProceed(DelegatingIntroductionInterceptor.java:131)\n        at org.springframework.aop.support.DelegatingIntroductionInterceptor.invoke(DelegatingIntroductionInterceptor.java:119)\n        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)\n        at org.springframework.osgi.service.util.internal.aop.ServiceTCCLInterceptor.invoke(ServiceTCCLInterceptor.java:36)\n        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)\n        at org.springframework.osgi.service.importer.support.LocalBundleContextAdvice.invoke(LocalBundleContextAdvice.java:59)\n        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)\n        at org.springframework.aop.support.DelegatingIntroductionInterceptor.doProceed(DelegatingIntroductionInterceptor.java:131)\n        at org.springframework.aop.support.DelegatingIntroductionInterceptor.invoke(DelegatingIntroductionInterceptor.java:119)\n        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)\n        at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)\n        at $Proxy45.publishMessage(Unknown Source)\n        at com.scb.saturn.services.apamaclient.scenario.ScenarioService.publishToMessageBroker(ScenarioService.java:362)\n        at com.scb.saturn.services.apamaclient.scenario.ScenarioService.updateInstance(ScenarioService.java:97)\n        at com.scb.saturn.services.apamaclient.scenario.ScenarioService.propertyChange(ScenarioService.java:176)\n        at java.beans.PropertyChangeSupport.firePropertyChange(Unknown Source)\n        at java.beans.PropertyChangeSupport.firePropertyChange(Unknown Source)\n        at com.apama.services.scenario.internal.ScenarioDefinition.handle_instanceUpdated(ScenarioDefinition.java:1424)\n        at com.apama.services.scenario.internal.ScenarioDefinition.access$300(ScenarioDefinition.java:52)\n        at com.apama.services.scenario.internal.ScenarioDefinition$2.handleEvent(ScenarioDefinition.java:1627)\n        at com.apama.services.event.internal.EventServiceChannel.processEvent(EventServiceChannel.java:1057)\n        at com.apama.services.event.internal.EventServiceChannel$ReceiverThread.run(EventServiceChannel.java:1179)\nCaused by: java.lang.InterruptedException\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(Unknown Source)\n        at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(Unknown Source)\n        at java.util.concurrent.LinkedBlockingQueue.put(Unknown Source)\n        at org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:94)\n        ... 44 more\n2010-05-14 18:19:13,960 [EventServiceChannel$ReceiverThread[daemon]_357] WARN  util.LoggingTransportListener - transport [amqMessageBrokerAmqConnectionTransport] has been interrupted\n2010-05-14 18:19:13,961 [ActiveMQ Task] DEBUG failover.FailoverTransport - urlList connectionList:[vm://amqmasterbroker?create=false&waitForStart=10000]\n2010-05-14 18:19:13,961 [ActiveMQ Task] DEBUG failover.FailoverTransport - Attempting connect to: vm://amqmasterbroker?create=false&waitForStart=10000\n2010-05-14 18:19:13,962 [ActiveMQ Task] DEBUG failover.FailoverTransport - Connection established\n2010-05-14 18:19:13,962 [ActiveMQ Task] WARN  util.LoggingTransportListener - transport [amqMessageBrokerAmqConnectionTransport] has been resumed\n2010-05-14 18:19:14,025 [ActiveMQ Task] INFO  failover.FailoverTransport - Successfully reconnected to vm://amqmasterbroker?create=false&waitForStart=10000","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461698","id":"12461698","filename":"VMTransport_IOException.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eliebmann","name":"eliebmann","key":"eliebmann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erich Liebmann","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-17T06:34:44.867+0000","size":6724,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461698/VMTransport_IOException.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"171945","customfield_12312823":null,"summary":"VMTransport fails with IOException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eliebmann","name":"eliebmann","key":"eliebmann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erich Liebmann","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eliebmann","name":"eliebmann","key":"eliebmann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erich Liebmann","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"OS: Linux / 2.6.9-67.ELsmp / i386 / 8\nJVM: Java HotSpot(TM) Server VM / Sun Microsystems Inc. / 1.6.0_17-b04","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483667/comment/12942654","id":"12942654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eliebmann","name":"eliebmann","key":"eliebmann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erich Liebmann","active":true,"timeZone":"Etc/UTC"},"body":"the full stacktrace and associated reconnection logs","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eliebmann","name":"eliebmann","key":"eliebmann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erich Liebmann","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-17T06:34:45.385+0000","updated":"2010-05-17T06:34:45.385+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483667/comment/12942677","id":"12942677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eliebmann","name":"eliebmann","key":"eliebmann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erich Liebmann","active":true,"timeZone":"Etc/UTC"},"body":"Forgot to mention that we amended the FailoverTransport#handleTransportFailure() method to capture the full stack trace (could probably have been done with AOP or BTrace as well). Would appreciate if someone could look into this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eliebmann","name":"eliebmann","key":"eliebmann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erich Liebmann","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-19T02:32:06.229+0000","updated":"2010-05-19T02:32:06.229+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483667/comment/12983961","id":"12983961","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shafina","name":"shafina","key":"shafina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shafina madathil","active":true,"timeZone":"Etc/UTC"},"body":"Is the fix available in 5.4.2? \n\nAfter getting this exception gets Session closed exception if we try to sent message as shown below\n\nJan 13 15:26:28 127.0.0.1 aused by: javax.jms.IllegalStateException: The Session is closed Jan 13 15:26:28 127.0.0.1 at org.apache.activemq.ActiveMQSession.checkClosed(ActiveMQSession.java:722)\nJan 13 15:26:28 127.0.0.1 at org.apache.activemq.ActiveMQSession.createProducer(ActiveMQSession.java:922)\n\nIs there any specific reason for session being closed after java.lang.InterruptedException ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shafina","name":"shafina","key":"shafina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shafina madathil","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-20T00:48:25.661+0000","updated":"2011-01-20T20:13:46.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483667/comment/13007178","id":"13007178","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Fixes in the VM Transport in 5.5.0 should resolve this issue, reopen if the problem reoccurs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-03-15T20:58:12.574+0000","updated":"2011-03-15T20:58:12.574+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2734/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tsm7:"}}