{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482521","self":"https://issues.apache.org/jira/rest/api/2/issue/12482521","key":"AMQ-1847","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-07-08T15:37:03.498+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 06 08:16:22 UTC 2010","customfield_12310420":"84751","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_109279629_*|*_5_*:*_4_*:*_32991865887_*|*_4_*:*_3_*:*_32556723176","customfield_12312321":null,"resolutiondate":"2010-08-06T08:16:22.566+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1847/watchers","watchCount":3,"isWatching":false},"created":"2008-07-07T09:58:33.874+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[{"id":"12335013","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335013","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"outwardIssue":{"id":"12482642","key":"AMQ-1032","self":"https://issues.apache.org/jira/rest/api/2/issue/12482642","fields":{"summary":"Avoid a delivery delay on the first redelivery.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-08-06T08:16:22.560+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Hi.\n\nI'm using ActiveMQ 5.1 together with Spring's DefaultMessageListenerContainer to enable MDPs. I'm using the redeliveryPolicy to enable redelivery on failures during consumption of a message. ActiveMQ configuration looks like this:\n\n    <camelContext id=\"camel\" xmlns=\"http://activemq.apache.org/camel/schema/spring\">\n\n        <route errorHandlerRef=\"deadLetterErrorHandler\">\n                <from uri=\"activemq:NEW\" />\n        </route>\n    </camelContext>\n\n\n<bean id=\"deadLetterErrorHandler\" class=\"org.apache.camel.builder.DeadLetterChannelBuilder\">\n    <property name=\"redeliveryPolicy\" ref=\"redeliveryPolicyConfig\"/>\n</bean>\n\n<bean id=\"redeliveryPolicyConfig\" class=\"org.apache.camel.processor.RedeliveryPolicy\">\n    <property name=\"maximumRedeliveries\" value=\"4\"/>\n    <property name=\"initialRedeliveryDelay\" value=\"30000\"/>\n    <property name=\"useExponentialBackOff\" value=\"true\"/>\n    <property name=\"backOffMultiplier\" value=\"2\" />\n</bean>\n\n\nNow if a failure occurs, the configured delay isn't used on the first redelivery attempt. Instead redelivery takes place immediately after the failure occured. This sounds odd to me, since the property is even called initialRedeliveryDelay :). I know that maybe this was caused due to the following issue:\n\nhttps://issues.apache.org/activemq/browse/AMQ-1032\n\nIn my opinion immediately redelivery isn't very useful in most cases. If a failure occurs, it won't be fixed some ms later :). So my suggestion is (in respect to AMQ-1032) to have two options:\n\ninitialRedeliveryDelay\nredeliveryDelay\n\nSo both configurations would be possible. For AMQ-1032 just configure initialRedeliveryDelay to 0. Otherwise just take the redeliveryDelay as initialRedeliveryDelay to get what I want :).\n\nDoes this make sense?\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"159870","customfield_12312823":null,"summary":"Redelivery on a failure doesn't respect the initialRedeliveryDelay on the first attempt.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux, ActiveMQ 5.1, Spring 2.5.x with transacted DefaultMessageListenerContainer","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939967","id":"12939967","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"I have just tried an unit test and it sleeps for 30 seconds.\n[                          main] RedeliveryPolicy               DEBUG Sleeping for: 30000 millis until attempting redelivery\n\nAnd then on the 2nd\n[                          main] RedeliveryPolicy               DEBUG Sleeping for: 60000 millis until attempting redelivery\n\nYour route doesn't do anything with the received message from activemq:NEW. How do you actually trigger the failure and the redelivery?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-08T15:37:03.498+0000","updated":"2008-07-08T15:37:03.498+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939912","id":"12939912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"I have tried with a jms example and it works in the unit tests in the source code.\n\nAre you sure you have Camel 1.4-SNAPSHOT in ActiveMQ where you run your project?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-08T15:50:03.024+0000","updated":"2008-07-08T15:50:03.024+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939936","id":"12939936","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Claus.\n\nMeanwhile I've realized that the problem is a misunderstanding on my side what camel is supposed to do.\nI thought I can configure the redelivery behavior of ActiveMQ within the camelContext as part of the acivemq.xml configuration on a per destination basis. What I haven't mentioned is, that my listener/consumer for the queue isn't configured within camel or activemq but in a separate spring baked application. What I now have realized is, that I have to consume a message via camel to get it's routing/mediation support (including redelivery\nfeatures) - now it's crystal clear to me (or not?). So I configured redeliveryPolicy on a ActiveMQConnectionFactory on my spring baked application and the settings are working fine now.\n\nSorry for mixing things up.\n\nThanks for you help.\n\nRegards,\nVeit\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-08T16:19:53.491+0000","updated":"2008-07-08T16:19:53.491+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939938","id":"12939938","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"body":"Hi.\n\nSorry for reopening but the redeliveryDelay problem still exists. But it seems no camel problem then because I'm not using camel anymore, instead the redeliveryPolicy on the AQConnectionFactory.\n\nSo, should that be moved to the AQM project then? There I'm using AMQ 5.1.0 (Camel 1.3).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-08T17:55:23.046+0000","updated":"2008-07-08T17:55:23.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939950","id":"12939950","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Veit\n\nYes please open a ticket on the ActiveMQ project if its solely an ActiveMQ problem.\nhttp://issues.apache.org/activemq/browse/AMQ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-09T03:58:05.248+0000","updated":"2008-07-09T03:58:05.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939954","id":"12939954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Veit. I managed to move the issue from Camel to ActiveMQ project.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-09T04:00:00.955+0000","updated":"2008-07-09T04:00:00.955+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939945","id":"12939945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Veit. Can you add your new configuration etc. for the ActiveMQ that demonstrates the problem? I am sure the ActiveMQ comitters want to see your configuration file and what the problem is you have.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-09T04:00:59.214+0000","updated":"2008-07-09T04:00:59.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939929","id":"12939929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks Claus.\n\nSure, here's my applicationContext.xml:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans \n\txmlns=\"http://www.springframework.org/schema/beans\" \n\txmlns:amq=\"http://activemq.apache.org/schema/core\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd\n\thttp://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core-5.1.0.xsd\">\n\t\n\t<!--  ActiveMQ destinations to use  -->\n\t<bean id=\"destination\" class=\"org.apache.activemq.command.ActiveMQQueue\" autowire=\"constructor\">\n\t\t<constructor-arg value=\"NEW\" />\n\t</bean>\n\n\t<bean id=\"jmsFactory\" class=\"org.apache.activemq.ActiveMQConnectionFactory\">\n\t\t<property name=\"brokerURL\">\n\t\t\t<value>discovery:multicast://test</value>\n\t\t</property>\n\t\t<property name=\"redeliveryPolicy\">\n\t\t\t<ref local=\"redeliveryPolicy\" />\n\t\t</property>\n\t</bean>\n\t<bean id=\"redeliveryPolicy\" class=\"org.apache.activemq.RedeliveryPolicy\">\n\t\t<property name=\"initialRedeliveryDelay\" value=\"10000\" />\n\t\t<property name=\"maximumRedeliveries\" value=\"4\" />\n\t\t<property name=\"useExponentialBackOff\" value=\"true\" />\n\t\t<property name=\"backOffMultiplier\" value=\"2\" />\n\t</bean>\n\t\t\n\t<!-- Spring JMS Template -->\n\t<bean id=\"myJmsTemplate\" class=\"org.springframework.jms.core.JmsTemplate\">\n\t\t<property name=\"connectionFactory\">\n\t\t\t<!-- lets wrap in a pool to avoid creating a connection per send -->\n\t\t\t<bean class=\"org.springframework.jms.connection.SingleConnectionFactory\">\n\t\t\t\t<property name=\"targetConnectionFactory\">\n\t\t\t\t\t<ref local=\"jmsFactory\" />\n\t\t\t\t</property>\n\t\t\t</bean>\n\t\t</property>\n\t</bean>\n\t\n\t<bean id=\"consumerJmsTemplate\" class=\"org.springframework.jms.core.JmsTemplate\">\n\t\t<property name=\"connectionFactory\" ref=\"jmsFactory\"/>\n\t</bean>\n\t\n\n\t<!-- and this is the message listener container -->\n\t<bean id=\"jmsContainer\" class=\"org.springframework.jms.listener.DefaultMessageListenerContainer\">\n\t\t<property name=\"connectionFactory\" ref=\"jmsFactory\"/>\n\t\t<property name=\"destination\" ref=\"destination\"/>\n\t\t<property name=\"messageListener\" ref=\"messageListener\" />\n\t\t<property name=\"concurrentConsumers\" value=\"100\" />\n\t\t<property name=\"maxMessagesPerTask\" value=\"1\" />\n\t\t<property name=\"sessionTransacted\" value=\"true\" />\t\t\n\t</bean>\n\t<!-- this is the Message Driven POJO (MDP) -->\n\t<bean id=\"messageListener\" class=\"com.foo.bar.jms.Consumer\" />\t\n\t\n</beans>\n\n\nThe messageListener will create a RuntimeException on the onMessage method to produce an error. The first redelivery attempt occurs immediately, without respect to the initialRedeliveryDelay.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-09T06:44:25.369+0000","updated":"2008-07-09T06:45:09.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939940","id":"12939940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"body":"Redelivery policy doesn't work with Spring's org.springframework.jms.listener.DefaultMessageListenerContainer at all\n\nThat happens, because DefaultMessageListenerContainer closes the consumer, session and connection, and do the reconnect if message listener throws exception, and of course previous delivery timepoint is empty in the new consumer.\n\nIt happens, because DefaultMessageListenerContainer doesn't know what a cause of JMSException. Maybe it was disconnection... and ConnectionFactory haven't reconnection logic...\n\nI wrote my own simple MessageListenerContainer, that doesn't do reconnection if JMSException is thrown, because ActiveMQConnectionFactory has reconnection logic\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"created":"2008-07-09T08:26:58.858+0000","updated":"2008-07-09T08:27:45.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939890","id":"12939890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"body":"I'm sorry to correct you, but it IS working with the above configuration. All parameters I change within the redeliveryPolicy bean definition affecting the redelivery within the sping bean! The only thing that doesn't work correctly (or needs enhancement) is the initial redelivery.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-09T08:37:21.273+0000","updated":"2008-07-09T08:37:21.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939966","id":"12939966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"body":"I don't know how do you reach that, but if I use DefaultMessageListenerContainer  all redeliveries happens immediately, not first only.\n\nIf any Execption in MessageListener happens it always closes the connnection\n\n{code:title=DefaultMessageListenerContainer.java}\nprivate class AsyncMessageListenerInvoker implements SchedulingAwareRunnable {\n\n....\n\n    catch (Throwable ex) {\n    clearResources();\n\n...\n\n\n    }\n\n...\n}\n\n\nprivate void clearResources() {\n    if (sharedConnectionEnabled()) {\n    synchronized (sharedConnectionMonitor) {\n\tJmsUtils.closeMessageConsumer(this.consumer);\n\tJmsUtils.closeSession(this.session);\n        }\n    }\n    else {\n\tJmsUtils.closeMessageConsumer(this.consumer);\n\tJmsUtils.closeSession(this.session);\n    }\n\tthis.consumer = null;\n\tthis.session = null;\n}\n\n\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"created":"2008-07-09T09:42:35.954+0000","updated":"2008-07-09T09:42:35.954+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939917","id":"12939917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"body":"I don't know. Perhaps configuration, ActiveMQ 5.1.0 or Spring 2.5.5. Perhaps someone fixed/enhanced something :).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-09T10:01:55.761+0000","updated":"2008-07-09T10:01:55.761+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939999","id":"12939999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"body":"@Dima:\n\nNow, I can confirm your findings! After I set the jmsTransactionManager in my config (not just sessionTransacted=true like before) I encounter immediate redelivery without delay/backoffs, too:\n\n\t<bean id=\"jmsContainer\" class=\"org.springframework.jms.listener.DefaultMessageListenerContainer\">\n\t\t<property name=\"connectionFactory\" ref=\"jmsFactory\"/>\n\t\t<property name=\"destination\" ref=\"destination\"/>\n\t\t<property name=\"messageListener\" ref=\"messageListener\" />\n\t\t<property name=\"concurrentConsumers\" value=\"2\" />\n\t\t<property name=\"maxMessagesPerTask\" value=\"1\" />\n\t\t<property name=\"sessionTransacted\" value=\"true\" />\n\t\t<property name=\"transactionManager\" ref=\"jmsTransActionManager\" />\t\t\t\n\t</bean>\n\nAfter I set this, the MesageListener also checks connections actively - which is very noisy. So in the end: is this all expected behavior? I'm a bit confused...\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vguna","name":"vguna","key":"vguna","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Veit Guna","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-17T07:14:25.706+0000","updated":"2008-07-17T07:14:25.706+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12941612","id":"12941612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"transactions change redelivery semantics for a consumer. I think you are seeing expected behavior if the session is transacted considering https://issues.apache.org/activemq/browse/AMQ-1032\n\nIf this is not the case, a complete Junit tests case with a listener that throws an exception would help. There are a bunch of spring test cases in the activemq-core module that you could use as a template","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-25T09:34:49.080+0000","updated":"2009-06-25T09:34:49.080+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12941767","id":"12941767","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"resolving pending junit test case that can show otherwise.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-20T13:28:22.375+0000","updated":"2009-07-20T13:28:22.375+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939919","id":"12939919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"additional clarification. There is indeed an immediate retry with the redelivery flag set, this allows an app to immediately deal with a redelivered message (one having the redelivered flag set) if it needs to. For subsequent redeliveries the delay semantics kick in. This was implemented in https://issues.apache.org/activemq/browse/AMQ-1032\nhence this is working as designed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-05T15:42:52.146+0000","updated":"2010-08-05T15:42:52.146+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939442","id":"12939442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Fix implemented in r982903\n\ninitialRedeliveryDelay is not respected, set it to 0 to have immediate redelivery. Additional deliveryDelay (default  = 1000) which controls subsequent redelivery delay if initialRedeliveryDelay==0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-06T08:14:59.309+0000","updated":"2010-08-06T08:14:59.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12939017","id":"12939017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"going to fix this, make it configurable","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-06T08:15:59.361+0000","updated":"2010-08-06T08:15:59.361+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482521/comment/12936344","id":"12936344","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"done","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-06T08:16:22.546+0000","updated":"2010-08-06T08:16:22.546+0000"}],"maxResults":19,"total":19,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1847/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rq33:"}}