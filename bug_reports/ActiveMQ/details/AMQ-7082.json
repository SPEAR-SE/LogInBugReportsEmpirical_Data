{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13192835","self":"https://issues.apache.org/jira/rest/api/2/issue/13192835","key":"AMQ-7082","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341032","id":"12341032","name":"5.16.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12344049","id":"12344049","description":"","name":"5.15.7","archived":false,"released":true,"releaseDate":"2018-10-27"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-10-19T15:00:38.507+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Nov 07 21:03:23 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_8924647_*|*_4_*:*_3_*:*_101931985_*|*_5_*:*_3_*:*_1560818461_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-11-07T21:03:23.192+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7082/watchers","watchCount":9,"isWatching":false},"created":"2018-10-19T12:42:08.134+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338054","id":"12338054","name":"5.15.0","archived":false,"released":true,"releaseDate":"2017-07-05"}],"issuelinks":[{"id":"12547642","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12547642","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"13196926","key":"AMQ-7093","self":"https://issues.apache.org/jira/rest/api/2/issue/13196926","fields":{"summary":"KahaDB index, recover free pages in parallel with start (Continued)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12546123","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12546123","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13039809","key":"AMQ-6590","self":"https://issues.apache.org/jira/rest/api/2/issue/13039809","fields":{"summary":"KahaDB index loses track of free pages on unclean shutdown","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-11-07T21:03:23.226+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325017","id":"12325017","name":"KahaDB"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"AMQ-6590 fixes free page loss through recovery. The recover process can be timely, which prevents fast failover, doing recovery on shutdown is preferable, but it is still not ideal b/c it will hold onto the kahadb lock. It also can stall shutdown unexpectedly.\r\n\r\nAMQ-7080 is going to tackle checkpointing the free list. This should help avoid the need for recovery but it may still be necessary. If the perf hit is significant this may need to be optional.\r\n\r\nThere will still be the need to walk the index to find the free list.\r\n\r\nIt is possible to run with no free list and grow, and we can do that while we recover the free list in parallel, then merge the two at a safe point. This we can do at startup.\r\n\r\nIn cases where the disk is the bottleneck this won't help much, but it will help failover and it will help shutdown, with a bit of luck the recovery will complete before we stop.\r\n\r\n \r\n\r\nInitially I thought this would be too complex, but if we concede some growth while we recover, ie: start with an empty free list, it is should be straight forward to merge with a recovered one.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"KahaDB index, recover free pages in parallel with start","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16656899","id":"16656899","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 79c74998dc1efb72b05d32f920052a1df4b6dd8e in activemq's branch refs/heads/master from gtully\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=79c7499 ]\n\nAMQ-7082 - recover index free pages in parallel with start, merge in flush, clean shutdown if complete. follow up on AMQ-6590\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-19T15:00:38.507+0000","updated":"2018-10-19T15:00:38.507+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16656913","id":"16656913","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"The recovery is now back in the start phase, if it completes we are good. Otherwise we try again the next time.\r\n\r\n \r\n\r\n[~jgoodyear] - this is a take on the parallel approach, I think it makes good sense.\r\n\r\n[~alanprot] - there is still a good case for checkpointing which will reduce the full replay window, but the perf impact will the be key determinant on that I think.\r\n\r\nIt would be good to gauge the impact of the second reader in your case over NFS, there may be need to slow down the recovery thread such that it does not hog the disk or cpu.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-19T15:10:52.773+0000","updated":"2018-10-19T15:10:52.773+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16656967","id":"16656967","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit efa4e683bc9f4fc458ce80125304f20a742a7907 in activemq's branch refs/heads/master from gtully\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=efa4e68 ]\n\nAMQ-7082 - fix final ref in test\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-19T15:45:15.927+0000","updated":"2018-10-19T15:45:15.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16656969","id":"16656969","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"This is amazing!!!!!! :D:D:D:D:D:D:D:D\r\n\r\nMaybe we can do a small change to synchronize the newFreePages and use is as soon as it has recovered values... no?\r\n\r\n \r\n\r\nSomething like this:\r\n\r\nhttps://github.com/alanprot/activemq/commit/a9354e330e41cf4bf7e6fa21b57490a3ef22609b","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-19T15:45:49.531+0000","updated":"2018-10-19T15:45:49.531+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16656986","id":"16656986","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I did not want to block normal work with sync on what the recovery thread is doing. I think it will be constant churn there.\r\n\r\nTypically all operations on the pageFile hold the index lock, so it can be mostly sync free (the exception being the optional async writer thread).\r\n\r\nit may be worth a test though to validate :)\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-19T15:58:55.346+0000","updated":"2018-10-19T15:58:55.346+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16656994","id":"16656994","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Nice work [~gtully], this should work nicely to prevent the shutdown issue. When I'm back at the office Monday I will take a look at all of this in more depth and do some testing (I've been traveling for work all week)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-19T16:03:01.876+0000","updated":"2018-10-19T16:03:01.876+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16656995","id":"16656995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"So, we can lock only if the recoveredFreeList is not empty AND freeList is empty then ... no? This is a good trade off... we only have this hit during the recovery AND we need more free pages.... Imagine that probably allocate new pages will take more time than this sync...\r\n\r\nWould be amazing to have this free pages as soon we know about them... -Maybe with this we AMQ-7080 stop making sense at all...-  (AMQ-7080 can still have the potential to avoid lots of read - On a NFS we can have a limited throughout - mb/s - So maybe this still good) ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-19T16:03:20.935+0000","updated":"2018-10-19T16:15:57.794+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16657095","id":"16657095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"This is what I meant...\r\n\r\n[https://github.com/alanprot/activemq/commit/9b96e590de8b180815bd85dc701e8d0a8f28b031]\r\n\r\n:D","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-19T17:00:02.268+0000","updated":"2018-10-19T17:00:02.268+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16658069","id":"16658069","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbonofre","name":"jbonofre","key":"jbonofre","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jean-Baptiste Onofré","active":true,"timeZone":"Europe/Berlin"},"body":"Just reopen this one to include in next 5.15.7 release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbonofre","name":"jbonofre","key":"jbonofre","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jean-Baptiste Onofré","active":true,"timeZone":"Europe/Berlin"},"created":"2018-10-21T04:18:46.753+0000","updated":"2018-10-21T04:18:46.753+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16658304","id":"16658304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit c6103415b9a185776ebc16343c6574f7ff884806 in activemq's branch refs/heads/activemq-5.15.x from gtully\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=c610341 ]\n\nAMQ-7082 - recover index free pages in parallel with start, merge in flush, clean shutdown if complete. follow up on AMQ-6590\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-21T17:29:20.810+0000","updated":"2018-10-21T17:29:20.810+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16658306","id":"16658306","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"[~gtully], I love the merge...this makes sense and is a quick combination.  Since the flush() happens in the checkpointUpdate, that makes this thread safe.  Nice thinking about merging, that was a nice solution outside the box.\r\n\r\nThis definitely needs to go into 5.15.7.  I went ahead and did that as this closes the loop on any delays from freeList scanning.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2018-10-21T17:29:28.894+0000","updated":"2018-10-21T17:29:28.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16658959","id":"16658959","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"[~gtully] - I took a look at the patch, it looks ok to me although I think the variable {{needsFreePageRecovery}} needs to be marked as volatile because it's updated async in the new free page recovery thread that kicks off.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-10-22T12:56:38.944+0000","updated":"2018-10-22T12:56:38.944+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16659028","id":"16659028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit fb1e642c15fa842e5e25b80d89293d0bb03225c0 in activemq's branch refs/heads/master from gtully\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=fb1e642 ]\n\nAMQ-7082 - ensure flush sees free list, use lazySet to avoid store barrier, thanks cshannon\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-22T14:16:40.409+0000","updated":"2018-10-22T14:16:40.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16659033","id":"16659033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~cshannon] yep, good catch thanks. it is the lazySet semantic I was after, but I can't avoid calling it!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-22T14:21:23.833+0000","updated":"2018-10-22T14:21:23.833+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16659049","id":"16659049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit a9b81ace623d62e92b75ddc31c424c0ed4cae9d1 in activemq's branch refs/heads/activemq-5.15.x from gtully\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=a9b81ac ]\n\nAMQ-7082 - ensure flush sees free list, use lazySet to avoid store barrier, thanks cshannon\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-10-22T14:46:00.363+0000","updated":"2018-10-22T14:46:00.363+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676575","id":"16676575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~alanprot] pointed out an issue that can cause the concurrent free page recovery to walk on newly allocated and freed pages or pages in the process of being used.\r\n\r\nThe recovery processing needs to terminate at the nextFreePage id that exists at start. Everything after that is not recoverable, it is in use!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T10:29:05.021+0000","updated":"2018-11-06T10:29:05.021+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676576","id":"16676576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"The window is small, however with something like message expiry, and all messages expiring while the broker is down, there can be alot of page file churn immediately after start. In addition if the recovery is very long, the window gets larger.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T10:30:24.250+0000","updated":"2018-11-06T10:30:24.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676683","id":"16676683","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"[~gtully] -  is the issue that was found something that is critical (ie we have to release a 5.15.8 update soon) or could it wait for more fixes before a new release?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-11-06T12:12:14.709+0000","updated":"2018-11-06T12:12:14.709+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676687","id":"16676687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alvinlin123","name":"alvinlin123","key":"alvinlin123","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alvin Lin","active":true,"timeZone":"Etc/UTC"},"body":"[~cshannon] I do believe the issue is kind of critical (thus warrants 5.15.8 update soon) as it will lead to many mysterious behavior.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alvinlin123","name":"alvinlin123","key":"alvinlin123","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alvin Lin","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T12:21:47.873+0000","updated":"2018-11-06T12:21:47.873+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676718","id":"16676718","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user alanprot opened a pull request:\n\n    https://github.com/apache/activemq/pull/316\n\n    AMQ-7082 - Make sure that the recovery will only mark pages as free i…\n\n    …f they were created in a previous execution\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/alanprot/activemq AMQ-7082\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/316.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #316\n    \n----\ncommit 0d34338919edee863bd71693ee30999d9d9d6ce9\nAuthor: Alan Protasio <alanprot@...>\nDate:   2018-11-06T09:13:18Z\n\n    AMQ-7082 - Make sure that the recovery will only mark pages as free if they were created in a previous execution\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T12:52:22.514+0000","updated":"2018-11-06T12:52:22.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676723","id":"16676723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"Hi guys...\r\n\r\nI just created a PR with the tests...\r\n\r\nThanks! :D","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T12:55:08.931+0000","updated":"2018-11-06T12:55:08.931+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676744","id":"16676744","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"[~alanprot] - this looks good to me, I will merge it, thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-11-06T13:16:25.177+0000","updated":"2018-11-06T13:16:25.177+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676759","id":"16676759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 0d34338919edee863bd71693ee30999d9d9d6ce9 in activemq's branch refs/heads/master from [~alanprot]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=0d34338 ]\n\nAMQ-7082 - Make sure that the recovery will only mark pages as free if they were created in a previous execution\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T13:25:32.182+0000","updated":"2018-11-06T13:25:32.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676760","id":"16676760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 81062fde88eeb5fa970e70fd851b49d442a7116a in activemq's branch refs/heads/master from Christopher L. Shannon (cshannon)\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=81062fd ]\n\nMerge branch 'AMQ-7082'\n\nThis closes #316\n\nThanks to Alan Protasio for the patch\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T13:25:33.767+0000","updated":"2018-11-06T13:25:33.767+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676761","id":"16676761","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/activemq/pull/316\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T13:25:52.109+0000","updated":"2018-11-06T13:25:52.109+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676763","id":"16676763","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 45d7676bd95a7e4594a80b025994ea3242c94586 in activemq's branch refs/heads/activemq-5.15.x from [~alanprot]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=45d7676 ]\n\nAMQ-7082 - Make sure that the recovery will only mark pages as free if they were created in a previous execution\n\n(cherry picked from commit 0d34338919edee863bd71693ee30999d9d9d6ce9)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T13:26:56.931+0000","updated":"2018-11-06T13:26:56.931+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676764","id":"16676764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~cshannon] :D:D:D","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T13:27:20.648+0000","updated":"2018-11-06T13:27:20.648+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676765","id":"16676765","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"[~gtully] - I merged the fix can you take a quick look to make sure it looks good to you before we close this again?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-11-06T13:27:39.056+0000","updated":"2018-11-06T13:27:39.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676845","id":"16676845","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 505200b92a0d72666b6665f6026a97a8f215d895 in activemq's branch refs/heads/activemq-5.15.x from Christopher L. Shannon (cshannon)\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=505200b ]\n\nAMQ-7082 - fix compilation after merge\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T14:43:17.330+0000","updated":"2018-11-06T14:43:17.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16676862","id":"16676862","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Fix is good, thanks [~alanprot]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T15:00:13.902+0000","updated":"2018-11-06T15:00:13.902+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16677374","id":"16677374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user alanprot opened a pull request:\n\n    https://github.com/apache/activemq/pull/317\n\n    AMQ-7082 We should make sure that pages that is being recovered canno…\n\n    …t be reused\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/alanprot/activemq AMQ-7082-2\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/317.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #317\n    \n----\ncommit af4b52a426f35c3c01058c5f49e40baa9fd6d771\nAuthor: Alan Protasio <alanprot@...>\nDate:   2018-11-06T22:28:32Z\n\n    AMQ-7082 We should make sure that pages that is being recovered cannot be reused\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T22:38:23.181+0000","updated":"2018-11-06T22:38:23.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16677379","id":"16677379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"[~gtully] [~cshannon]\r\n\r\nSorry guys... but there is one more case that this can happen... \r\n\r\nImagine that you have a 1000 page in the file...\r\n\r\nT1 -> 1000 occupied pages\r\n\r\nT2 -> page 100 is freed (and so added to the freeList)\r\n\r\nT3 -> Background thread see the 100 page as free and so, add to the recoveryList\r\n\r\nT3 -> We need one more page and we allocate page 100 (as it was marked as free in the freeList).\r\n\r\nT4 -> background thread finish and mark 100 as free again...\r\n\r\nI did a PR there to prevent this... I did everything in a way that we dont need synchronization... \r\n\r\nI think now we pretty much got all the cases... \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T22:44:41.544+0000","updated":"2018-11-07T02:15:46.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16677995","id":"16677995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"peeking at the latest additions to the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T10:26:49.281+0000","updated":"2018-11-07T10:26:49.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16678078","id":"16678078","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 85859fd8dc22e3251de294c23d84c12b29d4fe81 in activemq's branch refs/heads/master from gtully\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=85859fd ]\n\nAMQ-7082 We should make sure that pages managed during recovery are not recovered in error\nvariation of patch from Alan Protasio <alanprot@gmail.com> closes #317\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T11:33:02.794+0000","updated":"2018-11-07T11:33:02.794+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16678079","id":"16678079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/activemq/pull/317\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T11:33:23.575+0000","updated":"2018-11-07T11:33:23.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16678090","id":"16678090","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~alanprot] I added an additional condition the the end of your new test to verify that newly freed pages could be reused and reworked to fix.\r\n\r\nThis ensures that there is no need for further growth while recovery is in progress which is better. I think we are finally good.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T11:38:57.727+0000","updated":"2018-11-07T11:38:57.727+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16678344","id":"16678344","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"body":"[~gtully] Makes lots of sense....\r\n\r\nIf the page was freed after the restart, they should be removed from recoveredFreeList before merging as they are already tracked in freeList. This will prevent them to came back at the end of the recovery..\r\n\r\nSound really good for me!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alanprot","name":"alanprot","key":"alanprot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alanprot&avatarId=36437","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alanprot&avatarId=36437","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alanprot&avatarId=36437","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alanprot&avatarId=36437"},"displayName":"Alan Protasio","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T15:01:26.309+0000","updated":"2018-11-07T20:26:41.168+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16678564","id":"16678564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit ca6293b55ce49f2d0851e901d2abd62a3d6d82b6 in activemq's branch refs/heads/activemq-5.15.x from gtully\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ca6293b ]\n\nAMQ-7082 We should make sure that pages managed during recovery are not recovered in error\nvariation of patch from Alan Protasio <alanprot@gmail.com> closes #317\n\n(cherry picked from commit 85859fd8dc22e3251de294c23d84c12b29d4fe81)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-07T17:46:39.920+0000","updated":"2018-11-07T17:46:39.920+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16678712","id":"16678712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromeinsf","name":"jeromeinsf","key":"jeromeinsf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jérôme Decq","active":true,"timeZone":"America/Vancouver"},"body":"[~gtully] What is the strategy wrt ActiveMQ 5.15.7 version in such a case?\r\n\r\n5.15.7 provides a fix for critical bug AMQ-7067 but the original fix for this particular bug (AMQ-7082) introduced another bug that could be considered as critical by certain given this type of comments: https://issues.apache.org/jira/browse/AMQ-7082?focusedCommentId=16676687&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16676687  \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromeinsf","name":"jeromeinsf","key":"jeromeinsf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jérôme Decq","active":true,"timeZone":"America/Vancouver"},"created":"2018-11-07T19:59:30.320+0000","updated":"2018-11-07T20:01:04.218+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16678730","id":"16678730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"[~jeromeinsf] - You have a valid point.  This Jira should have been left at 5.15.7 since it was resolved, and a new Jira should have been opened to track 5.15.8 with the additional changes that were submitted. [~gtully], Do you think that we set this back to the fix in 5.15.7, and get the changes for 5.15.8 in a new Jira to track this more clearly?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2018-11-07T20:16:04.860+0000","updated":"2018-11-07T20:16:04.860+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16678745","id":"16678745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Yeah, just create a new Jira and link this one with the new Jira (I think there is a caused by association to say this one caused a bug).  That makes more sense to me as it will be easier to follow.  I will set this back to 5.15.7.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2018-11-07T20:29:36.110+0000","updated":"2018-11-07T20:30:19.563+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13192835/comment/16678769","id":"16678769","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"body":"Reopened and closed - continued with AMQ-7093","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgenender","name":"jgenender","key":"jgenender","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Genender","active":true,"timeZone":"America/Denver"},"created":"2018-11-07T21:03:23.221+0000","updated":"2018-11-07T21:03:23.221+0000"}],"maxResults":42,"total":42,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7082/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3zetb:"}}