{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483508","self":"https://issues.apache.org/jira/rest/api/2/issue/12483508","key":"AMQ-2880","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315624","id":"12315624","description":"Maintenance release for 5.4.0","name":"5.4.1","archived":false,"released":true,"releaseDate":"2010-09-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-08-30T13:03:19.464+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Sep 08 16:31:15 UTC 2010","customfield_12310420":"14716","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_442458534_*|*_5_*:*_2_*:*_607329966_*|*_4_*:*_1_*:*_87467266","customfield_12312321":null,"resolutiondate":"2010-09-08T16:31:15.209+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2880/watchers","watchCount":1,"isWatching":false},"created":"2010-08-26T12:36:59.443+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-09-08T16:37:21.983+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"In cases where JDBC persistence is used and the database server is under a fair bit of load it's sometimes possible for table/row locks to time out, which means you'll see exceptions such as:\n\njava.sql.BatchUpdateException: Lock wait timeout exceeded; try restarting transaction\nat com.mysql.jdbc.PreparedStatement.executeBatchSerially(PreparedStatement.java:1693)\nat com.mysql.jdbc.PreparedStatement.executeBatch(PreparedStatement.java:1108)\nat org.apache.commons.dbcp.DelegatingStatement.executeBatch(DelegatingStatement.java:297)\nat org.apache.commons.dbcp.DelegatingStatement.executeBatch(DelegatingStatement.java:297)\nat org.apache.activemq.store.jdbc.TransactionContext.executeBatch(TransactionContext.java:98)\nat org.apache.activemq.store.jdbc.TransactionContext.executeBatch(TransactionContext.java:80)\nat org.apache.activemq.store.jdbc.TransactionContext.commit(TransactionContext.java:161)\nat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.commitTransaction(JDBCPersistenceAdapter.java:504)\nat org.apache.activemq.store.memory.MemoryTransactionStore$Tx.commit(MemoryTransactionStore.java:109)\nat org.apache.activemq.store.memory.MemoryTransactionStore.commit(MemoryTransactionStore.java:220)\nat org.apache.activemq.transaction.XATransaction.commit(XATransaction.java:73)\nat org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:176)\nat org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:103)\nat org.apache.activemq.broker.TransportConnection.processCommitTransactionTwoPhase(TransportConnection.java:430)\nat org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:102)\nat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:309)\nat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:185)\nat org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\nat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\nat org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:217)\nat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\nat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:219)\nat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:201)\nat java.lang.Thread.run(Thread.java:636)\n\nIn this case the connection to the database is fine and what we should do is retry the transaction as it's a temporary failure condition.  Instead what happens is the broker moves to the next message in the queue, leaving the current message in the database.  The message won't show up in the web console and cannot be consumed by any consumers until the broker is restarted.\n\nAttached is a test case that simulates the error condition in a controlled fashion by using a subclassed JDBCPersistenceAdapter that will throw an exception in commitTransaction as necessary.  So the producer sends 10 messages and then the consumer tries to consume them, during this time the persistence adapter will throw an exception during commitTransaction.  Then the condition is cleared and the consumer can consume all 10 messages, however the consumer only consumes 9 messages, the 1st message in the sequence is still in the database.  Hopefully the logging makes this clear.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461842","id":"12461842","filename":"patch_for_xa_transaction.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-09-07T20:48:02.899+0000","size":2154,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461842/patch_for_xa_transaction.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461775","id":"12461775","filename":"test-case.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-08-26T19:37:38.490+0000","size":7696,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461775/test-case.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461774","id":"12461774","filename":"test-case.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-08-26T12:37:19.753+0000","size":7685,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461774/test-case.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461841","id":"12461841","filename":"xa-test-case.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-09-07T20:48:02.820+0000","size":11926,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461841/xa-test-case.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"63699","customfield_12312823":null,"summary":"Exception thrown during commit leads to message loss","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"subtasks":[{"id":"12483705","key":"AMQ-2551","self":"https://issues.apache.org/jira/rest/api/2/issue/12483705","fields":{"summary":"Locking issue with MySQL InnoDB","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483508/comment/12942765","id":"12942765","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"body":"Just a note to simulate the real lock timeout exception using MySQL you can just lock some rows in the table, for example:\n\nstart transaction;\nselect id from activemq_msgs limit 10 for update;\n\nthen try and consume some messages.  ActiveMQ will get block and then get a lock timeout when it hits these locked rows.  Then release the lock with:\n\ncommit;\n\nafter consuming all of the messages in the queue that you can you'll see those locked rows are still in the table and hadn't been consumed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-08-26T15:15:38.452+0000","updated":"2010-08-26T15:15:38.452+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483508/comment/12942764","id":"12942764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"body":"This shows the problem better, as each time a new consumer is created to receive a message from the queue a message is lost.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-08-26T19:37:38.560+0000","updated":"2010-08-26T19:37:38.560+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483508/comment/12942793","id":"12942793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"https://issues.apache.org/activemq/browse/AMQ-2551 - can result from the checkpoint thread, the fix to this issue ensures that there are no adverse effects to it occurring save the failure of the current operation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-30T13:03:19.464+0000","updated":"2010-08-30T13:03:19.464+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483508/comment/12942796","id":"12942796","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"resolved in r991218\n\na jms transaction rollback was needed in the even of a store failure on an ack. in addition test case needed maxredeliveries > numMessages to ensure replayed messages were not sent to dlq.\nfix an test from patch applied with thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-31T15:31:17.952+0000","updated":"2010-08-31T15:31:17.952+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483508/comment/12942875","id":"12942875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"body":"This problem also occurs with XA transactions (like in the example stack trace) so we need a similar fix for this scenario.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-09-07T16:13:27.927+0000","updated":"2010-09-07T16:13:27.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483508/comment/12942836","id":"12942836","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"body":"This should take care of XA transactions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-09-07T17:33:43.249+0000","updated":"2010-09-07T17:33:43.249+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483508/comment/12942837","id":"12942837","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"body":"Here's a test for XATransaction.  I'm finding however that catching the exception within commit and calling rollback() from there doesn't seem to fix the issue.  Instead it seems like the message is effectively lost, as when the dummy persistent store throws it's exception the message is out of the database, I wouldn't have expected that.  Also to properly rollback in the client I had to call XAResource.start() for some reason, also a bit unexpected.  Anyway, am also attaching the changes I had done to XATransaction.java.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slewis","name":"slewis","key":"slewis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slewis&avatarId=12536","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slewis&avatarId=12536","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slewis&avatarId=12536","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slewis&avatarId=12536"},"displayName":"Stan Lewis","active":true,"timeZone":"America/New_York"},"created":"2010-09-07T20:48:02.944+0000","updated":"2010-09-07T20:48:02.944+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483508/comment/12942872","id":"12942872","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"r995119 \nnew xa test variant from patch applied. thanks for the work on this one. XA case is now sorted.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-08T16:31:15.193+0000","updated":"2010-09-08T16:37:21.958+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2880/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0b9sn:"}}