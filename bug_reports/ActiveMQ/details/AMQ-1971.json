{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482475","self":"https://issues.apache.org/jira/rest/api/2/issue/12482475","key":"AMQ-1971","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-10-12T08:58:36.735+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 06 10:47:07 UTC 2008","customfield_12310420":"75146","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_396928281_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2008-10-13T08:57:38.763+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1971/watchers","watchCount":0,"isWatching":false},"created":"2008-10-08T18:42:10.482+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-11-06T10:47:07.647+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"This is occurring in the thousands as messages come through.    We have a network of 5 brokers although they do most of their work internally (publisher/consumer for queue are only on same broker) and do less work crossing to a central broker.\n\njava.util.ConcurrentModificationException\n\tat java.util.LinkedHashMap$LinkedHashIterator.nextEntry(LinkedHashMap.java:373)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:392)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:391)\n\tat org.apache.activemq.broker.region.cursors.AbstractStoreCursor.next(AbstractStoreCursor.java:136)\n\tat org.apache.activemq.broker.region.cursors.StoreQueueCursor.next(StoreQueueCursor.java:140)\n\tat org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1178)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1290)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1004)\n\tat org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)\n\tat org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461249","id":"12461249","filename":"amq1971.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-13T06:56:13.608+0000","size":11246,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461249/amq1971.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"233304","customfield_12312823":null,"summary":"ConcurrentModificationException in high volume broker ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12940328","id":"12940328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"body":"More recent flavor of the same, but with a hash bin resize message nearby in case that is relevant.\n\nERROR Queue                          - Failed to page in more queue messages\njava.util.ConcurrentModificationException\n\tat java.util.LinkedHashMap$LinkedHashIterator.nextEntry(LinkedHashMap.java:373)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:392)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:391)\n\tat org.apache.activemq.broker.region.cursors.AbstractStoreCursor.next(AbstractStoreCursor.java:136)\n\tat org.apache.activemq.broker.region.cursors.StoreQueueCursor.next(StoreQueueCursor.java:140)\n\tat org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1178)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1290)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1004)\n\tat org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)\n\tat org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\nINFO  HashIndex                      - Resize hash bins data_queue#3a#2f#2fmag.query1.queue.record.physical.augment from 1024 to 2048\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-11T22:36:59.025+0000","updated":"2008-10-11T22:37:56.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12940343","id":"12940343","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"body":"This is on 5.2.0 built from SVN tag of the same name.  Client producer/consumers use POM 5.2.0 from staging server.  JDK 1.6 on Linux.\n\nBug also exists when running on 1 broker without a network of brokers.  \n\nThe series of queues basically are via Camel:\n\nFile -> parsing -> queue\nqueue -> normalization -> queue\nqueue -> database transactions -> queue\nqueue -> external systems ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-11T22:57:22.703+0000","updated":"2008-10-11T22:57:36.602+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12940312","id":"12940312","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"body":"Have you tried RC2?\n\nSee http://www.nabble.com/-VOTE--ActiveMQ-5.2.0---RC2-td19874910.html\n\nIf it fails, vote -1 and add the link to this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hansb","name":"hansb","key":"hansb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hans Bausewein","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-12T08:58:36.735+0000","updated":"2008-10-12T08:58:36.735+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12940338","id":"12940338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"body":"Trying it now.  I'll pull his binaries and make sure the client updates (should already via the POM)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-12T19:16:44.694+0000","updated":"2008-10-12T19:16:44.694+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12940329","id":"12940329","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"body":"Still have error on single broker run...  JDK 1.6, ACTIVEMQ_OPTS=-Xmx1g, pretty vanilla activemq.xml configuration other than changing broker name and adding a few settings here to the broker element for testing:\n\n<broker xmlns=\"http://activemq.apache.org/schema/core\" brokerName=\"${HOSTNAME}\" dataDirectory=\"${activemq.base}/data\"\n        keepDurableSubsActive=\"true\" useJmx=\"true\" useVirtualTopics=\"false\" deleteAllMessagesOnStartup=\"true\" >\n\n\nINFO  log                            - jetty-6.1.9\nINFO  WebConsoleStarter              - ActiveMQ WebConsole initialized.\nINFO  /admin                         - Initializing Spring FrameworkServlet 'dispatcher'\nINFO  log                            - ActiveMQ Console at http://0.0.0.0:8161/admin\nINFO  log                            - ActiveMQ Web Demos at http://0.0.0.0:8161/demo\nINFO  log                            - RESTful file access application at http://0.0.0.0:8161/fileserver\nINFO  log                            - Started SelectChannelConnector@0.0.0.0:8161\nWARN  BrokerRegistry                 - Broker localhost not started so using query1.removed.removed.com instead\nINFO  TransportConnector             - Connector vm://localhost Started\nERROR Queue                          - Failed to page in more queue messages \njava.util.ConcurrentModificationException\n\tat java.util.LinkedHashMap$LinkedHashIterator.nextEntry(LinkedHashMap.java:373)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:392)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:391)\n\tat org.apache.activemq.broker.region.cursors.AbstractStoreCursor.next(AbstractStoreCursor.java:136)\n\tat org.apache.activemq.broker.region.cursors.StoreQueueCursor.next(StoreQueueCursor.java:140)\n\tat org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1181)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1308)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1011)\n\tat org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)\n\tat org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\nERROR Queue                          - Failed to page in more queue messages \njava.util.ConcurrentModificationException\n\tat java.util.LinkedHashMap$LinkedHashIterator.nextEntry(LinkedHashMap.java:373)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:392)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:391)\n\tat org.apache.activemq.broker.region.cursors.AbstractStoreCursor.next(AbstractStoreCursor.java:136)\n\tat org.apache.activemq.broker.region.cursors.StoreQueueCursor.next(StoreQueueCursor.java:140)\n\tat org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1181)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1308)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1011)\n\tat org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)\n\tat org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\nERROR Queue                          - Failed to page in more queue messages \njava.util.ConcurrentModificationException\n\tat java.util.LinkedHashMap$LinkedHashIterator.nextEntry(LinkedHashMap.java:373)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:392)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:391)\n\tat org.apache.activemq.broker.region.cursors.AbstractStoreCursor.next(AbstractStoreCursor.java:136)\n\tat org.apache.activemq.broker.region.cursors.StoreQueueCursor.next(StoreQueueCursor.java:140)\n\tat org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1181)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1308)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1011)\n\tat org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)\n\tat org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\nERROR Queue                          - Failed to page in more queue messages \njava.util.ConcurrentModificationException\n\tat java.util.LinkedHashMap$LinkedHashIterator.nextEntry(LinkedHashMap.java:373)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:392)\n\tat java.util.LinkedHashMap$EntryIterator.next(LinkedHashMap.java:391)\n\tat org.apache.activemq.broker.region.cursors.AbstractStoreCursor.next(AbstractStoreCursor.java:136)\n\tat org.apache.activemq.broker.region.cursors.StoreQueueCursor.next(StoreQueueCursor.java:140)\n\tat org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1181)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1308)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1011)\n\tat org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)\n\tat org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-12T19:42:43.450+0000","updated":"2008-10-12T19:42:43.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12940334","id":"12940334","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"body":"Queues form admin console look like this at time of failure (note that the admin UI now truncates queue names for display making most unreadable and unusable in the display).  Note that some queue sizes are negative numbers which we've seen before but not tracked down to anything specific.\n\n<queues>\n\n<queue name=\"mag.query1.queue.record.physical\">\n\n  <stats size=\"-2\" consumerCount=\"10\" enqueueCount=\"29610\" dequeueCount=\"29612\"/>\n\n\n  <feed>\n    <atom>queueBrowse/mag.query1.queue.record.physical?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/mag.query1.queue.record.physical?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"mag.query1.queue.record.physical.pdf\">\n\n  <stats size=\"6\" consumerCount=\"0\" enqueueCount=\"6\" dequeueCount=\"0\"/>\n\n\n  <feed>\n    <atom>queueBrowse/mag.query1.queue.record.physical.pdf?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/mag.query1.queue.record.physical.pdf?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"mag.queue.record.search.zh\">\n\n  <stats size=\"0\" consumerCount=\"10\" enqueueCount=\"10\" dequeueCount=\"10\"/>\n\n\n  <feed>\n    <atom>queueBrowse/mag.queue.record.search.zh?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/mag.queue.record.search.zh?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"mag.queue.record.search.en\">\n\n  <stats size=\"-7\" consumerCount=\"10\" enqueueCount=\"29602\" dequeueCount=\"29609\"/>\n\n\n  <feed>\n    <atom>queueBrowse/mag.queue.record.search.en?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/mag.queue.record.search.en?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"mag.Events.Errors\">\n\n  <stats size=\"0\" consumerCount=\"1\" enqueueCount=\"8\" dequeueCount=\"8\"/>\n\n\n  <feed>\n    <atom>queueBrowse/mag.Events.Errors?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/mag.Events.Errors?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"mag.queue.record.logical\">\n\n  <stats size=\"0\" consumerCount=\"1\" enqueueCount=\"29612\" dequeueCount=\"29612\"/>\n\n\n  <feed>\n    <atom>queueBrowse/mag.queue.record.logical?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/mag.queue.record.logical?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"test.existingRecordQueue\">\n\n  <stats size=\"0\" consumerCount=\"1\" enqueueCount=\"0\" dequeueCount=\"0\"/>\n\n\n  <feed>\n    <atom>queueBrowse/test.existingRecordQueue?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/test.existingRecordQueue?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"mag.query1.queue.record.raw\">\n\n  <stats size=\"138407\" consumerCount=\"50\" enqueueCount=\"168029\" dequeueCount=\"29622\"/>\n\n\n  <feed>\n    <atom>queueBrowse/mag.query1.queue.record.raw?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/mag.query1.queue.record.raw?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"example.A\">\n\n  <stats size=\"0\" consumerCount=\"1\" enqueueCount=\"0\" dequeueCount=\"0\"/>\n\n\n  <feed>\n    <atom>queueBrowse/example.A?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/example.A?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"mag.query1.queue.record.physical.augment\">\n\n  <stats size=\"0\" consumerCount=\"1\" enqueueCount=\"27311\" dequeueCount=\"27311\"/>\n\n\n  <feed>\n    <atom>queueBrowse/mag.query1.queue.record.physical.augment?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/mag.query1.queue.record.physical.augment?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n<queue name=\"mag.queue.record.search.other\">\n\n  <stats size=\"0\" consumerCount=\"10\" enqueueCount=\"0\" dequeueCount=\"0\"/>\n\n\n  <feed>\n    <atom>queueBrowse/mag.queue.record.search.other?view=rss&amp;feedType=atom_1.0</atom>\n    <rss>queueBrowse/mag.queue.record.search.other?view=rss&amp;feedType=rss_2.0</rss>\n  </feed>\n</queue>\n\n</queues>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-12T19:50:00.333+0000","updated":"2008-10-12T19:50:00.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12940324","id":"12940324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"body":"I have a tested patch for the ConcurrentModificationException in AMQ-1971, this also uncovered a bug with a related class.  See below:\n\nPatch to fix ConcurrentModificationException which is caused by not having a perfectly synchronized this.iterator and this.batchList in AbstractStoreCursor.  Also removed any access to these member variables from subclasses to ensure they are synchronized and make sure they are not manipulated seperately.  This caused a small change in TopicStorePrefetch which had a reference to batchList although it actually overrode the ancestor class which meant that its remove() method never actually worked.  So that was replaced with a call to AbstractSoreCursor to do the actual remove work.  A few TODO comments are left in the patch for review by someone that knows more.\n\nBasically, the fix is to ensure that all changes to batchList cause a release of the cached iterator.\n\nI apologize in advance for reformatting the code before generating the patch.  I did that midway through the edit and it is a constant habit so it caused some noise in the patch.  If you apply it, then diff while ignoring white-space most of the noise is removed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-13T06:56:13.689+0000","updated":"2008-10-13T06:58:14.572+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12940346","id":"12940346","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed by SVN revision 703975","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-13T08:57:38.760+0000","updated":"2008-10-13T08:57:38.760+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12940320","id":"12940320","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"body":"Hey Rob, thanks for making a fix.  A quick question about the TopicStorePrefetch descendant class.  It instantiates its own batchList which then hides the ancestor one.  IT looks like you removed the dispatched() method which eliminates the previous issue I fixed and makes that part irrelevant.  But should the private batchList still be there in TopicStorePrefetch since it now appears to be unused?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayson.minard","name":"jayson.minard","key":"jayson.minard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayson Minard","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-13T09:05:01.340+0000","updated":"2008-10-13T09:05:01.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482475/comment/12939439","id":"12939439","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"These fixes will now make 5.2.0 rc3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-06T10:47:07.645+0000","updated":"2008-11-06T10:47:07.645+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1971/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i14bd3:"}}