{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12505307","self":"https://issues.apache.org/jira/rest/api/2/issue/12505307","key":"AMQ-3299","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2011-04-27T16:10:50.740+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 01 19:16:34 UTC 2011","customfield_12310420":"43739","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5634633653_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-01T19:16:34.268+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3299/watchers","watchCount":0,"isWatching":false},"created":"2011-04-27T14:06:00.642+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-07-01T19:16:34.290+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Considering this link: http://activemq.apache.org/activemq-performance-module-users-manual.html and sample test performance benchmarks of 1 million messages every 5 mins, I created and ran a priority test with 333 messages being sent every second.\n\nProblem: It appears as if the priority algorithm is not being applied (or even attempted) to many of the messages in the middle of the run.  Consider this output and examine the message order. Note: the number following the #s represent the message and order-number sent by the producer.  In this piece of the consumer log, these numbers are sequentially ordered meaning that the producer did not order them (based on priority) before sending them out:\n\n...\n09:59:58 INFO  MESSAGE PRI-4 #20951 Count-19953\n09:59:58 INFO  MESSAGE PRI-9 #20952 Count-19954\n09:59:58 INFO  MESSAGE PRI-2 #20953 Count-19955\n09:59:58 INFO  MESSAGE PRI-5 #20954 Count-19956\n09:59:58 INFO  MESSAGE PRI-5 #20955 Count-19957\n09:59:58 INFO  MESSAGE PRI-9 #20956 Count-19958\n09:59:58 INFO  MESSAGE PRI-7 #20957 Count-19959\n09:59:58 INFO  MESSAGE PRI-0 #10648 Count-19960\n09:59:58 INFO  MESSAGE PRI-3 #20959 Count-19961\n09:59:58 INFO  MESSAGE PRI-2 #20960 Count-19962\n09:59:58 INFO  MESSAGE PRI-8 #20961 Count-19963\n09:59:58 INFO  MESSAGE PRI-4 #20962 Count-19964\n09:59:58 INFO  MESSAGE PRI-7 #20963 Count-19965\n09:59:58 INFO  MESSAGE PRI-3 #20964 Count-19966\n09:59:58 INFO  MESSAGE PRI-9 #20965 Count-19967\n09:59:58 INFO  MESSAGE PRI-3 #20966 Count-19968\n09:59:58 INFO  MESSAGE PRI-7 #20967 Count-19969\n09:59:58 INFO  MESSAGE PRI-1 #20968 Count-19970\n09:59:58 INFO  MESSAGE PRI-8 #20969 Count-19971\n09:59:58 INFO  MESSAGE PRI-1 #20970 Count-19972\n09:59:58 INFO  MESSAGE PRI-8 #20971 Count-19973\n09:59:58 INFO  MESSAGE PRI-9 #20972 Count-19974\n09:59:58 INFO  MESSAGE PRI-2 #20973 Count-19975\n09:59:58 INFO  MESSAGE PRI-4 #20974 Count-19976\n09:59:58 INFO  MESSAGE PRI-6 #20975 Count-19977\n09:59:58 INFO  MESSAGE PRI-8 #20976 Count-19978\n09:59:58 INFO  MESSAGE PRI-2 #20977 Count-19979\n09:59:58 INFO  MESSAGE PRI-5 #20978 Count-19980\n09:59:58 INFO  MESSAGE PRI-6 #20979 Count-19981\n09:59:58 INFO  MESSAGE PRI-5 #20980 Count-19982\n09:59:58 INFO  MESSAGE PRI-1 #20981 Count-19983\n09:59:58 INFO  MESSAGE PRI-4 #20982 Count-19984\n09:59:58 INFO  MESSAGE PRI-5 #20983 Count-19985\n09:59:58 INFO  MESSAGE PRI-2 #20984 Count-19986\n09:59:58 INFO  MESSAGE PRI-6 #20985 Count-19987\n09:59:58 INFO  MESSAGE PRI-8 #20986 Count-19988\n09:59:58 INFO  MESSAGE PRI-7 #20987 Count-19989\n09:59:58 INFO  MESSAGE PRI-3 #20988 Count-19990\n09:59:58 INFO  MESSAGE PRI-7 #20989 Count-19991\n09:59:58 INFO  MESSAGE PRI-3 #20990 Count-19992\n09:59:58 INFO  MESSAGE PRI-4 #20991 Count-19993\n09:59:58 INFO  MESSAGE PRI-5 #20992 Count-19994\n09:59:58 INFO  MESSAGE PRI-6 #20993 Count-19995\n09:59:58 INFO  MESSAGE PRI-1 #20994 Count-19996\n09:59:58 INFO  MESSAGE PRI-0 #10667 Count-19997\n09:59:58 INFO  MESSAGE PRI-7 #20996 Count-19998\n09:59:58 INFO  MESSAGE PRI-3 #20997 Count-19999\n09:59:58 INFO  MESSAGE PRI-8 #20998 Count-20000\n09:59:58 INFO  MESSAGE PRI-8 #20999 Count-20001\n...\n\nI am separately attaching fuller consumer and producer logs.  Clear ordering of messages is noticeable at the beginning and end of the test in the consumer log.  Actually, there appears to the sending the high priority messages, followed by the sending of expedited messages intermixed with aged normal priority messages, followed by no ordering, followed by low priority messages with the value of '0'.  The question is...  why did the message ordering stop?\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12477540","id":"12477540","filename":"priority_consumer_log.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gliesian","name":"gliesian","key":"gliesian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gliesian&avatarId=10342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gliesian&avatarId=10342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gliesian&avatarId=10342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gliesian&avatarId=10342"},"displayName":"Robert Liguori","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-27T14:22:04.893+0000","size":1204600,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12477540/priority_consumer_log.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12477541","id":"12477541","filename":"priority_publisher_log.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gliesian","name":"gliesian","key":"gliesian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gliesian&avatarId=10342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gliesian&avatarId=10342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gliesian&avatarId=10342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gliesian&avatarId=10342"},"displayName":"Robert Liguori","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-27T14:22:04.915+0000","size":1816558,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12477541/priority_publisher_log.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172471","customfield_12312823":null,"summary":"Prioritizing of messages isn't applied to all messages during test.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gliesian","name":"gliesian","key":"gliesian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gliesian&avatarId=10342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gliesian&avatarId=10342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gliesian&avatarId=10342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gliesian&avatarId=10342"},"displayName":"Robert Liguori","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gliesian","name":"gliesian","key":"gliesian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gliesian&avatarId=10342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gliesian&avatarId=10342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gliesian&avatarId=10342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gliesian&avatarId=10342"},"displayName":"Robert Liguori","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Operating System = Windows XP version 5.1 running on x86\nJava; VM; Vendor = 1.6.0_23\nRuntime = Java HotSpot(TM) Client VM 19.0-b09","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12505307/comment/13025868","id":"13025868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"You need to enable priority dispatch via the broker config (destination policy) for a destination.\n\nAlso note that the default store, kahaDB supports high (>4), default(4) and low(<4),so three priorities only. The JDBC store supports 0-9.\n\nHave a look at the org.apache.activemq.store.MessagePriorityTest for the configuration. There are two variants, JDBC and KahaDB that show the difference in implementation.\n\neg:\nhttp://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/store/jdbc/JDBCMessagePriorityTest.java?view=log\n\nhttp://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/store/kahadb/KahaDBMessagePriorityTest.java?view=log","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-27T16:10:50.740+0000","updated":"2011-04-27T16:10:50.740+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12505307/comment/13025876","id":"13025876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gliesian","name":"gliesian","key":"gliesian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gliesian&avatarId=10342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gliesian&avatarId=10342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gliesian&avatarId=10342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gliesian&avatarId=10342"},"displayName":"Robert Liguori","active":true,"timeZone":"Etc/UTC"},"body":"Gary,\n\nCan you please be more specific with this: \"You need to enable priority dispatch via the broker config (destination policy) for a destination.\"\n\nEspecially in regards to how it will change what I am seeing, and why.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gliesian","name":"gliesian","key":"gliesian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gliesian&avatarId=10342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gliesian&avatarId=10342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gliesian&avatarId=10342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gliesian&avatarId=10342"},"displayName":"Robert Liguori","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-27T16:20:52.771+0000","updated":"2011-04-27T16:21:14.168+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12505307/comment/13025883","id":"13025883","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"The configuration is described at http://activemq.apache.org/how-can-i-support-priority-queues.html, consumer have priority enabled by default, so prefetched messages will be reordered. But without the broker ordering message dispatch you will get only partial ordering.\nAlso, have a look at the test case. If you find problems, a variation of the existing test case is a great way to submit an issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-27T16:37:53.181+0000","updated":"2011-04-27T16:37:53.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12505307/comment/13025905","id":"13025905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"{quote}\"But without the broker ordering message dispatch you will get only partial ordering.\"\n\nDo you mean this: prioritizedMessages=\"true\".{quote}\nyes, a reply to your direct email bounced!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-27T17:24:17.341+0000","updated":"2011-04-27T17:25:49.304+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12505307/comment/13027326","id":"13027326","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gliesian","name":"gliesian","key":"gliesian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gliesian&avatarId=10342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gliesian&avatarId=10342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gliesian&avatarId=10342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gliesian&avatarId=10342"},"displayName":"Robert Liguori","active":true,"timeZone":"Etc/UTC"},"body":"Okay, great thanks... can  you please be more specific in regards to partial ordering occurring when prioritizedMessages is set to false.\n\nThat is, what is and is not occurring with the prioritizedMessages setting is set to *false*, and  what is and is not occurring with the prioritizedMessages setting is set to *true*?\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gliesian","name":"gliesian","key":"gliesian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gliesian&avatarId=10342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gliesian&avatarId=10342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gliesian&avatarId=10342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gliesian&avatarId=10342"},"displayName":"Robert Liguori","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-30T12:27:48.061+0000","updated":"2011-04-30T14:47:30.822+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12505307/comment/13058719","id":"13058719","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Working ass designed.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-07-01T19:16:34.276+0000","updated":"2011-07-01T19:16:34.276+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3299/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tvv3:"}}