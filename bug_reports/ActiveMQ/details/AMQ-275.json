{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481609","self":"https://issues.apache.org/jira/rest/api/2/issue/12481609","key":"AMQ-275","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315611","id":"12315611","description":"","name":"4.0.1","archived":false,"released":true,"releaseDate":"2006-06-16"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2005-07-15T21:07:30.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 04 00:42:42 UTC 2006","customfield_12310420":"48996","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1986537000_*|*_6_*:*_2_*:*_10146590000_*|*_5_*:*_1_*:*_0_*|*_4_*:*_2_*:*_20364466000","customfield_12312321":null,"resolutiondate":"2006-07-04T00:42:42.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-275/watchers","watchCount":1,"isWatching":false},"created":"2005-06-22T21:36:09.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315600","id":"12315600","name":"3.0","archived":false,"released":true}],"issuelinks":[{"id":"12334927","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334927","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12481023","key":"AMQ-219","self":"https://issues.apache.org/jira/rest/api/2/issue/12481023","fields":{"summary":"Too many open files caused by DataContainer.java","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-07-04T00:42:42.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Relaited to slow consumer condition.\n\nWARN 2005-06-22 12:55:44,135 - Queue is full, waiting for it to be dequeued.\n\n\n2005-06-22 11:51:09,678 [ocalport=61616]] WARN  BrokerClientImpl               - Connection: ID:ny-cap-33-2024-1119453996333-6:0 is a slow consumer\n2005-06-22 11:51:09,678 [ocalport=61616]] WARN  BrokerClientImpl               - Connection: ID:ny-cap-33-2024-1119453996333-6:0 is a slow consumer\n2005-06-22 11:51:09,694 [ocalport=61616]] INFO  DataContainer                  - making directory for temporary spooled data: ActiveMQTemp\n2005-06-22 11:51:11,069 [ocalport=61616]] WARN  BrokerClientImpl               - Connection: ID:ny-cap-33-2005-1119453893347-6:0 is a slow consumer\n2005-06-22 11:51:11,069 [ocalport=61616]] WARN  BrokerClientImpl               - Connection: ID:ny-cap-33-2005-1119453893347-6:0 is a slow consumer\n\n2005-06-22 11:51:17,288 [ocalport=61616]] DEBUG ientTopicBoundedMessageManager - Adding consumer: CONSUMER_INFO: id = 336 ConsumerInfo{ browser = false, destination = ActiveMQ.Advisory.TempDestinations.temp-queue.TemporaryQueue-{TD{ID:ny-cap-33-2150-1119455437835-16:0}TD}ID:ny-cap-33-2150-1119455437835-23:0, consumerIdentifier = 'ID:ny-cap-33-2024-1119453996333-16:0.27.53' , clientId = 'ID:ny-cap-33-2024-1119453996333-16:0' , sessionId = '27' , consumerName = '' , selector = '' , startTime = 1119455477008, started = true, consumerNo = 53, noLocal = false, prefetchNumber = 1000, consumerKey = '[ID:ny-cap-33-2024-1119453996333-16:0:]'  }\n2005-06-22 11:51:54,773 [ocalport=61616]] ERROR BrokerClientImpl               - Could not enqueue message ACTIVEMQ_OBJECT_MESSAGE: id = 0 ActiveMQMessage{ , jmsMessageID = ID:ny-cap-33-2005-1119453893347-68:121589, bodyAsBytes = org.activemq.io.util.ByteArray@1f07377, readOnlyMessage = false, jmsClientID = 'ID:ny-cap-33-2005-1119453893347-6:0' , jmsCorrelationID = 'null' , jmsDestination = Topic.sds.PropertyTemplatePublisher, jmsReplyTo = null, jmsDeliveryMode = 2, jmsRedelivered = false, jmsType = 'null' , jmsExpiration = 1119455573508, jmsPriority = 4, jmsTimestamp = 1119455513508, properties = null, readOnlyProperties = false, entryBrokerName = 'ID:nyotc023-2882-1119382254093-0:0' , entryClusterName = 'default' , consumerNos = [I@12cb4ae, transactionId = 'null' , xaTransacted = false, consumerIdentifer = 'null' , messageConsumed = false, transientConsumed = false, sequenceNumber = 121589, deliveryCount = 1, dispatchedFromDLQ = false, messageAcknowledge = null, jmsMessageIdentity = null, producerKey = ID:ny-cap-33-2005-1119453893347-68: } ActiveMQObjectMessage{ object = null } to SpooledBoundedQueue for this slow consumer\njavax.jms.JMSException: enqueNoBlock failed: Too many open files\n\tat org.activemq.io.util.SpooledBoundedActiveMQMessageQueue.enqueueNoBlock(SpooledBoundedActiveMQMessageQueue.java:121)\n\tat org.activemq.io.util.SpooledBoundedActiveMQMessageQueue.enqueue(SpooledBoundedActiveMQMessageQueue.java:91)\n\tat org.activemq.broker.impl.BrokerClientImpl.dispatch(BrokerClientImpl.java:198)\n\tat org.activemq.service.boundedvm.TransientTopicBoundedMessageContainer.dispatchToQueue(TransientTopicBoundedMessageContainer.java:223)\n\tat org.activemq.service.boundedvm.TransientTopicBoundedMessageContainer.targetAndDispatch(TransientTopicBoundedMessageContainer.java:155)\n\tat org.activemq.service.boundedvm.TransientTopicBoundedMessageManager.doSendMessage(TransientTopicBoundedMessageManager.java:225)\n\tat org.activemq.service.boundedvm.TransientTopicBoundedMessageManager.sendMessage(TransientTopicBoundedMessageManager.java:204)\n\tat org.activemq.broker.impl.DefaultBroker.doMessageSend(DefaultBroker.java:563)\n\tat org.activemq.broker.impl.DefaultBroker.sendMessage(DefaultBroker.java:305)\n\tat org.activemq.broker.impl.BrokerContainerImpl.sendMessage(BrokerContainerImpl.java:462)\n\tat org.activemq.broker.impl.BrokerConnectorImpl.sendMessage(BrokerConnectorImpl.java:271)\n\tat org.activemq.broker.impl.BrokerClientImpl.consumeActiveMQMessage(BrokerClientImpl.java:706)\n\tat org.activemq.broker.impl.BrokerClientImpl.consume(BrokerClientImpl.java:310)\n\tat org.activemq.transport.TransportChannelSupport.doConsumePacket(TransportChannelSupport.java:374)\n\tat org.activemq.transport.TransportChannelSupport.doConsumePacket(TransportChannelSupport.java:368)\n\tat org.activemq.transport.tcp.TcpTransportChannel.run(TcpTransportChannel.java:311)\n\tat java.lang.Thread.run(Thread.java:534)\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460702","id":"12460702","filename":"ASF.LICENSE.NOT.GRANTED--patchfile.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nleck","name":"nleck","key":"nleck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Leck","active":true,"timeZone":"Etc/UTC"},"created":"2005-11-16T02:36:34.000+0000","size":3321,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12460702/ASF.LICENSE.NOT.GRANTED--patchfile.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161897","customfield_12312823":null,"summary":"Could not enqueue message and Too many open files","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gklyuzner","name":"gklyuzner","key":"gklyuzner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Glen Klyuzner","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gklyuzner","name":"gklyuzner","key":"gklyuzner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Glen Klyuzner","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows 2000/XP SP2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481609/comment/12936743","id":"12936743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"To reproduce:\n\n1. Set the file decriptor limit low, run:\n    ulimit -n 100\n2. Start the broker in the session with the low file descriptor limit\n2. Run a slow consumer using our sample programs:\n    ant consumer -Dtopic=true -DsleepTime=10000 -Dmax=1000000\n3. Thow alot of messages at the topic using our sample programs:\n    ant producer -Dtopic=true -Dmax=100000000","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2005-07-15T21:07:30.000+0000","updated":"2005-07-15T21:07:30.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481609/comment/12936652","id":"12936652","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2005-07-15T21:25:06.000+0000","updated":"2005-07-15T21:25:06.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481609/comment/12937100","id":"12937100","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gklyuzner","name":"gklyuzner","key":"gklyuzner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Glen Klyuzner","active":true,"timeZone":"Etc/UTC"},"body":"Installed M5 release and was able to reproduce the same error condition:\n\nsingleton bean 'derby-ds'\n2005-07-18 15:12:02,667 [main           ] INFO  ActiveMQBeanFactory            - Autowiring by type from bean name 'jdbcPersistence' via constructor to bean named 'derby-ds'\n2005-07-18 15:12:02,683 [main           ] INFO  ActiveMQBeanFactory            - Bean 'jdbcPersistence' instantiated via constructor [public org.activemq.store.jdbc.JDBCPersistenceAdapter()]\n2005-07-18 16:37:34,533 [ocalport=61616]] WARN  BrokerClientImpl               - Connection: ID:ny-cap-33-1550-1121719043944-19:0 is a slow consumer\n2005-07-18 16:37:58,831 [ocalport=61616]] ERROR BrokerClientImpl               - Could not enqueue message ACTIVEMQ_OBJECT_MESSAGE: id = 0 ActiveMQMessage{ , jmsMessageID = ID:ny-cap-33-1206-1121716722976-94:80900, bodyAsBytes = org.activemq.io.util.ByteArray@f9e48, readOnlyMessage = false, jmsClientID = 'ID:ny-cap-33-1206-1121716722976-19:0' , jmsCorrelationID = 'null' , jmsDestination = Topic.sds.PropertyTemplatePublisher, jmsReplyTo = null, jmsDeliveryMode = 2, jmsRedelivered = false, jmsType = 'null' , jmsExpiration = 1121719138600, jmsPriority = 4, jmsTimestamp = 1121719078600, properties = null, readOnlyProperties = false, entryBrokerName = 'nyotc023-broker-1' , entryClusterName = 'default' , consumerNos = [I@160bf5e, transactionId = 'null' , xaTransacted = false, consumerIdentifer = 'null' , messageConsumed = false, transientConsumed = false, sequenceNumber = 80900, deliveryCount = 1, dispatchedFromDLQ = false, messageAcknowledge = null, jmsMessageIdentity = null, producerKey = ID:ny-cap-33-1206-1121716722976-94: } ActiveMQObjectMessage{ object = null } to SpooledBoundedQueue for this slow consumer\njavax.jms.JMSException: enqueNoBlock failed: Too many open files\n\tat org.activemq.io.util.SpooledBoundedActiveMQMessageQueue.enqueueNoBlock(SpooledBoundedActiveMQMessageQueue.java:121)\n\tat org.activemq.io.util.SpooledBoundedActiveMQMessageQueue.enqueue(SpooledBoundedActiveMQMessageQueue.java:91)\n\tat org.activemq.broker.impl.BrokerClientImpl.dispatch(BrokerClientImpl.java:205)\n\tat org.activemq.service.boundedvm.TransientTopicBoundedMessageContainer.dispatchToQueue(TransientTopicBoundedMessageContainer.java:223)\n\tat org.activemq.service.boundedvm.TransientTopicBoundedMessageContainer.targetAndDispatch(TransientTopicBoundedMessageContainer.java:155)\n\tat org.activemq.service.boundedvm.TransientTopicBoundedMessageManager.doSendMessage(TransientTopicBoundedMessageManager.java:225)\n\tat org.activemq.service.boundedvm.TransientTopicBoundedMessageManager.sendMessage(TransientTopicBoundedMessageManager.java:204)\n\tat org.activemq.broker.impl.DefaultBroker.doMessageSend(DefaultBroker.java:563)\n\tat org.activemq.broker.impl.DefaultBroker.sendMessage(DefaultBroker.java:305)\n\tat org.activemq.broker.impl.BrokerContainerImpl.sendMessage(BrokerContainerImpl.java:462)\n\tat org.activemq.broker.impl.BrokerConnectorImpl.sendMessage(BrokerConnectorImpl.java:271)\n\tat org.activemq.broker.impl.BrokerClientImpl.consumeActiveMQMessage(BrokerClientImpl.java:713)\n\tat org.activemq.broker.impl.BrokerClientImpl.consume(BrokerClientImpl.java:317)\n\tat org.activemq.transport.TransportChannelSupport.doConsumePacket(TransportChannelSupport.java:374)\n\tat org.activemq.transport.TransportChannelSupport.doConsumePacket(TransportChannelSupport.java:368)\n\tat org.activemq.transport.tcp.TcpTransportChannel.run(TcpTransportChannel.java:311)\n\tat java.lang.Thread.run(Thread.java:534)\n\n\nApp log:\nINFO 2005-07-18 16:37:27,881 - Queue Name= AE.Queue.sds.PropertyTemplatePublisher - class com.tullib.core.message.jms.MessageServerJMSStub\nWARN 2005-07-18 16:37:42,787 - Queue is full, waiting for it to be dequeued.\nWARN 2005-07-18 16:37:42,881 - Queue is full, waiting for it to be dequeued.\n...\nWARN 2005-07-18 16:46:15,463 - Queue is full, waiting for it to be dequeued.\nWARN 2005-07-18 16:46:15,572 - Queue is full, waiting for it to be dequeued.\nWARN 2005-07-18 16:46:15,666 - Queue is full, waiting for it to be dequeued.\n\nProcess finished with exit code 1\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gklyuzner","name":"gklyuzner","key":"gklyuzner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Glen Klyuzner","active":true,"timeZone":"Etc/UTC"},"created":"2005-07-18T20:57:49.000+0000","updated":"2005-07-18T20:57:49.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481609/comment/12937132","id":"12937132","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gklyuzner","name":"gklyuzner","key":"gklyuzner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Glen Klyuzner","active":true,"timeZone":"Etc/UTC"},"body":"ACTIVEMQ_HOME was pointing to the old M3 release.\nCould not reproduce it anymore with M5 release and correct ACTIVEMQ-HOME.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gklyuzner","name":"gklyuzner","key":"gklyuzner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Glen Klyuzner","active":true,"timeZone":"Etc/UTC"},"created":"2005-07-18T21:54:14.000+0000","updated":"2005-07-18T21:54:14.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481609/comment/12937397","id":"12937397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nleck","name":"nleck","key":"nleck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Leck","active":true,"timeZone":"Etc/UTC"},"body":"we could reproduce this problem in version 3.2 of ActiveMQ. \n\nWe created a topic and had a fast producer which created messages as fast a posible and a consumer which did a Thread.sleep( 1000) between each message. Once the memory was filled. It starts to write the messages to a series of files and a handle to these files into a array list but the file handle is still open so after a number of files are created we get a \"Too Many Files Open\" Exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nleck","name":"nleck","key":"nleck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Leck","active":true,"timeZone":"Etc/UTC"},"created":"2005-11-10T08:51:21.000+0000","updated":"2005-11-10T08:51:21.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481609/comment/12937269","id":"12937269","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nleck","name":"nleck","key":"nleck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Leck","active":true,"timeZone":"Etc/UTC"},"body":"Here is the patch file for FileDataBlock.java\n\nbasically we need to close the file handle before it is placed into the collection otherwise we will get \"too many files open\" error. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nleck","name":"nleck","key":"nleck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Leck","active":true,"timeZone":"Etc/UTC"},"created":"2005-11-16T02:36:34.000+0000","updated":"2005-11-16T02:36:34.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481609/comment/12937772","id":"12937772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"body":"We also had this problem and have found that the patch above -- closing the file handle before it is passed to the collection -- prevents the problem.  There is still a problem when the SpooledBoundedActiveMQMessageQueue is full, all messages slow down waiting for the queue to be dequeued.\n\nThe \"Queue is full, waiting for it to be dequeued\" log message is being reported on the consumer's side, and is refering to a MemoryBoundedQueue which queues messages read off the socket.  This is a slightly different but very significant problem -- if the consumer's MemoryBoundedQueue is full, there is a call to wait().  This prevents any messages at all from being read on the consumer's side, so all messaging slows to a standstill.  This will eventually lead to a breakdown in the reliable protocol -- see AMQ-443 -- the KeepAlive packets sent to a consumer are not enqueued-dequeued fast enough on the consumer side, so the KeepAliveDaemon prompts the consumer to reconnect.\n\nWe have corrected this consumer-side problem by first applying the patch to FileDataBlock above, then refactoring ActiveMQSession to create a SpooledBoundedActiveMQMessageQueue for each consumer rather than a MemoryBoundedQueue.  This required some other minor refactoring to other files -- adding \"enqueueFirstNoBlock\" to SpooledBoundedMessageQueue, for example.  This has not only prevented the problems described above, it also seems to have prevented the \"slow consumer\" situation entirely.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kieranmurphy","name":"kieranmurphy","key":"kieranmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kieran Murphy","active":true,"timeZone":"Etc/UTC"},"created":"2006-03-02T18:07:39.000+0000","updated":"2006-03-02T18:07:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481609/comment/12938019","id":"12938019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"This issue is fixed now in 4.0.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-07-04T00:42:42.000+0000","updated":"2006-07-04T00:42:42.000+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-275/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s2lj:"}}