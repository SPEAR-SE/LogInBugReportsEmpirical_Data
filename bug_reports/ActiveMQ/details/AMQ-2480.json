{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483651","self":"https://issues.apache.org/jira/rest/api/2/issue/12483651","key":"AMQ-2480","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2009-12-11T14:55:17.794+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu May 17 09:35:27 UTC 2012","customfield_12310420":"69430","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_52030149641_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-01T20:58:23.741+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2480/watchers","watchCount":4,"isWatching":false},"created":"2009-11-06T16:09:14.114+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-05-17T09:35:27.476+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have been using ActiveMQ 5.2 on Windows for about 6months with a relatively low message throughput (a maximum usage 1 message every 4 seconds, nothing crazy) and it was working perfectly.  We have several clients that connect through either an OpenWire or Stomp connection and communicate through Queues.   \n\nSeveral days ago I started testing higher throughput (several messages/second) messaging by publishing to a Queue from an OpenWire connection and consuming the message on a Stomp connection.  At some point there is a failure in the Dispatcher for the Stomp connection and my client stops receiving messages.  The OpenWire connection is unaffected and continues filling the Queue.  I have since upgraded to ActiveMQ 5.3 because there were some issues fixed related to Stomp connection, but still see the same issue.  The only exception is :\n\nException in thread \"ActiveMQ Connection Dispatcher: /127.0.0.1:3047\" java.lang.NullPointerException \n\n        at org.apache.activemq.transport.stomp.LegacyFrameTranslator.convertMessage(LegacyFrameTranslator.java:69) \n        at org.apache.activemq.transport.stomp.ProtocolConverter.convertMessage(ProtocolConverter.java:594) \n        at org.apache.activemq.transport.stomp.StompSubscription.onMessageDispatch(StompSubscription.java:92) \n        at org.apache.activemq.transport.stomp.ProtocolConverter.onActiveMQCommand(ProtocolConverter.java:576) \n        at org.apache.activemq.transport.stomp.StompTransportFilter.oneway(StompTransportFilter.java:56) \n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40) \n        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1190) \n        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:779) \n        at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:815) \n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98) \n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36) \n\nI thought I would also note that with the nice new \"Connector\" page on the admin interface it shows the connection to my Stomp client as connected, and similarly the \"Queues\" page lists the Stomp consumer on the Queue, but the pending messages just keeps growing.\n\nThe client library we are using for the Stomp connection is from Codehaus (http://stomp.codehaus.org/C).  Our OpenWire connection is utilizing Spring frameworks JMS library.\n\nI'm going to continue to look for a test case to reproduce my error. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172249","customfield_12312823":null,"summary":"Stomp Transport Dispatcher Fails on NPE","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bwillis","name":"bwillis","key":"bwillis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bwillis","name":"bwillis","key":"bwillis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP, JRE6","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483651/comment/12941638","id":"12941638","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bwillis","name":"bwillis","key":"bwillis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben","active":true,"timeZone":"Etc/UTC"},"body":"Debugging this and reproduced with a breakpoint in the presumed erroneous code.  It seems to be the getText() method of the ActiveMQTextMessage is returning null and the convertMessage of the LegacyFrameTranslator is trying to getBytes() of the null text.\n\nStill looking further into this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bwillis","name":"bwillis","key":"bwillis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-09T23:33:57.578+0000","updated":"2009-11-09T23:33:57.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483651/comment/12941932","id":"12941932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walec51","name":"walec51","key":"walec51","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Walczak","active":true,"timeZone":"Etc/UTC"},"body":"I have a similar problem. I use the PHP Stomp librart from Fuse. A PHP process is listening to a topic where a dozen of Java JMS clients are posting. Every now a then the process just stops receiving messages from just that topic (it hears other queues). Even adding a reconnect every hour didn't help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walec51","name":"walec51","key":"walec51","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Walczak","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-11T14:55:17.794+0000","updated":"2009-12-11T14:55:17.794+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483651/comment/12941929","id":"12941929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bwillis","name":"bwillis","key":"bwillis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben","active":true,"timeZone":"Etc/UTC"},"body":"This is a result of a null message being sent from a JMS producer.  To stop this from crashing you would need a null check in getText() of the ActiveMQTextMessage object.  Not sure if the fix should throw some exception or if it should put in 0 bytes,  my first thought is the latter.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bwillis","name":"bwillis","key":"bwillis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-11T15:04:36.940+0000","updated":"2009-12-11T15:04:36.940+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483651/comment/12941938","id":"12941938","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walec51","name":"walec51","key":"walec51","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Walczak","active":true,"timeZone":"Etc/UTC"},"body":"Thats another issue with ActiveMQ I have that sometimes text messages loose their body when going between remote jms clients and the local php process (besides memory leaks and other issues). I'm switching to nio transports today. May be in some bizarre way this will help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walec51","name":"walec51","key":"walec51","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Walczak","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-11T16:25:51.095+0000","updated":"2009-12-11T16:25:51.095+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483651/comment/12943092","id":"12943092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=treyhyde","name":"treyhyde","key":"treyhyde","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Trey Hyde","active":true,"timeZone":"America/Los_Angeles"},"body":"I have this issue with 5.4.1.  I got it within a few minutes of starting up the broker.  I did not have this issue in the ~6month that 5.3.1 was up with the same setup.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=treyhyde","name":"treyhyde","key":"treyhyde","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Trey Hyde","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-10-21T17:24:58.741+0000","updated":"2010-10-21T17:24:58.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483651/comment/13058795","id":"13058795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Not test case provided to test the issue.  Fixes since 5.4.0 might have resolved this, should test using 5.5.0 and reopen if problem persists.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-07-01T20:58:23.748+0000","updated":"2011-07-01T20:58:23.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483651/comment/13277693","id":"13277693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsanai","name":"rsanai","key":"rsanai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Romin Sanai","active":true,"timeZone":"Etc/UTC"},"body":"I've just encountered this problem on ActiveMQ 5.5.1.\n\nStack trace:\nException in thread \"ActiveMQ Connection Dispatcher: /127.0.0.1:51148\" java.lang.NullPointerException\n        at org.apache.activemq.transport.stomp.LegacyFrameTranslator.convertMessage(LegacyFrameTranslator.java:90)\n        at org.apache.activemq.transport.stomp.ProtocolConverter.convertMessage(ProtocolConverter.java:614)\n        at org.apache.activemq.transport.stomp.StompSubscription.onMessageDispatch(StompSubscription.java:93)\n        at org.apache.activemq.transport.stomp.ProtocolConverter.onActiveMQCommand(ProtocolConverter.java:596)\n        at org.apache.activemq.transport.stomp.StompTransportFilter.oneway(StompTransportFilter.java:58)\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\n        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1270)\n        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:815)\n        at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:851)\n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:104)\n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:42)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsanai","name":"rsanai","key":"rsanai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Romin Sanai","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-17T09:35:27.343+0000","updated":"2012-05-17T09:35:27.343+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2480/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tuhr:"}}