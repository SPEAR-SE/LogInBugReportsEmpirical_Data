{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12957659","self":"https://issues.apache.org/jira/rest/api/2/issue/12957659","key":"AMQ-6240","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334188","id":"12334188","name":"5.14.0","archived":false,"released":true,"releaseDate":"2016-08-05"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-04-11T10:34:03.068+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Apr 14 12:46:06 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_176640247_*|*_4_*:*_1_*:*_50791309_*|*_5_*:*_2_*:*_36990082","customfield_12312321":null,"resolutiondate":"2016-04-14T11:27:21.550+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6240/watchers","watchCount":5,"isWatching":false},"created":"2016-04-11T10:00:19.957+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334774","id":"12334774","name":"5.13.2","archived":false,"released":true,"releaseDate":"2016-03-04"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-04-14T12:46:06.578+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"There is a discussion relating to the bug here - http://activemq.2283324.n4.nabble.com/Force-Producer-to-fail-when-blocked-by-slow-consumer-td4710264.html. Test code to reproduce the problem  has also been uploaded to this discussion.\n\nWe have  a situation where we have a producer which is feeding a slow consumer.\nThe consumer belongs to a third party so we do not have control over the broker configuration.\nWe would like to terminate our producer but we find that we cannot do so. We can set the timeout on the connection and we then trap the timeout exception. The problem is that when we try to close the session it attempts to rollback but cannot do so as the rollback blocks.\n\nWe have created a small test that is included in the zip (mentioned above) of an Eclipse project.The zip includes three classes. Call the main method of RunTest to run the test. The activemq.xml used is in the root directory of the project. \n\nThe program will timeout after 51 messages and attempt to close the session. \n\nIt eventually locks in this line: \n\n            this.connection.syncSendPacket(info); \n\nin the rollback method of the TransactionContext class.\n\nWe believe that the most sensible solution to this is that the rollback should respond to the same timeout as the connection.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12798011","id":"12798011","filename":"brokertd.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T11:25:41.789+0000","size":4476,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12798011/brokertd.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Producer cannot be terminated when slow consumer is detected","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"The test was run using an out of the box install of ActiveMQ 5.13.2 on Windows 7 Professional (64 bit). \n\nThe java version used was jdk1.8.0_60","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15234850","id":"15234850","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"it would be interesting to know what happens to the rollback command broker side, such that there is no response. Why does it block?\nA thread dump for the broker when the client is stuck in the close/rollback would help identify","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T10:34:03.068+0000","updated":"2016-04-11T10:34:03.068+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15234898","id":"15234898","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary - thanks for the quick response. \nAttached is a zip of the thread dump of the broker process\nIf you need any more info let me know","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T11:25:41.793+0000","updated":"2016-04-11T11:25:41.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15234939","id":"15234939","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"{code}\"ActiveMQ Transport: tcp:///127.0.0.1:65190@61616\" #52 daemon prio=5 os_prio=0 tid=0x000000005ac6b800 nid=0x20fc waiting on condition [0x000000006035e000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x00000000c050b598> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n\tat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2163)\n\tat org.apache.activemq.usage.Usage.waitForSpace(Usage.java:103)\n\tat org.apache.activemq.usage.StoreUsage.waitForSpace(StoreUsage.java:92)\n\tat org.apache.activemq.usage.StoreUsage.waitForSpace(StoreUsage.java:87)\n\tat org.apache.activemq.broker.region.BaseDestination.waitForSpace(BaseDestination.java:686)\n\tat org.apache.activemq.broker.region.Queue.checkUsage(Queue.java:899)\n\tat org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:831)\n\tat org.apache.activemq.broker.region.Queue.send(Queue.java:731)\n\tat org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:503)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:468)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:293)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:153)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:293)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:158)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:546)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:768)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:338)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:125)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:300)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:233)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215)\n\tat java.lang.Thread.run(Thread.java:745){code}\n\n\nthe transport thread is busy waiting for space, blocked, so the next command, the rollback/close cannot be read from the socket.\nWithout broker side async blocking, via producerFlowControl or the error on no space, the default behaviour is to block the transport thread.\n\nBecause the broker config cannot be changed I think there are two client options:\n1) use async send and a small producerWindow, this will cause your client to block pending space on the broker for pending messages. However having peeked at the org.apache.activemq.ActiveMQMessageProducer#send(javax.jms.Destination, javax.jms.Message, int, int, long, org.apache.activemq.AsyncCallback) - there is no timeout limit, so an interrupted exception is all that will stop that wait. not so good.\n\n2) force a close of the connection via the underlying transport, so that the  jms connection sees a socket closure and will report an error. This should avoid the normal closure processing after you see a send timeout.\nThat is a bit of a hack, using an activemq narrow api. There are some examples of how to do it in the unit tests:\nhttps://github.com/apache/activemq/blob/e2b4ca2c59a316be91cf391c758a10e518dd3a1f/activemq-unit-tests/src/test/java/org/apache/activemq/transport/failover/FailoverTimeoutTest.java#L210\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T11:56:18.107+0000","updated":"2016-04-11T11:56:18.107+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15235038","id":"15235038","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Gary, I'll test that and see how I get on - I looked at using the socket but didn't know how to access it - I was also unsure of what the consequences of doing this would be.\nOur current solution is to interrupt the thread - something like what you suggest in option 1.\n\nDo you think that the fact that there is no mechanism to time out the rollback is a bug? And if so - do you think it is likely to be fixed?\n\nI think it would be nice to be able to set a timeout on the rollback (either by inheriting the timeout from the connection or by setting it explicitly) to cover situations like this. If it was felt that inheritance was a bad idea then an explicit rollback(long timeout) call could be added.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T12:48:01.010+0000","updated":"2016-04-11T12:48:01.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15235080","id":"15235080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Gary - that worked perfectly. It's an acceptable solution in our situation so I'm happy to close this issue unless you want to keep it open for any reason. \nIf it makes sense to you I can raise the option to timeout a rollback as a feature request.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T13:24:32.625+0000","updated":"2016-04-11T13:24:32.625+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15235093","id":"15235093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"I am not sure. It is a bit of an anti pattern, the whole send timeout. \nReally the connection should close, because the sync send state is unknown. In this case the transaction blocks the close so it may make sense to use rollback(timeout) in the close case, because the socket will close and the broker side transaction will rollback.\n\nNote the transaction rollback used to be async before: https://issues.apache.org/jira/browse/AMQ-2364\nhaving a timeout would be similar, but I guess so long as we always close it would be ok.\n\nI see an interesting angle in https://issues.apache.org/jira/browse/AMQ-1517 where the broker side blocking is limited by the message time to live. That would make a deterministic failure scenario. Message expired while pending space for send.\nThat would leave the broker side active to respond to a close.\nDo you use messageExpiry or would it be a valid alternative?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T13:32:36.582+0000","updated":"2016-04-11T13:32:36.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15235420","id":"15235420","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"body":"We don't use message expiry as we take a very minimal approach to our configuration. Looking at that solution I was reminded that the issue here might be time zone differences. We will have to communicate with queues on a multiplicity of customers brokers so we cannot make any assumptions or influence their configurations.\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T16:30:53.829+0000","updated":"2016-04-11T16:30:53.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15235421","id":"15235421","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"body":"We don't use message expiry as we take a very minimal approach to our configuration. Looking at that solution I was reminded that the issue here might be time zone differences. We will have to communicate with queues on a multiplicity of customers brokers so we cannot make any assumptions or influence their configurations.\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kenhalldnb","name":"kenhalldnb","key":"kenhalldnb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ken Hall","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T16:30:53.890+0000","updated":"2016-04-11T16:30:53.890+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15239072","id":"15239072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 77d46dc139284141336591af649c0cc1da790cd0 in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=77d46dc ]\n\nhttps://issues.apache.org/jira/browse/AMQ-6240 use sendTimout on sync rollback on close such that a blocked connection won't block a close\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-13T11:02:35.330+0000","updated":"2016-04-13T11:02:35.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15240049","id":"15240049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The test for this fails in CI, probably just due to being timing sensitive \n\nhttps://builds.apache.org/view/A-D/view/ActiveMQ/job/ActiveMQ-Java8/org.apache.activemq$activemq-unit-tests/649/testReport/junit/org.apache.activemq.bugs/AMQ6240Test/testBlockedTxProducerConnectionTimeoutConnectionCanClose/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-04-13T21:20:50.273+0000","updated":"2016-04-13T21:20:50.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15240074","id":"15240074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"it sends too many big messages for slow disks. guess it could be configured down to just one message with a small enough kahadb","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-13T21:40:40.382+0000","updated":"2016-04-13T21:40:40.382+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15240993","id":"15240993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 530c1a81934d0a1ca51a8778e59ee19509378d87 in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=530c1a8 ]\n\nhttps://issues.apache.org/jira/browse/AMQ-6240 - tidy up test and reduce duration. reuse closeTimeout on rollback during close which is the case here\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-14T11:25:32.254+0000","updated":"2016-04-14T11:25:32.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15240995","id":"15240995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"thanks tim, the test was taking too long which pointed me to the closeTimeout at 15s which was in the mix.\nReusing that var for the rollback command timeout makes more sense also.\nReconfigured the test to do less work and removed the inherited variants that work better with no persistence.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-14T11:27:21.580+0000","updated":"2016-04-14T11:27:21.580+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12957659/comment/15241067","id":"15241067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Ah nice, the close timeout does seem to make more sense looking at the patch.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-04-14T12:46:06.578+0000","updated":"2016-04-14T12:46:06.578+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6240/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2vx53:"}}