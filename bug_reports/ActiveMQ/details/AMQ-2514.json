{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483689","self":"https://issues.apache.org/jira/rest/api/2/issue/12483689","key":"AMQ-2514","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316331","id":"12316331","description":"Next unplanned v5 maintenance release","name":"5.x","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2009-11-26T13:16:28.906+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Nov 02 21:14:44 UTC 2013","customfield_12310420":"44171","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2514/watchers","watchCount":1,"isWatching":false},"created":"2009-11-26T11:34:10.036+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-11-02T21:14:44.674+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"JBoss based global transaction does not work with active mq.  The session for say jms though is ActiveMQXASession getting created but its transaction related values are not set at all due to which even after retrieving the message it fails after doing check for whether its transaction context is set or not.  It will give JMS Exception as \"Session's XAResource has not been enlisted in a distributed transaction.\".\n\nYou can find the thread on nabble at:\nhttp://old.nabble.com/xa-jta-activemq-jboss-td26515685.html#a26527052\n\nNote that I have also set the cacheLevel in config below which by default is set with same value in 2.5.6 api.  Setting cache level does not resolve the issue.  The nabble message thread has the earlier configs if one wants to read in complete.\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans \n  xmlns=\"http://www.springframework.org/schema/beans\"\n  xmlns:util=\"http://www.springframework.org/schema/util\"\n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd\n                      http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd\"\n  >\n  \n \n<!-- this is the Message Driven POJO (MDP) -->\n<bean id=\"myMessageListener\" class=\"jmsexample.ExampleListener\" />\n<bean id=\"jndiTemplate\" class=\"org.springframework.jndi.JndiTemplate\">\n    <property name=\"environment\">\n      <props>\n        <prop key=\"java.naming.factory.initial\">\n          jmsexample.jndi.ActiveMQInitialContextFactory\n        </prop>\n        <prop key=\"queue.TEST.Q1\">\n          TEST.Q1\n        </prop>\n       \n        <prop key=\"brokerURL\">\n           tcp://localhost:61616\n        </prop>\n      </props>\n    </property>\n  </bean>\n <bean id=\"appJmsDestination\"\n    class=\"org.springframework.jndi.JndiObjectFactoryBean\">\n    <property name=\"jndiTemplate\">\n      <ref bean=\"jndiTemplate\"/>\n    </property>\n    <property name=\"jndiName\" value=\"TEST.Q1\"/>\n  </bean>\n \n <bean id=\"connectionFactory\"\n    class=\"org.springframework.jndi.JndiObjectFactoryBean\">\n    <property name=\"jndiTemplate\">\n      <ref bean=\"jndiTemplate\"/>\n    </property>\n    <property name=\"jndiName\" value=\"ConnectionFactory\"/>\n  </bean>\n \n\n<bean id=\"jmsContainer\" class=\"org.springframework.jms.listener.DefaultMessageListenerContainer\">\n    <property name=\"connectionFactory\" ref=\"connectionFactory\"/>\n    <property name=\"destination\" ref=\"appJmsDestination\"/>\n    <property name=\"messageListener\" ref=\"myMessageListener\" />\n    <property name=\"transactionManager\" ref=\"transactionManager\"/>\n   <property name=\"cacheLevel\">\n      <util:constant static-field=\"org.springframework.jms.listener.DefaultMessageListenerContainer.CACHE_NONE\" />\n    </property>\n</bean>\n\n \n <bean id=\"jbossTransactionManager\"\n    class=\"com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionManagerImple\">\n  </bean>\n\n  <bean id=\"jbossUserTransaction\"\n    class=\"com.arjuna.ats.internal.jta.transaction.arjunacore.UserTransactionImple\"/>\n\n  <bean id=\"transactionManager\"\n    class=\"org.springframework.transaction.jta.JtaTransactionManager\">\n    <property name=\"transactionManager\">\n      <ref bean=\"jbossTransactionManager\" />\n    </property>\n    <property name=\"userTransaction\">\n      <ref bean=\"jbossUserTransaction\" />\n    </property>\n  </bean>\n   \n</beans> ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59765","customfield_12312823":null,"summary":"xa jta activemq jboss - xa transaction not set in session","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imiten","name":"imiten","key":"imiten","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miten Mehta","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imiten","name":"imiten","key":"imiten","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miten Mehta","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"JBossTS 4.2.3 SP5, activemq 5.3.0, jdk1.6.0_16, winxp, spring 2.5.6, hp desktop","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483689/comment/12941888","id":"12941888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imiten","name":"imiten","key":"imiten","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miten Mehta","active":true,"timeZone":"Etc/UTC"},"body":"changed the nabble thread url.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imiten","name":"imiten","key":"imiten","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miten Mehta","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-26T11:42:50.061+0000","updated":"2009-11-26T11:42:50.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483689/comment/12941889","id":"12941889","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"post your spring xml here also, it may help to tie it together. Did you notice: \"NOTE: Turn off the \"cacheSessions\" flag on JBoss 4.0 to make JMS message reception properly participate in XA transactions, where JBoss requires each listener thread to reobtain its JMS Session for each receive attempt.\" from http://www.jdocs.com/spring/2.0.RC1/org/springframework/jms/listener/DefaultMessageListenerContainer.html - wonder if that is relevant.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-26T13:16:28.906+0000","updated":"2009-11-26T13:16:28.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483689/comment/12941896","id":"12941896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imiten","name":"imiten","key":"imiten","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miten Mehta","active":true,"timeZone":"Etc/UTC"},"body":"As suggested I am posting the spring config.  \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imiten","name":"imiten","key":"imiten","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Miten Mehta","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-27T09:22:50.243+0000","updated":"2009-11-27T09:22:50.243+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483689/comment/12941895","id":"12941895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Think the answer is somewhere in here: http://static.springsource.org/spring/docs/2.5.x/reference/transaction.html\nfrom the AMQ perspective, all it can do is present an XA capable connection factory. \nThe key component that is missing is some wrapper around the connection factory that will enlist connections and sessions in the current XA transaction. This needs to be managed by spring in some way but it probably needs some directive or annotation to make this happen. In the case of jboss using CMT, jboss would provide the wrapper around the Activemq JMS connection factory and ensure that it is enlisted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-27T09:59:15.556+0000","updated":"2009-11-27T09:59:15.556+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483689/comment/13812177","id":"13812177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"Try with 5.9 release where the JCA RAR has been improved a lot and tested on JBoss AS etc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2013-11-02T21:14:44.674+0000","updated":"2013-11-02T21:14:44.674+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2514/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0aljz:"}}