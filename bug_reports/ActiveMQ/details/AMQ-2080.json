{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482722","self":"https://issues.apache.org/jira/rest/api/2/issue/12482722","key":"AMQ-2080","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2009-01-26T14:41:51.918+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jan 27 21:09:21 UTC 2009","customfield_12310420":"95989","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_643693452_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-01-27T13:08:41.009+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2080/watchers","watchCount":1,"isWatching":false},"created":"2009-01-20T02:20:27.557+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-01-27T21:09:21.814+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Using a connection URL of\n\n{{discovery:(multicast://default?group=test)?maxReconnectAttempts=13&initialReconnectDelay=1000&useExponentialBackOff=false}}\n\none would expect initial connection attempts to go on for at least 13 seconds (13 reconnect attempts with 1000ms delay between attempts) but in fact the error \"No uris available to connect to\" returned in less than a second.  Changing  {{useExponentialBackOff}} to {{true}} delays a failure report to about 41 seconds, which is 10ms * 2^12, which is what you'd expect with 12 reconnect attempts (13 connect attempts) starting with the default 10ms delay and doubling with every attempt, since 2^0+2^1+2^2+...2^n-1 is approx 2^n.  (I guess maxReconnectAttempts should be called maxConnectAttempts, but I'm not opening a bug about that.)  Changing maxReconnectAttempts to 12 causes the delay to be about 20 seconds, half of what it is for 13, so that checks out.\n\nAltogether this points to the initialReconnectDelay parameter being ignored on initial connection attempts.   It is supposed to work per  http://activemq.apache.org/discovery-transport-reference.html","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"233463","customfield_12312823":null,"summary":"InitialReconnectDelay appears to be ignored in Discovery transport URLs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgro","name":"jgro","key":"jgro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Grodberg","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgro","name":"jgro","key":"jgro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Grodberg","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP SP3","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482722/comment/12940701","id":"12940701","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"the initialReconnectDelay kicks in when a candidate url is returned by the discovery agent. Up to that point, the reconnectDelay is in effect and this defaults to 10 ms. I think there is some value in leaving things are they are such that it is possible to have a different initial reconnect delay for discovery finding some candidate urls and for connecting to these urls.\n\nI added a test that verifies the setting of reconnectDelay takes effect when no broker can be found. It uses a uri of the form: \"discovery:{code}(multicast://default)?useExponentialBackOff=false&maxReconnectAttempts=2&reconnectDelay=4000{code}\n\nDoes this work for you. If so I can update the documentation with a reference to reconnectDelay","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-26T14:41:51.918+0000","updated":"2009-01-26T14:41:51.918+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482722/comment/12940704","id":"12940704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgro","name":"jgro","key":"jgro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Grodberg","active":true,"timeZone":"Etc/UTC"},"body":"I support the idea of different behavior before the discoveryAgent discovers a broker as opposed to after, since the delay to discover a broker is a completely different set of issues compared to the delay to connect to a broker that is advertising that it is alive.  Because of this, I think the different behaviors should be completely separately configurable with regard to delay between attempts, number of attempts, and backoff strategy.  \n\nIn any case, though there may be good reasons it evolved this way, I find it counter-intuitive and confusing that it would be the \"reconnectDelay\" and not the \"initialReconnectDelay\" that is the reconnect delay used in the initial attempt to find a broker.\n\nFor my immediate needs I can just deal with the current behavior, in part because there is some other bug (perhaps in the JVM or the Win2K TCP stack) that is causing any attempts to discover the broker to fail after the discovery agent has been running for a few minutes.   I suspect this is a Windows bug because it affects other processes running in separate JVMs, but I'm not a Windows expert so I don't know how reasonable it is to believe there's this kind of bug still existing in the OS.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgro","name":"jgro","key":"jgro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Grodberg","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-26T19:53:57.614+0000","updated":"2009-01-26T19:53:57.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482722/comment/12940695","id":"12940695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"agree, it is not intuitive, but the original value of the reconnectDelay is in use prior to the discovery component returning a list of candidate urls to connect to.\nAdded a reference to the documentation: http://activemq.apache.org/discovery-transport-reference.html\n\nRe your current problem, I think it is unlikely to be a JVM of OS issue.\nHave you enabled debug logging for the class: org.apache.activemq.transport.discovery.multicast.MulticastDiscoveryAgent to see if there is any indicator there. Some of the configuration options on the [MulticastDiscoveryAgent|http://activemq.apache.org/maven/5.2.0/activemq-core/apidocs/src-html/org/apache/activemq/transport/discovery/multicast/MulticastDiscoveryAgent.html] may not be appropriate to your scenario.\nThe discoveryAgent properties are set like the group attribute: \n{code}discovery:(multicast://default?group=test&keepAliveInterval=1000)...{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-27T13:08:40.902+0000","updated":"2009-01-27T13:08:40.902+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482722/comment/12940679","id":"12940679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgro","name":"jgro","key":"jgro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Grodberg","active":true,"timeZone":"Etc/UTC"},"body":"Thank you for updating the documentation.\n\nIs there a way to use exponential backoff for reconnects to a discovered URL but constant delays while waiting to discover the broker?  If not, can we make that a feature request?\n\nRe my current problem, yes, I had turned on trace-level debugging for MulticastDiscoveryAgent and it didn't tell me anything other than I had properly set the group.  Once the parameter parsing is completed I don't get any more logging until the exception is thrown that the connection failed because no URIs were discovered.  It doesn't appear to matter whether I set loopback to true or not (not surprising since nothing but the broker is running on the broker machine).  \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgro","name":"jgro","key":"jgro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Grodberg","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-27T17:35:11.471+0000","updated":"2009-01-27T17:35:11.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482722/comment/12940690","id":"12940690","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgro","name":"jgro","key":"jgro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Grodberg","active":true,"timeZone":"Etc/UTC"},"body":"Also, is this consistent with the behavior of the failover transport?  If so, then the failover transport documentation should be updated, too.  If not.....","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgro","name":"jgro","key":"jgro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Grodberg","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-27T21:09:21.778+0000","updated":"2009-01-27T21:09:21.778+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2080/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i14ccf:"}}