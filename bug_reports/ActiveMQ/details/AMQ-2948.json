{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483846","self":"https://issues.apache.org/jira/rest/api/2/issue/12483846","key":"AMQ-2948","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-10-13T11:54:50.814+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Jul 22 04:43:35 UTC 2012","customfield_12310420":"14838","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1276372855_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-10-13T11:54:50.854+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2948/watchers","watchCount":1,"isWatching":false},"created":"2010-09-28T17:21:57.999+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315624","id":"12315624","description":"Maintenance release for 5.4.0","name":"5.4.1","archived":false,"released":true,"releaseDate":"2010-09-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-22T04:43:35.677+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"In current ajax code, there is a 1-1 relationship between ajax client and session.  Since multiple windows in the same browser share the same session, it's impossible for the ajax code to update both windows.  Either 1 or the other will receive messages, but not both.\n\nThe attached patch allows an optional 'clientId' string to be passed to the JavaScript amq.init() function, similar to that supported by the REST servlet.  This clientId string is sent to the server with every ajax request.  In MessageListenerServlet, a new consumer is created for every new sessionid+clientId, allowing multiple windows in the same browser to send & receive messages independently.\n\nFor some (currently) unknown reason, IE7 cannot send messages from multiple windows.  2 IE7 windows can receive messages independently with no errors, but once either IE7 window sends a message, both windows cease receiving data.  This behavior is not seen in FF (OSX or WinXP) or Safari (OSX).  All those browsers are able to send & receive simultaneously in multiple windows with no errors.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461876","id":"12461876","filename":"support-multiple-ajax-clients-per-session.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-30T21:11:13.080+0000","size":23902,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461876/support-multiple-ajax-clients-per-session.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"63721","customfield_12312823":null,"summary":"Support ajax clients in multiple windows/tabs in a single browser","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"OSX 10.6\nCentos 5.4","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483846/comment/12943001","id":"12943001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"There's a separate minor change in the attached patch, which ensures that the Content-Type header is always set to 'text/xml'.\n\nIn current svn code, this header is only set when a message is delivered.  When a timeout occurs (and an empty <ajax-response></ajax-response> is returned), the Content-Type header is set to 'text/plain'.  The jQuery adapter attempts to parse the responseXML property of the response, which is not populated due to the Content-Type header being set to 'text/plain'.\n\nThis is seen in FIrebug as a 200 response resulting in a parseerror.  (Successful response which fired the error-handling ajax callback!)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-28T17:29:03.439+0000","updated":"2010-09-28T17:29:03.439+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483846/comment/12943016","id":"12943016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"We have observed that ActiveMQ running with this patch does not clean up session data as quickly as we expected.  (Every reload of a browser window which uses the clientId parameter creates 5 new threads in the JVM, and these do not appear to be cleaned up.)  We're going to investigate this a bit more and possibly submit a revised patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-28T22:20:01.141+0000","updated":"2010-09-28T22:20:01.141+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483846/comment/12943025","id":"12943025","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"body":"This patch replaces the original one I attached to this ticket.\n\nChanges since original patch:\n - private MessageListenerServlet.ClientConsumerState class refactored to AjaxWebClient (extends WebClient).\n - private MessageListenerServlet.Listener class refactored to AjaxListener.  AjaxWebClient uses an instance of Listener/AjaxListener, so this needs to be public.\n - AjaxWebClient & associated data for each client are now stored in a MessageListenerServlet instance variable (ajaxWebClients) rather than in sessions.\n - Timer/TimerTask code added to examine ajaxWebClients and clean up clients which have not been accessed in the past minute.  This solves the thread-leakage we were seeing in my initial patch.\n - JavaScript to append clientId parameter to all requests moved to amq.js, so no changes are required to the jquery, prototype, or dojo adapters.\n\nNew patch also includes a new JS test, and an updated chat.html which uses a clientId (so you can open chat.html in multiple windows in the same browser) for a quick test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexdean","name":"alexdean","key":"alexdean","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Dean","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-30T21:11:13.178+0000","updated":"2010-09-30T21:11:13.178+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483846/comment/12943067","id":"12943067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Committed with svn revision 1022071. Thanks a lot for a great work.\n\nI think there's two things left to be done to complete Ajax improvements:\n\n* Documentation on Ajax is way out of date, so we should update it with these new features - http://activemq.apache.org/ajax.html\n* We should automate JS tests and include them in our unit testing suite with something like WebDriver (http://code.google.com/p/selenium/wiki/GettingStarted)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-10-13T11:54:50.814+0000","updated":"2010-10-13T11:54:50.814+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483846/comment/13420108","id":"13420108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=saravanantp","name":"saravanantp","key":"saravanantp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saravanan Thoppan","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\nI have a auction application being developed and have multiple users login at the same time for bidding. I understand that clientId in amq.init is the unique parameter that distincts each users window. Say for example, user U1 is logged in IE and user U2 is logged in Chrome at the same time. When they bid, the messages and updated price information are passing to both the users. However, when U1 logs out of the application and logs in back for bidding, he doesnt see the updated price information in his screen, which is weird. Can you please let me know if this is really an issue or I am doing something wrong, please? I use ActiveMQ 5.6.0 with Java and Spring Framework. Appreciate your response.\n\nSaravanan Thoppan","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=saravanantp","name":"saravanantp","key":"saravanantp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saravanan Thoppan","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-22T04:38:58.466+0000","updated":"2012-07-22T04:38:58.466+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483846/comment/13420109","id":"13420109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=saravanantp","name":"saravanantp","key":"saravanantp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saravanan Thoppan","active":true,"timeZone":"Etc/UTC"},"body":"Slight change in my words - However, when U1 logs out of the application and logs in back for bidding and when he starts bidding, the update doesnt come to his winidow but the other users U2 sees the price information being updated on his.\n\nSaravanan Thoppan","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=saravanantp","name":"saravanantp","key":"saravanantp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saravanan Thoppan","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-22T04:43:35.470+0000","updated":"2012-07-22T04:43:35.470+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2948/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0b9xj:"}}