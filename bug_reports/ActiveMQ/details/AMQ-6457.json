{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13009906","self":"https://issues.apache.org/jira/rest/api/2/issue/13009906","key":"AMQ-6457","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-10-05T16:09:25.360+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 05 17:01:21 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6457/watchers","watchCount":3,"isWatching":false},"created":"2016-10-05T15:58:45.621+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335045","id":"12335045","name":"5.13.3","archived":false,"released":true,"releaseDate":"2016-05-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12334188","id":"12334188","name":"5.14.0","archived":false,"released":true,"releaseDate":"2016-08-05"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-05-31T11:49:44.594+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325101","id":"12325101","name":"networkbridge"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"-Active MQ brokers are deployed in Karaf container. \n-Cluster of Active MQ Brokers (Network of brokers, configured as HUB and SPOKES).\n-Broker(s) at Hub (Master/Slave configuration using Shared File System)\n- Broker(s) at spoke(s)- Connected to HUB using Duplex Network Connector ( Openwire/NIO), one for topic and one for queue\n\nIssue: We have durable subscriptions to topics on HUB and producers on Spokes. We are aware of network outages between the HUB and SPOKE brokers, sometimes we are experiencing multiple outages and as a result we see the topic subscribers end up as offline  and continue to store messages as the spoke broker. We are need a restart of the broker to reestablish the network bridge.\n\nRelevant Logs: \n\n2016-09-22 14:21:40,105 | WARN  | tyMonitor Worker | DemandForwardingBridgeSupport    | 20 - org.apache.activemq.activemq-osgi - 5.13.3 | Network connection between vm://central-amq-broker#44 and tcp:///xx.xxx.xx.xx:53103@61616 shutdown due to a remote error: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (>30000) long: tcp:///xx.xxx.xx.xx:53103\n\n2016-09-22 14:21:40,117 | INFO  | -broker] Task-21 | DemandForwardingBridgeSupport    | 20 - org.apache.activemq.activemq-osgi - 5.13.3 | central-amq-broker bridge to T1-amq-broker stopped\n\n2016-09-22 14:23:44,246 | INFO  | eMQ NIO Worker 4 | TransportConnection              | 20 - org.apache.activemq.activemq-osgi - 5.13.3 | Started responder end of duplex bridge T:broker1->broker2@ID:T1-35496-1474555572634-0:1\n2016-09-22 14:23:44,255 | INFO  | al-amq-broker#52 | DemandForwardingBridgeSupport    | 20 - org.apache.activemq.activemq-osgi - 5.13.3 | Network connection between vm://central-amq-broker#52 and tcp:///xx.xxx.xx.xx:53162@61616 (T1-amq-broker) has been established.\n\nNetwork Connector on Spoke Broker:\n\n\n<networkConnectors>\n         \t<networkConnector \n\t            name=\"T:broker1->broker2\"\n\t\t\t\tuserName=\"karaf\"\n\t\t        password=\"karaf\"\n\t\t        uri=\"masterslave:(tcp://${ACTIVEMQ_HEAD_1_IP_ADDRESS}:61616,tcp://${ACTIVEMQ_HEAD_2_IP_ADDRESS}:61616)\"\n        \t    duplex=\"true\"\n\t            decreaseNetworkConsumerPriority=\"true\"\n\t            networkTTL=\"2\"\n        \t    dynamicOnly=\"true\">\n\t            <excludedDestinations>\n        \t          <queue physicalName=\"&gt;\" />\n        \t          <topic physicalName=\"Shop.Pos.Api.Outbound\" />\n\t            </excludedDestinations>\n\t         </networkConnector>\n\t         <networkConnector \n\t            name=\"Q:broker1->broker2\" \n\t\t\t\tuserName=\"karaf\"\n\t            password=\"karaf\"\n\t            uri=\"masterslave:(tcp://${ACTIVEMQ_HEAD_1_IP_ADDRESS}:61616,tcp://${ACTIVEMQ_HEAD_2_IP_ADDRESS}:61616)\"\n\t            duplex=\"true\"\n\t            decreaseNetworkConsumerPriority=\"true\"\n\t            networkTTL=\"2\"\n\t            dynamicOnly=\"true\">\n\t            <excludedDestinations>\n\t                  <topic physicalName=\"&gt;\" />\n\t            </excludedDestinations>\n\t         </networkConnector>\n\t\t</networkConnectors>\n\n\nTest to Recreate:\nTo recreate this issue, we can block the network between the two hosts while simulating some load\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Durable Subscribers going offline - Over Network Of Brokers - Duplex Connection","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Active MQ Version 5.13.3\nKaraf 4.0.6 \nCamel 2.16.3 \n\n-Active MQ brokers are deployed in Karaf container. \n-Cluster of Active MQ Brokers (Network of brokers, configured as HUB and SPOKES).\n-Broker(s) at Hub (Master/Slave configuration using Shared File System)\n- Broker(s) at spoke(s)- Connected to HUB using Duplex Network Connector ( Openwire/NIO) ","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13009906/comment/15549170","id":"15549170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"When the durable subscribers are not receiving their messages and they are staying on the spoke broker, is the network bridge established between the brokers still? Or is the network bridge itself disconnected?\n\nIf the network bridge is re-stablished after the outage but the durables are not getting messages then this might be helped by a new feature I added in 5.14.x.  There's a new flag on the network connector that can be set that is called \"syncDurableSubs\".  You would need to upgrade to 5.14.1 to try this flag however.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-10-05T16:09:25.360+0000","updated":"2016-10-05T16:09:25.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13009906/comment/15549266","id":"15549266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for your prompt response. Yes, the network is clear after the outage, but the messages are not flowing across the bridge. \nWhen I check the subscribers page on activemq web console, they still show up under offline durable subscriber section. \nI will review the fix in 5.14.1. Thanks for the advise. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranjit.nethi%40gmail.com","name":"ranjit.nethi@gmail.com","key":"ranjit.nethi@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjit Nethi","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-05T16:42:31.828+0000","updated":"2016-10-05T16:42:31.828+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13009906/comment/15549332","id":"15549332","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"The original fix was in 5.14.0 but there was a bug fixed with it in 5.14.1.  I haven't had a chance to document the new feature yet but the two relevant Jiras are:\n\nhttps://issues.apache.org/jira/browse/AMQ-6373\nhttps://issues.apache.org/jira/browse/AMQ-6423\n\nNot sure this is your problem in this case but it might be.  The durable sync will happen on a network bridge restart so after the outage the sync would happen on reconnect.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2016-10-05T17:01:21.697+0000","updated":"2016-10-05T17:01:21.697+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6457/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i34h87:"}}