{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482129","self":"https://issues.apache.org/jira/rest/api/2/issue/12482129","key":"AMQ-2798","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-08-17T14:34:47.850+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 08 14:24:05 UTC 2017","customfield_12310420":"46504","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_21228440642_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-02-25T23:35:25.446+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2798/watchers","watchCount":10,"isWatching":false},"created":"2010-06-25T06:48:04.820+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315622","id":"12315622","description":"","name":"5.3.2","archived":false,"released":true,"releaseDate":"2010-05-11"}],"issuelinks":[{"id":"12448751","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12448751","type":{"id":"10020","name":"Cloners","inward":"is cloned by","outward":"is a clone of","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10020"},"inwardIssue":{"id":"12913186","key":"AMQ-6043","self":"https://issues.apache.org/jira/rest/api/2/issue/12913186","fields":{"summary":"CLONE - Occaional hangs on ensureConnectionInfoSent","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12549820","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12549820","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13203774","key":"AMQCPP-643","self":"https://issues.apache.org/jira/rest/api/2/issue/13203774","fields":{"summary":"Add an option to time out connection attempts when blocked in ensureConnectionInfoSent","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-12-11T16:48:38.438+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When connecting to the broker, the client occasionally starts to hang. A thread dump reveals:\n\n{noformat}\n\"QuartzScheduler_Worker-7\" prio=5 tid=0x0116f190 nid=0x1ce2400 waiting on condition [0xf1fae000..0xf1fafb30]\n\tat sun.misc.Unsafe.park(Native Method)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:118)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1767)\n\tat java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:341)\n\tat org.apache.activemq.transport.FutureResponse.getResult(FutureResponse.java:40)\n\tat org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:80)\n\tat org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1233)\n\tat org.apache.activemq.ActiveMQConnection.ensureConnectionInfoSent(ActiveMQConnection.java:1339)\n\t- locked <0x10b9bdf8> (a java.lang.Object)\n\tat org.apache.activemq.ActiveMQConnection.createSession(ActiveMQConnection.java:298)\n\tat org.jencks.amqpool.SessionPool.createSession(SessionPool.java:110)\n\tat org.jencks.amqpool.SessionPool.makeObject(SessionPool.java:78)\n\tat org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:974)\n\tat org.jencks.amqpool.SessionPool.borrowSession(SessionPool.java:53)\n\tat org.jencks.amqpool.ConnectionPool.createSession(ConnectionPool.java:89)\n\tat org.jencks.amqpool.XaConnectionPool.createSession(XaConnectionPool.java:51)\n\tat org.jencks.amqpool.PooledConnection.createSession(PooledConnection.java:132)\n\tat org.springframework.jms.support.JmsAccessor.createSession(JmsAccessor.java:200)\n{noformat}\n\nLooking closer at the code of {{ensureConnectionInfoSent}} in {{ActiveMQConnection}}, it uses the method:\n\n{code}\npublic Response syncSendPacket(Command command) throws JMSException {\n{code}\n\nwhich never times out, possibly causing everything to hang eternally. There does seem to be an identical method that allows for a timeout. \n\n{code}\n    public Response syncSendPacket(Command command, int timeout) throws JMSException {\n{code}\n\nshould / can ensureConnectionInfoSent use the one with the timeout instead?\n\nWe're using the failover transport:\nfailover:(tcp://<someIP>:54663?wireFormat.maxInactivityDuration=300000)?maxReconnectAttempts=10&amp;initialReconnectDelay=15000","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461800","id":"12461800","filename":"blocked-connection-patch3","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"created":"2010-08-17T18:04:56.881+0000","size":2593,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461800/blocked-connection-patch3"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59580","customfield_12312823":null,"summary":"Occaional hangs on ensureConnectionInfoSent","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanderingwalrus","name":"wanderingwalrus","key":"wanderingwalrus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Chaimungkalanont","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanderingwalrus","name":"wanderingwalrus","key":"wanderingwalrus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Chaimungkalanont","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12938266","id":"12938266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"body":"I can reproduce this issue. I am using Master/Slave configuration with Master set to waitForSlave=\"true\" \nStart Master and then start consumer. Consumer hangs at ensureConnectionInfoSent() does not matter if I am using shared or unshared connection.\n\nI added a property syncResponseTimeout in factory and connection and wired it in. Changed syncSendPacket to use timeout and I dont get hung consumer.\n\nI am going to attach a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"created":"2010-08-17T14:34:47.850+0000","updated":"2010-08-17T14:34:47.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12938213","id":"12938213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"body":"Patch I used to fix this issue. I am not expert in this codebase but ping me if this is not the best way. This is STOPPING us from going to production with this issue open.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"created":"2010-08-17T14:37:05.538+0000","updated":"2010-08-17T14:37:05.538+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12938249","id":"12938249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"body":"Attaching new patch as FailoverTransactionTest was failing. Still running tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"created":"2010-08-17T17:53:23.547+0000","updated":"2010-08-17T17:53:23.547+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12938291","id":"12938291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Have you tried just adding in the startupMaxReconnectAttempts option to your connection URI?  This option will limit the number of time the Failover Transport will attempt to reconnect on startup and allow the client to fail after that number of tries.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2010-08-17T18:56:54.930+0000","updated":"2010-08-17T18:56:54.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12942351","id":"12942351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"body":"I have startupMaxReconnectAttempts=2 and it does not work.\n\nmy brokerURL looks like failover:(tcp://hostname:61616?keepAlive=true)?randomize=false&amp;startupMaxReconnectAttempts=2\n\nkeepAlive or not it fails.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"created":"2010-08-17T19:08:37.168+0000","updated":"2010-08-17T19:08:37.168+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12938356","id":"12938356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanderingwalrus","name":"wanderingwalrus","key":"wanderingwalrus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Chaimungkalanont","active":true,"timeZone":"Etc/UTC"},"body":"@Tim, I think the problem is happening at a lower level than that. As in, I think the the {{ensureConnectionInfoSent}} does the {{syncSendPacket}} on some sort of advisorial transport (I think org.apache.activemq.transport.ResponseCorrelator) and not the actual specified transport. This seems likely since syncSendPacket calls {{(Response)this.transport.request(command)}} and for FailoverTransport, the implementation for this is:\n\n{code}\n    public Object request(Object command) throws IOException {\n        throw new AssertionError(\"Unsupported Method\");\n    }\n{code}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wanderingwalrus","name":"wanderingwalrus","key":"wanderingwalrus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Chaimungkalanont","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-18T08:08:30.627+0000","updated":"2010-08-18T08:08:30.627+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12938250","id":"12938250","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski","name":"pbruski","key":"pbruski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Etc/UTC"},"body":"The attached patch may throw an NPE on timeout, depending on transport.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski","name":"pbruski","key":"pbruski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-18T16:06:24.739+0000","updated":"2010-08-18T16:17:03.310+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12938528","id":"12938528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"body":"Do you think ResponseCrrelator needs to guard against nulls? I always assumes that Command (Object o) is a valid object. Or Can we assume if Response is null the connection is closed?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"created":"2010-08-18T21:18:05.156+0000","updated":"2010-08-18T21:39:19.852+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12938721","id":"12938721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Version 5.4.0 adds a RequestTimeoutException that is thrown on timeout in ResponseCorrelator so the NPE is not an issue any longer.\n\nCurrently the code is operating as designed, the case where the connection.start or createSession is hanging is awaiting a response from the broker for its ConnectionInfo.  The case in which this is happening in regards to this issue is when the Master broker is up but awaiting its slave to start as well.  In this case the Master is there but it won't respond to the ConnectionInfo and the connection breaks at which time the FailoverTransport tries again to connect.  This explains why the maxReconnectAttempts and startupMaxReconnectAttempts don't apply here since it is able to actually open a socket successfully to the Master broker, it just doesn't complete the connect cycle because the master is awaiting its slave before it will allow any connections.  Once the slave comes online and the Master completes its start-up then the Connection should be established as normal.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2010-08-18T21:45:52.497+0000","updated":"2010-08-18T21:45:52.497+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12938077","id":"12938077","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski","name":"pbruski","key":"pbruski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Etc/UTC"},"body":"I am not sure whether it's also an issue, but it seems that although ResponseCorrelator is fixed, ReliableTransport may still return null, since it does:\n{code}\nwhile (timeout > 0) {\n...\n}\nreturn response.getResult(0);\n{code}\n\nand FutureResponse does:\n\n{code}\nif (result == null && timeout > 0) {\n       throw new RequestTimedOutIOException();\n}\nreturn result;\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pbruski","name":"pbruski","key":"pbruski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Przemek Bruski","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-19T11:07:37.752+0000","updated":"2010-08-19T11:09:54.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12942383","id":"12942383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"body":"I see that 5.4.0 behaves better. Is there any property that controlls the timeout? Additionally I see excessive logging in this situation and activemq takes over CPU.\nHere is the exception:\n2010-08-19 09:39:17,090 INFO  [org.apache.activemq.broker.TransportConnection.Transport] Transport failed: java.io.IOException: The transport is not running.\njava.io.IOException: The transport is not running.\n\tat org.apache.activemq.transport.TransportSupport.checkStarted(TransportSupport.java:107)\n\tat org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:179)\n\tat org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:244)\n\tat org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:85)\n\tat org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:104)\n\tat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\n\tat org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1247)\n\tat org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:808)\n\tat org.apache.activemq.broker.TransportConnection.dispatchSync(TransportConnection.java:768)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:187)\n\tat org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n\tat org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:217)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:219)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:201)\n\tat java.lang.Thread.run(Thread.java:619)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akhanzode","name":"akhanzode","key":"akhanzode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anish Khanzode","active":true,"timeZone":"America/New_York"},"created":"2010-08-19T13:42:12.739+0000","updated":"2010-08-19T13:42:12.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/12999645","id":"12999645","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I believe this has been resolved, please reopen if there's still an issue here","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-02-25T23:35:25.455+0000","updated":"2011-02-25T23:35:25.455+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/13214672","id":"13214672","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fbenoit","name":"fbenoit","key":"fbenoit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fabien Benoit-Koch","active":true,"timeZone":"Etc/UTC"},"body":"Sadly, I still have this exact issue in 5.5.0 (reproducible every time). Jstack shows the same stack as described. Is there a workaround ?\n\nEdit: Also tested with 5.5.1 and 5.6-snapshot, same behaviour.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fbenoit","name":"fbenoit","key":"fbenoit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fabien Benoit-Koch","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-23T14:23:08.572+0000","updated":"2012-02-23T15:13:37.462+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/13596666","id":"13596666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"We encountered the error too.  We're on 5.7.0.  Below is the thread stack of the hanging thread.  It doesn't happen often, but it's there.  We're using the failover uri.\n\n<networkConnector name=\"perform33\" uri=\"static:(tcp://perform31:61616?keepAlive=true&amp;wireFormat.tightEncodingEnabled=false&amp;wireFormat.cacheEnabled=false,tcp://perform38:61616?keepAlive=true&amp;wireFormat.tightEncodingEnabled=false&amp;wireFormat.cacheEnabled=false)?useExponentialBackOff=false\">\n\n\n\nName: defaultQuartzScheduler_Worker-1\nState: WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@3bd8ed5f\nTotal blocked: 10  Total waited: 10\n\nStack trace: \nsun.misc.Unsafe.park(Native Method)\njava.util.concurrent.locks.LockSupport.park(Unknown Source)\njava.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(Unknown Source)\njava.util.concurrent.ArrayBlockingQueue.take(Unknown Source)\norg.apache.activemq.transport.FutureResponse.getResult(FutureResponse.java:40)\norg.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:87)\norg.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1366)\norg.apache.activemq.ActiveMQConnection.ensureConnectionInfoSent(ActiveMQConnection.java:1481)\n   - locked java.lang.Object@4bdacc2e\n\norg.apache.activemq.ActiveMQConnection.start(ActiveMQConnection.java:516)\norg.mule.transport.jms.JmsConnector.doStart(JmsConnector.java:626)\norg.mule.transport.AbstractConnector$2.onTransition(AbstractConnector.java:459)\norg.mule.transport.AbstractConnector$2.onTransition(AbstractConnector.java:454)\norg.mule.lifecycle.AbstractLifecycleManager.invokePhase(AbstractLifecycleManager.java:141)\norg.mule.transport.ConnectorLifecycleManager.fireStartPhase(ConnectorLifecycleManager.java:63)\norg.mule.transport.AbstractConnector.startAfterConnect(AbstractConnector.java:453)\n   - locked org.mule.transport.jms.activemq.ActiveMQJmsConnector@20fb07d4\n\norg.mule.transport.AbstractConnector$5.doWork(AbstractConnector.java:1601)\norg.mule.retry.policies.AbstractPolicyTemplate.execute(AbstractPolicyTemplate.java:67)\norg.mule.transport.AbstractConnector.connect(AbstractConnector.java:1611)\norg.mule.transport.AbstractConnector.start(AbstractConnector.java:419)\n   - locked org.mule.transport.jms.activemq.ActiveMQJmsConnector@20fb07d4\n\nsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nsun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nsun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\njava.lang.reflect.Method.invoke(Unknown Source)\norg.mule.lifecycle.phases.DefaultLifecyclePhase.applyLifecycle(DefaultLifecyclePhase.java:225)\norg.mule.lifecycle.RegistryLifecycleManager$RegistryLifecycleCallback.onTransition(RegistryLifecycleManager.java:276)\norg.mule.lifecycle.RegistryLifecycleManager.invokePhase(RegistryLifecycleManager.java:155)\norg.mule.lifecycle.RegistryLifecycleManager.fireLifecycle(RegistryLifecycleManager.java:126)\norg.mule.registry.AbstractRegistryBroker.fireLifecycle(AbstractRegistryBroker.java:80)\norg.mule.registry.MuleRegistryHelper.fireLifecycle(MuleRegistryHelper.java:121)\norg.mule.lifecycle.MuleContextLifecycleManager$MuleContextLifecycleCallback.onTransition(MuleContextLifecycleManager.java:94)\norg.mule.lifecycle.MuleContextLifecycleManager$MuleContextLifecycleCallback.onTransition(MuleContextLifecycleManager.java:90)\norg.mule.lifecycle.MuleContextLifecycleManager.invokePhase(MuleContextLifecycleManager.java:72)\norg.mule.lifecycle.MuleContextLifecycleManager.fireLifecycle(MuleContextLifecycleManager.java:64)\norg.mule.DefaultMuleContext.start(DefaultMuleContext.java:202)\n   - locked org.mule.DefaultMuleContext@13aaf18f\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-08T01:19:13.070+0000","updated":"2013-03-08T01:23:17.007+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/13596676","id":"13596676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"By the way, we turned off the producer flow control.\n\n<policyEntry queue=\">\" timeBeforeDispatchStarts=\"30000\" producerFlowControl=\"false\" useCache=\"false\">\n</policyEntry>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-08T01:29:42.344+0000","updated":"2013-03-08T01:29:42.344+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/13596720","id":"13596720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"body":"You can not talk to the master which the slave is not attached.\nThe master being waiting for the slave essentially opens a server socket but never accepts/reads the client socket.\nHave you tried to enable soTimeout option?\nhttp://activemq.apache.org/tcp-transport-reference.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2013-03-08T02:42:14.524+0000","updated":"2013-03-08T02:42:14.524+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/13599373","id":"13599373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi SuoNayi,\nThank you for your feedback.  Your second point about soTimeout is a valuable suggestion for me to try!  Since this issue happens rarely for us, I will tell if this will fix our case over time.\nAbout your first point, I'm confused.  We're using the \"shared storage master/slave\".  The slave is simply standby and keeps trying to grab the distributed file lock.  The master has no knowledge of the slave(s).  The Jms clients (the mule connectors in our case) can establish connections only to the master.  I don't follow when you said \"you can not talk to the master which the slave is not attached.\"  Or am I mistaken somewhere?\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=windeyu","name":"windeyu","key":"windeyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edwin Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-11T21:57:59.457+0000","updated":"2013-03-11T21:58:23.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/13599734","id":"13599734","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"body":"Anish said he can reproduce the issue when he uses the pure master/slave and the master is waiting for the slave to be attached.\nI think the master is half-started and unable to communicate with clients so I said \"You can not talk to the master which the slave is not attached to\".\nThe issue can not be reproduced when I use AMQ 5.7 in my test,I'm not sure how the issue of this case is solved at the moment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2013-03-12T05:49:25.659+0000","updated":"2013-03-12T05:49:25.659+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/14299885","id":"14299885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smil","name":"smil","key":"smil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tamas Cserveny","active":true,"timeZone":"Etc/UTC"},"body":"I just met this problem in our environment. \n\nMy stacktrace revelas the same dead-lock, but with a different command:\n\"default-threads - 38\" prio=10 tid=0x000000001803f800 nid=0x4dd4 waiting on condition [0x00002aced9085000]\n   java.lang.Thread.State: WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0x00000000b07c6010> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)\n        at java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:374)\n        at org.apache.activemq.transport.FutureResponse.getResult(FutureResponse.java:40)\n        at org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:87)\n        at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1406)\n        at org.apache.activemq.ActiveMQConnection.cleanup(ActiveMQConnection.java:1626)\n        at org.apache.activemq.ra.ActiveMQManagedConnection.cleanup(ActiveMQManagedConnection.java:235)\n        at org.jboss.jca.core.connectionmanager.pool.mcp.SemaphoreArrayListManagedConnectionPool.returnConnection(SemaphoreArrayListManagedConnectionPool.java:435)\n        at org.jboss.jca.core.connectionmanager.pool.AbstractPool.returnConnection(AbstractPool.java:561)\n        at org.jboss.jca.core.connectionmanager.AbstractConnectionManager.returnManagedConnection(AbstractConnectionManager.java:425)\n        at org.jboss.jca.core.connectionmanager.listener.TxConnectionListener$TransactionSynchronization.afterCompletion(TxConnectionListener.java:732)\n        at org.jboss.jca.core.connectionmanager.transaction.TransactionSynchronizer.invokeAfter(TransactionSynchronizer.java:380)\n        at org.jboss.jca.core.connectionmanager.transaction.TransactionSynchronizer.afterCompletion(TransactionSynchronizer.java:329)\n        at com.arjuna.ats.internal.jta.resources.arjunacore.SynchronizationImple.afterCompletion(SynchronizationImple.java:96)\n        at com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.afterCompletion(TwoPhaseCoordinator.java:402)\n        - locked <0x00000000b072ab98> (a java.lang.Object)\n        at com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.end(TwoPhaseCoordinator.java:103)\n        at com.arjuna.ats.arjuna.AtomicAction.commit(AtomicAction.java:162)\n        at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.commitAndDisassociate(TransactionImple.java:1165)\n        at com.arjuna.ats.internal.jta.transaction.arjunacore.BaseTransaction.commit(BaseTransaction.java:126)\n        at com.arjuna.ats.jbossatx.BaseTransactionManagerDelegate.commit(BaseTransactionManagerDelegate.java:75)\n        at org.jboss.as.ejb3.inflow.MessageEndpointInvocationHandler.afterDelivery(MessageEndpointInvocationHandler.java:72)\n        at sun.reflect.GeneratedMethodAccessor128.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.jboss.as.ejb3.inflow.AbstractInvocationHandler.handle(AbstractInvocationHandler.java:60)\n        at org.jboss.as.ejb3.inflow.MessageEndpointInvocationHandler.doInvoke(MessageEndpointInvocationHandler.java:136)\n        at org.jboss.as.ejb3.inflow.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:73)\n        at com.sun.proxy.$Proxy151.afterDelivery(Unknown Source)\n        at org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.afterDelivery(MessageEndpointProxy.java:128)\n        at org.apache.activemq.ra.MessageEndpointProxy.afterDelivery(MessageEndpointProxy.java:69)\n        at org.apache.activemq.ra.ServerSessionImpl.afterDelivery(ServerSessionImpl.java:225)\n        at org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:1029)\n        at org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:169)\n        at org.jboss.jca.core.workmanager.WorkWrapper.run(WorkWrapper.java:218)\n        at org.jboss.threads.SimpleDirectExecutor.execute(SimpleDirectExecutor.java:33)\n        at org.jboss.threads.QueueExecutor.runTask(QueueExecutor.java:808)\n        at org.jboss.threads.QueueExecutor.access$100(QueueExecutor.java:45)\n        at org.jboss.threads.QueueExecutor$Worker.run(QueueExecutor.java:849)\n        at java.lang.Thread.run(Thread.java:744)\n        at org.jboss.threads.JBossThread.run(JBossThread.java:122)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smil","name":"smil","key":"smil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tamas Cserveny","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-31T16:30:00.343+0000","updated":"2015-01-31T16:30:00.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/14299963","id":"14299963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smil","name":"smil","key":"smil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tamas Cserveny","active":true,"timeZone":"Etc/UTC"},"body":"Actially there is a general problem behind the scenes:\n\nThe component ResponseCorrelator is written in an optimistic manner. The assumption is that in case a command sent to the broker, an answer will reach us guaranteed.\n\nThis is not true in case of failover situations. It might happen, that we were able to serialize the last bit of the command just before the broker has crashed/killed. This is true for the failover-transport as well.\n\nThis means ResponseCorrelator could hang forever at very different locations.\n\nThe solution would be to define a time-to-live for the commands. Some of the commands do have timeout, the calling code also takes care of timeouts. (Callers without timeout does not cope with the situation well. In my case I interrupted the above thread, and then JBoss started to process the messages using two different processors at the same time). Thus, ResponseCorrelator should repeat the command to the server using the same commandID(?). \nIn case the command ID is known to the failover-transport (ResponseMap) it might ignore the resend, because most likely it is still attempting to send it. TTL could be a larger number like 30-40 sec with infinite as default.\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smil","name":"smil","key":"smil","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tamas Cserveny","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-31T20:04:32.098+0000","updated":"2015-01-31T20:04:32.098+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/15892355","id":"15892355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roydar","name":"roydar","key":"roydar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roy Dar","active":true,"timeZone":"Etc/UTC"},"body":"Issue still happening in 5.13.0:\n\nsun.misc.Unsafe.park(Native Method)\njava.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\njava.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)\njava.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:403)\norg.apache.activemq.transport.FutureResponse.getResult(FutureResponse.java:48)\norg.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:87)\norg.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1381)\norg.apache.activemq.ActiveMQConnection.ensureConnectionInfoSent(ActiveMQConnection.java:1495)\norg.apache.activemq.ActiveMQConnection.start(ActiveMQConnection.java:522)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roydar","name":"roydar","key":"roydar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roy Dar","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-02T14:54:17.506+0000","updated":"2017-03-02T14:54:17.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/15901176","id":"15901176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samion","name":"samion","key":"samion","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sami Nieminen","active":true,"timeZone":"Europe/Helsinki"},"body":"We are also experiencing this occasional hang with master/slave configuration using 5.11.1.\n\n{code}\n        sun.misc.Unsafe.park(Native Method)\n        java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n        java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)\n        java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:403)\n        org.apache.activemq.transport.FutureResponse.getResult(FutureResponse.java:40)\n        org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:87)\n        org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1387)\n        org.apache.activemq.ActiveMQConnection.ensureConnectionInfoSent(ActiveMQConnection.java:1501)\n        org.apache.activemq.ActiveMQConnection.createSession(ActiveMQConnection.java:323)\n        org.springframework.jms.support.JmsAccessor.createSession(JmsAccessor.java:192)\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=samion","name":"samion","key":"samion","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sami Nieminen","active":true,"timeZone":"Europe/Helsinki"},"created":"2017-03-08T12:21:29.098+0000","updated":"2017-03-08T12:21:29.098+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482129/comment/15901328","id":"15901328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roydar","name":"roydar","key":"roydar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roy Dar","active":true,"timeZone":"Etc/UTC"},"body":"Yes, we have validated that the issue was resolved in version 5.14.0\nhttps://issues.apache.org/jira/browse/AMQ-6362\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roydar","name":"roydar","key":"roydar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roy Dar","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-08T14:24:05.569+0000","updated":"2017-03-08T14:24:05.569+0000"}],"maxResults":23,"total":23,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2798/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0akev:"}}