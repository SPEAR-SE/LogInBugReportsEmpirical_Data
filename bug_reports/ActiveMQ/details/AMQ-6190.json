{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12945232","self":"https://issues.apache.org/jira/rest/api/2/issue/12945232","key":"AMQ-6190","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 02 03:47:42 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6190/watchers","watchCount":1,"isWatching":false},"created":"2016-02-28T01:37:34.045+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":["easyfix"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329848","id":"12329848","name":"5.13.0","archived":false,"released":true,"releaseDate":"2015-12-03"}],"issuelinks":[{"id":"12458716","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12458716","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12764778","key":"AMQ-5503","self":"https://issues.apache.org/jira/rest/api/2/issue/12764778","fields":{"summary":"Make init script more reliable","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-03-02T03:47:42.106+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When \"ACTIVEMQ_USER\" is defined and launching via \"./bin/activemq start\" PID file is owned by the defined user.  If launching as \"./bin/activemq console\" PID file is owned by the calling user.  Subsequent calls to \"start\" may fail as permissions would not allow the defined user to manipulate the file.\n\nWorkarounds:\n1) call console using \"sudo -u <defined user> ./bin/activemq console\" (or switch to the user if it is allowed (user may not be allowed to login)\n2) change ownership of pid file\n3) remove pid file\n\nSuggest either creating the pid file using the defined user and/or removing the pid file once ctrl+c has been pressed/console run ends.\n\nEdit:\nLooking at the script there is a print line to say it is removing thepid file but the command to do the work is no present.  Using others in the script as a reference, at line 481 insert \"rm -f \"$ACTIVEMQ_PIDFILE\" >/dev/null 2>&1\"","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12790857","id":"12790857","filename":"activemq.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmagistro","name":"bmagistro","key":"bmagistro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben Magistro","active":true,"timeZone":"Etc/UTC"},"created":"2016-03-02T03:47:42.087+0000","size":1314,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12790857/activemq.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"When running \"./bin/activemq console\" PID file is not owned by \"ACTIVEMQ_USER\"","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmagistro","name":"bmagistro","key":"bmagistro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben Magistro","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmagistro","name":"bmagistro","key":"bmagistro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben Magistro","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"CentOS 6.x","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12945232/comment/15174986","id":"15174986","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmagistro","name":"bmagistro","key":"bmagistro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben Magistro","active":true,"timeZone":"Etc/UTC"},"body":"Attached is what  I think might be a reasonable patch to this.  This doesn't change who owns the pid file (did not test the scenario where the pid exists and is not readable by the user calling console or where console has been started but pid is not readable by the user calling start).  It is probably simpler to not change ownership as it should ensure the user who called console and created the pid can also remove it.\n\n1) Updates the output of console to include the pid of the running process (copied directly from invoke_start)\n2) Do not call exec when invoking jar.  As I understand it, exec replaces the process but we want to come back and clean up when we are done\n3) Exit if we cannot create the pid file, this may mean there is already another copy running somewhere\n4) Add a hook on the interrupt signal (might make sense to add a few others) but only when this routine is called (minimally tested while calling bstat)\n5) Create interrupt handler function to finish cleaning up","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bmagistro","name":"bmagistro","key":"bmagistro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ben Magistro","active":true,"timeZone":"Etc/UTC"},"created":"2016-03-02T03:47:42.091+0000","updated":"2016-03-02T03:47:42.091+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6190/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2tvgf:"}}