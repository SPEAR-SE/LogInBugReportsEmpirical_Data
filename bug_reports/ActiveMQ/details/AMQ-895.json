{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483417","self":"https://issues.apache.org/jira/rest/api/2/issue/12483417","key":"AMQ-895","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"parent":{"id":"12483795","key":"AMQ-2455","self":"https://issues.apache.org/jira/rest/api/2/issue/12483795","fields":{"summary":"Need a facility to retry jms connections to a foreign provider by the ActiveMQ JMS bridge.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2006-08-25T11:00:16.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Apr 28 13:59:28 UTC 2010","customfield_12310420":"43740","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_115960028893_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-04-28T13:59:28.893+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-895/watchers","watchCount":7,"isWatching":false},"created":"2006-08-25T10:52:20.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315608","id":"12315608","description":"","name":"4.0 RC2","archived":false,"released":true,"releaseDate":"2006-04-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315611","id":"12315611","description":"","name":"4.0.1","archived":false,"released":true,"releaseDate":"2006-06-16"}],"issuelinks":[{"id":"12334958","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334958","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12482104","key":"AMQ-1228","self":"https://issues.apache.org/jira/rest/api/2/issue/12482104","fields":{"summary":"CLONE -JMS to JMS Bridge never reconnects under remote broker restarts and connections are not closed.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-04-28T13:59:28.863+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I'm using ActiveMQ (4.0.1) JMS to JMS Bridge functionality to connect to a  SunMQ JMS Broker (3.6 SP3  (Build 02-A)). I'm using two queues, an input and an output one, with the following configuration:\n\n\n    <jmsBridgeConnectors>\n      <jmsQueueConnector outboundQueueConnectionFactory=\"#REMOTE\">\n      <outboundQueueBridges>\n        <outboundQueueBridge outboundQueueName=\"SUNRECV\"/>\n      </outboundQueueBridges>\n      <inboundQueueBridges>\n        <inboundQueueBridge inboundQueueName=\"SUNSEND\"/>\n      </inboundQueueBridges>\n      </jmsQueueConnector>\n    </jmsBridgeConnectors>\n\n\nThe system works really well until the SunMQ broker needed to be restarted. This is what I found:\n1.-ActiveMQ is not aware of the remote broker shutdown. I waited for a while, but no log on ActiveMQ indicates knowledge about the new situation.\n2.-When I send a message to the output queue SUNRECV, ActiveMQ complains that the producer is closed:\n\n[ERROR][2006/08/25.09:47:12.039][ActiveMQ Session Task]failed to forward message: ActiveMQTextMessage {commandId = 5, responseRequired = false, messageId = ID:trabucco-43457-1156491843149-3:4:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-43457-1156491843149-3:4:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156492032027, arrival = 0, correlationId = null, replyTo = null, persistent = false, type = null, priority = 0, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 2, properties = null, readOnlyProperties = true, readOnlyBody = true, text = 1}([C4064]: Cannot perform operation, producer is closed.)\n\n After this, it is automatically queueing messages without sending them, showing the log:\n\n[DEBUG][2006/08/25.09:47:42.721][RMI TCP Connection(4)-10.95.89.20]No subscriptions registered, will not dispatch message at this time.\n\n Even if SunMQ is started again, ActiveMQ is not detecting the new situation, and continues queueing messages sent to SUNRECV.\n\nPlease, make me know if more information is needed to understand the situation.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460743","id":"12460743","filename":"test_patch.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kaitchuc","name":"kaitchuc","key":"kaitchuc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Kaitchuck","active":true,"timeZone":"Etc/UTC"},"created":"2006-09-21T21:03:54.000+0000","size":3547,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12460743/test_patch.diff"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"159855","customfield_12312823":null,"summary":"JMS to JMS Bridge never reconnects under remote broker restarts.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938372","id":"12938372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"I've tried adding a fix to SVN trunk. I wonder could you try it out for me to see if it fixes your issue? Basically I've patched the code to try reconnecting (by default a maximum of 10 times per message) if the send() fails before stopping the bridge.\n\nGrab the latest code here...\nhttp://incubator.apache.org/activemq/source.html\n\nthen build it...\nhttp://incubator.apache.org/activemq/building.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2006-08-25T11:00:16.000+0000","updated":"2006-08-25T11:00:16.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938386","id":"12938386","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"body":"Thanks a lot, James. \n\nI'm not familiar with maven usage and I'm getting an error I don't know the cause of:\n\nDownloading: http://ibiblio.org/maven2//directory-shared/ldap-common/0.9.1/ldap-\ncommon-0.9.1.pom\n[INFO] ------------------------------------------------------------------------\n[ERROR] BUILD ERROR\n[INFO] ------------------------------------------------------------------------\n[INFO] Error building POM (may not be this project's POM).\n\n\nProject ID: directory-shared:ldap-common\n\nReason: Error getting POM for 'directory-shared:ldap-common' from the repository\n: Error transferring file\n  directory-shared:ldap-common:pom:0.9.1\n\n\nThanks.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2006-08-25T11:41:23.000+0000","updated":"2006-08-25T11:41:23.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12936355","id":"12936355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"body":"I've updated my local svn copy this morning, and have seen that the ldap-common version have been bumped up to 0.9.2. But now, I'm running into a different problem:\n\n...\nDownloading: http://people.apache.org/repo/m2-snapshot-repository/org/codehaus/p\nlexus/plexus-archiver/1.0-alpha-7-SNAPSHOT/plexus-archiver-1.0-alpha-7-SNAPSHOT.\njar\n[WARNING] Unable to get resource from repository apache.snapshots (http://people\n.apache.org/repo/m2-snapshot-repository)\nDownloading: http://people.apache.org/repo/m2-snapshot-repository/org/apache/mav\nen/maven-archiver/2.2-SNAPSHOT/maven-archiver-2.2-20060826.152218-3.jar\n11K downloaded\n[INFO] ------------------------------------------------------------------------\n[ERROR] BUILD ERROR\n[INFO] ------------------------------------------------------------------------\n[INFO] Failed to resolve artifact.\n\nMissing:\n----------\n1) org.codehaus.plexus:plexus-archiver:jar:1.0-alpha-7-SNAPSHOT\n\n  Try downloading the file manually from the project website.\n\n  Then, install it using the command:\n      mvn install:install-file -DgroupId=org.codehaus.plexus -DartifactId=plexus\n-archiver \\\n          -Dversion=1.0-alpha-7-SNAPSHOT -Dpackaging=jar -Dfile=/path/to/file\n\n  Path to dependency:\n        1) org.apache.maven.plugins:maven-jar-plugin:maven-plugin:2.1-20060826.1\n62339-6\n        2) org.apache.maven:maven-archiver:jar:2.2-SNAPSHOT\n        3) org.codehaus.plexus:plexus-archiver:jar:1.0-alpha-7-SNAPSHOT\n\n----------\n1 required artifact is missing.\n\nfor artifact:\n  org.apache.maven.plugins:maven-jar-plugin:maven-plugin:2.1-20060826.162339-6\n\nfrom the specified remote repositories:\n  central (http://repo1.maven.org/maven2),\n  apache.snapshots (http://people.apache.org/repo/m2-snapshot-repository),\n  apache-snapshots (http://people.apache.org/maven-snapshot-repository)\n\n\nI tried to follow the intructions into the error, downloaded a version of plexus-archiver and got this new error:\n\nC:\\src\\activemq\\trunk>mvn install:install-file -DgroupId=org.codehaus.plexus -Da\nrtifactId=plexus-archiver -Dversion=1.0-alpha-7-SNAPSHOT -Dpackaging=jar -Dfile=\n\"C:\\Documents and Settings\\Administrador\\Escritorio\\plexus-archiver-1.0-alpha-7-\n20060827.121315-6.jar\"\n[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[ERROR] FATAL ERROR\n[INFO] ------------------------------------------------------------------------\n[INFO] Error building POM (may not be this project's POM).\n\n\nProject ID: org.apache.activemq:activemq-core\nPOM Location: C:\\src\\activemq\\trunk\\activemq-core\\pom.xml\nValidation Messages:\n\n    [0]  'dependencies.dependency.version' is missing for org.apache.activemq:activemq-jaas\n\n\nReason: Failed to validate POM\n\n\n[INFO] ------------------------------------------------------------------------\n[INFO] Trace\norg.apache.maven.reactor.MavenExecutionException: Failed to validate POM\n        at org.apache.maven.DefaultMaven.getProjects(DefaultMaven.java:365)\n        at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:278)\n        at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)\n        at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)\n        at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)\n        at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)\n\n        at org.codehaus.classworlds.Launcher.main(Launcher.java:375)\nCaused by: org.apache.maven.project.InvalidProjectModelException: Failed to vali\ndate POM\n        at org.apache.maven.project.DefaultMavenProjectBuilder.processProjectLog\nic(DefaultMavenProjectBuilder.java:926)\n        at org.apache.maven.project.DefaultMavenProjectBuilder.buildInternal(Def\naultMavenProjectBuilder.java:737)\n        at org.apache.maven.project.DefaultMavenProjectBuilder.buildFromSourceFi\nleInternal(DefaultMavenProjectBuilder.java:416)\n        at org.apache.maven.project.DefaultMavenProjectBuilder.build(DefaultMave\nnProjectBuilder.java:192)\n        at org.apache.maven.DefaultMaven.getProject(DefaultMaven.java:515)\n        at org.apache.maven.DefaultMaven.collectProjects(DefaultMaven.java:447)\n        at org.apache.maven.DefaultMaven.collectProjects(DefaultMaven.java:491)\n        at org.apache.maven.DefaultMaven.getProjects(DefaultMaven.java:351)\n        ... 11 more\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 1 second\n[INFO] Finished at: Mon Aug 28 09:17:31 CEST 2006\n[INFO] Final Memory: 1M/3M\n[INFO] ------------------------------------------------------------------------\n\n\nAt this stage, I don't know if this error is produced by a wrong setup of maven (I just followed the instructions in the ActiveMQ website (running maven 2.0.4)) or is something related with activemq itself. \n\nAny hint? \n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2006-08-28T07:26:07.000+0000","updated":"2006-08-28T07:26:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938420","id":"12938420","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"body":"I've avoided the previous problem launching 'mvn install:install-file ...' outside of the activemq directory. This way I reached compiling activemq-core, but it failed with this error:\n\nDownloading: http://repo1.maven.org/maven2/ant/ant/1.6.2/ant-1.6.2.jar\n976K downloaded\n[INFO] [xbean:mapping {execution: default}]\n[INFO] ------------------------------------------------------------------------\n[ERROR] FATAL ERROR\n[INFO] ------------------------------------------------------------------------\n[INFO] com.thoughtworks.qdox.parser.ParseException: syntax error @[90,25] in fil\ne:/C:/src/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/network\n/jms/JmsConnector.java\n[INFO] ------------------------------------------------------------------------\n[INFO] Trace\ncom.thoughtworks.qdox.parser.ParseException: syntax error @[90,25] in file:/C:/s\nrc/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/network/jms/Jm\nsConnector.java\n        at org.apache.xbean.maven.XBeanMojo.execute(XBeanMojo.java:185)\n        at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPlugi\nnManager.java:412)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(Defa\nultLifecycleExecutor.java:534)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalWithLi\nfecycle(DefaultLifecycleExecutor.java:475)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoal(Defau\nltLifecycleExecutor.java:454)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalAndHan\ndleFailures(DefaultLifecycleExecutor.java:306)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeTaskSegmen\nts(DefaultLifecycleExecutor.java:273)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.execute(DefaultLi\nfecycleExecutor.java:140)\n        at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:322)\n        at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)\n        at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)\n        at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)\n        at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)\n\n        at org.codehaus.classworlds.Launcher.main(Launcher.java:375)\nCaused by: com.thoughtworks.qdox.parser.ParseException: syntax error @[90,25] in\n file:/C:/src/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/net\nwork/jms/JmsConnector.java\n        at com.thoughtworks.qdox.parser.impl.Parser.yyerror(Parser.java:611)\n        at com.thoughtworks.qdox.parser.impl.Parser.yyparse(Parser.java:719)\n        at com.thoughtworks.qdox.parser.impl.Parser.parse(Parser.java:592)\n        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:30\n0)\n        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:31\n6)\n        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:31\n2)\n        at org.apache.xbean.spring.generator.QdoxMappingLoader.loadNamespaces(Qd\noxMappingLoader.java:96)\n        at org.apache.xbean.maven.XBeanMojo.execute(XBeanMojo.java:153)\n        ... 18 more\n--- Nested Exception ---\ncom.thoughtworks.qdox.parser.ParseException: syntax error @[90,25] in file:/C:/s\nrc/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/network/jms/Jm\nsConnector.java\n        at com.thoughtworks.qdox.parser.impl.Parser.yyerror(Parser.java:611)\n        at com.thoughtworks.qdox.parser.impl.Parser.yyparse(Parser.java:719)\n        at com.thoughtworks.qdox.parser.impl.Parser.parse(Parser.java:592)\n        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:30\n0)\n        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:31\n6)\n        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:31\n2)\n        at org.apache.xbean.spring.generator.QdoxMappingLoader.loadNamespaces(Qd\noxMappingLoader.java:96)\n        at org.apache.xbean.maven.XBeanMojo.execute(XBeanMojo.java:153)\n        at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPlugi\nnManager.java:412)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(Defa\nultLifecycleExecutor.java:534)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalWithLi\nfecycle(DefaultLifecycleExecutor.java:475)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoal(Defau\nltLifecycleExecutor.java:454)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalAndHan\ndleFailures(DefaultLifecycleExecutor.java:306)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeTaskSegmen\nts(DefaultLifecycleExecutor.java:273)\n        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.execute(DefaultLi\nfecycleExecutor.java:140)\n        at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:322)\n        at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)\n        at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)\n        at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)\n        at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)\n\n        at org.codehaus.classworlds.Launcher.main(Launcher.java:375)\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 5 minutes 10 seconds\n[INFO] Finished at: Mon Aug 28 09:35:45 CEST 2006\n[INFO] Final Memory: 15M/28M\n[INFO] ------------------------------------------------------------------------\n\nIt seems that JmsConnector.java is one of the modified files for the fix we're on. Anyway, I don't know what that qdox.parser is expecting to find, the java code looks fine to me, and making a diff against the previous svn version of the file at that point is only finding some cosmetic changes.\n\nWaiting for help. :-)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2006-08-28T07:49:39.000+0000","updated":"2006-08-28T07:49:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12936425","id":"12936425","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"body":"Previous error was produced by bug: https://issues.apache.org/activemq/browse/AMQ-901\n\nChecking todays svn trunk version finished with a successful compilation. However, reconnection seems not to work. \n\nThe scenario is as follows:\n\n===Scenario #1===\nActiveMQ broker with a bridged Sun MQ Broker.\n* Start ActiveMQ\n* Send a message to a bridged queue.\n** The message gets into the queue, the jmx console shows:\n     EnqueueCount: 1\n     DequeueCount: 0\n     QueueSize: 1\n* Start SunMQ\n* Send a new message to the bridged queue.\n** Messages are not delivered to the SunMQ broker.\n\n===Scenario #2===\nActiveMQ broker with a bridged SunMQ Broker.\n* Start SunMQ\n* Start ActiveMQ\n* Send a message to a bridged queue.\n** The message is bridged to SunMQ Broker queue. The jmx console shows:\n    ConsumerCount: 1\n     EnqueueCount: 1\n     DequeueCount: 1\n     QueueSize: 0\n* Stop SunMQ\n* Send a new message to the bridged queue.\n** Message is not delivered to the SunMQ broker.\n** The jmx console shows, for the queue:\n    ConsumerCount: 1\n    EnqueueCount: 2\n    DequeueCount: 2\n    QueueSize: 1\n**The log shows:\n[DEBUG][2006/08/30.12:40:57.849][ActiveMQ Transport Server: tcp://localhost:61635]Sending: WireFormatInfo { version=2, properties={TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}\n[DEBUG][2006/08/30.12:40:57.849][ActiveMQ Transport Server: tcp://localhost:61635]Sending: WireFormatInfo { version=2, properties={TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}\n[DEBUG][2006/08/30.12:40:57.887][ActiveMQ Transport: tcp:///127.0.0.1:47305]Received WireFormat: WireFormatInfo { version=2, properties={StackTraceEnabled=true, TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}\n[DEBUG][2006/08/30.12:40:57.888][ActiveMQ Transport: tcp:///127.0.0.1:47305]tcp:///127.0.0.1:47305 before negotiation: OpenWireFormat{version=1, cacheEnabled=false, stackTraceEnabled=false, tightEncodingEnabled=false, sizePrefixDisabled=false}\n[DEBUG][2006/08/30.12:40:57.889][ActiveMQ Transport: tcp:///127.0.0.1:47305]tcp:///127.0.0.1:47305 after negotiation: OpenWireFormat{version=2, cacheEnabled=true, stackTraceEnabled=true, tightEncodingEnabled=true, sizePrefixDisabled=false}\n[DEBUG][2006/08/30.12:40:57.887][ActiveMQ Transport: tcp:///127.0.0.1:47305]Received WireFormat: WireFormatInfo { version=2, properties={StackTraceEnabled=true, TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}\n[DEBUG][2006/08/30.12:40:57.888][ActiveMQ Transport: tcp:///127.0.0.1:47305]tcp:///127.0.0.1:47305 before negotiation: OpenWireFormat{version=1, cacheEnabled=false, stackTraceEnabled=false, tightEncodingEnabled=false, sizePrefixDisabled=false}\n[DEBUG][2006/08/30.12:40:57.889][ActiveMQ Transport: tcp:///127.0.0.1:47305]tcp:///127.0.0.1:47305 after negotiation: OpenWireFormat{version=2, cacheEnabled=true, stackTraceEnabled=true, tightEncodingEnabled=true, sizePrefixDisabled=false}\n[DEBUG][2006/08/30.12:40:58.479][ActiveMQ Transport: tcp:///127.0.0.1:47305]Adding consumer: ID:trabucco-47304-1156934456973-1:0:-1:1\n[DEBUG][2006/08/30.12:40:58.479][ActiveMQ Transport: tcp:///127.0.0.1:47305]Adding consumer: ID:trabucco-47304-1156934456973-1:0:-1:1\n[DEBUG][2006/08/30.12:40:58.976][ActiveMQ Transport: tcp:///127.0.0.1:47305]Removing consumer: ID:trabucco-47304-1156934456973-1:0:-1:1\n[ERROR][2006/08/30.12:40:59.266][ActiveMQ Session Task]failed to forward message on attempt: 1 reason: javax.jms.IllegalStateException: [C4064]: Cannot perform operation, producer is closed. message: ActiveMQBytesMessage {commandId = 5, responseRequired = true, messageId = ID:trabucco-47304-1156934456973-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-47304-1156934456973-1:0:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156934458928, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activeio.packet.ByteSequence@1a5e68a, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 529, properties = null, readOnlyProperties = true, readOnlyBody = true} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null }([C4064]: Cannot perform operation, producer is closed.)\n[DEBUG][2006/08/30.12:40:58.976][ActiveMQ Transport: tcp:///127.0.0.1:47305]Removing consumer: ID:trabucco-47304-1156934456973-1:0:-1:1\n[ERROR][2006/08/30.12:40:59.266][ActiveMQ Session Task]failed to forward message on attempt: 1 reason: javax.jms.IllegalStateException: [C4064]: Cannot perform operation, producer is closed. message: ActiveMQBytesMessage {commandId = 5, responseRequired = true, messageId = ID:trabucco-47304-1156934456973-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-47304-1156934456973-1:0:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156934458928, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activeio.packet.ByteSequence@1a5e68a, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 529, properties = null, readOnlyProperties = true, readOnlyBody = true} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null }([C4064]: Cannot perform operation, producer is closed.)\n*Start SunMQ again\n** Nothing happens in activemq (as expected)\n*Send a new message to the bridged queue.\n** Message is not delivered to the SunMQ Broker.\n**The jmx console shows, for the queue:\n   ConsumerCount: 1\n   EnqueueCount: 3\n   DequeueCount: 3\n   QueueSize: 2\n**The log shows this:\n[DEBUG][2006/08/30.12:43:19.803][ActiveMQ Transport Server: tcp://localhost:61635]Sending: WireFormatInfo { version=2, properties={TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}\n[DEBUG][2006/08/30.12:43:19.805][ActiveMQ Transport: tcp:///127.0.0.1:47315]Received WireFormat: WireFormatInfo { version=2, properties={StackTraceEnabled=true, TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}\n[DEBUG][2006/08/30.12:43:19.806][ActiveMQ Transport: tcp:///127.0.0.1:47315]tcp:///127.0.0.1:47315 before negotiation: OpenWireFormat{version=1, cacheEnabled=false, stackTraceEnabled=false, tightEncodingEnabled=false, sizePrefixDisabled=false}\n[DEBUG][2006/08/30.12:43:19.807][ActiveMQ Transport: tcp:///127.0.0.1:47315]tcp:///127.0.0.1:47315 after negotiation: OpenWireFormat{version=2, cacheEnabled=true, stackTraceEnabled=true, tightEncodingEnabled=true, sizePrefixDisabled=false}\n[DEBUG][2006/08/30.12:43:19.803][ActiveMQ Transport Server: tcp://localhost:61635]Sending: WireFormatInfo { version=2, properties={TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}\n[DEBUG][2006/08/30.12:43:19.805][ActiveMQ Transport: tcp:///127.0.0.1:47315]Received WireFormat: WireFormatInfo { version=2, properties={StackTraceEnabled=true, TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}\n[DEBUG][2006/08/30.12:43:19.806][ActiveMQ Transport: tcp:///127.0.0.1:47315]tcp:///127.0.0.1:47315 before negotiation: OpenWireFormat{version=1, cacheEnabled=false, stackTraceEnabled=false, tightEncodingEnabled=false, sizePrefixDisabled=false}\n[DEBUG][2006/08/30.12:43:19.807][ActiveMQ Transport: tcp:///127.0.0.1:47315]tcp:///127.0.0.1:47315 after negotiation: OpenWireFormat{version=2, cacheEnabled=true, stackTraceEnabled=true, tightEncodingEnabled=true, sizePrefixDisabled=false}\n[DEBUG][2006/08/30.12:43:20.433][ActiveMQ Transport: tcp:///127.0.0.1:47315]Adding consumer: ID:trabucco-47314-1156934598004-1:0:-1:1\n[DEBUG][2006/08/30.12:43:20.433][ActiveMQ Transport: tcp:///127.0.0.1:47315]Adding consumer: ID:trabucco-47314-1156934598004-1:0:-1:1\n[ERROR][2006/08/30.12:43:20.921][ActiveMQ Session Task]failed to forward message on attempt: 1 reason: javax.jms.IllegalStateException: [C4064]: Cannot perform operation, producer is closed. message: ActiveMQBytesMessage {commandId = 5, responseRequired = true, messageId = ID:trabucco-47314-1156934598004-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-47314-1156934598004-1:0:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156934600848, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activeio.packet.ByteSequence@1e29b99, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 529, properties = null, readOnlyProperties = true, readOnlyBody = true} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null }([C4064]: Cannot perform operation, producer is closed.)\n[DEBUG][2006/08/30.12:43:20.933][ActiveMQ Transport: tcp:///127.0.0.1:47315]Removing consumer: ID:trabucco-47314-1156934598004-1:0:-1:1\n[ERROR][2006/08/30.12:43:20.921][ActiveMQ Session Task]failed to forward message on attempt: 1 reason: javax.jms.IllegalStateException: [C4064]: Cannot perform operation, producer is closed. message: ActiveMQBytesMessage {commandId = 5, responseRequired = true, messageId = ID:trabucco-47314-1156934598004-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-47314-1156934598004-1:0:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156934600848, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activeio.packet.ByteSequence@1e29b99, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 529, properties = null, readOnlyProperties = true, readOnlyBody = true} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null }([C4064]: Cannot perform operation, producer is closed.)\n[DEBUG][2006/08/30.12:43:20.933][ActiveMQ Transport: tcp:///127.0.0.1:47315]Removing consumer: ID:trabucco-47314-1156934598004-1:0:-1:1\n\nFurthermore, after restarting the activeMQ broker with non delivered messages in the bridged queue, can lead to lose those messages.\n\nRegards","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2006-08-30T10:47:00.000+0000","updated":"2006-08-30T10:47:00.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938463","id":"12938463","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kaitchuc","name":"kaitchuc","key":"kaitchuc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Kaitchuck","active":true,"timeZone":"Etc/UTC"},"body":"This patch fixes what appears to be a bug in the origional fix. I have not yet been able to test it, as I have not yet setup a system to reproduce the problem, but can someone try it out?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kaitchuc","name":"kaitchuc","key":"kaitchuc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Kaitchuck","active":true,"timeZone":"Etc/UTC"},"created":"2006-09-21T21:03:54.000+0000","updated":"2006-09-21T21:03:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938980","id":"12938980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wrpkm","name":"wrpkm","key":"wrpkm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William MacDonald","active":true,"timeZone":"Etc/UTC"},"body":"I have come across this issue in an attempt to use the JMS to JMS bridge in version 4.1.1.\n\nI am trying to bridge ActiveMQ to Websphere MQ and I am running the bridge in its own process and everything connects and works properly.\n\nThe remote Websphere MQ broker is being shutdown every night for backups and when this occurs the bridge does not see the disconnect of the remote broker.\n\nI performed a netstat of the socket connections to see if the bridge was still attempting a connection and found that the socket connections to the remote broker are in a CLOSE_WAIT state.\n\nIf you have any ideas or wish to try a test I am willing to do what every is needed to resolve this issue.\n\nThanks,\n\nWilliam","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wrpkm","name":"wrpkm","key":"wrpkm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William MacDonald","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-12T14:02:06.734+0000","updated":"2007-04-12T14:02:06.734+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938918","id":"12938918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"body":"I'm currently trying out a similar issue bridging ActiveMQ to Sun CAPS, but is struggling.\n\nCould you share some light and tell me how you hav configured the \"#REMOTE\" element in the XML-file. \nMight just be helpful!\n\nbr\n-Alf","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-13T08:47:45.164+0000","updated":"2007-04-13T08:47:45.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938999","id":"12938999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"body":"It was a little tricked, perhaps caused by my ignorance, but I didn't find a suitable way to directly create a bean for the sunmq broker, as broker hostname and port are configured using a common method: setProperty. \nSo, I had to write a simple wrapper to adapt it to have standard setters. like this:\n\npackage es.tid.planb.spci.sunmq;\n\nimport com.sun.messaging.ConnectionFactory;\nimport com.sun.messaging.ConnectionConfiguration;\nimport javax.jms.JMSException;\n\npublic class ConnectionFactoryBean extends com.sun.messaging.QueueConnectionFactory\n{\n    public ConnectionFactoryBean()\n    {\n        super();\n    }\n\n    public void setBrokerHostName( String hostname )\n        throws JMSException\n    {\n        super.setProperty( ConnectionConfiguration.imqBrokerHostName,\n                           hostname );\n    }\n\n    public void setBrokerHostPort( String port )\n        throws JMSException\n    {\n        super.setProperty( ConnectionConfiguration.imqBrokerHostPort,\n                           port );\n    }\n\n\n    public String getBrokerHostName()\n        throws JMSException\n    {\n        return super.getProperty( ConnectionConfiguration.imqBrokerHostName );\n    }\n\n    public String getBrokerHostPort()\n        throws JMSException\n    {\n        return super.getProperty( ConnectionConfiguration.imqBrokerHostPort );\n    }\n}\n\n\n\nAnd then, use it in a bean like this:\n\n  <bean id=\"REMOTE\"\n        class=\"es.tid.planb.spci.sunmq.ConnectionFactoryBean\">\n    <property name=\"brokerHostName\" value=\"localhost\"/>\n    <property name=\"brokerHostPort\" value=\"7676\"/>\n  </bean>\n\n\nRegards.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-13T09:32:41.732+0000","updated":"2007-04-13T09:32:41.732+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938932","id":"12938932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wrpkm","name":"wrpkm","key":"wrpkm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William MacDonald","active":true,"timeZone":"Etc/UTC"},"body":"Alf,\n\nHere is the bridge settings that I am using for Websphere MQ.\n\n        <jmsQueueConnector name=\"bridge-test-request\"                                               \n                                   outboundQueueConnectionFactory=\"#remoteFactory\"                                                  \n                                                   localPassword=\"test2\"\n                                   localQueueConnectionFactory=\"#localFactory\"\n                                                   localUsername=\"test2\">\n                <inboundQueueBridges>\n                        <inboundQueueBridge\n                                  localQueueName=\"test.request\"\n                          inboundQueueName=\"queue:///SIT.TEST.REQ\" />\n                </inboundQueueBridges>\n        </jmsQueueConnector>\n\n        <jmsQueueConnector name=\"bridge-test-response\"\n                                   outboundQueueConnectionFactory=\"#remoteFactory\"\n                                                   localPassword=\"test4\"\n                                   localQueueConnectionFactory=\"#localFactory\"\n                                                   localUsername=\"test4\">\n                <outboundQueueBridges>\n                        <outboundQueueBridge\n                                  localQueueName=\"test.response\"\n                          outboundQueueName=\"queue:///SIT.TEST.RSP\" />\n                </outboundQueueBridges>\n        </jmsQueueConnector>\n\n\n<bean id=\"remoteFactory\"\n  class=\"com.ibm.mq.jms.MQQueueConnectionFactory\">\n  <property name=\"transportType\" value=\"1\" />\n  <property name=\"hostName\" value=\"127.0.0.1\" />\n  <property name=\"port\" value=\"9876\" />\n  <property name=\"queueManager\" value=\"QMUAT\" />\n  <property name=\"channel\" value=\"SIT.UAT.SVR\" />\n</bean>\n\nI hope this helps.\n\nThx,\nWilliam","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wrpkm","name":"wrpkm","key":"wrpkm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"William MacDonald","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-13T13:31:49.629+0000","updated":"2007-04-13T13:31:49.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938992","id":"12938992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"body":"Thanks, that really helped me a lot!\n\nI was now able to create a simple wrapper similar to yours and managed finally to make i all work.\nAm wrapping around the class com.stc.jms.client.STCQueueConnectionFactory (from JCAPS), and this must have hostname & port number in the constructor. Handled this by hard-coding these values in the wrapper so far, but would like to fetch these from properties as well, but don't  know how...?\nLike this:\n\npublic class connectionFactoryWrapper extends com.stc.jms.client.STCQueueConnectionFactory {\n\n    public connectionFactoryWrapper() throws JMSException\n    { \n        super(\"localhost\", 18007); \n    }\n....\n    \n\n\nThen the bridging works only one way, namely from AMQ to JCAPS. \nThe other way AMQ gets a ClassCastException upon receiving the message from the JCAPS queue:\n\nERROR DestinationBridge              - failed to forward message on attempt: 1 reason: java.lang.ClassCastException: org.apache.activemq.command.ActiveMQQueue message: com.stc.jms.message.STCTextMessage@1e22632 \njava.lang.ClassCastException: org.apache.activemq.command.ActiveMQQueue\n        at com.stc.jms.message.STCMessage.setJMSDestination(STCMessage.java:611)\n        at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1505)\n        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:465)\n        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:415)\n        at org.apache.activemq.ActiveMQQueueSender.send(ActiveMQQueueSender.java:116)\n        at org.apache.activemq.network.jms.QueueBridge.sendMessage(QueueBridge.java:87)\n        at org.apache.activemq.network.jms.DestinationBridge.onMessage(DestinationBridge.java:134)\n        at com.stc.jms.client.SessionImpl.processAsyncDataAvailable(SessionImpl.java:1659)\n        at com.stc.jms.client.SessionImpl.processAsync(SessionImpl.java:1748)\n        at com.stc.jms.client.SessionImpl.asyncEnter(SessionImpl.java:1776)\n        at com.stc.jms.client.SessionImpl.access$500(SessionImpl.java:56)\n        at com.stc.jms.client.SessionImpl$3.run(SessionImpl.java:1899)\n        at com.stc.jms.client.SessionImpl$2.run(SessionImpl.java:1807)\n        at java.lang.Thread.run(Thread.java:595)\n\n\nThe problem seems to be the STCTextMessage class, is it possible to handle this in some way?\n\n\nRegards\n-Alf","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-13T13:43:04.110+0000","updated":"2007-04-13T13:43:04.110+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12939004","id":"12939004","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"body":"I think you don't need to wrap  STCQueueConnectionFactory, as it provides a constructor with the required arguments, and spring is able to handle that directly. That is not the case for imq, that doesn't have such a constructor neither the required setters. It should be enough for you to use:\n\n<bean id=\"REMOTE\"\nclass=\"com.stc.jms.client.STCQueueConnectionFactory\">\n  <constructor-arg><value>localhost</value></constructor-arg>\n  <constructor-arg><value>18007</value></constructor-arg>\n</bean>\n\nAbout the error you get, it seems you're trying to handle directly a STC message implementation using AMQ. That's not the right way. The bridge should automatically convert incoming messages to the AMQ native types. You shouldn't need to use directly the STC nor AMQ Message classes, just ask for java.jmx.Message or javax.jms.TextMessage to your consumers. The AMQ broker will redirect incoming messages from the bridged foreign broker to your program, and they will internally be AMQ* types, but you shouln't need to be aware of that.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-16T12:57:03.371+0000","updated":"2007-04-16T12:57:03.371+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938995","id":"12938995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Manuel!\n\nI now got rid of the wrapper, the <constructor-arg> stuff worked out just fine!\n\nSo to the ClassCastException, it really comes from the ActiveMQ program itself, the moment I try to send a message into the queue on the JCAPS broker queue that is defined to be inboundQueueName, and the bridge tries to fetch it into AMQ.\nThe other way around messages (sendt to the outboundQueueName on AMQ) are bridged correctly over to JCAPS.\n\nThe consumer/provider programs are using javax.jms.TextMessage as contents. \nI have also tried to use the JMXConsole connected to AMQ for sending simple test messages.\n\nYou says that the bridge should automatically convert incoming messages to native AMQ - seems to me that that's where the error occurs ?\n\nBr\nAlf (with steep learning curve regarding ActiveMQ...)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-17T13:03:13.994+0000","updated":"2007-04-17T13:03:13.994+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938996","id":"12938996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"body":"Be careful with your jndi properties. Perhaps you're trying to connect directly to the JCAPS broker, and that's a mistake. AMQ should make that job for you: you only need to send the message to the local AMQ queue you're mapping to the remote bridge (and hence, use the proper jndi.properties to do so), and the broker will automatically forward the message to the foreign broker.\n\nYou can even try it using the AMQ JMX console, and try to send a message to the mapped queue, if you want to test it easily.\n\nHope it works.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-17T13:12:14.682+0000","updated":"2007-04-17T13:12:14.682+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12936575","id":"12936575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Manuel for your patient replies!\n\nI think I've been a bit unclear about this and how the problems I discover occurs. I'll try to clearify:\nI'm trying to bridge from AMQ to JCAPS, one queue as outbound, and one queue to be bridged the opposite direction, from JCAPS to AMQ (setting it up as AMQ inbound queue). Here is a snippet from the activemq.xml-file:\n\n<jmsBridgeConnectors>\n    <jmsQueueConnector\n      outboundQueueConnectionFactory=\"#remoteFactory\">\n      <inboundQueueBridges>\n        <inboundQueueBridge\n          inboundQueueName=\"quBridgeFromJCAPS\" />\n      </inboundQueueBridges>\n      <outboundQueueBridges>\n        <outboundQueueBridge\n          outboundQueueName=\"quBridgeToJCAPS\" />\n      </outboundQueueBridges>\n    </jmsQueueConnector>\n  </jmsBridgeConnectors>\n...\n  <bean id=\"remoteFactory\"\n     class=\"com.stc.jms.client.STCQueueConnectionFactory\">\n    <constructor-arg value=\"localhost\"/>\n    <constructor-arg value=\"18007\"/>\n  </bean>\n \n\nNow for tesing both the AMQ broker and the JCAPS broker is running on localhost.\n\nI've made simple \"clients\" to send messages to the local brokers, one for AMQ and one for JCAPS. They both send jmx.jms.TextMessages. Here is a snippet of the clients:\n\n    /**\n     * Put a message on a STC queue\n     * @author alfeh Mar 9, 2007\n     */\n    private void sendMsg() throws Exception {\n        QueueConnectionFactory qcf = new STCQueueConnectionFactory(\"localhost\", 18007);\n        conn = qcf.createQueueConnection();\n        conn.start();\n        QueueSession sess = conn.createQueueSession(true, Session.AUTO_ACKNOWLEDGE);\n        Queue q = sess.createQueue(\"quTest1\");\n        QueueSender sender = sess.createSender(q);\n        TextMessage msg = sess.createTextMessage(\"Hello to the world!!!\");\n        msg.getText();\n        sender.send(msg);\n        sess.commit();\n        System.out.println(\"Sendt message '\" + msg.getText() + \"'\");\n        sess.close();\n        conn.close();\n    }\n\n\n    /**\n     * Put a message on a AMQ queue\n     * @author alfeh Mar 9, 2007\n     */\n    private void sendMsg() throws Exception {\n        conn = ActiveMQConnection.makeConnection(\"tcp://localhost:62616\");\n        conn.start();\n        QueueSession sess = conn.createQueueSession(true, Session.AUTO_ACKNOWLEDGE);\n        Queue q = sess.createQueue(\"quBridgeToJCAPS\");\n        QueueSender sender = sess.createSender(q);\n        TextMessage msg = sess.createTextMessage(\"Hello to the world!!!\");\n        msg.getText();\n        sender.send(msg);\n        sess.commit();\n        System.out.println(\"Sendt message '\" + msg.getText() + \"'\");\n        sess.close();\n        conn.close();\n    }\n\n\nPretty simple and stright-forward I think, and seems to be working OK regarding posting the messages to the \"local\" brokers.\nIn addittion, I can send messages to the AMQ broker via the JMXConsole, and the JCAPS broker has its own WEB GUI (Enterprise Manager), and it can be used for sending and reading messages on that broker.\n\nWhen I fire it all up (first the JCAPS broker then the AMQ broker) it all seems OK.\nThe AMQ's inbound bridge queue (quBridgeFromJCAPS) is created inside the JCAPS broker upon first startup of AMQ.\n\nThe problem occurs after successfully posting a message onto that queue on the JCAPS broker.\nAMQ seems to try to bridge it into the AMQ's quBridgeFromJCAPS, causing the exception to be thrown from inside the AMQ code. No message arrives to the AMQ queue, but seems to be thrown back to the JCAPS queue (which ends up with two copies of that same message). The exception is shown in a previous post, and is thrown from line 1505 in class ActiveMQSession.\nHere is a snippet of that code:\n\n    /**\n     * Sends the message for dispatch by the broker.\n     * \n     * @param producer -\n     *            message producer.\n     * @param destination -\n     *            message destination.\n     * @param message -\n     *            message to be sent.\n     * @param deliveryMode -\n     *            JMS messsage delivery mode.\n     * @param priority -\n     *            message priority.\n     * @param timeToLive -\n     *            message expiration.\n     * @throws JMSException\n     */\n    protected void send(ActiveMQMessageProducer producer, ActiveMQDestination destination, Message message, int deliveryMode,\n            int priority, long timeToLive) throws JMSException {\n        checkClosed();\n\n        if( destination.isTemporary() && connection.isDeleted(destination) ) {\n            throw new JMSException(\"Cannot publish to a deleted Destination: \"+destination);\n        }\n\n        // tell the Broker we are about to start a new transaction\n        doStartTransaction();\n        TransactionId txid = transactionContext.getTransactionId();\n        \n        message.setJMSDestination(destination); // (###### This is line 1505, here is the exception thrown! ###)\n        message.setJMSDeliveryMode(deliveryMode);        \n        long expiration = 0L;\n\n        if (!producer.getDisableMessageTimestamp()) {\n            long timeStamp = System.currentTimeMillis();\n            message.setJMSTimestamp(timeStamp);\n            if (timeToLive > 0) {\n                expiration = timeToLive + timeStamp;\n            }\n        }\n.....\n\n\n\n\nIf I on the other hand try to send a message into the AMQ broker's outbound queue (quBridgeToJCAPS) (e.g with the JMXConsole) it imidiately shows up in the JCAPS broker (queue with the same name) and the contents seems OK.\n\nSee ? 50% success... would like to reach 100%...!\n\nAny ideas?\n\nBr\n-Alf\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-18T06:59:18.169+0000","updated":"2007-04-18T06:59:18.169+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12936683","id":"12936683","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"body":"It looks correct to me, both the code and the experiment.\n\nI'm afraid I don't know the reason, but I'm not activemq skilled. \n\nLooking at the exception stack, it seems that what activemq has is a JCAPS client running, listening for messages on that queue. When one of those messages arrive, it is redelivered to the activemq queue, and it seems that when it tries to do so, the message (of type com.stc.jms.message.STCTextMessage) does not accept to be set a destination of type org.apache.activemq.command.ActiveMQQueue in message.setJMSDestination(destination);\n\nI don't know if this should work, (i.e: a message should accept any  javax.jms.Destination regardless of its implementation) or perhaps the problem is that the JCAPS code is not aware of org.apache.activemq.command.ActiveMQQueue as a javax.jms.Destination implementation (some classpath issue?)\n\nPerhaps asking in the mail list ?\n\nBest regards\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mteira","name":"mteira","key":"mteira","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manuel Teira","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-18T07:40:22.949+0000","updated":"2007-04-18T07:40:22.949+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12938908","id":"12938908","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"body":"Seems that you're all right Manuel.\n\nIt is not possible to read a message from JCAPS (type com.stc.jms.message.STCTextMessage) and send it to a AMQ queue. \nThe opposite direction is no problem.\n\nI've tried to do the same outside the AMQ bridge (in a simple Java application) (reading from an JCAPS queue and posting the same message to a AMQ queue), and the same exception occurs.\n\nMight be some non-JMS-standard behaviour of the JCAPS messages?\n\nI've been able to kind of \"go around\" the problem in my Java app, by creating a new (native AMQ) message and copy all the values & settings from the JCAPS message. \nBut that is not the preferred way to go...\n\nThanks again for help & advices!\n\n\n\nBR\n-Alf","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehelseth","name":"ehelseth","key":"ehelseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alf E. Helseth","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-18T13:02:00.049+0000","updated":"2007-04-18T13:02:00.049+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12939051","id":"12939051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngzax","name":"ngzax","key":"ngzax","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryl Richter","active":true,"timeZone":"Etc/UTC"},"body":"I have just tested this patch on my ActiveMQ-5.0-SNAPSHOT, rev 554694 broker bridged to SonicMQ 7.5 and it does NOT work.\n\nIt does try to reconnect 10 times, but they all fail.\n\nI am working on it a bit more.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngzax","name":"ngzax","key":"ngzax","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryl Richter","active":true,"timeZone":"Etc/UTC"},"created":"2007-09-17T20:44:08.335+0000","updated":"2007-09-17T20:44:44.699+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12939646","id":"12939646","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsilva","name":"jsilva","key":"jsilva","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Silva","active":true,"timeZone":"Etc/UTC"},"body":"the attached patch has a slight error\n\nwhile (maximumRetries > 0 && attempt >= maximumRetries);\n\nshould be\n\nwhile (maximumRetries > 0 && attempt <= maximumRetries);\n\ncorrect?  \n\nEven with this change, you can see the number of retries increment, but the producer does not begin sending.  I have also tried the patch in the comments of AMQ-1220 and this actually does reconnect the bridge (no more connection failures) but the producer fails to send the messages which are enqueued during the time the foreign connection is down.  \n\nThe exception in 4.1.1 is:\n\njavax.jms.IllegalStateException: The producer is closed\n        at org.apache.activemq.ActiveMQMessageProducer.checkClosed(ActiveMQMessa\ngeProducer.java:333)\n        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProdu\ncer.java:445)\n        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProdu\ncer.java:415)\n        at org.apache.activemq.ActiveMQQueueSender.send(ActiveMQQueueSender.java\n:116)\n        at org.apache.activemq.network.jms.QueueBridge.sendMessage(QueueBridge.j\nava:87)\n        at org.apache.activemq.network.jms.DestinationBridge.onMessage(Destinati\nonBridge.java:134)\n        at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageC\nonsumer.java:854)\n        at org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionE\nxecutor.java:99)\n        at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionEx\necutor.java:166)\n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskR\nunner.java:101)\n        at org.apache.activemq.thread.DedicatedTaskRunner.access$000(DedicatedTa\nskRunner.java:25)\n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRun\nner.java:39)\n\nMy foreign queue is using https if that makes a difference.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsilva","name":"jsilva","key":"jsilva","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Silva","active":true,"timeZone":"Etc/UTC"},"created":"2008-05-01T23:36:41.490+0000","updated":"2008-05-01T23:45:34.744+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12939672","id":"12939672","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsilva","name":"jsilva","key":"jsilva","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Silva","active":true,"timeZone":"Etc/UTC"},"body":"This problem was solved without code changes by using the failover transport on the remote queue factory in 4.1.1, if anyone is looking for a workaround.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsilva","name":"jsilva","key":"jsilva","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Silva","active":true,"timeZone":"Etc/UTC"},"created":"2008-05-12T17:38:58.974+0000","updated":"2008-05-12T17:38:58.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12942243","id":"12942243","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jschmied","name":"jschmied","key":"jschmied","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34055","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"},"displayName":"juergen schmied","active":true,"timeZone":"Etc/UTC"},"body":"See Patch at:\nhttps://issues.apache.org/activemq/browse/AMQ-2455\n\nI can reconnect to a Oracle AQ Session now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jschmied","name":"jschmied","key":"jschmied","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34055","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"},"displayName":"juergen schmied","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-20T22:18:34.687+0000","updated":"2010-02-20T22:18:34.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483417/comment/12942536","id":"12942536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"https://issues.apache.org/activemq/browse/AMQ-2455","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-28T13:59:28.854+0000","updated":"2010-04-28T13:59:28.854+0000"}],"maxResults":22,"total":22,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-895/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rpzr:"}}