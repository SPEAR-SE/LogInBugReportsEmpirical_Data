{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482772","self":"https://issues.apache.org/jira/rest/api/2/issue/12482772","key":"AMQ-1730","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-06-17T12:39:35.456+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 09 13:35:09 UTC 2015","customfield_12310420":"84606","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_22458194090_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-01-30T12:02:51.646+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1730/watchers","watchCount":5,"isWatching":false},"created":"2008-05-15T13:39:37.556+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[{"id":"12334999","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334999","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12482796","key":"AMQ-1800","self":"https://issues.apache.org/jira/rest/api/2/issue/12482796","fields":{"summary":"Redilivery counter increase incredible","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12404951","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12404951","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12766016","key":"AMQ-5513","self":"https://issues.apache.org/jira/rest/api/2/issue/12766016","fields":{"summary":"redelivery count incremented in error for unconsumed prefetched messages","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-01-09T13:35:21.983+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"JMSXDeliveryCount  has to be incremented only on transactional delivery failure ( RuntimeException on processing message, ... ).\n\nJMSXDeliveryCount  is actualy used in correlation with Message.java field: 'redeliveryCounter'.\n\nBut RedeliveryCounter  field is used to be incremented each time the message is preteched or sent to a consumer => It does not mean that message has been processed by business in transaction with a failure. It just has been prefetched by consumer ou subscriber. \nA 'not consumed message' can be give back to the broker when the consumer is closed by user, because it has been prefetched but not really consumed!\n\nIt does not match the meaning of the JMS field JMSXDeliveryCount  :\n\"If a failure occurs within transactional processing then the JMSXDeliveryCount is incremented\".\n\n\nJMSXDeliveryCount  field only has to be incremented on rollback (isn't it? ). This is why Message.redeliveryCount can not be used. Or the behavour of field Message.redeliveryCount has to be changed.\n\nYou can either :\n* create a new counter on message incremented only on rollback, or\n* modify classes : PrefetchSubscription.java and Queue.java to remove redeliveryCount increment and increment it only on rollback.\n\n\n* PrefetchSubscription.java:\n\n                    if (inAckRange) {\n//                        node.incrementRedeliveryCounter();\n                        if (ack.getLastMessageId().equals(messageId)) {\n                            destination = node.getRegionDestination();\n                            callDispatchMatched = true;\n                            break;\n                        }\n                    }\n\n\n\n* Queue.java:\n\n                for (MessageReference ref : sub.remove(context, this)) {\n                    QueueMessageReference qmr = (QueueMessageReference)ref;\n//                    qmr.incrementRedeliveryCounter();\n                    if( qmr.getLockOwner()==sub ) {\n                        qmr.unlock();\n//                        if (!qmr.isDropped() && !qmr.isAcked()) {\n//                        \tqmr.incrementRedeliveryCounter();\n//                        }\n                    }\n                    list.add(qmr);\n                }\n\n\nBTW, In this code it seems there is a second bug, in case of  test \"qmr.getLockOwner()==sub\" is true qmr is incremented a second time ?! Is it right ?\n\n\n\nThe result of this problem is the following: \n\nWith Spring and DefaultMessageListenerContainer, a message is consumed one by one. This is why a message prefteched many times, on first real consuming has a JMSXDeliveryCount  with high value not reflecting the reality.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161832","customfield_12312823":null,"summary":"Bad use of Jms field JMSXDeliveryCount. Related to RedeliveryCount and message prefetch ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexiskinsella","name":"alexiskinsella","key":"alexiskinsella","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexis Kinsella","active":true,"timeZone":"Europe/Berlin"},"subtasks":[{"id":"12482763","key":"AMQ-2087","self":"https://issues.apache.org/jira/rest/api/2/issue/12482763","fields":{"summary":"Redelivery after rollback does not seem to work well ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexiskinsella","name":"alexiskinsella","key":"alexiskinsella","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexis Kinsella","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482772/comment/12939706","id":"12939706","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexiskinsella","name":"alexiskinsella","key":"alexiskinsella","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexis Kinsella","active":true,"timeZone":"Europe/Berlin"},"body":"It is hard to guess how to correct the fact that undelivered messages prefetched should not have their JMSXDeliveryCount  incremented.\n\nI finally corrected it as a workaround (I also have to let prefetch on queues at 0):\n\n\n    *  PrefetchSubscription.java: (Finally not corrected)\n\nif (inAckRange) {\n node.incrementRedeliveryCounter();\nif (ack.getLastMessageId().equals(messageId)) { destination = node.getRegionDestination(); callDispatchMatched = true; break; }\n}\n\n    * Queue.java: (Finally only first increment commented)\n\nfor (MessageReference ref : sub.remove(context, this)) {\nQueueMessageReference qmr = (QueueMessageReference)ref;\nqmr.incrementRedeliveryCounter();\nif( qmr.getLockOwner()==sub ) {\nqmr.unlock();\n// if (!qmr.isDropped() && !qmr.isAcked()) {\n// qmr.incrementRedeliveryCounter();\n// }\n}\nlist.add(qmr);\n}\n\nDefinitely it seems their is a need for 2 counters:\n* one to count delivery to consumers (messages consumed or not by the consumer)\n* one for the JMXDeliveryCount incremented only on rollback\n\nJMXDeliveryCount  should not be affected by the value of the prefetch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexiskinsella","name":"alexiskinsella","key":"alexiskinsella","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexis Kinsella","active":true,"timeZone":"Europe/Berlin"},"created":"2008-05-22T06:43:29.713+0000","updated":"2008-05-22T06:43:29.713+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482772/comment/12939821","id":"12939821","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"body":"I have the same problem AMQ-1800\nBut I think redeliveryCounter has to be incremented on rollback only also","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"created":"2008-06-17T12:39:35.456+0000","updated":"2008-06-17T12:40:36.224+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482772/comment/12939896","id":"12939896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"body":"I've investigated the problem and I thnink the problem is absence of command like RollabckCommand which could increment redelivery counter on server. \n\nIt think it should be added something like RollbackCommand and session.sendRollback(rollbackCommand) as like as sesssion.sendAck(ack)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"created":"2008-07-03T07:09:10.961+0000","updated":"2008-07-03T07:10:36.590+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482772/comment/12939910","id":"12939910","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"body":"I was wrong. REDELIVERED_ACK_TYPE is what i ment\nI commented qmr.incrementRedeliveryCounter(); both in Queue and now it's Ok for me\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"created":"2008-07-03T13:48:37.496+0000","updated":"2008-10-15T12:27:37.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482772/comment/12940458","id":"12940458","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"On the meaning of JMSXDeliveryCount, note that the semantics of redelivery indicators in JMS are not absolute. They are in indication only that redelivery may have occurred or that a transaction rolledback. \nThe fact that redispatch of prefetched messages on subscription close, increments the redelivery count, is reasonable w.r.t the spec. The extent of this can be managed by the prefetch value for the subscription.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-07T16:30:44.351+0000","updated":"2008-11-07T16:30:44.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482772/comment/12940728","id":"12940728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"The fix for https://issues.apache.org/activemq/browse/AMQ-2087 is relevant here. prefetched messages no longer get their redelivery incremented once the consumer or session is successfully closed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-30T10:56:19.278+0000","updated":"2009-01-30T10:56:19.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482772/comment/12940710","id":"12940710","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"resolved with r739249\nThe fix targets redeliveryCount and ensures that it is not incremented on prefetched messages that have not been delivered to the consumer. The JMSXDeliveredCount is always 1+ the redeliveryCount. \nPlease validate your use case against the tests that were modified with r739249, They are visible in the subversion commits tab.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-30T12:02:51.633+0000","updated":"2009-01-30T12:02:51.633+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482772/comment/14249853","id":"14249853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=syberyan","name":"syberyan","key":"syberyan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Tytgat","active":true,"timeZone":"Europe/Berlin"},"body":"Is this supposed to be fixed for topics as well as queues? (ActiveMQ 5.10.0)\nThe reason I ask is that we're running into this problem with a durable topic subscription. The application uses a transacted camel route without CACHE_CONSUMER, so from what I understand, the session gets closed after each receive and all prefetched messages (100 by default) get redispatched by the broker. The broker however is increasing redelivery count and we see lots of messages ending up in the DLQ.\nedit: by looking at the implementations of Destination.removeSubscription(ConnectionContext context, Subscription sub, long lastDeliveredSequenceId), it seems that the lastDeliveredSequenceId parameter is only used for queues...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=syberyan","name":"syberyan","key":"syberyan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Tytgat","active":true,"timeZone":"Europe/Berlin"},"created":"2014-12-17T13:50:11.844+0000","updated":"2014-12-17T14:07:07.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482772/comment/14271009","id":"14271009","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"[~syberyan] - that was ignored for durable subs - a workaround would be setting keepDurableSubsActive to false. (I think)\nI just fixed that up via https://issues.apache.org/jira/browse/AMQ-5513 which will make 5.11\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-09T13:35:09.921+0000","updated":"2015-01-09T13:35:21.975+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1730/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s273:"}}