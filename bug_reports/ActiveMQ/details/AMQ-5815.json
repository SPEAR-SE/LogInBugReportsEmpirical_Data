{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12834219","self":"https://issues.apache.org/jira/rest/api/2/issue/12834219","key":"AMQ-5815","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338054","id":"12338054","name":"5.15.0","archived":false,"released":true,"releaseDate":"2017-07-05"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-05-16T10:52:33.973+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Aug 15 10:41:36 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_38096422825_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-08-15T10:41:35.001+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5815/watchers","watchCount":5,"isWatching":false},"created":"2015-06-01T12:21:13.721+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":604800,"aggregatetimeoriginalestimate":604800,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[{"id":"12477586","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12477586","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12483236","key":"AMQ-2594","self":"https://issues.apache.org/jira/rest/api/2/issue/12483236","fields":{"summary":"Make JDBC store resilient on broker sequence id order","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-08-15T10:41:36.417+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":604800,"customfield_12310080":null,"description":"When the concurrency is in high level, iops more than 3000/s, we find that most of the amq connections are blocked.We can't either get or push any data through them unless restart.This issue appears *frequency*.\n\nThere is many IOExceptions in the amq logs.\n\n{code}\n2015-05-28 00:37:08,544 | ERROR | Checkpoint failed | org.apache.activemq.store.kahadb.MessageDatabase | ActiveMQ Journal Checkpoint Worker\njava.io.IOException: Input/output error\n        at java.io.RandomAccessFile.write(Native Method)[:1.6.0_30]\n        at java.io.RandomAccessFile.writeLong(RandomAccessFile.java:1001)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.writeLong(RecoverableRandomAccessFile.java:305)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.PageFile.writeBatch(PageFile.java:1062)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.PageFile.flush(PageFile.java:516)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1512)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase$17.execute(MessageDatabase.java:1484)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1481)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:929)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:357)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n2015-05-28 00:37:08,547 | INFO  | Ignoring IO exception, java.io.IOException: Input/output error | org.apache.activemq.util.DefaultIOExceptionHandler | ActiveMQ Journal Checkpoint Worker\njava.io.IOException: Input/output error\n        at java.io.RandomAccessFile.write(Native Method)[:1.6.0_30]\n        at java.io.RandomAccessFile.writeLong(RandomAccessFile.java:1001)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.writeLong(RecoverableRandomAccessFile.java:305)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.PageFile.writeBatch(PageFile.java:1062)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.PageFile.flush(PageFile.java:516)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1512)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase$17.execute(MessageDatabase.java:1484)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1481)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:929)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:357)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n2015-05-28 00:37:08,580 | INFO  | KahaDB: Recovering checkpoint thread after death | org.apache.activemq.store.kahadb.MessageDatabase | ActiveMQ Transport: tcp:///10.40.50.31:58171@61616\n2015-05-28 00:37:17,285 | INFO  | Journal failed while writing at: 2359276 | org.apache.activemq.store.kahadb.disk.journal.DataFileAppender | ActiveMQ Data File Writer\n2015-05-28 00:37:17,287 | ERROR | KahaDB failed to store to Journal | org.apache.activemq.store.kahadb.MessageDatabase | ActiveMQ Transport: tcp:///10.40.50.17:4487@61616\njava.io.IOException: Input/output error\n        at sun.nio.ch.FileChannelImpl.force0(Native Method)[:1.6.0_30]\n        at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:348)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.sync(RecoverableRandomAccessFile.java:402)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender.processQueue(DataFileAppender.java:373)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender$1.run(DataFileAppender.java:193)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n2015-05-28 00:37:17,291 | ERROR | KahaDB failed to store to Journal | org.apache.activemq.store.kahadb.MessageDatabase | ActiveMQ Transport: tcp:///10.40.50.17:4442@61616\njava.io.IOException: Input/output error\n        at sun.nio.ch.FileChannelImpl.force0(Native Method)[:1.6.0_30]\n        at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:348)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.sync(RecoverableRandomAccessFile.java:402)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender.processQueue(DataFileAppender.java:373)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender$1.run(DataFileAppender.java:193)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n2015-05-28 00:37:17,293 | INFO  | Ignoring IO exception, java.io.IOException: Input/output error | org.apache.activemq.util.DefaultIOExceptionHandler | ActiveMQ Transport: tcp:///10.40.50.17:4442@61616\njava.io.IOException: Input/output error\n        at sun.nio.ch.FileChannelImpl.force0(Native Method)[:1.6.0_30]\n        at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:348)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.sync(RecoverableRandomAccessFile.java:402)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender.processQueue(DataFileAppender.java:373)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender$1.run(DataFileAppender.java:193)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n{code}\n\n\nWith the aid of jstack ,we find dead lock(How can I upload the whole jtack log?)\nThe blocked connections are all waiting for 0x00007f90500034e0\n{code}\n[01:08:01] \"ActiveMQ Transport: tcp:///10.40.50.17:4479@61616\" daemon prio=10 tid=0x00007f8f8c015000 nid=0x2ece waiting for monitor entry [0x00007f8f1f6e4000]\n[01:08:01]    java.lang.Thread.State: BLOCKED (on object monitor)\n[01:08:01]         at org.apache.activemq.transaction.LocalTransaction.rollback(LocalTransaction.java:94)\n[01:08:01]         - waiting to lock <0x00007f90500034e0> (a org.apache.activemq.store.kahadb.KahaDBTransactionStore)\n[01:08:01]         at org.apache.activemq.transaction.LocalTransaction.commit(LocalTransaction.java:74)\n[01:08:01]         at org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:253)\n[01:08:01]         at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:112)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection.processCommitTransactionOnePhase(TransportConnection.java:453)\n[01:08:01]         at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:100)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:148)\n[01:08:01]         at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n[01:08:01]         at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n[01:08:01]         at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n[01:08:01]         at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n[01:08:01]         at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n[01:08:01]         at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n[01:08:01]         at java.lang.Thread.run(Thread.java:662)\n{code}\n\nOnly one connection(Thread) get this lock.But it is waiting for another Read lock 0x00007f90530ed8d8\n{code}\n[01:08:01] \"ActiveMQ Transport: tcp:///10.40.50.17:4484@61616\" daemon prio=10 tid=0x00007f8fa8039800 nid=0x2ed2 waiting on condition [0x00007f8f1f2e0000]\n[01:08:01]    java.lang.Thread.State: WAITING (parking)\n[01:08:01]         at sun.misc.Unsafe.park(Native Method)\n[01:08:01]         - parking to wait for  <0x00007f90530ed8d8> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n[01:08:01]         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)\n[01:08:01]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n[01:08:01]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireShared(AbstractQueuedSynchronizer.java:941)\n[01:08:01]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(AbstractQueuedSynchronizer.java:1261)\n[01:08:01]         at java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(ReentrantReadWriteLock.java:594)\n[01:08:01]         at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:972)\n[01:08:01]         at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:958)\n[01:08:01]         at org.apache.activemq.store.kahadb.KahaDBTransactionStore.rollback(KahaDBTransactionStore.java:312)\n[01:08:01]         at org.apache.activemq.transaction.LocalTransaction.rollback(LocalTransaction.java:94)\n[01:08:01]         - locked <0x00007f90500034e0> (a org.apache.activemq.store.kahadb.KahaDBTransactionStore)\n[01:08:01]         at org.apache.activemq.transaction.LocalTransaction.commit(LocalTransaction.java:74)\n[01:08:01]         at org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:253)\n[01:08:01]         at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:112)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection.processCommitTransactionOnePhase(TransportConnection.java:453)\n[01:08:01]         at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:100)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:148)\n[01:08:01]         at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n[01:08:01]         at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n[01:08:01]         at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n[01:08:01]         at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n[01:08:01]         at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n[01:08:01]         at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n[01:08:01]         at java.lang.Thread.run(Thread.java:662)\n{code}\n\nAt last we find 0x00007f90530ed8d8 is in many write lock waiting.But none write lock hodes it. The dead lock occurs.\n{code}\n[01:07:56] \"ActiveMQ Transport: tcp:///10.40.50.47:60701@61616\" daemon prio=10 tid=0x00007f8f7cbc5000 nid=0x3ec8 waiting on condition [0x00007f900d864000]\n[01:07:56]    java.lang.Thread.State: WAITING (parking)\n[01:07:56]         at sun.misc.Unsafe.park(Native Method)\n[01:07:56]         - parking to wait for  <0x00007f90530ed8d8> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n[01:07:56]         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)\n[01:07:56]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n[01:07:56]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireShared(AbstractQueuedSynchronizer.java:941)\n[01:07:56]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(AbstractQueuedSynchronizer.java:1261)\n[01:07:56]         at java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(ReentrantReadWriteLock.java:594)\n[01:07:56]         at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:972)\n[01:07:56]         at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:958)\n[01:07:56]         at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.removeMessage(KahaDBStore.java:453)\n[01:07:56]         at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.removeAsyncMessage(KahaDBStore.java:407)\n[01:07:56]         at org.apache.activemq.store.kahadb.KahaDBTransactionStore.removeAsyncMessage(KahaDBTransactionStore.java:498)\n[01:07:56]         at org.apache.activemq.store.kahadb.KahaDBTransactionStore$1.removeAsyncMessage(KahaDBTransactionStore.java:185)\n[01:07:56]         at org.apache.activemq.broker.region.Queue.acknowledge(Queue.java:998)\n[01:07:56]         at org.apache.activemq.broker.region.Queue.removeMessage(Queue.java:1781)\n[01:07:56]         at org.apache.activemq.broker.region.QueueSubscription.acknowledge(QueueSubscription.java:63)\n[01:07:56]         at org.apache.activemq.broker.region.PrefetchSubscription.acknowledge(PrefetchSubscription.java:235)\n[01:07:56]         - locked <0x00007f905d10b1e8> (a java.lang.Object)\n[01:07:56]         at org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:446)\n[01:07:56]         at org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:461)\n[01:07:56]         at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:82)\n[01:07:56]         at org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:277)\n[01:07:56]         at org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:92)\n[01:07:56]         at org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:505)\n[01:07:56]         at org.apache.activemq.command.MessageAck.visit(MessageAck.java:245)\n[01:07:56]         at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n[01:07:56]         at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:148)\n[01:07:56]         at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n[01:07:56]         at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n[01:07:56]         at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n[01:07:56]         at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n[01:07:56]         at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n[01:07:56]         at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n[01:07:56]         at java.lang.Thread.run(Thread.java:662)\n{code}\n\nIn my opinion, IOExceptions may lead to losing persisten messages and so on ,but the broker shouldn't stop service.","customfield_10010":null,"timetracking":{"originalEstimate":"168h","remainingEstimate":"168h","originalEstimateSeconds":604800,"remainingEstimateSeconds":604800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":604800,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Frequency IOException cast dead lock while using kahadb in high concurrency environment","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bopbopbaby","name":"bopbopbaby","key":"bopbopbaby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bopbopbaby","name":"bopbopbaby","key":"bopbopbaby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":604800,"percent":0},"customfield_12311024":null,"environment":"Master/Slave AMQ + kahadb(NAS using NFS)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10431","value":"Important","id":"10431"}],"progress":{"progress":0,"total":604800,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12834219/comment/15284379","id":"15284379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=irodionov","name":"irodionov","key":"irodionov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"irodionov","active":true,"timeZone":"Etc/UTC"},"body":"We had similar issue with KahaDB. AMQ version is 5.12.1.\nSometimes IOException occurs (we use windows net drive and we had slow disk on our VM and a lot of persistent messages) which blocks the broker.\n\nKahaDB property enableIndexWriteAsync is setted to TRUE. In case of IOException \"KahaDB Page Writer\" thread dies so it blocks \"\"ActiveMQ Journal Checkpoint Worker\" thread which waits for CountDownLatch (in PageFile.flush) which will never countDown.\n\nFull thread dump:\n{code}\n2016-05-12 06:56:44\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (25.60-b23 mixed mode):\n\n\"ActiveMQ BrokerService[dcrd] Task-135\" #464 daemon prio=5 os_prio=0 tid=0x0000000020a6e000 nid=0xfe8 waiting on condition [0x000000004e5ae000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x0000000081dc1450> (a java.util.concurrent.SynchronousQueue$TransferStack)\n\tat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)\n\tat java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)\n\tat java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)\n\tat java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)\n\tat java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1066)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"ActiveMQ VMTransport: vm://localhost#1-20\" #428 daemon prio=5 os_prio=0 tid=0x0000000020a66800 nid=0xce4 waiting on condition [0x000000005314d000]\n   java.lang.Thread.State: WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x0000000081e52c50> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireShared(AbstractQueuedSynchronizer.java:967)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(AbstractQueuedSynchronizer.java:1283)\n\tat java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(ReentrantReadWriteLock.java:727)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:994)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:980)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.removeMessage(KahaDBStore.java:482)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.removeAsyncMessage(KahaDBStore.java:417)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore.removeAsyncMessage(KahaDBTransactionStore.java:506)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore$1.removeAsyncMessage(KahaDBTransactionStore.java:184)\n\tat org.apache.activemq.broker.region.Queue.acknowledge(Queue.java:915)\n\tat org.apache.activemq.broker.region.Queue.removeMessage(Queue.java:1719)\n\tat org.apache.activemq.broker.region.QueueSubscription.acknowledge(QueueSubscription.java:55)\n\tat org.apache.activemq.broker.region.PrefetchSubscription.acknowledge(PrefetchSubscription.java:234)\n\t- locked <0x0000000081e60f08> (a java.lang.Object)\n\tat org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:526)\n\tat org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:484)\n\tat org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:87)\n\tat org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:87)\n\tat org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:276)\n\tat org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:97)\n\tat org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:555)\n\tat org.apache.activemq.command.MessageAck.visit(MessageAck.java:245)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:338)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)\n\tat org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:270)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:133)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:48)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- <0x00000000def1aa98> (a java.util.concurrent.ThreadPoolExecutor$Worker)\n\n\"ActiveMQ InactivityMonitor WriteCheckTimer\" #427 daemon prio=5 os_prio=0 tid=0x0000000020a6f800 nid=0x1918 in Object.wait() [0x0000000052a1f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.util.TimerThread.mainLoop(Timer.java:552)\n\t- locked <0x00000000da73e8d8> (a java.util.TaskQueue)\n\tat java.util.TimerThread.run(Timer.java:505)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"ActiveMQ Transport: ssl:///127.0.0.1:60001\" #425 daemon prio=5 os_prio=0 tid=0x0000000020a6d000 nid=0x9b4 waiting on condition [0x000000002016e000]\n   java.lang.Thread.State: WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x0000000081e52c50> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireShared(AbstractQueuedSynchronizer.java:967)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(AbstractQueuedSynchronizer.java:1283)\n\tat java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(ReentrantReadWriteLock.java:727)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:994)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:980)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.addMessage(KahaDBStore.java:434)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore.asyncAddQueueMessage(KahaDBTransactionStore.java:405)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore$1.asyncAddQueueMessage(KahaDBTransactionStore.java:174)\n\tat org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:831)\n\tat org.apache.activemq.broker.region.Queue.send(Queue.java:724)\n\tat org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:503)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:468)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:297)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:152)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:293)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:157)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:546)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:768)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:338)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:300)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.SslTransport.doConsume(SslTransport.java:102)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- <0x0000000081e5a148> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n\n\"ActiveMQ InactivityMonitor ReadCheckTimer\" #424 daemon prio=5 os_prio=0 tid=0x0000000020a68800 nid=0xab0 in Object.wait() [0x000000001c60e000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.util.TimerThread.mainLoop(Timer.java:552)\n\t- locked <0x00000000d930c2c0> (a java.util.TaskQueue)\n\tat java.util.TimerThread.run(Timer.java:505)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"ActiveMQ InactivityMonitor Worker\" #382 daemon prio=5 os_prio=0 tid=0x000000001dae3800 nid=0xe70 waiting on condition [0x0000000052b1e000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x00000000825203f0> (a java.util.concurrent.SynchronousQueue$TransferStack)\n\tat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)\n\tat java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)\n\tat java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)\n\tat java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)\n\tat java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1066)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"105542689@qtp-1219161283-10\" #181 prio=5 os_prio=0 tid=0x000000001dae1000 nid=0x1720 in Object.wait() [0x000000004fb4e000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:626)\n\t- locked <0x0000000082aea590> (a org.mortbay.thread.QueuedThreadPool$PoolThread)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"MultiThreadedHttpConnectionManager cleanup\" #180 daemon prio=5 os_prio=0 tid=0x000000001dadd800 nid=0x221c in Object.wait() [0x000000004fa4e000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)\n\t- locked <0x0000000082af2600> (a java.lang.ref.ReferenceQueue$Lock)\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)\n\tat org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$ReferenceQueueThread.run(MultiThreadedHttpConnectionManager.java:1122)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"ActiveMQ BrokerService.worker.1\" #81 daemon prio=5 os_prio=0 tid=0x0000000020a6a000 nid=0x1308 waiting on condition [0x000000002006e000]\n   java.lang.Thread.State: WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x0000000081e561f8> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)\n\tat java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)\n\tat java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"RMI TCP Connection(4)-127.0.0.1\" #70 daemon prio=5 os_prio=0 tid=0x0000000020a6b800 nid=0x1074 runnable [0x000000004f16e000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.SocketInputStream.socketRead0(Native Method)\n\tat java.net.SocketInputStream.socketRead(SocketInputStream.java:116)\n\tat java.net.SocketInputStream.read(SocketInputStream.java:170)\n\tat java.net.SocketInputStream.read(SocketInputStream.java:141)\n\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:246)\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:265)\n\t- locked <0x0000000082178a50> (a java.io.BufferedInputStream)\n\tat java.io.DataInputStream.readInt(DataInputStream.java:387)\n\tat sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:722)\n\tat sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$256(TCPTransport.java:683)\n\tat sun.rmi.transport.tcp.TCPTransport$ConnectionHandler$$Lambda$1/711930559.run(Unknown Source)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- <0x0000000081e756a0> (a java.util.concurrent.ThreadPoolExecutor$Worker)\n\n\"DestroyJavaVM\" #68 prio=5 os_prio=0 tid=0x0000000020a69800 nid=0x111c waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Timer-3\" #67 daemon prio=5 os_prio=0 tid=0x0000000020a68000 nid=0x924 in Object.wait() [0x000000004f06f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.util.TimerThread.mainLoop(Timer.java:552)\n\t- locked <0x0000000081f48498> (a java.util.TaskQueue)\n\tat java.util.TimerThread.run(Timer.java:505)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Zabbix-agent\" #66 daemon prio=5 os_prio=0 tid=0x0000000020a65800 nid=0xad4 runnable [0x000000004ef6e000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.DualStackPlainSocketImpl.accept0(Native Method)\n\tat java.net.DualStackPlainSocketImpl.socketAccept(DualStackPlainSocketImpl.java:131)\n\tat java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:199)\n\t- locked <0x0000000081e8f2c0> (a java.net.SocksSocketImpl)\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:545)\n\tat java.net.ServerSocket.accept(ServerSocket.java:513)\n\tat org.kjkoster.zapcat.zabbix.ZabbixAgent.run(ZabbixAgent.java:171)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Timer-2\" #65 daemon prio=5 os_prio=0 tid=0x0000000021020000 nid=0xd94 in Object.wait() [0x000000004e4af000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.util.TimerThread.mainLoop(Timer.java:552)\n\t- locked <0x0000000081e95b30> (a java.util.TaskQueue)\n\tat java.util.TimerThread.run(Timer.java:505)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"pool-8-thread-1\" #58 prio=5 os_prio=0 tid=0x0000000021019800 nid=0x23b4 waiting on condition [0x000000004e1ae000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x0000000081e66cd0> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n\tat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1093)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:809)\n\tat java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Thread-19\" #57 prio=5 os_prio=0 tid=0x000000002101c800 nid=0xf7c runnable [0x000000004e0af000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.DualStackPlainSocketImpl.accept0(Native Method)\n\tat java.net.DualStackPlainSocketImpl.socketAccept(DualStackPlainSocketImpl.java:131)\n\tat java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:199)\n\t- locked <0x0000000081e4bb78> (a java.net.SocksSocketImpl)\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:545)\n\tat java.net.ServerSocket.accept(ServerSocket.java:513)\n\tat com.sun.jmx.remote.socket.SocketConnectionServer.accept(SocketConnectionServer.java:173)\n\tat com.sun.jmx.remote.generic.SynchroMessageConnectionServerImpl.accept(SynchroMessageConnectionServerImpl.java:47)\n\tat javax.management.remote.generic.GenericConnectorServer$Receiver.run(GenericConnectorServer.java:340)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Timer-1\" #56 daemon prio=5 os_prio=0 tid=0x000000001d157800 nid=0xccc in Object.wait() [0x000000004dfaf000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.lang.Object.wait(Object.java:502)\n\tat java.util.TimerThread.mainLoop(Timer.java:526)\n\t- locked <0x0000000081e17ce8> (a java.util.TaskQueue)\n\tat java.util.TimerThread.run(Timer.java:505)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"ActiveMQ Transport Server: ssl://0.0.0.0:13701?needClientAuth=true&keepAlive=true\" #55 daemon prio=9 os_prio=2 tid=0x000000001d156800 nid=0x1b08 runnable [0x000000004dcae000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.DualStackPlainSocketImpl.waitForNewConnection(Native Method)\n\tat java.net.DualStackPlainSocketImpl.socketAccept(DualStackPlainSocketImpl.java:135)\n\tat java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:199)\n\t- locked <0x0000000081e204f8> (a java.net.SocksSocketImpl)\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:545)\n\tat sun.security.ssl.SSLServerSocketImpl.accept(SSLServerSocketImpl.java:348)\n\tat org.apache.activemq.transport.tcp.TcpTransportServer.run(TcpTransportServer.java:350)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"ActiveMQ Transport Server Thread Handler: ssl://0.0.0.0:13701?needClientAuth=true&keepAlive=true\" #54 daemon prio=8 os_prio=1 tid=0x000000001d14e800 nid=0x2114 waiting on condition [0x000000004dbae000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x0000000081e3dcf8> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n\tat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)\n\tat java.util.concurrent.LinkedBlockingQueue.poll(LinkedBlockingQueue.java:467)\n\tat org.apache.activemq.transport.tcp.TcpTransportServer$2.run(TcpTransportServer.java:427)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"ActiveMQ Data File Writer\" #51 daemon prio=10 os_prio=2 tid=0x000000001d159800 nid=0xf94 in Object.wait() [0x000000004d8af000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.lang.Object.wait(Object.java:502)\n\tat org.apache.activemq.store.kahadb.disk.journal.DataFileAppender.processQueue(DataFileAppender.java:306)\n\t- locked <0x0000000081e4d9c0> (a java.lang.Object)\n\tat org.apache.activemq.store.kahadb.disk.journal.DataFileAppender$1.run(DataFileAppender.java:193)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"ActiveMQ Journal Checkpoint Worker\" #50 daemon prio=5 os_prio=0 tid=0x000000001d158000 nid=0x3ec waiting on condition [0x000000004d7ae000]\n   java.lang.Thread.State: WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x00000000f847d368> (a java.util.concurrent.CountDownLatch$Sync)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:997)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304)\n\tat java.util.concurrent.CountDownLatch.await(CountDownLatch.java:231)\n\tat org.apache.activemq.store.kahadb.disk.page.PageFile.flush(PageFile.java:521)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1563)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$17.execute(MessageDatabase.java:1535)\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1532)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:951)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:359)\n\n   Locked ownable synchronizers:\n\t- <0x0000000081e52c50> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n\t- <0x0000000081e52cc8> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n\n\"KahaDB Scheduler\" #48 daemon prio=5 os_prio=0 tid=0x000000001d159000 nid=0x149c in Object.wait() [0x000000004d5af000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.util.TimerThread.mainLoop(Timer.java:552)\n\t- locked <0x0000000081e4e288> (a java.util.TaskQueue)\n\tat java.util.TimerThread.run(Timer.java:505)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"ActiveMQ Broker[dcrd] Scheduler\" #47 daemon prio=5 os_prio=0 tid=0x000000001d154800 nid=0x22b4 in Object.wait() [0x000000004d4af000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.util.TimerThread.mainLoop(Timer.java:552)\n\t- locked <0x0000000081e54e38> (a java.util.TaskQueue)\n\tat java.util.TimerThread.run(Timer.java:505)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Store org.hibernate.cache.StandardQueryCache Expiry Thread\" #46 daemon prio=1 os_prio=-2 tid=0x000000001d155000 nid=0xa18 waiting on condition [0x000000004d1af000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat net.sf.ehcache.store.DiskStore.expiryThreadMain(DiskStore.java:831)\n\tat net.sf.ehcache.store.DiskStore.access$700(DiskStore.java:59)\n\tat net.sf.ehcache.store.DiskStore$ExpiryThread.run(DiskStore.java:1008)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Store org.hibernate.cache.StandardQueryCache Spool Thread\" #45 daemon prio=2 os_prio=-2 tid=0x000000001d150800 nid=0x158c waiting on condition [0x000000004d0af000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat net.sf.ehcache.store.DiskStore.spoolThreadMain(DiskStore.java:556)\n\tat net.sf.ehcache.store.DiskStore.access$600(DiskStore.java:59)\n\tat net.sf.ehcache.store.DiskStore$SpoolThread.run(DiskStore.java:990)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Store org.hibernate.cache.UpdateTimestampsCache Expiry Thread\" #44 daemon prio=1 os_prio=-2 tid=0x000000001d153800 nid=0x1a2c waiting on condition [0x000000004bd1e000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat net.sf.ehcache.store.DiskStore.expiryThreadMain(DiskStore.java:831)\n\tat net.sf.ehcache.store.DiskStore.access$700(DiskStore.java:59)\n\tat net.sf.ehcache.store.DiskStore$ExpiryThread.run(DiskStore.java:1008)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Store org.hibernate.cache.UpdateTimestampsCache Spool Thread\" #43 daemon prio=2 os_prio=-2 tid=0x000000001d14c000 nid=0x1394 waiting on condition [0x000000004b92f000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat net.sf.ehcache.store.DiskStore.spoolThreadMain(DiskStore.java:556)\n\tat net.sf.ehcache.store.DiskStore.access$600(DiskStore.java:59)\n\tat net.sf.ehcache.store.DiskStore$SpoolThread.run(DiskStore.java:990)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Store org.hibernate.cache.StandardQueryCache Expiry Thread\" #42 daemon prio=1 os_prio=-2 tid=0x000000001d153000 nid=0xb60 waiting on condition [0x000000004a3df000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat net.sf.ehcache.store.DiskStore.expiryThreadMain(DiskStore.java:831)\n\tat net.sf.ehcache.store.DiskStore.access$700(DiskStore.java:59)\n\tat net.sf.ehcache.store.DiskStore$ExpiryThread.run(DiskStore.java:1008)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Store org.hibernate.cache.StandardQueryCache Spool Thread\" #41 daemon prio=2 os_prio=-2 tid=0x000000001d14f000 nid=0x1be0 waiting on condition [0x000000004a2df000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat net.sf.ehcache.store.DiskStore.spoolThreadMain(DiskStore.java:556)\n\tat net.sf.ehcache.store.DiskStore.access$600(DiskStore.java:59)\n\tat net.sf.ehcache.store.DiskStore$SpoolThread.run(DiskStore.java:990)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Store org.hibernate.cache.UpdateTimestampsCache Expiry Thread\" #40 daemon prio=1 os_prio=-2 tid=0x000000001d152000 nid=0x2328 waiting on condition [0x000000004a1df000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat net.sf.ehcache.store.DiskStore.expiryThreadMain(DiskStore.java:831)\n\tat net.sf.ehcache.store.DiskStore.access$700(DiskStore.java:59)\n\tat net.sf.ehcache.store.DiskStore$ExpiryThread.run(DiskStore.java:1008)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Store org.hibernate.cache.UpdateTimestampsCache Spool Thread\" #39 daemon prio=2 os_prio=-2 tid=0x000000001d151800 nid=0x1180 waiting on condition [0x0000000049a6f000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat net.sf.ehcache.store.DiskStore.spoolThreadMain(DiskStore.java:556)\n\tat net.sf.ehcache.store.DiskStore.access$600(DiskStore.java:59)\n\tat net.sf.ehcache.store.DiskStore$SpoolThread.run(DiskStore.java:990)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"pool-1-thread-1\" #38 prio=5 os_prio=0 tid=0x000000001d14a800 nid=0x1ab4 waiting on condition [0x000000001a90f000]\n   java.lang.Thread.State: WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x000000008045d550> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)\n\tat java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)\n\tat java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Timer-0\" #37 daemon prio=5 os_prio=0 tid=0x000000001d14b800 nid=0x2190 in Object.wait() [0x000000001a60f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.util.TimerThread.mainLoop(Timer.java:552)\n\t- locked <0x00000000800f1b68> (a java.util.TaskQueue)\n\tat java.util.TimerThread.run(Timer.java:505)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"2012993836@qtp-1219161283-9 - Acceptor0 SelectChannelConnector@0.0.0.0:13801\" #35 prio=5 os_prio=0 tid=0x000000001b630000 nid=0x1138 runnable [0x000000001ca0e000]\n   java.lang.Thread.State: RUNNABLE\n\tat sun.nio.ch.WindowsSelectorImpl$SubSelector.poll0(Native Method)\n\tat sun.nio.ch.WindowsSelectorImpl$SubSelector.poll(WindowsSelectorImpl.java:296)\n\tat sun.nio.ch.WindowsSelectorImpl$SubSelector.access$400(WindowsSelectorImpl.java:278)\n\tat sun.nio.ch.WindowsSelectorImpl.doSelect(WindowsSelectorImpl.java:159)\n\tat sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86)\n\t- locked <0x00000000f708c4a8> (a sun.nio.ch.Util$2)\n\t- locked <0x00000000f708c498> (a java.util.Collections$UnmodifiableSet)\n\t- locked <0x00000000f703e890> (a sun.nio.ch.WindowsSelectorImpl)\n\tat sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97)\n\tat org.mortbay.io.nio.SelectorManager$SelectSet.doSelect(SelectorManager.java:498)\n\tat org.mortbay.io.nio.SelectorManager.doSelect(SelectorManager.java:192)\n\tat org.mortbay.jetty.nio.SelectChannelConnector.accept(SelectChannelConnector.java:124)\n\tat org.mortbay.jetty.AbstractConnector$Acceptor.run(AbstractConnector.java:708)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"1499867659@qtp-1219161283-8 - Acceptor1 SelectChannelConnector@0.0.0.0:13801\" #34 prio=5 os_prio=0 tid=0x000000001b62e800 nid=0x1ccc runnable [0x000000001c90f000]\n   java.lang.Thread.State: RUNNABLE\n\tat sun.nio.ch.WindowsSelectorImpl$SubSelector.poll0(Native Method)\n\tat sun.nio.ch.WindowsSelectorImpl$SubSelector.poll(WindowsSelectorImpl.java:296)\n\tat sun.nio.ch.WindowsSelectorImpl$SubSelector.access$400(WindowsSelectorImpl.java:278)\n\tat sun.nio.ch.WindowsSelectorImpl.doSelect(WindowsSelectorImpl.java:159)\n\tat sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86)\n\t- locked <0x00000000f8482690> (a sun.nio.ch.Util$2)\n\t- locked <0x00000000f8482680> (a java.util.Collections$UnmodifiableSet)\n\t- locked <0x00000000f8482600> (a sun.nio.ch.WindowsSelectorImpl)\n\tat sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97)\n\tat org.mortbay.io.nio.SelectorManager$SelectSet.doSelect(SelectorManager.java:498)\n\tat org.mortbay.io.nio.SelectorManager.doSelect(SelectorManager.java:192)\n\tat org.mortbay.jetty.nio.SelectChannelConnector.accept(SelectChannelConnector.java:124)\n\tat org.mortbay.jetty.AbstractConnector$Acceptor.run(AbstractConnector.java:708)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"461160828@qtp-1219161283-7 - Acceptor0 SslSocketConnector@0.0.0.0:13901\" #33 prio=5 os_prio=0 tid=0x000000001b62f800 nid=0x1900 runnable [0x000000001c80e000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.DualStackPlainSocketImpl.accept0(Native Method)\n\tat java.net.DualStackPlainSocketImpl.socketAccept(DualStackPlainSocketImpl.java:131)\n\tat java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:199)\n\t- locked <0x0000000081e8b228> (a java.net.SocksSocketImpl)\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:545)\n\tat sun.security.ssl.SSLServerSocketImpl.accept(SSLServerSocketImpl.java:348)\n\tat org.mortbay.jetty.security.SslSocketConnector.accept(SslSocketConnector.java:197)\n\tat org.mortbay.jetty.AbstractConnector$Acceptor.run(AbstractConnector.java:708)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"1325124186@qtp-1219161283-6\" #32 prio=5 os_prio=0 tid=0x000000001b631000 nid=0x208 in Object.wait() [0x000000001c70f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:626)\n\t- locked <0x00000000800eadb0> (a org.mortbay.thread.QueuedThreadPool$PoolThread)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"156856360@qtp-1219161283-4\" #30 prio=5 os_prio=0 tid=0x000000001b62e000 nid=0xe30 in Object.wait() [0x000000001c50f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:626)\n\t- locked <0x00000000800eaf30> (a org.mortbay.thread.QueuedThreadPool$PoolThread)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"1226020905@qtp-1219161283-3\" #29 prio=5 os_prio=0 tid=0x000000001b62c800 nid=0x1590 in Object.wait() [0x000000001c40f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:626)\n\t- locked <0x00000000800eb0b0> (a org.mortbay.thread.QueuedThreadPool$PoolThread)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"573673894@qtp-1219161283-2\" #28 prio=5 os_prio=0 tid=0x000000001b62a000 nid=0xef8 in Object.wait() [0x000000001c30f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:626)\n\t- locked <0x00000000800eb230> (a org.mortbay.thread.QueuedThreadPool$PoolThread)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"1321530272@qtp-1219161283-1\" #27 prio=5 os_prio=0 tid=0x000000001b62d000 nid=0x110c in Object.wait() [0x000000001c20e000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:626)\n\t- locked <0x00000000800eb3b0> (a org.mortbay.thread.QueuedThreadPool$PoolThread)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"1162918744@qtp-1219161283-0\" #26 prio=5 os_prio=0 tid=0x000000001b62b000 nid=0x2068 in Object.wait() [0x000000001c10f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:626)\n\t- locked <0x00000000800eb530> (a org.mortbay.thread.QueuedThreadPool$PoolThread)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"RMI TCP Accept-0\" #23 daemon prio=5 os_prio=0 tid=0x0000000019ab5000 nid=0x3c4 runnable [0x000000001b20f000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.DualStackPlainSocketImpl.accept0(Native Method)\n\tat java.net.DualStackPlainSocketImpl.socketAccept(DualStackPlainSocketImpl.java:131)\n\tat java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:199)\n\t- locked <0x00000000800f1c80> (a java.net.SocksSocketImpl)\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:545)\n\tat java.net.ServerSocket.accept(ServerSocket.java:513)\n\tat sun.management.jmxremote.LocalRMIServerSocketFactory$1.accept(LocalRMIServerSocketFactory.java:52)\n\tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:400)\n\tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:372)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"RMI TCP Accept-13301\" #22 daemon prio=5 os_prio=0 tid=0x0000000019a80000 nid=0x1fa0 runnable [0x000000001b10e000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.DualStackPlainSocketImpl.accept0(Native Method)\n\tat java.net.DualStackPlainSocketImpl.socketAccept(DualStackPlainSocketImpl.java:131)\n\tat java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:199)\n\t- locked <0x000000008012b968> (a java.net.SocksSocketImpl)\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:545)\n\tat java.net.ServerSocket.accept(ServerSocket.java:513)\n\tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:400)\n\tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:372)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"RMI TCP Accept-0\" #21 daemon prio=5 os_prio=0 tid=0x0000000019a7f000 nid=0x16d4 runnable [0x000000001b00f000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.DualStackPlainSocketImpl.accept0(Native Method)\n\tat java.net.DualStackPlainSocketImpl.socketAccept(DualStackPlainSocketImpl.java:131)\n\tat java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:199)\n\t- locked <0x00000000800f7e18> (a java.net.SocksSocketImpl)\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:545)\n\tat java.net.ServerSocket.accept(ServerSocket.java:513)\n\tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:400)\n\tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:372)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Service Thread\" #20 daemon prio=9 os_prio=0 tid=0x0000000019991000 nid=0x5e0 runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n   Locked ownable synchronizers:\n\t- None\n\n\"C1 CompilerThread2\" #19 daemon prio=9 os_prio=2 tid=0x0000000019990000 nid=0x1358 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n   Locked ownable synchronizers:\n\t- None\n\n\"C2 CompilerThread1\" #18 daemon prio=9 os_prio=2 tid=0x000000001998b800 nid=0x790 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n   Locked ownable synchronizers:\n\t- None\n\n\"C2 CompilerThread0\" #17 daemon prio=9 os_prio=2 tid=0x0000000019988800 nid=0x1934 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n   Locked ownable synchronizers:\n\t- None\n\n\"JDWP Event Helper Thread\" #16 daemon prio=10 os_prio=0 tid=0x000000001997d800 nid=0x1498 runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n   Locked ownable synchronizers:\n\t- None\n\n\"JDWP Transport Listener: dt_socket\" #15 daemon prio=10 os_prio=0 tid=0x000000001994f000 nid=0xa44 runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n   Locked ownable synchronizers:\n\t- None\n\n\"RMI RenewClean-[localhost:13401]\" #12 daemon prio=5 os_prio=0 tid=0x000000001993e000 nid=0x27c in Object.wait() [0x000000001a80f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)\n\t- locked <0x000000008012c090> (a java.lang.ref.ReferenceQueue$Lock)\n\tat sun.rmi.transport.DGCClient$EndpointEntry$RenewCleanThread.run(DGCClient.java:536)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"RMI Scheduler(0)\" #11 daemon prio=5 os_prio=0 tid=0x0000000019933000 nid=0x2170 waiting on condition [0x000000001a70e000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x0000000080021cc0> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n\tat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1093)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:809)\n\tat java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"GC Daemon\" #9 daemon prio=2 os_prio=-2 tid=0x00000000198b8000 nid=0x1820 in Object.wait() [0x000000001a14f000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat sun.misc.GC$Daemon.run(GC.java:117)\n\t- locked <0x0000000080000d58> (a sun.misc.GC$LatencyLock)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"RMI Reaper\" #8 prio=5 os_prio=0 tid=0x00000000198b5000 nid=0xcec in Object.wait() [0x000000001a04e000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <0x0000000080007788> (a java.lang.ref.ReferenceQueue$Lock)\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)\n\t- locked <0x0000000080007788> (a java.lang.ref.ReferenceQueue$Lock)\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)\n\tat sun.rmi.transport.ObjectTable$Reaper.run(ObjectTable.java:351)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"RMI TCP Accept-13401\" #7 daemon prio=5 os_prio=0 tid=0x0000000019823800 nid=0x58c runnable [0x0000000019f4e000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.DualStackPlainSocketImpl.accept0(Native Method)\n\tat java.net.DualStackPlainSocketImpl.socketAccept(DualStackPlainSocketImpl.java:131)\n\tat java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:199)\n\t- locked <0x000000008000f820> (a java.net.SocksSocketImpl)\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:545)\n\tat java.net.ServerSocket.accept(ServerSocket.java:513)\n\tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:400)\n\tat sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:372)\n\tat java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Attach Listener\" #5 daemon prio=5 os_prio=2 tid=0x0000000017b15000 nid=0x23a4 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Signal Dispatcher\" #4 daemon prio=9 os_prio=2 tid=0x0000000017b14000 nid=0xc68 runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Finalizer\" #3 daemon prio=8 os_prio=1 tid=0x0000000002caa000 nid=0x1a20 in Object.wait() [0x000000001948f000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)\n\t- locked <0x00000000800175e0> (a java.lang.ref.ReferenceQueue$Lock)\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)\n\tat java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Reference Handler\" #2 daemon prio=10 os_prio=2 tid=0x0000000017adb000 nid=0x1af8 in Object.wait() [0x000000001938e000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.lang.Object.wait(Object.java:502)\n\tat java.lang.ref.Reference$ReferenceHandler.run(Reference.java:157)\n\t- locked <0x000000008001ed98> (a java.lang.ref.Reference$Lock)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"VM Thread\" os_prio=2 tid=0x0000000017ad9000 nid=0x148c runnable \n\n\"GC task thread#0 (ParallelGC)\" os_prio=0 tid=0x0000000002bca800 nid=0xcdc runnable \n\n\"GC task thread#1 (ParallelGC)\" os_prio=0 tid=0x0000000002bcb800 nid=0x8a4 runnable \n\n\"GC task thread#2 (ParallelGC)\" os_prio=0 tid=0x0000000002bcd000 nid=0x830 runnable \n\n\"GC task thread#3 (ParallelGC)\" os_prio=0 tid=0x0000000002bcf000 nid=0x1d8c runnable \n\n\"GC task thread#4 (ParallelGC)\" os_prio=0 tid=0x0000000002bd1000 nid=0xb9c runnable \n\n\"GC task thread#5 (ParallelGC)\" os_prio=0 tid=0x0000000002bd2000 nid=0x12b4 runnable \n\n\"VM Periodic Task Thread\" os_prio=2 tid=0x0000000019abb000 nid=0x152c waiting on condition \n\nJNI global references: 7802\n\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=irodionov","name":"irodionov","key":"irodionov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"irodionov","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-16T10:52:33.973+0000","updated":"2016-05-16T10:52:33.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12834219/comment/15419028","id":"15419028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 330f0ce7341934ae7869b094dc769c972ad18347 in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=330f0ce ]\n\nAMQ-5815 ensure async write latch is released on exception\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-12T15:44:43.185+0000","updated":"2016-08-12T15:44:43.185+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12834219/comment/15419046","id":"15419046","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":" https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=330f0ce deals with the enableIndexWriteAsync=true case.\n\nFor the original description from Andrew, I can't yet see where the write lock is not getting released.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-12T15:54:57.922+0000","updated":"2016-08-12T15:54:57.922+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12834219/comment/15420827","id":"15420827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 6d44ae6e971a341217c6f5a8669900740654b0ab in activemq's branch refs/heads/master from [~gtully]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6d44ae6 ]\n\nAMQ-5815 - remove obsolete remnant of fix for AMQ-2594. holding global lock before attempting to get index and checkpoint lock can lead to deadlock if checkpoint write lock request pops in\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-15T10:37:53.637+0000","updated":"2016-08-15T10:37:53.637+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12834219/comment/15420832","id":"15420832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"two different issues here with similar IO failure scenarios.\nnote the default behaviour is to stop the broker in such an event via the IOExceptionHandler.\nhowever it should be ok to proceed without deadlock.\n\nIt would be great to find the original jstack, because the restarted checkpoint thread is most probably attempting to get the write lock which is the trigger. In any event, having a global transaction store lock is a remnant of an old fix and is broken.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-15T10:41:36.298+0000","updated":"2016-08-15T10:41:36.298+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5815/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2fgcf:"}}