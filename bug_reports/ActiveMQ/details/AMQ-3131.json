{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12495322","self":"https://issues.apache.org/jira/rest/api/2/issue/12495322","key":"AMQ-3131","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-01-14T10:03:00.402+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 18 16:50:40 UTC 2012","customfield_12310420":"74728","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_27211457094_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-11-22T23:08:52.126+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3131/watchers","watchCount":12,"isWatching":false},"created":"2011-01-12T00:24:35.244+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-01-18T16:50:40.425+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"\nThe following error just started showing up in our ActiveMQ log file for unknown reasons (repeated 11 times, all within a second):\n\n{noformat}\n\n2011-01-11 03:42:00,997 | ERROR | Failed to reset batching | org.apache.activemq.store.kahadb.KahaDBStore | Thread-2002\njava.lang.IllegalStateException: PageFile is not loaded\n        at org.apache.kahadb.page.PageFile.assertLoaded(PageFile.java:721)\n        at org.apache.kahadb.page.PageFile.tx(PageFile.java:239)\n        at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.resetBatching(KahaDBStore.java:512)\n        at org.apache.activemq.store.ProxyMessageStore.resetBatching(ProxyMessageStore.java:93)\n        at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.resetBatch(QueueStorePrefetch.java:85)\n        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.stop(AbstractStoreCursor.java:69)\n        at org.apache.activemq.broker.region.cursors.StoreQueueCursor.stop(StoreQueueCursor.java:84)\n        at org.apache.activemq.broker.region.Queue.stop(Queue.java:853)\n        at org.apache.activemq.broker.region.AbstractRegion.stop(AbstractRegion.java:110)\n        at org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n        at org.apache.activemq.broker.region.RegionBroker.doStop(RegionBroker.java:713)\n        at org.apache.activemq.broker.jmx.ManagedRegionBroker.doStop(ManagedRegionBroker.java:113)\n        at org.apache.activemq.broker.region.RegionBroker.stop(RegionBroker.java:213)\n        at org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:161)\n        at org.apache.activemq.broker.scheduler.SchedulerBroker.stop(SchedulerBroker.java:104)\n        at org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:161)\n        at org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:161)\n        at org.apache.activemq.broker.TransactionBroker.stop(TransactionBroker.java:114)\n        at org.apache.activemq.broker.BrokerService$3.stop(BrokerService.java:1773)\n        at org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n        at org.apache.activemq.broker.BrokerService.stop(BrokerService.java:575)\n        at org.apache.activemq.console.command.StartCommand$1.run(StartCommand.java:135)\n{noformat}\n\nSimilarly we now have an issue on shutdown, with the following error (also repeating 11 times):\n\n{noformat}\n2011-01-11 10:34:39,652 | ERROR | Failed to reset batching | org.apache.activemq.store.kahadb.KahaDBStore | ActiveMQ ShutdownHook\njava.lang.IllegalStateException: PageFile is not loaded\n        at org.apache.kahadb.page.PageFile.assertLoaded(PageFile.java:721)\n        at org.apache.kahadb.page.PageFile.tx(PageFile.java:239)\n        at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.resetBatching(KahaDBStore.java:512)\n        at org.apache.activemq.store.ProxyMessageStore.resetBatching(ProxyMessageStore.java:93)\n        at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.resetBatch(QueueStorePrefetch.java:85)\n        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.stop(AbstractStoreCursor.java:69)\n        at org.apache.activemq.broker.region.cursors.StoreQueueCursor.stop(StoreQueueCursor.java:84)\n        at org.apache.activemq.broker.region.Queue.stop(Queue.java:853)\n        at org.apache.activemq.broker.region.AbstractRegion.stop(AbstractRegion.java:110)\n        at org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n        at org.apache.activemq.broker.region.RegionBroker.doStop(RegionBroker.java:713)\n        at org.apache.activemq.broker.jmx.ManagedRegionBroker.doStop(ManagedRegionBroker.java:113)\n        at org.apache.activemq.broker.region.RegionBroker.stop(RegionBroker.java:213)\n        at org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:161)\n        at org.apache.activemq.broker.scheduler.SchedulerBroker.stop(SchedulerBroker.java:104)\n        at org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:161)\n        at org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:161)\n        at org.apache.activemq.broker.TransactionBroker.stop(TransactionBroker.java:114)\n        at org.apache.activemq.broker.BrokerService$3.stop(BrokerService.java:1773)\n        at org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n        at org.apache.activemq.broker.BrokerService.stop(BrokerService.java:575)\n        at org.apache.activemq.broker.BrokerService.containerShutdown(BrokerService.java:1971)\n        at org.apache.activemq.broker.BrokerService$4.run(BrokerService.java:1938)\n{noformat}\n\nSubsequent start / stops result in the same shutdown errors above.\n\nIs there a workaround for this besides deleting the datastore DB files?\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59015","customfield_12312823":null,"summary":"Failed to reset batching ... java.lang.IllegalStateException: PageFile is not loaded","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ives.stoddard","name":"ives.stoddard","key":"ives.stoddard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ives Stoddard","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ives.stoddard","name":"ives.stoddard","key":"ives.stoddard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ives Stoddard","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"- Sun Solaris 5.10\n- Master / Slave with shared storage","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/12981699","id":"12981699","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"please attach the full log of the broker if this occurs again. the additional context may help diagnose.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-14T10:03:00.402+0000","updated":"2011-01-14T10:03:00.402+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/12990094","id":"12990094","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fgynnild","name":"fgynnild","key":"fgynnild","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Gynnild","active":true,"timeZone":"Europe/Oslo"},"body":"I ran into the same issue today, but I got if after changing some parameters in the activemq.xml file and then did a restart of AMQ.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fgynnild","name":"fgynnild","key":"fgynnild","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Gynnild","active":true,"timeZone":"Europe/Oslo"},"created":"2011-02-03T13:37:09.239+0000","updated":"2011-02-03T13:37:09.239+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/12990122","id":"12990122","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ives.stoddard","name":"ives.stoddard","key":"ives.stoddard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ives Stoddard","active":true,"timeZone":"Etc/UTC"},"body":"@Frank: couple questions...\n\n1) do you recall what the changes were to activemq.xml?\n2) are you using the scheduler functionality?\n3) are you using anything other than the default prefectch or batching settings?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ives.stoddard","name":"ives.stoddard","key":"ives.stoddard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ives Stoddard","active":true,"timeZone":"Etc/UTC"},"created":"2011-02-03T15:14:06.148+0000","updated":"2011-02-03T15:14:06.148+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/12999312","id":"12999312","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iocanel","name":"iocanel","key":"iocanel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ioannis Canellos","active":true,"timeZone":"Europe/Helsinki"},"body":"I am having similar issues. In my case they are clearly related to the scheduler.\n\n\njavax.jms.JMSException: PageFile is not loaded\n        at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:49)\n        at org.apache.activemq.ActiveMQConnection.onAsyncException(ActiveMQConnection.java:1833)\n        at org.apache.activemq.ActiveMQConnection$2$1.run(ActiveMQConnection.java:1754)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)\nCaused by: java.lang.IllegalStateException: PageFile is not loaded\n        at org.apache.kahadb.page.PageFile.assertLoaded(PageFile.java:721)\n        at org.apache.kahadb.page.PageFile.tx(PageFile.java:239)\n        at org.apache.activemq.broker.scheduler.JobSchedulerImpl.schedule(JobSchedulerImpl.java:110)\n        at org.apache.activemq.broker.scheduler.SchedulerBroker.send(SchedulerBroker.java:185)\n        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n        at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n        at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:227)\n        at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)\n        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:462)\n        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:677)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:311)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:185)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:228)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n        at org.apache.activemq.transport.nio.NIOTransport.serviceRead(NIOTransport.java:129)\n        at org.apache.activemq.transport.nio.NIOTransport.access$000(NIOTransport.java:44)\n        at org.apache.activemq.transport.nio.NIOTransport$1.onSelect(NIOTransport.java:68)\n        at org.apache.activemq.transport.nio.SelectorSelection.onSelect(SelectorSelection.java:94)\n        at org.apache.activemq.transport.nio.SelectorWorker$1.run(SelectorWorker.java:119)\n        ... 3 more\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iocanel","name":"iocanel","key":"iocanel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ioannis Canellos","active":true,"timeZone":"Europe/Helsinki"},"created":"2011-02-25T11:46:36.449+0000","updated":"2011-02-25T11:46:36.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13001363","id":"13001363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbucci","name":"sbucci","key":"sbucci","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sébastien Bucci","active":true,"timeZone":"Etc/UTC"},"body":"I have the same problem after an activemq.xml change.\nEnvironment : \n - Windows xp/2008 r2\n - I'm using scheduler\n\n{code:java}\n2011-02-10 05:00:46,992 | ERROR | Failed to reset batching | org.apache.activemq.store.kahadb.KahaDBStore | ActiveMQ ShutdownHook\njava.lang.IllegalStateException: PageFile is not loaded\n\tat org.apache.kahadb.page.PageFile.assertLoaded(PageFile.java:721)\n\tat org.apache.kahadb.page.PageFile.tx(PageFile.java:239)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.resetBatching(KahaDBStore.java:512)\n\tat org.apache.activemq.store.ProxyMessageStore.resetBatching(ProxyMessageStore.java:93)\n\tat org.apache.activemq.broker.region.cursors.QueueStorePrefetch.resetBatch(QueueStorePrefetch.java:85)\n\tat org.apache.activemq.broker.region.cursors.AbstractStoreCursor.stop(AbstractStoreCursor.java:69)\n\tat org.apache.activemq.broker.region.cursors.StoreQueueCursor.stop(StoreQueueCursor.java:84)\n\tat org.apache.activemq.broker.region.Queue.stop(Queue.java:853)\n\tat org.apache.activemq.broker.region.AbstractRegion.stop(AbstractRegion.java:110)\n\tat org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n\tat org.apache.activemq.broker.region.RegionBroker.doStop(RegionBroker.java:713)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.doStop(ManagedRegionBroker.java:113)\n\tat org.apache.activemq.broker.region.RegionBroker.stop(RegionBroker.java:213)\n\tat org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:161)\n\tat org.apache.activemq.broker.scheduler.SchedulerBroker.stop(SchedulerBroker.java:104)\n\tat org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:161)\n\tat org.apache.activemq.broker.BrokerFilter.stop(BrokerFilter.java:161)\n\tat org.apache.activemq.broker.TransactionBroker.stop(TransactionBroker.java:114)\n\tat org.apache.activemq.broker.BrokerService$3.stop(BrokerService.java:1773)\n\tat org.apache.activemq.util.ServiceStopper.stop(ServiceStopper.java:41)\n\tat org.apache.activemq.broker.BrokerService.stop(BrokerService.java:575)\n\tat org.apache.activemq.broker.BrokerService.containerShutdown(BrokerService.java:1971)\n\tat org.apache.activemq.broker.BrokerService$4.run(BrokerService.java:1938)\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbucci","name":"sbucci","key":"sbucci","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sébastien Bucci","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-02T10:40:34.379+0000","updated":"2011-03-02T10:40:34.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13017697","id":"13017697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt_good%40yahoo.com","name":"matt_good@yahoo.com","key":"matt_good@yahoo.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Good","active":true,"timeZone":"America/Denver"},"body":"I have the same problem.  In my case, I deleted several queues from admin console.  These queues were used for testing scheduled messages.  When I stopped ActiveMQ, I got 5 of these errors.  When I restarted it 5 of the queues I deleted reappeared.  Coincidence or part of the problem - I can't say.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt_good%40yahoo.com","name":"matt_good@yahoo.com","key":"matt_good@yahoo.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Good","active":true,"timeZone":"America/Denver"},"created":"2011-04-08T22:18:59.538+0000","updated":"2011-04-08T22:18:59.538+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13153051","id":"13153051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jplmelanson","name":"jplmelanson","key":"jplmelanson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jean-Philippe Melanson","active":true,"timeZone":"America/New_York"},"body":"Similar stack trace here:\n{code}\nCaused by: java.lang.IllegalStateException: PageFile is not loaded \n  at org.apache.kahadb.page.PageFile.assertLoaded(PageFile.java:721) \n  at org.apache.kahadb.page.PageFile.tx(PageFile.java:239) \n  at org.apache.activemq.broker.scheduler.JobSchedulerImpl.schedule(JobSchedulerImpl.java:110) \n  at org.apache.activemq.broker.scheduler.SchedulerBroker.send(SchedulerBroker.java:185) \n  at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129) \n  at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n{code} \n\nI haven't reproduced it yet, but I opened up the trunk code and seems like {{JobSchedulerImpl.schedule()}} methods are using the {{tx()}} method, which in turn asserts that the {{PageFile}} is loaded, which doesn't seems to be the case. \n\nI don't know the code at all, but I wonder if the job scheduler should check if the page file is loaded first, load it if needed and process with the transaction? What do you think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jplmelanson","name":"jplmelanson","key":"jplmelanson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jean-Philippe Melanson","active":true,"timeZone":"America/New_York"},"created":"2011-11-18T19:08:04.314+0000","updated":"2011-11-18T19:08:04.314+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13155545","id":"13155545","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"For the shutdown case, there is a fix on trunk, the org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.resetBatching(KahaDBStore.java:512) checks if the page file has been unloaded as it will be due to being shutdown before the destinations.\nhttp://svn.apache.org/viewvc?rev=1170201&view=rev","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-22T23:02:10.614+0000","updated":"2011-11-22T23:02:10.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13155551","id":"13155551","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"The schedular store is not started when it is created so the use before initialisation error should not occur on trunk. Reopen if this is reproducible with trunk of 5.6 ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-22T23:08:52.196+0000","updated":"2011-11-22T23:08:52.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13185731","id":"13185731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"body":"Hey Gary, we need to back-port a patch as we are not comfortable to run the 5.6-SNAPSHOT to fix this problem and the 5.5.1 version is still problematic.\n\nAfter back-porting all of the changes to the Scheduler code, this still happens.\n\nDo you have any idea where else I should look?  I've been going through all of the Jira entries resolved in 5.6 and not finding any promising leads.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"created":"2012-01-13T18:22:29.938+0000","updated":"2012-01-13T18:22:29.938+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13187945","id":"13187945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"body":"SCRATCH THAT.\n\nI had build problems that prevented the updates from taking effect.  Using the latest version of the scheduler sources resolves the problem for us.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"created":"2012-01-17T19:51:37.282+0000","updated":"2012-01-17T19:51:37.282+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13187960","id":"13187960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Glad you got sorted :-)\nOn Jan 17, 2012 7:51 p.m., \"Arthur Naseef (Commented) (JIRA)\" <\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-17T20:10:02.331+0000","updated":"2012-01-17T20:10:02.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13188334","id":"13188334","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ishitori","name":"ishitori","key":"ishitori","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergei Sokolov","active":true,"timeZone":"Etc/UTC"},"body":"Arthur, right now I experience the same error. Moreover, I can see a lot of .log files in KahaDb. I believe that they are not got cleaned up because of this exception.\n\nI also don't want to move to 5.6.0 and I would love to have this fix in 5.5.1 version. Can you commit your changes into 5.5.1 version so the latest snapshot of 5.5.1 would have your changes?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ishitori","name":"ishitori","key":"ishitori","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergei Sokolov","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-18T08:38:43.850+0000","updated":"2012-01-18T08:38:43.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13188495","id":"13188495","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devantor","name":"devantor","key":"devantor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"devantor","active":true,"timeZone":"Etc/UTC"},"body":"I don't know the steps to reproduce this one. But this bug affect also expired messages. org.apache.activemq.broker.region.Queue.expireMessages(Queue.java:772)\n\nFailed to reset batching\njava.lang.IllegalStateException: PageFile is not loaded\nat org.apache.kahadb.page.PageFile.assertLoaded(PageFile.java:721)\nat org.apache.kahadb.page.PageFile.tx(PageFile.java:239)\nat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.resetBatching(KahaDBStore.java:469)\nat org.apache.activemq.store.ProxyMessageStore.resetBatching(ProxyMessageStore.java:93)\nat org.apache.activemq.broker.region.cursors.QueueStorePrefetch.resetBatch(QueueStorePrefetch.java:85)\nat org.apache.activemq.broker.region.cursors.AbstractStoreCursor.fillBatch(AbstractStoreCursor.java:256)\nat org.apache.activemq.broker.region.cursors.AbstractStoreCursor.reset(AbstractStoreCursor.java:110)\nat org.apache.activemq.broker.region.cursors.StoreQueueCursor.reset(StoreQueueCursor.java:157)\nat org.apache.activemq.broker.region.Queue.doBrowse(Queue.java:1009)\nat org.apache.activemq.broker.region.Queue.expireMessages(Queue.java:772)\nat org.apache.activemq.broker.region.Queue.access$100(Queue.java:83)\nat org.apache.activemq.broker.region.Queue$2.run(Queue.java:123)\nat org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\nat java.util.TimerThread.mainLoop(Timer.java:512)\nat java.util.TimerThread.run(Timer.java:462)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devantor","name":"devantor","key":"devantor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"devantor","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-18T15:21:19.145+0000","updated":"2012-01-18T15:21:19.145+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13188504","id":"13188504","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"@devantor: for the periodic expiry case, that can be disabled via policy entry, expireMessagesPeriod=0\nExpiry will still occur on send/dispatch, the only problem will be when there are no consumers, there will be no check for expiry, so expired messages can build up till dispatch is attempted again. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-18T15:34:02.243+0000","updated":"2012-01-18T15:34:02.243+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495322/comment/13188543","id":"13188543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"body":"Sergei - my issue was with the scheduler for which the fixes are in 5.5.1, I believe.  If your having trouble due to the scheduler, the latest head version of the sources for the following directory fixed my problem:\n\nactivemq-core/src/main/java/org/apache/activemq/broker/scheduler\n\nNote that we still see \"failed to reset batching\" errors with this update when shutting down the brokers if there are messages still pending delivery in the scheduler, but that's not a problem for us.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=artnaseef","name":"artnaseef","key":"artnaseef","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Arthur Naseef","active":true,"timeZone":"America/Phoenix"},"created":"2012-01-18T16:50:40.262+0000","updated":"2012-01-18T16:50:40.262+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3131/votes","votes":11,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0agxb:"}}