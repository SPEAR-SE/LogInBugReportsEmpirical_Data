{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12822345","self":"https://issues.apache.org/jira/rest/api/2/issue/12822345","key":"AMQ-5733","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-04-21T04:00:55.569+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Apr 23 06:13:08 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5733/watchers","watchCount":2,"isWatching":false},"created":"2015-04-20T15:12:09.583+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329382","id":"12329382","name":"5.11.1","archived":false,"released":true,"releaseDate":"2015-02-17"}],"issuelinks":[{"id":"12421825","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12421825","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12764778","key":"AMQ-5503","self":"https://issues.apache.org/jira/rest/api/2/issue/12764778","fields":{"summary":"Make init script more reliable","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-23T06:13:08.127+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324789","id":"12324789","name":"Distribution"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Using https://github.com/rgevaert/activemq2deb I am trying to distribute upgrades to our fleet. This results in failure each time.\n\nLooking into the matter the activemq script tries to stop the broker via JMX. This is not configured, so fails.\n\nIt falls back to issuing \"kill -9 <PID>\" then immediately exits with code 1. This code 1 causes the packaging script to bail and thus we end up with a mess.\n\nA possible solution is to return the \"kill\" command's own result. This doesn't necessarily reflect whether \"kill\" succeeded in terminating the PID however.\n\nA second possible solution is to detect the presence of 'start-stop-daemon' and use this in preference. Narrows down the cases in which it does not work at least.\n\nI am of the opinion that a script aiming of cross-platform compatibility is probably never going to work completely so detecting and making use of per-system tooling is probably best long term, meantime would returning \"kill's\" exit code help?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"kill -9 always results in failure signal","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822345/comment/14503023","id":"14503023","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"body":"Also, after using kill we do not erase the PID file. This results in the newly installed package being unable to start as the file already exists.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"created":"2015-04-20T15:24:10.686+0000","updated":"2015-04-20T15:24:10.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822345/comment/14504276","id":"14504276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scoopex","name":"scoopex","key":"scoopex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marc Sch√∂chlin","active":true,"timeZone":"Europe/Berlin"},"body":"@James Green: i reviewed your problem and i agree\n\nMy intention was that a termination by \"SIGKILL\" should be something abnormal because the broker should shutdown in regular way.\nSIGKILL does not provide the possibility to run shutdown logic (shutdown hook)  for activemq - you should really consider to shutdown activemq by jmx.\n\nNevertheless according to LSB (http://refspecs.linuxbase.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/iniscrptact.html) the exit code should be 0 if activemq is really not running after running \"/etc/init.d/activemq stop\". \nI changed this and appended it to merge request https://github.com/apache/activemq/pull/61\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scoopex","name":"scoopex","key":"scoopex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marc Sch√∂chlin","active":true,"timeZone":"Europe/Berlin"},"created":"2015-04-21T04:00:55.569+0000","updated":"2015-04-21T04:00:55.569+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822345/comment/14504480","id":"14504480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"body":"Briefly reading http://stackoverflow.com/questions/191215/how-to-stop-java-process-gracefully and https://major.io/2010/03/18/sigterm-vs-sigkill/ perhaps it should follow the follow the following strategy:\n\n1. Attempt to send shutdown via JMX (a lot of people do not enable JMX or have it misconfigured)\n2. Attempt to kill <PID> allowing a JVM shutdown hook to gracefully bring down the process\n3. Terminate forcefully with kill -9 <PID>\n\nIn each case poll for the presence of the PID in the process list, and if it goes ensure the PID file is removed.\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"created":"2015-04-21T07:13:48.897+0000","updated":"2015-04-21T07:13:48.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822345/comment/14508523","id":"14508523","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scoopex","name":"scoopex","key":"scoopex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marc Sch√∂chlin","active":true,"timeZone":"Europe/Berlin"},"body":"Attempting a shutdown by JMX and and SIGTERM (8) seems to be redundant for me. Both methods seem to do the same thing.\nProbably it might be a option to do a fallback from JMX to SIGTERM if there is no configuration for JMX?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scoopex","name":"scoopex","key":"scoopex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marc Sch√∂chlin","active":true,"timeZone":"Europe/Berlin"},"created":"2015-04-23T06:13:08.127+0000","updated":"2015-04-23T06:13:08.127+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5733/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2dhe7:"}}