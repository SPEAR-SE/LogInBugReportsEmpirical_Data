{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483241","self":"https://issues.apache.org/jira/rest/api/2/issue/12483241","key":"AMQ-2596","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315621","id":"12315621","description":"","name":"5.3.1","archived":false,"released":true,"releaseDate":"2010-03-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2010-02-21T18:34:24.841+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Feb 22 13:52:50 UTC 2010","customfield_12310420":"96143","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1225785286_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-02-21T18:34:24.888+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2596/watchers","watchCount":0,"isWatching":false},"created":"2010-02-07T14:04:39.602+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315614","id":"12315614","description":"","name":"4.1.1","archived":false,"released":true,"releaseDate":"2007-06-08"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[{"id":"12335020","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12335020","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12483180","key":"AMQ-2530","self":"https://issues.apache.org/jira/rest/api/2/issue/12483180","fields":{"summary":"memory leak in ConduitBridge (subscriptionMapByRemoteId)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-02-22T19:12:34.505+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I'd like to report a reproducible memory leak in network of brokers.\n\nThis is the scenario you can reproduce it (tried out with 4.1.1, 5.3.0 and 5.3.1):\n1. start two brokers using attached configuration.\n    Lets call one of it BE (for backend) another FE (for frontend) - accordingly: be_activemq.xml and fe_activemq.xml are attached.\n    The BE broker contains following configuration: \n        <transportConnectors>\n            <transportConnector name=\"openwire\" uri=\"tcp://0.0.0.0:61616\"/>\n        </transportConnectors>\n        <networkConnectors>\n           <networkConnector name=\"FE_connector\" dynamicOnly=\"true\" uri=\"static://(tcp://localhost:61617)\"/>\n        </networkConnectors>\n\n    The FE broker contains just:\n        <transportConnectors>\n            <transportConnector name=\"openwire\" uri=\"tcp://0.0.0.0:61617\"/>\n        </transportConnectors>\n\n2. now start a client that opens and close permanently topic subscriptions (see attached tests)\n    to the FE broker\n\n3. after a while you will see (e.g. verbose gc) that the heap usage of the BE broker will increase,\n    but on FE not\n\nIf you analyze the heap dump of BE you will see that the memory leak consist of a large number of ConsumerInfo\nobjects. Easy way to find the objects when you use MAT is to use the OQL query e.g.:\n    SELECT c.destination.physicalName.toString() FROM \".*ConsumerInfo\" c WHERE (c.destination.physicalName.toString() LIKE \"TEST_TOPIC\")\n\nI noticed that basically for each subscription on FE two ConsumerInfo objects are created on BE, which will never be closed.\nThere are however some special cases that only 4, 8 .. 12 objects per connection are created. This happens when the client just opens sessions/subscriptions without closing  (see appropriate junit test with comments in it).\n\nWe have it currently a P1 ticket at our customer site (running 3*FE + BE using 4.1.1) because of OoM that occurs periodically (in fact we now restart  every n-days the system). \n\nAnother strange issue that happens at our customer site is something that I cannot reproduce at all.\nThe ConsumerInfo objects on BE contains there non empty selector strings, which makes the memory leak more critical.\nIn my test environment however selector strings are only set in ConsumerInfo on FE, but in BE broker the selectorin ConsumerInfo is always null!\nI compared the customer configuration with my and I could not find any difference.\n\nAny idea what could influence this behavior?\n\nThanks in advance for any feedback and help on this issue.\nBest Regards,\nMark","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461615","id":"12461615","filename":"be_activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-07T14:09:54.237+0000","size":2123,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461615/be_activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461616","id":"12461616","filename":"fe_activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-07T14:09:54.269+0000","size":2216,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461616/fe_activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461617","id":"12461617","filename":"MemLeakSuspectNetworkOfBrokersTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-07T14:09:54.272+0000","size":5770,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461617/MemLeakSuspectNetworkOfBrokersTest.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"159814","customfield_12312823":null,"summary":"Memory leak in network of brokers - the number of ConsumerInfo objects increases","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"OS: SLES10 SP2 or Ubuntu 9.10 (my desktop)\nJVM: IBM J9 VM (build 2.3, J2RE 1.5.0 IBM J9 2.3 Linux x86-32 j9vmxi3223-20081129 (JIT enabled)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483241/comment/12942175","id":"12942175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"body":"Attached activemq.xms for both brokers and a set of unit tests to reproduce the behavior.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-07T14:09:54.275+0000","updated":"2010-02-07T14:09:54.275+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483241/comment/12942253","id":"12942253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"This is a duplicate of http://issues.apache.org/activemq/browse/AMQ-2530","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-21T18:34:24.841+0000","updated":"2010-02-21T18:34:24.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483241/comment/12942255","id":"12942255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"body":"I run my tests with the changes posted in AMQ 2530 and it definitively fixes the problem! \n\nThanks a lot also for fixing it in 5.3.1 too, since this is the version we are targeting to use.\n\nBest Regards,\nMark","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wum","name":"wum","key":"wum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Wuwer","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-22T13:52:50.018+0000","updated":"2010-02-22T19:12:34.458+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2596/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rpqn:"}}