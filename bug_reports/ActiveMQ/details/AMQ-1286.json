{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483363","self":"https://issues.apache.org/jira/rest/api/2/issue/12483363","key":"AMQ-1286","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2009-08-26T04:18:24.232+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 01 19:55:50 UTC 2011","customfield_12310420":"69443","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_127179003061_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-01T19:55:50.493+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1286/watchers","watchCount":3,"isWatching":false},"created":"2007-06-20T20:25:47.448+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":1209600,"aggregatetimeoriginalestimate":1209600,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315614","id":"12315614","description":"","name":"4.1.1","archived":false,"released":true,"releaseDate":"2007-06-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-07-01T19:55:50.504+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":1209600,"customfield_12310080":null,"description":"We are testing ActiveMQ with STOMP clients in our QA environments.\nWhen we finish testing the brokers stay up running idle in their instances.\nThe next day when we come back for more testing, our STOMP clients hang trying to read the connection response from the broker.\n\n-bash-2.05b$ ./activemq_tester  -d sub\nConnecting......OK\nSending connect message.OK\nReading Response.\n\nThe activemq logs reveal that an out of memory error made the broker unable to spin a worker thread to handle the new connection.\n\nAfter a shutdown and restart of the broker, everything works fine.\nOur broker is lightly loaded during the testing and sits idle overnight so it's not obvious why it would run out of memory.\n\n\name=stomp,ViewType=address,Name=/10.52.90.118_1448\n\nWARN  ManagedTransportConnection     - Failed to register MBean: org.apache.activemq:BrokerName=localhost,Type=Connection,ConnectorName=stomp,ViewType=address,Name=/10.52.90.118_3151\n\nWARN  ManagedTransportConnection     - Failed to register MBean: org.apache.activemq:BrokerName=localhost,Type=Connection,ConnectorName=stomp,ViewType=address,Name=/10.52.90.118_5824\n\nException in thread \"ActiveMQ Transport Server: stomp://plt25m3.etrade.com:61613\" java.lang.OutOfMemoryError: unable to create new native thread\n\n        at java.lang.Thread.start0(Native Method)\n\n        at java.lang.Thread.start(Thread.java:574)\n\n        at org.apache.activemq.transport.TransportThreadSupport.doStart(TransportThreadSupport.java:44)\n\n        at org.apache.activemq.transport.tcp.TcpTransport.doStart(TcpTransport.java:304)\n\n        at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:49)\n\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:54)\n\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:54)\n\n        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:54)\n\n        at org.apache.activemq.broker.TransportConnection.start(TransportConnection.java:816)\n\n        at org.apache.activemq.broker.TransportConnector$1.onAccept(TransportConnector.java:148)\n\n        at org.apache.activemq.transport.tcp.TcpTransportServer.run(TcpTransportServer.java:167)\n\n        at java.lang.Thread.run(Thread.java:595)\n\nException in thread \"RMI RenewClean-[10.52.90.15:59951]\" java.lang.OutOfMemoryError: unable to create new native thread\n\n        at java.lang.Thread.start0(Native Method)\n\n        at java.lang.Thread.start(Thread.java:574)\n\n        at sun.rmi.transport.tcp.TCPChannel.free(TCPChannel.java:322)\n\n        at sun.rmi.server.UnicastRef.free(UnicastRef.java:395)\n\n        at sun.rmi.server.UnicastRef.done(UnicastRef.java:412)\n\n        at sun.rmi.transport.DGCImpl_Stub.dirty(Unknown Source)\n\n        at sun.rmi.transport.DGCClient$EndpointEntry.makeDirtyCall(DGCClient.java:328)\n\n        at sun.rmi.transport.DGCClient$EndpointEntry.access$1600(DGCClient.java:144)\n\n        at sun.rmi.transport.DGCClient$EndpointEntry$RenewCleanThread.run(DGCClient.java:539)\n\n        at java.lang.Thread.run(Thread.java:595)\n\n\nUsing default startup script which allows java vm 512MB and this setting in the conf/activemq.xml file\n\n    <memoryManager>  \n        <usageManager id=\"memory-manager\" limit=\"512 MB\"/>\n    </memoryManager>\n\n","customfield_10010":null,"timetracking":{"originalEstimate":"336h","remainingEstimate":"336h","originalEstimateSeconds":1209600,"remainingEstimateSeconds":1209600},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":1209600,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172407","customfield_12312823":null,"summary":"Out of Memory Causing STOMP connection failure","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bikeracer","name":"bikeracer","key":"bikeracer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Schaubert","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bikeracer","name":"bikeracer","key":"bikeracer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Schaubert","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":1209600,"percent":0},"customfield_12311024":null,"environment":"linux redhat AS/3\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":1209600,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483363/comment/12936224","id":"12936224","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bikeracer","name":"bikeracer","key":"bikeracer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Schaubert","active":true,"timeZone":"Etc/UTC"},"body":"\nConfirmed to be caused by the netscaler VIP checking every 5 seconds to see if the broker is still alive.\nChanging the algorithm on the load balancer to use ping checking instead of the default tcp connection testing resolved the issue.\n\nStill probably worth investigating why the tcp connection ping causes the STOMP connector to exaust all memory.\n\nJoel Schaubert\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bikeracer","name":"bikeracer","key":"bikeracer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Schaubert","active":true,"timeZone":"Etc/UTC"},"created":"2007-07-20T19:36:05.921+0000","updated":"2007-07-20T19:36:05.921+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483363/comment/12941424","id":"12941424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deathemperor","name":"deathemperor","key":"deathemperor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Loc Truong","active":true,"timeZone":"Etc/UTC"},"body":"I can reproduce this.\n\nThis actually is affecting our business. When the AMQ is up for 7 to 10 days (a quite short time) with 18m to 22m of messages, this errors occurs and we have to restart it manually.\n\nWould love to have a patch instead of waiting for 5.4 which is way ahead (5.2 is just out)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deathemperor","name":"deathemperor","key":"deathemperor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Loc Truong","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-26T04:18:24.232+0000","updated":"2009-08-26T04:18:24.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483363/comment/12941432","id":"12941432","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bikeracer","name":"bikeracer","key":"bikeracer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Schaubert","active":true,"timeZone":"Etc/UTC"},"body":"Hi Loc,\nWe traced this down to a problem with the way the monitoring system was\nchecking to see if the broker was alive.   The monitor was pinging the\nbroker in a way that caused the broker to open up and dedicate resources for\na new connection,  but the monitor did not do what was necessary to allow\nthe broker to finish.\n\nIf you have some ping/monitor looking at your broker you should try changing\nthe method it uses to do its health checking.\n\nCan I ask what kind of application you are using ActiveMQ for?\n\nJoel Schaubert\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bikeracer","name":"bikeracer","key":"bikeracer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Schaubert","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-26T13:15:50.368+0000","updated":"2009-08-26T13:15:50.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483363/comment/12941435","id":"12941435","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deathemperor","name":"deathemperor","key":"deathemperor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Loc Truong","active":true,"timeZone":"Etc/UTC"},"body":"Oh, I see your point. I may have misunderstood that sadly.\n\nWe are using ActiveMQ to collect a large number of information from clients such as download, real time click  tracking, real time client IP (the country uses dynamic IPs).\n\nAnyway, I got the same exact error as reported which is out of memory. We didn't let the AMQ to get too many pending messages (at first we thought this is the problem), but this error keeps happening.\n\nAdditional information: The \"WARN  ManagedTransportConnection     - Failed to register MBean: org.apache.activemq:BrokerName=localhost,Type=Connection,ConnectorName=stomp,ViewType\" error is actually the last error in our AMQ log but it doesn't \"die\". I've seen this many times before. It's also the last error log we got when it \"dies\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deathemperor","name":"deathemperor","key":"deathemperor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Loc Truong","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-26T13:25:42.517+0000","updated":"2009-08-26T13:25:42.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483363/comment/13058747","id":"13058747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Configuration issue, a broker can't accept new connections when it runs out of memory or OS file descriptors etc.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-07-01T19:55:50.502+0000","updated":"2011-07-01T19:55:50.502+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1286/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tvgv:"}}