{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482287","self":"https://issues.apache.org/jira/rest/api/2/issue/12482287","key":"AMQ-1577","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-02-07T10:03:20.176+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Oct 17 11:16:24 UTC 2015","customfield_12310420":"84644","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_234604069_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2008-02-07T10:03:20.202+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1577/watchers","watchCount":2,"isWatching":false},"created":"2008-02-04T16:53:16.133+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-17T11:16:24.793+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Hello,\n\nThere's a problem with the FailoverTransport not shutting down cleanly.  It appears that it shuts down it's underlying transport, e.g. TcpTransport, but then doesn't disable it's handleTransportFailure thread, which then complains that the underlying transport has gone away, and tries to restart it again.\n\nLooking at the code in FailoverTransport.java, there appears to be a simple fix, to check the 'started' variable in the method 'handleTransportFailure' before logging a warning and trying to restart the underlying transport.\n\nHere's a log snippet that demonstrates the problem:\n\nDEBUG [2008-02-04 03:44:05,752] thread:main                                FailoverTransport -- Stopped.\nDEBUG [2008-02-04 03:44:05,753] thread:main                                     TcpTransport -- Stopping transport tcp://localhost/127.0.0.1:61616\nWARN  [2008-02-04 03:44:05,760] thread:ActiveMQ Transport: tcp://localhost/127.0.0.1:61616              FailoverTransport -- Transport failed, attempting to automatically reconnect due to: java.net.SocketException: Socket closed\njava.net.SocketException: Socket closed\n        at java.net.SocketInputStream.socketRead0(Native Method)\n        at java.net.SocketInputStream.read(SocketInputStream.java:129)\n        at org.apache.activemq.transport.tcp.TcpBufferedInputStream.fill(TcpBufferedInputStream.java:50)\n        at org.apache.activemq.transport.tcp.TcpBufferedInputStream.read(TcpBufferedInputStream.java:58)\n        at java.io.DataInputStream.readInt(DataInputStream.java:351)\n        at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:267)\n        at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:203)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:195)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:183)\n        at java.lang.Thread.run(Thread.java:637)\n\n\nJason","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461069","id":"12461069","filename":"ConnectionPool.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg","name":"jbrosenberg","key":"jbrosenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-02-07T05:52:36.657+0000","size":8147,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461069/ConnectionPool.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460937","id":"12460937","filename":"FailoverTransport.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg","name":"jbrosenberg","key":"jbrosenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-02-07T05:52:36.549+0000","size":27425,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12460937/FailoverTransport.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161750","customfield_12312823":null,"summary":"FailoverTransport doesn't shut-down cleanly, complains about underlying transport going down","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg","name":"jbrosenberg","key":"jbrosenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg","name":"jbrosenberg","key":"jbrosenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"5.1-SNAPSHOT","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482287/comment/12939316","id":"12939316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg","name":"jbrosenberg","key":"jbrosenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/Los_Angeles"},"body":"I've included a patch built against a recent 5.1-SNAPSHOT source (svn rev 618082)\n\nThe file FailoverTransport.java, includes fixes for 4 issues, including my fix for this issue.\n\nThe other issues that this patch includes fixes for are:\n\nAMQ-1116\nAMQ-1575\nAMQ-1577\nAMQ-1581\n\nThe file ConnectionPool.java is also needed for the fix for AMQ-1581\n\nI've added comments in the code that clearly indicate which sections apply to which issue, so you can easily take edit to include only the fixes you want specifically.\n\nJason\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg","name":"jbrosenberg","key":"jbrosenberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-02-07T05:52:36.685+0000","updated":"2008-02-07T05:52:36.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482287/comment/12936643","id":"12936643","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed by svn revision 619336","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2008-02-07T10:03:20.176+0000","updated":"2008-02-07T10:03:20.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482287/comment/14961850","id":"14961850","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=memelet","name":"memelet","key":"memelet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barry Kaplan","active":true,"timeZone":"Etc/UTC"},"body":"I appear to be seeing this behavior in 5.12. When disconnected from the broker and jmv receives a sigterm the jvm is prevented from exiting (some daemon thread?)\n\n2015-10-17 11:13:21,690 INFO  mono-server - Stopping mono-server server ---------------------------------------------------- | tenant=tft, name=mono-server [shutdownHook1] \n2015-10-17 11:13:21,696 INFO  s.can.server.HttpListener - Unbound from /0.0.0.0:8282 | akkaSource=akka://mono-server/user/IO-HTTP/listener-0, sourceThread=mono-server-akka.actor.default-dispatcher-5, tenant=tft, name=mono-server [mono-server-akka.actor.default-dispatcher-2] \n2015-10-17 11:13:21,697 INFO  s.restapi.service.RestApi - Stopped REST API | tenant=tft, name=mono-server [shutdownHook1] \n2015-10-17 11:13:21,703 INFO  c.b.f.WatchServiceTask - Interrupting, bye! | tenant=tft, name=mono-server [WatchService] \n2015-10-17 11:13:41,828 DEBUG o.a.a.t.f.FailoverTransport - urlList connectionList:[tcp://localhost:61616], from: [tcp://localhost:61616] | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:13:41,828 DEBUG o.a.a.t.f.FailoverTransport - Attempting  13th  connect to: tcp://localhost:61616 | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:13:41,829 DEBUG o.a.a.t.f.FailoverTransport - Connect fail to: tcp://localhost:61616, reason: java.net.ConnectException: Connection refused | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:13:41,829 DEBUG o.a.a.t.tcp.TcpTransport - Stopping transport tcp://localhost:61616 | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:13:41,830 DEBUG o.a.a.t.tcp.TcpTransport - Closed socket Socket[unconnected] | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:13:41,830 DEBUG o.a.a.t.f.FailoverTransport - Waiting 30000 ms before attempting connection | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:11,831 DEBUG o.a.a.t.f.FailoverTransport - urlList connectionList:[tcp://localhost:61616], from: [tcp://localhost:61616] | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:11,832 DEBUG o.a.a.t.f.FailoverTransport - Attempting  14th  connect to: tcp://localhost:61616 | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:11,832 DEBUG o.a.a.t.f.FailoverTransport - Connect fail to: tcp://localhost:61616, reason: java.net.ConnectException: Connection refused | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:11,832 DEBUG o.a.a.t.tcp.TcpTransport - Stopping transport tcp://localhost:61616 | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:11,833 DEBUG o.a.a.t.tcp.TcpTransport - Closed socket Socket[unconnected] | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:11,833 DEBUG o.a.a.t.f.FailoverTransport - Waiting 30000 ms before attempting connection | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:41,836 DEBUG o.a.a.t.f.FailoverTransport - urlList connectionList:[tcp://localhost:61616], from: [tcp://localhost:61616] | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:41,837 DEBUG o.a.a.t.f.FailoverTransport - Attempting  15th  connect to: tcp://localhost:61616 | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:41,838 DEBUG o.a.a.t.f.FailoverTransport - Connect fail to: tcp://localhost:61616, reason: java.net.ConnectException: Connection refused | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:41,838 DEBUG o.a.a.t.tcp.TcpTransport - Stopping transport tcp://localhost:61616 | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:41,838 DEBUG o.a.a.t.tcp.TcpTransport - Closed socket Socket[unconnected] | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:14:41,838 DEBUG o.a.a.t.f.FailoverTransport - Waiting 30000 ms before attempting connection | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:15:11,842 DEBUG o.a.a.t.f.FailoverTransport - urlList connectionList:[tcp://localhost:61616], from: [tcp://localhost:61616] | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:15:11,842 DEBUG o.a.a.t.f.FailoverTransport - Attempting  16th  connect to: tcp://localhost:61616 | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:15:11,842 DEBUG o.a.a.t.f.FailoverTransport - Connect fail to: tcp://localhost:61616, reason: java.net.ConnectException: Connection refused | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:15:11,842 DEBUG o.a.a.t.tcp.TcpTransport - Stopping transport tcp://localhost:61616 | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:15:11,843 DEBUG o.a.a.t.tcp.TcpTransport - Closed socket Socket[unconnected] | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:15:11,843 DEBUG o.a.a.t.f.FailoverTransport - Waiting 30000 ms before attempting connection | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:15:41,846 DEBUG o.a.a.t.f.FailoverTransport - urlList connectionList:[tcp://localhost:61616], from: [tcp://localhost:61616] | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:15:41,846 DEBUG o.a.a.t.f.FailoverTransport - Attempting  17th  connect to: tcp://localhost:61616 | name=mono-server [ActiveMQ Task-1] \n2015-10-17 11:15:41,847 DEBUG o.a.a.t.f.FailoverTransport - Connect fail to: tcp://localhost:61616, reason: java.net.ConnectException: Connection refused | name=mono-server [ActiveMQ Task-1] ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=memelet","name":"memelet","key":"memelet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barry Kaplan","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-17T11:16:24.793+0000","updated":"2015-10-17T11:16:24.793+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1577/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s1ov:"}}