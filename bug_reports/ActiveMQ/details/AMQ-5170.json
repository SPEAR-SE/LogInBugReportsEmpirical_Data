{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12712018","self":"https://issues.apache.org/jira/rest/api/2/issue/12712018","key":"AMQ-5170","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2014-05-26T11:20:03.373+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon May 26 11:20:03 UTC 2014","customfield_12310420":"390337","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2043675336_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-05-26T11:20:03.345+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5170/watchers","watchCount":2,"isWatching":false},"created":"2014-05-02T19:38:48.046+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-05-26T11:23:15.265+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"ActiveMQ seems to ignore the selector query specified and works on initial get but will not deliver messages on subsequent requests.\n\nSteps to Reproduce\n1. Create a queue in ActiveMQ called “test”.\n\n2. Modify shipped ProducerTool.java with following change on the method \"sendLoop\":\n{code}\nprotected void sendLoop(Session session, MessageProducer producer) throws Exception {\n\n        for (int i = 0; i < messageCount || messageCount == 0; i++) {\n\n            TextMessage message = session.createTextMessage(createMessageText(i));\n\n            if (i%2 == 0) {\n                message.setIntProperty(\"prop\", 1);\n            } else {\n                message.setIntProperty(\"prop\", 2);\n            }\n\n            if (verbose) {\n                String msg = message.getText();\n                if (msg.length() > 50) {\n                    msg = msg.substring(0, 50) + \"...\";\n                }\n                System.out.println(\"[\" + this.getName() + \"] Sending message: '\" + msg + \"'\");\n            }\n\n            producer.send(message);\n\n            if (transacted) {\n                System.out.println(\"[\" + this.getName() + \"] Committing \" + messageCount + \" message\ns\");\n                session.commit();\n            }\n            Thread.sleep(sleepTime);\n        }\n    }\n{code} \n\n3. send 5 messages to broker with following command:\n{code}\nant producer -Dsubject=test -Dtopic=false -Ddurable=true -Dmax=5 -DmessageSize=50 -Duser=admin -Dpassword=admin\n{code}\n\n4. Using any REST client, specify the URL with selector: \n{code}\nhttp://localhost:8161/api/message/test?type=queue&prop=2\n{code}\nand execute the consumer REST request to download the message from the event queue.\n\n5. The first message will always get downloaded regardless of selector query whether it matches or not. Since above rest URL with the selector should not get the first message as the first message has Int Property \"prop=1\" which does not match the selector.\n\n6. Then try with following rest URL from another REST client:\n{code}\nhttp://localhost:8161/api/message/test?type=queue&prop=1\n{code}\nRegardless of selector query or even without a selector, this client will not be able to download any message and all messages will remain in the queue.\n\nExpected Behavior\nThe ActiveMQ broker should respect the message selector query when specified by the consumer application using the REST interface.  Using the steps outlined above with the openwire protocol (tcp/ip) works i.e. creating the MessageConsumer as:\n{code}\nMessageConsumer consumer = session.createConsumer(destination, \"prop=1\");\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"390592","customfield_12312823":null,"summary":"Selectors in AMQ through REST does not work properly","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joeluo","name":"joeluo","key":"joeluo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joe Luo","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joeluo","name":"joeluo","key":"joeluo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joe Luo","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Tested with the following client utilities:\nwget (GNU Wget 1.11.4)\nAdvanced REST client 3.1.7 (Google Chrome extension)\nRestClient 2.0.3 (Firefox extension)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712018/comment/14008764","id":"14008764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"This already works, you just need to pass the selector as a HTTP header and not a parameter. See\n\nhttp://activemq.apache.org/rest.html#REST-Consumingwithselectors\n\nfor more information.\n\nFor the given example, I'd also suggest using clientId option as it will give more control over subscribing/unsubscribing from the queue without using sessions.\n\nSo for this particular example, two producers created like this\n\n{code}wget -qO- --user admin --password admin --header=\"selector: prop=1\" 'http://localhost:8161/api/message/test?type=queue&clientId=consumer1'\nwget -qO- --user admin --password admin --header=\"selector: prop=2\" 'http://localhost:8161/api/message/test?type=queue&clientId=consumer2'{code}\n\nshould do the trick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2014-05-26T11:20:03.373+0000","updated":"2014-05-26T11:23:15.257+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5170/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1v8hz:"}}