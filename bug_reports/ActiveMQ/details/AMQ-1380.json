{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483018","self":"https://issues.apache.org/jira/rest/api/2/issue/12483018","key":"AMQ-1380","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2007-09-11T10:03:06.361+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 24 08:33:57 UTC 2009","customfield_12310420":"84544","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_18740204703_*|*_5_*:*_2_*:*_13429351540_*|*_4_*:*_1_*:*_27245940486","customfield_12312321":null,"resolutiondate":"2009-07-24T08:33:57.097+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1380/watchers","watchCount":5,"isWatching":false},"created":"2007-09-05T16:15:40.368+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315614","id":"12315614","description":"","name":"4.1.1","archived":false,"released":true,"releaseDate":"2007-06-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-24T08:33:57.047+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The following exception is thrown from an ActiveMQ instance that is in Slave mode that causes it to crash.\n\njava.io.FileNotFoundException: ***/*******/*****/*******/journal/control.dat (Too many open files)\n        at java.io.RandomAccessFile.open(Native Method)\n        at java.io.RandomAccessFile.<init>(RandomAccessFile.java:212)\n        at org.apache.activeio.journal.active.ControlFile.<init>(ControlFile.java:60)\n        at org.apache.activeio.journal.active.LogFileManager.initialize(LogFileManager.java:119)\n        at org.apache.activeio.journal.active.LogFileManager.<init>(LogFileManager.java:102)\n        at org.apache.activeio.journal.active.JournalImpl.<init>(JournalImpl.java:101)\n        at org.apache.activemq.store.DefaultPersistenceAdapterFactory.createJournal(DefaultPersistenceAdapterFactory.java:224)\n        at org.apache.activemq.store.DefaultPersistenceAdapterFactory.getJournal(DefaultPersistenceAdapterFactory.java:132)\n        at org.apache.activemq.store.DefaultPersistenceAdapterFactory.createPersistenceAdapter(DefaultPersistenceAdapterFactory.java:70)\n        at org.apache.activemq.store.PersistenceAdapterFactoryBean.getObject(PersistenceAdapterFactoryBean.java:35)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getObjectFromFactoryBean(AbstractBeanFactory.java:994)\n        ... 41 more\n\nThe problem is that each time ActiveIO checks to see if control.dat is locked it creates a new java.io.RandomAccessFile.  If the control.dat file is locked, it fails to close the RandomAccessFile.\n\nThis exception always will be thrown from an instance in Shared-File-System Slave mode that continues to check the Journal file (which the Master has locked).  But the rate at which is is thrown depends on the maximum number of files the OS allows to be open.  You can check how many files are open with 'ulimit -a'","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460809","id":"12460809","filename":"ASF.LICENSE.NOT.GRANTED--patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpkutner","name":"jpkutner","key":"jpkutner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joe Kutner","active":true,"timeZone":"Etc/UTC"},"created":"2007-09-05T16:15:40.491+0000","size":1010,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12460809/ASF.LICENSE.NOT.GRANTED--patch.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"161693","customfield_12312823":null,"summary":"ActiveIO does not close ControlFile ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpkutner","name":"jpkutner","key":"jpkutner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joe Kutner","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpkutner","name":"jpkutner","key":"jpkutner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joe Kutner","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"All","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483018/comment/12939038","id":"12939038","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lauvigne","name":"lauvigne","key":"lauvigne","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lilians AUVIGNE","active":true,"timeZone":"Etc/UTC"},"body":"I'm having the same problem.\n\nThis patch solve it.\n\nCould you add this issue at 4.1.2 RoadMap. \n\nThanks Joe for this patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lauvigne","name":"lauvigne","key":"lauvigne","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lilians AUVIGNE","active":true,"timeZone":"Etc/UTC"},"created":"2007-09-11T10:03:06.361+0000","updated":"2007-09-11T10:03:06.361+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483018/comment/12939304","id":"12939304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=palmsun","name":"palmsun","key":"palmsun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shahram Javey","active":true,"timeZone":"Etc/UTC"},"body":"This patch is still not part of ActiveMQ 5.0,  where slave file handle leaks are still an issue. I manually applied this patch and it fixed the problem. Why is this patch not part of 5.0? Running a master/slave (persistence based on journal file-system) using a conf file below, leads to the crash of the slave after a few hours, due to running out of open files. If you monitor the number of open files (lsof | wc -l), you'll see that the number of open files keeps increasing every 10 seconds. With this patch, this is no-longer a problem. Please include this patch in the release. Here is the conf file that I've used for master/slave (the only difference is that the value of the IP address in the  broker name and the  transport connector)\n\n<beans\n  xmlns=\"http://www.springframework.org/schema/beans\"\n  xmlns:amq=\"http://activemq.org/config/1.0\"\n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd\n  http://activemq.org/config/1.0 http://activemq.apache.org/schema/activemq-core.xsd\n  http://activemq.apache.org/camel/schema/spring http://activemq.apache.org/camel/schema/spring/camel-spring.xsd\">\n\n  <!-- Allows us to use system properties as variables in this configuration file -->\n  <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"/>\n  \n  <broker xmlns=\"http://activemq.org/config/1.0\" brokerName=\"10.0.1.200\" useJmx=\"false\">\n  \n    <!-- The transport connectors ActiveMQ will listen to -->\n    <transportConnectors>\n       <transportConnector name=\"openwire\" uri=\"tcp://10.0.1.200:61616?trace=true\"/>\n    </transportConnectors>\n\t<persistenceAdapter>\n\t      <journaledJDBC dataDirectory=\"/Users/sjavey/amq-broker-data\"/>\n\t</persistenceAdapter>\n\n  </broker>\n\n  <!-- An embedded servlet engine for serving up the Admin console -->\n  <jetty xmlns=\"http://mortbay.com/schemas/jetty/1.0\">\n    <connectors>\n      <nioConnector port=\"8161\" />\n    </connectors>\n\n    <handlers>\n      <webAppContext contextPath=\"/admin\" resourceBase=\"${activemq.base}/webapps/admin\" logUrlOnStart=\"true\" />\n    </handlers>\n  </jetty>\n  \n</beans>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=palmsun","name":"palmsun","key":"palmsun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shahram Javey","active":true,"timeZone":"Etc/UTC"},"created":"2008-01-28T04:20:27.333+0000","updated":"2008-01-28T05:54:50.576+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483018/comment/12939002","id":"12939002","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=palmsun","name":"palmsun","key":"palmsun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shahram Javey","active":true,"timeZone":"Etc/UTC"},"body":"Why the activeio-core in ActiveMQ lib (activeio-core-3.1-SNAPSHOT.jar) is still labeled as SNAPSHOT? is this a bug in the build label? It is odd to have 5.0 as a released version but it still includes a SNAPSHOT jar. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=palmsun","name":"palmsun","key":"palmsun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shahram Javey","active":true,"timeZone":"Etc/UTC"},"created":"2008-01-28T06:04:57.276+0000","updated":"2008-01-28T06:04:57.276+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483018/comment/12939469","id":"12939469","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Patch applied in rev 646352","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2008-04-09T13:52:25.050+0000","updated":"2008-04-09T13:52:25.050+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483018/comment/12940181","id":"12940181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vadimos","name":"vadimos","key":"vadimos","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vadim Katz","active":true,"timeZone":"Etc/UTC"},"body":"It does not look like the patch made it into activeio-core-3.1.0 which is included in 5.1.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vadimos","name":"vadimos","key":"vadimos","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vadim Katz","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-12T00:14:56.590+0000","updated":"2008-09-12T00:14:56.590+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483018/comment/12940445","id":"12940445","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmiranda","name":"dmiranda","key":"dmiranda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Douglas Miranda","active":true,"timeZone":"Etc/UTC"},"body":"hello Friends!\n\nI'd like to know how can I apply that patch? I've tried to find a way, but I can't find out anything. \n\ncan anybody give some help?\n\nThank you!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmiranda","name":"dmiranda","key":"dmiranda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Douglas Miranda","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T13:54:27.180+0000","updated":"2008-11-03T13:55:21.545+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483018/comment/12941788","id":"12941788","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"ActiveIO 3.1.2 has just been released with this patch included. It will be included by default in 5.3.0. For earlier versions, download the jar from https://repository.apache.org/content/repositories/releases/org/apache/activemq/activeio-core/3.1.2/ and put it in lib/optional folder.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2009-07-24T08:33:57.021+0000","updated":"2009-07-24T08:33:57.021+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1380/votes","votes":7,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s1c7:"}}