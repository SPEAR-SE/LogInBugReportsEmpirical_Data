{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12642778","self":"https://issues.apache.org/jira/rest/api/2/issue/12642778","key":"AMQ-4472","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-04-22T15:22:53.985+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Apr 26 15:43:10 UTC 2013","customfield_12310420":"323192","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_856335457_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-04-26T15:43:10.285+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4472/watchers","watchCount":2,"isWatching":false},"created":"2013-04-16T17:50:54.860+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["transactions"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"}],"issuelinks":[{"id":"12391615","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12391615","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12727771","key":"AMQNET-484","self":"https://issues.apache.org/jira/rest/api/2/issue/12727771","fields":{"summary":"A consumer in a Transacted Session with no pending Acks can be eagerly closed.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-07-16T20:30:24.901+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When using transactions an issue can arise where the consumer has messages in it's prefetch and when consumer.close() is called the consumer is not closed and does not release the messages.  \n\n\nThe use case is as follows:\n\n1) Create producer\n2) Create consumer\n3) Send message to queue\n4) Commit session\n5) Send a new message\n6) Close the consumer\n7) Start a new consumer\n8) Try to receive the message\n\nTest case will be attached shortly.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12578985","id":"12578985","filename":"amq-4472.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsherman1","name":"jsherman1","key":"jsherman1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jsherman1&avatarId=13244","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jsherman1&avatarId=13244","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jsherman1&avatarId=13244","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jsherman1&avatarId=13244"},"displayName":"Jason Sherman","active":true,"timeZone":"America/New_York"},"created":"2013-04-16T18:57:38.639+0000","size":25502,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12578985/amq-4472.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"323537","customfield_12312823":null,"summary":"consumer.close() on transacted session does not release prefetched messages","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsherman1","name":"jsherman1","key":"jsherman1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jsherman1&avatarId=13244","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jsherman1&avatarId=13244","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jsherman1&avatarId=13244","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jsherman1&avatarId=13244"},"displayName":"Jason Sherman","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsherman1","name":"jsherman1","key":"jsherman1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jsherman1&avatarId=13244","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jsherman1&avatarId=13244","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jsherman1&avatarId=13244","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jsherman1&avatarId=13244"},"displayName":"Jason Sherman","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12642778/comment/13633083","id":"13633083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsherman1","name":"jsherman1","key":"jsherman1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jsherman1&avatarId=13244","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jsherman1&avatarId=13244","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jsherman1&avatarId=13244","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jsherman1&avatarId=13244"},"displayName":"Jason Sherman","active":true,"timeZone":"America/New_York"},"body":"If you commit after the close, the test will work as expected and the first consumer is shutdown.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsherman1","name":"jsherman1","key":"jsherman1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jsherman1&avatarId=13244","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jsherman1&avatarId=13244","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jsherman1&avatarId=13244","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jsherman1&avatarId=13244"},"displayName":"Jason Sherman","active":true,"timeZone":"America/New_York"},"created":"2013-04-16T17:55:38.496+0000","updated":"2013-04-16T17:55:38.496+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12642778/comment/13638097","id":"13638097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"prefetch=0 works around this. but the problem is that a new transaction is created on the session by the second send, and the close is deferred till that commits (the close registers a synchroniztion if there is a transaction).\nWith prefetch=0, the consumer has no pending messages so the effect of the deferred close is invisible.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-22T15:22:53.985+0000","updated":"2013-04-22T15:22:53.985+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12642778/comment/13640814","id":"13640814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"So using preftech=0 is just a work-around. It should also work for any preftech value.\nIMO, as long as the consumer has not acked any of the prefetched messages, it should not consider itself as being part of the transaction.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2013-04-24T19:16:42.412+0000","updated":"2013-04-24T19:16:42.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12642778/comment/13642966","id":"13642966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"fix in http://svn.apache.org/r1471673","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-26T15:43:10.309+0000","updated":"2013-04-26T15:43:10.309+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4472/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1jrev:"}}