{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12756114","self":"https://issues.apache.org/jira/rest/api/2/issue/12756114","key":"AMQ-5443","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-02-17T15:10:13.518+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Feb 17 15:10:13 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5443/watchers","watchCount":3,"isWatching":false},"created":"2014-11-18T14:48:39.832+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["security"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-02-17T15:10:13.518+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When using SSL the server certificate's common name (or subjectAltName) must be validated in order to prevent a man-in-the-middle attack.  The ActiveMQ client does not do this by default and makes doing so somewhat difficult.\n\nThe result is that most applications that use the ActiveMQ client with SSL are not getting the security they think they are.  For a very good explanation of this hostname verification issue, see http://tersesystems.com/2014/03/23/fixing-hostname-verification/\n\nIt is worth nothing that ActiveMQ was specifically mentioned in a paper titled \"The Most Dangerous Code in the World:  Validating SSL Certificates in Non-Browser Software\" (https://www.cs.utexas.edu/~shmat/shmat_ccs12.pdf):\n\n\"Java-based Web-services middleware, such as Apache Axis, Axis 2, and Codehaus XFire, is broken, too. So is the Android library for Pusher notification API and Apache ActiveMQ implementation of Java Message Service. All programs employing this middleware are generically insecure.\"\n\nAlso, ActiveMQ is specifically mentioned in CVE-2012-5784 (http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-5784) as an example of a library that does not do host name checking.  I can't explain why this hasn't been a bigger deal (am I missing something?).\n\nWe have worked around this in our code by providing our own connection factory class that inherits from ActiveMQSslConnectionFactory.  It overrides the createTrustManager() and setKeyAndTrustManagers(...) methods in order to \"decorate\" the real TrustManagers with a check for certificate host name.  Currently, it uses org.apache.http.conn.ssl.SSLConnectionSocketFactory.BROWSER_COMPATIBLE_HOSTNAME_VERIFIER from the Apache HTTP Client project to verify the host name, which works for our project because we already use the Apache HTTP Client elsewhere.\n\nI created this issue with a Major priority, although it could be argued that it's Critical because it's security related and likely to affect so many people.  ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12682172","id":"12682172","filename":"MyActiveMQSslConnectionFactory.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadden","name":"ahadden","key":"ahadden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Hadden","active":true,"timeZone":"America/New_York"},"created":"2014-11-18T14:54:34.549+0000","size":4425,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12682172/MyActiveMQSslConnectionFactory.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"SSL client does not validate server certificate common name","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadden","name":"ahadden","key":"ahadden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Hadden","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadden","name":"ahadden","key":"ahadden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Hadden","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12756114/comment/14216250","id":"14216250","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadden","name":"ahadden","key":"ahadden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Hadden","active":true,"timeZone":"America/New_York"},"body":"Added an example workaround connection factory (MyActiveMQSslConnectionFactory.java).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadden","name":"ahadden","key":"ahadden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Allen Hadden","active":true,"timeZone":"America/New_York"},"created":"2014-11-18T14:54:34.563+0000","updated":"2014-11-18T14:55:07.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12756114/comment/14324275","id":"14324275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Now that we require JDK v1.7 a simpler fix might be to use the HTTPS endpoint identification algorithm when configuring the SSLParameters.  \n\n{code}\n        if (isVerifyHost()) {\n            SSLParameters sslParameters = engine.getSSLParameters();\n            sslParameters.setEndpointIdentificationAlgorithm(\"HTTPS\");\n            engine.setSSLParameters(sslParameters);\n        }\n{code}\n\nWe'd be happy to review a patch along these lines, it should have unit tests along with it to validate things work as expected with checking enabled or disabled.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-02-17T15:10:13.518+0000","updated":"2015-02-17T15:10:13.518+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5443/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i22ib3:"}}