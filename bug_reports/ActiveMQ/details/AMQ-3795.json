{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12549142","self":"https://issues.apache.org/jira/rest/api/2/issue/12549142","key":"AMQ-3795","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329258","id":"12329258","name":"5.12.0","archived":false,"released":true,"releaseDate":"2015-08-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-07-17T23:02:48.076+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 12 17:03:17 UTC 2015","customfield_12310420":"234133","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_106035533263_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-08-12T17:03:17.380+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3795/watchers","watchCount":1,"isWatching":false},"created":"2012-04-02T10:44:24.206+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["LSB"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318548","id":"12318548","name":"5.4.3","archived":false,"released":true,"releaseDate":"2011-10-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12318549","id":"12318549","name":"5.5.1","archived":false,"released":true,"releaseDate":"2011-10-16"}],"issuelinks":[{"id":"12355238","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12355238","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12554314","key":"AMQ-3831","self":"https://issues.apache.org/jira/rest/api/2/issue/12554314","fields":{"summary":"Exit code is not properly returned when using RUN_AS_USER","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12355706","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12355706","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12483685","key":"AMQ-2170","self":"https://issues.apache.org/jira/rest/api/2/issue/12483685","fields":{"summary":"Incoherent documentation / strange property names for advisory messages","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-08-12T17:03:17.432+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Just like in AMQ-3050, I tried to integrate ActiveMQ into a pacemaker setup.\n\nAs supposed to work, pacemaker should recognize a frozen or dead process an restart the service. For ActiveMQ 5.4.3 and 5.5.1 this does not work in the following two scenarios:\n\n\n(1) PID file present, JRE process crashed\n\nPacemaker recognizes this correctly (status gives return code 1) and calls \"stop\" to give the script the chance to deal with the situation (remove stale PID file e.g.). Since this is done successfully it should give a return code of 0, actually it is 1. A return code of 1 tells pacemaker something went wrong when stopping the service, so it changes the state of the resource to \"unmanaged (FAILED)\" leaving the service in down state.\n\n\n(2) PID file present, JRE process present, but frozen for some reason\n\nFirst, pacemaker doesn't recognize this (\"status\" gives return code 0 = running, should be non-zero), so maybe \"status\" should connect to the JRE and try talk to ActiveMQ in some way instead of just looking for a process?\n\nFurthermore, if called with \"stop\" in this case (simulated by sending SIGSTOP to the process), the script tries to connect to the JRE to stop it, fails to do so and finally kills the process forcefully. Since it (in some way) successfully stopped the service, it should return 0, but actually it's 1 as well.\n\n\nReturn values needed for LSB compliance are given here: http://refspecs.linuxbase.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/iniscrptact.html","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81441","customfield_12312823":null,"summary":"ActiveMQ standalone script not fully LSB compliant","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreas.krause","name":"andreas.krause","key":"andreas.krause","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Krause","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreas.krause","name":"andreas.krause","key":"andreas.krause","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Krause","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12549142/comment/13244115","id":"13244115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreas.krause","name":"andreas.krause","key":"andreas.krause","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Krause","active":true,"timeZone":"Europe/Berlin"},"body":"What I've done to reproduce these two scenarios:\n\n# Scenario (1)\n\n$ sudo /opt/activemq/bin/activemq status ; echo \"return code: $?\"\nINFO: Loading '/etc/default/activemq'\nINFO: Using java '/usr/java/default/bin/java'\nActiveMQ is running (pid '26711')\nreturn code: 0\n$ sudo kill 26711\t\t\t\t\t\t\t\t\t# process dies (simulated)\n$ sudo /opt/activemq/bin/activemq status ; echo \"return code: $?\"\nINFO: Loading '/etc/default/activemq'\nINFO: Using java '/usr/java/default/bin/java'\nActiveMQ not running\nreturn code: 1\t\t\t\t\t\t\t\t\t\t# correct\n$ sudo /opt/activemq/bin/activemq stop ; echo \"return code: $?\"\nINFO: Loading '/etc/default/activemq'\nINFO: Using java '/usr/java/default/bin/java'\nERROR: No or outdated process id in '/opt/activemq/data/activemq.pid'\n\nINFO: Removing /opt/activemq/data/activemq.pid\nreturn code: 1\t\t\t\t\t\t\t\t\t\t# wrong!\n$ sudo /opt/activemq/bin/activemq stop ; echo \"return code: $?\"\nINFO: Loading '/etc/default/activemq'\nINFO: Using java '/usr/java/default/bin/java'\nActiveMQ not running\nreturn code: 0\t\t\t\t\t\t\t\t\t\t# correct\n\n\n# Scenario (2)\n\n$ sudo /opt/activemq/bin/activemq status ; echo \"return code: $?\"\nINFO: Loading '/etc/default/activemq'\nINFO: Using java '/usr/java/default/bin/java'\nActiveMQ is running (pid '28852')\nreturn code: 0\n$ sudo kill -SIGSTOP 28852\t\t\t\t\t\t\t\t# process freezes (simulated)\n$ sudo /opt/activemq/bin/activemq status ; echo \"return code: $?\"\nINFO: Loading '/etc/default/activemq'\nINFO: Using java '/usr/java/default/bin/java'\nActiveMQ is running (pid '28852')\nreturn code: 0\t\t\t\t\t\t\t\t\t\t# wrong\n$ sudo /opt/activemq/bin/activemq stop ; echo \"return code: $?\"\nINFO: Loading '/etc/default/activemq'\nINFO: Using java '/usr/java/default/bin/java'\nINFO: changing to user 'activemq' to invoke java\nINFO: Waiting at least 30 seconds for regular process termination of pid '28852' : \nJava Runtime: Sun Microsystems Inc. 1.6.0_30 /usr/java/jdk1.6.0_30/jre\n  Heap sizes: current=251264k  free=249951k  max=251264k\n    JVM args: -Xms256M -Xmx256M -Dorg.apache.activemq.UseDedicatedTaskRunner=true -Djava.util.logging.config.file=logging.properties -Dactivemq.classpath=/opt/activemq/conf; -Dactivemq.home=/opt/activemq -Dactivemq.base=/opt/activemq\nACTIVEMQ_HOME: /opt/activemq\nACTIVEMQ_BASE: /opt/activemq\nConnecting to pid: 28852\n.............................\nINFO: Regular shutdown not successful,  sending SIGKILL to process with pid '28852'\nreturn code: 1\t\t\t\t\t\t\t\t\t\t# wrong\n[... Java Stack Trace ...]\n$ sudo /opt/activemq/bin/activemq stop ; echo \"return code: $?\"\nINFO: Loading '/etc/default/activemq'\nINFO: Using java '/usr/java/default/bin/java'\nActiveMQ not running\nreturn code: 0\t\t\t\t\t\t\t\t\t\t# correct","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreas.krause","name":"andreas.krause","key":"andreas.krause","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Krause","active":true,"timeZone":"Europe/Berlin"},"created":"2012-04-02T10:46:17.114+0000","updated":"2012-04-02T10:46:17.114+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12549142/comment/13416690","id":"13416690","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"seems related","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-07-17T23:02:48.076+0000","updated":"2012-07-17T23:02:48.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12549142/comment/14693844","id":"14693844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The scripts have undergone a lot of work since this was reported, this should be fixed now.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2015-08-12T17:03:17.414+0000","updated":"2015-08-12T17:03:17.414+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3795/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ead3:"}}