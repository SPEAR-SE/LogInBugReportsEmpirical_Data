{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12518576","self":"https://issues.apache.org/jira/rest/api/2/issue/12518576","key":"AMQ-3446","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2011-08-11T10:38:54.499+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 11 15:48:55 UTC 2011","customfield_12310420":"65451","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3446/watchers","watchCount":2,"isWatching":false},"created":"2011-08-11T10:23:00.018+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["broker","network","networkBridge","networkConnector","ttl"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315624","id":"12315624","description":"Maintenance release for 5.4.0","name":"5.4.1","archived":false,"released":true,"releaseDate":"2010-09-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-08-11T15:48:55.720+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"(Unit test is attached to prove the case)\n\nGiven 3 brokers A, B and C.\nEach broker is connected to the others by a network bridge (so we have 3 brokers that are connected to each other)\nThe networkTTL is 2 on all network connectors.\n\nStart broker A and B\nSubscribe consumer on A\nStart Broker C\nStop Broker B\nPublish message to C\n\nExpected result:\nThe consumer that is subscribed on A receives the message\nActual result:\nSometimes it works and sometimes the consumer does not receive the message.\n\n\nAdditional info:\nFrom my understanding the problem appears since a broker subscribes as a consumer to other brokers only when there is a consumer that subscribed to this broker, but it does not try to renew subscription to other brokers when some (another) broker in its network fails (or stopped). \n\nSo we see the following situation:\nClient subscribed on topic X on A, A subscribed on topic X on B, B subscribed on topic X on C\nWhen we stop B, A does not subscribe on topic X on C and the message of topic X cannot pass from C to A.\n\nThis BUG does not occur when networkTTL is 1 because subscription route in a network will be not be greater then 2\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12490100","id":"12490100","filename":"activemqTest.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=victor.prp","name":"victor.prp","key":"victor.prp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"VIctor Perepelitsky ","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-11T10:25:15.862+0000","size":55202,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12490100/activemqTest.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81473","customfield_12312823":null,"summary":"Network of brokers does not pass messages when networkTTL is bigger then 1","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=victor.prp","name":"victor.prp","key":"victor.prp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"VIctor Perepelitsky ","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=victor.prp","name":"victor.prp","key":"victor.prp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"VIctor Perepelitsky ","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518576/comment/13083054","id":"13083054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=victor.prp","name":"victor.prp","key":"victor.prp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"VIctor Perepelitsky ","active":true,"timeZone":"Etc/UTC"},"body":"run \nmvn test \nor \nmvn -Dtest=NetworkOfBrokersTest test\n\nNetworkOfBrokersTest shows that ttl1 works when ttl2 failes","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=victor.prp","name":"victor.prp","key":"victor.prp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"VIctor Perepelitsky ","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-11T10:25:15.928+0000","updated":"2011-08-11T10:25:15.928+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518576/comment/13083057","id":"13083057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michzem","name":"michzem","key":"michzem","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Zamir","active":true,"timeZone":"Etc/UTC"},"body":"Nice work Victor:)\n\nIn my words:\nwe have 3 brokers, *A*, *B* and *C*.\nEach of them is connected to the other in a network connector\n\n<broker name=\"*A*\" >\n     <networkConnector name=\"*toBrokerB*\" uri=\"static:(tcp://brokerB:61618\" networkTTL=\"*2*\" />\n     <networkConnector name=\"*toBrokerC*\" uri=\"static:(tcp://brokerC:61618\" networkTTL=\"*2*\" />\n</broker>\n\n<broker name=\"*B*\" >\n     <networkConnector name=\"*toBrokerA*\" uri=\"static:(tcp://brokerA:61618\" networkTTL=\"*2*\" />\n     <networkConnector name=\"*toBrokerC*\" uri=\"static:(tcp://brokerC:61618\" networkTTL=\"*2*\" />\n</broker>\n\n<broker name=\"*C*\" >\n     <networkConnector name=\"*toBrokerA*\" uri=\"static:(tcp://brokerA:61618\" networkTTL=\"*2*\" />\n     <networkConnector name=\"*toBrokerB*\" uri=\"static:(tcp://brokerB:61618\" networkTTL=\"*2*\" />\n</broker>\n\n\n\nClient is registered on topic X into brokerA\n*brokerA* then register on topic X to *broker B*\n*brokerB* then register on topic X to *broker C*\n\n\nIf you produce message on topic *X* to *brokerC* , the client consumer will receive the message.\nBut then, if you stop *brokerB* and send/produce message to topic *X* on *brokerC*, the client consumer won't receive the message.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michzem","name":"michzem","key":"michzem","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Zamir","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-11T10:38:54.499+0000","updated":"2011-08-11T13:10:45.818+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518576/comment/13083118","id":"13083118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"have you run your test case with full trace level logging, that will show you the message dispatch and the implementation of the ttl limits in the network bridges.\nAlso have a peek at: https://issues.apache.org/jira/browse/AMQ-2484","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-11T13:54:41.906+0000","updated":"2011-08-11T13:54:41.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12518576/comment/13083175","id":"13083175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=victor.prp","name":"victor.prp","key":"victor.prp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"VIctor Perepelitsky ","active":true,"timeZone":"Etc/UTC"},"body":"I've run it with trace level, but don't see something interesting.\nThe attached test is a full maven project that you can run within a minute and see what I mean.\n\nMay be I didn't explain it clear enough, it seems after a specific sequence of actions there is a consumer that will never receive messages from broker in the network unless a restart to the consumer (or may be specific broker) will be done. It is not a 'one message issue' but a state when messages no longer consumed. So it seems the issue https://issues.apache.org/jira/browse/AMQ-2484 is not related to this one. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=victor.prp","name":"victor.prp","key":"victor.prp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"VIctor Perepelitsky ","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-11T15:48:55.679+0000","updated":"2011-08-11T15:48:55.679+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3446/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0eak7:"}}