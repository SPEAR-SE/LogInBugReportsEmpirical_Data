{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12550585","self":"https://issues.apache.org/jira/rest/api/2/issue/12550585","key":"AMQ-3804","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-04-16T17:09:51.565+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Apr 16 17:35:01 UTC 2012","customfield_12310420":"235449","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_418457516_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-04-16T17:35:01.005+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3804/watchers","watchCount":1,"isWatching":false},"created":"2012-04-11T21:20:43.520+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-04-16T17:42:47.628+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"this is a duplicate of AMQ-3677 which was marked resolved. however i am still noticing this issue using the 5.6 snapshot release from apr 11, 2012. in this case activemq server was shutdown by terminating the java process. when the server is started again, following exception is logged every 30 seconds:\n\n{code}\n2012-04-11 14:06:53,786 org.apache.activemq.broker.region.Topic[ActiveMQ Broker[ZyrionMessageBus] Scheduler]: (ERROR) (   Topic.java:683) Failed to remove expired Message from the store \njava.lang.NullPointerException\n\tat org.apache.activemq.store.kahadb.MessageDatabase.removeAckLocation(MessageDatabase.java:2005)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.updateIndex(MessageDatabase.java:1259)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$15.execute(MessageDatabase.java:1046)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:769)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:1044)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$13.visit(MessageDatabase.java:977)\n\tat org.apache.activemq.store.kahadb.data.KahaRemoveMessageCommand.visit(KahaRemoveMessageCommand.java:220)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:969)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:881)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:863)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBTopicMessageStore.doAcknowledge(KahaDBStore.java:715)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBTopicMessageStore.acknowledge(KahaDBStore.java:701)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore.acknowledge(KahaDBTransactionStore.java:519)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore$2.acknowledge(KahaDBTransactionStore.java:222)\n\tat org.apache.activemq.broker.region.Topic.acknowledge(Topic.java:489)\n\tat org.apache.activemq.broker.region.Topic.messageExpired(Topic.java:681)\n\tat org.apache.activemq.broker.region.Topic.doBrowse(Topic.java:562)\n\tat org.apache.activemq.broker.region.Topic.access$100(Topic.java:62)\n\tat org.apache.activemq.broker.region.Topic$6.run(Topic.java:662)\n\tat org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\n\tat java.util.TimerThread.mainLoop(Unknown Source)\n\tat java.util.TimerThread.run(Unknown Source)\n{code}\n\nhere is the server configuration:\n\n{code}\n<beans\n    xmlns=\"http://www.springframework.org/schema/beans\"\n    xmlns:amq=\"http://activemq.apache.org/schema/core\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd\n    http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd\">\n\n  <!-- Allows us to use system properties as variables in this configuration file -->\n  <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"/>\n  \n  <!-- Configure the ActiveMQ broker -->\n  <broker\n      xmlns=\"http://activemq.apache.org/schema/core\"\n      brokerName=\"ZyrionMessageBus\" \n      useJmx=\"false\"\n      dataDirectory=\"${activemq.base}/../../utils/spool/jms\"\n      deleteAllMessagesOnStartup=\"false\"\n      advisorySupport=\"false\"\n      offlineDurableSubscriberTimeout=\"7200000\"\n      offlineDurableSubscriberTaskSchedule=\"1800000\">\n\n    [...]\n\n    <!-- Configure message persistence for the broker -->\n    <persistenceAdapter>\n      <kahaDB directory=\"${activemq.base}/../../utils/spool/jms/kahadb\" ignoreMissingJournalfiles=\"true\" checkForCorruptJournalFiles=\"true\" checksumJournalFiles=\"true\"/>\n    </persistenceAdapter>\n{code}\n\ni can provide a copy of the kahadb directory if necessary to duplicate the issue. let me know if you require any additional information. thanks\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12522816","id":"12522816","filename":"AMQ-3804.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johno","name":"johno","key":"johno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johno Crawford","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-16T17:42:47.532+0000","size":121371,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12522816/AMQ-3804.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59179","customfield_12312823":null,"summary":"NullPointerException logged every 30 seconds while attempting to clear expired messages ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajib_rashid","name":"rajib_rashid","key":"rajib_rashid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajib Rashid","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajib_rashid","name":"rajib_rashid","key":"rajib_rashid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajib Rashid","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows XP SP3","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12550585/comment/13254814","id":"13254814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johno","name":"johno","key":"johno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johno Crawford","active":true,"timeZone":"Etc/UTC"},"body":"If the stacktrace is fresh this could mean that the stored destination does not have any message references to the given message sequence (returns null) and when we try and unbox the Long we hit an NPE.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johno","name":"johno","key":"johno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johno Crawford","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-16T17:09:51.565+0000","updated":"2012-04-16T17:14:14.776+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12550585/comment/13254829","id":"13254829","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"I believe Johno is correct in his diagnosis - resolved by SVN revision 1326692","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-16T17:35:01.029+0000","updated":"2012-04-16T17:35:01.029+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3804/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ahxr:"}}