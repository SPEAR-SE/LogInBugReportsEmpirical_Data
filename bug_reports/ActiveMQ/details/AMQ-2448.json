{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483296","self":"https://issues.apache.org/jira/rest/api/2/issue/12483296","key":"AMQ-2448","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-10-13T15:35:33.405+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Apr 09 13:35:29 UTC 2010","customfield_12310420":"74940","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_8429231_*|*_5_*:*_3_*:*_10348255425_*|*_4_*:*_2_*:*_3635835772","customfield_12312321":null,"resolutiondate":"2010-03-24T12:03:44.752+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2448/watchers","watchCount":3,"isWatching":false},"created":"2009-10-13T13:15:04.324+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-05-06T06:44:40.968+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"I've discovered a reproducible memory leak.  After discussion on IRC, it is believed to be related to my network of brokers configuration.\nI have a total of 4 brokers configured on 4 hosts (activemq1,2,3,4).\nactivemq1 and activemq2 are a shared filesystem master slave pair.  activemq3 and activemq4 are setup in a similar way as a master/slave pair.\nOnly one of activemq1 and 2 will be active at a time, likewise only one of activemq3 and 4.\n\nBoth activemq1 and activemq2 have a config with the following networkConnector.\n<networkConnectors>\n                <networkConnector\n                        uri=\"static://(tcp://activemq3:61616,tcp://activemq4:61616)\"\n                        name=\"Connection to 3 and 4\"\n                        networkTTL=\"5\"\n                        dynamicOnly=\"true\"/>\n</networkConnectors>\n\nThe broker will only be able to connect to either 3 or 4 as only one can be running at a time.\nFor obvious reasons, connecting to the slave will fail, but the connection attempt will be retried every 30 seconds by default (more often on initial startup due to backoff algorithm).\nIt is believed that the continuous reconnect attempts are the source of the memory leak.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461563","id":"12461563","filename":"activemq1.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexjfisher","name":"alexjfisher","key":"alexjfisher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Fisher","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-13T13:18:17.903+0000","size":1931,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461563/activemq1.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461562","id":"12461562","filename":"activemq2.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexjfisher","name":"alexjfisher","key":"alexjfisher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Fisher","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-13T13:18:17.981+0000","size":1929,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461562/activemq2.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461564","id":"12461564","filename":"activemq3.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexjfisher","name":"alexjfisher","key":"alexjfisher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Fisher","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-13T13:18:17.983+0000","size":1931,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461564/activemq3.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461565","id":"12461565","filename":"activemq4.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexjfisher","name":"alexjfisher","key":"alexjfisher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Fisher","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-13T13:18:34.518+0000","size":1929,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461565/activemq4.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461613","id":"12461613","filename":"AMQ-2448.workingVMtest.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-24T12:54:29.871+0000","size":4588,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461613/AMQ-2448.workingVMtest.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"159854","customfield_12312823":null,"summary":"Memory leak when there are network connector retries to an unavailable broker","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexjfisher","name":"alexjfisher","key":"alexjfisher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Fisher","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12482565","key":"AMQ-2298","self":"https://issues.apache.org/jira/rest/api/2/issue/12482565","fields":{"summary":"Make network duplicate subscription suppression feature priority based when networkConsumerPrioritys are in play.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexjfisher","name":"alexjfisher","key":"alexjfisher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Fisher","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Debian Linux 5.0 amd64 with included Sun Java 6 JRE","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12940905","id":"12940905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexjfisher","name":"alexjfisher","key":"alexjfisher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Fisher","active":true,"timeZone":"Etc/UTC"},"body":"The following comes from a Java Heap dump I did after about 12 hours of operation.  No messages were sent in this time.  The dumpfile used was over 500MB so I'm not attaching it.\nI could start fresh and generate and attach a dump after 10 minutes or so if this would help.\n\nInstance Counts for All Classes (excluding platform)\n7343 instances of class [Lorg.apache.activemq.command.ActiveMQDestination;\n5499 instances of class org.apache.activemq.transport.MutexTransport\n5499 instances of class org.apache.activemq.transport.ResponseCorrelator\n5499 instances of class org.apache.activemq.util.IntSequenceGenerator\n3838 instances of class org.apache.activemq.management.CountStatisticImpl\n3668 instances of class [Lorg.apache.activemq.command.DataStructure;\n3667 instances of class org.apache.activemq.thread.Valve\n3666 instances of class [Lorg.apache.activemq.command.BrokerId;\n1843 instances of class org.apache.activemq.command.WireFormatInfo\n1836 instances of class org.apache.activemq.util.LongSequenceGenerator\n1835 instances of class org.apache.activemq.util.IdGenerator\n1834 instances of class org.apache.activemq.openwire.OpenWireFormat\n1834 instances of class org.apache.activemq.thread.DedicatedTaskRunner\n1834 instances of class org.apache.activemq.thread.DedicatedTaskRunner$1\n1834 instances of class org.apache.activemq.util.DataByteArrayInputStream\n1834 instances of class org.apache.activemq.util.DataByteArrayOutputStream\n1833 instances of class org.apache.activemq.broker.SingleTransportConnectionStateRegister\n1833 instances of class org.apache.activemq.broker.TransportConnection\n1833 instances of class org.apache.activemq.broker.TransportConnection$1\n1833 instances of class org.apache.activemq.broker.region.ConnectionStatistics\n1833 instances of class org.apache.activemq.network.ConduitBridge\n1833 instances of class org.apache.activemq.network.DemandForwardingBridgeSupport$1\n1833 instances of class org.apache.activemq.network.DemandForwardingBridgeSupport$2\n1833 instances of class org.apache.activemq.network.DiscoveryNetworkConnector$1\n1833 instances of class org.apache.activemq.transport.InactivityMonitor\n1833 instances of class org.apache.activemq.transport.InactivityMonitor$1\n1833 instances of class org.apache.activemq.transport.InactivityMonitor$2\n1833 instances of class org.apache.activemq.transport.WireFormatNegotiator\n1833 instances of class org.apache.activemq.transport.tcp.TcpTransport\n1833 instances of class org.apache.activemq.transport.vm.VMTransport\n1833 instances of class org.apache.activemq.transport.vm.VMTransportServer$1\n569 instances of class org.apache.activemq.transport.TransportDisposedIOException\n445 instances of class org.mortbay.util.StringMap$Node\n374 instances of class org.springframework.beans.GenericTypeAwarePropertyDescriptor\n289 instances of class org.mortbay.io.BufferCache$CachedBuffer\n179 instances of class org.apache.log4j.CategoryKey\n152 instances of class [Lorg.mortbay.util.StringMap$Node;\n130 instances of class org.mortbay.jetty.servlet.ServletHandler$CachedChain\n113 instances of class org.apache.commons.logging.impl.Log4JLogger\n113 instances of class org.apache.log4j.Logger\n111 instances of class org.mortbay.io.ByteArrayBuffer\n107 instances of class org.apache.activemq.util.ByteSequence\n97 instances of class org.apache.activemq.transport.tcp.TcpBufferedInputStream\n97 instances of class org.apache.activemq.transport.tcp.TcpBufferedOutputStream\n85 instances of class $Proxy3\n66 instances of class org.apache.log4j.ProvisionNode\n63 instances of class org.apache.jasper.compiler.JspUtil$ValidAttribute\n57 instances of class org.springframework.beans.MutablePropertyValues\n57 instances of class org.springframework.beans.factory.config.ConstructorArgumentValues\n57 instances of class org.springframework.beans.factory.support.MethodOverrides\n56 instances of class org.springframework.beans.PropertyValue\n55 instances of class org.apache.jasper.compiler.SmapStratum$LineInfo\n51 instances of class org.apache.activemq.command.BrokerInfo\n49 instances of class org.apache.activemq.command.ActiveMQTopic\n\n-SNIP-","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alexjfisher","name":"alexjfisher","key":"alexjfisher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Fisher","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-13T13:26:07.987+0000","updated":"2009-10-13T13:26:07.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12940909","id":"12940909","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"resolved in r824807\nA failed network bridge remained in a bridge list, resolved by reusing an existing list of bridges that is correctly managed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-13T15:35:33.405+0000","updated":"2009-10-13T15:35:33.405+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12940911","id":"12940911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"problem introduced by https://issues.apache.org/activemq/browse/AMQ-2298","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-10-13T16:03:33.957+0000","updated":"2009-10-13T16:03:33.957+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942181","id":"12942181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85","name":"srodrigu85","key":"srodrigu85","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\nI'm encountering the exact same behavior in both 5.3 branch and development trunk.\nI created a simple network of brokers with all the same configuration:\n<networkConnector name=\"HA Queue\" uri=\"static:(tcp://broker1:61616,tcp://broker2:61616,tcp://broker3:61616)?useExponentialBackOff=false\" userName=\"system\" password=\"manager\" duplex=\"true\" />\nThe disables exponential back off allows me to reproduce the memory leak faster.\nI stop activemq in 2 out of the 3 brokers and get a memory leak: there is nearly one thread created per second. After a while, the activeMQ will just crash.\n\nHere is the start of the dump heat, after only 20min of running:\n\n--start--\norg.apache.activemq.command.ActiveMQDestination[]\t5003\norg.apache.activemq.transport.ResponseCorrelator\t3750\norg.apache.activemq.util.IntSequenceGenerator 3750\norg.apache.activemq.transport.MutexTransport 3750\norg.apache.activemq.management.CountStatisticImpl 2548\norg.apache.activemq.command.DataStructure[] 2512\norg.apache.activemq.thread.Valve 2504\norg.apache.activemq.command.BrokerId[] 2500\norg.apache.activemq.util.DataByteArrayOutputStream 1269\norg.apache.activemq.util.DataByteArrayInputStream 1266\norg.apache.activemq.thread.DedicatedTaskRunner$1 1259\norg.apache.activemq.thread.DedicatedTaskRunner 1259\norg.apache.activemq.openwire.OpenWireFormat 1256\norg.apache.activemq.util.LongSequenceGenerator 1254\norg.apache.activemq.util.IdGenerator 1253\norg.apache.activemq.command.WireFormatInfo 1251\norg.apache.activemq.broker.TransportConnection 1250\norg.apache.activemq.transport.WireFormatNegotiator 1250\norg.apache.activemq.transport.InactivityMonitor$2 1250\norg.apache.activemq.transport.vm.VMTransportServer$1 1250\norg.apache.activemq.broker.TransportConnection$1 1250\norg.apache.activemq.transport.InactivityMonitor$1 1250\norg.apache.activemq.network.DemandForwardingBridgeSupport$2 1250\norg.apache.activemq.transport.InactivityMonitor 1250\norg.apache.activemq.transport.tcp.TcpTransport\t 1250\norg.apache.activemq.broker.region.ConnectionStatistics 1250\norg.apache.activemq.network.DurableConduitBridge 1250\norg.apache.activemq.network.DiscoveryNetworkConnector$1 1250\norg.apache.activemq.network.DemandForwardingBridgeSupport$1 1250\norg.apache.activemq.transport.vm.VMTransport 1250\norg.apache.activemq.broker.SingleTransportConnectionStateRegister\t 1249\norg.apache.log4j.CategoryKey 194\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85","name":"srodrigu85","key":"srodrigu85","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-10T09:04:53.598+0000","updated":"2010-02-10T09:04:53.598+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942191","id":"12942191","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85","name":"srodrigu85","key":"srodrigu85","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"body":"A little update:\nI've picked up the latest release from FUSE and this memory leak is not present.\nIt seems they merged the patch provided in this issue. So maybe another check in done after this resolution is the culprit of bringing back this memory leak?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85","name":"srodrigu85","key":"srodrigu85","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-11T02:39:31.853+0000","updated":"2010-02-11T02:39:31.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942207","id":"12942207","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"think http://issues.apache.org/activemq/browse/AMQ-2530 may be the difference.\n\nCan you validate with the latest trunk snapshot.\n\nbtw: Sebastien, what patch do you refer to above?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-12T14:43:49.725+0000","updated":"2010-02-12T14:43:49.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942260","id":"12942260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85","name":"srodrigu85","key":"srodrigu85","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"body":"Sorry Gary, I didnt see this answer.\nI'll check tomorrow if the behavior is still the same in the trunk, but when I reopened it, both the 5.3.1 and the latest trunk version still had the issue.\n\nConcerning the patch, I was just saying that looking at the FUSE Message Broker 5.3.0.5's release notes, I can see they have applied the same patch as the one provided in this issue.\nThe problem is definitely not present in the FUSE Message BRoker, so it should be fairly simple to see the differences.\nEasy way of reproducing the problem is to set up a network of brokers with some hostnames that are not reachable or dont have an ActiveMQ broker running on them. There will be a linear creation of threads (nearly 1 per second).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85","name":"srodrigu85","key":"srodrigu85","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-21T15:02:00.879+0000","updated":"2010-02-21T15:02:00.879+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942301","id":"12942301","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"did u get a chance to validate? All the fixes in fuse go via trunk at apache so the same changes should be present.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-03T12:40:34.578+0000","updated":"2010-03-03T12:40:34.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942305","id":"12942305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85","name":"srodrigu85","key":"srodrigu85","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"body":"I didnt get a chance to revalidate the bug.\n\nthe very basic scenario that demonstrated the case was to run a broker in the network of broker configuration, put two or more hostnames that cannot be resolved, and in order to accelerate the leak, remove the backoffmultiplier.\n\n<networkConnector name=\"HA Queue\" uri=\"static:(tcp://wrongHostname1:61617,tcp://wrongHostname2:61618)?useExponentialBackOff=false\" userName=\"system\" password=\"manager\" duplex=\"true\" />\n\nI'll give a try with the latest version of the trunk over the weekend, sorry that i took some delay on this matter.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srodrigu85","name":"srodrigu85","key":"srodrigu85","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastien Rodriguez","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-04T01:25:49.079+0000","updated":"2010-03-04T01:25:49.079+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942363","id":"12942363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"The problem with leaking threads was caused by camel web app and activemq component explicitly set. Changing the config a bit makes broker behaves well in this use-case. Will resolve this issue and create camel-related issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-17T15:21:42.689+0000","updated":"2010-03-17T15:21:42.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942352","id":"12942352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbryant","name":"nbryant","key":"nbryant","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nathan Bryant","active":true,"timeZone":"Etc/UTC"},"body":"I'm experiencing this issue without using Camel. Configuration is an embedded ActiveMQ with producers connecting via the VM transport and a network of brokers over TCP. Works fine with FUSE MQ 5.3.0.x as noted by another user above, but does not work with 5.3.1-snap\n\nI see your applicationContext changes seem to atfect the VM transport, are you just disabling the VM transport for Camel as a workaround?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbryant","name":"nbryant","key":"nbryant","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nathan Bryant","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-17T16:23:18.058+0000","updated":"2010-03-17T16:23:18.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942359","id":"12942359","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Nathan,\n\ncan you provide a test case or describe how to reproduce the problem?\n\nCheers,\nDejan","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-17T16:32:30.250+0000","updated":"2010-03-17T16:32:30.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942115","id":"12942115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmoquin","name":"rmoquin","key":"rmoquin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rmoquin&avatarId=17052","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rmoquin&avatarId=17052","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rmoquin&avatarId=17052","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rmoquin&avatarId=17052"},"displayName":"Ryan Moquin","active":true,"timeZone":"America/New_York"},"body":"FYI, I'm seeing this issue with Fuse 5.3.0.4 in Servicemix 3.4.0.4 (this isn't using any specific components though, just simply starting up Servicemix with the certain ActiveMQ configuration).  When there is a network connector that cannot connect to a certain host, then eventually an OutOfMemoryError will occur.  If I swap out the activemq jars that came with Servicemix, for the 5.3.0.5 ones.. it appears that the the memory issue is gone.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmoquin","name":"rmoquin","key":"rmoquin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rmoquin&avatarId=17052","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rmoquin&avatarId=17052","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rmoquin&avatarId=17052","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rmoquin&avatarId=17052"},"displayName":"Ryan Moquin","active":true,"timeZone":"America/New_York"},"created":"2010-03-23T21:58:15.852+0000","updated":"2010-03-23T21:58:15.852+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942164","id":"12942164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"This seems to be resolved in 5.3.1 - i monitored a over a few hours, a broker with {code}<networkConnectors>\n <networkConnector name=\"HA Queue\" uri=\"static:(tcp://wrongHostname1:61617,tcp://wrongHostname2:61618)?useExponentialBackOff=false\" userName=\"system\" password=\"manager\" duplex=\"true\" />\n</networkConnectors>{code} and it is stable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-24T12:03:44.720+0000","updated":"2010-03-24T12:03:44.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942172","id":"12942172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"This patch contains a test case that attempts to reproduce but demonstrates that it works. An existing vm connection does not seem to effect the thread count while a networkConnector is failing to connect. It may provide the basis to produce a better test. For the moment it demonstrates that this issue is resolved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-24T12:54:29.916+0000","updated":"2010-03-24T12:54:29.916+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483296/comment/12942373","id":"12942373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"body":"The root cause of this issue is now committed with svn revision 932403 and all config workarounds are removed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejanb","name":"dejanb","key":"dejanb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Bosanac","active":true,"timeZone":"Europe/Berlin"},"created":"2010-04-09T13:35:29.297+0000","updated":"2010-04-09T13:35:29.297+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2448/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rpzj:"}}