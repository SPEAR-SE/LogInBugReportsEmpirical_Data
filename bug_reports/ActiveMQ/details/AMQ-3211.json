{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12500835","self":"https://issues.apache.org/jira/rest/api/2/issue/12500835","key":"AMQ-3211","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-03-10T12:49:32.233+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 15 11:53:25 UTC 2011","customfield_12310420":"14666","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_122318865_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-03-10T13:27:34.448+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3211/watchers","watchCount":0,"isWatching":false},"created":"2011-03-09T03:28:55.604+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"issuelinks":[{"id":"12338031","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12338031","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"outwardIssue":{"id":"12498776","key":"AMQ-3183","self":"https://issues.apache.org/jira/rest/api/2/issue/12498776","fields":{"summary":"Set JMSXUserID value based on authenticated principal","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-03-15T11:53:25.110+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"It seems the JMSXUserId can be spoofed by client contrary to what http://activemq.apache.org/jmsxuserid.html says.\n\nMy test setup is populateJMSXUserID=\"true set in a single broker, a JAAS config org.apache.activemq.jaas.TextFileCertificateLoginModule and using mutual auth SSL (i.e., ?needClientAuth=true for transportConnector setup), and a single consumer and producer based on small modifications of the ConsumerTool and ProducerTool examples in the 5.4.2 distro.  See attached the changes to the distro package to demonstrate the bug. Just do\n1. run apache-activemq-5.4.2/bin/activemq-admin start\n2. in apache-activemq-5.4.2/example run ant consumer -Durl=ssl://localhost:61617 -Dmax=3 -Dverbose=true\n3. in another shell in apache-activemq-5.4.2/example run ant producer -Durl=ssl://localhost:61617 -Dmax=3 -Dverbose=true\n4. look at the output of the consumer for the properties printed after each received message (the producer spoofs only on even numbered messages)\n\nWhen the client does not set the property, then i get the properly authenticated DN as JMSXUserID using message.getStringProperty(\"JMSXUserID\"). However, when the client sets it, i get the value set by the client.  The only difference i notice is that in the former case, message.getPropertyNames() does not return JMSXUserID whereas in the spoofed case it does. \n\ni wonder whether in the context of https://issues.apache.org/jira/browse/QPID-943 or https://issues.apache.org/jira/browse/AMQ-2840 (which interestingly doesn't list JMSXUserID as supported in a comment even though it is?) something got messed up?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12473150","id":"12473150","filename":"JMSXUserID-bug.conf-src.tar.bz2","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-09T15:30:29.967+0000","size":34844,"mimeType":"application/x-bzip","content":"https://issues.apache.org/jira/secure/attachment/12473150/JMSXUserID-bug.conf-src.tar.bz2"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12473151","id":"12473151","filename":"JMSXUserID-bug.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-09T15:31:20.147+0000","size":43283,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12473151/JMSXUserID-bug.diff"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59471","customfield_12312823":null,"summary":"JMSXUserId Can be spoofed by client","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13004607","id":"13004607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"body":"The files from apache-activemq-5.4.2/conf and apache-activemq-5.4.2/examples which include all changes i've done to demonstrate problem (see for comments with MSTEINER in it ...)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-09T15:30:30.016+0000","updated":"2011-03-09T15:30:30.016+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13004609","id":"13004609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"body":"The diff from the standard apache-activemq-5.4.2 distribution which demonstrates the bug","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-09T15:31:20.165+0000","updated":"2011-03-09T15:31:20.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13005050","id":"13005050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"This seems broken to me. ActiveMQ does allow setting the JMSXUserId property but it should only be used in the absence of any other setting of user credentials.\nCurrently, the call to get JMSXUserId looks first at the existing properties and then at the internal userId attribute. That logic should be reversed.\n\nTypically, users should not set the JMSXUserId value, but if they do, it should be ignored if there is an alternative policy in place, ie: when BrokerService.populateJMSXUserID is specified and either the user id is set on the ActiveMQConnectionFactory or found through Authentication.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-10T12:49:32.233+0000","updated":"2011-03-10T12:49:32.233+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13005053","id":"13005053","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"resolved in http://svn.apache.org/viewvc?rev=1080212&view=rev\nCan you validate the next 5.5-SNAPSHOT to ensure the fix captures your use case.\nA client supplied JMSXUserID value is only used as a last resort. I think it is better from an interop and backward compatibility perspective to not explicitly disallow setting this property.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-10T13:27:34.455+0000","updated":"2011-03-10T13:27:34.455+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13005383","id":"13005383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"body":"> Can you validate the next 5.5-SNAPSHOT to ensure the fix captures your use case.\n\nThanks for the quick turn-around!!\n\nI did not find a new built SNAPSHOT version but i saw changes in the\nsource and so built the version from svn.  While a few tests failed, \n(e.g., org.apache.activemq.network.DuplexNetworkMBeanTest and\norg.apache.activemq.bugs.AMQ2021Test), i could successfully run my\ntests and confirm that with the change JMSXUserID could not be spoofed\nanymore (at least not the way i did in the past ;-). \n\n> A client supplied JMSXUserID value is only used as a last resort. I\n> think it is better from an interop and backward compatibility\n> perspective to not explicitly disallow setting this property. \n\nI'm not sure whether there is really a good use case for having clients\nproviding it, at least my security mindset would make opt for erring\non the safe side.  However, some of the the scenarios mentioned in\nhttps://issues.apache.org/jira/browse/QPID-943 might need that\n(although the original request still required validation at the broker\nside which would be fail-safe).  However, I see at least two potentially\nproblematic cases:\n\n- whether application code would see correct or potentially spoofed\n  fields would depend on a config.\n\n- what happens if the config must allow unauthenticated clients? \n\nThe former is maybe more a stylic/robustness issue, i.e., multiple\nlines of defense.   The latter though is a clear security issue. And\nafter a quick test with non-x509 based JAAS config  and\n\n    org.apache.activemq.jaas.GuestLoginModule sufficient\n       debug=true\n       org.apache.activemq.jaas.guest.user=\"guest\"\n       org.apache.activemq.jaas.guest.group=\"guests\";\n\nit seems anonymous guest result in no JMXSUserID (ie.d., above\nguest.user/group seem to be ignored as far as JMSXUserID is\nconcerned) and i can still spoof ids.\n\nSo ideally, not allowing clients from setting it at all would be\nbest. Alternatives, i see (in decreasing orders of desirability )\n\n(a) provide an option which allows passing through only validated\n    JMSXUserID  (or to be on the fail-safe side, an option which \n    would have to be explicitly provided to allow a pass-through)\n\n(b) Garantuee that an anonymous user has always a well-identified\n    broker-provided JMSXUserID value\n\n(c)  provide a way for the code to check where the value come from.\n\n(Arguably, all together might even be better :-)\n\nRegarding (c), there is actually a way by which it can be safely\ndetermined that the field is not spoofed: if\nmessage.getPropertyNames() does not include JMSXUserID but\n.getStringProperty(\"JMSXUserID\") is returned, it will not have been\nset by JMS client code. Not sure, though, whether one couldn't modify\nthe JMS client library to change that behaviour and it might also\nprovide false alerts if the client has set the value but the broker\nhas overridden/corrected it.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-10T23:03:41.058+0000","updated":"2011-03-10T23:03:41.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13005593","id":"13005593","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"there is an additional broker attribute: useAuthenticatedPrincipalForJMSXUserID which will ensure that the authenticated principal is placed in the JMSXUserId, such that it is explicitly set or overridden in the authenticated case. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-11T10:51:47.796+0000","updated":"2011-03-11T11:07:33.872+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13006531","id":"13006531","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"body":"Thanks! Indeed, that field forces now the guest ids of JAAS into JMSXUserID. Incidentally, it also makes JMSXUserID now return mapped identities rather than X509 DNs for the SSL case.   \n\nBTW: Given the spoofing potential without that option (and the bug in <5.5), i tried to update  http://activemq.apache.org/jmsxuserid.html correspondingly. But i guess just signing up to confluence is not enough to update these pages?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-14T17:44:39.610+0000","updated":"2011-03-14T17:44:39.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13006538","id":"13006538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"yeah, confluence is restricted to committers,\ncan you add (via comment or diff/patch) any doco updates to this jira and I will update confluence. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-14T18:00:08.633+0000","updated":"2011-03-14T18:00:08.633+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13006569","id":"13006569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"body":"i kindof assumed that i wouldn't be allowed to change but as i saw an edit button and could sign up, i thought i should give it try instead of offloading everything to you :-)\n\nAnyway, what i would have added is along the lines of below: the disclaimer of the second paragraph certainly needs some editing regarding version references -- not sure how you handle that -- but i thought it would be good to document the vulnerability. Arguably, one could also mention the  getPropertyNames() test i outlined above as temporary workaround for older versions but i'm not 100% sure whether it secure, so i omitted that.\n\n``If you allow anonymous access, you MUST also add the _useAuthenticatedPrincipalForJMSXUserID_  property of the broker element and set it to true. Otherwise,  anonymous clients can spoof identities. Note, though, that for SSL certificate based authentication, e.g., when using TextFileCertificateLoginModule JAAS module, this will change the semantics of the broker-provided JMSXUserID. Instead of returning the DN of the certificate, it will provide the name the DN is mapped to by the JAAS module.\n\nAlso note that versions up to (and including) 5.4.2 are vulnerable to spoofing. A fix is included in 5.5-SNAPSHOT > March 12th, 2011.''","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michsteiner","name":"michsteiner","key":"michsteiner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Steiner","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-14T18:51:44.076+0000","updated":"2011-03-14T18:51:44.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500835/comment/13006882","id":"13006882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"updated the doco, https://cwiki.apache.org/confluence/display/ACTIVEMQ/JMSXUserID\n\nthanks for the feedback :-)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-15T11:53:25.079+0000","updated":"2011-03-15T11:53:25.079+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3211/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ajqn:"}}