{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482235","self":"https://issues.apache.org/jira/rest/api/2/issue/12482235","key":"AMQ-875","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-09-28T12:08:54.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Oct 22 20:02:02 UTC 2007","customfield_12310420":"84323","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_37769873822_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2007-10-22T20:02:02.822+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-875/watchers","watchCount":2,"isWatching":false},"created":"2006-08-11T16:24:09.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315610","id":"12315610","name":"4.0","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-10-22T20:02:02.806+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Charles reported on the mailing list:\n\nHi All,\n\nWe've just had a nasty situation : our ActiveMQ Server standalone plain\nvanilla TCP Transport, no persistency, no nuffink) on one of our live\ninstallations suddenly refused to accept any new connections - no clients\ncould connect. All currently connected clients were fine, and messages were\nbeing processed sent and received fine. Just no-one else could connect.\n\nAfter 20 minutes, new connections were suddenly allowed.\n\nThe following exception was in our log.\n\n2006-Aug-11 12:17:47.726 aqualive [ActiveMQ Transport Server:\ntcp://blah:61616]  ERROR org.apache.activemq.broker.TransportConnector -\nCould not accept connection: java.net.SocketException: Connection reset by\npeer: socket write error\njava.net.SocketException: Connection reset by peer: socket write error\n at java.net.SocketOutputStream.socketWrite0(Native Method)\n at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n at java.net.SocketOutputStream.write(SocketOutputStream.java:136)\n at\norg.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedO\nutputStream.java:108)\n at java.io.DataOutputStream.flush(DataOutputStream.java:101)\n at\norg.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:125)\n at\norg.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.jav\na:141)\n at\norg.apache.activemq.transport.WireFormatNegotiator.sendWireFormat(WireFormat\nNegotiator.java:128)\n at\norg.apache.activemq.transport.WireFormatNegotiator.start(WireFormatNegotiato\nr.java:64)\n at\norg.apache.activemq.transport.TransportFilter.start(TransportFilter.java:52)\n at\norg.apache.activemq.transport.TransportFilter.start(TransportFilter.java:52)\n at\norg.apache.activemq.broker.TransportConnection.start(TransportConnection.jav\na:75)\n at\norg.apache.activemq.broker.TransportConnector$1.onAccept(TransportConnector.\njava:136)\n at\norg.apache.activemq.transport.tcp.TcpTransportServer.run(TcpTransportServer.\njava:137)\n at java.lang.Thread.run(Thread.java:534)\n\nMy interpretation of the above that something (port scanner maybe ? Our\ncurious IT department ?) is connecting to the listening socket, and the\nTransportServer is trying to tell the connecting process what the wireformat\nis - and the connection process is just sitting there, not responding,\nacknlowedging, or doing anything at all - yet not closing the connection.\nTherefore, the transport server is blocked, preventing anyone else\nconnecting. After 20 mins - which I am guessing is somekind of lowlevel\ntimeout, seeing as all the default AMQ timeouts seen to be of the order of 1\n- 30 secs - a low level TCP exception is thrown, freeing the whole shebang\nup.\n\nI notice there is an InactivityMonitor, and looking at the code there is the\nfollowing comment\n// Disable inactivity monitoring while processing a command.\n\nCould this be the case ? That - until the wireformat has been negotiated -\nthere is no timeout configured ? Is there anything we can do to reduce this\ntimeout from 20 mins ? Or have I completed gone down the wrong track ?\n\nThis is AMQ 4.0, Win2K, JRE 1.4.2\n\nCheers,\n\nCharles","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161743","customfield_12312823":null,"summary":"TCP connector (server) will stop accepting connection if an invalid connection is made to him.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482235/comment/12938345","id":"12938345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=charles","name":"charles","key":"charles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Charles Anthony","active":true,"timeZone":"Etc/UTC"},"body":"This has just reoccured on a different client site...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=charles","name":"charles","key":"charles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Charles Anthony","active":true,"timeZone":"Etc/UTC"},"created":"2006-09-28T12:08:54.000+0000","updated":"2006-09-28T12:08:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482235/comment/12939012","id":"12939012","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eta","name":"eta","key":"eta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Anderson","active":true,"timeZone":"Etc/UTC"},"body":"I just spent some time trying to repro this on rev. 570602 without luck.  Specifically I was trying to recreate the exception noted by telnetting to 61616 and tracing the session establishment code in the debugger.  I tried both 1) allowing the wireformat info to be sent to the client and allowing the timeout to occur, and 2) closing the connection from the client end before the initial wireformat info is sent.\n\nIn both cases it seemed like the transport code was catching any socket exceptions and cleaning up in an orderly way.  \n\nI did notice one very peculiar behavior though.  I set up 20 different bash shells to do a \"telnet 0 61616\", then fired off the connections to the AMQ broker concurrently.  What I saw was that while connection #n was waiting for a response to its wireformat message, connection #n+1 was sitting idle, no initial handshake message having been sent from the broker.  As soon as connection #n timed-out, I would see the initial data from the server on the screen of session #n+1.  Meanwhile, connection #n+2 sat idle until n+1 timed out, and then it too would receive the initial handshake message, and so on.\n\nSo it would seem that, given this behavior, it might be easy to instigate a mini-DOS attack against the broker simply by creating connections to the openwire transport and sending nothing on them.  All bogus connections would have to time out before subsequent valid connections would be negotiated.  I could easily see how a port-scanning application could cause similar problems if it connected to port 61616 and then for some reason did not immediately tear down the TCP connection.\n\n-Eric","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eta","name":"eta","key":"eta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Anderson","active":true,"timeZone":"Etc/UTC"},"created":"2007-08-29T02:23:33.163+0000","updated":"2007-08-29T02:23:33.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482235/comment/12938513","id":"12938513","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"Hi Eric,\n\nThat issue has been resolved in the up comming 5.0 release.  see issue https://issues.apache.org/activemq/browse/AMQ-1337\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2007-08-29T03:43:10.478+0000","updated":"2007-08-29T03:43:10.478+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482235/comment/12939174","id":"12939174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"body":"fixed in 5.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chirino","name":"chirino","key":"chirino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chirino&avatarId=12659","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chirino&avatarId=12659","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chirino&avatarId=12659","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chirino&avatarId=12659"},"displayName":"Hiram Chirino","active":true,"timeZone":"America/New_York"},"created":"2007-10-22T20:02:02.799+0000","updated":"2007-10-22T20:02:02.799+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-875/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s1nb:"}}