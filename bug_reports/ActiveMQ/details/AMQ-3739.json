{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12544177","self":"https://issues.apache.org/jira/rest/api/2/issue/12544177","key":"AMQ-3739","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2012-07-19T11:45:07.664+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jul 19 11:49:45 UTC 2012","customfield_12310420":"229414","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_9665069974_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-06-17T13:35:40.156+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3739/watchers","watchCount":3,"isWatching":false},"created":"2012-02-26T16:51:10.353+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-19T11:49:45.833+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313899","id":"12313899","name":"Performance Test","description":"Performance Testing Suite"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"i'm encountering critical problems with activemq in our dev enviroment,\nactivemq brokers seem to hang and not respond to other brokers or jms consumers/producers.\n\n\nmy example setup is an activemq network of embedded brokers (2 to be precise), \none process with an embedded broker produces work, \na worker process with an embedded broker as well that does the work.\n\n2 queues, a running-queue and a stopped-queue, each msg has a counter which is decremented every time work is done on it until 0 and then the msg is passed to the stopped-queue, where it is consumed by the work producer.\n\nthe logic is implemented with basic spring integration.\n\nactivemq is configured with plenty of memory to spare, and no persistency, jmx is exposed to allow monitoring of the queues,\nwhat happens is that occasionally msg's get stuck inflight, meaning they do not get an ack, sometimes the inflight is between brokers, and sometimes between an embedded broker and it's internal jvm consumer.\n\nthe worker broker seems to hang, the jmx statistics seem to be frozen, although they do refresh, the broker responds to force restarts of the network connector, and sometime the restart frees msg's until it gets stuck again.\nif i leave the worker on after it's stuck and relaunch the producer, both brokers don't seem to communicate, the produced msg's on one side, don't reach the other, same goes for all advisory msg's related stats (such as producer/consumer counts)\n\ni tried changing every bit of configuration, with the broker, and with spring itself, but i have a feeling the problem doesn't have anything to do with spring (because of inner broker communication issues), the problem is easily reproducible on a powerful machine where the msg flow is fast, adding persistency or doing it on a normal desktop slows everything down and makes it more difficult to reproduce,\n\ni tried all recent activemq versions up to the latest 5.6 snapshot.\n\ni attached the relevent junit tests, one needs to launch the agentTest, and then the producerTest,\nmy recommendation is leaving agentTest on and relaunching producerTest over and over again, producerTest should be finished when all it's messages are done (do not launch 2 producer processes at the same time otherwise they will never be finished)\n\nrelevant maven test cases :\nhttp://db.tt/diVWPNnJ\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"81713","customfield_12312823":null,"summary":"ActiveMQ broker stops functioning","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzruya","name":"mzruya","key":"mzruya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matan Zruya","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzruya","name":"mzruya","key":"mzruya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matan Zruya","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows server 2008\n12GB Ram\n12 cores\nspring integration\nembedded activemq network of brokers","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544177/comment/13393543","id":"13393543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzruya","name":"mzruya","key":"mzruya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matan Zruya","active":true,"timeZone":"Etc/UTC"},"body":"Stopped using DMLC and wrote my own JmsConsumer using the jms message listener interface,\nprobably a bug in springs DMLC","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzruya","name":"mzruya","key":"mzruya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matan Zruya","active":true,"timeZone":"Etc/UTC"},"created":"2012-06-17T13:35:40.275+0000","updated":"2012-06-17T13:35:40.275+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544177/comment/13418237","id":"13418237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iddqd","name":"iddqd","key":"iddqd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomasz Drobiszewski","active":true,"timeZone":"Etc/UTC"},"body":"Why is it closed ? \"Not A Problem\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iddqd","name":"iddqd","key":"iddqd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomasz Drobiszewski","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-19T11:45:07.664+0000","updated":"2012-07-19T11:45:07.664+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544177/comment/13418239","id":"13418239","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzruya","name":"mzruya","key":"mzruya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matan Zruya","active":true,"timeZone":"Etc/UTC"},"body":"watch my reply above, \nafter removing the DMLC component that consumes messages from activemq and implementing my own solution, the problem described above does not persist anymore.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzruya","name":"mzruya","key":"mzruya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matan Zruya","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-19T11:49:45.813+0000","updated":"2012-07-19T11:49:45.813+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3739/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ec1j:"}}