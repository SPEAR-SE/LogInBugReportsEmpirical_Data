{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483306","self":"https://issues.apache.org/jira/rest/api/2/issue/12483306","key":"AMQ-1825","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2009-04-09T17:50:26.182+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 29 21:18:02 UTC 2012","customfield_12310420":"84756","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_139756368501_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-11-29T21:18:02.357+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1825/watchers","watchCount":4,"isWatching":false},"created":"2008-06-26T08:05:13.887+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-11-29T21:18:02.387+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Slave doen't synchronize state with master\n1.If master has messages which absent in slave, these messages won't replicate ot slave after attaching slave to master.\n\n2.If remove messages via JMX purge() in master, messages in slave won't remove\n\n3. If slave has messages wich absent in master, these messages won't remove when slave is attaching to master","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59827","customfield_12312823":null,"summary":"Pure MasterSlave doesn't work","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsigelnik","name":"tsigelnik","key":"tsigelnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dima","active":true,"timeZone":"Australia/Sydney"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483306/comment/12941155","id":"12941155","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mwc_tonesoft","name":"mwc_tonesoft","key":"mwc_tonesoft","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Chen","active":true,"timeZone":"Etc/UTC"},"body":"This has to do with NOT using the <broker waitForSlave=\"true\" ... > setting. The steps to reproduce are:\n\n1. Start master (waitForSlave=false).\n2. Let some client connect and send messages to a topic or queue.\n3. Start the slave.\n4. Send more messages, which will produce the following on the SERVER side log:\n\nERROR MasterBroker                   - Slave Failed\njava.lang.IllegalStateException: Cannot lookup a producer from a connection that had not been registered: ID:mwcs-37256-1237566087493-0:0\n        at org.apache.activemq.broker.MapTransportConnectionStateRegister.lookupConnectionState(MapTransportConnectionStateRegister.java:73)\n        at org.apache.activemq.broker.TransportConnection.lookupConnectionState(TransportConnection.java:1352)\n        at org.apache.activemq.broker.TransportConnection.getProducerBrokerExchange(TransportConnection.java:1233)\n        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:449)\n        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:639)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:305)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:104)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:205)\n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\n\nThe master still functions normally, but it keep receiving the above complain from the slave on every replication. It seems that there is no \"state replication\" from the master to the slave when the slave first attached. I suspect this is a design flaw that must be plugged.\n\nThe only remedy is to use the <broker waitForSlave=\"true\" ... > setting. Unfortunately, this degrades the pure master/slave significantly. If either the master or the slave is down, there is no way to restore the down node without shutting down the running node.  This means service interruption. The following no-service-interruption-scenarios are NOT possible:\n\nScenario1:\n  master_up -> client_connect -> slave_up -> slave_down -> slave_restart\n\nScenario2:\n  master_up -> client_connect -> slave_up -> master_down -> slave_become_master -> master_restart_as_slave\n\nNo service interruption is a common expectation of redundancy. This bug is related to bug AMQ-869.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mwc_tonesoft","name":"mwc_tonesoft","key":"mwc_tonesoft","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Chen","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-09T17:50:26.182+0000","updated":"2009-04-09T17:50:26.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483306/comment/12941154","id":"12941154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mwc_tonesoft","name":"mwc_tonesoft","key":"mwc_tonesoft","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Chen","active":true,"timeZone":"Etc/UTC"},"body":"If in step 2 above, a timer is run that triggers a message being sent to a topic every second via a vm transport. then it will produce a different exception at step 4:\n\nERROR MasterBroker                   - Slave Failed\njava.lang.NullPointerException\n        at org.apache.activemq.broker.region.Topic.send(Topic.java:266)\n        at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:350)\n        at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:437)\n        at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:224)\n        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:126)\n        at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:95)\n        at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:133)\n        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:450)\n        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:639)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:305)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:104)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:205)\n        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\n        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mwc_tonesoft","name":"mwc_tonesoft","key":"mwc_tonesoft","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Chen","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-09T18:12:45.015+0000","updated":"2009-04-09T18:12:45.015+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483306/comment/12941163","id":"12941163","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"To reduce service interruption, you can use a network of brokers so client can failover to them when you bring the running node down.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-14T13:30:44.720+0000","updated":"2009-04-14T13:30:44.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483306/comment/12941161","id":"12941161","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mwc_tonesoft","name":"mwc_tonesoft","key":"mwc_tonesoft","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Chen","active":true,"timeZone":"Etc/UTC"},"body":"From what I read, pure master/slave guarantees no message lost, but the networked broker documentation does not suggest that feature.  Nor does it explicitly say that it does exactly what pure master/slave do.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mwc_tonesoft","name":"mwc_tonesoft","key":"mwc_tonesoft","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Chen","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-14T23:51:12.042+0000","updated":"2009-04-14T23:51:12.042+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483306/comment/13506810","id":"13506810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Pure master slave is removed in upcoming v5.8.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-11-29T21:18:02.371+0000","updated":"2012-11-29T21:18:02.371+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1825/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0alxr:"}}