{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12679366","self":"https://issues.apache.org/jira/rest/api/2/issue/12679366","key":"AMQ-4889","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326455","id":"12326455","name":"5.9.1","archived":false,"released":true,"releaseDate":"2014-04-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324950","id":"12324950","name":"5.10.0","archived":false,"released":true,"releaseDate":"2014-06-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-12-04T16:12:50.589+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Dec 16 17:14:48 UTC 2013","customfield_12310420":"358728","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2705598585_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-12-16T17:14:48.447+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4889/watchers","watchCount":3,"isWatching":false},"created":"2013-11-15T09:41:29.897+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"10.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-04-02T22:16:09.073+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"See [nabble|http://activemq.2283324.n4.nabble.com/Proxy-Connector-memory-consumption-td4674255.html] for further details.\n\nTo reproduce the issue:\n# Start embedded proxy broker and the AMQ broker that are embedded in *AMQTestBroker* project (see attachments);\n# Start the *AMQTestConsumer* project; This program repeatedly tries opening a connection to the ProxyConnector with wrong certificates.\n# Open jconsole to monitor AMQTestBroker memory usage: you should experience an OOM error within one hour with the suggested settings (Xmx = 2048m).\n\nLaunch configurations and test keystores are attached to this issue along with the java projects.\n\nThis behavior seems to affect _ProxyConnector_ only, running the test against a standard nio-based _TransportConnector_ does not seem to produce anomalous memory consumptions.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616367","id":"12616367","filename":"after_lsof.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-29T11:33:21.970+0000","size":24818,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12616367/after_lsof.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616368","id":"12616368","filename":"after_netstat.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-29T11:33:21.974+0000","size":2296,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12616368/after_netstat.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12617002","id":"12617002","filename":"AMQ4889.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-04T16:13:43.293+0000","size":8088,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12617002/AMQ4889.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616364","id":"12616364","filename":"lsof.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-29T11:33:21.959+0000","size":276050,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12616364/lsof.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616365","id":"12616365","filename":"netstat.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-29T11:33:21.962+0000","size":17056,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12616365/netstat.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616363","id":"12616363","filename":"NIOSSLTransport_patch_AMQ_4889.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-29T11:33:21.954+0000","size":1098,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12616363/NIOSSLTransport_patch_AMQ_4889.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12617007","id":"12617007","filename":"ProxyConnection_patch_AMQ_4889.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-12-04T16:37:10.186+0000","size":1949,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12617007/ProxyConnection_patch_AMQ_4889.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12617008","id":"12617008","filename":"ProxyConnector_patch_AMQ_4889.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-12-04T16:37:10.192+0000","size":3482,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12617008/ProxyConnector_patch_AMQ_4889.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12614047","id":"12614047","filename":"ProxyConnIssue.rar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-15T09:42:16.995+0000","size":19156,"mimeType":"application/x-rar-compressed","content":"https://issues.apache.org/jira/secure/attachment/12614047/ProxyConnIssue.rar"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12616366","id":"12616366","filename":"sockstat.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-29T11:33:21.966+0000","size":139,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12616366/sockstat.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"359018","customfield_12312823":null,"summary":"ProxyConnector memory usage skyrockets when several ssl handshakes fails","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Seen in Windows 7 64bit, Windows Server 2008 R2 and Linux RHEL 6.3 64 bit","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679366/comment/13835229","id":"13835229","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"body":"I attached a possible patch. As long as I can see, the problem was adding ProxyConnection objs into a collection inside ProxyConnector before starting them.\n\nMaybe an amq guru can check this and gives some feedbacks?\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-29T07:35:25.840+0000","updated":"2013-11-29T07:35:25.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679366/comment/13835322","id":"13835322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"body":"Actually the problem in ProxyConnector hid something more than a simple problem ProxyConnector.java file. \n\nApparently some clean-up invocations were missing in SSLNIOTransport as well. This resulted in many leaked file descriptors in linux (RHEL 6.3 64 bit). \n\nBefore the attached patches the lsof command gave tons of\n{noformat}\njava    6530 platone    8u  sock                0,6      0t0 2489682586 can't identify protocol\njava    6530 platone    9u  sock                0,6      0t0 2489745273 can't identify protocol\njava    6530 platone   15u  sock                0,6      0t0 2489727545 can't identify protocol\njava    6530 platone   66u  sock                0,6      0t0 2489683982 can't identify protocol\njava    6530 platone   69u  sock                0,6      0t0 2489684335 can't identify protocol\njava    6530 platone   72u  sock                0,6      0t0 2489684339 can't identify protocol\njava    6530 platone   74u  sock                0,6      0t0 2489684688 can't identify protocol\njava    6530 platone   76u  sock                0,6      0t0 2489685055 can't identify protocol\njava    6530 platone   77u  sock                0,6      0t0 2489716539 can't identify protocol\njava    6530 platone   97u  sock                0,6      0t0 2489683431 can't identify protocol\njava    6530 platone   98u  sock                0,6      0t0 2489683450 can't identify protocol\njava    6530 platone   99u  sock                0,6      0t0 2489684695 can't identify protocol\njava    6530 platone  100u  sock                0,6      0t0 2489683990 can't identify protocol\njava    6530 platone  101u  sock                0,6      0t0 2489702245 can't identify protocol\njava    6530 platone  102u  sock                0,6      0t0 2489685058 can't identify protocol\n...\n{noformat}\n(see attached lsof.txt) with the following socket stats:\n{noformat}\nsockets: used 3067\nTCP: inuse 21 orphan 0 tw 0 alloc 2808 mem 2648\nUDP: inuse 6 mem 5\nUDPLITE: inuse 0\nRAW: inuse 1\nFRAG: inuse 0 memory 0\n{noformat}\nand the following netstat outcome:\n{noformat}\n...\ntcp        0      0 ::ffff:192.168.24.82:44201  ::ffff:192.168.16.166:61616 ESTABLISHED 6530/java           off (0.00/0/0)\ntcp        0      0 ::ffff:192.168.24.82:61619  ::ffff:192.168.24.66:64601  CLOSE_WAIT  6530/java           off (0.00/0/0)\ntcp        0      0 ::ffff:192.168.24.82:61619  ::ffff:192.168.24.67:9033   CLOSE_WAIT  6530/java           off (0.00/0/0)\ntcp        0      0 ::ffff:192.168.24.82:61619  ::ffff:192.168.24.66:56924  CLOSE_WAIT  6530/java           off (0.00/0/0)\ntcp        0      0 ::ffff:192.168.24.82:61619  ::ffff:192.168.24.66:33021  CLOSE_WAIT  6530/java           off (0.00/0/0)\ntcp        0      0 ::ffff:192.168.24.82:61619  ::ffff:192.168.24.67:56879  CLOSE_WAIT  6530/java           off (0.00/0/0)\ntcp        0      0 ::ffff:192.168.24.82:61619  ::ffff:192.168.24.67:51487  CLOSE_WAIT  6530/java           off (0.00/0/0)\ntcp        0      0 ::ffff:192.168.24.82:61619  ::ffff:192.168.24.66:35295  CLOSE_WAIT  6530/java           off (0.00/0/0)\ntcp        0      0 ::ffff:192.168.24.82:61619  ::ffff:192.168.24.67:49529  CLOSE_WAIT  6530/java           off (0.00/0/0)\ntcp        0      0 ::ffff:192.168.24.82:61619  ::ffff:192.168.24.67:51309  CLOSE_WAIT  6530/java           off (0.00/0/0)\n... many other CLOSE_WAIT\n{noformat}\nWe applied the attached patches and everything run better: the lsof stopped reporting the _can't identify protocol_ records and the number of connections in CLOSE_WAIT dropped to zero.\n\nSo what? Does it make sense to you?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-29T11:31:32.048+0000","updated":"2013-11-29T11:31:32.048+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679366/comment/13836369","id":"13836369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"body":"Still an issue in long-term memory consumption due to another bug in ProxyConnector: missing equals and hashCode methods in ProxyConnections induced a memory leakeage in connections collection inside ProxyConnector.\n\nI added another patch to solve also this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-12-02T08:39:29.760+0000","updated":"2013-12-02T08:39:53.421+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679366/comment/13839036","id":"13839036","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I've reviewed the attached patches, looks pretty good.  I applied the fix to the NIOSSLTransport.  The equals method in the ProxyConnection looks a bit odd, think maybe the equals comparison might be backwards.  I updated the fix a bit with some additional changes.  You should take a look and test in your setup.  Would be great if you can boil down the tests into a JUnit test of sorts so we can see if things are working as expected.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-04T16:12:50.589+0000","updated":"2013-12-04T16:12:50.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679366/comment/13839037","id":"13839037","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Proposed patch for this issue that addresses the cleanup code in the Proxy classes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-12-04T16:13:43.298+0000","updated":"2013-12-04T16:13:43.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679366/comment/13839065","id":"13839065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"body":"Actually, swapping the start method and the connections.add() in setAcceptListener method in ProxyConnector turned out not to be a good idea. The _connections.remove()_ in TransportFilter.stop may be called before the connections.add() is invoked.\nI appreciate this in the form of a tiny yet continous memory leakeage due to objects accumulating in connections collection.\n\nTherefore I modified again the ProxyConnector code to fix also this sort of race condition: now I invoke the connections.add() _before_ invoking the start but I manage the removal inside a try-catch block (see the updated ProxyConnector_patch_AMQ_4889.txt patch)\n\nBesides, I had to modify the equals method in ProxyConnection to avoid NPE in case local or remote transorts are null. I updated the ProxyConnection_patch_AMQ_4889.txt file with this fix.\nI'm not completely satisfied with this ProxyConnection.equals() method, since it seems a little bit awkward to me. I don't know, maybe you can suggest a better strategy to purge the connections list.\n\nThe patch is running for hours now and the issue seems to be fixed. I'll double check ram consumption tomorrow to have a stronger feedback.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-12-04T16:49:43.169+0000","updated":"2013-12-04T16:54:55.053+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679366/comment/13843367","id":"13843367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"body":"With the last checks and updates the ProxyConnector has been working great for days now: heap memory consumption is stable. I'll try to improve/simplify the test case in ProxyConnIssue.rar in the next days.\n\nIt would be great if I could have some feedbacks on the last patches I created.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matteor","name":"matteor","key":"matteor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"matteo rulli","active":true,"timeZone":"Etc/UTC"},"created":"2013-12-09T18:08:11.736+0000","updated":"2013-12-09T18:08:11.736+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679366/comment/13849349","id":"13849349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"body":"Fixed with checkin 257710ba1a40e0ac78f5f8035d9663775e122d41.  Thanks for the patches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kearls","name":"kearls","key":"kearls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kearls&avatarId=16572","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kearls&avatarId=16572","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kearls&avatarId=16572","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kearls&avatarId=16572"},"displayName":"Kevin Earls","active":true,"timeZone":"Europe/Berlin"},"created":"2013-12-16T17:14:48.475+0000","updated":"2013-12-16T17:14:48.475+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4889/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1pu8n:"}}