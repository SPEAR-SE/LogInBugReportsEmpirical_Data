{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483456","self":"https://issues.apache.org/jira/rest/api/2/issue/12483456","key":"AMQ-2902","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315625","id":"12315625","description":"","name":"5.4.2","archived":false,"released":true,"releaseDate":"2010-12-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-09-08T05:15:12.952+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 08 12:58:23 UTC 2010","customfield_12310420":"14843","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2683448084_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-10-08T12:58:23.359+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2902/watchers","watchCount":3,"isWatching":false},"created":"2010-09-07T11:34:15.275+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-10-08T12:58:23.341+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313898","id":"12313898","name":"JCA Container"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"After upgrading to 5.4.0 we see many exceptions of the following kind being logged with level INFO:\n{quote}\n2010-09-07 13:23:25,824 INFO  [org.apache.activemq.broker.TransportConnection.Transport] Transport failed: org.apache.activemq.transport.TransportDisposedIOException: Peer (vm://caa.embedded?waitForStart=300000&async=false#13) disposed.\norg.apache.activemq.transport.TransportDisposedIOException: Peer (vm://caa.embedded?waitForStart=300000&async=false#13) disposed.\n\tat org.apache.activemq.transport.vm.VMTransport.stop(VMTransport.java:159)\n\tat org.apache.activemq.transport.vm.VMTransportServer$1.stop(VMTransportServer.java:81)\n\tat org.apache.activemq.transport.TransportFilter.stop(TransportFilter.java:65)\n\tat org.apache.activemq.transport.TransportFilter.stop(TransportFilter.java:65)\n\tat org.apache.activemq.transport.ResponseCorrelator.stop(ResponseCorrelator.java:132)\n\tat org.apache.activemq.util.ServiceSupport.dispose(ServiceSupport.java:43)\n\tat org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:656)\n\tat org.apache.activemq.ra.ActiveMQManagedConnection.destroy(ActiveMQManagedConnection.java:207)\n\tat org.jboss.resource.connectionmanager.InternalManagedConnectionPool.doDestroy(InternalManagedConnectionPool.java:650)\n\tat org.jboss.resource.connectionmanager.InternalManagedConnectionPool.removeTimedOut(InternalManagedConnectionPool.java:481)\n\tat org.jboss.resource.connectionmanager.IdleRemover$IdleRemoverRunnable.run(IdleRemover.java:164)\n\tat java.lang.Thread.run(Thread.java:619)\n{quote}\nI suppose that the cause for the message is actually harmless - hence the INFO level - but the messages are confusing and annoying nonetheless.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"63725","customfield_12312823":null,"summary":"ResourceAdapter logs confusing Exception upon pool connection disposal","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hennejg","name":"hennejg","key":"hennejg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg Henne","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hennejg","name":"hennejg","key":"hennejg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg Henne","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"AMQ 5.4.0 ResourceAdapter running with an embedded broker within JBoss 4.2.3","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483456/comment/12942835","id":"12942835","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"body":"I have been told that this is harmless and have been fixed on trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davsclaus","name":"davsclaus","key":"davsclaus","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=davsclaus&avatarId=15835","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=davsclaus&avatarId=15835","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=davsclaus&avatarId=15835","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=davsclaus&avatarId=15835"},"displayName":"Claus Ibsen","active":true,"timeZone":"Europe/Berlin"},"created":"2010-09-08T05:15:12.952+0000","updated":"2010-09-08T05:15:12.952+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483456/comment/12942954","id":"12942954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rjtokenlanring","name":"rjtokenlanring","key":"rjtokenlanring","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Colombo Marco","active":true,"timeZone":"Etc/UTC"},"body":"Also with 5.4.1 release (on JBoss 4.2.3.GA) this issue is present:\n\n2010-09-22 11:29:31,458 INFO  [org.apache.activemq.broker.TransportConnection.Transport] Transport failed: org.apache.activemq.transport.TransportDisposedIOException: Peer (vm://localhost#37) disposed.\norg.apache.activemq.transport.TransportDisposedIOException: Peer (vm://localhost#37) disposed.\n        at org.apache.activemq.transport.vm.VMTransport.stop(VMTransport.java:159)\n        at org.apache.activemq.transport.vm.VMTransportServer$1.stop(VMTransportServer.java:81)\n        at org.apache.activemq.transport.TransportFilter.stop(TransportFilter.java:65)\n        at org.apache.activemq.transport.TransportFilter.stop(TransportFilter.java:65)\n        at org.apache.activemq.transport.ResponseCorrelator.stop(ResponseCorrelator.java:132)\n        at org.apache.activemq.util.ServiceSupport.dispose(ServiceSupport.java:43)\n        at org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:656)\n        at org.apache.activemq.ra.ActiveMQManagedConnection.destroy(ActiveMQManagedConnection.java:207)\n        at org.jboss.resource.connectionmanager.InternalManagedConnectionPool.doDestroy(InternalManagedConnectionPool.java:650)\n        at org.jboss.resource.connectionmanager.InternalManagedConnectionPool.removeTimedOut(InternalManagedConnectionPool.java:481)\n        at org.jboss.resource.connectionmanager.IdleRemover$IdleRemoverRunnable.run(IdleRemover.java:164)\n        at java.lang.Thread.run(Thread.java:619)\n\nBut this affects the broker? This could bring to errors or broker faults?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rjtokenlanring","name":"rjtokenlanring","key":"rjtokenlanring","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Colombo Marco","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-22T09:31:32.990+0000","updated":"2010-09-22T09:39:58.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483456/comment/12943023","id":"12943023","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=basti1302","name":"basti1302","key":"basti1302","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bastian Krol","active":true,"timeZone":"Etc/UTC"},"body":"I too see that issue in the current 5.4.1  release. This has nothing to do with JBoss. It is reproducible in an ordinary Java application (see below). Claus, who told you that is fixed in the trunk? From looking at the sources in the trunk I have the impression that the related code has not changed (but I'm guessing a bit here and could be wrong). The small test below reproduces the problem. Note that the exception gets logged less frequently if you start and stop the connection before closing it (enable the two commented lines). But it still occurs. It occurs every time if you do not start and stop the connection.\n\n\n{code:title=AMQ2902.java|borderStyle=solid}\nimport javax.jms.Connection;\nimport javax.jms.ConnectionFactory;\nimport javax.jms.JMSException;\n\nimport org.apache.activemq.ActiveMQConnectionFactory;\n\npublic class AMQ2902\n{\n  public static void main(String[] arguments) throws JMSException\n  {\n    ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(\n        \"vm://localhost?broker.persistent=false\");\n    Connection connection = connectionFactory.createConnection();\n    // connection.start();\n    // connection.stop();\n    connection.close();\n  }\n}\n{code} \n\nKind regards,\n\n  Bastian","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=basti1302","name":"basti1302","key":"basti1302","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bastian Krol","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-01T08:19:18.508+0000","updated":"2010-10-01T08:20:02.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483456/comment/12943034","id":"12943034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=basti1302","name":"basti1302","key":"basti1302","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bastian Krol","active":true,"timeZone":"Etc/UTC"},"body":"The obvious workaround is to configure log4j to not show INFO level messages from the logger in question.\n\n\n{noformat} \n  <logger name=\"org.apache.activemq.broker.TransportConnection.Transport\">\n    <level value=\"warn\" />\n  </logger>\n{noformat} \n\n\nHowever, a possible (very simplistic) fix would be to change {{TRANSPORTLOG.info(\"Transport failed: \" + e, e);}} into {{TRANSPORTLOG.info(\"Transport failed: \" + e);}}  in {{org.apache.activemq.broker.TransportConnection}}. Since it is only a logging on info, the stack trace is probably not of interest anyway, right?\n\nPatch:\n\n{noformat} \n### Eclipse Workspace Patch 1.0\n#P activemq-core\nIndex: src/main/java/org/apache/activemq/broker/TransportConnection.java\n===================================================================\n--- src/main/java/org/apache/activemq/broker/TransportConnection.java\t(revision 1003422)\n+++ src/main/java/org/apache/activemq/broker/TransportConnection.java\t(working copy)\n@@ -233,7 +233,7 @@\n         if (!stopping.get()) {\n             transportException.set(e);\n             if (TRANSPORTLOG.isInfoEnabled()) {\n-                TRANSPORTLOG.info(\"Transport failed: \" + e, e);\n+                TRANSPORTLOG.info(\"Transport failed: \" + e);\n             }\n             stopAsync();\n         }\n{noformat} \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=basti1302","name":"basti1302","key":"basti1302","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bastian Krol","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-01T08:29:18.230+0000","updated":"2010-10-01T08:36:54.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483456/comment/12943000","id":"12943000","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"resolved in r1005094","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-08T12:58:23.323+0000","updated":"2010-10-08T12:58:23.323+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2902/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0b9yf:"}}