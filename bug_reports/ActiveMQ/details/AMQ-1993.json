{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483053","self":"https://issues.apache.org/jira/rest/api/2/issue/12483053","key":"AMQ-1993","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"parent":{"id":"12482857","key":"AMQ-2308","self":"https://issues.apache.org/jira/rest/api/2/issue/12482857","fields":{"summary":"org.apache.activemq.broker.ft.TransactedTopicMasterSlaveTest test hang on Solaris","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-11-03T13:21:25.716+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jun 22 08:22:37 UTC 2009","customfield_12310420":"75135","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_61131297_*|*_6_*:*_1_*:*_0_*|*_5_*:*_2_*:*_19408351042_*|*_4_*:*_2_*:*_302925021","customfield_12312321":null,"resolutiondate":"2009-06-19T20:53:04.825+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1993/watchers","watchCount":2,"isWatching":false},"created":"2008-11-03T00:32:57.465+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-26T16:25:24.937+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10091","value":"Regression","id":"10091"}],"description":"the blocking Java Socket API doesn't have a timeout on socketWrite invocations.\nThis means, if a TCP session is dropped or terminated without RST or FIN packets, the operating system it left to eventually time out the session. On the linux kernel this timeout usually takes 15 to 30minutes. \n\nFor this entire period, the AMQ server hangs, and producers and consumers are unable to use a topic.\n\nI have created two patches for this at the page:\nhttp://www.hanik.com/covalent/amq/index.html\n\nLet me show a bit more\n---------------------------------\n\"ActiveMQ Transport: tcp:///X.YYY.XXX.ZZZZ:2011\" daemon prio=10 tid=0x0000000055d39000 nid=0xc78 runnable [0x00000000447c9000..0x00000000447cac10]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.SocketOutputStream.socketWrite0(Native Method)\n\tat java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n\nThis is a thread stuck in blocking IO, and can be stuck for 30 minutes during the kernel TCP retransmission attempts.\nUnfortunately the thread dump is very misleading since the name of the thread, is not the destination or even remotely related to the socket it is operating on.\nTo mend this, a very simple (and configurable) ThreadNameFilter has been suggested to the patch, that appends the destination and helps the system administrator correctly identify the client that is about to receive data. \n\n-----------------------------------\n\tat org.apache.activemq.broker.region.Topic.dispatch(Topic.java:581)\n\tat org.apache.activemq.broker.region.Topic.doMessageSend(Topic.java:421)\n\t- locked <0x00002aaaec155818> (a org.apache.activemq.broker.region.Topic)\n\tat org.apache.activemq.broker.region.Topic.send(Topic.java:363)\nThe lock being held at this issue unfortunately makes the entire Topic single threaded. \nWhen this lock is being held, no other clients (producers and consumers) can publish to/receive from this topic.\nAnd this lock can hold up to 30 minutes.\nI consider solving this single threaded behavior a 'feature enhancement' that should be handled separately from this bug. Because even if it is solved, threads still risk being stuck in socketWrite0 for dropped connections that still appear to be established.\n\nFor this, I have implemented a socket timeout filter, based on a TransportFilter, this filter only times out connections that are actually writing data.\n\nThe two patches are at:\nhttp://www.hanik.com/covalent/amq/patch-1-threadname-filter.patch\nhttp://www.hanik.com/covalent/amq/patch-3-tcp-writetimeout.patch\n\nthe binary 0000.jar applies to both 5.1 and trunk and can be used today in existing environments. \n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461538","id":"12461538","filename":"jstack.blockedSession","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=felixehm","name":"felixehm","key":"felixehm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Felix Ehm","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-16T09:12:54.572+0000","size":166715,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12461538/jstack.blockedSession"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461191","id":"12461191","filename":"patch-1-threadname-filter.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T13:38:15.833+0000","size":4112,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461191/patch-1-threadname-filter.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461268","id":"12461268","filename":"patch-3-tcp-writetimeout.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T13:38:50.218+0000","size":11081,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461268/patch-3-tcp-writetimeout.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"171885","customfield_12312823":null,"summary":"Systems hang due to inability to timeout socket write operation","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Unix (Solaris and Linux tested)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940440","id":"12940440","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"these fixes look great. Can you attach your patch files to this jira and select the appropriate license grant option.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T13:21:25.716+0000","updated":"2008-11-03T13:21:25.716+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940408","id":"12940408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"on the tcp-writetimeout patch\n\nIn the catch clause below:\n{code}\n+    public void oneway(Object command) throws IOException {\n+        try {\n+            registerWrite(this);\n+            super.oneway(command);\n+        } catch (IOException x) {\n+            deRegisterWrite(this,true,x);\n+            throw x;\n+        } finally {\n{code}\n\nfail is passed to deRegisterWrite which will cause a throw of the Forced exception rather than x. It seems that deRegisterWrite ignores the IOException argument which I guess is not intended, or is it?\n\nWould it be possible to include some junit tests for this functionality?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T13:31:45.860+0000","updated":"2008-11-03T13:31:45.860+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940424","id":"12940424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"maybe you misread the code\n\nif (fail) {\n                IOException ex = (iox!=null)?iox:new IOException(\"Forced write timeout for:\"+filter.getNext().getRemoteAddress());\n                filter.getTransportListener().onException(ex);\n}\n\nFilip","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T13:37:38.178+0000","updated":"2008-11-03T13:37:38.178+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940391","id":"12940391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"thread name filter - patch 1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T13:38:15.871+0000","updated":"2008-11-03T13:38:15.871+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940413","id":"12940413","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"{code}\nif (fail) { \n  IOException ex = (iox!=null)?iox:new IOException(\"Forced write timeout for:\"+filter.getNext().getRemoteAddress()); \n  filter.getTransportListener().onException(ex); \n}\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T13:44:24.831+0000","updated":"2008-11-03T13:44:24.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940417","id":"12940417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"one more thought:\nwould it be sufficient to do deRegister in the finally and only have the timeout thread force an exception. I guess the question is, why is deRegister interested in the exception at all?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T13:53:01.311+0000","updated":"2008-11-03T13:53:01.311+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940437","id":"12940437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"I am currently working on a test case so that you can see this in action.\nIn the real life the following way is the easiest to reproduce\n\nHave a few machines, consumers and producers working with the same topic\n\nOn one consumer machine - pull out the network cord\n\nThis action causes the connection to be in \"ESTABLISHED\" state, since no RST or FIN packets have been sent.\nthe Linux TCP implementation will then try to resend the packet 15 times (default config) with 2min in between each retransmission.\n\nDuring this time, the server will keep filling up the TCP send buffer in the kernel, and when it is full, the thread will get stuck in java.net.Socket.socketWrite0\nbecause this thread also holds the lock on the topic, no other thread can operate on the topic anymore\n\nbest\nFilip","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T14:01:13.172+0000","updated":"2008-11-03T14:01:13.172+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940411","id":"12940411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"Here is another example of a thread locking up the entire system, based on the same scenario.\n\n{code}\n\"BrokerService\" daemon prio=10 tid=0x0000000060103800 nid=0x74e7 runnable [0x00000000467c7000..0x00000000467c7c10]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.SocketOutputStream.socketWrite0(Native Method)\n\tat java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n\tat java.net.SocketOutputStream.write(SocketOutputStream.java:136)\n\tat org.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedOutputStream.java:106)\n\tat java.io.DataOutputStream.flush(DataOutputStream.java:106)\n\tat org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:165)\n\tat org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:233)\n\t- locked <0x00002aaabe89c2b0> (a java.util.concurrent.atomic.AtomicBoolean)\n\tat org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:83)\n\tat org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:100)\n\tat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\n\t- locked <0x00002aaabe89cc10> (a java.lang.Object)\n\tat org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1188)\n\tat org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:776)\n\tat org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:813)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\n{code}\n\nand as a result other threads are blocked\n{code}\n\"ActiveMQ Transport Stopper: /xx.xx.xxx.xxx:61489\" daemon prio=10 tid=0x00000000607ad400 nid=0x7687 waiting for monitor entry [0x00000000450b0000..0x00000000450b0c90]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\n\t- waiting to lock <0x00002aaabe89cc10> (a java.lang.Object)\n\tat org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1188)\n\tat org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:776)\n\tat org.apache.activemq.broker.TransportConnection.dispatchSync(TransportConnection.java:735)\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T14:09:40.378+0000","updated":"2008-11-03T14:12:07.713+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940426","id":"12940426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"ah, apologies, I did mis read. I understand the problem, thanks.\n\nStill wondering bout my last comment though, why is deRegisterWriter interested in exceptions?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T14:13:42.227+0000","updated":"2008-11-03T14:13:42.227+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940444","id":"12940444","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"{quote}\none more thought:\nwould it be sufficient to do deRegister in the finally and only have the timeout thread force an exception. I guess the question is, why is deRegister interested in the exception at all?\n{quote}\n\nThe reason is because deregister is atomic, that way we close the socket for the correct reason, and not make up a reason if a real socket exception and a timeout happen at the same time.\n\nI thought about it for a while, to just ignore the socket exception that came from the underlying layer, and pass it on, but then I thought it would be safer to invoke the onException to guarantee a socket closure regardless of the IO exception that came back.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T14:14:53.229+0000","updated":"2008-11-03T14:14:53.229+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940399","id":"12940399","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Am not sure it is safer because the filter introduces a change of behaviour to the normal exception case. Ie: onException is now always called.\nIn addition, in the event that a close is done async from an onException, there is still an opportunity to have a normal IOException interleaved with a Forced exception.\nI think this is the same as with a pass through on exception, a close can get called twice, but this is handled ok by close.\nMostly though, I am wary of the change in behaviour introduced by the exception handler.\nAs this is a filter that is added by choice it is not such a big deal but we may as well iron out the detail. This is a handy feature. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T15:13:58.095+0000","updated":"2008-11-03T15:13:58.095+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940415","id":"12940415","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"{quote}\nthere is still an opportunity to have a normal IOException interleaved with a Forced exception.\n{quote}\nThis is not the case. the deregister operation is atomic. deregister will never call throw twice. However, the oneway method will not stop the normal exception from propagating the underlying exception to the top. so only one exception will raise on the invoking thread. \nIn case of a 'forced timeout exception' there will be two exceptions. On that is invoked in the onException, there will be a 2nd exception when the async handler calls socket.close, and terminates the write state.\n\n{quote}\nAs this is a filter that is added by choice it is not such a big deal but we may as well iron out the detail. This is a handy feature.\n{quote}\nnot only handy, but essential. It prevents the entire server from a complete dead lock due to synchronization in the higher layers.\nOnce that synchronization has been mended, it is still a handy feature, since it prevents single threads from becoming locked for a very long time.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T15:49:53.241+0000","updated":"2008-11-03T15:49:53.241+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940419","id":"12940419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"That being said, the upper layer can react to the propagating IO exception if needed. But that shouldn't be an issue, this filter does what it is supposed to do. We could add more parameters to make the behavior configurable.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T15:57:23.262+0000","updated":"2008-11-03T15:57:23.262+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940436","id":"12940436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"agreed, will commit in an hour or so, once a sanity run of the tests completes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T16:18:52.137+0000","updated":"2008-11-03T16:18:52.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940432","id":"12940432","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"patch applied in r710109\nthanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-03T17:31:48.691+0000","updated":"2008-11-03T17:31:48.691+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940425","id":"12940425","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"Index: activemq-core/src/main/java/org/apache/activemq/transport/tcp/TcpBufferedOutputStream.java\n\nlooks like I have a copy paste error\n\n+                try {\n+                    writeTimestamp = System.currentTimeMillis();\n+                    out.write(b, off, len);\n+                } finally {\n+                    writeTimestamp = System.currentTimeMillis();\n+                }\n\n\nshould be \n\n+                try {\n+                    writeTimestamp = System.currentTimeMillis();\n+                    out.write(b, off, len);\n+                } finally {\n+                    writeTimestamp = -1;\n+                }\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-04T16:01:49.415+0000","updated":"2008-11-04T16:01:49.415+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940443","id":"12940443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"just to be sure, the change is one line, right?:\n{code}\nIndex: src/main/java/org/apache/activemq/transport/tcp/TcpBufferedOutputStream.java\n===================================================================\n--- src/main/java/org/apache/activemq/transport/tcp/TcpBufferedOutputStream.java\t(revision 711284)\n+++ src/main/java/org/apache/activemq/transport/tcp/TcpBufferedOutputStream.java\t(working copy)\n@@ -95,7 +95,7 @@\n                     writeTimestamp = System.currentTimeMillis();\n                     out.write(b, off, len);\n                 } finally {\n-                    writeTimestamp = System.currentTimeMillis();\n+                    writeTimestamp = -1;\n                 }\n             }\n         }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-04T16:10:53.268+0000","updated":"2008-11-04T16:10:53.268+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940457","id":"12940457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"update applied in r711292","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-04T16:22:35.331+0000","updated":"2008-11-04T16:22:35.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12940459","id":"12940459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"That's correct Gary, thank you!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-04T17:39:50.940+0000","updated":"2008-11-04T17:39:50.940+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12939449","id":"12939449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"These fixes will now make 5.2.0 rc3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-06T10:47:07.963+0000","updated":"2008-11-06T10:47:07.963+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12941501","id":"12941501","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=felixehm","name":"felixehm","key":"felixehm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Felix Ehm","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nI am using ActiveMQ 5.3.0  and apparently run into this reported problem again. \nOur clients weren't able to get any sessions and I first thought that it is a problem with the CopyOnWriteArray Object where consumers are kept. But then I saw one thread in RUNNABLE locking 3 mutexes and writing using java.net.SocketOutputStream.socketWrite0.\n\nI attached the thread dump file for investigations.\n\nUnfortunately I can't reproduce this situation with a unit test. The only additional information I got from our client was that he tried to restarted the connection within very short period (1-2 sec).\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=felixehm","name":"felixehm","key":"felixehm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Felix Ehm","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-16T09:05:05.647+0000","updated":"2009-06-16T09:10:51.795+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12941508","id":"12941508","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=felixehm","name":"felixehm","key":"felixehm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Felix Ehm","active":true,"timeZone":"Etc/UTC"},"body":"jstack thread dump","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=felixehm","name":"felixehm","key":"felixehm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Felix Ehm","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-16T09:12:17.061+0000","updated":"2009-06-16T09:12:17.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12941509","id":"12941509","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=felixehm","name":"felixehm","key":"felixehm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Felix Ehm","active":true,"timeZone":"Etc/UTC"},"body":"jstack thread dump","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=felixehm","name":"felixehm","key":"felixehm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Felix Ehm","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-16T09:12:54.599+0000","updated":"2009-06-16T09:12:54.599+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12941489","id":"12941489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"Felix, did you configure a timeout? transport.soWriteTimeout?\n\n\nExample for configuring socket timeouts - transport.soTimeout applies to read, transport.soWriteTimeout applies to write.\n\n\n\t   <transportConnector\n\t       name=\"tcp1\"\n\t       uri=\"tcp://127.0.0.1:61616?transport.soTimeout=10000&amp;transport.soWriteTimeout=15000\"\n\t   />\n\t   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-16T17:59:01.719+0000","updated":"2009-06-16T17:59:01.719+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12941559","id":"12941559","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"body":"closing the WriteTimeoutFilter thread is not configured in the example stack trace.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhanik","name":"fhanik","key":"fhanik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Filip Hanik","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-19T20:53:04.769+0000","updated":"2009-06-19T20:53:04.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483053/comment/12941569","id":"12941569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=felixehm","name":"felixehm","key":"felixehm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Felix Ehm","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nthanks for the hint. Haven't tested it, but it appears to be reasonable.\n\nIs there a reason for not having a timeout configured by default ?\n\n\nCheers,\nFelix","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=felixehm","name":"felixehm","key":"felixehm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Felix Ehm","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-22T08:22:37.010+0000","updated":"2009-06-22T08:22:37.010+0000"}],"maxResults":26,"total":26,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1993/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ts8v:"}}