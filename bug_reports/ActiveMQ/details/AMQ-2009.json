{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483280","self":"https://issues.apache.org/jira/rest/api/2/issue/12483280","key":"AMQ-2009","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2008-11-21T16:37:40.771+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jul 03 23:31:28 UTC 2014","customfield_12310420":"75128","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2009/watchers","watchCount":29,"isWatching":false},"created":"2008-11-20T23:58:18.855+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[{"id":"12369498","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12369498","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12649475","key":"AMQ-4556","self":"https://issues.apache.org/jira/rest/api/2/issue/12649475","fields":{"summary":"Store based cursor \"forgets\" messages","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-07-03T23:31:28.484+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Messages are not getting dispatched after a while (although it accepts new incoming messages) until restart of the broker. This problem is described in several posts.\n\nhttp://www.nabble.com/Pending-Messages-are-shown-in-ActiveMQ-td20241332.html\n\nhttp://www.nabble.com/Consumer-Listener-stop-receving-message-until-ActiveMQ-restart-td20355247.html\n\nhttp://www.nabble.com/Stuck-messages---Dispatch-issues-td20467949.html\n\nThere was also an issue opened in Spring project for this thinking it was Spring problem.\n\nhttp://jira.springframework.org/browse/SPR-5110\n\nI am not able to reproduce with Junit test case having BrokerService started with in the test case. I guess I am not hitting the right stress conditions this way. But when I run the test case against an externally running ActiveMQ instance backed with oracle database persistence, it is reproducible most of the times. This is not a every time failure situation, it takes more time once than the other.\n\nI was able to hit this situation of stuck messages on queue using following scenario most of the times:\n\n1) Start 2 concurrent consumers for the queue using Spring's DefaultMessageListenerContainer using cacheLevelName as CACHE_CONSUMER\n2) Send messages using JMETER 2.3.2 to the queue on ActiveMQ stand alone broker instance with 50 threads looping 20 times.\n3) After a while, you will notice that Spring logs that no messages are being received but the messages are shown jconsole of ActiveMQ and the database backing it for persistence.\n\nBut in 5.2 RC3, the problem is that it dispatches duplicate messages and does not remove them from broker's database after acknowledge properly.\n\nAttached test case might help to reproduce when run against externally running stand alone ActiveMQ broker. Another way to see the problem is that try to load test using JMETER by sending messages to a queue with a camel route that moves messages from this queue to another and you will notice that it stops moving after while or copied duplicates in case of 5.2 RC3.\n\nSorry about such a huge description but it is a real problem! A different team at our company are having this issue in production with 5.1. They are using it as an embedded broker with derby for persistence.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461417","id":"12461417","filename":"AMQ-2009Testcase2.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2009-03-20T14:27:47.300+0000","size":7078,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461417/AMQ-2009Testcase2.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461902","id":"12461902","filename":"consumertest.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brecht","name":"brecht","key":"brecht","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brecht Yperman","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-15T17:14:56.484+0000","size":2974,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461902/consumertest.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461250","id":"12461250","filename":"DispatchMultipleConsumersTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chrajanirao","name":"chrajanirao","key":"chrajanirao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajani Chennamaneni","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-21T18:55:35.674+0000","size":6044,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461250/DispatchMultipleConsumersTest.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461340","id":"12461340","filename":"JConsole-screenshot.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mlucas","name":"mlucas","key":"mlucas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Maurits Lucas","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-15T10:30:53.339+0000","size":107763,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12461340/JConsole-screenshot.jpg"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461411","id":"12461411","filename":"testcase.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2009-03-18T17:48:15.609+0000","size":9003,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461411/testcase.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"59806","customfield_12312823":null,"summary":"Problem with message dispatch after a while","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chrajanirao","name":"chrajanirao","key":"chrajanirao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajani Chennamaneni","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chrajanirao","name":"chrajanirao","key":"chrajanirao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajani Chennamaneni","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12940509","id":"12940509","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"Could you re submit your test case (attach file, again) and tick the \"ASF Granted License\" box so that your test can be included in the code base?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-21T16:37:40.771+0000","updated":"2008-11-21T16:37:40.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12940489","id":"12940489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chrajanirao","name":"chrajanirao","key":"chrajanirao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajani Chennamaneni","active":true,"timeZone":"Etc/UTC"},"body":"Re-attaching the test case with ASF grant.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chrajanirao","name":"chrajanirao","key":"chrajanirao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajani Chennamaneni","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-21T18:55:35.719+0000","updated":"2008-11-21T18:55:35.719+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12940531","id":"12940531","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"on 5.2 giving duplicate messages. The recent fix for AMQ-2020 may be relevant. If you get a chance, can you try out last nights 5.3-SNAPSHOT build. http://people.apache.org/repo/m2-snapshot-repository/org/apache/activemq/apache-activemq/5.3-SNAPSHOT/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-04T11:44:32.218+0000","updated":"2008-12-04T11:44:32.218+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12940539","id":"12940539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdirkse","name":"mdirkse","key":"mdirkse","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Maarten Dirkse","active":true,"timeZone":"Europe/Berlin"},"body":"For what it's worth: the 5.3-SNAPSHOT does seem to fix the duplicate message issue (no more exceptions are reported), but it does not fix this bug. Our test runs hang our broker at more or less the same point (1.4 million messages) for 5.1, 5.2 and 5.3-SNAPSHOT.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdirkse","name":"mdirkse","key":"mdirkse","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Maarten Dirkse","active":true,"timeZone":"Europe/Berlin"},"created":"2008-12-09T11:36:45.461+0000","updated":"2008-12-09T11:36:45.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12940585","id":"12940585","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mlucas","name":"mlucas","key":"mlucas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Maurits Lucas","active":true,"timeZone":"Etc/UTC"},"body":"We have been able to reproduce this issue in our test runs every time.\n\nThe only problem, and the reason I haven't got a unit test for you, is that it takes a very long time to rear its ugly head.\n\nThe minimum setup which exposes the issue is have a producer (P1) send a lot (6 million in our case) messages to a topic (t1) and have one consumer (C1) consume the messages from the topic and publish them to a queue (q1).\n\nP1 --> [t1] --> C1 --> [q1] \n\nBoth P1 and C1 produce and consume / produce messages as fast as they can. Because P1 produces faster than C1 can consume, we get a fast producer / slow consumer for that topic.\n\nAt the end of the run, there are 6 million messages on the queue, but if you add a consumer to the queue, it won't consume any messages. If you browse the queue using the webconsole, it appears empty. Only restarting ActiveMQ gets q1 working again.\n\nIn our previous tests, we discovered that this \"freezing\" of dispatching (it affects other queues than q1 as well) starts somewhere during the publishing of the 6 million messages to t1.\n\nWe are using a standalone broker, Kaha for persistence and Spring 2.5.4 for JMS support.\n\nOS: Linux (2.6.18-92.1.18.el5 #1 SMP Wed Nov 12 09:19:49 EST 2008 x86_64 x86_64 x86_64 GNU/Linux)\nJava: \n  java version \"1.6.0_10\"\n  Java(TM) SE Runtime Environment (build 1.6.0_10-b33)\n  Java HotSpot(TM) 64-Bit Server VM (build 11.0-b15, mixed mode)\n\nWe have tested with 5.1.0, 5.2.0 and 5.3-SNAPSHOT. Using 5.1.0 and the snapshot we ran into the issue, with 5.2.0 we ran into AMQ-2020 and so didn't test any further.\n\nWe saw some peculiar values for the inflight counter on t1, this leveled out at 32766 for hours on end, sometimes going down to 32765 for a couple of seconds. Not sure if that is significant, but I am including a screenshot of JConsole just in case.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mlucas","name":"mlucas","key":"mlucas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Maurits Lucas","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-15T10:29:03.327+0000","updated":"2008-12-15T10:29:03.327+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12940569","id":"12940569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mlucas","name":"mlucas","key":"mlucas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Maurits Lucas","active":true,"timeZone":"Etc/UTC"},"body":"Screenshot of topic t1 with inflight counter graphed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mlucas","name":"mlucas","key":"mlucas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Maurits Lucas","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-15T10:30:53.408+0000","updated":"2008-12-15T10:30:53.408+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12943298","id":"12943298","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brecht","name":"brecht","key":"brecht","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brecht Yperman","active":true,"timeZone":"Etc/UTC"},"body":"I have a very similar problem, though much easier to reproduce.\n\nI might be doing something wrong however (test runs on Websphere MQ though).\n\nOn one thread:\n1 - Create connection1, session1, producer1 for queue queue1\n2 - send message using producer1\n3 - Create connection2, session2, consumer2 for queue queue1\n4 - receive message using consumer2\n5 - Create connection3, session3, producer3 for queue queue1\n6 - send message using producer3\n7 - close producer3, session3, connection3\n8 - Create connection4, session4, consumer4 for queue queue1\n9 - receive message using consumer4\n10 - close consumer4, session4, connection4\n11 - close consumer2, session2, connection2\n12 - close producer1, session1, connection1\n\nStep 9 gives a timeout, the message sent in step 6 is never received...\n\nI will attach my testcode...\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brecht","name":"brecht","key":"brecht","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brecht Yperman","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-15T17:11:58.404+0000","updated":"2008-12-15T17:11:58.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12943291","id":"12943291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brecht","name":"brecht","key":"brecht","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brecht Yperman","active":true,"timeZone":"Etc/UTC"},"body":"This is some testcode (very ugly, sorry) that keeps a consumer opened, and then tries to retrieve a message using a second consumer, but that consumer never receives the message","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brecht","name":"brecht","key":"brecht","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brecht Yperman","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-15T17:14:56.531+0000","updated":"2008-12-15T17:14:56.531+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12943292","id":"12943292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brecht","name":"brecht","key":"brecht","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brecht Yperman","active":true,"timeZone":"Etc/UTC"},"body":"If I introduce a step between 10 and 11: receive message using consumer2, the message sent in step 6 is received.\n\nhttp://activemq.apache.org/point-to-point-with-multiple-consumers.html\n\nThis says the behaviour is undefined, so I shouldn't nag, I guess?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brecht","name":"brecht","key":"brecht","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brecht Yperman","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-15T17:18:54.237+0000","updated":"2008-12-15T17:18:54.237+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12940630","id":"12940630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mlucas","name":"mlucas","key":"mlucas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Maurits Lucas","active":true,"timeZone":"Etc/UTC"},"body":"Ho hum, turns out we had producer flow control disabled in our setup. Switching it on solved the issue, now our tests process all 5.9 million messages correctly and ActiveMQ no longer hangs.\n\nAnd I think the max value for the inflight counter of 32766 observed in earlier tests is explained by the default prefetch size for topics: 32766.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mlucas","name":"mlucas","key":"mlucas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Maurits Lucas","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-30T10:45:14.337+0000","updated":"2008-12-30T10:45:14.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12940957","id":"12940957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zieluuuu","name":"zieluuuu","key":"zieluuuu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lukasz Zielinski","active":true,"timeZone":"Etc/UTC"},"body":"We ran into the same problem using topics (with 5.2.0) - we use only TCP transport and persistence is disabled.\n\nAfter some time (will make this more specific when I get more data from support) our appication stops receiving and publishing messages on a topic. \nWhen I check the broker using JMX console  ~13000 messages in flight are reported. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zieluuuu","name":"zieluuuu","key":"zieluuuu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lukasz Zielinski","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-11T09:02:09.483+0000","updated":"2009-03-11T09:02:09.483+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12941025","id":"12941025","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"body":"Don't want to say anything about the bug itself but I took consumertest.zip and turned it into a Maven JUnit test (see attached testcase.zip) in order to investigate into this problem. This new testcase also reproduces the same behavior however I do not believe this testcase shows a bug. Let me explain why.\n\nBoth consumers listen on the same queue. \nThe first consumer only closes its session *after* the second consumer tried to receive the message that the second producer sent to the queue. So the first consumer is still active when the second consumer calls f_consumer.receive(5000);\n\nSo what happens at runtime is that even though both consumers use a pull mode (by calling consumer.receive(5000); ) there is a default prefetch size (as this is not set explicitly) that is used for each consumer. \nThe first consumer acked the first message so it is available to receive more messages (even though it does not actively call f_consumer.receive()). So when the second message appears on the queue, the broker sends it right to the *first consumer* where it stays in the prefetch queue until it either gets received by the consumer calling f_consumer.receive() or the session gets closed. If in the testcase you call \n{code:java}\nconsumerTest.receiveMessage(dinges);\n{code}\n\nrather than \n{code:java}\nconsumerTestNew.receiveMessage(dinges);\n{code}\nthe message is received fine. \n\nSo there are two ways to work around this:\n\n1. have the first consumer close its session before the second consumer receives the message:\n{code:title=ConsumerProblemTest.java}\n...\nconsumerTest.close();\n\n//create second consumer and read msg\nDurableConsumer consumerTestNew = new DurableConsumer();\nconsumerTestNew.init();\nconsumerTestNew.receiveMessage(dinges);\nconsumerTestNew.close();\n{code}\n\n\n2. use a prefetch limit of 0 so messages to not get prefetched to consumers:\n{code:title=DurableConsumer.java}\nenv.put(InitialContext.PROVIDER_URL, \"tcp://localhost:61616?jms.prefetchPolicy.queuePrefetch=0\");\n{code}\n\nWith any of the two changes the testcase succeeds. Give it a go. Simply run mvn test, it should fail out of the box. Then make these changes, the testcase will succeed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2009-03-18T18:07:48.936+0000","updated":"2009-03-18T18:14:12.562+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12941021","id":"12941021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sherriff","name":"sherriff","key":"sherriff","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Drolshammer","active":true,"timeZone":"Etc/UTC"},"body":"Could this be related to https://issues.apache.org/activemq/browse/AMQ-2169? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sherriff","name":"sherriff","key":"sherriff","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Drolshammer","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-19T15:20:39.628+0000","updated":"2009-03-19T15:20:39.628+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12941034","id":"12941034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"body":"I also took the second test case DispatchMultipleConsumersTest.java and wrapped it in a maven JUnit project (see AMQ-2009Testcase2.zip) to run it more quickly. I first tested against version 5.3 and did not reproduce any errors. The JUnit test succeeded many times (even under a higher load than initially implemented). When testing against version 5.1 I did reproduce the duplicate message problem AMQ-2020 but not this bug! \n\nSo that exhausts the two testcases we have so far. I have not been able to reproduce this issue.\nHas anyone else who commented on this bug tried version 5.3 yet? What are the results?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmielke","name":"tmielke","key":"tmielke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Torsten Mielke","active":true,"timeZone":"Europe/Berlin"},"created":"2009-03-20T14:27:09.664+0000","updated":"2009-03-20T14:27:09.664+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12941370","id":"12941370","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Looks fixed for 5.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-23T09:01:48.983+0000","updated":"2009-05-23T09:01:48.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12941447","id":"12941447","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"I see this in Trunk 771718. Our network of 4 brokers are running for almost 30 days, then we see a broker is not dispatching msgs. It has about 400mb data in its data directory. \n\nWe restart the application to talk to another broker, restart the problematic broker, it starts fine, bridged ok, sees the consumer on the other broker, but all the msgs stuck on this broker is not dispatched. They are stuck.\n\nI will try to gather more information when I get more idea. A simple unit test of the case is ok with less msgs. I suspect this happens when a lot of msgs are stuck on the queue, then it fails to dispatch even after restart. BTW, we have enough memory on the box for the broker to run and jconsole show it is using only a portion. There is no error in the log with debug turned on.\n\nDemandForwardingBridgeSupport's serviceLocalCommand is supposed to be called but not. Any possible threading issue? Regarding the demandforwarding bridge, do you know the name of the thread I shall look in jconsole. due to the complexity of our system, there are about 170 live threads in the jconsole for this broker. Maybe a thread is blocked. \n\nAny suggestion is welcome. I am looking into this issue until i find a fix. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-10T21:45:22.291+0000","updated":"2009-06-10T21:45:22.291+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12941459","id":"12941459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"I have a simple cause which can cause dispatch problem:\n\n1. setup a network of broker1, broker2, bridged by multicast discovery\n2. make a producer send 5 msg to queueA to broker2\n3. make a consumer to consume from broker1 queueA ( make it slow, so it only consumer 1 msg) but make sure all 5 msg from broker2 are forwared to broker1\n4. stop the consumer to broke1, restart it to consume from broker2 queueA\n5. the 4 msgs originally published to broker2 and forwarded to broker1 and has not yet been consumed will stuck on broker1 and will not forwarded to broker2 for the consumer to consume.\n\nYou can only clear out the 4 left over stuck msg by making consumer consume from broker1 in this case.\n\nThis is a very critical issue because you might restart your application many times and run into this.\n\nI will look into how the demandfowardbridge handles this case. if you know anything about this, please help. this is very urgent. thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-11T22:26:28.804+0000","updated":"2009-06-11T22:26:28.804+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12941575","id":"12941575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"pushing this out to 5.4.0 as more information and analysis is needed. The most recent comments may point to a different issue altogether.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-24T11:21:38.163+0000","updated":"2009-06-24T11:21:38.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12942071","id":"12942071","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"body":"I encountered the same question three times.\n\nA standalone AMQ(5.2.0) server and three durable subscribers(because the bug with message selector) without using selector.\n\nIt works fine usually(sending or receiving messages).\n\nA few days later, I use one of the subscribers to send a message successfully but the subscribers cannot receive any messages at all.\n\nRestart the subscriber, it does not work yet.\nRestart the AmqBroker, the subscribers receive the message.\n\nBut I donot know what's wrong?\nI'm really crazy!\nAny help ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2010-01-27T01:51:26.158+0000","updated":"2010-01-27T01:52:05.019+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12942033","id":"12942033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.newman","name":"john.newman","key":"john.newman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Newman","active":true,"timeZone":"Etc/UTC"},"body":"Is anyone using activemq in a very high volume situation and NOT running into this after a couple days?  It seems like there should be a great amount of 'outrage' over this one, as it is quite disruptive.   Wouldn't this be affecting just about everyone?  \n\nWe are using activemq 5.2 in production.  3 sites have lower volume and we don't really have any problems.  One site has high volume, and after 2 or 3 days at most, it will just fall asleep.  No errors, no out of memory or anything, logs remain totally healthy.  The messages continue to make it into the activemq DB without problems, it grows and grows, but yet messages just stop going from activemq to the subscriber.\n\nbecause this is happening so regularly, the root problem isn't even understood, a fix is a long way away, and we can't \"just restart\" the broker in production without going through a bunch of hoops, we've deemed it not fit for production and now have to figure out a different queuing solution.  =(","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.newman","name":"john.newman","key":"john.newman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Newman","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-31T16:03:26.754+0000","updated":"2010-03-31T16:03:26.754+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12942075","id":"12942075","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"body":"have you tried to set producerFlowControl to false ( the default is true and the broker just keep silent  usually happening for fast producers and slow consumers and message will be piling up and not doing dispatch at all)\n\n<policyEntry queue=\">\" producerFlowControl=\"false\">\n<dispatchPolicy>\n                           <roundRobinDispatchPolicy/>\n                       </dispatchPolicy>\n                   </policyEntry>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yinghe0101","name":"yinghe0101","key":"yinghe0101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ying","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-31T17:41:20.136+0000","updated":"2010-03-31T17:41:20.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12942365","id":"12942365","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"body":"Yes, I know about this and use the default value.But the producer is not fast as far as I know.\nThis case can reproduce when the borker's keepDurableSubsActive is set to be false.\nIt seems that the dispatching is blocked by FilePendingMessageCursor.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2010-04-01T00:47:35.222+0000","updated":"2010-04-01T00:47:35.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12942081","id":"12942081","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"With selectors, if the a matching message does not fit in the maxPageSize for a queue, it will not be consumed till the messages ahead of it are consumed. With lots of sparse selectors this could lead to a hang.\nMaking the maxPageSize larger than the default 200 will help with that. To make it 1000 for all queue destinations use:\n{code}\n        <destinationPolicy>\n            <policyMap>\n                <policyEntries>\n                    <policyEntry queue=\">\" maxPageSize=\"1000\"/>\n                </policyEntries>\n            </policyMap>\n        </destinationPolicy>\n{code}\nA more detailed explanation can be found http://trenaman.blogspot.com/2009/01/message-selectors-and-activemq.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-01T08:32:44.868+0000","updated":"2010-04-01T08:36:33.460+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12942087","id":"12942087","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"For users of 5.2.0, please try 5.3.1 - there have been lots of related issues resolved. https://issues.apache.org/activemq/secure/ReleaseNote.jspa?projectId=10520&styleName=Html&version=12183","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-01T08:45:00.191+0000","updated":"2010-04-01T08:45:00.191+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12941995","id":"12941995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"body":"Gary Tully.\nWith selectors,Why not try to add a temporary strategy that invokes to dispatch messages periodically if no better idea.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangyin","name":"wangyin","key":"wangyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10448","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10448","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10448","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10448"},"displayName":"SuoNayi","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2010-04-02T05:58:04.991+0000","updated":"2010-04-02T05:58:04.991+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12942611","id":"12942611","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pavel_moravec","name":"pavel_moravec","key":"pavel_moravec","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Moravec","active":true,"timeZone":"Etc/UTC"},"body":"Can somebody please comment whether upgrade to 5.3.1 helped in their case? As we are facing the same issue in general and prior deep investigation we plan to do the upgrade from 5.2 to 5.3.1. So a feedback whether (or in how many cases) the upgrade helps will be more than welcome.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pavel_moravec","name":"pavel_moravec","key":"pavel_moravec","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Moravec","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-12T10:13:09.157+0000","updated":"2010-05-12T10:13:09.157+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/12942649","id":"12942649","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=winstonwaite","name":"winstonwaite","key":"winstonwaite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rob","active":true,"timeZone":"Etc/UTC"},"body":"We did indeed have horrible problems where hundreds of thousands of messages would be pumping along all week... and maybe once or twice a week.. a particular queue/topic would lock up. The rest of the queues and topics would be okay... but the one would lock up. We went through about three months trying to work it from our side knowing that 5.1.0 had many suspicious issues. We however are in production and upgrading was forbidden. When we finally did upgrade... the problem which got us for months disappear and hasn't shown back up in say 6 months now. So in our case... 5.1.0 -> 5.3 was a life saver.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=winstonwaite","name":"winstonwaite","key":"winstonwaite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rob","active":true,"timeZone":"Etc/UTC"},"created":"2010-05-14T18:37:16.294+0000","updated":"2010-05-14T18:37:16.294+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/13004125","id":"13004125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nnprasad","name":"nnprasad","key":"nnprasad","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nageswara P Nakarikanti","active":true,"timeZone":"Etc/UTC"},"body":"\nA similar issue reported by me FYI :https://issues.apache.org/jira/browse/AMQ-1751","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nnprasad","name":"nnprasad","key":"nnprasad","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nageswara P Nakarikanti","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-08T18:34:34.815+0000","updated":"2011-03-08T18:34:34.815+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/13145307","id":"13145307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rolszewski","name":"rolszewski","key":"rolszewski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raphael Olszewski","active":true,"timeZone":"Etc/UTC"},"body":"We have similar Problems.\nWe connect with about 50 consumers to one queue. Few messages get stuck in the queue after a while. I can not see any issue in amq.log.\nThis messages stay in the queue until restart. Another workaround seems to be moving this messages to another queue and moving back - then this messages will be consumed immediatly.\nBut the workaround of moving out and in again to this queue lead to negativ \"Number Of Pending Messages\" - which seems to be another bug.\nAnd we have this problems since AMQ 5.1.0 until now with AMQ 5.5.1\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rolszewski","name":"rolszewski","key":"rolszewski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raphael Olszewski","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-07T09:47:00.151+0000","updated":"2011-11-16T12:01:57.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/13151165","id":"13151165","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"can you try and reproduce with additional logging, TRACE level logging for:\n\norg.apache.activemq.broker.TransportConnection\norg.apache.activemq.broker.region.cursors\norg.apache.activemq.broker.region.Queue\norg.apache.activemq.broker.region.PrefetchSubscription\n\n\nand also check the client logs for any warn level messages. \nThen if you can identify the message id of the stuck message so we can correlate with the additional logging we may be able to determine what is going on.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-16T12:46:47.589+0000","updated":"2011-11-16T12:46:47.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/13151302","id":"13151302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brecht","name":"brecht","key":"brecht","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brecht Yperman","active":true,"timeZone":"Etc/UTC"},"body":"I am out of the office and will have limited access to my email.\n\nI will be back on Nov/21/11.\n\nPlease contact Vincent Van der Linden (vincent.vanderlinden@invenso.com) for urgent matters\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brecht","name":"brecht","key":"brecht","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brecht Yperman","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-16T16:25:51.556+0000","updated":"2011-11-16T16:25:51.556+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/13151865","id":"13151865","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rolszewski","name":"rolszewski","key":"rolszewski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raphael Olszewski","active":true,"timeZone":"Etc/UTC"},"body":"I'll try, but it will be hard, because it is usually only occuring while working on many mesages. And TRACE-Level is generating really a huge amount of data.\nBut i'll try to catch one with this TRACE-Level-options you suggestet.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rolszewski","name":"rolszewski","key":"rolszewski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raphael Olszewski","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-17T06:42:32.277+0000","updated":"2011-11-17T06:43:31.439+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/13461549","id":"13461549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=still_a_n00b","name":"still_a_n00b","key":"still_a_n00b","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathyayani Prasad","active":true,"timeZone":"America/New_York"},"body":"Has this issue been resolved yet? I am using ActiveMQ v5.6 and still facing the same issue. Any inputs on this will be very helpful!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=still_a_n00b","name":"still_a_n00b","key":"still_a_n00b","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathyayani Prasad","active":true,"timeZone":"America/New_York"},"created":"2012-09-24T00:36:50.061+0000","updated":"2012-09-24T00:36:50.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/13461791","id":"13461791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"If you are seeing an issue then the best thing to do is attach a JUnit test case that can reproduce the issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-09-24T13:45:42.498+0000","updated":"2012-09-24T13:45:42.498+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/13967085","id":"13967085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eduardotsj","name":"eduardotsj","key":"eduardotsj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Teodoro","active":true,"timeZone":"America/Sao_Paulo"},"body":"Im facing the same problem with version 5.9.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eduardotsj","name":"eduardotsj","key":"eduardotsj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Teodoro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2014-04-11T20:50:57.692+0000","updated":"2014-04-11T20:50:57.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/14049668","id":"14049668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"body":"Me too with 5.9.0. I always see several messages(usually less than 5) stuck in the queue while there are active consumers. My consumers are implemented by MessageListener. This is not a problem only caused by multi-consumers/providers. I have seen this on a queue with only one provider and one consumer. For example, my latest case: the queue is enqueued with only 3 messages total and 2 are consumed but one seems left in the queue forever. Sometimes the message can be consumed by restarting the consumer but sometime it doesn't help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-07-02T06:43:43.583+0000","updated":"2014-07-02T06:43:43.583+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/14051268","id":"14051268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"body":"But if there are new messages enqueued, the old stuck message can be consumed. It seems there is a threshold that only it's reached activemq will dispatch the message.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruralhunter","name":"ruralhunter","key":"ruralhunter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rural Hunter","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-07-03T09:48:19.559+0000","updated":"2014-07-03T09:48:19.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483280/comment/14052000","id":"14052000","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eduardotsj","name":"eduardotsj","key":"eduardotsj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Teodoro","active":true,"timeZone":"America/Sao_Paulo"},"body":"I suspect that this problem is related to storage limit. If you set storeUsage limit to 5GB, you can easily reproduce this problem producing about 50000 items without consumer.\nWhen the consumer start, it don't receive any message.\n\n                <storeUsage>\n                    <storeUsage limit=\"5 gb\"/>\n                </storeUsage>\n                <tempUsage>\n                    <tempUsage limit=\"1 gb\"/>\n                </tempUsage>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eduardotsj","name":"eduardotsj","key":"eduardotsj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eduardo Teodoro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2014-07-03T23:31:28.484+0000","updated":"2014-07-03T23:31:28.484+0000"}],"maxResults":38,"total":38,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2009/votes","votes":20,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0alt3:"}}