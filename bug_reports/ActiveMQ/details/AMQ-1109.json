{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483397","self":"https://issues.apache.org/jira/rest/api/2/issue/12483397","key":"AMQ-1109","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315630","id":"12315630","description":"Issues that need to be reviewed - do we keep 'em or do we kick 'em? ","name":"NEEDS_REVIEW","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/9","id":"9","description":"Unresolved","name":"Unresolved"},"customfield_12312322":null,"customfield_12310220":"2007-03-07T15:30:12.534+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Sep 30 15:02:13 UTC 2011","customfield_12310420":"41538","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_6074233955_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_66511529437_*|*_4_*:*_1_*:*_77601875242","customfield_12312321":null,"resolutiondate":"2011-09-30T15:02:13.528+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1109/watchers","watchCount":3,"isWatching":false},"created":"2006-12-27T08:14:55.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":0,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315613","id":"12315613","description":"","name":"4.1.0","archived":false,"released":true,"releaseDate":"2006-11-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-09-30T15:02:13.630+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":0,"customfield_12310080":null,"description":"1. Create DB for ActiveMQ\n2. Start broker using jtds SQL 2005 driver. \n3. Exception: \n2006-12-27 11:08:48,796 [main           ] INFO  JDBCPersistenceAdapter         - Database driver recognized: [jtds_type_4_jdbc_driver_for_ms_sql_server_and_sybase]\n2006-12-27 11:08:48,983 [main           ] INFO  DefaultDatabaseLocker          - Attempting to acquire the exclusive lock to become the Master broker\n2006-12-27 11:08:48,983 [main           ] ERROR DefaultDatabaseLocker          - Failed to acquire lock: java.sql.SQLException: Line 1: FOR UPDATE clause allowed only for DECLARE CURSOR.\njava.sql.SQLException: Line 1: FOR UPDATE clause allowed only for DECLARE CURSOR.\n\tat net.sourceforge.jtds.jdbc.SQLDiagnostic.addDiagnostic(SQLDiagnostic.java:365)\n\tat net.sourceforge.jtds.jdbc.TdsCore.tdsErrorToken(TdsCore.java:2781)\n\tat net.sourceforge.jtds.jdbc.TdsCore.nextToken(TdsCore.java:2224)\n\tat net.sourceforge.jtds.jdbc.TdsCore.getMoreResults(TdsCore.java:628)\n\tat net.sourceforge.jtds.jdbc.JtdsStatement.processResults(JtdsStatement.java:525)\n\tat net.sourceforge.jtds.jdbc.JtdsStatement.executeSQL(JtdsStatement.java:487)\n\tat net.sourceforge.jtds.jdbc.JtdsPreparedStatement.execute(JtdsPreparedStatement.java:475)\n\tat org.apache.activemq.store.jdbc.DefaultDatabaseLocker.start(DefaultDatabaseLocker.java:59)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.start(JDBCPersistenceAdapter.java:175)\n\tat org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1251)\n\tat org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:1209)\n\tat org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:508)\n\tat org.apache.activemq.broker.BrokerService.start(BrokerService.java:394)\n\tat org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:47)\n\tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1062)\n\tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1029)\n\tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:420)\n\tat org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:245)\n\tat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:141)\n\tat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:242)\n\tat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:156)\n\tat org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:290)\n\tat org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:348)\n\tat org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:161)\n\tat org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:51)\n\tat org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:41)\n\tat org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:57)\n\tat org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:82)\n\tat org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:47)\n\tat org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:50)\n\tat org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:65)\n\tat org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:50)\n\tat org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:46)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.apache.activemq.console.Main.runTaskClass(Main.java:159)\n\tat org.apache.activemq.console.Main.main(Main.java:91)\n","customfield_10010":null,"timetracking":{"originalEstimate":"0h","remainingEstimate":"0h","originalEstimateSeconds":0,"remainingEstimateSeconds":0},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12460753","id":"12460753","filename":"ASF.LICENSE.NOT.GRANTED--activemq.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arboz","name":"arboz","key":"arboz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem","active":true,"timeZone":"Etc/UTC"},"created":"2006-12-27T08:14:55.000+0000","size":53403,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12460753/ASF.LICENSE.NOT.GRANTED--activemq.log"}],"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172472","customfield_12312823":null,"summary":"Start Broker SQL Exception","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arboz","name":"arboz","key":"arboz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12482667","key":"AMQ-1191","self":"https://issues.apache.org/jira/rest/api/2/issue/12482667","fields":{"summary":"JDBC based Master/Slave not supported for TransactSQL based databases (SQL Server and Sybase)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arboz","name":"arboz","key":"arboz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows 2000, SQL 2005","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483397/comment/12938897","id":"12938897","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"It looks like SQL Server does not support the exclusive locking syntax for JDBC Master/Slave.\n\nAs a workaround you can add the following property to your activemq.xml...\n\n<journaledJDBC useDatabaseLock=\"true\" ...>...\n\nI've just patched 4.2 so that it should work without this workaround; see AMQ-1191 for more details\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2007-03-07T15:30:12.534+0000","updated":"2007-03-07T15:30:12.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483397/comment/12939064","id":"12939064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aguther","name":"aguther","key":"aguther","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Guther","active":true,"timeZone":"Etc/UTC"},"body":"I had the described problem while using version 4.1.1.  Finally I found this issue.  Using the workaround as described above did not solve my problem.  \n\nBut after changing <journaledJDBC useDatabaseLock=\"true\" ...> to <journaledJDBC useDatabaseLock=\"false\" ...> I could get the JDBC Persistence to work.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aguther","name":"aguther","key":"aguther","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Guther","active":true,"timeZone":"Etc/UTC"},"created":"2007-09-27T22:56:57.976+0000","updated":"2007-09-27T22:56:57.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483397/comment/12941177","id":"12941177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hondong","name":"hondong","key":"hondong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hondong","active":true,"timeZone":"Etc/UTC"},"body":"Hello.\n\nI donÂ´t think, that this Issue is fixed because:\n\ndeactivating the lock Database option works for, but even the Slave will become online. \nIf both were Online using the same Database, you get Problems with the Messages produced on the slave or the master.\nYou will get an inconsitent state.\nThe Master did not recocognize Messages produced on the Slave and the other way arround.\n\nKind regards,\n\nNils Hondong\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hondong","name":"hondong","key":"hondong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hondong","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-15T10:57:38.376+0000","updated":"2009-04-15T10:57:38.376+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483397/comment/12941385","id":"12941385","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiskill","name":"hiskill","key":"hiskill","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"hiskill","active":true,"timeZone":"Etc/UTC"},"body":"I am using 5.3.0 deployed as EAR/RAR on JBoss. I don't have the setting useDatabaseLock=\"true\" in the broker-config.xml.\n \nWith MSSQL 2000 and MSSQL 2005 it works fine but with MSSQL 2008 I keep getting these messages, broker never starts up.\n\n2009-11-12 21:51:15,992 INFO  [STDOUT] 2009-11-12 21:51:15,992 [ActiveMQ Broker] INFO  DefaultDatabaseLocker          - Failed to acquire lock.  Sleeping for 1000 milli(s) before trying again...\n\nLooks like the ACTIVEMQ_MSGS table is not getting created where as ACTIVEMQ_ACKS & ACTIVEMQ_LOCK tables are created.\n\nEven with useDatabaseLock=\"true\", broker doesn't come up.  Any idea when this fix is expected?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiskill","name":"hiskill","key":"hiskill","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"hiskill","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-13T03:41:36.919+0000","updated":"2009-11-13T03:41:36.919+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483397/comment/12941625","id":"12941625","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiskill","name":"hiskill","key":"hiskill","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"hiskill","active":true,"timeZone":"Etc/UTC"},"body":"I tried creating ACTIVEMQ_MSGS manually as well.  So I don't know if there is any workaround for this problem.  Pleaese let us know.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiskill","name":"hiskill","key":"hiskill","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"hiskill","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-13T03:57:34.607+0000","updated":"2009-11-13T03:57:34.607+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483397/comment/12941786","id":"12941786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"HiSkill,\nso is your problem that the messages table create fails? if so, what is the error you get?\nIf not, is your problem with the locker implementation. If so, do you know what will work? the locker implementation can be overridden on an adapter basis by adding an implementation reference to the finder resource location. see: http://svn.apache.org/viewvc/activemq/tags/activemq-5.3.0/activemq-core/src/main/resources/META-INF/services/org/apache/activemq/store/jdbc/lock/microsoft_sql_server_2005_jdbc_driver?view=markup for the microsoft_sql_server_2005_jdbc_driver override from the default. \nYou can implement your own and have it picked up by adding the corresponding resource to the classpath.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-13T12:32:22.442+0000","updated":"2009-11-13T12:32:22.442+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483397/comment/12941761","id":"12941761","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiskill","name":"hiskill","key":"hiskill","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"hiskill","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for the quick reply Gary.\n\nAs I mentioned, I saw the problem only with MSSQL 2008.\n\nHere is our configuration:\n- we deployed activemq as RAR on JBoss\n- currently we have only one broker configured but at some point we will add more brokers\n- we didn't explicitly set \"useDatabaseLock\" property in the broker-config.xml\n\nCouple of problems\n1. when the broker starts for the first time ACTIVEMQ_ACKS & ACTIVEMQ_LOCK tables are created but ACTIVEMQ_MSGS is not created\n2.  getting \"Failed to acquire lock\" errors continusly\n\nSo I tried creating ACTIVEMQ_MSGS manually and restarted the broker, still get the \"Failed to acquire lock\" errors continusly\n\nOnly way to get this working is to set property useDatabaseLock=\"false\", this will work fine with one broker as for multiple brokers lock is needed.\n\nPlease let me know if there is a workaround for our problem.\n\n\nHere is the part of stacktrace:\n\nReason: java.io.IOException: Failed to get last broker message id: com.microsoft.sqlserver.jdbc.SQLServerException: Invalid object name 'ACTIVEMQ_MSGS'.\njava.io.IOException: Failed to get last broker message id: com.microsoft.sqlserver.jdbc.SQLServerException: Invalid object name 'ACTIVEMQ_MSGS'.\n\tat org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:33)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.getLastMessageBrokerSequenceId(JDBCPersistenceAdapter.java:170)\n\tat org.apache.activemq.store.journal.JournalPersistenceAdapter.getLastMessageBrokerSequenceId(JournalPersistenceAdapter.java:212)\n\tat org.apache.activemq.broker.region.DestinationFactoryImpl.getLastMessageBrokerSequenceId(DestinationFactoryImpl.java:140)\n\tat org.apache.activemq.broker.region.RegionBroker.<init>(RegionBroker.java:106)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.<init>(ManagedRegionBroker.java:94)\n\tat org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1695)\n\tat org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1689)\n\tat org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:1649)\n\tat org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:667)\n\tat org.apache.activemq.broker.BrokerService.getAdminConnectionContext(BrokerService.java:1866)\n\tat org.apache.activemq.broker.BrokerService.startDestinations(BrokerService.java:1853)\n\tat org.apache.activemq.broker.BrokerService.start(BrokerService.java:450)\n\tat org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:56)\n\tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1369)\n\tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335)\n\tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiskill","name":"hiskill","key":"hiskill","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"hiskill","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-13T15:57:59.875+0000","updated":"2009-11-13T15:57:59.875+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483397/comment/13118117","id":"13118117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"4.x broker series is EOL.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2011-09-30T15:02:13.595+0000","updated":"2011-09-30T15:02:13.595+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1109/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tvvb:"}}