{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12545492","self":"https://issues.apache.org/jira/rest/api/2/issue/12545492","key":"AMQ-3759","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2012-03-07T15:28:46.421+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 07 16:00:56 UTC 2012","customfield_12310420":"230678","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_81679971_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-03-08T11:41:47.747+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3759/watchers","watchCount":0,"isWatching":false},"created":"2012-03-07T13:00:27.839+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318548","id":"12318548","name":"5.4.3","archived":false,"released":true,"releaseDate":"2011-10-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12318549","id":"12318549","name":"5.5.1","archived":false,"released":true,"releaseDate":"2011-10-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-03-08T11:41:47.788+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313896","id":"12313896","name":"JMS client"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When ActiveMQConnectionFactory is used to create connection to broker using SSL the thread becomes blocked (waiting infinite on SocketInputStream#socketRead0).\n\nStacktrace:\n\"ActiveMQ Transport: ssl://localhost/127.0.0.1:9099\" prio=6 tid=0x0000000006105000 nid=0x463c waiting for monitor entry [0x0000000008a2f000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(Unknown Source)\n\t- waiting to lock <0x000000078219d8f8> (a java.lang.Object)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.readDataRecord(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.AppInputStream.read(Unknown Source)\n\t- locked <0x000000078219d9d0> (a com.sun.net.ssl.internal.ssl.AppInputStream)\n\tat org.apache.activemq.transport.tcp.TcpBufferedInputStream.fill(TcpBufferedInputStream.java:50)\n\tat org.apache.activemq.transport.tcp.TcpTransport$2.fill(TcpTransport.java:576)\n\tat org.apache.activemq.transport.tcp.TcpBufferedInputStream.read(TcpBufferedInputStream.java:58)\n\tat org.apache.activemq.transport.tcp.TcpTransport$2.read(TcpTransport.java:561)\n\tat java.io.DataInputStream.readInt(Unknown Source)\n\tat org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:269)\n\tat org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:227)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:219)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:202)\n\tat java.lang.Thread.run(Unknown Source)\n\n\"Thread-4\" prio=6 tid=0x0000000006103800 nid=0x2bb8 runnable [0x000000000872e000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.SocketInputStream.socketRead0(Native Method)\n\tat java.net.SocketInputStream.read(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.InputRecord.readFully(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.InputRecord.read(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord(Unknown Source)\n\t- locked <0x00000007821b14c8> (a java.lang.Object)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(Unknown Source)\n\t- locked <0x000000078219d8f8> (a java.lang.Object)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.writeRecord(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.AppOutputStream.write(Unknown Source)\n\t- locked <0x00000007821a2a60> (a com.sun.net.ssl.internal.ssl.AppOutputStream)\n\tat org.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedOutputStream.java:115)\n\tat java.io.DataOutputStream.flush(Unknown Source)\n\tat org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:182)\n\tat org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:254)\n\t- locked <0x00000007821a2898> (a java.util.concurrent.atomic.AtomicBoolean)\n\tat org.apache.activemq.transport.WireFormatNegotiator.sendWireFormat(WireFormatNegotiator.java:168)\n\tat org.apache.activemq.transport.WireFormatNegotiator.sendWireFormat(WireFormatNegotiator.java:84)\n\tat org.apache.activemq.transport.WireFormatNegotiator.start(WireFormatNegotiator.java:74)\n\tat org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\n\tat org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)\n\tat org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:266)\n\tat org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:230)\n\tat org.apache.activemq.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:178)\n\tat org.apache.activemq.broker.test.SslDeadlockTest.sendMsg(SslDeadlockTest.java:53)\n\tat org.apache.activemq.broker.test.SslDeadlockTest.testFail(SslDeadlockTest.java:41)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n\tat org.junit.internal.runners.statements.FailOnTimeout$1.run(FailOnTimeout.java:28)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12517396","id":"12517396","filename":"ConnectionFactoryTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-07T13:02:17.345+0000","size":2235,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12517396/ConnectionFactoryTest.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12517412","id":"12517412","filename":"ConnectionFactoryWithSslContextTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-07T15:54:49.467+0000","size":4192,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12517412/ConnectionFactoryWithSslContextTest.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172378","customfield_12312823":null,"summary":"ActiveMQConnectionFactory blocks in case of ssl","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12545492/comment/13224265","id":"13224265","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"body":"Junit for https://issues.apache.org/jira/browse/AMQ-3759","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-07T13:02:17.476+0000","updated":"2012-03-07T13:02:17.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12545492/comment/13224423","id":"13224423","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"You haven't configured the BrokerService with KeyStore or TrustStore etc, so it cannot accept incoming SSL connections. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-03-07T15:28:46.421+0000","updated":"2012-03-07T15:28:46.421+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12545492/comment/13224445","id":"13224445","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"body":"It's not obligatory, I have configured it (ConnectionFactoryWithSslContextTest) and the results were the same, so I've removed it not to fog the real issue.\n\nSo results are:\nActiveMQSSLConnectionFactory works, ActiveMQConnectionFactory hangs and blocks the thread.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=s1ngle","name":"s1ngle","key":"s1ngle","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Krzysztof Olszewski","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-07T15:54:49.826+0000","updated":"2012-03-07T15:54:49.826+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12545492/comment/13224451","id":"13224451","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"The current test fails because the ActiveMQConnectionFactory is waiting for a response on its socket but the broker is in an loop on onAccept receiving SSLExceptions because the broker has no SSL configuration.  The reason the method using ActiveMQSSLConnectionFactory fails is because it can locally detect that its not configured and fail fast.  If you configured a timeout on the ssl transport so that the socket connect call failed after a delay it would then work similar to the other test case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2012-03-07T16:00:56.497+0000","updated":"2012-03-07T16:00:56.497+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-3759/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tvaf:"}}