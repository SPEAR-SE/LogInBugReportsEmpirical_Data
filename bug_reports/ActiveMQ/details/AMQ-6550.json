{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13030617","self":"https://issues.apache.org/jira/rest/api/2/issue/13030617","key":"AMQ-6550","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-12-26T21:29:27.518+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Dec 30 14:16:36 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6550/watchers","watchCount":2,"isWatching":false},"created":"2016-12-26T20:09:09.683+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334774","id":"12334774","name":"5.13.2","archived":false,"released":true,"releaseDate":"2016-03-04"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-12-30T14:16:36.465+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have a two machine setup with an ActiveMQ broker on each. Applications on both machines use the local broker to send status messages to each other. We were doing some testing to see the impact of network disconnect and reconnect on one machine, so we did network unplug and re-plug cycles on one machine (machine A) again and again with some delay (around 5 minutes delay). The brokers reconnected fine and applications were able to exchange status message on all but one such cycle. In the problem cycle machine A was unable to receive messages after network re-connect. On some investigation, we can see following exception in the machine B ActiveMQ logs.\n\n{code:xml}\n2016-12-22 08:43:14,524 | DEBUG | Error occured while processing sync command: ConsumerInfo {commandId = 4, responseRequired = true, consumerId = CCM-UACSCHP002->CCM-UACSCHP001-64290-1482319725974-53:1:1:2, destination = topic://EEP, prefetchSize = 100, maximumPendingMessageLimit = 0, browser = false, dispatchAsync = true, selector = null, clientId = null, subscriptionName = NC-DS_CCM-UACSCHP002_EEP, noLocal = false, exclusive = false, retroactive = false, priority = 0, brokerPath = [ID:ccm-uacschp001-49159-1482188226837-0:1], optimizedAcknowledge = false, noRangeAcks = false, additionalPredicate = org.apache.activemq.command.NetworkBridgeFilter@e714024}, exception: java.lang.NullPointerException | org.apache.activemq.broker.TransportConnection.Service | triggerStartAsyncNetworkBridgeCreation: remoteBroker=tcp://CCM-UACSCHP001/10.49.224.23:61616@65477, localBroker= vm://CCM-UACSCHP002#172\n    java.lang.NullPointerException\n    \tat org.apache.activemq.broker.TransportConnector.isAllowLinkStealing(TransportConnector.java:582)\n    \tat org.apache.activemq.broker.ConnectionContext.isAllowLinkStealing(ConnectionContext.java:337)\n    \tat org.apache.activemq.broker.region.TopicRegion.addConsumer(TopicRegion.java:128)\n    \tat org.apache.activemq.broker.region.RegionBroker.addConsumer(RegionBroker.java:427)\n    \tat org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:103)\n    \tat org.apache.activemq.advisory.AdvisoryBroker.addConsumer(AdvisoryBroker.java:128)\n    \tat org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:103)\n    \tat org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:103)\n    \tat org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:103)\n    \tat org.apache.activemq.broker.MutableBrokerFilter.addConsumer(MutableBrokerFilter.java:108)\n    \tat org.apache.activemq.broker.util.LoggingBrokerPlugin.addConsumer(LoggingBrokerPlugin.java:186)\n    \tat org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:103)\n    \tat org.apache.activemq.broker.MutableBrokerFilter.addConsumer(MutableBrokerFilter.java:108)\n    \tat org.apache.activemq.broker.TransportConnection.processAddConsumer(TransportConnection.java:671)\n    \tat org.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:351)\n    \tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:338)\n    \tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)\n    \tat org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n    \tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n    \tat org.apache.activemq.transport.vm.VMTransport.doDispatch(VMTransport.java:162)\n    \tat org.apache.activemq.transport.vm.VMTransport.dispatch(VMTransport.java:154)\n    \tat org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:131)\n    \tat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)\n    \tat org.apache.activemq.transport.ResponseCorrelator.asyncRequest(ResponseCorrelator.java:81)\n    \tat org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:86)\n    \tat org.apache.activemq.network.DemandForwardingBridgeSupport.addSubscription(DemandForwardingBridgeSupport.java:920)\n    \tat org.apache.activemq.network.DurableConduitBridge.setupStaticDestinations(DurableConduitBridge.java:79)\n    \tat org.apache.activemq.network.DemandForwardingBridgeSupport.doStartLocalAndRemoteBridges(DemandForwardingBridgeSupport.java:436)\n    \tat org.apache.activemq.network.DemandForwardingBridgeSupport.access$500(DemandForwardingBridgeSupport.java:105)\n    \tat org.apache.activemq.network.DemandForwardingBridgeSupport$5.run(DemandForwardingBridgeSupport.java:336)\n    \tat java.lang.Thread.run(Unknown Source)\n{code}\n\nThis exception appears in machine B ActiveMQ logs shortly after the network of machine A is re-connected.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12844699","id":"12844699","filename":"activemq_pub.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"created":"2016-12-26T20:11:39.312+0000","size":6342,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12844699/activemq_pub.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12844700","id":"12844700","filename":"activemq_sub.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"created":"2016-12-26T20:11:39.360+0000","size":6632,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12844700/activemq_sub.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Error occured while processing sync command","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13030617/comment/15778906","id":"15778906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"body":"Attached the configuration of two brokers ([^activemq_pub.xml] & [^activemq_sub.xml]). This will help in understanding the topology I am using.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"created":"2016-12-26T20:11:39.365+0000","updated":"2016-12-26T20:14:39.843+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13030617/comment/15779011","id":"15779011","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Please try using the latest release 5.14.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-12-26T21:29:27.518+0000","updated":"2016-12-26T21:29:27.518+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13030617/comment/15779373","id":"15779373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"body":"Thanks [~tabish121]. I want to confirm whether it is a known issue that has been addressed in latest version? We upgraded the customer to 5.13.2 to resolve some other issues. So before we ask them to upgrade again I would like to know if this is a known problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"created":"2016-12-27T01:56:09.282+0000","updated":"2016-12-27T01:56:09.282+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13030617/comment/15787097","id":"15787097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"body":"[~tabish121]: Out of curiosity, I cloned the ActiveMQ source from git repository at https://git-wip-us.apache.org/repos/asf/activemq.git and searched for the method *isAllowLinkStealing* in the source. I get following code for the method in the *org.apache.activemq.broker.TransportConnector* class (i.e. where I am getting the exception).\n\n{code:xml}\n    @Override\n    public boolean isAllowLinkStealing() {\n        return server.isAllowLinkStealing();\n    }\n{code}\n\nBecause there is a NullPointerException, this means that the server object is Null. Adding a Null check in the method can avoid the NullPointerException but I don't know if this is going to solve the actual issue.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nauman73","name":"nauman73","key":"nauman73","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nauman Hameed","active":true,"timeZone":"Asia/Karachi"},"created":"2016-12-30T07:17:04.659+0000","updated":"2016-12-30T07:17:04.659+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13030617/comment/15787749","id":"15787749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Recommend you create a unit test to reproduce the issue and test on newer broker releases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2016-12-30T14:16:36.465+0000","updated":"2016-12-30T14:16:36.465+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6550/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i380vr:"}}