{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482818","self":"https://issues.apache.org/jira/rest/api/2/issue/12482818","key":"AMQ-2475","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315621","id":"12315621","description":"","name":"5.3.1","archived":false,"released":true,"releaseDate":"2010-03-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315623","id":"12315623","description":"version 5 feature complete","name":"5.4.0","archived":false,"released":true,"releaseDate":"2010-08-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-11-07T15:11:13.932+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Jul 11 17:53:17 UTC 2010","customfield_12310420":"74928","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1230358364_*|*_5_*:*_3_*:*_18408211205_*|*_4_*:*_2_*:*_1989661545","customfield_12312321":null,"resolutiondate":"2010-07-11T17:53:17.732+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2475/watchers","watchCount":2,"isWatching":false},"created":"2009-11-03T10:02:46.618+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-07-11T17:53:17.718+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313895","id":"12313895","name":"Message Store"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I will attach a simple project that shows this. In the test the tmp space is set to 32 MB and two threads are created. One thread will constantly produce 1KB messages and the other consumes these, but sleeps for 100ms, note that producer flow control is turned off as well. The goal here is to ensure that the producers block while the consumers read the rest of the messages from the broker and catch up, this in turn frees up the disk space and allows the producer to send more messages. This config means that you can bound the broker based on disk space rather than memory usage.\n\nUnfortunately in this test using topics while the broker is reading in the message from the producer it has to lock the matched list it is adding it to. This is an abstract from the Topic's point of view and doesn't realize that the file may block based on the file system. \n{code}\n    public void add(MessageReference node) throws Exception { //... snip ...\n            if (maximumPendingMessages != 0) {\n                synchronized (matchedListMutex) {   // We have this mutex\n                    matched.addMessageLast(node); // ends up waiting for space\n                    // NOTE - be careful about the slaveBroker!\n                    if (maximumPendingMessages > 0) {\n{code}\nMeanwhile the consumer is sending acknowledgements for the 10 messages it just read in (the configured prefetch) from the same topic, but since they also modify the same list in the topic this waits as well on the mutex held to service the producer:\n{code}\n    private void dispatchMatched() throws IOException {       \n        synchronized (matchedListMutex) {  // never gets passed here.\n            if (!matched.isEmpty() && !isFull()) {\n{code}\nThis is a fairly classic deadlock. The trick is now how to resolve this given the fact that the topic isn't aware that it's list may need to wait for the file system to clean up.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461377","id":"12461377","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-07T15:19:18.816+0000","size":4614,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12461377/activemq.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461475","id":"12461475","filename":"hangtest.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=martinmurphy","name":"martinmurphy","key":"martinmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Murphy","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-03T20:41:00.954+0000","size":8049,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12461475/hangtest.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461480","id":"12461480","filename":"Queue.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-08T20:04:37.626+0000","size":67348,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461480/Queue.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461477","id":"12461477","filename":"Queue.patchfile.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-08T20:01:34.959+0000","size":2982,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461477/Queue.patchfile.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461479","id":"12461479","filename":"Topic.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-08T20:04:37.593+0000","size":26724,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461479/Topic.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461476","id":"12461476","filename":"Topic.patchfile.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-08T20:01:35.044+0000","size":1267,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461476/Topic.patchfile.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461482","id":"12461482","filename":"TopicSubscription.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-08T20:04:37.630+0000","size":20597,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461482/TopicSubscription.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461478","id":"12461478","filename":"TopicSubscription.patchfile.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-08T20:01:35.047+0000","size":1970,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461478/TopicSubscription.patchfile.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"159877","customfield_12312823":null,"summary":"If tmp message store fills up, broker can deadlock due to while producers wait on disk space and consumers wait on acks","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=martinmurphy","name":"martinmurphy","key":"martinmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Murphy","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=martinmurphy","name":"martinmurphy","key":"martinmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Murphy","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Tested on Windows XP with JDK 1.60_13, but fairly sure it will be an issue on all platforms","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12940910","id":"12940910","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=martinmurphy","name":"martinmurphy","key":"martinmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Murphy","active":true,"timeZone":"Etc/UTC"},"body":"Oops, didn't realize that the test never attached properly last time","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=martinmurphy","name":"martinmurphy","key":"martinmurphy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Murphy","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-03T20:41:01.029+0000","updated":"2009-11-03T20:41:01.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941383","id":"12941383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"body":"I had an investigate into attempted to patch this locally in activemq-core, on a fusesource 5.3.0.4 (MacOSX 10.6.1).\n\nI've run the following tests on the patch, will I'll attach: (the patch diffs, the patched .java and the broker xml I used in testing):\n\nThe test cases I've run overnight and this morning/afternoon are:\n\n- Virtual Topic (  VirtualTopic.iplayer  -> Consumer.A.VirtualTopic.iplayer)\n- 3 x Producer, 4,000,000 messages each onto Virtual Topic (12million in total)\n- 1 x Consumer\n- 100mb tmp_store limit\n\n- Virtual Topic (  VirtualTopic.iplayer  -> Consumer.A.VirtualTopic.iplayer)\n- 6 x Producer, 2,000,000 messages each onto Virtual Topic (12million in total)\n- 1 x Consumer\n- 512mb tmp_store limit\n\nThe tmp_storage was definitely limiting ok, and niether the broker, producer or consumer blocked:\n\ndu -sh of the tmp_storage area:\n{code}\ndominic-tootells-macbook-pro:data dominict$ du -sh *\n 96M\tjournal\n 48K\tkr-store\n  0B\tlock\n512M\ttmp-test-broker\n\ndominic-tootells-macbook-pro:data dominict$ du -sh *\n 96M\tjournal\n 48K\tkr-store\n  0B\tlock\n483M\ttmp-test-broker\n\ndominic-tootells-macbook-pro:data dominict$ du -sh *\n 96M\tjournal\n 48K\tkr-store\n  0B\tlock\n490M\ttmp-test-broker\n\ndominic-tootells-macbook-pro:data dominict$ du -sh *\n 64M\tjournal\n 48K\tkr-store\n  0B\tlock\n 38M\ttmp-test-broker\n\ndominic-tootells-macbook-pro:data dominict$ \n\n{code}\n\n\nI've also run the junit provided by Martin; this ran ok too; with no blockage.\n\nI shall attach the potential patches.  I haven't run any other tests against the patches; to see if they potentially cause any other unforeseen issues (i.e. normal persistent queue - will do this later on)\n\ncheers\n/dom\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-07T15:11:13.932+0000","updated":"2009-11-07T15:11:13.932+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941382","id":"12941382","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"body":"all in package org.apache.activemq.broker.region\n\n\nTopicSubscription.patchfile.txt      (Changes to TopicSubscription.java)\nTopic.patchfile.txt                          (Changes to Topic.java)\nQueue.patchfile.txt                       (Changes to Queue.java)\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-07T15:15:11.006+0000","updated":"2009-11-07T15:15:11.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941381","id":"12941381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"body":"The patched java files:\n\nQueue.java\nTopic.java\nTopicSubscription.java\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-07T15:17:15.731+0000","updated":"2009-11-07T15:17:15.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941388","id":"12941388","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"body":"activemq.xml test broker configuration I was using to test the scenario","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-07T15:19:18.855+0000","updated":"2009-11-07T15:19:18.855+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941479","id":"12941479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"body":"I've ran some more tests on the patch I uploaded yesterday, and come across a small issue with  sendFailIfNoSpace=\"true\".  The ResourceAllocationException would only be thrown if the producer noticed the out of space condition before the message was added to the cursor.  However, there was a slight chance space would be available when producer 1 checked, but this space was then eaten by producer 2.  Producer 1 would then be within the waiting for space loop; and not send a ResourceAllocationException.  \n\nI have added checks within the waiting for space loop, to check if a ResourceAllocationException should be thrown if sendFailIfNoSpace=\"true\".   \n\nI shall update the patches attached yesterday, to reflect this.\n\napologies,\n/dom\n\nI'm also currently running the test against a normal persistent queue; to make sure all is ok with that; I'll comment back once the run has finished.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-08T20:00:29.094+0000","updated":"2009-11-08T20:00:29.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941529","id":"12941529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"body":"Test for a normal persistent queue ran ok:\n\n- 1 consumer\n- 5 * producer\n- 10,000,000 * 1k messages\n\nhope this helps,\n/dom","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-09T09:03:11.086+0000","updated":"2009-11-09T09:03:11.086+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941784","id":"12941784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"I applied the patch to trunk - but got some JUnit test failures -  org.apache.activemq.broker.BrokerTest is the main one (a few JUnit tests are derived from this one).\nGoing to try resolve the dead lock differently.\nI'm not clear if you are experiencing the same problem with Queues ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-13T19:46:19.456+0000","updated":"2009-11-13T19:50:26.634+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941603","id":"12941603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"body":"I wasn't experiencing the same issue with queue's, just topics (non persistent when they overflowed to tmp_storage)\n\nWhat test was failing in the org.apache.activemq.broker.BrokerTest? out of interest.\n/dom","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-17T11:54:51.262+0000","updated":"2009-11-17T11:54:51.262+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941623","id":"12941623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"the failing tests were org.apache.activemq.broker.BrokerTest (a few are derived from this - so causes multiple failures) and org.apache.activemq.bugs.AMQ2314Test","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-17T12:00:12.271+0000","updated":"2009-11-17T12:00:12.271+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941819","id":"12941819","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for the info Rob,\n\nI'll give it a run through here, and see what I come up with here.\n\nI was running on a fusesource 5.3.0.4 broker.  I've recently updated this to the fusesource 5.3.0.5 broker which included that AMQ2314Test (http://fusesource.com/wiki/display/ProdInfo/FUSE+Message+Broker+v5.3+Release+Notes).  I'll run a test suite on a base source distro and a 5.3.0.5 with above patches and see what I get out of it.\n\nIf I get chance I'll grab a trunk and test on that too (most likely an evening this week I'm guessing though) and see if I spot anything.  \n\nThanks for commenting back.\n/dom","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dominict","name":"dominict","key":"dominict","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dominic Tootell","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-17T13:36:28.615+0000","updated":"2009-11-17T13:36:28.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12941827","id":"12941827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"dead lock fixed by svn revision 881313 and 881340","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-17T15:48:44.928+0000","updated":"2009-11-17T15:48:44.928+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12942050","id":"12942050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"also on 5.3.1 branch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-20T18:20:29.459+0000","updated":"2010-01-20T18:20:29.459+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12942591","id":"12942591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcooper","name":"mcooper","key":"mcooper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Cooper","active":true,"timeZone":"Etc/UTC"},"body":"I am still able to consistently see this deadlock behavior on our system with both version 5.3.0 and 5.3.2.  The patch loops in the TopicSubscription add method while holding the matchedListMutex until thePendingMessageCursor \"matched\" is not full.  The code then attempts to call addMessageLast on the \"matched\" instance assuming that the matchedListMutex will prevent any additional threads from taking that space.  This assumption is wrong, because I have found that when using a filePendingMessageCursor, the addMessageLast method will end up calling systemUsage.getTempUsage().waitForSpace() which for whatever reason can be full when it is called and without the ability to reduce in size due to monitors already held earlier in the stack.  Therefore, the code loops infinitely and the system is deadlocked.\n\nTo workaround this issue, I switched to using vm cursors, which don't rely on this shared pool of temp file storage, and haven't seen the deadlock.\n\nI am new to this project and still trying to understand the code completely, but this is what I have found.  I think the looping that is happening to wait for space is happening to early in the stack.  The matchedListMutex does not seem to lock out other threads that use temp storage.  I'm not sure what the correct fix is, but without a significant reworking of the code, the best I can think to do would be to have the addMessageLast method throw some kind of exception or have a return value if space is not available, so the calling method can again release its the matchedListMutext by calling wait, and try again.  And addMessageLast wold also not call waitForSpace with an infinite timeout, but instead specify a small timeout.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcooper","name":"mcooper","key":"mcooper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Cooper","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-17T06:10:34.543+0000","updated":"2010-06-17T06:10:34.543+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12942596","id":"12942596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Hi Michael  - thx for the analysis - is this something you can reproduce on your system easily ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-17T07:46:18.359+0000","updated":"2010-06-17T07:46:18.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12942561","id":"12942561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Fixed by SVN revision 955504","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-17T08:25:42.750+0000","updated":"2010-06-17T08:25:42.750+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12942582","id":"12942582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcooper","name":"mcooper","key":"mcooper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Cooper","active":true,"timeZone":"Etc/UTC"},"body":"Rob, wow, quick response!  I reviewed the change carefully, and it looks good for the most part.  A couple potential issues though:\n\nIn FilePendingMessageCursor:\n\n- Why did you add a \"throws Exception\" clause to original and try versions of the method?  Doesn't seem to be used.\n- The end of the tryAddMessageLast method returns false.  I think this should probably be true instead, because if the caller passes an expired message, it will now loop forever retrying to add it.\n\nIn TopicSubscription:\n\nWhile the fix you made is probably the safest fix, I think the ideal fix would not have to even make a check for  matched.isFull() since the tryAddMessageLast method should return false if it is full and cannot add the message.  However, this requires implementing tryAddMessageLast in all implementations of PendingMessageCursor.\n\nAlso, the fix version of the bug may need to be updated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcooper","name":"mcooper","key":"mcooper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Cooper","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-17T16:25:00.841+0000","updated":"2010-06-17T16:25:00.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12942566","id":"12942566","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcooper","name":"mcooper","key":"mcooper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Cooper","active":true,"timeZone":"Etc/UTC"},"body":"Just reopening the issue to make sure the last code review doesn't get missed.  Ignore what I said about the \"throws Exception\" part, as I realize it was part of another change.  My biggest concern is over the \"return false\" which could introduce an infinite loop for expired messages.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mcooper","name":"mcooper","key":"mcooper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Cooper","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-18T19:27:24.371+0000","updated":"2010-06-18T19:27:24.371+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482818/comment/12942484","id":"12942484","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Michael  - resolved by SVN revision 963118","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-11T17:53:17.706+0000","updated":"2010-07-11T17:53:17.706+0000"}],"maxResults":19,"total":19,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2475/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0rq4n:"}}