{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482770","self":"https://issues.apache.org/jira/rest/api/2/issue/12482770","key":"AMQ-2048","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315619","id":"12315619","description":"","name":"5.2.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jan 05 23:53:49 UTC 2009","customfield_12310420":"95983","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_602459300_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-01-05T23:53:49.940+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2048/watchers","watchCount":1,"isWatching":false},"created":"2008-12-30T00:32:50.640+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315618","id":"12315618","description":"","name":"5.1.0","archived":false,"released":true,"releaseDate":"2008-05-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-01-05T23:53:49.881+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Virtual Topic: VirtualTopic.AckTest\nPhysical Queue of Virtual Topic: Consumer.TestQueueAcknowledgement.VirtualTopic.AckTest\n\nConsumer is connected to Openwire TCP connector and I am posting messages directly to the virtual topic.\n\nEven if message.acknowledge() is called, messages are read but not removed from queue.  \"Messages Received\" count remains at zero.  Is this the expected behavior while using Virtual Topics?\n\nTest Consumer:\n\nimport java.util.Properties;\n\nimport javax.jms.Message;\nimport javax.jms.MessageListener;\nimport javax.jms.QueueConnection;\nimport javax.jms.QueueSession;\nimport javax.jms.TextMessage;\nimport javax.naming.InitialContext;\n\n\npublic class TestQueueAcknowledgement {\n\n\tprivate QueueConnection conn;\n\tprivate QueueSession session;\n\t\n\tpublic void listen() {\n\t\ttry {\n\t\t\tProperties props = new Properties();\n\t\t\tprops.put(\"java.naming.factory.initial\", \n\t\t\t\t\t\"org.apache.activemq.jndi.ActiveMQInitialContextFactory\");\n\t\t\tprops.put(\"java.naming.provider.url\", \n\t\t\t\t\t\"tcp://localhost:61616\");\n\t\t\tprops.put(\"queue.queueName\", \n\t\t\t\t\t\"Consumer.TestQueueAcknowledgement.VirtualTopic.AckTest\");\n\t\t\t\n\t\t\tjavax.naming.Context ctx = new InitialContext(props);\n\t\t\tjavax.jms.QueueConnectionFactory factory \n\t\t\t\t= (javax.jms.QueueConnectionFactory) \n\t\t\t\tctx.lookup(\"ConnectionFactory\");\n\t\t\tconn = factory.createQueueConnection();\n\t\t\tfinal javax.jms.Queue queue \n\t\t\t\t= (javax.jms.Queue) ctx.lookup(\"queueName\");\n\t\t\tsession = conn.createQueueSession(false, \n\t\t\t\t\tQueueSession.AUTO_ACKNOWLEDGE);\n\t\t\tjavax.jms.QueueReceiver receiver = session.createReceiver(queue);\n\t\t\t\n\t\t\treceiver.setMessageListener(new MessageListener() {\n\t\t\t\tpublic void onMessage(Message message) {\n\t\t\t\t\ttry {\n\t\t\t            if (message instanceof TextMessage) {\n\t\t\t                TextMessage txtMsg = (TextMessage) message;\n\t\t                    String msg = txtMsg.getText();\n\t\t                    System.out.println(msg);\n\t\t\t            }\n\t\t\t\t\t\tmessage.acknowledge();\n\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tconn.start();\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n\n\tprotected void finalize() throws Throwable {\n\t\tif (session != null) {\n\t\t\tsession.close();\n\t\t}\n\t}\n\t\n\tpublic static void main(String[] args) {\n\t\tTestQueueAcknowledgement ack = new TestQueueAcknowledgement();\n\t\tack.listen();\n\t}\n}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12461206","id":"12461206","filename":"TestQueueAcknowledgement.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jagathvijayan","name":"jagathvijayan","key":"jagathvijayan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jagath Vijayan Janakiraman","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-30T00:38:12.675+0000","size":1962,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12461206/TestQueueAcknowledgement.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172424","customfield_12312823":null,"summary":"Messages are read from physical queue of virtual topic but not removed.  \"Messages Received\" count remains zero.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jagathvijayan","name":"jagathvijayan","key":"jagathvijayan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jagath Vijayan Janakiraman","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jagathvijayan","name":"jagathvijayan","key":"jagathvijayan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jagath Vijayan Janakiraman","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Microsoft Windows Server 2003 - Standard x64 Edition - Service Pack 2\nIntel Xeon 1.60 GHz, 8 GB RAM\nActiveMQ 5.1.0 JMS Message Broker","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482770/comment/12940613","id":"12940613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jagathvijayan","name":"jagathvijayan","key":"jagathvijayan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jagath Vijayan Janakiraman","active":true,"timeZone":"America/Los_Angeles"},"body":"Sample Test Consumer","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jagathvijayan","name":"jagathvijayan","key":"jagathvijayan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jagath Vijayan Janakiraman","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-30T00:38:12.705+0000","updated":"2008-12-30T00:38:12.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482770/comment/12940635","id":"12940635","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jagathvijayan","name":"jagathvijayan","key":"jagathvijayan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jagath Vijayan Janakiraman","active":true,"timeZone":"America/Los_Angeles"},"body":"Using the following construct (available from ActiveMQ 5.2.0) to individually acknowledge the messages consumed from the queue has resolved the issue:\n\ncreateQueueSession(false, ActiveMQSession.INDIVIDUAL_ACKNOWLEDGE)\n\nReference:\nhttp://issues.apache.org/activemq/browse/AMQ-1732","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jagathvijayan","name":"jagathvijayan","key":"jagathvijayan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jagath Vijayan Janakiraman","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-01-05T23:53:49.864+0000","updated":"2009-01-05T23:53:49.864+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2048/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0tvkn:"}}