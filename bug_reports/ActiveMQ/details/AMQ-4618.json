{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12656338","self":"https://issues.apache.org/jira/rest/api/2/issue/12656338","key":"AMQ-4618","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-07-05T13:09:44.181+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 10 10:51:50 UTC 2013","customfield_12310420":"336561","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_440825611_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-07-10T10:51:50.064+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4618/watchers","watchCount":2,"isWatching":false},"created":"2013-07-05T08:24:44.476+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317974","id":"12317974","description":"Next v5 maintenance release","name":"5.6.0","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-10T10:51:50.085+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have a big problem in a production environment usign ActiveMQ 5.6.0:\nWe have two ActiveMQ instances started up and a consumer application reading from them. The configuration is set to failover so that consumer application reads JMS messages from first instance and changes to second instance only if first one is not reachable.\nAfter some days, we have seen that there is only one connection established to first ActiveMQ instance, but there are more than 80 established connections to second instance (the backup one). Every day more and more connections are created to backup instance until \"java.net.SocketException: Too many open files\" exception is thrown in consumer application because the number of file descriptors is huge\n\n\nBetween ActiveMQ instances and consumer application there is a F5 with a timeout of 300 seconds. Could it be responsible of this bad behaviour?. I think that when F5 detects inactivity in a connection for 300 seconds, it will close it, but ActiveMQ will open a new one, so there should be only one connection at the same time, not growing the number of them, isn't it?\n\n\nThe failover configuration in client is set to:\n\njms.broker.url=failover:(tcp://activeMQHost1:61616,tcp://activeMQHost2:61616)?randomize=false&timeout=3000&priorityBackup=true\n\nIs there any additional parameter to set to solve this problem?\n\n\nThanks in advance","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"336885","customfield_12312823":null,"summary":"Failover configuration establishes more and more connections to inactive ActiveMQ instance","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmescandon","name":"rmescandon","key":"rmescandon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roberto Mier","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmescandon","name":"rmescandon","key":"rmescandon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roberto Mier","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656338/comment/13700650","id":"13700650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"I'd recommend you test against the latest release, or the latest 5.9.SNAPSHOT build to see if you can reproduce this.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-07-05T13:09:44.181+0000","updated":"2013-07-05T13:09:44.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656338/comment/13704414","id":"13704414","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmescandon","name":"rmescandon","key":"rmescandon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roberto Mier","active":true,"timeZone":"Europe/Berlin"},"body":"Hi\n\nWe've found the problem. It seems a client problem. The client was using a JmsTemplate Spring object to send JMS messages to ActiveMq instance, and it seems that it was creating a new connection every time a message was sent. As the configuration was set in failover mode, a new connection was also created to \"inactive\" ActiveMQ instance, but that one was not closed because it was not ever used. (It was only closed when client was shut down)\n\nI close the issue. Thank you very much and sorry for any inconvenience.\n\nRegards.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmescandon","name":"rmescandon","key":"rmescandon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roberto Mier","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-10T10:51:01.185+0000","updated":"2013-07-10T10:51:01.185+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656338/comment/13704415","id":"13704415","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmescandon","name":"rmescandon","key":"rmescandon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roberto Mier","active":true,"timeZone":"Europe/Berlin"},"body":"This was not any ActiveMQ problem but client one","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmescandon","name":"rmescandon","key":"rmescandon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roberto Mier","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-10T10:51:50.082+0000","updated":"2013-07-10T10:51:50.082+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4618/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1m1xr:"}}