{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481059","self":"https://issues.apache.org/jira/rest/api/2/issue/12481059","key":"AMQ-223","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315600","id":"12315600","name":"3.0","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 29 03:18:09 UTC 2005","customfield_12310420":"48948","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1150259000_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2005-04-06T14:24:22.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-223/watchers","watchCount":0,"isWatching":false},"created":"2005-03-24T06:53:23.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315599","id":"12315599","name":"2.1","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2005-04-06T14:24:22.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We are having OutOfMemoryErrors in the broker.  Its configured for vmPersistence, messages have 60 second TTL.  I have checked Queues using Hermes (what a bitch that is to setup with ActiveMQ) and they are empty as expected.  We are using RPC style messaging, with TemporaryQueues for responses, if that helps at all.\n\nThe broker can run for a week before running out of memory, but it is related to how many connections are made.  We run 2-3 batch processes each morning that create a few thousand Connections.  Our broker continually grows, even when all consumers and producers are shutdown.\n\nProfiling with YourKit shows the 63% of the broker memory (after GC) is held by 3292 instances of TcpTransportChannel, held by TcpTransportServerChannel.  Note, as mentioned above there are no active connections, so this doesn't appear to be a bug in our code.\n\nThis is possibly related to AMQ-125 (fixed 1.2), and AMQ-222.  It seems to be the same problem as mentioned by Charles Anthony \"Possible Memory Leak ?\" on activemq-user.  I could not find any update on that thread.\n\nWe will workaround this, by holding connections in a ThreadLocal, since there are only a few threads in a few daily processes.  But regardless, we can expect this growth to continue albeit a much slower pace.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161492","customfield_12312823":null,"summary":"Memory Leak in TcpTransportServerChannel","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"JDK 1.4 (windows)\nvmPersistence ","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481059/comment/12936793","id":"12936793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"body":"After implementing the workaround, activemq.bat memory usage is down from a peak of around 500MB to stable at around 12MB, although still expected to grow over time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuri","name":"yuri","key":"yuri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yuri&avatarId=26087","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yuri&avatarId=26087","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yuri&avatarId=26087","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yuri&avatarId=26087"},"displayName":"Yuri Schimke","active":true,"timeZone":"America/Los_Angeles"},"created":"2005-03-29T03:18:09.000+0000","updated":"2005-03-29T03:18:09.000+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-223/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s03j:"}}