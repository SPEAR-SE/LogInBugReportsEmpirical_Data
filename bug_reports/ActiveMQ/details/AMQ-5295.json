{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12730591","self":"https://issues.apache.org/jira/rest/api/2/issue/12730591","key":"AMQ-5295","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326456","id":"12326456","name":"5.10.1","archived":false,"released":true,"releaseDate":"2015-01-20"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324951","id":"12324951","name":"5.11.0","archived":false,"released":true,"releaseDate":"2015-02-04"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-08-05T16:15:16.729+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Feb 11 10:43:39 UTC 2015","customfield_12310420":"408664","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1284047426_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-08-13T16:45:02.448+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5295/watchers","watchCount":4,"isWatching":false},"created":"2014-07-29T20:04:15.080+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["SSL","TLS","mutualSSL"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":57600,"aggregatetimeoriginalestimate":57600,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-02-11T10:43:39.007+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313893","id":"12313893","name":"Connector"}],"timeoriginalestimate":57600,"customfield_12310080":null,"description":"HttpsClientTransport is getting wrong SSLSocketFactory.\n\nThe problem is here:\n{code}\n    private SchemeRegistry createSchemeRegistry() {\n\n        SchemeRegistry schemeRegistry = new SchemeRegistry();\n        try {\n            // register the default socket factory so that it looks at the javax.net.ssl.keyStore,\n            // javax.net.ssl.trustStore, etc, properties by default\n            SSLSocketFactory sslSocketFactory =\n                    new SSLSocketFactory((javax.net.ssl.SSLSocketFactory) javax.net.ssl.SSLSocketFactory.getDefault(),\n                    SSLSocketFactory.BROWSER_COMPATIBLE_HOSTNAME_VERIFIER);\n            schemeRegistry.register(new Scheme(\"https\", getRemoteUrl().getPort(), sslSocketFactory));\n            return schemeRegistry;\n        } catch (Exception e) {\n            throw new IllegalStateException(\"Failure trying to create scheme registry\", e);\n        }\n    }\n{code}\n\nThe problem with that code is, that it never take SSLSocketFactory from spring context. So the one defined in XML is ignored.\n\nSo it's code have to be replaced with:\n\n{code}\n    private SchemeRegistry createSchemeRegistry() {\n\n        SchemeRegistry schemeRegistry = new SchemeRegistry();\n        try {\n            // register the default socket factory so that it looks at the javax.net.ssl.keyStore,\n            // javax.net.ssl.trustStore, etc, properties by default\n            SSLSocketFactory sslSocketFactory = createSocketFactory();\n            schemeRegistry.register(new Scheme(\"https\", getRemoteUrl().getPort(), sslSocketFactory));\n            return schemeRegistry;\n        } catch (Exception e) {\n            throw new IllegalStateException(\"Failure trying to create scheme registry\", e);\n        }\n    }\n{code}\n\nAnd then new method should be added:\n\n{code}\n    /**\n     * Creates a new SSL SocketFactory. The given factory will use user-provided\n     * key and trust managers (if the user provided them).\n     *\n     * @return Newly created (Ssl)SocketFactory.\n     * @throws IOException\n     */\n    protected SocketFactory createSocketFactory() throws IOException {\n        if (SslContext.getCurrentSslContext() != null) {\n            SslContext ctx = SslContext.getCurrentSslContext();\n            try {\n                return ctx.getSSLContext().getSocketFactory();\n            } catch (Exception e) {\n                throw IOExceptionSupport.create(e);\n            }\n        } else {\n            return SSLSocketFactory.getDefault();\n        }\n\n    }\n{code}\n\nThis is consistent solution with other transports.\n\nI will prepare patches and tests for this scenerio.\n\nGreetings\nPiotr Klimczak","customfield_10010":null,"timetracking":{"originalEstimate":"16h","remainingEstimate":"16h","originalEstimateSeconds":57600,"remainingEstimateSeconds":57600},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":57600,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"408662","customfield_12312823":null,"summary":"HTTPS Network Connector doesn't work with Mutual authentication- HTTPSClientTransport uses wrong SSLSocketFactory","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":57600,"percent":0},"customfield_12311024":null,"environment":"JBoss Fuse 6.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":57600,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730591/comment/14079100","id":"14079100","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"body":"It looks like it is not the only problem with mutual authentication functionality.\nOnce SSLSocketFactory is ok, then NullPointerExceptions occurs.\nDebugging...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"created":"2014-07-30T09:24:35.927+0000","updated":"2014-07-30T09:24:35.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730591/comment/14079137","id":"14079137","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"body":"I've just hit a logging bug.\nWhen certificate is not trusted, then real reason is not thrown.\nIt is also not logged unless debug is enabled.\nAnd then code fails with NPE in much different part of code not pointing to the real cause of problem.\nWhen problems with keys from SSL security point of view was solved, everything started to work.\n\nSo now working on patches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"created":"2014-07-30T10:10:02.517+0000","updated":"2014-07-30T10:10:02.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730591/comment/14086450","id":"14086450","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user PiotrKlimczak opened a pull request:\n\n    https://github.com/apache/activemq/pull/40\n\n    https://issues.apache.org/jira/browse/AMQ-5295\n\n    HTTPS Network Connector doesn't work with Mutual authentication- HTTPSClientTransport uses wrong SSLSocketFactory\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/PiotrKlimczak/activemq trunk\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/40.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #40\n    \n----\ncommit 8a56a40ab8494740cc05b50d848a3be65e8b2ff5\nAuthor: PiotrKlimczak <nannou9@gmail.com>\nDate:   2014-08-05T16:09:52Z\n\n    [AMQ-5295] HTTPS Network Connector doesn't work with Mutual\n    authentication- HTTPSClientTransport uses wrong SSLSocketFactory\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-05T16:15:16.729+0000","updated":"2014-08-05T16:15:16.729+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730591/comment/14086454","id":"14086454","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"body":"Pull request created:\nhttps://github.com/apache/activemq/pull/40\n\nPatch submitted on behalf of WM Promus by Piotr Klimczak","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nannou9","name":"nannou9","key":"nannou9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Piotr Klimczak","active":true,"timeZone":"Europe/London"},"created":"2014-08-05T16:17:21.411+0000","updated":"2014-08-05T16:17:21.411+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730591/comment/14087906","id":"14087906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user PiotrKlimczak opened a pull request:\n\n    https://github.com/apache/activemq/pull/42\n\n    [AMQ-5295] HTTPS Network Connector doesn't work with Mutual\n\n    authentication- HTTPSClientTransport uses wrong SSLSocketFactory\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/PiotrKlimczak/activemq trunk-5295\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/activemq/pull/42.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #42\n    \n----\ncommit 8a56a40ab8494740cc05b50d848a3be65e8b2ff5\nAuthor: PiotrKlimczak <nannou9@gmail.com>\nDate:   2014-08-05T16:09:52Z\n\n    [AMQ-5295] HTTPS Network Connector doesn't work with Mutual\n    authentication- HTTPSClientTransport uses wrong SSLSocketFactory\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-06T17:06:09.612+0000","updated":"2014-08-06T17:06:09.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730591/comment/14087907","id":"14087907","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user PiotrKlimczak closed the pull request at:\n\n    https://github.com/apache/activemq/pull/40\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-06T17:07:11.240+0000","updated":"2014-08-06T17:07:11.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730591/comment/14095684","id":"14095684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Patch applied, thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2014-08-13T16:45:02.487+0000","updated":"2014-08-13T16:45:02.487+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730591/comment/14315996","id":"14315996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/activemq/pull/42\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-02-11T10:43:39.007+0000","updated":"2015-02-11T10:43:39.007+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-5295/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ybef:"}}