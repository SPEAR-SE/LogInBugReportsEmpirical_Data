{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13165952","self":"https://issues.apache.org/jira/rest/api/2/issue/13165952","key":"AMQ-6986","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-06-14T08:50:41.997+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jun 14 16:33:20 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6986/watchers","watchCount":2,"isWatching":false},"created":"2018-06-13T22:16:54.155+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341947","id":"12341947","name":"5.15.3","archived":false,"released":true,"releaseDate":"2018-02-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-06-14T16:33:20.717+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324803","id":"12324803","name":"JDBC"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"With KahaDB, empty queues (0 pending messages) \"survive\" broker restarts.\r\n\r\nInstead when using JDBC persistence, they just disappear (while queues with pending messages work just fine).\r\n\r\n It also seems that Topics are deleted (not sure about this).\r\n\r\n My cfg is:\r\n\r\n{{<persistenceAdapter>}}\r\n{{  <jdbcPersistenceAdapter dataDirectory=\"activemq-data\" dataSource=\"#postgres-ds\" lockKeepAlivePeriod=\"5000\">}}\r\n{{    <locker>}}\r\n{{      <lease-database-locker leaseHolderId=\"i-03f2b8bfc2ff67a6d\" lockAcquireSleepInterval=\"10000\"/>}}\r\n{{    </locker>}}\r\n{{  </jdbcPersistenceAdapter>}}\r\n\r\n{{</persistenceAdapter>}}\r\n\r\n{{<bean id=\"postgres-ds\" class=\"org.postgresql.ds.PGPoolingDataSource\">}}\r\n{{  <property name=\"serverName\" value=\"localhost\"/>}}\r\n{{  <property name=\"databaseName\" value=\"activemq\"/>}}\r\n{{  <property name=\"portNumber\" value=\"0\"/>}}\r\n{{  <property name=\"user\" value=\"activemq\"/>}}\r\n{{  <property name=\"password\" value=\"activemq\"/>}}\r\n{{  <property name=\"dataSourceName\" value=\"postgres\"/>}}\r\n{{  <property name=\"initialConnections\" value=\"1\"/>}}\r\n{{<property name=\"maxConnections\" value=\"10\"/>}}\r\n{{</bean>}}\r\n\r\n \r\n\r\nThis is pretty annoying because, at least in my use-case, a monitoring system periodically polls queues to see if they are empty or not - and it fails if it cannot find the queues that it was polling before broker restart.\r\n\r\nAnd for topics, this can break the application, too.\r\n\r\n \r\n\r\nI can't understand if this is per-design (is it documented?) or I'm facing some bugs.\r\n\r\n \r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Queues/Topics with no pending messages are lost when using JDBCPersistenceAdapter","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidedg","name":"davidedg","key":"davidedg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34050","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"},"displayName":"Davide Del Grande","active":true,"timeZone":"Europe/Rome"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidedg","name":"davidedg","key":"davidedg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34050","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"},"displayName":"Davide Del Grande","active":true,"timeZone":"Europe/Rome"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13165952/comment/16512176","id":"16512176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"it is by design because the jdbc store does not have an index.\r\n\r\n \r\n\r\nthe broker.xml destinations list is a way to persist queues, there is an export option. but it won't help for dynamic systems.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2018-06-14T08:50:41.997+0000","updated":"2018-06-14T08:50:41.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13165952/comment/16512716","id":"16512716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidedg","name":"davidedg","key":"davidedg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34050","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"},"displayName":"Davide Del Grande","active":true,"timeZone":"Europe/Rome"},"body":"Gary,\r\n\r\nthe fact that \"because the jdbc store does not have an index\" - isn't something I can change via config, is it ?\r\n\r\nPersisting queues might be an option in my use case but, yes, not if queue names are not known beforehead - and actually very uncomfortable to maintain in the long run.\r\n\r\nIt might be a good idea if the ActiveMQ documentation / website ([http://activemq.apache.org/jdbc-master-slave.html] ) actually could mention this lack of feature (when compared to KahaDB)\r\n\r\nSince I'm in AWS, I will try with EFS + LDL on my db for locking.\r\n\r\nTy.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidedg","name":"davidedg","key":"davidedg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34050","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"},"displayName":"Davide Del Grande","active":true,"timeZone":"Europe/Rome"},"created":"2018-06-14T16:33:20.717+0000","updated":"2018-06-14T16:33:20.717+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6986/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3uu47:"}}