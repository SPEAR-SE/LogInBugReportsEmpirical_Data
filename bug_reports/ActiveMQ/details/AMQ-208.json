{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481232","self":"https://issues.apache.org/jira/rest/api/2/issue/12481232","key":"AMQ-208","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315600","id":"12315600","name":"3.0","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2005-04-08T11:16:29.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Apr 08 11:16:29 UTC 2005","customfield_12310420":"48935","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2674622000_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2005-04-08T11:16:29.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-208/watchers","watchCount":0,"isWatching":false},"created":"2005-03-08T12:19:27.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315598","id":"12315598","name":"2.0","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2005-04-08T11:16:29.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"When running an embedded broker in a Java app which acts as a message producer, I see (via JMX console for the whole app) that some activeMQ broker-related threads, dedicated to handling a TcpTransportChannel, remain alive whereas no client is connected to the broker.\n\nAs shown by the stack trace for these threads (see below) it seems that, after the remote client has disconnected, the thread is waiting to be notified by another object so that it can terminate. This issue does not happen every time a client disconnects.\n\nHere is the waiting thread stack trace :\n\nName: Thread-11\nState: WAITING on EDU.oswego.cs.dl.util.concurrent.PooledExecutor@f03c46\nTotal blocked: 162  Total waited: 10 152\n\nStack trace: \njava.lang.Object.wait(Native Method)\njava.lang.Object.wait(Object.java:474)\nEDU.oswego.cs.dl.util.concurrent.PooledExecutor.awaitTerminationAfterShutdown(Unknown Source)\norg.codehaus.activemq.util.ExecutorHelper.stopExecutor(ExecutorHelper.java:50)\norg.codehaus.activemq.transport.TransportChannelSupport.stopExecutor(TransportChannelSupport.java:472)\norg.codehaus.activemq.transport.tcp.TcpTransportChannel.stop(TcpTransportChannel.java:196)\norg.codehaus.activemq.broker.impl.BrokerClientImpl.close(BrokerClientImpl.java:658)\norg.codehaus.activemq.broker.impl.BrokerClientImpl.onException(BrokerClientImpl.java:134)\norg.codehaus.activemq.transport.TransportChannelSupport.onAsyncException(TransportChannelSupport.java:430)\norg.codehaus.activemq.transport.tcp.TcpTransportChannel.doAsyncSend(TcpTransportChannel.java:438)\norg.codehaus.activemq.transport.tcp.TcpTransportChannel$1.run(TcpTransportChannel.java:233)\nEDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(Unknown Source)\njava.lang.Thread.run(Thread.java:595)\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"254524","customfield_12312823":null,"summary":"Undead threads in broker when TCP clients disconnect","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=loo_benjamin","name":"loo_benjamin","key":"loo_benjamin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Loo","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=loo_benjamin","name":"loo_benjamin","key":"loo_benjamin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Loo","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Embedded broker","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481232/comment/12936725","id":"12936725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"body":"I think this issue is now fixed; we were incorrectly removing old client connections. Could you please verify this is the case with the latest 3.0 codebase? If its not, we can reopen this issue again","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jstrachan","name":"jstrachan","key":"jstrachan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"james strachan","active":true,"timeZone":"Etc/UTC"},"created":"2005-04-08T11:16:29.000+0000","updated":"2005-04-08T11:16:29.000+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-208/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i17ya7:"}}