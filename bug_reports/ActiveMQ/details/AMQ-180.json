{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12481146","self":"https://issues.apache.org/jira/rest/api/2/issue/12481146","key":"AMQ-180","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315598","id":"12315598","name":"2.0","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2005-01-28T22:20:08.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Feb 03 00:01:58 UTC 2005","customfield_12310420":"48911","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_334259000_*|*_5_*:*_2_*:*_28272000_*|*_4_*:*_1_*:*_409838000","customfield_12312321":null,"resolutiondate":"2005-02-03T00:01:58.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-180/watchers","watchCount":0,"isWatching":false},"created":"2005-01-25T01:29:09.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315598","id":"12315598","name":"2.0","archived":false,"released":true}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stewie","name":"stewie","key":"stewie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stewie","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2005-02-03T00:01:58.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I have confirmed that while a temporary destination is propgated between broker instances across NetworkChannels, it is happening to late to work for request/reply (RPC) operations.\n\nTo test two brokers are required to be interconnected.  Attach to broker1 a \"replier\" process and on broker2 a \"requestor\" process.\n\nThe replier process need only send back a reply message on the \"replyTo\" destination contained in the received message.\n\n\nThe requestor process performs the following steps:\n\n1) create temporary topic\n2) create producer topic TOOL.DEFAULT\n3) create consumer topic from step 1\n4) producer send msg\n5) consumer receive msg\n\nBroker1 log show that the registration of the consumer for the temporary topic arrives after the message is received from the producer.  The result is an exception condition that the destination is no longer valid because the client no longer exists.\n\nGiven the order of execution, I suspect one of the follow problems:\n\na) registration of a consumer is happening at the time the first receive() is executed and not when the consumer is created.\n\nb) network propogation of consumers is done in background thread.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161865","customfield_12312823":null,"summary":"Network propgation of temp dest to late for request/reply","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"W2K java version 1.4.2_05","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481146/comment/12937081","id":"12937081","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"Okay here is some more info on this problem.  I changed the steps a bit.\n\n1) create temporary topic\n2) create consumer topic from step 1\nSleep for 1 second\n3) create producer topic TOOL.DEFAULT\n4) producer send msg\n5) consumer receive msg \n\n\nNow the broker1 log show that the temporary topic registration is happening before the message is sent.\n\n2005-01-26 18:22:32,278 [ocalport=61616]] DEBUG TransientQueueBoundedMessageManager      - Adding consumer: CONSUMER_INFO: id = 8 ConsumerInfo{ browser = false, destination = TemporaryTopic-{TD{requestor12345}TD}ID:hogmaw-1580-1106792549494-6:0, consumerIdentifier = 'ID:hogmaw-4518-1106783758977-0:0_NetworkChannel.1.1' , clientId = 'ID:hogmaw-4518-1106783758977-0:0_NetworkChannel' , sessionId = '1' , consumerName = '' , selector = '' , startTime = 1106792552248, started = true, consumerNo = 1, noLocal = false, prefetchNumber = 10, consumerKey = '[ID:hogmaw-4518-1106783758977-0:0_NetworkChannel:]'  }\n\nNote it is registered with the TransientQueueBoundedMessageManager.  However when the reply message is being sent to the temporary topic the error message of:\n\n2005-01-26 18:22:33,620 [ocalport=61616]] WARN  BrokerClientImpl                         - caught exception consuming packet: ACTIVEMQ_TEXT_MESSAGE: id = 8 ActiveMQMessage{ , jmsMessageID = null, bodyAsBytes = org.codehaus.activemq.message.util.ByteArray@1f03691, readOnlyMessage = false, jmsClientID = 'replier12345' , jmsCorrelationID = 'null' , jmsDestination = TemporaryTopic-{TD{requestor12345}TD}ID:hogmaw-1580-1106792549494-6:0, jmsReplyTo = null, jmsDeliveryMode = 1, jmsRedelivered = false, jmsType = 'null' , jmsExpiration = 0, jmsPriority = 4, jmsTimestamp = 1106792553330, properties = null, readOnlyProperties = false, entryBrokerName = 'ID:hogmaw-1411-1106791070978-0:0' , entryClusterName = 'default' , consumerNos = null, transactionId = 'null' , xaTransacted = false, consumerIdentifer = 'null' , messageConsumed = false, transientConsumed = false, sequenceNumber = 0, deliveryCount = 1, dispatchedFromDLQ = false, messageAcknowledge = null, jmsMessageIdentity = null, producerKey = ID:hogmaw-1578-1106792527032-9: }, text = Returning Message: 0 sent at: Wed Jan 26 18:22:33 PST 2005\njavax.jms.InvalidDestinationException: Destination TemporaryTopic-{TD{requestor12345}TD}ID:hogmaw-1580-1106792549494-6:0 is no longer valid because the client requestor12345 no longer exists\n\tat org.codehaus.activemq.broker.impl.BrokerContainerImpl.checkTempDestinationExistance(BrokerContainerImpl.java:460)\n\nIs indicating that test for the clientID is being done against a the BrokerContainerImpl.  Since the add is not recorded here, it is failing.\n\nAnother interesting item I found in the log is that NetworkMessageBridge objects are setup for temp destination on every broker in the network.  This seems contrary to the way other destination are handled where the NetworkMessageBridge is only established in the broker to which the orginating client is attached.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-01-27T06:09:29.000+0000","updated":"2005-01-27T06:09:29.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481146/comment/12937030","id":"12937030","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stewie","name":"stewie","key":"stewie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stewie","active":true,"timeZone":"Etc/UTC"},"body":"Added JmsTopicRequestor test (using a peer:// topology) to demonstrate and resolve this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stewie","name":"stewie","key":"stewie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stewie","active":true,"timeZone":"Etc/UTC"},"created":"2005-01-28T22:20:08.000+0000","updated":"2005-01-28T22:20:08.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481146/comment/12937044","id":"12937044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"Sorry to be the bearer of bad new, but the problem still exists.  I performed a build with all changes Stewie had checked in as of 1/28 before running the test.  All logs (client and server) are in attached amq180-retestinfo.zip file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-01-29T06:11:20.000+0000","updated":"2005-01-29T06:11:20.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481146/comment/12936804","id":"12936804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"The replier process is client1 (attached to server1) and the requestor process is client2 (attached to server2).  FWIW, servers 3 and 4 represent hosts that will be at a second site.\n\nServer log 1 show the regestration of the temporary destination, but still when the reply is directed back to the requestor the error indicating the client does not exist is still being hit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-01-29T06:14:41.000+0000","updated":"2005-01-29T06:14:41.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481146/comment/12936843","id":"12936843","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"Info (requested by Stewie) to duplicate problem:\n\nThe attached zip file contains my clients (Replier and Requestor), scripts for execution of brokers (server1 - 4) and the clients, and the configuration directories for each process.  \n\nI have both a binary installation (created by dist:build-bin) and a source development installation.  The scripts are run from the source development area, but use the jars from the binary installation via the ACTIVEMQ_HOME env variable.\n\nBTW replier client connects to server1 and requestor client connects to server2.  While I run all four servers to duplicate my intended enviroment, the problem can be duplicate with just servers 1 and 2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-02-01T22:09:45.000+0000","updated":"2005-02-01T22:09:45.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12481146/comment/12937019","id":"12937019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"body":"Fix for this one looks good.  Thanks Stewie.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dennis%40bevocal.com","name":"dennis@bevocal.com","key":"dennis@bevocal.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Cook","active":true,"timeZone":"Etc/UTC"},"created":"2005-02-03T00:01:58.000+0000","updated":"2005-02-03T00:01:58.000+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-180/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s2ef:"}}