{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13096666","self":"https://issues.apache.org/jira/rest/api/2/issue/13096666","key":"AMQ-6796","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341031","id":"12341031","name":"5.15.1","archived":false,"released":true,"releaseDate":"2017-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341032","id":"12341032","name":"5.16.0","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-08-23T16:21:11.606+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 23 16:23:24 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_116151969_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-08-23T16:24:47.410+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6796/watchers","watchCount":2,"isWatching":false},"created":"2017-08-22T08:08:55.494+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338054","id":"12338054","name":"5.15.0","archived":false,"released":true,"releaseDate":"2017-07-05"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-08-23T16:24:47.449+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315706","id":"12315706","name":"stomp"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Reproducing the problem:\n* Receive two messages via STOMP on a subscription with ack:client-individual\n* Start a transaction\n* Acknowledge message #2\n* Acknowledge message #1\n* Commit the transaction\n\nExpected behaviour:\n* Both messages are acknowledged, life goes on\n\nObserved behaviour:\n* Exception is raised\n\n{{javax.jms.JMSException: Unmatched acknowledge: MessageAck {commandId = 0, responseRequired = false, ackType = 2, consumerId = ID:(...)-6:555:-1:1, firstMessageId = null, lastMessageId = ID:(...)-6:555:-1:1:1, destination = queue://(...), transactionId = null, messageCount = 2, poisonCause = null}; Expected message count (2) differs from count in dispatched-list (1)\n  \tat org.apache.activemq.broker.region.PrefetchSubscription.assertAckMatchesDispatched(PrefetchSubscription.java:519)\n  \tat org.apache.activemq.broker.region.PrefetchSubscription.acknowledge(PrefetchSubscription.java:211)\n  \tat org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:528)\n  \tat org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:475)\n(..)}}\n\nI have prepared a [unit test|https://github.com/Anthchirp/activemq/commit/7df4f25975c6500e65b1688ca81e761c1825a32a] for this ([patch file|https://github.com/Anthchirp/activemq/commit/7df4f25975c6500e65b1688ca81e761c1825a32a.patch]).\n\nThe exception is not raised if the messages are acknowledged outside of a transaction.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Acknowledging messages out of order in a STOMP 1.1 transaction raises exception","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgerstel","name":"mgerstel","key":"mgerstel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgerstel&avatarId=32519","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgerstel&avatarId=32519","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgerstel&avatarId=32519","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgerstel&avatarId=32519"},"displayName":"Markus Gerstel","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgerstel","name":"mgerstel","key":"mgerstel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgerstel&avatarId=32519","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgerstel&avatarId=32519","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgerstel&avatarId=32519","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgerstel&avatarId=32519"},"displayName":"Markus Gerstel","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13096666/comment/16138567","id":"16138567","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 4c986d102cd5c862d88fd84eec1889b9786e9970 in activemq's branch refs/heads/master from [~tabish121]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4c986d1 ]\n\nAMQ-6796 Avoid double Ack on commit in STOMP individual ack mode\n\nDuring commit of transaction when subscription mode is individual ack\nthe messages can get double acked leading to an error about receipt of\nan invalid ack.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-23T16:21:11.606+0000","updated":"2017-08-23T16:21:11.606+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13096666/comment/16138572","id":"16138572","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 8e9f80e7d6fdee3e3ecd2293fa364c05a2e9b18b in activemq's branch refs/heads/activemq-5.15.x from [~tabish121]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8e9f80e ]\n\nAMQ-6796 Avoid double Ack on commit in STOMP individual ack mode\n\nDuring commit of transaction when subscription mode is individual ack\nthe messages can get double acked leading to an error about receipt of\nan invalid ack.\n(cherry picked from commit 4c986d102cd5c862d88fd84eec1889b9786e9970)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-23T16:23:24.052+0000","updated":"2017-08-23T16:23:24.052+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6796/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3j4pb:"}}