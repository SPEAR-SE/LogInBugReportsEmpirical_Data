{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12483220","self":"https://issues.apache.org/jira/rest/api/2/issue/12483220","key":"AMQ-2479","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2009-11-06T13:28:50.479+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Feb 17 02:14:42 UTC 2010","customfield_12310420":"74927","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_8929523681_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-02-17T02:13:25.195+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2479/watchers","watchCount":2,"isWatching":false},"created":"2009-11-05T17:48:01.514+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-02-17T02:14:42.066+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have application #1 that pulls records from a DB, puts them into messages, and sends them to a local queue on server A. That queue routes to a 2nd queue on server B using camel routing. \n\nOn Server A, the application log and AMQ log both show the messages being created and persisted in the queue.\n\nOn Server B, application #2 pulls, messages from its queue which were routed from the queue on Server A.\n\nFrom application #2's log, for a 2 minute period of time, ActiveMQ threw this exception:\n\n14:11:01,317 ERROR [WrapperSimpleAppMain] (application2.java:1072) - Problem creating session... javax.jms.JMSException: Channel was inactive for too long: ServerB.foo.com/10.0.40.138:61616\n\nand there were also 20 other Exceptions thrown:\n\n14:12:27,158 ERROR [WrapperSimpleAppMain] (application2.java:1072) - Problem creating session... javax.jms.JMSException: Could not connect to broker URL: tcp://ServerB.foo.com:61616. Reason: java.net.ConnectException: Connection refused: connect\n\nOn Server B, application #2's log and the AMQ log have no record of 155 records that were verified as created, put into messages, and sent on Server A.\n\nThe application blew up and the wrapper service restarted it. All records & messages before the incident were ok before and after the incident.\n\nThe question is, what happened to the messages when the broker crashed on Server B?\n\nSoftware used:\nActiveMQ 5.3.0\nCamel 2.0.0\nJava JDK 1.6u16\nJava Service Wrapper (tanukisoftware) v 3.3.7 (x86-32)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"172293","customfield_12312823":null,"summary":"Channel was inactive for too long","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ckenyeres","name":"ckenyeres","key":"ckenyeres","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ckenyeres&avatarId=34470","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ckenyeres&avatarId=34470","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ckenyeres&avatarId=34470","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ckenyeres&avatarId=34470"},"displayName":"Christian A. Kenyeres","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ckenyeres","name":"ckenyeres","key":"ckenyeres","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ckenyeres&avatarId=34470","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ckenyeres&avatarId=34470","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ckenyeres&avatarId=34470","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ckenyeres&avatarId=34470"},"displayName":"Christian A. Kenyeres","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows 2003 Server RC2, Enterprise Edition, SP2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483220/comment/12941365","id":"12941365","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"body":"you need to provide some more info here, like the route descriptions on #1 and #2.\nIn any event, #1 that does a dequeue and enqueue needs to use a dequeue transaction that spans the enqueue  such that there is no inflight message loss.\nAlso, in the event of B failure, the failover transport on the jms connection will do an auto reconnect.\n\nHow are the activemq components configured to access brokers, are the brokers persistent?\nAgain, attaching a test case or some variant of your routes would help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gtully","name":"gtully","key":"gtully","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gary Tully","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-06T13:28:50.479+0000","updated":"2009-11-06T13:28:50.479+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483220/comment/12941630","id":"12941630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ckenyeres","name":"ckenyeres","key":"ckenyeres","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ckenyeres&avatarId=34470","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ckenyeres&avatarId=34470","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ckenyeres&avatarId=34470","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ckenyeres&avatarId=34470"},"displayName":"Christian A. Kenyeres","active":true,"timeZone":"Etc/UTC"},"body":"Brokers are using kahaDB. They allow JMX.\n\n==========================\nServer A (applicationContext.xml)\n==========================\n<route>\n\t<from uri=\"activemq:queue:X.REQUEST.FOO.PRD\"/>\n\t<to uri=\"serverB:queue:Y.REQUEST.FOO.PRD\"/>\n</route>\n\t\n<!-- ActiveMQ on serverB.foo.com -->\n<bean id=\"serverB\" class=\"org.apache.activemq.camel.component.ActiveMQComponent\">                                                \n\t<property name=\"brokerURL\" value=\"tcp://serverB.foo.com:61616\"/>\n</bean>\n\t\t\n==========================\nServer B (applicationContext.xml)\n==========================\n<route>\n\t<from uri=\"activemq:queue:Y.REPLY.FOO.PRD\"/>\n\t<to uri=\"serverA:queue:X.REPLY.FOO.PRD\"/>\n</route>\n\n<!-- ActiveMQ on serverA.foo.com -->\n<bean id=\"serverA\" class=\"org.apache.activemq.camel.component.ActiveMQComponent\">\n\t<property name=\"brokerURL\" value=\"tcp://serverA.foo.com:61616\"/>\n</bean>\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ckenyeres","name":"ckenyeres","key":"ckenyeres","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ckenyeres&avatarId=34470","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ckenyeres&avatarId=34470","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ckenyeres&avatarId=34470","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ckenyeres&avatarId=34470"},"displayName":"Christian A. Kenyeres","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-09T19:45:52.582+0000","updated":"2009-11-09T19:45:52.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12483220/comment/12942223","id":"12942223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ckenyeres","name":"ckenyeres","key":"ckenyeres","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ckenyeres&avatarId=34470","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ckenyeres&avatarId=34470","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ckenyeres&avatarId=34470","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ckenyeres&avatarId=34470"},"displayName":"Christian A. Kenyeres","active":true,"timeZone":"Etc/UTC"},"body":"This issue appeared at random and it could not be successfully reproduced.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ckenyeres","name":"ckenyeres","key":"ckenyeres","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ckenyeres&avatarId=34470","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ckenyeres&avatarId=34470","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ckenyeres&avatarId=34470","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ckenyeres&avatarId=34470"},"displayName":"Christian A. Kenyeres","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-17T02:14:42.033+0000","updated":"2010-02-17T02:14:42.033+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-2479/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0turj:"}}