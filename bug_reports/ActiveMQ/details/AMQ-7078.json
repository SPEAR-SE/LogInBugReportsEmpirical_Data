{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13192268","self":"https://issues.apache.org/jira/rest/api/2/issue/13192268","key":"AMQ-7078","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2018-10-17 14:34:51.915","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7078/watchers","watchCount":1,"isWatching":false},"created":"2018-10-17T14:34:51.915+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12343805","id":"12343805","description":"","name":"5.15.6","archived":false,"released":true,"releaseDate":"2018-09-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-10-17T14:55:38.110+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"I spoke with [~gtully] over irc about this, attached a log of that and a unit test demonstrating what I mean. Verified in 5.15.6, likely an issue as far back as you go, but hard to verify due to a related bug AMQ-6443.\r\n\r\nIf you use virtual topic consumer queues using wild wildcards and non-unique consumer queue prefixes (the part before \"VirtualTopic\" in the queue name) you can end up with duplicate messages in the wildcard queue while taking messages from nonwildcard queues. E.g. \"Consumer.foo.VirtualTopic.>\" and \"Consumer.foo.VirtualTopic.bar\".\r\n\r\n\"Consumer.foo.VirtualTopic.>\" gets dispatched messages sent to the topic \"VirtualTopic.bar\" but consumers of \"Consumer.foo.VirtualTopic.>\" also become consumers of *any virtual topic consumer queue that matches the wildcard pattern*. So consumers of wildcard virtual topic queues can receive messages multiple times while depriving others of the messages they expect. If 5 messages are sent to \"VirtualTopic.bar\", 5 messages are dispatched to both \"Consumer.foo.VirtualTopic.>\" and \"Consumer.foo.VirtualTopic.bar\", this is correct so far. But the \"Consumer.foo.VirtualTopic.>\" consumer will end up with more than 5 messages (being detected as duplicated if the client supports it) while the \"Consumer.foo.VirtualTopic.bar\" ends up with less than it expects.\r\n\r\nPossibly related to https://issues.apache.org/jira/browse/AMQ-6643, though i think the fix (and me trying to verify its working as expected) simply made the behavior obvious. I dont think the AMQ-6643 fix introduced this behavior. I dont think this is a bug, but an unintended interaction of wildcards between virtualtopic destination mapping and queue wildcards in general. The later would need to explicitly guard against the case.\r\n\r\nThere is an obvious and simple client side work around (dont use the same prefix) but at the very least I think this should be called out in documentation as it surprised me and I am quite familiar with how AMQ and virtual topics work. It makes sense in hindsight, but the behavior is very subtle if you arent paying attention and requires you to connect some dots. Most of my amq clients are outside of my direct control and managed by people with little to no amq/jms experience so the simple client side work around is less simple.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12944351","id":"12944351","filename":"gtully_irc_conversation.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mstratto","name":"mstratto","key":"mstratto","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Stratton","active":true,"timeZone":"America/New_York"},"created":"2018-10-17T14:22:32.284+0000","size":4957,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12944351/gtully_irc_conversation.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12944350","id":"12944350","filename":"VirtualTopicWildcardMisrouting.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mstratto","name":"mstratto","key":"mstratto","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Stratton","active":true,"timeZone":"America/New_York"},"created":"2018-10-17T14:22:45.859+0000","size":4424,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12944350/VirtualTopicWildcardMisrouting.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"possibly unintended competing consumer behavior with virtual topic consumer queues using wildcards","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mstratto","name":"mstratto","key":"mstratto","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Stratton","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mstratto","name":"mstratto","key":"mstratto","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Stratton","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-7078/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3zbbj:"}}