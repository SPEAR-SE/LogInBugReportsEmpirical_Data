{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13097283","self":"https://issues.apache.org/jira/rest/api/2/issue/13097283","key":"AMQ-6798","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341031","id":"12341031","name":"5.15.1","archived":false,"released":true,"releaseDate":"2017-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341032","id":"12341032","name":"5.16.0","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-08-24T11:23:38.095+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 24 13:25:25 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_11108128_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-08-24T13:25:34.385+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6798/watchers","watchCount":4,"isWatching":false},"created":"2017-08-24T10:20:26.313+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329390","id":"12329390","name":"5.10.2","archived":false,"released":true,"releaseDate":"2015-02-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12338054","id":"12338054","name":"5.15.0","archived":false,"released":true,"releaseDate":"2017-07-05"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-08-24T13:25:34.430+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"customfield_12310080":null,"description":"Our services create queues on broker. It queues exists in 1 day then they become inactive, cause clients turned off. Active mq removes them by Inactivity timeout 60 seconds. But memory consumption of broker grows permanently. We acquired heap dump, and saw that org.apache.activemq.usage.StoreUsage contains 2.7 millions of object with 1.5 gb. That objects belongs to StoreUsage of queues. \n\nI don't sure that we uses broker as it should be used. Maybe we shouldn't create new queues. But this behavior is stranged for me.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12883522","id":"12883522","filename":"1535.dmp","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"created":"2017-08-24T10:26:40.536+0000","size":31107025,"mimeType":"application/vnd.tcpdump.pcap","content":"https://issues.apache.org/jira/secure/attachment/12883522/1535.dmp"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12883523","id":"12883523","filename":"activemq.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"created":"2017-08-24T10:27:31.814+0000","size":3150,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12883523/activemq.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Queue left StoreUsage object in memory. Memory leak","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux 3.10.0-327.36.3.el7.x86_64 #1 SMP Mon Oct 24 16:09:20 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097283/comment/16139866","id":"16139866","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"body":"Dump of ActiveMQ Broker memory - this dump is after test cases but StoreUsage objects hold here too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"created":"2017-08-24T10:26:43.679+0000","updated":"2017-08-24T10:30:11.824+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097283/comment/16139868","id":"16139868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"body":"ActiveMQ configuration file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"created":"2017-08-24T10:27:43.819+0000","updated":"2017-08-24T10:27:43.819+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097283/comment/16139908","id":"16139908","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"Can you try a newer version of ActiveMQ to see if your issue still exists? Such as 5.14.5 or 5.15.0 ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2017-08-24T11:23:38.095+0000","updated":"2017-08-24T11:23:38.095+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097283/comment/16139936","id":"16139936","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"body":"I suggest that org.apache.activemq.broker.region.Queue in method start() runs StoreUsage like this:\nif (systemUsage.getStoreUsage() != null) {\n       systemUsage.getStoreUsage().start();\n}\n\nBut in method stop StoreUsage isn't stoped. So it remains in its parent StoreUsage.\n\nOk i'll try to test on 5.14.5 or 5.15.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"created":"2017-08-24T11:52:07.338+0000","updated":"2017-08-24T11:52:30.661+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097283/comment/16139952","id":"16139952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"body":"I think you might be right, the memoryUsage variable is stopped in the stop() method but the systemUsage variable is not stopped which I think would lead to this leak.  I'll take a look at this closer today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cshannon","name":"cshannon","key":"christopher.l.shannon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614"},"displayName":"Christopher L. Shannon","active":true,"timeZone":"America/New_York"},"created":"2017-08-24T12:10:03.086+0000","updated":"2017-08-24T12:10:03.086+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097283/comment/16139989","id":"16139989","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"body":"I've tested on ActiveMq 5.15.0. Story is the same. StoreUsage is hung in their parent. Memory grows after each queue instance creation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tolikrdi","name":"tolikrdi","key":"tolikrdi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anatolii Botov","active":true,"timeZone":"Europe/Moscow"},"created":"2017-08-24T12:41:16.527+0000","updated":"2017-08-24T12:42:11.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097283/comment/16140028","id":"16140028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 35bd3ad938f5c378b17a34980d2f3480bf3bbfc3 in activemq's branch refs/heads/master from [~cshannon]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=35bd3ad ]\n\nAMQ-6798 - Clean up store usage object on Queue stop\n\nWhen queues are stopped the StoreUsage object needs to be stopped so it\nwill be removed from the parent StoreUsage.  This allows the object to\nbe garbage collected and prevents a memory leak.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-24T13:24:53.950+0000","updated":"2017-08-24T13:24:53.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097283/comment/16140029","id":"16140029","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit eca72dc81ad8113e31fadf161580bf5e2b93e27a in activemq's branch refs/heads/activemq-5.15.x from [~cshannon]\n[ https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=eca72dc ]\n\nAMQ-6798 - Clean up store usage object on Queue stop\n\nWhen queues are stopped the StoreUsage object needs to be stopped so it\nwill be removed from the parent StoreUsage.  This allows the object to\nbe garbage collected and prevents a memory leak.\n\n(cherry picked from commit 35bd3ad938f5c378b17a34980d2f3480bf3bbfc3)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-24T13:25:25.181+0000","updated":"2017-08-24T13:25:25.181+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-6798/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3j8hb:"}}