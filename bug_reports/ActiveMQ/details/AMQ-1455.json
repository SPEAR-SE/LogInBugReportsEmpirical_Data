{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12482846","self":"https://issues.apache.org/jira/rest/api/2/issue/12482846","key":"AMQ-1455","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315620","id":"12315620","description":"","name":"5.3.0","archived":false,"released":true,"releaseDate":"2009-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-05-09T19:37:35.048+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Sep 13 10:43:08 UTC 2009","customfield_12310420":"43767","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_60883722314_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-09-13T10:43:08.115+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1455/watchers","watchCount":3,"isWatching":false},"created":"2007-10-09T18:34:25.801+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315617","id":"12315617","description":"","name":"5.0.0","archived":false,"released":true,"releaseDate":"2007-12-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-09-13T10:43:08.089+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313903","id":"12313903","name":"Transport"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"The bridge between two nodes keeps falling down after a few minutes of use.\n\n\nThis is maybe a misconfiguration and totally my bad, so here is the network config:\n\n\t\t<transportConnectors>\n\t\t\t<transportConnector uri=\"vm://${esb.node.name}\" />\n\t\t\t<transportConnector uri=\"tcp://localhost:58080\" discoveryUri=\"rendezvous://dev-esb-node\" />\n\t\t</transportConnectors>\n\n\t\t<networkConnectors>\n\t\t\t<networkConnector conduitSubscriptions=\"true\" decreaseNetworkConsumerPriority=\"true\" dynamicOnly=\"true\"\n\t\t\t\tnetworkTTL=\"64\" uri=\"rendezvous://dev-esb-node\" userName=\"broker\" password=\"XXX\" />\n\t\t</networkConnectors>\n\n\n${esb.node.name} resolves to \"backbone-node-8080\" on one box and \"collection-node-8080\" on the other.\n\n\nAnd here are the errors when the bridge crashes:\n\n11:04:46,241 DEBUG [org.apache.activemq.network.DemandForwardingBridge] backbone-node-8080 Forwarding sub on vm://backbone-node-8080#4 from collection-node-8080 :  ConsumerInfo {commandId = 4, responseRequired = true, consumerId = ID:ddo-mbp.local-51198-1191953085196-0:0:1:1, destination = queue://esb.admin.errors, prefetchSize = 500, maximumPendingMessageLimit = 0, browser = true, dispatchAsync = false, selector = null, subscriptionName = null, noLocal = false, exclusive = false, retroactive = false, priority = 0, brokerPath = null, optimizedAcknowledge = false, noRangeAcks = false, additionalPredicate = null}\n11:04:46,250 INFO  [org.apache.activemq.network.DemandForwardingBridge] Network connection between vm://backbone-node-8080#4 and tcp://esb-backbone-node2.dev.com/10.20.116.14:58\n080 shutdown due to a local error: java.lang.NullPointerException\n11:04:46,254 DEBUG [org.apache.activemq.network.DemandForwardingBridge] The local Exception was:java.lang.NullPointerException\njava.lang.NullPointerException\n        at org.apache.activemq.network.DemandForwardingBridgeSupport.configureMessage(DemandForwardingBridgeSupport.java:539)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport.serviceLocalCommand(DemandForwardingBridgeSupport.java:561)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport$1.onCommand(DemandForwardingBridgeSupport.java:137)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:100)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:67)\n        at org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:102)\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\n        at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:59)\n        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1184)\n        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:803)\n        at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:838)\n        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:118)\n        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:42)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)\n        at java.lang.Thread.run(Thread.java:619)\n11:04:46,259 DEBUG [org.apache.activemq.network.DemandForwardingBridge]  stopping backbone-node-8080 bridge to collection-node-8080 is disposed already ? false\n11:04:46,261 INFO  [org.apache.activemq.network.DemandForwardingBridge] backbone-node-8080 bridge to collection-node-8080 stopped\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"161841","customfield_12312823":null,"summary":"Network bridge keeps falling down","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddossot","name":"ddossot","key":"ddossot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ddossot&avatarId=25441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ddossot&avatarId=25441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ddossot&avatarId=25441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ddossot&avatarId=25441"},"displayName":"David Dossot","active":true,"timeZone":"America/Vancouver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddossot","name":"ddossot","key":"ddossot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ddossot&avatarId=25441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ddossot&avatarId=25441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ddossot&avatarId=25441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ddossot&avatarId=25441"},"displayName":"David Dossot","active":true,"timeZone":"America/Vancouver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"apache-activemq-5.0-20071008.215641-19, RHEL 4, JDK 1.6.0_02","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482846/comment/12939109","id":"12939109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddossot","name":"ddossot","key":"ddossot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ddossot&avatarId=25441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ddossot&avatarId=25441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ddossot&avatarId=25441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ddossot&avatarId=25441"},"displayName":"David Dossot","active":true,"timeZone":"America/Vancouver"},"body":"The NPE is thrown on this line:\n\n     Message message = md.getMessage().copy();\n\nBy following the code before this line, md can not be null, so this is getMessage() that is null.\n\nIs this because I am erroneously using the VM transport? The reason I am using this transport is because my brokers are embedded in Java apps that connect to the local broker using the VM adapter.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddossot","name":"ddossot","key":"ddossot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ddossot&avatarId=25441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ddossot&avatarId=25441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ddossot&avatarId=25441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ddossot&avatarId=25441"},"displayName":"David Dossot","active":true,"timeZone":"America/Vancouver"},"created":"2007-10-09T23:33:01.598+0000","updated":"2007-10-09T23:33:01.598+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482846/comment/12939086","id":"12939086","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddossot","name":"ddossot","key":"ddossot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ddossot&avatarId=25441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ddossot&avatarId=25441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ddossot&avatarId=25441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ddossot&avatarId=25441"},"displayName":"David Dossot","active":true,"timeZone":"America/Vancouver"},"body":"I have stopped using VM transport altogether from my embedded client application, but the problem still happens: the bridge keeps falling down.\n\nI noticed the issue seems to happen if I have a queue browser (from Hermes) on the same distributed queue my application is using.\n\nI recognize the issue is hard to reproduce on your side, but in the mean time can the bridge be made more resilient to runtime exceptions so it recovers and does not stop?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddossot","name":"ddossot","key":"ddossot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ddossot&avatarId=25441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ddossot&avatarId=25441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ddossot&avatarId=25441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ddossot&avatarId=25441"},"displayName":"David Dossot","active":true,"timeZone":"America/Vancouver"},"created":"2007-10-10T18:17:21.440+0000","updated":"2007-10-10T18:17:21.440+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482846/comment/12939116","id":"12939116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddossot","name":"ddossot","key":"ddossot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ddossot&avatarId=25441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ddossot&avatarId=25441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ddossot&avatarId=25441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ddossot&avatarId=25441"},"displayName":"David Dossot","active":true,"timeZone":"America/Vancouver"},"body":"Interestingly AMQ-805 gives the impression the bridge should auto-reconnect...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddossot","name":"ddossot","key":"ddossot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ddossot&avatarId=25441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ddossot&avatarId=25441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ddossot&avatarId=25441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ddossot&avatarId=25441"},"displayName":"David Dossot","active":true,"timeZone":"America/Vancouver"},"created":"2007-10-10T18:41:20.599+0000","updated":"2007-10-10T18:41:20.599+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482846/comment/12939630","id":"12939630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aricooperman","name":"aricooperman","key":"aricooperman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ari Cooperman","active":true,"timeZone":"Etc/UTC"},"body":"This same exact thing happens for me as well. I am also using embedded brokers with VM transport","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aricooperman","name":"aricooperman","key":"aricooperman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ari Cooperman","active":true,"timeZone":"Etc/UTC"},"created":"2008-05-09T19:37:35.048+0000","updated":"2008-05-09T19:37:35.048+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12482846/comment/12941335","id":"12941335","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"body":"This should be resolved in 5.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajdavies","name":"rajdavies","key":"rajdavies","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942"},"displayName":"Rob Davies","active":true,"timeZone":"Etc/UTC"},"created":"2009-09-13T10:43:08.088+0000","updated":"2009-09-13T10:43:08.088+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-1455/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0s293:"}}