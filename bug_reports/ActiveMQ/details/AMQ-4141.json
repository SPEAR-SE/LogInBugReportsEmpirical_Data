{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12613918","self":"https://issues.apache.org/jira/rest/api/2/issue/12613918","key":"AMQ-4141","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 23 15:28:05 UTC 2012","customfield_12310420":"252808","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2157122512_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-11-23T15:28:05.814+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4141/watchers","watchCount":1,"isWatching":false},"created":"2012-10-29T16:16:03.322+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315626","id":"12315626","description":"","name":"5.5.0","archived":false,"released":true,"releaseDate":"2011-04-01"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321258","id":"12321258","description":"Next v5 maintenance release","name":"5.7.0","archived":false,"released":true,"releaseDate":"2012-10-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-11-23T15:28:05.832+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":null,"customfield_12310080":null,"description":"We have a single Stomp consumer being invoked via a schedule with ten-second intervals to consume at most 200 messages with a one second network timeout.\n\nThe consumer subscribes to /queue/account_events on the localhost broker (\"hub\"). This broker is connected to from three external brokers which have producers on them (\"production servers\").\n\nWhat we see is a large built-up of messages on the remote brokers for this queue, with a small number of messages pending on the hub. The messages are not persistent and tend to be smallish (<1KB).\n\nThe consumer is literally sat waiting for the next available message. Under \"normal\" conditions it spins up and consumes 200 messages at a pace of a few msgs per second. Right at this moment it goes dozens of seconds without a message then processes two-three inside 2 seconds.\n\nThe hub's web console is showing 91 pending, 1 consumer. If I click to browse this queue, there are no messages. The counter for 91 has been \"stuck\" for some time now.\n\nThe hub has been set at debug level but there is only very recent logs recorded. A sample of them grepping for \"account_events\" shows activity such as:\n\n2012-10-29 15:25:50,016 | DEBUG | queue://account_events expiring messages .. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:25:50,016 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:25:50,016 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ BrokerService[hub] Task-110\n2012-10-29 15:25:50,020 | DEBUG | queue://account_events expiring messages done. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:25:52,134 | DEBUG | queue://account_events expiring messages .. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:25:52,134 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:25:52,134 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ BrokerService[hub] Task-112\n2012-10-29 15:25:52,134 | DEBUG | queue://account_events expiring messages done. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:20,016 | DEBUG | queue://account_events expiring messages .. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:20,016 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:20,016 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ BrokerService[hub] Task-110\n2012-10-29 15:26:20,017 | DEBUG | queue://account_events expiring messages done. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:22,134 | DEBUG | queue://account_events expiring messages .. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:22,134 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:22,134 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ BrokerService[hub] Task-110\n2012-10-29 15:26:22,134 | DEBUG | queue://account_events expiring messages done. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:35,687 | DEBUG | Unregistering MBean org.apache.activemq:BrokerName=hub,Type=Subscription,persistentMode=Non-Durable,destinationType=Queue,destinationName=account_events,clientId=account_events_receiver,consumerId=ID_billing-35190-1351511867558-2_1285_-1_1 | org.apache.activemq.broker.jmx.ManagementContext | ActiveMQ Transport: tcp:///127.0.0.1:50560@61612\n2012-10-29 15:26:35,687 | DEBUG | hub removing consumer: ID:billing-35190-1351511867558-2:1285:-1:1 for destination: queue://account_events | org.apache.activemq.broker.region.AbstractRegion | ActiveMQ Transport: tcp:///127.0.0.1:50560@61612\n2012-10-29 15:26:35,688 | DEBUG | queue://account_events remove sub: QueueSubscription: consumer=ID:billing-35190-1351511867558-2:1285:-1:1, destinations=1, dispatched=0, delivered=0, pending=0, lastDeliveredSeqId: 0, dequeues: 26950, dispatched: 26950, inflight: 0 | org.apache.activemq.broker.region.Queue | ActiveMQ Transport: tcp:///127.0.0.1:50560@61612\n2012-10-29 15:26:35,688 | DEBUG | Unregistering MBean org.apache.activemq:BrokerName=hub,Type=Producer,destinationType=Dynamic,clientId=account_events_receiver,producerId=ID_billing-35190-1351511867558-2_1285_-1_1 | org.apache.activemq.broker.jmx.ManagementContext | ActiveMQ Transport: tcp:///127.0.0.1:50560@61612\n2012-10-29 15:26:35,688 | DEBUG | Unregistering MBean org.apache.activemq:BrokerName=hub,Type=Connection,ConnectorName=stomp,Connection=account_events_receiver | org.apache.activemq.broker.jmx.ManagementContext | ActiveMQ Transport: tcp:///127.0.0.1:50560@61612\n2012-10-29 15:26:35,688 | DEBUG | bridging (hub -> drax) ID:billing-35190-1351511867558-1:1:0:0:80197, consumer: ID:billing-35190-1351511867558-9:1:1:1, destination topic://ActiveMQ.Advisory.Consumer.Queue.account_events, brokerPath: [ID:billing-35190-1351511867558-0:1], message: ActiveMQMessage {commandId = 0, responseRequired = false, messageId = ID:billing-35190-1351511867558-1:1:0:0:80197, originalDestination = null, originalTransactionId = null, producerId = ID:billing-35190-1351511867558-9:2:1:1, destination = topic://ActiveMQ.Advisory.Consumer.Queue.account_events, transactionId = null, expiration = 0, timestamp = 0, arrival = 0, brokerInTime = 1351524395688, brokerOutTime = 1351524395688, correlationId = null, replyTo = null, persistent = false, type = Advisory, priority = 0, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = RemoveInfo {commandId = 0, responseRequired = false, objectId = ID:billing-35190-1351511867558-2:1285:-1:1, lastDeliveredSequenceId = 0}, redeliveryCounter = 0, size = 1024, properties = {consumerCount=0, originBrokerURL=tcp://0.0.0.0:61616, originBrokerId=ID:billing-35190-1351511867558-0:1, originBrokerName=hub}, readOnlyProperties = false, readOnlyBody = false, droppable = false} | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ BrokerService[hub] Task-110\n2012-10-29 15:26:35,689 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ BrokerService[hub] Task-112\n2012-10-29 15:26:36,847 | DEBUG | Setting up new connection id: ID:billing-35190-1351511867558-2:1304, address: tcp://127.0.0.1:50601, info: ConnectionInfo {commandId = 0, responseRequired = true, connectionId = ID:billing-35190-1351511867558-2:1304, clientId = account_events_receiver, clientIp = null, userName = , password = *****, brokerPath = null, brokerMasterConnector = false, manageable = false, clientMaster = true, faultTolerant = false, failoverReconnect = false} | org.apache.activemq.broker.TransportConnection | ActiveMQ Transport: tcp:///127.0.0.1:50601@61612\n2012-10-29 15:26:36,887 | DEBUG | hub adding consumer: ID:billing-35190-1351511867558-2:1304:-1:1 for destination: queue://account_events | org.apache.activemq.broker.region.AbstractRegion | ActiveMQ Transport: tcp:///127.0.0.1:50601@61612\n2012-10-29 15:26:36,888 | DEBUG | queue://account_events add sub: QueueSubscription: consumer=ID:billing-35190-1351511867558-2:1304:-1:1, destinations=0, dispatched=0, delivered=0, pending=0, dequeues: 26950, dispatched: 26950, inflight: 0 | org.apache.activemq.broker.region.Queue | ActiveMQ Transport: tcp:///127.0.0.1:50601@61612\n2012-10-29 15:26:36,888 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ BrokerService[hub] Task-112\n2012-10-29 15:26:36,889 | DEBUG | bridging (hub -> drax) ID:billing-35190-1351511867558-1:1:0:0:80200, consumer: ID:billing-35190-1351511867558-9:1:1:1, destination topic://ActiveMQ.Advisory.Consumer.Queue.account_events, brokerPath: [ID:billing-35190-1351511867558-0:1], message: ActiveMQMessage {commandId = 0, responseRequired = false, messageId = ID:billing-35190-1351511867558-1:1:0:0:80200, originalDestination = null, originalTransactionId = null, producerId = ID:billing-35190-1351511867558-9:2:1:1, destination = topic://ActiveMQ.Advisory.Consumer.Queue.account_events, transactionId = null, expiration = 0, timestamp = 0, arrival = 0, brokerInTime = 1351524396889, brokerOutTime = 1351524396889, correlationId = null, replyTo = null, persistent = false, type = Advisory, priority = 0, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = ConsumerInfo {commandId = 3, responseRequired = false, consumerId = ID:billing-35190-1351511867558-2:1304:-1:1, destination = queue://account_events, prefetchSize = 200, maximumPendingMessageLimit = 0, browser = false, dispatchAsync = true, selector = null, subscriptionName = null, noLocal = false, exclusive = false, retroactive = false, priority = 0, brokerPath = null, optimizedAcknowledge = false, noRangeAcks = false, additionalPredicate = null}, redeliveryCounter = 0, size = 1024, properties = {consumerCount=1, originBrokerURL=tcp://0.0.0.0:61616, originBrokerId=ID:billing-35190-1351511867558-0:1, originBrokerName=hub}, readOnlyProperties = false, readOnlyBody = false, droppable = false} | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ BrokerService[hub] Task-112\n2012-10-29 15:26:50,017 | DEBUG | queue://account_events expiring messages .. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:50,017 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:50,017 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ BrokerService[hub] Task-110\n2012-10-29 15:26:50,017 | DEBUG | queue://account_events expiring messages done. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:52,134 | DEBUG | queue://account_events expiring messages .. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:52,134 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n2012-10-29 15:26:52,134 | DEBUG | account_events toPageIn: 91, Inflight: 0, pagedInMessages.size 0, enqueueCount: 27041, dequeueCount: 26950 | org.apache.activemq.broker.region.Queue | ActiveMQ BrokerService[hub] Task-110\n2012-10-29 15:26:52,134 | DEBUG | queue://account_events expiring messages done. | org.apache.activemq.broker.region.Queue | ActiveMQ Broker[hub] Scheduler\n\nAround the time (cannot be certain, was not looking) of \"breakage\" a 10MB message was produced on this hub for consumption by each of the \"production servers\" via a topic. The heap memory rose from 100-200MB (normal) to 300-450MB at this point before levelling off around 200MB. The number of threads actually halved before rising to normal. It is unknown if this is a factor.\n\nEach \"production server\" correctly shows one consumer when it is connected from the hub.\n\nContinuing observations - restarting AMQ on the hub - a flood (7,000+) of messages have now arrived according to the web console and the consumer is racing through them. The production servers have cleared through their backlog having handed over to the hub.\n\nSome help isolating this with narrower debugging would be appreciated!\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":null,"customfield_12310921":null,"customfield_12310920":"75131","customfield_12312823":null,"summary":"Semi-stuck queue until server restart","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613918/comment/13486138","id":"13486138","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"body":"One of the dispatch servers is now queueing messages again without dequeueing to the hub. A grep of the debug logs on the hub shows that bridging information for the hub's account_events consumer is going to two of the production machines but not to the one where messages are spooling. This is confirmed by switching off the consumer: on the \"working\" production servers the consumer count for account_events drops from one to zero, but on the third production server the consumer count remains at one (now incorrect).\n\nLog on the incorrect production server shows (zorin is the faulty server, billing is an alias for our hub):\n\n2012-10-29 16:09:22,611 | WARN  | Caught an exception processing local command | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ BrokerService[zorin] Task-9560\njava.net.SocketException: Connection reset\n        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:113)\n        at java.net.SocketOutputStream.write(SocketOutputStream.java:153)\n        at sun.security.ssl.OutputRecord.writeBuffer(OutputRecord.java:314)\n        at sun.security.ssl.OutputRecord.write(OutputRecord.java:303)\n        at sun.security.ssl.SSLSocketImpl.writeRecordInternal(SSLSocketImpl.java:763)\n        at sun.security.ssl.SSLSocketImpl.writeRecord(SSLSocketImpl.java:751)\n        at sun.security.ssl.AppOutputStream.write(AppOutputStream.java:78)\n        at org.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedOutputStream.java:115)\n        at java.io.DataOutputStream.flush(DataOutputStream.java:123)\n        at org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:184)\n        at org.apache.activemq.transport.AbstractInactivityMonitor.doOnewaySend(AbstractInactivityMonitor.java:289)\n        at org.apache.activemq.transport.AbstractInactivityMonitor.oneway(AbstractInactivityMonitor.java:271)\n        at org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:85)\n        at org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:104)\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)\n        at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport.serviceLocalCommand(DemandForwardingBridgeSupport.java:726)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport$1.onCommand(DemandForwardingBridgeSupport.java:167)\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n        at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n        at org.apache.activemq.transport.vm.VMTransport.doDispatch(VMTransport.java:138)\n        at org.apache.activemq.transport.vm.VMTransport.dispatch(VMTransport.java:127)\n        at org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:104)\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)\n        at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\n        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1312)\n        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:838)\n        at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:873)\n        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:129)\n        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:47)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:636)\n2012-10-29 16:09:22,611 | INFO  | Network connection between vm://zorin#132 and ssl://hub/x.x.x.x:61617 shutdown due to a local error: java.net.SocketException: Connection reset | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ BrokerService[zorin] Task-9560\n\nThen eventually:\n2012-10-29 16:10:23,764 | INFO  | Establishing network connection from vm://zorin?async=false&network=true to ssl://hub:61617 | org.apache.activemq.network.DiscoveryNetworkConnector | ActiveMQ Task-31\n2012-10-29 16:10:23,765 | INFO  | Connector vm://zorin Started | org.apache.activemq.broker.TransportConnector | ActiveMQ Task-31\n2012-10-29 16:10:24,002 | INFO  | Network connection between vm://zorin#146 and ssl://hub/x.x.x.x:61617(hub) has been established. | org.apache.activemq.network.DemandForwardingBridgeSupport | StartLocalBridge: localBroker=vm://zorin#146\n\nThen, further down:\n2012-10-29 16:15:18,417 | WARN  | Transport Connection to: tcp://127.0.0.1:44832 failed: java.net.SocketException: Broken pipe | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ Transport: tcp:///127.0.0.1:44832@61612\n2012-10-29 16:15:33,982 | INFO  | Network connection between vm://zorin#146 and ssl://hub/x.x.x.x:61617 shutdown due to a local error: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (>30000) long: tcp://x.x.x.x:61617 | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ InactivityMonitor Worker\n2012-10-29 16:15:33,983 | WARN  | failed to deliver remove command for local subscription, for remote ID:billing-52716-1351526992068-2:12:-1:1 | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ BrokerService[zorin] Task-9720\norg.apache.activemq.transport.TransportDisposedIOException: Peer (vm://zorin#147) disposed.\n        at org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:89)\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)\n        at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\n        at org.apache.activemq.network.DemandForwardingBridgeSupport$8.run(DemandForwardingBridgeSupport.java:666)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:636)\n2012-10-29 16:15:33,983 | INFO  | Establishing network connection from vm://zorin?async=false&network=true to ssl://hub:61617 | org.apache.activemq.network.DiscoveryNetworkConnector | ActiveMQ Task-33\n2012-10-29 16:15:34,213 | INFO  | Network connection between vm://zorin#148 and ssl://hub/x.x.x.x:61617(hub) has been established. | org.apache.activemq.network.DemandForwardingBridgeSupport | StartLocalBridge: localBroker=vm://zorin#148\n2012-10-29 16:15:35,983 | INFO  | zorin bridge to hub stopped | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ BrokerService[zorin] Task-9739\n2012-10-29 16:18:44,191 | WARN  | Network connection between vm://zorin#148 and ssl://hub/x.x.x.x:61617 shutdown due to a remote error: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (>30000) long: tcp://x.x.x.x:61617 | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ InactivityMonitor Worker\n2012-10-29 16:18:44,191 | INFO  | Establishing network connection from vm://zorin?async=false&network=true to ssl://hub:61617 | org.apache.activemq.network.DiscoveryNetworkConnector | ActiveMQ Task-34\n2012-10-29 16:18:46,192 | INFO  | zorin bridge to hub stopped | org.apache.activemq.network.DemandForwardingBridgeSupport | ActiveMQ BrokerService[zorin] Task-9720\n2012-10-29 16:18:46,487 | INFO  | Network connection between vm://zorin#150 and ssl://hub/x.x.x.x:61617(hub) has been established. | org.apache.activemq.network.DemandForwardingBridgeSupport | StartLocalBridge: localBroker=vm://zorin#150\n\nThen this appears:\n2012-10-29 16:21:26,338 | WARN  | TopicSubscription: consumer=ID:quarrel-40451-1351260922652-79:2:1:1, destinations=707, dispatched=1000, delivered=19, matched=1001, discarded=0: has twice its prefetch limit pending, without an ack; it appears to be slow | org.apache.activemq.broker.region.TopicSubscription | ActiveMQ Transport: tcp:///127.0.0.1:41331@61612\n\nFollowing this repeated socket reset errors can be seen intermixed with other normal operations.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"created":"2012-10-29T16:48:37.479+0000","updated":"2012-10-29T16:48:37.479+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613918/comment/13503223","id":"13503223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"body":"Marking this resolved. We did two things to resolve our case:\n\n1. We increased the memory of the broker in the production network after learning that some messages could be large and translated across broker components\n\n2. We moved our hub from the end of a shared ADSL connection into the production network after noticing that transmission from hub to spokes maxed out the upload bandwidth for hours at a time upon the sending of a 10M message to a topic with three spokes listening.\n\nOther than better documentation and better exception messages I'm unsure what can prevent another incident of this nature in the future.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmkgreen","name":"jmkgreen","key":"jmkgreen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Green","active":true,"timeZone":"Europe/London"},"created":"2012-11-23T15:28:05.829+0000","updated":"2012-11-23T15:28:05.829+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4141/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0d8d3:"}}