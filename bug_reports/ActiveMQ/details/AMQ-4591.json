{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12653876","self":"https://issues.apache.org/jira/rest/api/2/issue/12653876","key":"AMQ-4591","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311210","id":"12311210","key":"AMQ","name":"ActiveMQ","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11160","id":"11160","description":"ActiveMQ","name":"ActiveMQ"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-07-05T13:28:05.051+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jul 08 14:22:04 UTC 2013","customfield_12310420":"334153","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1581220995_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-07-08T14:22:04.553+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4591/watchers","watchCount":2,"isWatching":false},"created":"2013-06-20T07:08:23.578+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["patch"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":3600,"aggregatetimeoriginalestimate":3600,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323282","id":"12323282","description":"Maintenance release with new AMQP support and smaller modules","name":"5.8.0","archived":false,"released":true,"releaseDate":"2013-02-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323932","id":"12323932","name":"5.9.0","archived":false,"released":true,"releaseDate":"2013-10-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-08T14:22:04.570+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313892","id":"12313892","name":"Broker"}],"timeoriginalestimate":3600,"customfield_12310080":null,"description":"There is a Bug on handle the once per minute case.\nFor the cronentry: \"* * * * *\" \nThe Next Scheduled time is not the top of the next minute.\nInstead, is the current Time plus 60 seconds\n\nThe problem is that the code is trying to set the precision at seconds, but the precision must have to be at minutes. \n\nYou can check the patch attached to see the change required to fix this issue.","customfield_10010":null,"timetracking":{"originalEstimate":"1h","remainingEstimate":"1h","originalEstimateSeconds":3600,"remainingEstimateSeconds":3600},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12588773","id":"12588773","filename":"CronParser.java.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfaro","name":"ralfaro","key":"ralfaro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rafael Alfaro","active":true,"timeZone":"America/El_Salvador"},"created":"2013-06-20T07:09:59.110+0000","size":670,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12588773/CronParser.java.patch"}],"aggregatetimeestimate":3600,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042"}],"customfield_12310921":null,"customfield_12310920":"334479","customfield_12312823":null,"summary":"CronParser bug on getNextScheduledTime to handle the once per minute case \"* * * * *\"","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfaro","name":"ralfaro","key":"ralfaro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rafael Alfaro","active":true,"timeZone":"America/El_Salvador"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfaro","name":"ralfaro","key":"ralfaro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rafael Alfaro","active":true,"timeZone":"America/El_Salvador"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":3600,"percent":0},"customfield_12311024":null,"environment":"Any","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":3600,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653876/comment/13688960","id":"13688960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfaro","name":"ralfaro","key":"ralfaro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rafael Alfaro","active":true,"timeZone":"America/El_Salvador"},"body":"Patch to handle the cronEntry \"* * * * *\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfaro","name":"ralfaro","key":"ralfaro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rafael Alfaro","active":true,"timeZone":"America/El_Salvador"},"created":"2013-06-20T07:09:59.112+0000","updated":"2013-06-20T07:09:59.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653876/comment/13700658","id":"13700658","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Can you link to appropriate documentation that states that the intended behavior of the \"* * * * *\" entry is current time + 60 seconds instead of the top of every minute. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-07-05T13:28:05.051+0000","updated":"2013-07-05T13:28:05.051+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653876/comment/13701630","id":"13701630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfaro","name":"ralfaro","key":"ralfaro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rafael Alfaro","active":true,"timeZone":"America/El_Salvador"},"body":"No, what I tried to mean, is that the current behaviour with the current code on SVN is that the next schedule time is the current time + 60 seconds for the pattern \"* * * * *\".\nBut the correct behaviour, must have to be, to calculate the top of the next minute.\n\nIf you look at the code:\nhttps://svn.apache.org/repos/asf/activemq/trunk/activemq-client/src/main/java/org/apache/activemq/broker/scheduler/CronParser.java\n\nThe issue is at the line 47:\n\n            result = result / 1000 * 1000;\n \nthe previous formula, sets the precision to \"seconds\", so, if the current time is 00:01:40, de next scheduled time will be 00:02:40\nThat is not correct, because the next scheduled time must have to be the top of the next minute.\nSo, to calculate the top of the next minute, the previous formula must have to be:\n\n            result = result / 60000 * 60000;\n\n\n\nThat is the why I proposed to following patch:\n\n\nIndex: activemq-client/src/main/java/org/apache/activemq/broker/scheduler/CronParser.java\n===================================================================\n--- activemq-client/src/main/java/org/apache/activemq/broker/scheduler/CronParser.java\t(revision 1494862)\n+++ activemq-client/src/main/java/org/apache/activemq/broker/scheduler/CronParser.java\t(working copy)\n@@ -44,7 +44,7 @@\n         // starting the next event at the top of the minute.\n         if (cronEntry.equals(\"* * * * *\")) {\n             result = currentTime + 60 * 1000;\n-            result = result / 1000 * 1000;\n+            result = result / 60000 * 60000;\n             return result;\n         }\n \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralfaro","name":"ralfaro","key":"ralfaro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rafael Alfaro","active":true,"timeZone":"America/El_Salvador"},"created":"2013-07-07T18:55:15.428+0000","updated":"2013-07-07T18:55:15.428+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653876/comment/13702020","id":"13702020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"body":"Fixed on trunk, thanks for the patch. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tabish121","name":"tabish121","key":"tabish121","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249"},"displayName":"Timothy Bish","active":true,"timeZone":"America/Havana"},"created":"2013-07-08T14:22:04.568+0000","updated":"2013-07-08T14:22:04.568+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/AMQ-4591/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ln53:"}}