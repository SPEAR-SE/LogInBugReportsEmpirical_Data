{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tabish121&avatarId=25249",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tabish121&avatarId=25249",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tabish121&avatarId=25249",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=tabish121&avatarId=25249"
            },
            "displayName": "Timothy Bish",
            "key": "tabish121",
            "name": "tabish121",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=tabish121",
            "timeZone": "America/Havana"
        },
        "components": [{
            "id": "12315706",
            "name": "stomp",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12315706"
        }],
        "created": "2013-09-02T12:21:57.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Andy Wilkinson",
            "key": "awilkinson",
            "name": "awilkinson",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=awilkinson",
            "timeZone": "Europe/London"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2013-09-03T21:05:39.541+0000",
        "customfield_12310222": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "2.0",
        "customfield_12310420": "346513",
        "customfield_12310920": "346814",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i1nr47:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Sep 24 15:18:20 UTC 2018",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "After ActiveMQ sends a stomp frame, it may not send a heart-beat for up to almost 2x the negotiated interval.\n\nThe following test should illustrate the problem:\n\n{code}\nimport org.junit.Test;\n\nimport static org.junit.Assert.*;\n\npublic class ActiveMqHeartbeatTests {\n\n\t@Test\n\tpublic void heartbeats() throws Exception {\n\t\tBrokerService broker = createAndStartBroker();\n\t\tSocket socket = null;\n\t\ttry {\n\t\t\tsocket = new Socket(\"localhost\", 61613);\n\t\t\tbyte[] connectFrame = \"CONNECT\\nheart-beat:0,10000\\naccept-version:1.2\\n\\n\\0\".getBytes();\n\t\t\tsocket.getOutputStream().write(connectFrame);\n\t\t\tbyte[] buffer = new byte[4096];\n\n\t\t\tlong lastReadTime = System.currentTimeMillis();\n\n\t\t\twhile (true) {\n\t\t\t\tint read = socket.getInputStream().read(buffer);\n\t\t\t\tbyte[] frame = Arrays.copyOf(buffer, read);\n\t\t\t\tlong now = System.currentTimeMillis();\n\t\t\t\tlong timeSinceLastRead = now - lastReadTime;\n\t\t\t\tlastReadTime = now;\n\t\t\t\tSystem.out.println(new String(frame));\n\t\t\t\tSystem.out.println(\"Time since last read: \" + timeSinceLastRead + \"ms\");\n\t\t\t\tif (timeSinceLastRead > 15000) {\n\t\t\t\t\tfail(\"Data not received for \" + timeSinceLastRead + \"ms\");\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tif (socket != null) {\n\t\t\t\tsocket.close();\n\t\t\t}\n\t\t\tbroker.stop();\n\t\t}\n\t}\n\n\tprivate BrokerService createAndStartBroker() throws Exception {\n\t\tBrokerService broker = new BrokerService();\n\t\tbroker.addConnector(\"stomp://localhost:61613\");\n\t\tbroker.setStartAsync(false);\n\t\tbroker.setDeleteAllMessagesOnStartup(true);\n\t\tbroker.start();\n\n\t\treturn broker;\n\t}\n\n}\n{code}\n\nFor the initial read of the CONNECTED frame I see:\n\n{noformat}\nTime since last read: 49ms\n{noformat}\n\nHowever, it's then almost 20 seconds before a heart-beat's sent:\n\n{noformat}\nTime since last read: 19994ms\n{noformat}\n\nIf I comment out the fail(\u2026) line in the test, after the first heartbeat taking almost 20000ms to be sent, things settle down and a heartbeat's received every 10000ms.\n\nIt looks like the write checker wakes up every 10000ms. The first time it wakes up, it notices that the CONNECTED frame was sent and does nothing. It then sleeps for a further 10000ms before checking again. As the CONNECTED frame was sent very early in the first 10000ms window, this leads to it taking almost 20000ms for the first heart-beat to be sent. From this point, as no further data frames are sent, the write checker wakes up and sends a heart-beat every 10000ms.\n\nIn short, I don't think ActiveMQ is adhering to the requirement that \"the sender MUST send new data over the network connection at least every <n> milliseconds\".",
        "duedate": null,
        "environment": null,
        "fixVersions": [{
            "archived": false,
            "description": "Next unplanned v5 maintenance release",
            "id": "12316331",
            "name": "5.x",
            "released": false,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12316331"
        }],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Andy Wilkinson",
            "key": "awilkinson",
            "name": "awilkinson",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=awilkinson",
            "timeZone": "Europe/London"
        },
        "resolution": null,
        "resolutiondate": null,
        "status": {
            "description": "The issue is open and ready for the assignee to start work on it.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
            "id": "1",
            "name": "Open",
            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
            "statusCategory": {
                "colorName": "blue-gray",
                "id": 2,
                "key": "new",
                "name": "To Do",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
            }
        },
        "subtasks": [],
        "summary": "The first heart-beat after a connection becomes idle isn't sent as quickly as it should be",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2018-09-24T15:18:20.000+0000",
        "versions": [{
            "archived": false,
            "description": "Maintenance release with new AMQP support and smaller modules",
            "id": "12323282",
            "name": "5.8.0",
            "releaseDate": "2013-02-11",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12323282"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-4710/votes",
            "votes": 4
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-4710/watchers",
            "watchCount": 6
        },
        "workratio": -1
    },
    "id": "12666575",
    "key": "AMQ-4710",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12666575"
}