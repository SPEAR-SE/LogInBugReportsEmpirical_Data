{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [
            {
                "id": "12313892",
                "name": "Broker",
                "self": "https://issues.apache.org/jira/rest/api/2/component/12313892"
            },
            {
                "id": "12325017",
                "name": "KahaDB",
                "self": "https://issues.apache.org/jira/rest/api/2/component/12325017"
            },
            {
                "id": "12313895",
                "name": "Message Store",
                "self": "https://issues.apache.org/jira/rest/api/2/component/12313895"
            }
        ],
        "created": "2017-04-26T09:00:07.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Vidyashree",
            "key": "vshree",
            "name": "vshree",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=vshree",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2017-04-26T12:04:19.864+0000",
        "customfield_12310222": "1_*:*_1_*:*_13169814595_*|*_6_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i3e4c7:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Sep 25 19:17:02 UTC 2017",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "ActiveMQ version: 5.11.0.redhat-620143\nA-MQ configuration in activemq.xml\n\t<bean id=\"persistenceAdapter\"\n\t\tclass=\"org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter\">\n\t\t<property name=\"directory\" value=\"${activemq.home}/${id}/jms/kahaDb\"/>\n\t\t<property name=\"enableJournalDiskSyncs\" value=\"false\" />\n\t\t<property name=\"journalMaxFileLength\" value=\"33554432\" />\n\t\t<property name=\"ignoreMissingJournalfiles\" value=\"true\"/>\n\t\t<property name=\"checkForCorruptJournalFiles\" value=\"true\"/>\n\t<\/bean>\n<bean id=\"brokerServices\"\n\t\tclass=\"org.apache.activemq.broker.BrokerService\">\n\t\t<description>AMQ Broker<\/description>\n\t\t<property name=\"dataDirectory\" value=\"${activemq.home}/${id}/jms\"/>\n\t\t<property name=\"systemUsage\" ref=\"systemUsage\" />\n\t\t<property name=\"persistenceAdapter\" ref=\"persistenceAdapter\" />\n\t\t<property name=\"managementContext\" ref=\"managementContext\" />\n\t\t<property name=\"destinationPolicy\" ref=\"destinationPolicy\"/>\n\t\t<property name=\"useShutdownHook\" value=\"false\"/>\n\t<\/bean>\n\nProblem description: \nDuring durable subscription removal, we are observing IO exceptions as below, and it is resulting in shutdown of the broker. And we also observe change in path of the kahadb location to the active-mq default location({$home}/activemq-data/activemq-instance1/KahaDB). It should have taken the configured location from activemq.xml\n\nStack trace from the EOFException :\n2017-04-11 04:56:01,640 org.apache.activemq.store.kahadb.MessageDatabase ERROR (MessageDatabase.java:store:1010) [CamelJettyServer(0x57063e08)-3734787] [3734787] | KahaDB failed to store to Journal\njava.io.EOFException\n\tat java.io.DataInputStream.readFully(Unknown Source)\n\tat java.io.DataInputStream.readLong(Unknown Source)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$StoredDestinationMarshaller.readPayload(MessageDatabase.java:1988)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$StoredDestinationMarshaller.readPayload(MessageDatabase.java:1910)\n\tat org.apache.activemq.store.kahadb.disk.index.BTreeNode$Marshaller.readPayload(BTreeNode.java:209)\n\tat org.apache.activemq.store.kahadb.disk.index.BTreeNode$Marshaller.readPayload(BTreeNode.java:155)\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction.load(Transaction.java:422)\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction.load(Transaction.java:377)\n\tat org.apache.activemq.store.kahadb.disk.index.BTreeIndex.loadNode(BTreeIndex.java:266)\n\tat org.apache.activemq.store.kahadb.disk.index.BTreeIndex.getRoot(BTreeIndex.java:174)\n\tat org.apache.activemq.store.kahadb.disk.index.BTreeIndex.remove(BTreeIndex.java:194)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.updateIndex(MessageDatabase.java:1469)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.updateIndex(MessageDatabase.java:1500)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$15.execute(MessageDatabase.java:1219)\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:1216)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$10.visit(MessageDatabase.java:1115)\n\tat org.apache.activemq.store.kahadb.data.KahaSubscriptionCommand.visit(KahaSubscriptionCommand.java:187)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:1082)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:989)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:969)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBTopicMessageStore.deleteSubscription(KahaDBStore.java:807)\n\tat org.apache.activemq.store.ProxyTopicMessageStore.deleteSubscription(ProxyTopicMessageStore.java:103)\n\tat org.apache.activemq.broker.region.Topic.deleteSubscription(Topic.java:201)\n\tat org.apache.activemq.broker.region.TopicRegion.removeSubscription(TopicRegion.java:220)\n\tat org.apache.activemq.broker.region.RegionBroker.removeSubscription(RegionBroker.java:448)\n\tat org.apache.activemq.broker.BrokerFilter.removeSubscription(BrokerFilter.java:117)\n\tat org.apache.activemq.advisory.AdvisoryBroker.removeSubscription(AdvisoryBroker.java:314)\n\tat org.apache.activemq.broker.BrokerFilter.removeSubscription(BrokerFilter.java:117)\n\tat org.apache.activemq.broker.BrokerFilter.removeSubscription(BrokerFilter.java:117)\n\tat org.apache.activemq.broker.MutableBrokerFilter.removeSubscription(MutableBrokerFilter.java:122)\n\tat org.apache.activemq.broker.jmx.BrokerView.destroyDurableSubscriber(BrokerView.java:449)\n\tat org.apache.camel.processor.DelegateSyncProcessor.process(DelegateSyncProcessor.java:63)\n\tat org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:398)\n\tat org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:191)\n\tat org.apache.camel.processor.Pipeline.process(Pipeline.java:118)\n\tat org.apache.camel.processor.Pipeline.process(Pipeline.java:80)\n\tat org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:191)\n\tat org.apache.camel.component.jetty.CamelContinuationServlet.service(CamelContinuationServlet.java:150)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1496)\n\tat org.eclipse.jetty.servlets.MultiPartFilter.doFilter(MultiPartFilter.java:131)\n\tat org.apache.camel.component.jetty.CamelFilterWrapper.doFilter(CamelFilterWrapper.java:43)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1467)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:499)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:428)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:370)\n\tat org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:494)\n\tat org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:982)\n\tat org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1043)\n\tat org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:865)\n\tat org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240)\n\tat org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n\tat org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:667)\n\tat org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n\tat java.lang.Thread.run(Unknown Source)\ninstance1 2017-04-11 04:56:01,646 org.apache.activemq.util.DefaultIOExceptionHandler  INFO (DefaultIOExceptionHandler.java:stopBroker:165) [CamelJettyServer(0x57063e08)-3734787] [3734787] | Stopping BrokerService[activemq-instance1] due to exception, java.io.EOFException\njava.io.EOFException\n\tat java.io.DataInputStream.readFully(Unknown Source)\n\tat java.io.DataInputStream.readLong(Unknown Source)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$StoredDestinationMarshaller.readPayload(MessageDatabase.java:1988)\n\t\n1. Why did ActiveMQ consider the default location for KahaDB (Mentioned in IOHelper and MessageDatabase classes of activemq) instead of the configured path during broker restart?\n2. When we restarted the system with the affected contents of kahaDB store, we found the below information from the active mq log\n\norg.apache.activemq.store.kahadb.MessageDatabase  WARN (MessageDatabase.java:open:382) [main] [1] | Index corrupted. Recovering the index through journal replay. Cause:java.io.EOFException\norg.apache.activemq.store.kahadb.MessageDatabase DEBUG (MessageDatabase.java:open:384) [main] [1] | Index load failure\n\t- What could be the cause of index corruption?\n\t- What happens if there is index corruption in the KahaDB store and system does not restart?\n\t- We did not see any issue with disk such as disk is unavailable of no more space on the disk. So, in these conditions, how did the corruption happened in the system?\nIs it related to https://issues.apache.org/jira/browse/AMQ-6086?\t",
        "duedate": null,
        "environment": null,
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/critical.svg",
            "id": "2",
            "name": "Critical",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/2"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Vidyashree",
            "key": "vshree",
            "name": "vshree",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=vshree",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "The problem is not completely described.",
            "id": "4",
            "name": "Incomplete",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/4"
        },
        "resolutiondate": "2017-09-25T19:17:02.000+0000",
        "status": {
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "id": "6",
            "name": "Closed",
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "IO exceptions causing Broker Service shutdown; When broker restarts, active-mq ignores the configured location for kahadb",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2017-09-25T19:17:02.000+0000",
        "versions": [{
            "archived": false,
            "id": "12324951",
            "name": "5.11.0",
            "releaseDate": "2015-02-04",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12324951"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6663/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6663/watchers",
            "watchCount": 3
        },
        "workratio": -1
    },
    "id": "13066990",
    "key": "AMQ-6663",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13066990"
}