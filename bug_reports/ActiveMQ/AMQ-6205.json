{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [{
            "id": "12313903",
            "name": "Transport",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313903"
        }],
        "created": "2016-03-09T20:18:59.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "David Johnson",
            "key": "swift99",
            "name": "swift99",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=swift99",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2016-03-09T20:21:38.764+0000",
        "customfield_12310222": "1_*:*_1_*:*_159649_*|*_6_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i2uf73:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Mar 09 20:21:38 UTC 2016",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "This is cross-posted at http://stackoverflow.com/questions/35896002/activemq-jms-losing-messages-what-am-i-missing\n\nWhat am I missing?  I am hoping this is a PICNIC error (Problem In Chair, Not In Computer), but if so I am not seeing how.\n\nGiven a simple test case, two Object messages are transmitted, one with data and the other being an end-of-data marker. Only the end-of-data marker is being received. This can be confirmed by looking at the message ID in the log.\n\nThe queue is created at the beginning of the job, and destroyed after the job completes.\n\nIf I run a larger number of transactions, I see about a 50% receive rate.\n\nThe logs clearly show that the receiver was started before the first message was put on the queue, both messages are being put on the queue, but only the second message is actually being received.\n\nBoth the sender and receiver are on the same JVM. Each has its own Session and Connection.\n\n\nTransmit code:\n\n    private void doSomeStuffInTransaction (final Object model) {\n        transactionTemplate.execute(new TransactionCallbackWithoutResult() {\n            @Override\n            protected void doInTransactionWithoutResult(TransactionStatus status) {\n                try {\n                    doSomeStuff ( model );\n\n                    ObjectMessage message = session.createObjectMessage(\n                            (model.getRoot() == null)\n                            ? null\n                            : model.getRoot().getContents().getId());\n                    messageProducer.send(message);\n                    logger.debug(\"Sent: {}\", message.toString());\n                }catch (Exception e) {\n                      //use this to rollback exception in case of exception\n                    status.setRollbackOnly();\n                    throw new RuntimeException(e.getmessage(), e);\n                }   \n\n            }});\n    }   \nReceiver code:\n\npublic Object read() throws Exception,\n        UnexpectedInputException, ParseException,\n        NonTransientResourceException {\n\n    Object result = null;\n\n    logger.debug(\"Attempting to receive message on connection: \", connection.toString());\n\n    ObjectMessage msg = (ObjectMessage) messageConsumer.receive();\n    logger.debug(\"Received: {}\", msg.toString());\n    result = msg.getObject();\n\n    return result;\n}\nLog snip:\n\nDEBUG com.mylib.SelectedDataJmsReader - Attempting to receive message on connection: \n... snip ...\nDEBUG com.mylib.SelectedDataJmsWriter - Sent: ActiveMQObjectMessage {commandId = 0, responseRequired = false, messageId = ID:zip-51438-1457536143607-4:1:5:1:1, originalDestination = null, originalTransactionId = null, producerId = null, destination = queue://Workorders via SQL.383, transactionId = null, expiration = 0, timestamp = 1457536412608, arrival = 0, brokerInTime = 0, brokerOutTime = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@3c21d3e0, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = null, readOnlyProperties = false, readOnlyBody = false, droppable = false, jmsXGroupFirstForConsumer = false}\nINFO  com.mylib.SelectedDataJmsWriter - Committed 1 hierarchies to redo log and JMS queue\nINFO  com.mylib.SourceSelectionReaderImpl - Returning empty treemodel and end-of-stream placeholder.\nDEBUG com.mylib.SelectedDataJmsWriter - Sent: ActiveMQObjectMessage {commandId = 0, responseRequired = false, messageId = ID:zip-51438-1457536143607-4:1:5:1:2, originalDestination = null, originalTransactionId = null, producerId = null, destination = queue://Workorders via SQL.383, transactionId = null, expiration = 0, timestamp = 1457536412696, arrival = 0, brokerInTime = 0, brokerOutTime = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = null, readOnlyProperties = false, readOnlyBody = false, droppable = false, jmsXGroupFirstForConsumer = false}\nINFO  com.mylib.SelectedDataJmsWriter - Committed 1 hierarchies to redo log and JMS queue\nDEBUG com.mylib.SelectedDataJmsReader - Received: ActiveMQObjectMessage {commandId = 19, responseRequired = true, messageId = ID:zip-51438-1457536143607-4:1:5:1:2, originalDestination = null, originalTransactionId = null, producerId = ID:zip-51438-1457536143607-4:1:5:1, destination = queue://Workorders via SQL.383, transactionId = null, expiration = 0, timestamp = 1457536412696, arrival = 0, brokerInTime = 1457536412696, brokerOutTime = 1457536412697, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1024, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, jmsXGroupFirstForConsumer = false}\nINFO  com.mylib.SelectedDataJmsReader - executed read, found end-of-stream marker, returning null",
        "duedate": null,
        "environment": "AMQ version is 5.13.2.\nJava 1.8.0_74\ntransportConnector uri=\"vm://localhost\"\nOS is Windows 10",
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "David Johnson",
            "key": "swift99",
            "name": "swift99",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=swift99",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "The problem isn't valid and it can't be fixed.",
            "id": "6",
            "name": "Invalid",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/6"
        },
        "resolutiondate": "2016-03-09T20:21:38.000+0000",
        "status": {
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "id": "6",
            "name": "Closed",
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "When two object messages are submitted to the queue, only the second message is ever read by the receiver",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2016-03-09T20:21:38.000+0000",
        "versions": [{
            "archived": false,
            "id": "12334774",
            "name": "5.13.2",
            "releaseDate": "2016-03-04",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12334774"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6205/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6205/watchers",
            "watchCount": 2
        },
        "workratio": -1
    },
    "id": "12948521",
    "key": "AMQ-6205",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12948521"
}