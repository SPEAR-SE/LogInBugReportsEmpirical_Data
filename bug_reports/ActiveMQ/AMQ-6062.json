{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "percent": 0,
            "progress": 0,
            "total": 86400
        },
        "aggregatetimeestimate": 86400,
        "aggregatetimeoriginalestimate": 86400,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=christopher.l.shannon&avatarId=24614",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=christopher.l.shannon&avatarId=24614",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=christopher.l.shannon&avatarId=24614",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=christopher.l.shannon&avatarId=24614"
            },
            "displayName": "Christopher L. Shannon",
            "key": "christopher.l.shannon",
            "name": "cshannon",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=cshannon",
            "timeZone": "America/New_York"
        },
        "components": [{
            "id": "12313892",
            "name": "Broker",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313892"
        }],
        "created": "2015-11-25T11:22:27.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Dumitru HUSLEAG",
            "key": "doomytroo",
            "name": "doomytroo",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=doomytroo",
            "timeZone": "Europe/Paris"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2015-11-25T18:43:13.605+0000",
        "customfield_12310222": "1_*:*_1_*:*_621410533_*|*_5_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "6.0",
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": "http://www-01.ibm.com/support/docview.wss?uid=swg1IZ73767",
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i2ox8f:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Dec 02 17:51:35 UTC 2015",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "Hello,\nThe Broker may enter a state of high CPU consumption (100% or 200% if 2 browse enter the infinite loop in the same time on a multi-core) when a command line browse on multiple queues is issued. When that arrives the only way we found to restore the situation was to kill the broker and restart because he was not responding anymore to clients. Killing the clients and the browse process does not lower the CPU usage of the broker.\nI assume the infinite loop based on successive thread dumps that show the browse thread remaines in the same code zone:\n\nHere is an example of the Browse thread call stack trace, when Broker is in high CPU usage state:\n{quote}\nat java/util/HashMap.rehash(HashMap.java:782(Compiled Code))\nat java/util/HashMap.rehash(HashMap.java:819(Compiled Code))\nat java/util/HashMap.putImpl(HashMap.java:702(Compiled Code))\nat java/util/HashMap.put(HashMap.java:680(Compiled Code))\nat org/apache/activemq/broker/region/*QueueBrowserSubscription.isDuplicate(QueueBrowserSubscription.java:72*(Compiled Code))\nat org/apache/activemq/broker/region/*Queue.iterate(Queue.java:1688*(Compiled Code))\nat org/apache/activemq/thread/PooledTaskRunner.runTask(PooledTaskRunner.java:133(Compiled Code)).\n{quote}\n\nTested ActiveMQ versions: 5.9.1 and the last, 5.12.0, but of course I suppose all in beetwen are affected.\n\nThe cause seems to be the non-threadsafe usage of the *audit HashMap* member of *QueueBrowserSubscription.java* class.\nHere are some facts on non thread-safe HashMap use problems:\n*High CPU / Hang on java.util.HashMap.findNonNullKeyEntry() due to non-thread-safe usage of HashMap*\nhttp://www-01.ibm.com/support/docview.wss?uid=swg21597581\n*IZ73767: INFINITE LOOP CAN OCCUR IN HASHMAP*\nhttp://www-01.ibm.com/support/docview.wss?uid=swg1IZ73767\n\nI must underline that *this is not an IBM JDK specific problem as the IBM JDK is based on Oracle JDK* and changing the JDK or JRE is not a solution.\n\nThe scenario may be produced with a fresh non modified install (default config) of ActiveMQ broker:\n1. set ACTIVEMQ_HOME, JAVA_HOME and PATH to point accordingly to the right activemq, and Java version.\n2. cd $ACTIVEMQ_HOME/bin; ./activemq start\n3. inject at least 2000 messages in each of two ques, say QA.ONE and QA.TWO\n4. $ $ACTIVEMQ_HOME/bin/activemq browse --view JMSDestination,JMSMessageID --amqurl tcp://localhost:61616 QA.*\n\nThe simplest fix that I suggest is to change in the *QueueBrowserSubscription.java* class the type of *audit* member to *ConcurrentHashMap*.",
        "duedate": null,
        "environment": "Linux Ubuntu, Aix, with both Java 6 and Java 7 (either IBM or Oracle)",
        "fixVersions": [
            {
                "archived": false,
                "id": "12333874",
                "name": "5.12.2",
                "releaseDate": "2016-01-11",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12333874"
            },
            {
                "archived": false,
                "id": "12334251",
                "name": "5.13.1",
                "releaseDate": "2016-02-05",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12334251"
            },
            {
                "archived": false,
                "id": "12334188",
                "name": "5.14.0",
                "releaseDate": "2016-08-05",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12334188"
            }
        ],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "percent": 0,
            "progress": 0,
            "total": 86400
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Dumitru HUSLEAG",
            "key": "doomytroo",
            "name": "doomytroo",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=doomytroo",
            "timeZone": "Europe/Paris"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2015-12-02T15:59:18.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "Broker goes 100% CPU on multi-queue command line browse",
        "timeestimate": 86400,
        "timeoriginalestimate": 86400,
        "timespent": null,
        "updated": "2015-12-02T17:51:35.000+0000",
        "versions": [
            {
                "archived": false,
                "id": "12326455",
                "name": "5.9.1",
                "releaseDate": "2014-04-04",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12326455"
            },
            {
                "archived": false,
                "id": "12329258",
                "name": "5.12.0",
                "releaseDate": "2015-08-13",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12329258"
            }
        ],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6062/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6062/watchers",
            "watchCount": 5
        },
        "workratio": 0
    },
    "id": "12916122",
    "key": "AMQ-6062",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12916122"
}