{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Gary Tully",
            "key": "gtully",
            "name": "gtully",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=gtully",
            "timeZone": "Etc/UTC"
        },
        "components": [{
            "id": "12325017",
            "name": "KahaDB",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12325017"
        }],
        "created": "2015-10-09T08:02:46.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Volker Kleinschmidt",
            "key": "volkerk",
            "name": "volkerk",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=volkerk",
            "timeZone": "America/Chicago"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2015-10-12T13:27:18.533+0000",
        "customfield_12310222": "1_*:*_1_*:*_5379837368_*|*_5_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i2mswf:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Dec 10 15:52:52 UTC 2015",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "h4. Background\n\nWhen multiple JVMs run AMQ in a master/slave configuration with the broker directory in a shared filesystem location (as is required e.g. for kahaPersistence), and when due to high message volume or slow producers the broker's memory needs exceed the configured memory usage limit, AMQ will overflow asynchronous messages to a PList store inside the \"tmp_storage\" subdirectory of said shared broker directory.\n\nh4. Issue\n\nWe frequently observed this tmpDB store getting corrupted with \"stale NFS filehandle\" errors for tmpDB.data, tmpDB.redo, and some journal files, all of which suddenly went missing from the tmp_storage folder. This puts the entire broker into a bad state from which it cannot recover. Only restarting the service (which causes a broker slave to take over and loses the yet-undelivered messages) gets a working state back.\n\nh4. Symptoms\n\nStack trace:\n{noformat}\n...\nCaused by: java.io.IOException: Stale file handle\n\tat java.io.RandomAccessFile.readBytes0(Native Method)\n\tat java.io.RandomAccessFile.readBytes(RandomAccessFile.java:350)\n\tat java.io.RandomAccessFile.read(RandomAccessFile.java:385)\n\tat java.io.RandomAccessFile.readFully(RandomAccessFile.java:444)\n\tat java.io.RandomAccessFile.readFully(RandomAccessFile.java:424)\n\tat org.apache.kahadb.page.PageFile.readPage(PageFile.java:876)\n\tat org.apache.kahadb.page.Transaction$2.readPage(Transaction.java:446)\n\tat org.apache.kahadb.page.Transaction$2.<init>(Transaction.java:437)\n\tat org.apache.kahadb.page.Transaction.openInputStream(Transaction.java:434)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:410)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:367)\n\tat org.apache.kahadb.index.ListIndex.loadNode(ListIndex.java:306)\n\tat org.apache.kahadb.index.ListIndex.getHead(ListIndex.java:99)\n\tat org.apache.kahadb.index.ListIndex.iterator(ListIndex.java:284)\n\tat org.apache.activemq.store.kahadb.plist.PList$PListIterator.<init>(PList.java:199)\n\tat org.apache.activemq.store.kahadb.plist.PList.iterator(PList.java:189)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor$DiskIterator.<init>(FilePendingMessageCursor.java:496)\n{noformat}\n\nh4. Cause\n\nDuring BrokerThread startup, the BrokerService.startPersistenceAdapter() method is called, which  via doStartPersistenceAdapter() and getProducerSystemUsage() invokes getSystemUsage(), that calls getTempDataStore(), and that method summarily cleans out the existing contents of the tmp_storage directory.\nAll of this happens *before* the broker lock is obtained in the PersistenceAdapter.start() method at the end of doStartPersistenceAdapter().\n\nSo a JVM that doesn't get to be the broker (because there already is one) and runs in slave mode (waiting to obtain the broker lock) interferes with and corrupts the running broker's tmp_storage and thus breaks the broker. That's a critical bug. The slave has no business starting up the persistence adapter and cleaning out data as it hasn't gotten the lock yet, so isn't allowed to do any work, period. \n\nh4. Workaround\n\nAs workaround, an unshared local directory needs to be specified as tempDirectory for the broker, even if the main broker directory is shared. Also, since broker startup will clear the tmp_storage out anyway, there really is no advantage to having this in a shared location - since the next broker that starts up after a broker failure will never re-use that data anyway.",
        "duedate": null,
        "environment": "RHLinux6",
        "fixVersions": [
            {
                "archived": false,
                "id": "12334251",
                "name": "5.13.1",
                "releaseDate": "2016-02-05",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12334251"
            },
            {
                "archived": false,
                "id": "12334188",
                "name": "5.14.0",
                "releaseDate": "2016-08-05",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12334188"
            }
        ],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Volker Kleinschmidt",
            "key": "volkerk",
            "name": "volkerk",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=volkerk",
            "timeZone": "America/Chicago"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2015-12-10T14:26:43.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "Slave broker startup corrupts shared PList storage",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2015-12-10T15:52:52.000+0000",
        "versions": [
            {
                "archived": false,
                "description": "Next v5 maintenance release",
                "id": "12321258",
                "name": "5.7.0",
                "releaseDate": "2012-10-08",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12321258"
            },
            {
                "archived": false,
                "id": "12324950",
                "name": "5.10.0",
                "releaseDate": "2014-06-10",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12324950"
            }
        ],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6005/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6005/watchers",
            "watchCount": 5
        },
        "workratio": -1
    },
    "id": "12903653",
    "key": "AMQ-6005",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12903653"
}