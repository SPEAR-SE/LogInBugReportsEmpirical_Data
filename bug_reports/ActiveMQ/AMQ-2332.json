{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rajdavies&avatarId=13942",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rajdavies&avatarId=13942",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rajdavies&avatarId=13942",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=rajdavies&avatarId=13942"
            },
            "displayName": "Rob Davies",
            "key": "rajdavies",
            "name": "rajdavies",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=rajdavies",
            "timeZone": "Etc/UTC"
        },
        "components": [{
            "id": "12313892",
            "name": "Broker",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313892"
        }],
        "created": "2009-07-27T22:28:00.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Mats Henrikson",
            "key": "zakalwe",
            "name": "zakalwe",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zakalwe",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2010-07-11T17:59:23.344+0000",
        "customfield_12310222": "1_*:*_1_*:*_30137482416_*|*_5_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310420": "74978",
        "customfield_12310920": "159865",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i0rq1z:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Sun Jul 11 23:46:19 UTC 2010",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "Hi,\n\nWe have found a deadlock in ActiveMQ 5.2. It's possible that we may be causing it by a multi-threading problem in the client, we are currently looking into this. However, I feel that this is still a bug in the broker since it shouldn't be possible to deadlock the broker by incorrect use of the client.\n\nThe situation is that we have two clients connected to the broker, one over TCP using the Java library, and one connecting over SSL (our own implementation, this may also be involved in creating the problem) using the NMS library in .NET. \n\nThe Java client connects fine and subscribes to some topics and queues and starts sending messages to the topics. The NMS client connects and attempts to connect to some of the same topics, as well as creating a temporary queue. As it is doing this initial setup stuff it hangs and goes no further. From this point I don't think any more messages get delivered on the topic, and Java clients trying to send messages to it hang on the producers send() call indefinitely.\n\nThe deadlock appears to occur because a thread is stuck actually writing data back to the NMS client (the bottom stack trace below), another thread (originating from the Java client) is trying to acquire the write lock so that it too can write to the client (middle stack trace) while still owning a lock on the list of consumers of a topic, meanwhile a third thread (this one origination from the NMS client again) is trying to get that lock on the list of consumers in order to add to it (top stack trace). For some reason the first thread trying to write to the NMS client never finishes, even when the NMS client is killed, and so the lock is never released and everything involving that topic grinds to a halt. \n\nI have looked but haven't been able to find anybody else reporting this issue.\n\nI enabled JMX as well as debug mode and got the following stack traces from jconsole, and tracked down the locks involved in the deadlock using a debugger:\n\n\nName: ActiveMQ Transport: ssl:///10.247.39.150:59759\nState: BLOCKED on java.util.concurrent.CopyOnWriteArrayList@509c6c30 owned by: ActiveMQ Transport: tcp:///192.168.32.73:45666\nStack trace: \norg.apache.activemq.broker.region.Topic.addSubscription(Topic.java:147)\norg.apache.activemq.broker.region.AbstractRegion.addConsumer(AbstractRegion.java:275)\norg.apache.activemq.broker.region.TopicRegion.addConsumer(TopicRegion.java:108)\norg.apache.activemq.broker.region.RegionBroker.addConsumer(RegionBroker.java:375)\norg.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:86)\norg.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:86)\norg.apache.activemq.advisory.AdvisoryBroker.addConsumer(AdvisoryBroker.java:83)\norg.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:86)\norg.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:86)\norg.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:86)\norg.apache.activemq.security.AuthorizationBroker.addConsumer(AuthorizationBroker.java:138)\norg.apache.activemq.broker.MutableBrokerFilter.addConsumer(MutableBrokerFilter.java:93)\norg.apache.activemq.broker.TransportConnection.processAddConsumer(TransportConnection.java:541)\norg.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:345)\norg.apache.activemq.broker.TransportConnection.service(TransportConnection.java:305)\norg.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)\norg.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\norg.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)\norg.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)\norg.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\norg.apache.activemq.transport.tcp.SslTransport.doConsume(SslTransport.java:104)\norg.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)\norg.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)\njava.lang.Thread.run(Thread.java:595)\n\n\nCopyOnWriteArrayList@509c6c30 lock acquired at org.apache.activemq.broker.region.policy.SimpleDispatchPolicy.dispatch(SimpleDispatchPolicy.java:49) below:\n\nName: ActiveMQ Transport: tcp:///192.168.32.73:45666\nState: BLOCKED on java.lang.Object@58c1c2f1 owned by: TempQueue:  c34c73c1-d2e9-41f3-89a6-82f2c59ca62b:1\nStack trace: \norg.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:39)\norg.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1207)\norg.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:793)\norg.apache.activemq.broker.TransportConnection.dispatchSync(TransportConnection.java:752)\norg.apache.activemq.broker.region.TopicSubscription.dispatch(TopicSubscription.java:427)\norg.apache.activemq.broker.region.TopicSubscription.add(TopicSubscription.java:90)\norg.apache.activemq.broker.region.policy.SimpleDispatchPolicy.dispatch(SimpleDispatchPolicy.java:49)\norg.apache.activemq.broker.region.Topic.dispatch(Topic.java:580)\norg.apache.activemq.broker.region.Topic.doMessageSend(Topic.java:427)\norg.apache.activemq.broker.region.Topic.send(Topic.java:365)\norg.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:350)\norg.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:437)\norg.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:224)\norg.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:126)\norg.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:95)\norg.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:126)\norg.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:126)\norg.apache.activemq.security.AuthorizationBroker.send(AuthorizationBroker.java:184)\norg.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:133)\norg.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:450)\norg.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:639)\norg.apache.activemq.broker.TransportConnection.service(TransportConnection.java:305)\norg.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)\norg.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\norg.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)\norg.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)\norg.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\norg.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)\norg.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)\njava.lang.Thread.run(Thread.java:595)\n\n\nObject@58c1c2f1 lock acquired at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40) below:\n\nName: TempQueue:  c34c73c1-d2e9-41f3-89a6-82f2c59ca62b:1\nState: RUNNABLE\nTotal blocked: 55  Total waited: 11\nStack trace: \njava.net.SocketOutputStream.socketWrite0(Native Method)\njava.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\njava.net.SocketOutputStream.write(SocketOutputStream.java:136)\ncom.sun.net.ssl.internal.ssl.OutputRecord.writeBuffer(OutputRecord.java:295)\ncom.sun.net.ssl.internal.ssl.OutputRecord.write(OutputRecord.java:284)\ncom.sun.net.ssl.internal.ssl.SSLSocketImpl.writeRecordInternal(SSLSocketImpl.java:727)\ncom.sun.net.ssl.internal.ssl.SSLSocketImpl.writeRecord(SSLSocketImpl.java:715)\ncom.sun.net.ssl.internal.ssl.AppOutputStream.write(AppOutputStream.java:59)\norg.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedOutputStream.java:115)\njava.io.DataOutputStream.flush(DataOutputStream.java:106)\norg.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:167)\norg.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:233)\norg.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:83)\norg.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:100)\norg.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\norg.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1207)\norg.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:793)\norg.apache.activemq.broker.TransportConnection.dispatchSync(TransportConnection.java:752)\norg.apache.activemq.broker.region.PrefetchSubscription.dispatch(PrefetchSubscription.java:640)\norg.apache.activemq.broker.region.PrefetchSubscription.dispatchPending(PrefetchSubscription.java:588)\norg.apache.activemq.broker.region.PrefetchSubscription.add(PrefetchSubscription.java:150)\norg.apache.activemq.broker.region.Queue.doActualDispatch(Queue.java:1266)\norg.apache.activemq.broker.region.Queue.doDispatch(Queue.java:1223)\norg.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1308)\norg.apache.activemq.broker.region.Queue.iterate(Queue.java:1011)\norg.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\norg.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\n\nLet me know if I can do anything else to help.\n\n--\nMats Henrikson\nSoftware Engineer\nSunGard Kiodex\n",
        "duedate": null,
        "environment": null,
        "fixVersions": [{
            "archived": false,
            "description": "version 5 feature complete",
            "id": "12315623",
            "name": "5.4.0",
            "releaseDate": "2010-08-17",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315623"
        }],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Mats Henrikson",
            "key": "zakalwe",
            "name": "zakalwe",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zakalwe",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2010-07-11T17:59:23.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "it's possible to cause a deadlock in ActiveMQ 5.2 using the client",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2010-07-11T23:46:19.000+0000",
        "versions": [{
            "archived": false,
            "description": "",
            "id": "12315619",
            "name": "5.2.0",
            "releaseDate": "2008-11-20",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315619"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-2332/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-2332/watchers",
            "watchCount": 2
        },
        "workratio": -1
    },
    "id": "12482320",
    "key": "AMQ-2332",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12482320"
}