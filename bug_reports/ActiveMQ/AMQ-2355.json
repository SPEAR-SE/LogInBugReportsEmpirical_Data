{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [{
            "id": "12313893",
            "name": "Connector",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313893"
        }],
        "created": "2009-08-17T11:51:22.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Cedric Neve",
            "key": "cedneve",
            "name": "cedneve",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=cedneve",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2009-08-17T16:49:05.956+0000",
        "customfield_12310222": "1_*:*_1_*:*_99278251426_*|*_6_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "4.0",
        "customfield_12310420": "43792",
        "customfield_12310920": "41062",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i07e67:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Oct 09 13:08:53 UTC 2012",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "I am doing ActiveMQ validation tests for our client and we have encountered a bug that prevents us from using it with Weblogic. The issue concerns the XA support of ActiveMQ within that application server. With JBoss, the same test succeeded so this is more an integration problem of the RA with Weblogic than a real bug with the connector.\n\nI will attach the test project but here is the scenario:\n1) A message is sent to testQueue4 (that is hosted by an ActiveMQ broker).\n2) An MDB, deployed within Weblogic and listening on the queue through the connector (and the deployment descriptors of the ejb), receives the message and starts processing it within a transaction ( <transaction-type>Container<\/transaction-type>, <trans-attribute>Required<\/trans-attribute>).\n3) The processing implies the sending of a message on testQueue5 that is configured within the weblogic-ra.xml and through a ConnectionFactory that is also configured in that file (and accessed through the EJB local references).\n4) The send fails with the following stacktrace:\njavax.jms.JMSException: [JMSPool:169822]Unable to use a wrapped JMS session in the transaction because two-phase commit is not available\n\tat weblogic.deployment.jms.JMSExceptions.getJMSException(JMSExceptions.java:22)\n\tat weblogic.deployment.jms.WrappedTransactionalSession.enlistInExistingTransaction(WrappedTransactionalSession.java:153)\n\tat weblogic.deployment.jms.WrappedTransactionalSession.enlistInTransaction(WrappedTransactionalSession.java:206)\n\tat weblogic.deployment.jms.WrappedMessageProducer.send(WrappedMessageProducer.java:136)\n\tat be.fgov.minfin.ccff.fwk.application.SendingMDB.sendJMS(SendingMDB.java:77)\n\tat be.fgov.minfin.ccff.fwk.application.SendingMDB.onMessage(SendingMDB.java:36)\n\tat be.fgov.minfin.ccff.fwk.application.SendingMDB_7x60v6_MDOImpl.onMessage(SendingMDB_7x60v6_MDOImpl.java:49)\n\tat org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.onMessage(MessageEndpointProxy.java:123)\n\tat org.apache.activemq.ra.MessageEndpointProxy.onMessage(MessageEndpointProxy.java:64)\n\tat org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:766)\n\tat org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:169)\n\tat weblogic.connector.security.layer.WorkImpl.runIt(WorkImpl.java:108)\n\tat weblogic.connector.security.layer.WorkImpl.run(WorkImpl.java:44)\n\tat weblogic.connector.work.WorkRequest.run(WorkRequest.java:95)\n\tat weblogic.work.SelfTuningWorkManagerImpl$WorkAdapterImpl.run(SelfTuningWorkManagerImpl.java:516)\n\tat weblogic.work.ExecuteThread.execute(ExecuteThread.java:201)\n\tat weblogic.work.ExecuteThread.run(ExecuteThread.java:173)\n\nI am in contact with Fuse support and Oracle support about this case but we are stuck at the moment and no one seems to be able to fix this. So this is a cry out to the community to help us solve this issue and getter a better Weblogic support of ActiveMQ.\n\nI will reproduce this with 5.2 (ActiveMQ version, not Fuse) and will post a comment about that as soon as it is done. I do not think it is Fuse specific at this time.\n\nHere is what I figured out so far:\n- When using EJB local references, the elements that are accessed (in this case the connection factory and the queue) should be enlisted in the transaction (hence the elistInExistingTransaction method call in the stacktrace).\n- This also happens when we are using a Foreign JNDI server to make the outbound connections to ActiveMQ instead of the weblogic-ra.xml.\n- Based on what the Oracle support told us, in debug mode, they saw that the are retrieving ActiveMQConnectionFactory instance and not an ActiveMQXAConnectionFactory instance. This would confirm that the XA support is not present for the Connection Factory returned by the Connector.\n\nSo, to fix this, we would wish to know how we could instruct the connector to return an XA connection factory instead of the basic connection factory. It seems that the problem is not only present for sending but is also present for reception:\n1) Send a message to testQueue2\n2) The message is received on an MDB deployed within WL 10.3.1 with transaction support and using local EJB references\n3) We through a RuntimeException in the onMessage() to test the rollback and receive the following exception (which is fine for us):\n13:47:29,756 ERROR [ActiveMQSession] error dispatching message: \njavax.ejb.EJBException: Unexpected exception in be.fgov.minfin.ccff.fwk.application.ReceptionRollbackToDLQMDB.onMessage():\njava.lang.RuntimeException: Rollback to DLQ test\n\tat be.fgov.minfin.ccff.fwk.application.ReceptionRollbackToDLQMDB.onMessage(ReceptionRollbackToDLQMDB.java:23)\n\tat be.fgov.minfin.ccff.fwk.application.ReceptionRollbackToDLQMDB_dz4wsg_MDOImpl.onMessage(ReceptionRollbackToDLQMDB_dz4wsg_MDOImpl.java:49)\n\tat org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.onMessage(MessageEndpointProxy.java:123)\n\tat org.apache.activemq.ra.MessageEndpointProxy.onMessage(MessageEndpointProxy.java:64)\n\tat org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:766)\n\tat org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:169)\n\tat weblogic.connector.security.layer.WorkImpl.runIt(WorkImpl.java:108)\n\tat weblogic.connector.security.layer.WorkImpl.run(WorkImpl.java:44)\n\tat weblogic.connector.work.WorkRequest.run(WorkRequest.java:95)\n\tat weblogic.work.SelfTuningWorkManagerImpl$WorkAdapterImpl.run(SelfTuningWorkManagerImpl.java:516)\n\tat weblogic.work.ExecuteThread.execute(ExecuteThread.java:201)\n\tat weblogic.work.ExecuteThread.run(ExecuteThread.java:173)\n; nested exception is: java.lang.RuntimeException: Rollback to DLQ test\njava.lang.RuntimeException: Rollback to DLQ test\n\tat be.fgov.minfin.ccff.fwk.application.ReceptionRollbackToDLQMDB.onMessage(ReceptionRollbackToDLQMDB.java:23)\n\tat be.fgov.minfin.ccff.fwk.application.ReceptionRollbackToDLQMDB_dz4wsg_MDOImpl.onMessage(ReceptionRollbackToDLQMDB_dz4wsg_MDOImpl.java:49)\n\tat org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.onMessage(MessageEndpointProxy.java:123)\n\tat org.apache.activemq.ra.MessageEndpointProxy.onMessage(MessageEndpointProxy.java:64)\n\tat org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:766)\n\tat org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:169)\n\tat weblogic.connector.security.layer.WorkImpl.runIt(WorkImpl.java:108)\n\tat weblogic.connector.security.layer.WorkImpl.run(WorkImpl.java:44)\n\tat weblogic.connector.work.WorkRequest.run(WorkRequest.java:95)\n\tat weblogic.work.SelfTuningWorkManagerImpl$WorkAdapterImpl.run(SelfTuningWorkManagerImpl.java:516)\n\tat weblogic.work.ExecuteThread.execute(ExecuteThread.java:201)\n\tat weblogic.work.ExecuteThread.run(ExecuteThread.java:173)\njavax.ejb.EJBException: Unexpected exception in be.fgov.minfin.ccff.fwk.application.ReceptionRollbackToDLQMDB.onMessage():\njava.lang.RuntimeException: Rollback to DLQ test\n\tat be.fgov.minfin.ccff.fwk.application.ReceptionRollbackToDLQMDB.onMessage(ReceptionRollbackToDLQMDB.java:23)\n\tat be.fgov.minfin.ccff.fwk.application.ReceptionRollbackToDLQMDB_dz4wsg_MDOImpl.onMessage(ReceptionRollbackToDLQMDB_dz4wsg_MDOImpl.java:49)\n\tat org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.onMessage(MessageEndpointProxy.java:123)\n\tat org.apache.activemq.ra.MessageEndpointProxy.onMessage(MessageEndpointProxy.java:64)\n\tat org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:766)\n\tat org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:169)\n\tat weblogic.connector.security.layer.WorkImpl.runIt(WorkImpl.java:108)\n\tat weblogic.connector.security.layer.WorkImpl.run(WorkImpl.java:44)\n\tat weblogic.connector.work.WorkRequest.run(WorkRequest.java:95)\n\tat weblogic.work.SelfTuningWorkManagerImpl$WorkAdapterImpl.run(SelfTuningWorkManagerImpl.java:516)\n\tat weblogic.work.ExecuteThread.execute(ExecuteThread.java:201)\n\tat weblogic.work.ExecuteThread.run(ExecuteThread.java:173)\n; nested exception is: java.lang.RuntimeException: Rollback to DLQ test\n\tat be.fgov.minfin.ccff.fwk.application.ReceptionRollbackToDLQMDB_dz4wsg_MDOImpl.onMessage(ReceptionRollbackToDLQMDB_dz4wsg_MDOImpl.java:93)\n\tat org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.onMessage(MessageEndpointProxy.java:123)\n\tat org.apache.activemq.ra.MessageEndpointProxy.onMessage(MessageEndpointProxy.java:64)\n\tat org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:766)\n\tat org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:169)\n\tat weblogic.connector.security.layer.WorkImpl.runIt(WorkImpl.java:108)\n\tat weblogic.connector.security.layer.WorkImpl.run(WorkImpl.java:44)\n\tat weblogic.connector.work.WorkRequest.run(WorkRequest.java:95)\n\tat weblogic.work.SelfTuningWorkManagerImpl$WorkAdapterImpl.run(SelfTuningWorkManagerImpl.java:516)\n\tat weblogic.work.ExecuteThread.execute(ExecuteThread.java:201)\n\tat weblogic.work.ExecuteThread.run(ExecuteThread.java:173)\n4) The message is not redelivered even though the default behaviour is documented as provoking 5 deliveries before sending the message to the DLQ. Here, the message seems to be acknowledged just as if the message reception was not in a transaction.\n\nWe are not using the \"useRAManagedTransaction\" activation config property since we want the transaction to be container managed.\n\nI will attach the MDB project and the weblogic-ra.xml for this case to be reproductible.",
        "duedate": null,
        "environment": "Weblogic 10.3.1 (aka Oracle 11g), ActiveMQ 5.2.0 and Fuse ActiveMQ 5.3.0.2, ActiveMQ 5.2.0 and Fuse ActiveMQ 5.3.0.2 connector, Ubuntu 9.04",
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Cedric Neve",
            "key": "cedneve",
            "name": "cedneve",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=cedneve",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "The described issue is not actually a problem - it is as designed.",
            "id": "8",
            "name": "Not A Problem",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/8"
        },
        "resolutiondate": "2012-10-09T13:08:53.000+0000",
        "status": {
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "id": "6",
            "name": "Closed",
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "Sending a message from an MDB in Weblogic 10.3.1: \"Unable to use a wrapped JMS session in the transaction because two-phase commit is not available\"",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2012-10-09T13:08:53.000+0000",
        "versions": [{
            "archived": false,
            "description": "",
            "id": "12315620",
            "name": "5.3.0",
            "releaseDate": "2009-10-13",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315620"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-2355/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-2355/watchers",
            "watchCount": 5
        },
        "workratio": -1
    },
    "id": "12483610",
    "key": "AMQ-2355",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12483610"
}