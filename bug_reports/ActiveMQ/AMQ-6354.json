{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [
            {
                "id": "12313892",
                "name": "Broker",
                "self": "https://issues.apache.org/jira/rest/api/2/component/12313892"
            },
            {
                "id": "12325017",
                "name": "KahaDB",
                "self": "https://issues.apache.org/jira/rest/api/2/component/12325017"
            },
            {
                "id": "12313895",
                "name": "Message Store",
                "self": "https://issues.apache.org/jira/rest/api/2/component/12313895"
            }
        ],
        "created": "2016-07-13T06:43:54.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Rajagopal",
            "key": "rajagopal",
            "name": "Rajagopal",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=Rajagopal",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2016-07-13T14:04:55.927+0000",
        "customfield_12310222": "1_*:*_1_*:*_478698185_*|*_6_*:*_1_*:*_0",
        "customfield_12310250": [{
            "id": "10431",
            "self": "https://issues.apache.org/jira/rest/api/2/customFieldOption/10431",
            "value": "Important"
        }],
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i30wef:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Jul 18 19:42:11 UTC 2016",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "AMQ Configuration:\n1.\tKahaDb Persistence store\n2.\tTopics and Queues destination are configured.\n3.\tDurable Subscribers configured (added/removed) dynamically (All added subscribers will be active) for Topic destination. \n\nIssue:\n\n\u2022\tNearly ~20 Durable Subscriber added/deleted to a particular destination dynamically.\n\u2022\tAfter configuration, Once the message are sent to the Topic, the messages are consumed and Acknowledged by each subscribers.\n\u2022\tThere were 249 Subscribers and we could see from Journal file that all subscribers acknowledged.\n\u2022\tIn JMX logs after message is sent the below entries are observed for yyyy destination, \no\tConsumer Count is 249\no\tIn-Flight Count is 0\no\tDispatch count is matching with the consumer count (messages * Consumer count)\n\n\u2022\tWe enabled kahaDB TRACE logs and it clearly points out that for a particular Topic destination the journal files could not be gc collected\n\nSnippet of activemq.log\n\n----------------------------------------------\n2016-06-30 01:41:43,980 org.apache.activemq.store.kahadb.MessageDatabase TRACE (MessageDatabase.java:checkpointUpdate:1413) [ActiveMQ Journal Checkpoint Worker] [24] | gc candidates after dest:0:xxxxx, [8066, 8067, ...........]\n\n2016-06-30 01:41:43,980 org.apache.activemq.store.kahadb.MessageDatabase TRACE (MessageDatabase.java:checkpointUpdate:1413) [ActiveMQ Journal Checkpoint Worker] [24] | gc candidates after dest:1:yyyy, [8067, 8073, ............]\n--------------------------------------------\n\n\u2022\tAfter analyzing the 8066 file, we understood that 8066 has one message for yyyy Topic destination and 249 ACk\u2019s in the same file. But Checkpoint cleanup could not remove the file. So this pattern followed and all the files containing the yyyy destination messages are not removed, which leads to journal files pile-up.\n\nWorkaround :\n\n\u2022\tAs a work around, first we restarted the process but still the files were not cleaned up.\n\u2022\tSecondly,  we stopped the process, removed the index (db.data) file and restarted. Now all the files are cleaned up.\n\u2022\tBy above workaround, we suspect that index file is corrupted, which is causing the journal pile up. \n\u2022\tOur question, \no\tif index file is corrupted, what is the reason for corruption?\no\tIs there any bug in the 5.5.1 version of AMQ regarding index file corruption for Durable Subscription?\n\nThis is sporadic issue and not reproducible always. (Not always Dynamic Subscription configuration leads to journal pile up)\n",
        "duedate": null,
        "environment": "Linux",
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [
            "activemq",
            "broker",
            "kahaDB",
            "messagestore"
        ],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Rajagopal",
            "key": "rajagopal",
            "name": "Rajagopal",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=Rajagopal",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.",
            "id": "5",
            "name": "Cannot Reproduce",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/5"
        },
        "resolutiondate": "2016-07-18T19:42:11.000+0000",
        "status": {
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "id": "6",
            "name": "Closed",
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "KahaDb journal file piling up because of Durable subscriber destination",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2016-07-18T19:42:12.000+0000",
        "versions": [{
            "archived": false,
            "id": "12318549",
            "name": "5.5.1",
            "releaseDate": "2011-10-16",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12318549"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6354/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6354/watchers",
            "watchCount": 4
        },
        "workratio": -1
    },
    "id": "12989011",
    "key": "AMQ-6354",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12989011"
}