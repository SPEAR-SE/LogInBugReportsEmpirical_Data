{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [{
            "id": "12313895",
            "name": "Message Store",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313895"
        }],
        "created": "2007-07-27T21:37:26.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Eric Anderson",
            "key": "eta",
            "name": "eta",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=eta",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": [{
            "id": "10042",
            "self": "https://issues.apache.org/jira/rest/api/2/customFieldOption/10042",
            "value": "Patch Available"
        }],
        "customfield_12310080": null,
        "customfield_12310220": "2007-07-28T11:45:49.641+0000",
        "customfield_12310222": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "1.0",
        "customfield_12310420": "95764",
        "customfield_12310920": "59854",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i0am3r:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Sep 08 20:35:16 UTC 2008",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "This problem involves the JDBC master/slave configuration when the db server is restarted, or when the brokers lose their JDBC connections for whatever reason temporarily, and when a datasource is in use that can re-establish stale connections prior to providing them to the broker.\n\nThe problem lies with the JDBC locking strategy used to determine which broker is master and which are slaves.  Let's say there are two brokers, a master and a slave, and they've successfully initialized.  If you restart the database server, the slave will throw an exception because it's just caught an exception while blocked attempting to get the lock.  The slave will then *retry* the process of getting a lock over and over again.  Now, since the database was bounced, the *master* will have lost its lock in the activemq_lock table.  However, with the current 4.x-5.x code, it will never \"know\" that it has lost the lock.  There is no mechanism to check the lock state.  So it will continue to think that it is the master and will leave all of its network connectors active.\n\nWhen the slave tries to acquire the lock now, if the datasource has restored connections to the now-restarted database server, it will succeed.  The slave will come up as master, and there will be two masters active concurrently.  Both masters should at this point be fully-functional, as both will have datasources that can talk to the database server once again.\n\nI have tested this with c3p0 and verified that I get two masters after bouncing the database server.  If, at that point, I kill the original slave broker, the original master still appears to be functioning normally.  If, instead, I kill the original master broker, messages are still delivered via the original slave (now co-master).  It does not seem to matter which broker the clients connect to - both work.\n\nThere is no workaround that I can think of that would function correctly across multiple database bounces.  If a slave's datasource does not have the functionality to do database reconnects, then, after the first database server restart, it will never be able to establish a connection to the db server in order to attempt to acquire the lock.  This, combined with the fact that the JDBC master/slave topology does not have any favored brokers -- all can be masters or slaves depending on start-up order and the failures that have occurred over time, means that a datasource that can do reconnects is required on all brokers.  Therefore it would seem that in the JDBC masters/slave topology a database restart or temporary loss of database connectivity will always result in multiple masters.\n\n",
        "duedate": null,
        "environment": "Linux x86_64, Sun jdk 1.6, Postgresql 8.2.4, c3p0 or other pooling datasources",
        "fixVersions": [{
            "archived": false,
            "description": "Issues that need to be reviewed - do we keep 'em or do we kick 'em? ",
            "id": "12315630",
            "name": "NEEDS_REVIEW",
            "released": false,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315630"
        }],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "parent": {
            "fields": {
                "issuetype": {
                    "avatarId": 21133,
                    "description": "A problem which impairs or prevents the functions of the product.",
                    "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                    "id": "1",
                    "name": "Bug",
                    "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                    "subtask": false
                },
                "priority": {
                    "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                    "id": "3",
                    "name": "Major",
                    "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
                },
                "status": {
                    "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                    "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                    "id": "6",
                    "name": "Closed",
                    "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                    "statusCategory": {
                        "colorName": "green",
                        "id": 3,
                        "key": "done",
                        "name": "Done",
                        "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
                    }
                },
                "summary": "Shutdown fails if DB connection is lost"
            },
            "id": "12482170",
            "key": "AMQ-1352",
            "self": "https://issues.apache.org/jira/rest/api/2/issue/12482170"
        },
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Eric Anderson",
            "key": "eta",
            "name": "eta",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=eta",
            "timeZone": "Etc/UTC"
        },
        "resolution": null,
        "resolutiondate": null,
        "status": {
            "description": "The issue is open and ready for the assignee to start work on it.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
            "id": "1",
            "name": "Open",
            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
            "statusCategory": {
                "colorName": "blue-gray",
                "id": 2,
                "key": "new",
                "name": "To Do",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
            }
        },
        "subtasks": [],
        "summary": "JDBC master/slave does not work properly with datasources that can reconnect to the database",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2010-04-28T17:29:25.000+0000",
        "versions": [{
            "archived": false,
            "description": "",
            "id": "12315619",
            "name": "5.2.0",
            "releaseDate": "2008-11-20",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315619"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-1350/votes",
            "votes": 2
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-1350/watchers",
            "watchCount": 5
        },
        "workratio": -1
    },
    "id": "12483333",
    "key": "AMQ-1350",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12483333"
}