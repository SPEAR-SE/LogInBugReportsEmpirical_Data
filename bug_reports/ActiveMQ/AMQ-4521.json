{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [{
            "id": "12315706",
            "name": "stomp",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12315706"
        }],
        "created": "2013-05-08T02:01:40.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Erik",
            "key": "aletheia7",
            "name": "aletheia7",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=aletheia7",
            "timeZone": "America/Los_Angeles"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2013-05-08T21:23:25.409+0000",
        "customfield_12310222": "1_*:*_1_*:*_80708499_*|*_6_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310420": "326904",
        "customfield_12310920": "327249",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i1kean:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Thu May 09 00:25:05 UTC 2013",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "keepAlive not working for stomp URLs. Here is the activemq.xml:\n\n{{<transportConnector name=\"stomp+ssl\" uri=\"stomp+ssl://0.0.0.0:61613?trace=true&amp;soLinger30000&amp;keepAlive=true&amp;soTimeout=44000\"/>}}\n\nRunning \"netstat -tupnco\" as root shows java processes without the keepalive timer counting down. This confirms that tcp keepalive is not working.\n\nHowever, running activemq under the following strace command seems to indicate tcp keepalive is being enabled with the setsockopt() system call:\n\nbq.{{strace -o /dev/stdout -f -e setsockopt bin/activemq-admin start  | grep -i setsockopt}}\nbq.{{3029  setsockopt(14, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3029  setsockopt(128, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3040  setsockopt(130, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3040  setsockopt(131, SOL_TCP, TCP_NODELAY, [1], 4) = 0}}\nbq.{{3040  setsockopt(131, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0}}\nbq.{{3044  setsockopt(132, SOL_TCP, TCP_NODELAY, [1], 4) = 0}}\nbq.{{3029  setsockopt(133, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3044  setsockopt(133, SOL_TCP, TCP_NODELAY, [1], 4) = 0}}\nbq.{{3044  setsockopt(133, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0}}\nbq.{{3047  setsockopt(134, SOL_TCP, TCP_NODELAY, [1], 4) = 0}}\nbq.{{3044  setsockopt(135, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3029  setsockopt(135, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3029  setsockopt(136, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3029  setsockopt(131, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3057  setsockopt(134, SOL_SOCKET, SO_RCVBUF, [65536], 4) = 0}}\nbq.{{3057  setsockopt(134, SOL_SOCKET, SO_SNDBUF, [65536], 4) = 0}}\nbq.{{3056  setsockopt(133, SOL_SOCKET, SO_RCVBUF, [65536], 4) = 0}}\nbq.{{3056  setsockopt(133, SOL_SOCKET, SO_SNDBUF, [65536], 4) = 0}}\nbq.{{3029  setsockopt(140, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3029  setsockopt(140, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0}}\nbq.{{3046  setsockopt(145, SOL_TCP, TCP_NODELAY, [1], 4) = 0}}\nbq.{{3046  setsockopt(145, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0}}\nbq.{{3078  setsockopt(146, SOL_TCP, TCP_NODELAY, [1], 4) = 0}}\n\nBut, again, netstat output does not show keepalives being enabled. netstat shows some java processes with keepalive, but then they quickly disappear. The remaining long lived listening and connected sockets do not have keepalive.\n\nnetstat -tupnco\n{{Active Internet connections (w/o servers)}}\n{{Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name Timer}}\n{{tcp        0      0 10.5.48.17:61613        10.5.48.241:57464       ESTABLISHED 3287/java        off (0.00/0/0)}}\n{{tcp        0      0 10.5.48.17:22           192.168.2.10:1203       ESTABLISHED 1548/sshd: b [priv] keepalive (3768.50/0/0)}}\n{{tcp        0      0 10.5.48.17:61613        169.254.6.55:35975      ESTABLISHED 3287/java        off (0.00/0/0)}}\n\nIn addition, even if keepAlive was being set, this is not really a good solution as implemented because one cannot set the keepalive options at the socket level, only at the OS system-wide level. There's no way to set TCP_KEEPCNT, TCP_KEEPIDLE, and TCP_KEEPINTVL. When I set the keepalive options at the OS level, all applications are affected. I clearly don't want to use the same keepalive settings system wide. These three settings should be allowed to set keepalives only for activemq.\n\nTemporary workaround: use http://libkeepalive.sourceforge.net/",
        "duedate": null,
        "environment": "Linux: Ubuntu 12.04.1 LTS (precise)\njava version \"1.6.0_27\"\nOpenJDK Runtime Environment (IcedTea6 1.12.5) (6b27-1.12.5-1)\nOpenJDK Client VM (build 20.0-b12, mixed mode, sharing)",
        "fixVersions": [{
            "archived": false,
            "description": "Maintenance release with new AMQP support and smaller modules",
            "id": "12323282",
            "name": "5.8.0",
            "releaseDate": "2013-02-11",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12323282"
        }],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [
            "TCP_KEEPCNT",
            "TCP_KEEPIDLE",
            "TCP_KEEPINTVL",
            "keepalive",
            "stomp",
            "tcp"
        ],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Erik",
            "key": "aletheia7",
            "name": "aletheia7",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=aletheia7",
            "timeZone": "America/Los_Angeles"
        },
        "resolution": {
            "description": "The problem described is an issue which will never be fixed.",
            "id": "2",
            "name": "Won't Fix",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/2"
        },
        "resolutiondate": "2013-05-09T00:26:48.000+0000",
        "status": {
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "id": "6",
            "name": "Closed",
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "stomp tcp keepalive not working",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2013-05-09T00:26:48.000+0000",
        "versions": [
            {
                "archived": false,
                "description": "Next v5 maintenance release",
                "id": "12317974",
                "name": "5.6.0",
                "releaseDate": "2012-05-07",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12317974"
            },
            {
                "archived": false,
                "description": "Maintenance release with new AMQP support and smaller modules",
                "id": "12323282",
                "name": "5.8.0",
                "releaseDate": "2013-02-11",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12323282"
            }
        ],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-4521/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-4521/watchers",
            "watchCount": 3
        },
        "workratio": -1
    },
    "id": "12646546",
    "key": "AMQ-4521",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12646546"
}