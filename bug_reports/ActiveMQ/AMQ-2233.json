{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": 0,
        "aggregatetimeoriginalestimate": 0,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Gary Tully",
            "key": "gtully",
            "name": "gtully",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=gtully",
            "timeZone": "Etc/UTC"
        },
        "components": [],
        "created": "2009-04-28T12:08:40.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Dave Syer",
            "key": "david_syer",
            "name": "david_syer",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=david_syer",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": [{
            "id": "10091",
            "self": "https://issues.apache.org/jira/rest/api/2/customFieldOption/10091",
            "value": "Regression"
        }],
        "customfield_12310220": "2009-04-28T16:31:32.410+0000",
        "customfield_12310222": "1_*:*_1_*:*_6123264676_*|*_5_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "2.0",
        "customfield_12310420": "75017",
        "customfield_12310920": "161695",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i0s1cn:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Jul 08 09:03:05 UTC 2009",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "After rollback received messages not re-presented.  If I receive in a transaction and then roll back the messages should be re-presented in the next transaction.  This used to work in 5.1.0, but is broken in 5.2.0.\n\nYou can browse the Queue in JMX after the rollback and see that the messages are still there, but they are not received by a consumer in the same process.\n\nHere's a test case (fails on the checkPostConditions()):\n\n{code}\npublic class RawRollbackTests {\n\t\n\tprivate static ConnectionFactory connectionFactory;\n\tprivate static Destination queue;\n\tprivate static BrokerService broker;\n\n\t@BeforeClass\n\tpublic static void clean() throws Exception {\n\t\tFileUtils.deleteDirectory(new File(\"activemq-data\"));\n\t\tbroker = new BrokerService();\n\t\tbroker.setUseJmx(true);\n\t\tbroker.start();\n\t\tActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory();\n\t\tconnectionFactory.setBrokerURL(\"vm://localhost?async=false\");\n\t\tRawRollbackTests.connectionFactory = connectionFactory;\n\t\tqueue = new ActiveMQQueue(\"queue\");\n\t}\n\n\t@AfterClass\n\tpublic static void close() throws Exception {\n\t\tbroker.stop();\n\t}\n\n\t@Before\n\tpublic void clearData() throws Exception {\n\t\tgetMessages(false); // drain queue\n\t\tconvertAndSend(\"foo\");\n\t\tconvertAndSend(\"bar\");\n\t}\n\n\n\t@After\n\tpublic void checkPostConditions() throws Exception {\n\n\t\tThread.sleep(1000L);\n\t\tList<String> list = getMessages(false);\n\t\tassertEquals(2, list.size());\n\n\t}\n\n\t@Test\n\tpublic void testReceiveMessages() throws Exception {\n\n\t\tList<String> list = getMessages(true);\n\t\tassertEquals(2, list.size());\n\t\tassertTrue(list.contains(\"foo\"));\n\n\t}\n\t\n\tprivate void convertAndSend(String msg) throws Exception {\n\t\tConnection connection = connectionFactory.createConnection();\n\t\tconnection.start();\n\t\tSession session = connection.createSession(true, Session.AUTO_ACKNOWLEDGE);\n\t\tMessageProducer producer = session.createProducer(queue);\n\t\tproducer.send(session.createTextMessage(msg));\n\t\tproducer.close();\n\t\tsession.commit();\n\t\tsession.close();\n\t\tconnection.close();\n\t}\n\n\tprivate List<String> getMessages(boolean rollback) throws Exception {\n\t\tConnection connection = connectionFactory.createConnection();\n\t\tconnection.start();\n\t\tSession session = connection.createSession(true, Session.AUTO_ACKNOWLEDGE);\n\t\tString next = \"\";\n\t\tList<String> msgs = new ArrayList<String>();\n\t\twhile (next != null) {\n\t\t\tnext = (String) receiveAndConvert(session);\n\t\t\tif (next != null)\n\t\t\t\tmsgs.add(next);\n\t\t}\n\t\tif (rollback) {\n\t\t\tsession.rollback();\n\t\t} else {\n\t\t\tsession.commit();\n\t\t}\n\t\tsession.close();\n\t\tconnection.close();\n\t\treturn msgs;\n\t}\n\n\tprivate String receiveAndConvert(Session session) throws Exception {\n\t\tMessageConsumer consumer = session.createConsumer(queue);\n\t\tMessage message = consumer.receive(100L);\n\t\tconsumer.close();\n\t\tif (message==null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn ((TextMessage)message).getText();\n\t}\n}\n{code}",
        "duedate": null,
        "environment": null,
        "fixVersions": [{
            "archived": false,
            "description": "",
            "id": "12315620",
            "name": "5.3.0",
            "releaseDate": "2009-10-13",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315620"
        }],
        "issuelinks": [{
            "id": "12335011",
            "outwardIssue": {
                "fields": {
                    "issuetype": {
                        "avatarId": 21133,
                        "description": "A problem which impairs or prevents the functions of the product.",
                        "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                        "id": "1",
                        "name": "Bug",
                        "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                        "subtask": false
                    },
                    "priority": {
                        "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                        "id": "3",
                        "name": "Major",
                        "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
                    },
                    "status": {
                        "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                        "id": "6",
                        "name": "Closed",
                        "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                        "statusCategory": {
                            "colorName": "green",
                            "id": 3,
                            "key": "done",
                            "name": "Done",
                            "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
                        }
                    },
                    "summary": "consumer close with active XA transaction results in java.lang.IllegalArgumentException: The subscription does not exist: ..."
                },
                "id": "12482777",
                "key": "AMQ-2034",
                "self": "https://issues.apache.org/jira/rest/api/2/issue/12482777"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12335011",
            "type": {
                "id": "10001",
                "inward": "is depended upon by",
                "name": "dependent",
                "outward": "depends upon",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"
            }
        }],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Dave Syer",
            "key": "david_syer",
            "name": "david_syer",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=david_syer",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2009-07-08T09:03:05.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "After rollback received messages not re-presented",
        "timeestimate": 0,
        "timeoriginalestimate": 0,
        "timespent": null,
        "updated": "2009-07-08T09:03:05.000+0000",
        "versions": [{
            "archived": false,
            "description": "",
            "id": "12315619",
            "name": "5.2.0",
            "releaseDate": "2008-11-20",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315619"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-2233/votes",
            "votes": 1
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-2233/watchers",
            "watchCount": 1
        },
        "workratio": 0
    },
    "id": "12483038",
    "key": "AMQ-2233",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12483038"
}