{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [],
        "created": "2011-08-11T15:22:16.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Rui Gu",
            "key": "jackygurui",
            "name": "jackygurui",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jackygurui",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2013-06-13T16:04:28.754+0000",
        "customfield_12310222": "1_*:*_1_*:*_58583194213_*|*_5_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310420": "65457",
        "customfield_12310920": "81472",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i0eajz:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Jun 19 16:28:50 UTC 2013",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "In MessageListenerServlet.java\n\n          if (message == null && client.getListener().getUndeliveredMessages().size() == 0) {\n                Continuation continuation = ContinuationSupport.getContinuation(request);\n                \n                if (continuation.isExpired()) {\n                    response.setStatus(HttpServletResponse.SC_OK);\n                    StringWriter swriter = new StringWriter();\n                    PrintWriter writer = new PrintWriter(swriter);\n                    writer.println(\"<ajax-response>\");\n                    writer.print(\"<\/ajax-response>\");\n\n                    writer.flush();\n                    String m = swriter.toString();\n                    response.getWriter().println(m); \n                    \n                    return;\n                }\n\n                continuation.setTimeout(timeout);\n                continuation.suspend();\n                LOG.debug( \"Suspending continuation \" + continuation );\n                \n                // Fetch the listeners\n                AjaxListener listener = client.getListener();\n                listener.access();\n\n                // register this continuation with our listener.\n                listener.setContinuation(continuation);\n                \n                return;\n            }\n\nBased on above code, the continuation is expected to be expired after given timeout when there is no message available for the ajax client and the ajax client will then receive an \"empty\" message. However based on the servlet 3 Continuation implementation in jetty (Servlet3Continuation.java) the only place where the continuation is set to expire is within the below method (there is a bug in this method as well). \n\npublic void addContinuationListener(final ContinuationListener listener)\n    {\n        AsyncListener wrapped = new AsyncListener()\n        {\n            public void onComplete(final AsyncEvent event) throws IOException\n            {\n                listener.onComplete(Servlet3Continuation.this);\n            }\n\n            public void onError(AsyncEvent event) throws IOException\n            {\n                listener.onComplete(Servlet3Continuation.this);\n            }\n\n            public void onStartAsync(AsyncEvent event) throws IOException\n            {\n                event.getAsyncContext().addListener(this);\n            }\n\n            public void onTimeout(AsyncEvent event) throws IOException\n            {\n                _expired=true;\n                listener.onTimeout(Servlet3Continuation.this);\n            }\n        };\n        \n        if (_context==null)\n            _context.addListener(wrapped);\n        else\n            _listeners.add(wrapped);\n    }\n\nWithout adding a listener the continuation will never be set to expire, therefore the \"empty\" response is never sent back to the client, the connection from the client is resumed and suspended over and over again until the connection is aborted by client or there is a message available.",
        "duedate": null,
        "environment": "Ubuntu 11.04 using glassfish as web container running servlet 3.0 webapp.",
        "fixVersions": [{
            "archived": false,
            "id": "12323932",
            "name": "5.9.0",
            "releaseDate": "2013-10-21",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12323932"
        }],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": ["Ajax"],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Rui Gu",
            "key": "jackygurui",
            "name": "jackygurui",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jackygurui",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2013-06-19T16:28:50.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "When MessageListenerServlet is running under servlet3, the continuation is not timing out.",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2013-06-19T16:28:50.000+0000",
        "versions": [{
            "archived": false,
            "description": "",
            "id": "12315626",
            "name": "5.5.0",
            "releaseDate": "2011-04-01",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315626"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-3447/votes",
            "votes": 1
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-3447/watchers",
            "watchCount": 2
        },
        "workratio": -1
    },
    "id": "12518599",
    "key": "AMQ-3447",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12518599"
}