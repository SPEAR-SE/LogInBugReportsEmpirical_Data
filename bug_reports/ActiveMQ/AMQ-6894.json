{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Jean-Baptiste Onofré",
            "key": "jbonofre",
            "name": "jbonofre",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jbonofre",
            "timeZone": "Europe/Berlin"
        },
        "components": [{
            "id": "12313892",
            "name": "Broker",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313892"
        }],
        "created": "2018-01-30T14:53:45.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ashakirin&avatarId=13541",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ashakirin&avatarId=13541",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ashakirin&avatarId=13541",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=ashakirin&avatarId=13541"
            },
            "displayName": "Andrei Shakirin",
            "key": "ashakirin",
            "name": "ashakirin",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ashakirin",
            "timeZone": "Europe/Berlin"
        },
        "customfield_10010": null,
        "customfield_12310041": null,
        "customfield_12310080": null,
        "customfield_12310220": "2018-01-31T15:30:33.546+0000",
        "customfield_12310222": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "1.0",
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i3pjkn:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Feb 07 18:28:24 UTC 2018",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "My clients connect to AMQ with this connection string:\r\n\r\n(tcp://amq1:61616,tcp://amq2:61616)?randomize=false&priorityBackup=true\r\n\r\n It works - for some time. But sooner or later my AMQ server becomes unresponsive because the host it runs on runs out of resources (threads).\r\n\r\nSuddenly AMQ Server log explodes with the messages like:\r\n\r\n{code}\r\n2018-01-26 09:26:16,909 | WARN  | Failed to register MBean org.apache.activemq :type=Broker,brokerName=activemq-vm-primary,connector=clientConnectors,connect\r\n\r\norName=default,connectionViewType=clientId,connectionName=ID_ca8f70e115d0-3708\r\n\r\n7-1516883370639-0_22 | org.apache.activemq.broker.jmx.ManagedTransportConnecti\r\n\r\non | ActiveMQ Transport: tcp:///172.10.7.56:55548@61616\r\n\r\n2018-01-26 09:26:21,375 | WARN  | Ignoring ack received before dispatch; result of failover with an outstanding ack. Acked messages will be replayed if present on this broker. Ignored ack: MessageAck \\{commandId = 157, responseRequired = false, ackType = 2, consumerId = ID:ca8f70e115d0-37087-1516883370639-1:22:10:1, firstMessageId = ID:a95345a9c0df-33771-1516883685728-1:17:5:1:23, lastMessageId = ID:a95345a9c0df-33771-1516883685728-1:17:5:1:23, destination = queue://MY_QUEUE_OUT, transactionId = null, messageCount = 1, poisonCause = null} | org.apache.activemq.broker.region.PrefetchSubscription | ActiveMQ Transport: tcp:///172.16.6.56:55464@61616\r\n\r\n2018-01-26 09:26:39,211 | WARN  | Transport Connection to: tcp://172.10.6.56:55860 failed: java.net.SocketException: Connection reset | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ InactivityMonitor Worker\r\n\r\n2018-01-26 09:26:47,175 | WARN  | Transport Connection to: tcp://172.10.6.56:57012 failed: java.net.SocketException: Broken pipe (Write failed) | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ InactivityMonitor Worker\r\n{code}\r\n\r\nAfter short period of time AMQ server comes out of resources with \"java.lang.OutOfMemoryError: unable to create new native thread\" error. The AMQ service process in this case has a huge number of threads (some thousands)\r\n\r\n \r\n\r\nThe client side log contains a lot of reconnection attempts messages like:\r\n\r\n{code}\r\n2018-01-26 00:10:31,387 WARN    [\\{{bundle.name,org.apache.activemq.activemq-osgi}{bundle.version,5.14.1}\\{bundle.id,181}}]     [null]  org.apache.activemq.transport.failover.FailoverTransport      Failed to connect to [tcp://activemq-vm-primary:61616, tcp://activemq-vm-secondary:61616] after: 810 attempt(s) continuing to retry.\r\n{code}\r\n\r\nIt seems that client creates a huge number of connections by failover retry and after some time kills the server.\r\n\r\nIssue looks very similar to described in https://issues.apache.org/jira/browse/AMQ-6603, however server isn't configured with access control settings.\r\n\r\nI found the description of similar problem into [http://activemq.2283324.n4.nabble.com/ActiveMQ-5-2-OutOfMemoryError-unable-to-create-new-native-thread-td2366585.html],  but without concrete suggestion.\r\n\r\n \r\n\r\nPart of server log is attached",
        "duedate": null,
        "environment": null,
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ashakirin&avatarId=13541",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ashakirin&avatarId=13541",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ashakirin&avatarId=13541",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=ashakirin&avatarId=13541"
            },
            "displayName": "Andrei Shakirin",
            "key": "ashakirin",
            "name": "ashakirin",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ashakirin",
            "timeZone": "Europe/Berlin"
        },
        "resolution": null,
        "resolutiondate": null,
        "status": {
            "description": "The issue is open and ready for the assignee to start work on it.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
            "id": "1",
            "name": "Open",
            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
            "statusCategory": {
                "colorName": "blue-gray",
                "id": 2,
                "key": "new",
                "name": "To Do",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
            }
        },
        "subtasks": [],
        "summary": "Excessive number of connections by failover transport with priorityBackup",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2018-02-07T18:28:24.000+0000",
        "versions": [{
            "archived": false,
            "id": "12339772",
            "name": "5.14.5",
            "releaseDate": "2017-04-16",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12339772"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6894/votes",
            "votes": 1
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-6894/watchers",
            "watchCount": 4
        },
        "workratio": -1
    },
    "id": "13134777",
    "key": "AMQ-6894",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13134777"
}