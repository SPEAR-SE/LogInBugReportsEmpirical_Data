{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [{
            "id": "12313892",
            "name": "Broker",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313892"
        }],
        "created": "2007-03-30T15:39:17.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Aman Nanner",
            "key": "ananner",
            "name": "ananner",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ananner",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310041": [{
            "id": "10042",
            "self": "https://issues.apache.org/jira/rest/api/2/customFieldOption/10042",
            "value": "Patch Available"
        }],
        "customfield_12310080": null,
        "customfield_12310220": "2007-05-07T17:01:41.366+0000",
        "customfield_12310222": "1_*:*_1_*:*_134890012610_*|*_6_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "2.0",
        "customfield_12310420": "43770",
        "customfield_12310920": "172380",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i0tvav:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Jul 08 21:06:10 UTC 2011",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "Hi,\n\nI have created an inbound message bridge from Weblogic Server 9.2 into Apache Geronimo 1.2 (Apache Active MQ 4.1-SNAPSHOT).  The actual \"bridge\" works fine, as the message is forwarded from Weblogic Server into Apache ActiveMQ.  However, a NullPointerException occurs during processing of the message:\n\n---\n{code:title=Bar.java|borderStyle=solid}\n11:15:40,885 ERROR [DestinationBridge] failed to forward message on attempt: 1 reason: javax.jms.JMSException: java.lang.NullPointerException message: TextMessage[ID:Sphinx-3592-1175266963549-3:1:3:1:5, <test>Hello World<\/test>]\njavax.jms.JMSException: java.lang.NullPointerException\n\tat org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:46)\n\tat org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1181)\n\tat org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1551)\n\tat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:465)\n\tat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:415)\n\tat org.apache.activemq.ActiveMQQueueSender.send(ActiveMQQueueSender.java:116)\n\tat org.apache.activemq.network.jms.QueueBridge.sendMessage(QueueBridge.java:87)\n\tat org.apache.activemq.network.jms.DestinationBridge.onMessage(DestinationBridge.java:134)\n\tat weblogic.jms.client.JMSSession.onMessage(JMSSession.java:4060)\n\tat weblogic.jms.client.JMSSession.execute(JMSSession.java:3953)\n\tat weblogic.jms.client.JMSSession$UseForRunnable.run(JMSSession.java:4467)\n\tat weblogic.work.ExecuteRequestAdapter.execute(ExecuteRequestAdapter.java:21)\n\tat weblogic.kernel.ExecuteThread.execute(ExecuteThread.java:145)\n\tat weblogic.kernel.ExecuteThread.run(ExecuteThread.java:117)\nCaused by: java.lang.NullPointerException\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:86)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:136)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:498)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:604)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:185)\n\tat org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:95)\n\tat org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:65)\n\tat org.apache.activemq.transport.vm.VMTransport.syncOneWay(VMTransport.java:96)\n\tat org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:83)\n\tat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:47)\n\tat org.apache.activemq.transport.ResponseCorrelator.asyncRequest(ResponseCorrelator.java:69)\n\tat org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:74)\n\tat org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1175)\n\t... 12 more\n{code}\n---\n\nHere is the method in {{org.apache.activemq.broker.CompositeDestinationBroker}} where the NullPointerException occurs:\n\n----\n{code:title=Bar.java|borderStyle=solid}\n    public void send(ConnectionContext context, Message message) throws Exception {\n        ActiveMQDestination destination = message.getDestination();\n        if( destination.isComposite() ) {\n            ActiveMQDestination[] destinations = destination.getCompositeDestinations();\n            for (int i = 0; i < destinations.length; i++) {\n                if( i!=0 ) {\n                    message = message.copy();\n                }\n                message.setOriginalDestination(destination);\n                message.setDestination(destinations[i]);\n                message.evictMarshlledForm();\n                next.send(context, message);\n            }\n        } else {\n            next.send(context, message);\n        }\n    }\n{code}\n----\n\nThe {{message.getDestination()}} method call returns null because the JMS Destination inside the message is set to null.  I then investigated why this message would be set to null, and I traced the problem to the following method in {{org.apache.activemq.ActiveMQSession}}:\n\n----\n{code:title=Bar.java|borderStyle=solid}\n    protected void send(ActiveMQMessageProducer producer, ActiveMQDestination destination, Message message, int deliveryMode,\n            int priority, long timeToLive) throws JMSException {\n        checkClosed();\n\n        if( destination.isTemporary() && connection.isDeleted(destination) ) {\n            throw new JMSException(\"Cannot publish to a deleted Destination: \"+destination);\n        }\n\n        // tell the Broker we are about to start a new transaction\n        doStartTransaction();\n        TransactionId txid = transactionContext.getTransactionId();\n        \n        message.setJMSDestination(destination);\n        message.setJMSDeliveryMode(deliveryMode);        \n        long expiration = 0L;\n\n        if (!producer.getDisableMessageTimestamp()) {\n            long timeStamp = System.currentTimeMillis();\n            message.setJMSTimestamp(timeStamp);\n            if (timeToLive > 0) {\n                expiration = timeToLive + timeStamp;\n            }\n        }\n\n        message.setJMSExpiration(expiration);\n        message.setJMSPriority(priority);\n        long sequenceNumber = producer.getMessageSequence();\n        \n        message.setJMSRedelivered(false);        \n\n        // transform to our own message format here\n        ActiveMQMessage msg = ActiveMQMessageTransformation.transformMessage(message, connection);\n        // Set the message id.\n        if( msg == message ) {\n            msg.setMessageId( new MessageId(producer.getProducerInfo().getProducerId(), sequenceNumber) );\n        } else {\n            msg.setMessageId( new MessageId(producer.getProducerInfo().getProducerId(), sequenceNumber) );\n            message.setJMSMessageID(msg.getMessageId().toString());\n        }\n        \n        msg.setTransactionId(txid);\n\n        if ( connection.isCopyMessageOnSend() ){\n            msg = (ActiveMQMessage) msg.copy();\n        }\n        msg.setConnection(connection);\n        msg.onSend();\n        msg.setProducerId(msg.getMessageId().getProducerId());\n\n        if (log.isDebugEnabled()) {\n            log.debug(\"Sending message: \" + msg);\n        }\n\n        if( !connection.isUseSyncSend() && ( !msg.isPersistent() || connection.isUseAsyncSend() || txid!=null) ) {\n            this.connection.asyncSendPacket(msg);\n        } else {\n            this.connection.syncSendPacket(msg);\n        }\n\n    }\n{code}\n----\n\nAs you can see, the destination is supposed to be set in the message during the call {{message.setJMSDestination(destination);}}.  I have verified that the destination argument is indeed valid and NOT null.  However, after this method invocation, the internal JMS destination within the \"message\" object is STILL null.\n\nThis \"message\" object is in fact the Weblogic JMS implementation of the \"Message\" interface.  So it seems that the Weblogic implementation of the object is not properly setting the JMS destination for whatever reason.  Therefore, when the message is transformed in the following call:\n\n{{ActiveMQMessage msg = ActiveMQMessageTransformation.transformMessage(message, connection);}}\n\nthe new ActiveMQMessage object will have a null destination, thus causing a NullPointerException further down the chain.\n\nIt may be that the fact that the JMS destination is not being set in the Weblogic JMS class is a Weblogic bug, but I'm wondering if Apache ActiveMQ should anticipate this somehow, and still be able to deliver the JMS message.\n\nThanks",
        "duedate": null,
        "environment": null,
        "fixVersions": [{
            "archived": false,
            "description": "Issues that need to be reviewed - do we keep 'em or do we kick 'em? ",
            "id": "12315630",
            "name": "NEEDS_REVIEW",
            "released": false,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315630"
        }],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311210&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311210&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311210&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12311210&avatarId=10011"
            },
            "id": "12311210",
            "key": "AMQ",
            "name": "ActiveMQ",
            "projectCategory": {
                "description": "ActiveMQ",
                "id": "11160",
                "name": "ActiveMQ",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/11160"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12311210"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Aman Nanner",
            "key": "ananner",
            "name": "ananner",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ananner",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "The described issue is not actually a problem - it is as designed.",
            "id": "8",
            "name": "Not A Problem",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/8"
        },
        "resolutiondate": "2011-07-08T21:06:10.000+0000",
        "status": {
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "id": "6",
            "name": "Closed",
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "Message Bridge to Weblogic 9.2 results in Null JMS Destination",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2011-07-08T21:06:10.000+0000",
        "versions": [{
            "archived": false,
            "description": "",
            "id": "12315613",
            "name": "4.1.0",
            "releaseDate": "2006-11-13",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315613"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-1217/votes",
            "votes": 3
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/AMQ-1217/watchers",
            "watchCount": 5
        },
        "workratio": -1
    },
    "id": "12482118",
    "key": "AMQ-1217",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12482118"
}