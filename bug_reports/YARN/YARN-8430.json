{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [],
        "created": "2018-06-14T10:37:09.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jporritt&avatarId=31555",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jporritt&avatarId=31555",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jporritt&avatarId=31555",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jporritt&avatarId=31555"
            },
            "displayName": "James Porritt",
            "key": "jporritt",
            "name": "jporritt",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jporritt",
            "timeZone": "Europe/London"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2018-06-14T21:45:09.493+0000",
        "customfield_12310222": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i3uutr:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Jun 14 21:45:09 UTC 2018",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "I'm encountering an error when submitting some zip files to spark-submit using --archive that are over 2Gb and have the zip64 flag set.\r\n\r\n{{PYSPARK_PYTHON=./ROOT/myspark/bin/python /usr/hdp/current/spark2-client/bin/spark-submit \\}}\r\n{{ --conf spark.yarn.appMasterEnv.PYSPARK_PYTHON=./ROOT/myspark/bin/python \\}}\r\n{{ --master=yarn \\}}\r\n{{ --deploy-mode=cluster \\}}\r\n{{ --driver-memory=4g \\}}\r\n{{ --archives=myspark.zip#ROOT \\}}\r\n{{ --num-executors=32 \\}}\r\n{{ --packages com.databricks:spark-avro_2.11:4.0.0 \\}}\r\n{{ foo.py}}\r\n\r\n(As a bit of background, I'm trying to prepare files using the trick of zipping a conda environment and passing the zip file via --archives, as per: https://community.hortonworks.com/articles/58418/running-pyspark-with-conda-env.html)\r\n\r\nmyspark.zip is a zipped conda environment. It was created using python with the zipfile pacakge. The files are stored without deflation and with the zip64 flag set. foo.py is my application code. This normally works, but if myspark.zip is greater than 2Gb and has the zip64 flag set I get:\r\n\r\njava.util.zip.ZipException: invalid CEN header (bad signature)\r\n\r\nThere seems to be much written on the subject, and I was able to write Java code that utilises the java.util.zip library that both does and doesn't encounter this error for one of the problematic zip files.\r\n\r\nSpark compile info:\r\n\r\n{{Welcome to}}\r\n{{ ____ __}}\r\n{{ / __/__ ___ _____/ /__}}\r\n{{ _\\ \\/ _ \\/ _ `/ __/ '_/}}\r\n{{ /___/ .__/\\_,_/_/ /_/\\_\\ version 2.2.0.2.6.4.0-91}}\r\n{{ /_/}}\r\n\r\n{{Using Scala version 2.11.8, Java HotSpot(TM) 64-Bit Server VM, 1.8.0_112}}\r\n{{Branch HEAD}}\r\n{{Compiled by user jenkins on 2018-01-04T10:41:05Z}}\r\n{{Revision a24017869f5450397136ee8b11be818e7cd3facb}}\r\n{{Url git@github.com:hortonworks/spark2.git}}\r\n{{Type --help for more information.}}\r\n\r\nYARN logs on console after above command. I've tried both --deploy-mode=cluster and --deploy-mode=client.\r\n\r\n{{18/06/13 16:00:22 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable}}\r\n{{18/06/13 16:00:23 WARN DomainSocketFactory: The short-circuit local reads feature cannot be used because libhadoop cannot be loaded.}}\r\n{{18/06/13 16:00:23 INFO RMProxy: Connecting to ResourceManager at myhost2.myfirm.com/10.87.11.17:8050}}\r\n{{18/06/13 16:00:23 INFO Client: Requesting a new application from cluster with 6 NodeManagers}}\r\n{{18/06/13 16:00:23 INFO Client: Verifying our application has not requested more than the maximum memory capability of the cluster (221184 MB per container)}}\r\n{{18/06/13 16:00:23 INFO Client: Will allocate AM container, with 18022 MB memory including 1638 MB overhead}}\r\n{{18/06/13 16:00:23 INFO Client: Setting up container launch context for our AM}}\r\n{{18/06/13 16:00:23 INFO Client: Setting up the launch environment for our AM container}}\r\n{{18/06/13 16:00:23 INFO Client: Preparing resources for our AM container}}\r\n{{18/06/13 16:00:24 INFO Client: Use hdfs cache file as spark.yarn.archive for HDP, hdfsCacheFile:hdfs://myhost.myfirm.com:8020/hdp/apps/2.6.4.0-91/spark2/spark2-hdp-yarn-archive.tar.gz}}\r\n{{18/06/13 16:00:24 INFO Client: Source and destination file systems are the same. Not copying hdfs://myhost.myfirm.com:8020/hdp/apps/2.6.4.0-91/spark2/spark2-hdp-yarn-archive.tar.gz}}\r\n{{18/06/13 16:00:24 INFO Client: Uploading resource file:/home/myuser/.ivy2/jars/com.databricks_spark-avro_2.11-4.0.0.jar -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/com.databri}}\r\n{{cks_spark-avro_2.11-4.0.0.jar}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/home/myuser/.ivy2/jars/org.slf4j_slf4j-api-1.7.5.jar -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/org.slf4j_slf4j-api-1.}}\r\n{{7.5.jar}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/home/myuser/.ivy2/jars/org.apache.avro_avro-1.7.6.jar -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/org.apache.avro_avro-}}\r\n{{1.7.6.jar}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/home/myuser/.ivy2/jars/org.codehaus.jackson_jackson-core-asl-1.9.13.jar -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/org}}\r\n{{.codehaus.jackson_jackson-core-asl-1.9.13.jar}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/home/myuser/.ivy2/jars/org.codehaus.jackson_jackson-mapper-asl-1.9.13.jar -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/o}}\r\n{{rg.codehaus.jackson_jackson-mapper-asl-1.9.13.jar}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/home/myuser/.ivy2/jars/com.thoughtworks.paranamer_paranamer-2.3.jar -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/com.tho}}\r\n{{ughtworks.paranamer_paranamer-2.3.jar}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/home/myuser/.ivy2/jars/org.xerial.snappy_snappy-java-1.0.5.jar -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/org.xerial.s}}\r\n{{nappy_snappy-java-1.0.5.jar}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/home/myuser/.ivy2/jars/org.apache.commons_commons-compress-1.4.1.jar -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/org.ap}}\r\n{{ache.commons_commons-compress-1.4.1.jar}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/home/myuser/.ivy2/jars/org.tukaani_xz-1.0.jar -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/org.tukaani_xz-1.0.jar}}\r\n{{18/06/13 16:00:26 INFO Client: Source and destination file systems are the same. Not copying hdfs:/user/myuser/release/alphagenspark.zip#ROOT}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/my/script/dir/spark/alphagen/foo.py -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/foo.py}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/usr/hdp/current/spark2-client/python/lib/pyspark.zip -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/pyspark.zip}}\r\n{{18/06/13 16:00:26 INFO Client: Uploading resource file:/usr/hdp/current/spark2-client/python/lib/py4j-0.10.4-src.zip -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/py4j-0.10.4-src}}\r\n{{.zip}}\r\n{{18/06/13 16:00:26 WARN Client: Same path resource file:/home/myuser/.ivy2/jars/com.databricks_spark-avro_2.11-4.0.0.jar added multiple times to distributed cache.}}\r\n{{18/06/13 16:00:26 WARN Client: Same path resource file:/home/myuser/.ivy2/jars/org.slf4j_slf4j-api-1.7.5.jar added multiple times to distributed cache.}}\r\n{{18/06/13 16:00:26 WARN Client: Same path resource file:/home/myuser/.ivy2/jars/org.apache.avro_avro-1.7.6.jar added multiple times to distributed cache.}}\r\n{{18/06/13 16:00:26 WARN Client: Same path resource file:/home/myuser/.ivy2/jars/org.codehaus.jackson_jackson-core-asl-1.9.13.jar added multiple times to distributed cache.}}\r\n{{18/06/13 16:00:26 WARN Client: Same path resource file:/home/myuser/.ivy2/jars/org.codehaus.jackson_jackson-mapper-asl-1.9.13.jar added multiple times to distributed cache.}}\r\n{{18/06/13 16:00:26 WARN Client: Same path resource file:/home/myuser/.ivy2/jars/com.thoughtworks.paranamer_paranamer-2.3.jar added multiple times to distributed cache.}}\r\n{{18/06/13 16:00:26 WARN Client: Same path resource file:/home/myuser/.ivy2/jars/org.xerial.snappy_snappy-java-1.0.5.jar added multiple times to distributed cache.}}\r\n{{18/06/13 16:00:26 WARN Client: Same path resource file:/home/myuser/.ivy2/jars/org.apache.commons_commons-compress-1.4.1.jar added multiple times to distributed cache.}}{{18/06/13 16:00:26 WARN Client: Same path resource file:/home/myuser/.ivy2/jars/org.tukaani_xz-1.0.jar added multiple times to distributed cache.}}\r\n{{18/06/13 16:00:27 INFO Client: Uploading resource file:/tmp/spark-6c26ae3b-7248-488f-bc33-9766251474bb/__spark_conf__4405623606341803690.zip -> hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019/__spark_conf__.zip}}\r\n{{18/06/13 16:00:27 INFO SecurityManager: Changing view acls to: myuser}}\r\n{{18/06/13 16:00:27 INFO SecurityManager: Changing modify acls to: myuser}}\r\n{{18/06/13 16:00:27 INFO SecurityManager: Changing view acls groups to:}}\r\n{{18/06/13 16:00:27 INFO SecurityManager: Changing modify acls groups to:}}\r\n{{18/06/13 16:00:27 INFO SecurityManager: SecurityManager: authentication disabled; ui acls disabled; users with view permissions: Set(myuser); groups with view permissions: Set(); users with modify permissions: Set(myuser); groups with modify permissions: Set()}}\r\n{{18/06/13 16:00:27 INFO Client: Submitting application application_1528901858967_0019 to ResourceManager}}\r\n{{18/06/13 16:00:27 INFO YarnClientImpl: Submitted application application_1528901858967_0019}}\r\n{{18/06/13 16:00:28 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:28 INFO Client:}}\r\n{{ client token: N/A}}\r\n{{ diagnostics: AM container is launched, waiting for AM container to Register with RM}}\r\n{{ ApplicationMaster host: N/A}}\r\n{{ ApplicationMaster RPC port: -1}}\r\n{{ queue: default}}\r\n{{ start time: 1528923627110}}\r\n{{ final status: UNDEFINED}}\r\n{{ tracking URL: http://myhost2.myfirm.com:8088/proxy/application_1528901858967_0019/}}\r\n{{ user: myuser}}\r\n{{18/06/13 16:00:29 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:30 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:31 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:32 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:33 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:34 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:35 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:36 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:37 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:38 INFO Client: Application report for application_1528901858967_0019 (state: ACCEPTED)}}\r\n{{18/06/13 16:00:39 INFO Client: Application report for application_1528901858967_0019 (state: FAILED)}}\r\n{{18/06/13 16:00:39 INFO Client:}}\r\n{{ client token: N/A}}\r\n{{ diagnostics: Application application_1528901858967_0019 failed 2 times due to AM Container for appattempt_1528901858967_0019_000002 exited with exitCode: -1000}}\r\n{{For more detailed output, check the application tracking page: http://myhost2.myfirm.com:8088/cluster/app/application_1528901858967_0019 Then click on links to logs of each attempt.}}\r\n{{Diagnostics: java.util.zip.ZipException: invalid CEN header (bad signature)}}\r\n{{Failing this attempt. Failing the application.}}\r\n{{ ApplicationMaster host: N/A}}\r\n{{ ApplicationMaster RPC port: -1}}\r\n{{ queue: default}}\r\n{{ start time: 1528923627110}}\r\n{{ final status: FAILED}}\r\n{{ tracking URL: http://myhost2.myfirm.com:8088/cluster/app/application_1528901858967_0019}}\r\n{{ user: myuser}}\r\n{{18/06/13 16:00:39 INFO Client: Deleted staging directory hdfs://myhost.myfirm.com:8020/user/myuser/.sparkStaging/application_1528901858967_0019}}\r\n{{Exception in thread \"main\" org.apache.spark.SparkException: Application application_1528901858967_0019 finished with failed status}}\r\n{{ at org.apache.spark.deploy.yarn.Client.run(Client.scala:1187)}}\r\n{{ at org.apache.spark.deploy.yarn.Client$.main(Client.scala:1233)}}\r\n{{ at org.apache.spark.deploy.yarn.Client.main(Client.scala)}}\r\n{{ at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)}}\r\n{{ at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)}}\r\n{{ at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)}}\r\n{{ at java.lang.reflect.Method.invoke(Method.java:498)}}\r\n{{ at org.apache.spark.deploy.SparkSubmit$.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:782)}}\r\n{{ at org.apache.spark.deploy.SparkSubmit$.doRunMain$1(SparkSubmit.scala:180)}}\r\n{{ at org.apache.spark.deploy.SparkSubmit$.submit(SparkSubmit.scala:205)}}\r\n{{ at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:119)}}\r\n{{ at org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)}}\r\n{{18/06/13 16:00:39 INFO ShutdownHookManager: Shutdown hook called}}\r\n{{18/06/13 16:00:39 INFO ShutdownHookManager: Deleting directory /tmp/spark-6c26ae3b-7248-488f-bc33-9766251474bb}}",
        "duedate": null,
        "environment": null,
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135"
            },
            "id": "12313722",
            "key": "YARN",
            "name": "Hadoop YARN",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12313722"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jporritt&avatarId=31555",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jporritt&avatarId=31555",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jporritt&avatarId=31555",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jporritt&avatarId=31555"
            },
            "displayName": "James Porritt",
            "key": "jporritt",
            "name": "jporritt",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jporritt",
            "timeZone": "Europe/London"
        },
        "resolution": null,
        "resolutiondate": null,
        "status": {
            "description": "The issue is open and ready for the assignee to start work on it.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
            "id": "1",
            "name": "Open",
            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
            "statusCategory": {
                "colorName": "blue-gray",
                "id": 2,
                "key": "new",
                "name": "To Do",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
            }
        },
        "subtasks": [],
        "summary": "Some zip files passed with spark-submit --archives causing \"invalid CEN header\" error",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2018-06-14T21:46:05.000+0000",
        "versions": [],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/YARN-8430/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/YARN-8430/watchers",
            "watchCount": 1
        },
        "workratio": -1
    },
    "id": "13166067",
    "key": "YARN-8430",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13166067"
}