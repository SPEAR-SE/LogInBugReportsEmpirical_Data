{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Sandy Ryza",
            "key": "sandyr",
            "name": "sandyr",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=sandyr",
            "timeZone": "America/Los_Angeles"
        },
        "components": [{
            "id": "12319325",
            "name": "scheduler",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12319325"
        }],
        "created": "2013-03-14T18:52:43.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Vitaly Kruglikov",
            "key": "vkruglikov",
            "name": "vkruglikov",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=vkruglikov",
            "timeZone": "America/Los_Angeles"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2013-03-14T20:11:32.143+0000",
        "customfield_12310222": "1_*:*_1_*:*_1305526453_*|*_5_*:*_1_*:*_0",
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310320": null,
        "customfield_12310420": "317564",
        "customfield_12310920": "317905",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i1isnz:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Mar 29 21:31:15 UTC 2013",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "This is reliably reproduced while running CDH4.1.2 or CDH4.2.0 on a single Mac OS X machine.\n\n# Two queues are being configured: cjmQ and slotsQ. Both queues are configured with tiny minResources. The intention is for the task(s) of the job in cjmQ to be able to preempt tasks of the job in slotsQ.\n# yarn.nodemanager.resource.memory-mb = 24576\n# First, a long-running 6-map-task (0 reducers) mapreduce job is started in slotsQ with mapreduce.map.memory.mb=4096. Because MRAppMaster's container consumes some memory, only 5 of its 6 map tasks are able to start, and the 6th is pending, but will never run.\n# Then, a short-running 1-map-task (0 reducers) mapreduce job is submitted via cjmQ with mapreduce.map.memory.mb=2048.\n\nExpected behavior:\nAt this point, because the minimum share of cjmQ has not been met, I expected Fair Scheduler to preempt one of the executing map tasks from the single slotsQ mapreduce job to make room for the single map tasks of the cjmQ mapreduce job. However, Fair Scheduler didn't preempt any of the running map tasks of the slotsQ job. Instead, the cjmQ job was being starved perpetually. Since slotsQ had far more than its minimum share allocated to it and already running, while cjmQ was far below its minimum share (0 actually), Fair Scheduler should have started preempting, regardless of there being one task container from the slotsQ job (the 6th map container) that was not being allocated.\n\nAdditional useful info:\n# If I summit a second 1-map-task mapreduce job via cjmQ, the first cjmQ mapreduce job in that Q gets scheduled and its state changes to RUNNING; once that that first job completes, then the second job submitted via cjmQ gets starved until a third job is submitted into cjmQ, and so on. This happens regardless of the values of maxRunningApps in the queue configurations.\n# If, instead of requesting 6 map tasks for the slotsQ job, I only request 5 so that everything fits nicely into yarn.nodemanager.resource.memory-mb - without that 6th pending, but not running task - then preemption works as I would have expected. However, I cannot rely on this arrangement because in a production cluster that is running at full capacity, if a machine dies, the mapreduce job from slotsQ will request new containers for the failed tasks and because the cluster was already at capacity, those containers will end up as pending and will never run, recreating my original scenario of the starving cjmQ job.\n# I initially wrote this up on https://groups.google.com/a/cloudera.org/forum/?fromgroups=#!topic/cdh-user/0zv62pkN5lM, so it would be good to update that group with the resolution.\n\nConfiguration:\n\nIn yarn-site.xml:\n{code}\n  <property>\n    <description>Scheduler plug-in class to use instead of the default scheduler.<\/description>\n    <name>yarn.resourcemanager.scheduler.class<\/name>\n    <value>org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler<\/value>\n  <\/property>\n{code}\n\nfair-scheduler.xml:\n{code}\n<configuration>\n\n<!-- Site specific FairScheduler configuration properties -->\n  <property>\n    <description>Absolute path to allocation file. An allocation file is an XML\n    manifest describing queues and their properties, in addition to certain\n    policy defaults. This file must be in XML format as described in\n    http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/FairScheduler.html.\n    <\/description>\n    <name>yarn.scheduler.fair.allocation.file<\/name>\n    <value>[obfuscated]/current/conf/site/default/hadoop/fair-scheduler-allocations.xml<\/value>\n  <\/property>\n\n  <property>\n    <description>Whether to use preemption. Note that preemption is experimental\n    in the current version. Defaults to false.<\/description>\n    <name>yarn.scheduler.fair.preemption<\/name>\n    <value>true<\/value>\n  <\/property>\n\n  <property>\n    <description>Whether to allow multiple container assignments in one\n    heartbeat. Defaults to false.<\/description>\n    <name>yarn.scheduler.fair.assignmultiple<\/name>\n    <value>true<\/value>\n  <\/property>\n  \n<\/configuration>\n{code}\n\nMy fair-scheduler-allocations.xml:\n{code}\n<allocations>\n\n  <queue name=\"cjmQ\">\n    <!-- minimum amount of aggregate memory; TODO which units??? -->\n    <minResources>2048<\/minResources>\n\n    <!-- limit the number of apps from the queue to run at once -->\n    <maxRunningApps>1<\/maxRunningApps>\n    \n    <!-- either \"fifo\" or \"fair\" depending on the in-queue scheduling policy\n    desired -->\n    <schedulingMode>fifo<\/schedulingMode>\n\n    <!-- Number of seconds after which the pool can preempt other pools'\n      tasks to achieve its min share. Requires preemption to be enabled in\n      mapred-site.xml by setting mapred.fairscheduler.preemption to true.\n      Defaults to infinity (no preemption). -->\n    <minSharePreemptionTimeout>5<\/minSharePreemptionTimeout>\n\n    <!-- Pool's weight in fair sharing calculations. Defaulti is 1.0. -->\n    <weight>1.0<\/weight>\n  <\/queue>\n\n  <queue name=\"slotsQ\">\n    <!-- minimum amount of aggregate memory; TODO which units??? -->\n    <minResources>1<\/minResources>\n\n    <!-- limit the number of apps from the queue to run at once -->\n    <maxRunningApps>1<\/maxRunningApps>\n\n    <!-- Number of seconds after which the pool can preempt other pools'\n      tasks to achieve its min share. Requires preemption to be enabled in\n      mapred-site.xml by setting mapred.fairscheduler.preemption to true.\n      Defaults to infinity (no preemption). -->\n    <minSharePreemptionTimeout>5<\/minSharePreemptionTimeout>\n\n    <!-- Pool's weight in fair sharing calculations. Defaulti is 1.0. -->\n    <weight>1.0<\/weight>\n  <\/queue>\n  \n  <!-- number of seconds a queue is under its fair share before it will try to\n  preempt containers to take resources from other queues. -->\n  <fairSharePreemptionTimeout>5<\/fairSharePreemptionTimeout>\n\n<\/allocations>\n\n{code}",
        "duedate": null,
        "environment": "Mac OS X; CDH4.1.2; CDH4.2.0",
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": ["hadoop"],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135"
            },
            "id": "12313722",
            "key": "YARN",
            "name": "Hadoop YARN",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12313722"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Vitaly Kruglikov",
            "key": "vkruglikov",
            "name": "vkruglikov",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=vkruglikov",
            "timeZone": "America/Los_Angeles"
        },
        "resolution": {
            "description": "All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.",
            "id": "5",
            "name": "Cannot Reproduce",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/5"
        },
        "resolutiondate": "2013-03-29T21:31:30.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "Fair Scheduler preemption fails if the other queue has a mapreduce job with some tasks in excess of cluster capacity",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2013-03-29T21:31:30.000+0000",
        "versions": [],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/YARN-484/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/YARN-484/watchers",
            "watchCount": 5
        },
        "workratio": -1
    },
    "id": "12637072",
    "key": "YARN-484",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12637072"
}