[Attach the logs and configure file, Should we move this to YARN?, Yes. It seems to be a YARN issue. I will take this., Not sure the rackLocalRequest is cause of NPE, Better to check rackLocalRequest whether is null before rackLocalRequest.setNumContainers
{code}
ResourceRequest rackLocalRequest = requests.get(priority).get(node.getRackName());
rackLocalRequest.setNumContainers(rackLocalRequest.getNumContainers() - 1);
{code}, [~gujilangzi], are you working on this? If so, assign this JIRA to you. Please attach the log of NPE for latest trunk, I will also help to look at it. Thx! , Thanks a lot Junping! please refer to YARN-1572-log.tar.gz  for the log of NPE for latest trunk.

java.lang.NullPointerException
        at org.apache.hadoop.yarn.server.resourcemanager.scheduler.AppSchedulingInfo.allocateNodeLocal(AppSchedulingInfo.java:311)
, I agree with solution.
It affects version 2.3.0 as well, any patch/ solution found yet?, This is a bad bug, adding null check seems enough to me, this could caused by user uses ApplicationMasterProtocol instead of AMRMClient, adding node-label request but doesn't add rack-local request. [~gujilangzi], are you still working on this?, Fix for YARN-1572 applies to 2.3.0, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12708801/0001-Fix-for-YARN-1572.patch
  against trunk revision 3c7adaa.

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-YARN-Build/7195//console

This message is automatically generated., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12708878/YARN-1572-branch-2.3.0.001.patch
  against trunk revision f383fd9.

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-YARN-Build/7197//console

This message is automatically generated., Hi [~gujilangzi], the patch you uploaded is a branch-2 patch. Could you please work on a trunk patch ?, The patch no longer applies to trunk. I'm canceling this patch as a clean up. [~wangda] maybe you'd like to follow up on this? Thanks! ]