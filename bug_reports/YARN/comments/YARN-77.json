[Between line 236 and 240 below(in the attach file I uploaded),we can see that the tearDown() method in  TestAMRMRPCNodeUpdates.java has been invoked before  syncNodeHeartbeat(nm4, false) completed.

2012-09-01 02:06:37,651 DEBUG [AsyncDispatcher event handler] rmnode.RMNodeImpl (RMNodeImpl.java:handle(303)) - Processing h4:1234 of type STATUS_UPDATE
2012-09-01 02:06:37,651 DEBUG [main] delegation.AbstractDelegationTokenSecretManager (AbstractDelegationTokenSecretManager.java:stopThreads(368)) - Stopping expired delegation token remover thread
2012-09-01 02:06:37,652 ERROR [Thread[Thread-4,5,main]] delegation.AbstractDelegationTokenSecretManager (AbstractDelegationTokenSecretManager.java:run(418)) - InterruptedExcpetion recieved for ExpiredTokenRemover thread java.lang.InterruptedException: sleep interrupted
2012-09-01 02:06:37,652 DEBUG [main] impl.MetricsSystemImpl (MetricsSystemImpl.java:shutdown(534)) - refCount=1
2012-09-01 02:06:37,652 INFO  [AsyncDispatcher event handler] rmnode.RMNodeImpl (RMNodeImpl.java:handle(315)) - h4:1234 Node Transitioned from RUNNING to UNHEALTHY, In other words ,method "syncNodeHeartbeat" doesn't work synchronously. DrainDispatcher's await() method has return before queue becomes empty., Haven't met this issue for months,so close it.Any one can reopen it if you met the same problem., Ran into this again. Taking a look., In DrainDispatcher#getEventHandler(), drained is explicitly being set to false. IIUC, it shouldn't be., [~vinodkv], do you remember why {{drained}} is being set to false?, I suspect this is due to a race in FifoScheduler. I think the reason we stopped seeing the failures on trunk/branch-2 is the change in default to CapacityScheduler. Investigating., Have been monitoring this test for a while now, and haven't seen any failures. Closing it until we encounter another failure.]