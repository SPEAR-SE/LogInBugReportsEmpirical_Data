[There must be an additional exception which has resulted into this.. can you please attach NM logs for this?  is it related to  YARN-573 ??, Didn't know this before, the default number of parallel downloads is 4, can you increase yarn.nodemanager.localizer.fetch.thread-count and try again? It's a NM config, so you have to restart NMs after this change.

Seems like you have lots of public distributed cache files, it has to be increased depending on that.., Yes Vinod you are correct we have lot of files in the downloading state before this incident happened. will update you with our finding after the config change suggested.
Also will post the NM logs., And also this incident is not happening every time, it is infrequent. Following is the entire stack trace Omkar


2013-07-25 23:06:09,851 INFO  containermanager.ContainerManagerImpl - Start request for container_1374637086174_0533_01_000002 by user testuser
2013-07-25 23:06:09,851 INFO  containermanager.ContainerManagerImpl - Creating a new application reference for app application_1374637086174_0533
2013-07-25 23:06:09,851 INFO  nodemanager.NMAuditLogger - USER=testuser      IP=10.224.111.21        OPERATION=Start Container Request       TARGET=ContainerManageImpl      RESULT=SUCCESS  APPID=application_1374637086174_0533    CONTAINERID=container_1374637086174_0533_01_000002
2013-07-25 23:06:09,852 INFO  application.Application - Application application_1374637086174_0533 transitioned from NEW to INITING
2013-07-25 23:06:09,853 INFO  application.Application - Adding container_1374637086174_0533_01_000002 to application application_1374637086174_0533
2013-07-25 23:06:09,944 INFO  application.Application - Application application_1374637086174_0533 transitioned from INITING to RUNNING
2013-07-25 23:06:09,948 INFO  container.Container - Container container_1374637086174_0533_01_000002 transitioned from NEW to LOCALIZING
2013-07-25 23:06:09,948 INFO  containermanager.AuxServices - Got event APPLICATION_INIT for appId application_1374637086174_0533
2013-07-25 23:06:09,948 INFO  containermanager.AuxServices - Got APPLICATION_INIT for service mapreduce.shuffle
2013-07-25 23:06:09,948 INFO  mapred.ShuffleHandler - Added token for job_1374637086174_0533
2013-07-25 23:06:09,948 INFO  localizer.LocalizedResource - Resource hdfs://internal-EMPTY-gfist1/testuser-wsl/test_case/PreDriverTest/testJobWithFakeQueries/10383925454001385/sfdc_lib/10381068948677006/locale-sh-0.0.3.jar transitioned from INIT to DOWNLOADING
2013-07-25 23:06:09,948 INFO  localizer.LocalizedResource - Resource hdfs://internal-EMPTY-gfist1/testuser-wsl/test_case/PreDriverTest/testJobWithFakeQueries/10383925454001385/sfdc_lib/10381068948677006/hadoop-mapreduce-client-app-2.0.0-cdh4.2.1.jar transitioned from INIT to DOWNLOADING
2013-07-25 23:06:09,948 INFO  localizer.LocalizedResource - Resource hdfs://internal-EMPTY-gfist1/testuser-wsl/test_case/PreDriverTest/testJobWithFakeQueries/10383925454001385/sfdc_lib/10381068948677006/mahout-utils-0.5.jar transitioned from INIT to DOWNLOADING
2013-07-25 23:06:09,948 INFO  localizer.LocalizedResource - Resource hdfs://internal-EMPTY-gfist1/testuser-wsl/test_case/PreDriverTest/testJobWithFakeQueries/10383925454001385/sfdc_lib/10381068948677006/avro-1.3.0-rc1-sfdc-patch1.jar transitioned from INIT to DOWNLOADING
2013-07-25 23:06:09,948 INFO  localizer.LocalizedResource - Resource hdfs://internal-EMPTY-gfist1/testuser-wsl/test_case/PreDriverTest/testJobWithFakeQueries/10383925454001385/sfdc_lib/10381068948677006/jung-samples-2.0.1.jar transitioned from INIT to DOWNLOADING
2013-07-25 23:06:09,948 INFO  localizer.LocalizedResource - Resource hdfs://internal-EMPTY-gfist1/testuser-wsl/test_case/PreDriverTest/testJobWithFakeQueries/10383925454001385/sfdc_lib/10381068948677006/commons-math-2.1.jar transitioned from INIT to DOWNLOADING
2013-07-25 23:06:09,948 INFO  localizer.LocalizedResource - Resource hdfs://internal-EMPTY-gfist1/testuser-wsl/test_case/PreDriverTest/testJobWithFakeQueries/10383925454001385/sfdc_lib/10381068948677006/vtd-xml-2.6.jar transitioned from INIT to DOWNLOADING

â€¦.. around 30 jars are in downloading state.

2013-07-25 23:06:09,957 INFO  localizer.ResourceLocalizationService - Downloading public rsrc:{ hdfs://internal-EMPTY-gfist1/testuser-wsl/test_case/PreDriverTest/testJobWithFakeQueries/10383925454001385/sfdc_lib/10381068948677006/locale-sh-0.0.3.jar, 1374793533752, FILE, null }
2013-07-25 23:06:09,957 FATAL event.AsyncDispatcher - Error in dispatcher thread
java.util.concurrent.RejectedExecutionException
        at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:1768)
        at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:767)
        at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:658)
        at java.util.concurrent.ExecutorCompletionService.submit(ExecutorCompletionService.java:152)
        at org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$PublicLocalizer.addResource(ResourceLocalizationService.java:621)
        at org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$LocalizerTracker.handle(ResourceLocalizationService.java:516)
        at org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$LocalizerTracker.handle(ResourceLocalizationService.java:458)
        at org.apache.hadoop.yarn.event.AsyncDispatcher.dispatch(AsyncDispatcher.java:128)
        at org.apache.hadoop.yarn.event.AsyncDispatcher$1.run(AsyncDispatcher.java:77)
        at java.lang.Thread.run(Thread.java:662)
2013-07-25 23:06:09,958 INFO  event.AsyncDispatcher - Exiting, bbye..
2013-07-25 23:06:09,959 INFO  service.AbstractService - Service:Dispatcher is stopped.
2013-07-25 23:06:09,986 INFO  mortbay.log - Stopped SelectChannelConnector@0.0.0.0:8042
2013-07-25 23:06:10,086 INFO  service.AbstractService - Service:org.apache.hadoop.yarn.server.nodemanager.webapp.WebServer is stopped.

, Yeah it can occur either if you have hit the thread limit or nm crashed and called shutdown on exec before it received new request. I have faced this issue in past in which nm crashed resulting into exec.shutdown() and then this exception..NM logs & AM logs will definitely help. [~raghu.hbase@gmail.com] can you please attach logs?, [~raghu.hbase@gmail.com] did you see this message in logs?
{code}
        LOG.info("Public cache exiting");
{code}
before or after above stack trace?, [~vinodkv] regarding
{quote}
Didn't know this before, the default number of parallel downloads is 4, can you increase yarn.nodemanager.localizer.fetch.thread-count and try again?
{quote}

What is a good way to determine the ideal value for this config?

Question for everyone - what is the reasoning behind killing a process when a threshold is met instead of throttling or something else to that effect? It makes sense in a few cases, but killing in this case seems quite drastic, no?
, Okay, I was wrong. The queue is unbounded, the default 4 threads is just a core pool size. [~ojoshi] is right, it must have been caused by some other problem, sharing logs will be helpful., Application master log for failed mapreduce job which caused nodemanager to shutdown., Node manager and app master logs are posted, please let me know if more information is needed., [~raghu.hbase@gmail.com] can you upload nm logs?, NodeManager log, [~raghu.hbase@gmail.com] I was looking for more log information specifically below code path execution which I am sure has taken place.... more detailed logs rather than truncated logs will be really helpful...Thanks.
{code}
      } finally {
        LOG.info("Public cache exiting");
        threadPool.shutdownNow();
      }
{code}, Yeap attached the original log , yes I can see that message you pointed out in the log. earlier I was posting a truncated log, now you can find the entire log attached., 2013-07-25 22:46:35,573 INFO  localizer.ResourceLocalizationService - Public cache exiting is found in the log., yeah it is related to YARN-573... probably I should fix that..
{code}
java.lang.IllegalArgumentException: java.net.UnknownHostException: gforceist-gforceist-EMPTYSPEC
	at org.apache.hadoop.security.SecurityUtil.buildTokenService(SecurityUtil.java:414)
	at org.apache.hadoop.hdfs.NameNodeProxies.createNonHAProxy(NameNodeProxies.java:164)
	at org.apache.hadoop.hdfs.NameNodeProxies.createProxy(NameNodeProxies.java:129)
	at org.apache.hadoop.hdfs.DFSClient.<init>(DFSClient.java:448)
	at org.apache.hadoop.hdfs.DFSClient.<init>(DFSClient.java:410)
	at org.apache.hadoop.hdfs.DistributedFileSystem.initialize(DistributedFileSystem.java:128)
	at org.apache.hadoop.fs.FileSystem.createFileSystem(FileSystem.java:2297)
	at org.apache.hadoop.fs.FileSystem.access$200(FileSystem.java:87)
	at org.apache.hadoop.fs.FileSystem$Cache.getInternal(FileSystem.java:2331)
	at org.apache.hadoop.fs.FileSystem$Cache.get(FileSystem.java:2313)
	at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:351)
	at org.apache.hadoop.fs.Path.getFileSystem(Path.java:194)
	at org.apache.hadoop.yarn.util.FSDownload.copy(FSDownload.java:94)
	at org.apache.hadoop.yarn.util.FSDownload.call(FSDownload.java:193)
	at org.apache.hadoop.yarn.util.FSDownload.call(FSDownload.java:50)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.Thread.run(Thread.java:662)
Caused by: java.net.UnknownHostException: gforceist-gforceist-EMPTYSPEC
	... 23 more
2013-07-25 22:46:35,571 INFO  localizer.LocalizedResource - Resource hdfs://gforceist-gforceist-EMPTYSPEC/ist9-na1/test_lib/201307221733560961/gridforceJobs.jar transitioned from DOWNLOADING to INIT
2013-07-25 22:46:35,573 INFO  localizer.LocalizedResource - Resource hdfs://gforceist-gforceist-EMPTYSPEC/ist9-na1/test_lib/201307221733560961/hadoop-mapreduce-client-hs-2.0.0-cdh4.2.1.jar transitioned from DOWNLOADING to INIT
2013-07-25 22:46:35,573 INFO  localizer.LocalizedResource - Resource hdfs://gforceist-gforceist-EMPTYSPEC/ist9-na1/test_lib/201307221733560961/wsc_partnerwsdl_previous.jar transitioned from DOWNLOADING to INIT
2013-07-25 22:46:35,573 FATAL localizer.ResourceLocalizationService - Error: Shutting down
java.util.ConcurrentModificationException
	at java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:761)
	at java.util.LinkedList$ListItr.next(LinkedList.java:696)
	at org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.LocalizedResource.toString(LocalizedResource.java:120)
	at java.lang.String.valueOf(String.java:2826)
	at java.lang.StringBuilder.append(StringBuilder.java:115)
	at org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$PublicLocalizer.run(ResourceLocalizationService.java:659)
2013-07-25 22:46:35,573 INFO  localizer.LocalizedResource - Resource hdfs://gforceist-gforceist-EMPTYSPEC/ist9-na1/test_lib/201307221733560961/test-phoenix-1.2.1.jar transitioned from DOWNLOADING to INIT
2013-07-25 22:46:35,573 INFO  localizer.ResourceLocalizationService - Public cache exiting
{code}
, closing this as duplicate, Tx for debugging [~ojoshi]!]