[Hi [~bibinchundatt]
Thanks for reporting this.

I feel it is better to throw back an error from NodeLabelManager when a duplication occurs. Because if we are trying to overwrite the exclusivity of a label, we may need few more tuning in scheduler side.

Thoughts?, Exclusive updation for label from true to false is not supported.
IMO can handle  in two ways 

# Add validation in {{CommonNodeLabelsManager#addToCluserNodeLabels}} when duplicate added and exception to console 
# Improve logs in RM as below

{code}
 if (null != dispatcher && !newLabels.isEmpty()) {
      dispatcher.getEventHandler().handle(
          new StoreNewClusterNodeLabels(newLabels));
     LOG.info("Add labels: [" + StringUtils.join(labels.iterator(), ",") + "]");
    }else{
     LOG.info("Skipped labels: [" + StringUtils.join(skippedlabels.iterator(), ",") + "]");
     }    
{code}

Any comments?, [~sunilg]
{quote}
I feel it is better to throw back an error from NodeLabelManager when a duplication occurs.
{quote}
I do support this . Any impact in distributed mode? , [~leftnoteasy] , [~sunilg] attaching initial patch for review, Attaching patch with testcase for review, \\
\\
| (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  16m  4s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   7m 38s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 37s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 23s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   0m 53s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 21s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 32s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 34s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | yarn tests |   1m 56s | Tests passed in hadoop-yarn-common. |
| | |  40m  1s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12747230/0002-YARN-3963.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 156f24e |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-YARN-Build/8675/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/8675/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/8675/console |


This message was automatically generated., I think we shouldn't throw exception in this case. It's better to print some WARN message at client side when trying to add existed labels, but currently YARN lack of channel to put diagnostic information. I would prefer to print WARN message at service side, and keeps the behavior unchanged.

Thoughts? [~sunilg], [~bibinchundatt]., Hi [~leftnoteasy],
How will the user know if he is not informed that the last operation failed ? Any limitations if we throw exception ? I feel user need to be informed if not he will assume that last operation succeeded.
 
, Hi [~bibinchundatt],
In Distributed mode, only node to label mapping is done by individual NM's so there should not be any impact in distributed mode. , Thanks comment, [~Naganarasimha]. I think we can throw exception only if added node label has different attribute. If node label has same name and attribute, it should be simply ignored., this approach should be fine !, [~leftnoteasy] and [~Naganarasimha] Thanks for review and comments.
Have updated the patch as per the comments. Only when parameters are changed the exception is thrown now ., Hi [~bibinchundatt], 
??throw new IOException("Label=" + label.getName() + "(" + rmNodeLabel.getIsExclusive() + ")" + " already added");??
message would be better as 
{{throw new IOException("Exclusivity cannot be modified for an existing label : " + label.getName() + "(" + rmNodeLabel.getIsExclusive() + ")" );}}

In test case ??Assert.fail("IOException not thrown should have on adding same labels");??
I think better message would be {{"IOException is expected when exlusivity is modified"}}, Also can we check for all labels and print one message ?, \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  18m 55s | Findbugs (version ) appears to be broken on trunk. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |  10m 42s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  12m  3s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 27s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   0m 36s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 37s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 40s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 55s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | yarn tests |   2m 20s | Tests passed in hadoop-yarn-common. |
| | |  49m 19s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12747398/0003-YARN-3963.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / f36835f |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-YARN-Build/8679/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/8679/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf903.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/8679/console |


This message was automatically generated., [~Naganarasimha] Thank you for your review comments.
[~leftnoteasy] Updated patch handling all comments., \\
\\
| (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  17m 32s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   8m  3s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 56s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 24s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   0m 56s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  1s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 21s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 33s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 36s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | yarn tests |   1m 55s | Tests passed in hadoop-yarn-common. |
| | |  42m 20s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12747408/0004-YARN-3963.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / f36835f |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-YARN-Build/8681/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/8681/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf904.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/8681/console |


This message was automatically generated., [~bibinchundatt],
Latest patch looks fine ...
, Thanks [~bibinchundatt] for the updated patch. +1 for same.
As mentioned by [~leftnoteasy] and [~Naganarasimha], its better to throw exception in client side while we fail to update/add node label.
As I see it, I can see full exception stack trace in client side in this case (also in case of other commands too) and its too verbose. I think we can make its compact and n it will be more easily readable.  I ll file a separate ticket if its ok., Looks good, committing.., Committed to branch-2/trunk, thanks [~bibinchundatt] and review from [~sunilg]/[~Naganarasimha]!, FAILURE: Integrated in Hadoop-trunk-Commit #8244 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8244/])
YARN-3963. AddNodeLabel on duplicate label addition shows success. (Bibin A Chundatt via wangda) (wangda: rev 8acb30b0167e498991aef6993df7e36020428844)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/nodelabels/CommonNodeLabelsManager.java
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/nodelabels/TestCommonNodeLabelsManager.java
* hadoop-yarn-project/CHANGES.txt
, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #273 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/273/])
YARN-3963. AddNodeLabel on duplicate label addition shows success. (Bibin A Chundatt via wangda) (wangda: rev 8acb30b0167e498991aef6993df7e36020428844)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/nodelabels/TestCommonNodeLabelsManager.java
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/nodelabels/CommonNodeLabelsManager.java
, SUCCESS: Integrated in Hadoop-Yarn-trunk #1003 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/1003/])
YARN-3963. AddNodeLabel on duplicate label addition shows success. (Bibin A Chundatt via wangda) (wangda: rev 8acb30b0167e498991aef6993df7e36020428844)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/nodelabels/TestCommonNodeLabelsManager.java
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/nodelabels/CommonNodeLabelsManager.java
* hadoop-yarn-project/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #262 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/262/])
YARN-3963. AddNodeLabel on duplicate label addition shows success. (Bibin A Chundatt via wangda) (wangda: rev 8acb30b0167e498991aef6993df7e36020428844)
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/nodelabels/TestCommonNodeLabelsManager.java
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/nodelabels/CommonNodeLabelsManager.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2219 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2219/])
YARN-3963. AddNodeLabel on duplicate label addition shows success. (Bibin A Chundatt via wangda) (wangda: rev 8acb30b0167e498991aef6993df7e36020428844)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/nodelabels/CommonNodeLabelsManager.java
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/nodelabels/TestCommonNodeLabelsManager.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2200 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2200/])
YARN-3963. AddNodeLabel on duplicate label addition shows success. (Bibin A Chundatt via wangda) (wangda: rev 8acb30b0167e498991aef6993df7e36020428844)
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/nodelabels/TestCommonNodeLabelsManager.java
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/nodelabels/CommonNodeLabelsManager.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #270 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/270/])
YARN-3963. AddNodeLabel on duplicate label addition shows success. (Bibin A Chundatt via wangda) (wangda: rev 8acb30b0167e498991aef6993df7e36020428844)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/nodelabels/CommonNodeLabelsManager.java
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/nodelabels/TestCommonNodeLabelsManager.java
]