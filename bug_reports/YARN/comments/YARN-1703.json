[There 3 ways we can handle this problem.
1. Add HttpMethod.setRequestHeader("Connection","close"); in method WebAppProxyServlet.proxyLink()
2. Close HttpConnectionManager in finally block.
3. Reuse HttpClient instance ., I initially thought to reuse HttpClient instance along with MultiThreadedHttpConnectionManager. This cause many connections to open in pool. Again closing this in finally block cause always to CLOSE_WAIT for one connection. So I think 1st is better. 

Update the patch with 1st solution and verified it. Please review the patch., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12627965/YARN-1703.1.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/3051//testReport/
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/3051//console

This message is automatically generated., I am attaching connection established for accesing 1 application master ui. On every manuall refresh , it is incrementing more than 30 connections.


{noformat}
host-10-18-40-71:/home/OpenSource/hadoop-3.0.0-SNAPSHOT/sbin # netstat -tnpla | grep <ProxyServer_PID>
tcp        0      0 0.0.0.0:4996            0.0.0.0:*               LISTEN      27664/java
tcp        0      0 10.18.40.71:45029       :::*                    LISTEN      27664/java
tcp        1      0 10.18.40.71:58696       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        1      0 10.18.40.71:10375       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        1      0 10.18.40.71:27934       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        0      0 10.18.40.71:29802       10.18.40.77:45022       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:43589       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45347       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:10980       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:37156       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:37989       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:18116       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:50766       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        1      0 10.18.40.71:18836       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        1      0 10.18.40.71:19376       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        1      0 10.18.40.71:25214       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:54847       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:12605       ESTABLISHED 27664/java
tcp        1      0 10.18.40.71:50339       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        0      0 10.18.40.71:49870       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:50956       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        1      0 10.18.40.71:16896       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        0      0 10.18.40.71:43026       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:12091       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:49205       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:29968       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        1      0 10.18.40.71:34355       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        0      0 10.18.40.71:54701       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:47084       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:32938       ESTABLISHED 27664/java
tcp        1      0 10.18.40.71:28034       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        1      0 10.18.40.71:40430       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:56572       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:60771       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:39165       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:20341       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        1      0 10.18.40.71:22649       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        1      0 10.18.40.71:23049       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        0      0 10.18.40.71:52172       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:57790       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:17880       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:22911       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:52107       10.18.40.71:56297       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:38345       ESTABLISHED 27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:40127       ESTABLISHED 27664/java
tcp        1      0 10.18.40.71:18287       10.18.40.71:56297       CLOSE_WAIT  27664/java
tcp        0      0 10.18.40.71:45029       10.18.40.77:30754       ESTABLISHED 27664/java

{noformat}, Updated patch rebasing to latest code. I verified after this change, it is wroking. Please review the patch.., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12637370/YARN-1703.2.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/3484//testReport/
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/3484//console

This message is automatically generated., Hi all, Could anyone review the patch please?, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12637370/YARN-1703.2.patch
  against trunk revision 428a766.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/5117//testReport/
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/5117//console

This message is automatically generated., Closing connections explicitly makes sense to me given there isn't much point in reusing connections.

+1, checking this in., Committed this to trunk and branch-2. Thanks Rohith., FAILURE: Integrated in Hadoop-trunk-Commit #6554 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6554/])
YARN-1703. Fixed ResourceManager web-proxy to close connections correctly. Contributed by Rohith Sharma. (vinodkv: rev 198fb58776ec02397af5ad83259535b0291b745c)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy/src/main/java/org/apache/hadoop/yarn/server/webproxy/WebAppProxyServlet.java
* hadoop-yarn-project/CHANGES.txt
, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #7 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/7/])
YARN-1703. Fixed ResourceManager web-proxy to close connections correctly. Contributed by Rohith Sharma. (vinodkv: rev 198fb58776ec02397af5ad83259535b0291b745c)
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy/src/main/java/org/apache/hadoop/yarn/server/webproxy/WebAppProxyServlet.java
, SUCCESS: Integrated in Hadoop-Yarn-trunk #745 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/745/])
YARN-1703. Fixed ResourceManager web-proxy to close connections correctly. Contributed by Rohith Sharma. (vinodkv: rev 198fb58776ec02397af5ad83259535b0291b745c)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy/src/main/java/org/apache/hadoop/yarn/server/webproxy/WebAppProxyServlet.java
* hadoop-yarn-project/CHANGES.txt
, SUCCESS: Integrated in Hadoop-Hdfs-trunk-Java8 #7 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/7/])
YARN-1703. Fixed ResourceManager web-proxy to close connections correctly. Contributed by Rohith Sharma. (vinodkv: rev 198fb58776ec02397af5ad83259535b0291b745c)
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy/src/main/java/org/apache/hadoop/yarn/server/webproxy/WebAppProxyServlet.java
, SUCCESS: Integrated in Hadoop-Hdfs-trunk #1935 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1935/])
YARN-1703. Fixed ResourceManager web-proxy to close connections correctly. Contributed by Rohith Sharma. (vinodkv: rev 198fb58776ec02397af5ad83259535b0291b745c)
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy/src/main/java/org/apache/hadoop/yarn/server/webproxy/WebAppProxyServlet.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1959 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1959/])
YARN-1703. Fixed ResourceManager web-proxy to close connections correctly. Contributed by Rohith Sharma. (vinodkv: rev 198fb58776ec02397af5ad83259535b0291b745c)
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy/src/main/java/org/apache/hadoop/yarn/server/webproxy/WebAppProxyServlet.java
, SUCCESS: Integrated in Hadoop-Mapreduce-trunk-Java8 #7 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/7/])
YARN-1703. Fixed ResourceManager web-proxy to close connections correctly. Contributed by Rohith Sharma. (vinodkv: rev 198fb58776ec02397af5ad83259535b0291b745c)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-web-proxy/src/main/java/org/apache/hadoop/yarn/server/webproxy/WebAppProxyServlet.java
* hadoop-yarn-project/CHANGES.txt
, Thanks vinod for reviewing and commiting patch:-)]