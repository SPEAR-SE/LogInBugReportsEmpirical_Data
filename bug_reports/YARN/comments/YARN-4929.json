[This patch depends on YARN-4807. So I didn't push the "Submit Patch" button  since YARN-4807 hasn't got committed., I delete my first patch since these changes have been in YARN-4807.]