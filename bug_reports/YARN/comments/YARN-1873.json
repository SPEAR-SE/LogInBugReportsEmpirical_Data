[Dup of YARN-1872 ?, I see it is a Timeout issue in YARN-1872. The error reported here is an assertion failure. I think this is a different issue, [~mdesai], does it fail only with JDK7? does it fail only on trunk, or on branch-2 as well?, Yes it fails on branch-2.4. I updated the JIRA to reflect that.
I am using JDK7. Have not tried with JDK6. But this is clearly a cleanup issue so I assumed it is JDK7 issue. If I ran the test testDSShell independently, it never fails., Hm, i can image the problem. MiniYARNCluster is static, such that the timeline store is going to have the entities from all test cases in TestDistributedShell. I cannot reproduce it locally, because testDSShell is always executed first.

{code}
  protected static MiniYARNCluster yarnCluster = null;
{code}
, I'll work on a patch for it. Take it over. Thanks for finding the issue. [~mdesai]!, Attaching the patch, [~zjshen], Didn't see your comment. Attached the patch already, {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12636768/YARN-1873.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/3455//testReport/
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/3455//console

This message is automatically generated., [~mitdesai], no problem. I've reviewed your patch. The approach should work. One comment on the patch:
 These vars don't need to be static any more.
{code}
  protected static MiniYARNCluster yarnCluster = null;
  protected static Configuration conf = new YarnConfiguration();

  protected static String APPMASTER_JAR = JarFinder.getJar(ApplicationMaster.class);
{code}, I'll change them and upload a new patch. Thanks for the review!, Attached the new patch, The patch looks almost good to me. One nit:

I checked and found "APPMASTER_JAR" is never changed across the code. I thought it's better to be a "final static" constant. Sorry for my prior misleading., I looked at it. Can you let me know if we need to make it
{{protected final String APPMASTER_JAR = JarFinder.getJar(ApplicationMaster.class);}}
or
{{protected final static String APPMASTER_JAR = JarFinder.getJar(ApplicationMaster.class);}}

I think making it final instead of final static will be enough. What do you say?, APPMASTER_JAR is a jar will be taken without modification inall the test cases, therefore, it should be safe to be static., Made the changes!, {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12636931/YARN-1873.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/3464//testReport/
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/3464//console

This message is automatically generated., +1. LGTM. I've run the patch locally: The failure was gone when the test cases were out of order. It took around 80s to complete all the test cases, which looked still fine to me., Committed to trunk, branch-2 and branch-2.4. Thanks, [~mitdesai]!, The issue reported on YARN-1872 was this problem. Thanks Mit and Zhijie!, SUCCESS: Integrated in Hadoop-trunk-Commit #5412 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/5412/])
YARN-1873. Fixed TestDistributedShell failure when the test cases are out of order. Contributed by Mit Desai. (zjshen: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1582060)
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/test/java/org/apache/hadoop/yarn/applications/distributedshell/TestDistributedShell.java
, SUCCESS: Integrated in Hadoop-Yarn-trunk #522 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/522/])
YARN-1873. Fixed TestDistributedShell failure when the test cases are out of order. Contributed by Mit Desai. (zjshen: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1582060)
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/test/java/org/apache/hadoop/yarn/applications/distributedshell/TestDistributedShell.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1739 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1739/])
YARN-1873. Fixed TestDistributedShell failure when the test cases are out of order. Contributed by Mit Desai. (zjshen: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1582060)
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/test/java/org/apache/hadoop/yarn/applications/distributedshell/TestDistributedShell.java
, SUCCESS: Integrated in Hadoop-Hdfs-trunk #1714 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1714/])
YARN-1873. Fixed TestDistributedShell failure when the test cases are out of order. Contributed by Mit Desai. (zjshen: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1582060)
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/test/java/org/apache/hadoop/yarn/applications/distributedshell/TestDistributedShell.java
]