[Looks like this NPE occurs due to the revert of HADOOP-14077 . There was a refactoring of AppBlock.java done in that patch. Reverting of that refactored change resulted in following call added
{code:java}
 appBaseProt.getApplicationAttempts(request).getApplicationAttemptList();
{code}

appBaseProto is not instantiated anymore since YARN-7163 , thereby resulting in a NullPointerException
, Attached a patch which undoes the changes made by the revert of HADOOP-14077 to AppBlock.java and fixes this problem., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 25s{color} | {color:blue} Docker mode activated. {color} |
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
|| || || || {color:brown} trunk Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 15m 14s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 27s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 19s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 28s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green}  9m 40s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  0m 48s{color} | {color:red} hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common in trunk has 1 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 19s{color} | {color:green} trunk passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 26s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 22s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m 22s{color} | {color:green} the patch passed {color} |
| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 14s{color} | {color:orange} hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common: The patch generated 1 new + 20 unchanged - 18 fixed = 21 total (was 38) {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 25s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 10m 12s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 53s{color} | {color:green} hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common generated 0 new + 0 unchanged - 1 fixed = 0 total (was 1) {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 19s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m  7s{color} | {color:green} hadoop-yarn-server-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 21s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 43m 15s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:d4cc50f |
| JIRA Issue | YARN-8022 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12913906/YARN-8022.001.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |
| uname | Linux ddd3b460c5a5 4.4.0-64-generic #85-Ubuntu SMP Mon Feb 20 11:50:30 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / e1f5251 |
| maven | version: Apache Maven 3.3.9 |
| Default Java | 1.8.0_151 |
| findbugs | v3.1.0-RC1 |
| findbugs | https://builds.apache.org/job/PreCommit-YARN-Build/19951/artifact/out/branch-findbugs-hadoop-yarn-project_hadoop-yarn_hadoop-yarn-server_hadoop-yarn-server-common-warnings.html |
| checkstyle | https://builds.apache.org/job/PreCommit-YARN-Build/19951/artifact/out/diff-checkstyle-hadoop-yarn-project_hadoop-yarn_hadoop-yarn-server_hadoop-yarn-server-common.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/19951/testReport/ |
| Max. process+thread count | 407 (vs. ulimit of 10000) |
| modules | C: hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common U: hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/19951/console |
| Powered by | Apache Yetus 0.8.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, +1 for reverting only AppBlock. thanks [~tarunparimi] for finding this issue. , This seems even after revert it fails with NPE because of callerUgi null is not handled.
{code}
2018-03-12 13:36:10,860 ERROR org.apache.hadoop.yarn.server.webapp.AppBlock: Failed to read the attempts of the application application_1520833852015_0001.
java.lang.NullPointerException
	at org.apache.hadoop.yarn.server.webapp.AppBlock.render(AppBlock.java:145)
	at org.apache.hadoop.yarn.server.resourcemanager.webapp.RMAppBlock.render(RMAppBlock.java:71)
{code}

There are many issue fix has gone into AppBlock.java. Pls check all these jira before uploading new patch.
 !Screen Shot 2018-03-12 at 1.45.05 PM.png! , [~rohithsharma] Looks like callerUgi null check before the revert was handled by 
{code:java}
if (callerUGI == null) {
  throw new AuthenticationException(
      "Failed to get user name from request");
}{code}
which is not present in this patch. So even before the revert if callerUgi is equal to null, the page will not be rendered. But the NPE will be avoided. 

Also if we are going to throw this exception, the further null check of callerUgi below is not needed. Can we remove that?
{code:java}
if (callerUGI == null) {
          containerReport =
              getContainerReport(request);
        } else {
          containerReport = callerUGI.doAs(
              new PrivilegedExceptionAction<ContainerReport>() {
{code}
 , I would suggest following changes. 
# Revert AppBlock as this patch is doing. 
# Additionally, in line no. 145, can you add below code. Get app attempt report directly if caller ugi is null.
{code}
+      if (callerUGI == null) {
+        attempts = getApplicationAttemptsReport(request);
+      } else {
{code}, YARN-6991 depends on running {code}getApplicationAttemptsReport(request){code} as callerUGI to validate whether kill button needs to be displayed. If we do 
{code}
 if (callerUGI == null) {
+        attempts = getApplicationAttemptsReport(request);
+      } else {
{code}

then, I guess the kill button will be displayed for an unauthorized user? Correct me if am wrong., However in secure cluster, unauthorized user will be going into else part since callerUGI will NOT be null at all. If user is unauthorized then this user will be blocked in AuthenticationFilter itself. CallerUGI can be null only in non-secure cluster. So we can proceed ahead with this modification. 
cc : [~leftnoteasy] [~sunilg], Thanks for the clarification [~rohithsharma] . Attached a patch as per your suggestions, | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 29s{color} | {color:blue} Docker mode activated. {color} |
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
|| || || || {color:brown} trunk Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 15m 23s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 28s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 19s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 31s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 10m 12s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  0m 48s{color} | {color:red} hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common in trunk has 1 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 22s{color} | {color:green} trunk passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 27s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 22s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m 22s{color} | {color:green} the patch passed {color} |
| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 15s{color} | {color:orange} hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common: The patch generated 1 new + 20 unchanged - 18 fixed = 21 total (was 38) {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 26s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 10m 22s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 52s{color} | {color:green} hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common generated 0 new + 0 unchanged - 1 fixed = 0 total (was 1) {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 20s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m  5s{color} | {color:green} hadoop-yarn-server-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 21s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 44m  9s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:d4cc50f |
| JIRA Issue | YARN-8022 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12913998/YARN-8022.002.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |
| uname | Linux d03b58bc0d00 4.4.0-64-generic #85-Ubuntu SMP Mon Feb 20 11:50:30 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / e1f5251 |
| maven | version: Apache Maven 3.3.9 |
| Default Java | 1.8.0_151 |
| findbugs | v3.1.0-RC1 |
| findbugs | https://builds.apache.org/job/PreCommit-YARN-Build/19955/artifact/out/branch-findbugs-hadoop-yarn-project_hadoop-yarn_hadoop-yarn-server_hadoop-yarn-server-common-warnings.html |
| checkstyle | https://builds.apache.org/job/PreCommit-YARN-Build/19955/artifact/out/diff-checkstyle-hadoop-yarn-project_hadoop-yarn_hadoop-yarn-server_hadoop-yarn-server-common.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/19955/testReport/ |
| Max. process+thread count | 407 (vs. ulimit of 10000) |
| modules | C: hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common U: hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/19955/console |
| Powered by | Apache Yetus 0.8.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Thanks [~tarunparimi], 

A couple of questions to [~rohithsharma] since I don't have full understand of this part of code.
1) Is there {color:#FF0000}any{color} behavior change comparing this to trunk few days ago (before I revert these patches)? 
2) Is there {color:#FF0000}any{color} behavior change comparing this to logics originally before HADOOP-14077 get committed? (Like 2.6.x). 

 , bq. Is there {color:#ff0000}any{color} behavior change comparing this to trunk few days ago (before I revert these patches)? 
yes, it is there. Before revert of HADOOP-14077 if callerUgi is null then AuthenticationException is thrown. With this patch,  we continue to retrieve app report without ugi#doAs. 

bq. Is there any behavior change comparing this to logics originally before HADOOP-14077 get committed?
*NO*. This patch and before HADOOP-14077 get committed state should be same.

It looks confusion is because I said we need to revert the Appblock code in earlier comments. Actually *NO*. We should *NOT* revert AppBlock modifications after Owen commit. Sorry for the confusion. 

YARN-7163 did some modifications to AppBlock class which got missed after Owen commit that caused NPE. This patch bringing back those modifications without any behavioral changes.

, I tested the patch manually on trunk. The application page now renders properly for simple auth and displays the application info and attempts info as before.

Removed *org.apache.hadoop.http.lib.StaticUserWebFilter* from *hadoop.http.filter.initializers*  ** configuration to check for null callerUGI scenario and able to access the same page properly in both unsecure/secure cluster with simple auth.

Haven't checked with spnego auth enabled. But I guess behavior should be fine since unauthorized users won't be able to access the page., Managed to check the patch with spnego auth as well. The application page is displayed fine for authorized user's applications. , thanks [~tarunparimi] for verification. [~sunilg] [~leftnoteasy] do you have any comments? Shall I commit this patch? , Thanks [~rohithsharma]/[~tarunparimi], 

Please commit the patch if you think it is ready., committing shortly, committed to trunk/branch-3.1. thanks to [~tarunparimi] for the patch and thanks to [~sunilg] & [~leftnoteasy] for the additional review. , SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #13833 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/13833/])
YARN-8022. ResourceManager UI cluster/app/<app-id> page fails to render. (rohithsharmaks: rev e6de10d0a6363bdaf767a7bdac7ad908d7786718)
* (edit) hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-common/src/main/java/org/apache/hadoop/yarn/server/webapp/AppBlock.java
]