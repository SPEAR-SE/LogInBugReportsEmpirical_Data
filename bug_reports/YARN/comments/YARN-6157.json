[[~Naganarasimha], the check for system max apps is made in CapacityScheduler#addApplication and flow for recovered apps goes via CapacityScheduler#addApplicationOnRecovery. So recovered apps I think will be excluded.
Other point is right. We probably need a counter in LeafQueue which will be increment when we call LeafQueue#submitApplication. We have a similar counter in ParentQueue too.]