[Attaching a first patch., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12686195/YARN-2945.1.patch
  against trunk revision 2e98ad3.

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-YARN-Build/6068//console

This message is automatically generated., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12686222/YARN-2945.001.patch
  against trunk revision 2e98ad3.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:red}-1 findbugs{color}.  The patch appears to introduce 15 new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager:

                  org.apache.hadoop.yarn.server.resourcemanager.TestClientRMTokens
                  org.apache.hadoop.yarn.server.resourcemanager.security.TestRMDelegationTokens
                  org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.TestFairSchedulerQueueACLs
                  org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.TestContainerAllocation
                  org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.TestCapacitySchedulerQueueACLs
                  org.apache.hadoop.yarn.server.resourcemanager.TestApplicationACLs
                  org.apache.hadoop.yarn.server.resourcemanager.TestWorkPreservingRMRestart
                  org.apache.hadoop.yarn.server.resourcemanager.TestMoveApplication
                  org.apache.hadoop.yarn.server.resourcemanager.TestRM
                  org.apache.hadoop.yarn.server.resourcemanager.TestClientRMService

                                      The following test timeouts occurred in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager:

org.apache.hadoop.yarn.server.resourcemanager.security.TestClientToAMTokens
org.apache.hadoop.yarn.server.resourcemanager.TestRMRestart
org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.TestFairScheduler

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/6070//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-YARN-Build/6070//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-resourcemanager.html
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/6070//console

This message is automatically generated., Other committers: please hold off on committing this until I get a chance to take a close look. 

During the course of YARN-2910, we ended up with a deadlock when we held the equivalent of write lock over the entire block. While it is true in theory,  the queue might become unsorted but that should be okay in practice. Actually, we have been considering sorting only periodically for better performance. , Thanks for your comment. It make sense to me, but it can be confusing for readers of the code. How about adding comments of the hack? In addition to that, periodic sort is also better approach - the semantics of FS preserved in during a period. It should be done on this JIRA?, I am comfortable with adding comments here in this JIRA. We need to tread carefully with periodic sort, might need to make other data-structure changes in conjunction. , OK, I updated a patch to add the comment. , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12686378/YARN-2945.002.patch
  against trunk revision a7c6c71.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:red}-1 findbugs{color}.  The patch appears to introduce 15 new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager:

                  org.apache.hadoop.yarn.server.resourcemanager.TestRM
                  org.apache.hadoop.yarn.server.resourcemanager.TestRMRestart
                  org.apache.hadoop.yarn.server.resourcemanager.TestWorkPreservingRMRestart

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/6076//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-YARN-Build/6076//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-resourcemanager.html
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/6076//console

This message is automatically generated., The test failure is not related to the patch.

[~kasha], could you review the patch?, +1. Checking this in. , Thanks for working on this, Tsuyoshi.

Committed to trunk and branch-2. , FAILURE: Integrated in Hadoop-trunk-Commit #8371 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8371/])
YARN-2945. Fixing the CHANGES.txt to have the right JIRA number. (vinodkv: rev cf831565e8344523e1bd0eaf686ed56a2b48b920)
* hadoop-yarn-project/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2271 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2271/])
YARN-2945. Fixing the CHANGES.txt to have the right JIRA number. (vinodkv: rev cf831565e8344523e1bd0eaf686ed56a2b48b920)
* hadoop-yarn-project/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #313 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/313/])
YARN-2945. Fixing the CHANGES.txt to have the right JIRA number. (vinodkv: rev cf831565e8344523e1bd0eaf686ed56a2b48b920)
* hadoop-yarn-project/CHANGES.txt
, SUCCESS: Integrated in Hadoop-Yarn-trunk-Java8 #328 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/328/])
YARN-2945. Fixing the CHANGES.txt to have the right JIRA number. (vinodkv: rev cf831565e8344523e1bd0eaf686ed56a2b48b920)
* hadoop-yarn-project/CHANGES.txt
, SUCCESS: Integrated in Hadoop-Yarn-trunk #1055 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/1055/])
YARN-2945. Fixing the CHANGES.txt to have the right JIRA number. (vinodkv: rev cf831565e8344523e1bd0eaf686ed56a2b48b920)
* hadoop-yarn-project/CHANGES.txt
, SUCCESS: Integrated in Hadoop-Mapreduce-trunk-Java8 #322 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/322/])
YARN-2945. Fixing the CHANGES.txt to have the right JIRA number. (vinodkv: rev cf831565e8344523e1bd0eaf686ed56a2b48b920)
* hadoop-yarn-project/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2252 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2252/])
YARN-2945. Fixing the CHANGES.txt to have the right JIRA number. (vinodkv: rev cf831565e8344523e1bd0eaf686ed56a2b48b920)
* hadoop-yarn-project/CHANGES.txt
]