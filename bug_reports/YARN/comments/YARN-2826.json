[Thanks for [~sidharta-s] for reporting this issue.

Attached a fix for this.
Offline discussed with [~xgong], he pointed me what happened, thanks to Xuan! What really happened is {{Groups.getUserToGroupsMappingServiceWithLoadedConfiguration(this.conf)}} overwrites the Groups initialized in doSecureLogin. So we should make sure doSecureLogin happens after {{getUserToGroupsMappingServiceWithLoadedConfiguration}}.

And also, HA configuration initialization should happen after configuration initialization, also put it to correct position as well. , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12680069/YARN-2826-1.patch
  against trunk revision ba0a42c.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager:

                  org.apache.hadoop.yarn.server.resourcemanager.applicationsmanager.TestAMRestart

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/5770//testReport/
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/5770//console

This message is automatically generated., Failed tests is tracked by https://issues.apache.org/jira/browse/YARN-2365, not related to this patch., Sigh, we keep breaking this.


The patch looks good. Can you report any manual testing done?, Verified this patch will not break what we have resolved in YARN-2795, in HA+security cluster, RMs can still start/stop successfully.
And also verified user-group mapping can get updated in cluster with this patch., Thanks you, +1, checking this in., Committed this to trunk, branch-2 and branch-2.6. Thanks Wangda!, FAILURE: Integrated in Hadoop-trunk-Commit #6490 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6490/])
YARN-2826. Fixed user-groups mappings' refresh bug caused by YARN-2826. Contributed by Wangda Tan. (vinodkv: rev df36edf751202db00d8f43103d7120ec56d70a04)
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/ResourceManager.java
, FAILURE: Integrated in Hadoop-Yarn-trunk #737 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/737/])
YARN-2826. Fixed user-groups mappings' refresh bug caused by YARN-2826. Contributed by Wangda Tan. (vinodkv: rev df36edf751202db00d8f43103d7120ec56d70a04)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/ResourceManager.java
* hadoop-yarn-project/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1927 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1927/])
YARN-2826. Fixed user-groups mappings' refresh bug caused by YARN-2826. Contributed by Wangda Tan. (vinodkv: rev df36edf751202db00d8f43103d7120ec56d70a04)
* hadoop-yarn-project/CHANGES.txt
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/ResourceManager.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1951 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1951/])
YARN-2826. Fixed user-groups mappings' refresh bug caused by YARN-2826. Contributed by Wangda Tan. (vinodkv: rev df36edf751202db00d8f43103d7120ec56d70a04)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/ResourceManager.java
* hadoop-yarn-project/CHANGES.txt
]