[[~tucu00], we also ran into this today morning. Are you working on the patch? If not, one of us will take it over. Want to finish this asap. Tx., [~vinodkv], I was planning to take a stab at it next week, if you are in a rush go for it. 

As some background:

* My current workaround from the AM side, create a dummy LocalResource against file:///etc/hosts as application private. This triggers localization per app in the node just once and using a local file I don't incur into any unnecessary extra latency with HDFS.

* Possible solution 1: trigger resource localization always to force the LCE localization and ensure creation of the usercache/USER even if there are not application/private resources to localize.

* Possible solution 2: the LCE launcher should call mkdirat at usercache/USER and do the chmod before launching the container process, if the dir already exists because of localization this is a NOP. the mkdirat happens before doing the setuid to launch the container process.

I prefer option 2 because it will avoid triggering the localization thread and it will avoid adding extra latency to containers without localization.
, We ran into this with distributed shell itself. We are looking at this now., I'm in favour of chanigng the LCE as well. it looks like the log dirs may need to be created with the correct permissions as well., [~sseth], now that you mention the log dirs, while debugging this with [~rvs] he noticed that as well, I've forgot to mentioned here as that does not seem to stop things from working, but we should fix that as well. , Updated launch_container to create the app level local and log directories. Verified dir permissions on a secure cluster., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12606975/YARN-1274.1.txt
  against trunk revision .

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-YARN-Build/2121//console

This message is automatically generated., Patch for trunk and branch-2. The previous patch applies to branch-2.1., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12607008/YARN-1274.trunk.1.txt
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/2123//testReport/
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/2123//console

This message is automatically generated., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12607008/YARN-1274.trunk.1.txt
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/2124//testReport/
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/2124//console

This message is automatically generated., Patch looks good to me. Reuploading patch with one corrected code-comment., Same patch with corrected code comment.

Ran native test-container-executor test which passes. Based on Sid's testing, will check this in once Jenkins says okay., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12607036/YARN-1274.trunk.2.txt
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-YARN-Build/2126//testReport/
Console output: https://builds.apache.org/job/PreCommit-YARN-Build/2126//console

This message is automatically generated., Committed this to trunk, branch-2 and branch-2.1. Thanks Sid!

I'll keep a watch on this one, do further testing to make sure all is well and report my results., SUCCESS: Integrated in Hadoop-trunk-Commit #4550 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/4550/])
YARN-1274. Fixed NodeManager's LinuxContainerExecutor to create user, app-dir and log-dirs correctly even when there are no resources to localize for the container. Contributed by Siddharth Seth. (vinodkv: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1529555)
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/native/container-executor/impl/container-executor.c
, SUCCESS: Integrated in Hadoop-Yarn-trunk #354 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/354/])
YARN-1274. Fixed NodeManager's LinuxContainerExecutor to create user, app-dir and log-dirs correctly even when there are no resources to localize for the container. Contributed by Siddharth Seth. (vinodkv: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1529555)
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/native/container-executor/impl/container-executor.c
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1544 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1544/])
YARN-1274. Fixed NodeManager's LinuxContainerExecutor to create user, app-dir and log-dirs correctly even when there are no resources to localize for the container. Contributed by Siddharth Seth. (vinodkv: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1529555)
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/native/container-executor/impl/container-executor.c
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1570 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1570/])
YARN-1274. Fixed NodeManager's LinuxContainerExecutor to create user, app-dir and log-dirs correctly even when there are no resources to localize for the container. Contributed by Siddharth Seth. (vinodkv: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1529555)
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/native/container-executor/impl/container-executor.c
, Closing old tickets that are already shipped in a release.]