[Initially, The function ContainerExecutor.getRunCommand has been implemented a little difference between trunk and branch-2 in YARN-443. Then in HADOOP-8562, we did a big merge from trunk which did not merge this function correctly. That is why right now, the code in trunk is different from that in branch-2. And this testcase passed in trunk, but failed in branch-2. , The fix makes sense. Currently the branch-2 code will always add "nice -n" argument whether the priority is using the default 0 or a user customized value.

One suggestion: maybe it's better to apply the diff between trunk and branch-2 here. It prevents the merge failure if we modify this code on the trunk, and cherry pick it to branch-2 in the future., This is a code issue, we should get this into 2.6., bq. One suggestion: maybe it's better to apply the diff between trunk and branch-2 here. It prevents the merge failure if we modify this code on the trunk, and cherry pick it to branch-2 in the future.

Make sense. Uploaded a new patch to do this, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12679260/YARN-2752.2-branch-2.patch
  against trunk revision 3dfd6e6.

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-YARN-Build/5721//console

This message is automatically generated., +1. The jenkins doesn't work because the patch only applies to branch-2. I've verified it locally. It can compile and fix the test failure. Will commit the patch., Committed to branch-2 and branch-2.6. Thanks Xuan for the patch and Vinod for the review!.]