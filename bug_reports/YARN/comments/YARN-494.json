[If log aggregation is a yarn service, can we delink the app master from it? It could request log aggregation but should not have to linger after that and require the RM/NM to continue to do tricks after the RM considers the app as finished. I am sure I am missing a lot here and would need to be educated., Yes, log aggregation is a yarn service provided by the NM.  The AM is not involved in the process, it gets aggregated like any other container.

When an app finishes, the RM informs all the NMs that participated in running containers for the app to begin log aggregation.  The RM no longer tracks the app state after that, it just assumes that the NM got the event, and that aggregation will eventually finish.  If the event is lost or aggregation jams, the NMs leaks objects.  We see OOMs on busy clusters.

The NM sends a "keepalive list" to the RM of apps still aggregating.  The keepalive extends the RM's token renewal which usually stops when the app finishes.  It does this because aggregation writes to hdfs, and aggregation will fail if the token is cancelled or expires., Thanks! That makes more sense.]