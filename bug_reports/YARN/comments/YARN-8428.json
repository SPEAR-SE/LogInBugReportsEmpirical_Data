[YARN service AM requires a ZooKeeper connection to update YARN registry regarding the service state.  This requires to keep one ZooKeeper connection open per AM.  Instead of maintaining persistent ZooKeeper connection, code was changed to create connection on demand and close connection as soon as the task is completed.  However, using dynamic connections, the number of ZooKeeper sockets jump from 1 per AM to 8 per AM due to activities to check Service registry states.  Unless YARN registry design is drastically changed, otherwise, we can not reduce YARN service AM ZooKeeper connection further in 3.x.

This JIRA will focus on second problem in deleting DNS record from ZooKeeper., YARN ServiceClient is using a single connection to connect to ZooKeeper for deleting DNS entries.  The number of ZooKeeper connection required by the framework depends on number of YARN service applications running on the cluster.  This is a design trade off for using ZooKeeper as storage for coordinating distributed applications.  The only solution is to increase number of ZooKeeper concurrent connections, i.e. maxClientCnxns=2000 to increase number of YARN services can run on the cluster.  Close this as working as designed.]