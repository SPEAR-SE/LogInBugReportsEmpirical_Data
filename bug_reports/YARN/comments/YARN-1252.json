[It could be the reason that when the application finishes, NN is failing over and becomes in SAFEMODE, and at that point of time RM is not able to remove the application state (within which we store the HDFSDelegationToken) from the store, and RM goes ahead and finishes the app and add the token to the cancel queue, when new NN is up, the token is canceled. Then RM shutdown. Since the token is removed on HDFS tokenSecretManager already , when RM comes back, it will reads the application state(which failed to remove) to try to renew a non-existing token., taking it over..
, YARN-674 should solve this problem. Now as token renewal is asynchronous in nature so if the token in unknown or external system (token renewing system) is down then the application for which this token was submitted will be marked as failed without crashing RM., [~vinodkv] [~jianhe] if you agree then we can close this., As there no activities for long time and as per above analysis the should be solved in YARN-674. Closing the issue as duplicate. Feel free to reopen in case the issue still exists.]