{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12727570","self":"https://issues.apache.org/jira/rest/api/2/issue/12727570","key":"YARN-2299","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2014-11-19T17:33:46.067+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri May 01 23:26:11 UTC 2015","customfield_12310420":"405676","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_25034762442_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-05-01T23:26:32.246+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2299/watchers","watchCount":5,"isWatching":false},"created":"2014-07-16T05:20:29.885+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326262","id":"12326262","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12328972","id":"12328972","description":"2.5.2 release","name":"2.5.2","archived":false,"released":true,"releaseDate":"2014-11-19"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhiguohong","name":"zhiguohong","key":"zhiguohong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hong Zhiguo","active":true,"timeZone":"Asia/Chongqing"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-01T23:26:32.316+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319322","id":"12319322","name":"resourcemanager"}],"timeoriginalestimate":null,"description":"If port of \"yarn.nodemanager.address\" is not specified at NM, NM will choose random port. If the NM is ungracefully dead(OOM kill, kill -9, or OS restart) and then restarted within \"yarn.nm.liveness-monitor.expiry-interval-ms\", \"host:port1\" and \"host:port2\" will both be present in \"Active Nodes\" on WebUI for a while, and after host:port1 expiration, we get host:port1 in \"Lost Nodes\" and host:port2 in \"Active Nodes\". If the NM is ungracefully dead again, we get only host:port1 in \"Lost Nodes\". \"host:port2\" is neither in \"Active Nodes\" nor in  \"Lost Nodes\".\n\nAnother case, two NM is running on same host(miniYarnCluster or other test purpose), if both of them are lost, we get only one \"Lost Nodes\" in WebUI.\n\nIn both case, sum of \"Active Nodes\" and \"Lost Nodes\" is not the number of nodes we expected.\n\nThe root cause is due to inconsistency at how we think two Nodes are identical.\nWhen we manager active nodes(RMContextImpl.nodes), we use NodeId which contains port. Two nodes with same host but different port are thought to be different node.\nBut when we manager inactive nodes(RMContextImpl.inactiveNodes), we use only use host. Two nodes with same host but different port are thought to identical.\n\nTo fix the inconsistency, we should differentiate below 2 cases and be consistent for both of them:\n - intentionally multiple NMs per host\n - NM instances one after another on same host\n\nTwo possible solutions:\n1) Introduce a boolean config like \"one-node-per-host\"(default as \"true\"), and use host to differentiate nodes on RM if it's true.\n\n2) Make it mandatory to have valid port in \"yarn.nodemanager.address\" config.  In this sutiation, NM instances one after another on same host will have same NodeId, while intentionally multiple NMs per host will have different NodeId.\n\nPersonally I prefer option 1 because it's easier for users.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"405698","customfield_12312823":null,"summary":"inconsistency at identifying node","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhiguohong","name":"zhiguohong","key":"zhiguohong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hong Zhiguo","active":true,"timeZone":"Asia/Chongqing"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhiguohong","name":"zhiguohong","key":"zhiguohong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hong Zhiguo","active":true,"timeZone":"Asia/Chongqing"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727570/comment/14064711","id":"14064711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhiguohong","name":"zhiguohong","key":"zhiguohong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hong Zhiguo","active":true,"timeZone":"Asia/Chongqing"},"body":"or take usage of existing config property \"yarn.scheduler.include-port-in-node-name\" when differentiating nodes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhiguohong","name":"zhiguohong","key":"zhiguohong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hong Zhiguo","active":true,"timeZone":"Asia/Chongqing"},"created":"2014-07-17T08:29:53.640+0000","updated":"2014-07-17T08:29:53.640+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727570/comment/14218195","id":"14218195","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bruno.alr","name":"bruno.alr","key":"bruno.alr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruno Alexandre Rosa","active":true,"timeZone":"Etc/UTC"},"body":"What are the affected versions?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bruno.alr","name":"bruno.alr","key":"bruno.alr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruno Alexandre Rosa","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-19T17:33:46.067+0000","updated":"2014-11-19T17:33:46.067+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727570/comment/14218207","id":"14218207","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bruno.alr","name":"bruno.alr","key":"bruno.alr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruno Alexandre Rosa","active":true,"timeZone":"Etc/UTC"},"body":"Which*","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bruno.alr","name":"bruno.alr","key":"bruno.alr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruno Alexandre Rosa","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-19T17:40:15.354+0000","updated":"2014-11-19T17:40:15.354+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727570/comment/14225312","id":"14225312","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bruno.alr","name":"bruno.alr","key":"bruno.alr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruno Alexandre Rosa","active":true,"timeZone":"Etc/UTC"},"body":"I tried to reproduce the first case on version 2.5.2 and the bug it is still present. However, instead of host:port1 showing on Lost Nodes, I got host:port2. In the same fashion, I lost track of host:port1. The sum of Lost Nodes remains inconsistent.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bruno.alr","name":"bruno.alr","key":"bruno.alr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruno Alexandre Rosa","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-25T22:24:24.590+0000","updated":"2014-11-25T22:24:24.590+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727570/comment/14524279","id":"14524279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jianhe","name":"jianhe","key":"jianhe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian He","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. But when we manager inactive nodes(RMContextImpl.inactiveNodes), we use only use host. Two nodes with same host but different port are thought to identical.\n\nThis has been fixed in 2.8 to use host:port to track inactive nodes. close this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jianhe","name":"jianhe","key":"jianhe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian He","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-01T23:26:11.295+0000","updated":"2015-05-01T23:26:11.295+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2299/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1xt9b:"}}