{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13075345","self":"https://issues.apache.org/jira/rest/api/2/issue/13075345","key":"YARN-6661","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat May 27 10:23:21 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-6661/watchers","watchCount":1,"isWatching":false},"created":"2017-05-27T09:46:27.426+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332791","id":"12332791","description":"2.7.2 release","name":"2.7.2","archived":false,"released":true,"releaseDate":"2016-01-25"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-07T12:58:43.957+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12322906","id":"12322906","name":"fairscheduler","description":"Fair Scheduler"}],"timeoriginalestimate":null,"description":"Some one else have already come up with the similar problem and fix it.\nWe can look the jira(https://issues.apache.org/jira/browse/YARN-3809) for detail.\nBut I think the fix have not solve the problem completely, blow was the problem I encountered:\nThere is about 1000 nodes in my hadoop cluster, and I submit about 1800 apps.\nI failover my active rm and rm will failover all those 1800 apps.\nWhen a application failover, It will wait for AM container register itself. \nBut there is a bug in my AM (I do it intentionally), and it will not register itself.\nSo the RM will wait for about 10mins for the AM expiration, and it will send a CLEANUP event to \nApplicationMasterLauncher thread pool. Because there is about 1800 apps, so it will hang the ApplicationMasterLauncher\nthread pool for a large time. I have already use the patch(https://issues.apache.org/jira/secure/attachment/12740804/YARN-3809.03.patch), so\na CLEANUP event will hang a thread 10 * 20 = 200s. But I have 1800 apps, so for each of my thread, it will\nhang 1800 / 50 * 200s = 7200s=20min.\nBecause the AM have register itself during 10mins， so it will retry and create a new application attempt. \nThe application attempt will accept a container from RM, and send a LAUNCH to ApplicationMasterLauncher thread pool.\nBecause the 1800 CLEANUP will hang the 50 thread pools about 20mins. So the application attempt will not \nstart the AM container during 10min. \nAnd it will expire, and send a CLEANUP event to ApplicationMasterLauncher thread pools too.\nAs you can see, none of my application can really run it. \nEach of them have 5 application attempts as follows, and each of them keep retrying.\nappattempt_1495786030132_4000_000005\nappattempt_1495786030132_4000_000004\nappattempt_1495786030132_4000_000003\nappattempt_1495786030132_4000_000002\t\nappattempt_1495786030132_4000_000001\nSo all of my apps have hang several hours, and none of them can really run. \nI think this is a bug!!! We can treat CLEANUP and LAUNCH as different events.\nAnd use some other thread to deal with LAUNCH event or use other way.\nSorry, I english is so poor. I don't know have I describe it clearly.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332791","id":"12332791","description":"2.7.2 release","name":"2.7.2","archived":false,"released":true,"releaseDate":"2016-01-25"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Too much CLEANUP event hang ApplicationMasterLauncher thread pool","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhouyunfan","name":"zhouyunfan","key":"zhouyunfan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"JackZhou","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhouyunfan","name":"zhouyunfan","key":"zhouyunfan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"JackZhou","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"hadoop 2.7.2 ","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13075345/comment/16027391","id":"16027391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhouyunfan","name":"zhouyunfan","key":"zhouyunfan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"JackZhou","active":true,"timeZone":"Asia/Shanghai"},"body":"Some one else have already come up with the similar problem and fix it.\nWe can look the jira(https://issues.apache.org/jira/browse/YARN-3809) for detail.\n\nBut I think the fix have not solve the problem completely, blow was the problem I encountered:\nThere is about 1000 nodes in my hadoop cluster, and I submit about 1800 apps.\nI failover my active rm and rm will failover all those 1800 apps.\nWhen a application failover, It will wait for AM container register itself. \nBut there is a bug in my AM (I do it intentionally), and it will not register itself.\n\nSo the RM will wait for about 10mins for the AM expiration, and it will send a CLEANUP event to \nApplicationMasterLauncher thread pool. Because there is about 1800 apps, so it will hang the ApplicationMasterLauncher\nthread pool for a large time.  I have already use the patch(https://issues.apache.org/jira/secure/attachment/12740804/YARN-3809.03.patch), so\na CLEANUP event will hang a thread 10 * 20 = 200s. But I have 1800 apps, so for each of my thread, it will\nhang 1800 / 50 * 200s = 7200s=20min.\n\nBecause the AM have register itself during 10mins， so it will retry and create a new application attempt. \nThe application attempt will accept a container from RM, and send a LAUNCH to ApplicationMasterLauncher thread pool.\nBecause the 1800 CLEANUP will hang the 50 thread pools about 20mins. So the application attempt will not \nstart the AM container during 10min. \nAnd it will expire, and send a CLEANUP event to ApplicationMasterLauncher thread pools too.\n\nAs you can see, none of my application can really run it. \nEach of them have 5 application attempts as follows,  and each of them keep retrying.\nappattempt_1495786030132_4000_000005\nappattempt_1495786030132_4000_000004\nappattempt_1495786030132_4000_000003\nappattempt_1495786030132_4000_000002\t\nappattempt_1495786030132_4000_000001\n\nSo all of my apps have hang several hours, and none of them can really run. \nI think this is a bug!!! We can treat CLEANUP and LAUNCH as different events.\nAnd use some other thread to deal with LAUNCH event or use other way.\n\nSorry, I english is so poor. I don't know have I describe it clearly.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhouyunfan","name":"zhouyunfan","key":"zhouyunfan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"JackZhou","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-05-27T10:23:21.643+0000","updated":"2017-05-27T10:23:21.643+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-6661/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3fju7:"}}