{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12941631","self":"https://issues.apache.org/jira/rest/api/2/issue/12941631","key":"YARN-4728","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-02-24T07:11:19.562+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Feb 27 09:06:17 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4728/watchers","watchCount":5,"isWatching":false},"created":"2016-02-24T04:04:27.178+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":86400,"aggregatetimeoriginalestimate":86400,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327197","id":"12327197","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-02-27T09:06:17.256+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319324","id":"12319324","name":"capacityscheduler"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12319323","id":"12319323","name":"nodemanager"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12319322","id":"12319322","name":"resourcemanager"}],"timeoriginalestimate":86400,"description":"I have some nodes running hadoop 2.6.0.\nThe cluster's configuration remain default largely.\nI run some job on the cluster(especially some job processing a lot of data) every day.\nSometimes, I found my job remain the same progression for a very very long time. So I have to kill the job mannually and re-submit it to the cluster. It works well before(re-submit the job and it run to the end), but something go wrong today.\nAfter I re-submit the same task for 3 times, its running go deadlock(the progression doesn't change for a long time, and each time has a different progress value.e.g.33.01%,45.8%,73.21%).\n\nI begin to check the web UI for the hadoop, then I find there are 98 map suspend while all the running reduce task have consumed all the avaliable  memory. I stop the yarn and add configuration below  into yarn-site.xml and then restart the yarn.\n<property>yarn.app.mapreduce.am.job.reduce.rampup.limit</property>\n<value>0.1</value>\n<property>yarn.app.mapreduce.am.job.reduce.preemption.limit</property>\n<value>1.0</value>\n(wanting the yarn to preempt the reduce task's resource to run suspending map task)\nAfter restart the yarn,I submit the job with the property mapreduce.job.reduce.slowstart.completedmaps=1.\nbut the same result happen again!!(my job remain the same progress value for a very very long time)\n\nI check the web UI for the hadoop again,and find that the suspended map task is newed with the previous note:\"TaskAttempt killed because it ran on unusable node node02:21349\".\nThen I check the resourcemanager's log and find some useful messages below:\n******Deactivating Node node02:21349 as it is now LOST.\n******node02:21349 Node Transitioned from RUNNING to LOST.\n\nI think this may happen because my network across the cluster is not good which cause the RM don't receive the NM's heartbeat in time.\n\nBut I wonder that why the yarn framework can't preempt the running reduce task's resource to run the suspend map task?(this cause the job remain the same progress value for a very very long time:( )\n\n\nAny one can help?\nThank you very much!","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":86400,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"MapReduce job doesn't make any progress for a very very long time after one Node become unusable.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Silnov","name":"Silnov","key":"silnov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Silnov","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Silnov","name":"Silnov","key":"silnov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Silnov","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":86400,"percent":0},"customfield_12311024":null,"environment":"hadoop 2.6.0\nyarn","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10431","value":"Important","id":"10431"}],"progress":{"progress":0,"total":86400,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12941631/comment/15160305","id":"15160305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for reporting this issue [~Silnov]! \nIt looks like this issue is caused by the long timeout at two level. This issue is similar as YARN-3944, YARN-4414, YARN-3238 and YARN-3554. You may work around this issue by changing the configuration values: \"ipc.client.connect.max.retries.on.timeouts\" (default is 45),  \"ipc.client.connect.timeout\"(default is 20000ms) and \"yarn.client.nodemanager-connect.max-wait-ms\" (default is 900,000ms).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-02-24T07:11:19.562+0000","updated":"2016-02-24T07:11:19.562+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12941631/comment/15160343","id":"15160343","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"[~Silnov], in addition to above, can you check your AM logs and see if scenario is similar to MAPREDUCE-6513 ?\nI suspect its same.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-02-24T07:58:00.925+0000","updated":"2016-02-24T07:58:00.925+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12941631/comment/15170403","id":"15170403","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Silnov","name":"Silnov","key":"silnov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Silnov","active":true,"timeZone":"Etc/UTC"},"body":"zhihai xu,thanks for your response!\nI will try to make some changes following your advice!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Silnov","name":"Silnov","key":"silnov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Silnov","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-27T06:59:04.961+0000","updated":"2016-02-27T06:59:04.961+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12941631/comment/15170406","id":"15170406","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Silnov","name":"Silnov","key":"silnov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Silnov","active":true,"timeZone":"Etc/UTC"},"body":"Varun Saxena,thanks for your response!\nI have checked MAPREDUCE-6513. The scenario is similar to that as you said. \nI'll get some knowledge from it:) ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Silnov","name":"Silnov","key":"silnov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Silnov","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-27T07:02:58.831+0000","updated":"2016-02-27T07:02:58.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12941631/comment/15170481","id":"15170481","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"body":"Yes, MAPREDUCE-6513 is possible, but YARN-1680 may be more possible. Because blacklisted nodes can happen easier in your environment than MAPREDUCE-6513 especially with mapreduce.job.reduce.slowstart.completedmaps=1. To see whether it is MAPREDUCE-6513 or YARN-1680, you need check the log to see wether reduce task is preempted. If reduce task is preempted and map task still can't get resource, it is MAPREDUCE-6513/MAPREDUCE-6514. Otherwise, it is YARN-1680. Even YARN-1680 is fixed, which trigger the preemption, MAPREDUCE-6513 still will happen.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-02-27T09:06:17.256+0000","updated":"2016-02-27T09:06:17.256+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4728/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2t987:"}}