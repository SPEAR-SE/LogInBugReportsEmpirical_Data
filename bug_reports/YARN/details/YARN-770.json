{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12651398","self":"https://issues.apache.org/jira/rest/api/2/issue/12651398","key":"YARN-770","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2013-07-23T00:14:18.610+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 01 01:35:50 UTC 2013","customfield_12310420":"331724","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4779977642_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-08-01T01:35:50.878+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-770/watchers","watchCount":3,"isWatching":false},"created":"2013-06-06T17:49:33.259+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335735","id":"12335735","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-12T18:30:21.770+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319323","id":"12319323","name":"nodemanager"}],"timeoriginalestimate":null,"description":"A mini yarn cluster based test just failed -NPE in the logs in {{NodeStatusUpdaterImpl}}, which is probably a symptom of the problem, not the cause -network trouble more likely there- but it shows there's some extra checking for null responses.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"332055","customfield_12312823":null,"summary":"NPE NodeStatusUpdaterImpl","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12651398/comment/13677316","id":"13677316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"A miniYARN cluster that was working just failed with an NPE. I think it could be network related -before I could file the JIRA I had to restart the network base station -it could be the network outage was causing an operation to fail. The null hypothesis is that I have broken some config. \n\nLogs\n{code}\n2013-06-06 18:37:39,957 [Thread-79] INFO  mortbay.log (Slf4jLog.java:info(67)) - Started SelectChannelConnector@stevel-2.local:53269\n2013-06-06 18:37:39,958 [Thread-79] INFO  webapp.WebApps (WebApps.java:start(210)) - Web app /node started at 53269\nJun 6, 2013 6:37:39 PM com.google.inject.servlet.GuiceFilter setPipeline\nWARNING: Multiple Servlet injectors detected. This is a warning indicating that you have more than one GuiceFilter running in your web application. If this is deliberate, you may safely ignore this message. If this is NOT deliberate however, your application may not work as expected.\n2013-06-06 18:37:39,973 [Thread-79] INFO  webapp.WebApps (WebApps.java:start(224)) - Registered webapp guice modules\n2013-06-06 18:37:39,975 [Thread-79] INFO  nodemanager.NodeStatusUpdaterImpl (NodeStatusUpdaterImpl.java:registerWithRM(260)) - Connecting to ResourceManager at /0.0.0.0:8031. current no. of attempts is 1\n2013-06-06 18:37:39,984 [Thread-79] INFO  util.RackResolver (RackResolver.java:coreResolve(100)) - Resolved 192.168.1.85 to /default-rack\n2013-06-06 18:37:39,986 [Thread-79] INFO  resourcemanager.ResourceTrackerService (ResourceTrackerService.java:registerNodeManager(224)) - NodeManager from node 192.168.1.85(cmPort: 53246 httpPort: 53269) registered with capability: <memory:4096, vCores:16>, assigned nodeId 192.168.1.85:53246\n2013-06-06 18:37:39,987 [Thread-79] INFO  security.NMContainerTokenSecretManager (NMContainerTokenSecretManager.java:setMasterKey(69)) - Rolling master-key for container-tokens, got key with id -523791826\n2013-06-06 18:37:39,988 [Thread-79] INFO  nodemanager.NodeStatusUpdaterImpl (NodeStatusUpdaterImpl.java:registerWithRM(306)) - Registered with ResourceManager as 192.168.1.85:53246 with total resource of <memory:4096, vCores:16>\n2013-06-06 18:37:39,988 [Thread-79] INFO  nodemanager.NodeStatusUpdaterImpl (NodeStatusUpdaterImpl.java:registerWithRM(308)) - Notifying ContainerManager to unblock new container-requests\n2013-06-06 18:37:39,989 [AsyncDispatcher event handler] INFO  rmnode.RMNodeImpl (RMNodeImpl.java:handle(346)) - 192.168.1.85:53246 Node Transitioned from NEW to RUNNING\n2013-06-06 18:37:39,997 [main] INFO  mortbay.log (Slf4jLog.java:info(67)) - Stopped SelectChannelConnector@stevel-2.local:0\n2013-06-06 18:37:40,000 [Node Status Updater] ERROR nodemanager.NodeStatusUpdaterImpl (NodeStatusUpdaterImpl.java:run(518)) - Caught exception in status-updater\njava.lang.NullPointerException\n\tat org.apache.hadoop.yarn.server.nodemanager.NodeStatusUpdaterImpl$1.run(NodeStatusUpdaterImpl.java:462)\n\tat java.lang.Thread.run(Thread.java:680)\n2013-06-06 18:37:40,098 [main] INFO  ipc.Server (Server.java:stop(2205)) - Stopping server on 53246\n2013-06-06 18:37:40,099 [IPC Server listener on 53246] INFO  ipc.Server (Server.java:run(705)) - Stopping IPC Server listener on 53246\n2013-06-06 18:37:40,099 [IPC Server Responder] INFO  ipc.Server (Server.java:run(847)) - Stopping IPC Server Responder\n2013-06-06 18:37:40,103 [main] INFO  monitor.ContainersMonitorImpl (ContainersMonitorImpl.java:isEnabled(159)) - ResourceCalculatorPlugin is unavailable on this system. org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.ContainersMonitorImpl is disabled.\n2013-06-06 18:37:40,104 [main] INFO  ipc.Server (Server.java:stop(2205)) - Stopping server on 53255\n2013-06-06 18:37:40,108 [IPC Server listener on 53255] INFO  ipc.Server (Server.java:run(705)) - Stopping IPC Server listener on 53255\n2013-06-06 18:37:40,108 [IPC Server Responder] INFO  ipc.Server (Server.java:run(847)) - Stopping IPC Server Responder\n{code}\n\nLooking at the code -this is the YARN-117-021 version- the line in question is looking at the response from the previous query -one that could be null if it has never had a valid response before {{isStopped}} is set to true, to break out of the loop:\n{code}\n            //get next heartbeat interval from response\n            nextHeartBeatInterval = response.getNextHeartBeatInterval();\n            // See if the master-key has rolled over\n{code}\n\nmaybe the combination of isStopped & null response is a special case in which bailing out faster is the right action","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2013-06-06T18:01:54.261+0000","updated":"2013-06-06T18:01:54.261+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12651398/comment/13715895","id":"13715895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xgong","name":"xgong","key":"xgong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Xuan Gong","active":true,"timeZone":"America/Los_Angeles"},"body":"[~stevel@apache.org] Could you provide me more information that I can re-produce this error, such as which command you are running ?\n\nI do not think this \n<code>\n            //get next heartbeat interval from response\n            nextHeartBeatInterval = response.getNextHeartBeatInterval();\n</code>\nwill cause this issue.\n\nBecause at ResourceTrackerService, this is how the response will be initiated before it returns back\n<code>\n    NodeHeartbeatResponse nodeHeartBeatResponse = YarnServerBuilderUtils\n        .newNodeHeartbeatResponse(lastNodeHeartbeatResponse.\n            getResponseId() + 1, NodeAction.NORMAL, null, null, null, null,\n            nextHeartBeatInterval);\n</code>. The nextHeartBeatInterval will be set.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xgong","name":"xgong","key":"xgong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Xuan Gong","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-23T00:14:18.610+0000","updated":"2013-07-23T00:14:18.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12651398/comment/13715904","id":"13715904","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xgong","name":"xgong","key":"xgong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Xuan Gong","active":true,"timeZone":"America/Los_Angeles"},"body":"Sorry for the previous comment. This one is much clearer.\n\nI do not think this \n{code}\n//get next heartbeat interval from response\nnextHeartBeatInterval = response.getNextHeartBeatInterval();\n{code}\nwill cause this issue.\nBecause at ResourceTrackerService, this is how the response will be initiated before it returns back\n{code}\nNodeHeartbeatResponse nodeHeartBeatResponse = YarnServerBuilderUtils\n.newNodeHeartbeatResponse(lastNodeHeartbeatResponse.\ngetResponseId() + 1, NodeAction.NORMAL, null, null, null, null,\nnextHeartBeatInterval);\n{code}\nThe nextHeartBeatInterval will be set.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xgong","name":"xgong","key":"xgong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Xuan Gong","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-23T00:17:50.147+0000","updated":"2013-07-23T00:17:50.147+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12651398/comment/13725109","id":"13725109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"I was just running a test which used a MiniYARN cluster; it showed this NPE in the stack when running a test case while the network was playing up. I haven't seen it since that single incident\n\nIs there a codepath that could lead to this NPE-ing condition if some previous operation failed, with timeout or IOException?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2013-07-31T11:01:36.615+0000","updated":"2013-07-31T11:01:36.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12651398/comment/13725739","id":"13725739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xgong","name":"xgong","key":"xgong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Xuan Gong","active":true,"timeZone":"America/Los_Angeles"},"body":"I run several test which used a miniYarn cluster, such as testAMRMClient, testNMClient. But I did not see that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xgong","name":"xgong","key":"xgong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Xuan Gong","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-31T21:27:33.000+0000","updated":"2013-07-31T21:27:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12651398/comment/13725946","id":"13725946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"[~stevel@apache.org], I am closing this as invalid for now. The code has changed a lot and it isn't apparent what was causing it.\n\nPlease feel free to reopen it when you run into it again. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-01T01:35:50.895+0000","updated":"2013-08-01T01:35:50.895+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-770/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1l87j:"}}