{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12786101","self":"https://issues.apache.org/jira/rest/api/2/issue/12786101","key":"YARN-3405","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2015-03-27T08:23:27.469+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 31 03:38:52 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_2_*:*_1492205353_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_2_*:*_43683089581","customfield_12312321":null,"resolutiondate":"2016-08-31T03:45:51.764+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-3405/watchers","watchCount":20,"isWatching":false},"created":"2015-03-27T07:04:17.086+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327585","id":"12327585","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"issuelinks":[{"id":"12459731","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12459731","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12786415","key":"YARN-3414","self":"https://issues.apache.org/jira/rest/api/2/issue/12786415","fields":{"summary":"FairScheduler's preemption may cause livelock","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12437273","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12437273","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12862645","key":"YARN-4134","self":"https://issues.apache.org/jira/rest/api/2/issue/12862645","fields":{"summary":"FairScheduler preemption stops at queue level that all child queues are not over their fairshare","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12479127","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12479127","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"12946005","key":"YARN-4752","self":"https://issues.apache.org/jira/rest/api/2/issue/12946005","fields":{"summary":"FairScheduler should preempt for a ResourceRequest and all preempted containers should be on the same node","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12421156","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12421156","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12818693","key":"YARN-3453","self":"https://issues.apache.org/jira/rest/api/2/issue/12818693","fields":{"summary":"Fair Scheduler: Parts of preemption logic uses DefaultResourceCalculator even in DRF mode causing thrashing","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12437274","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12437274","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12720801","key":"YARN-2154","self":"https://issues.apache.org/jira/rest/api/2/issue/12720801","fields":{"summary":"FairScheduler: Improve preemption to preempt only those containers that would satisfy the incoming request","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12493558","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12493558","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13040744","key":"YARN-6151","self":"https://issues.apache.org/jira/rest/api/2/issue/13040744","fields":{"summary":"FS preemption does not consider child queues over fairshare if the parent is under","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-02-06T19:42:29.697+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12322906","id":"12322906","name":"fairscheduler","description":"Fair Scheduler"}],"timeoriginalestimate":null,"description":"Queue hierarchy described as below:\n{noformat}\n                  root\n               /         \\\n       queue-1          queue-2       \n          /      \\\nqueue-1-1     queue-1-2\n{noformat}\n\nAssume cluster resource is 100\n# queue-1-1 and queue-2 has app. Each get 50 usage and 50 fairshare. \n# When queue-1-2 is active, and it cause some new preemption request for fairshare 25.\n# When preemption from root, it has possibility to find preemption candidate is queue-2. If so preemptContainerPreCheck for queue-2 return false because it's equal to its fairshare.\n# Finally queue-1-2 will be waiting for resource release form queue-1-1 itself.\n\nWhat I expect here is that queue-1-2 preempt from queue-1-1.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12724934","id":"12724934","filename":"YARN-3405.01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-13T13:33:33.068+0000","size":38140,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12724934/YARN-3405.01.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12727554","id":"12727554","filename":"YARN-3405.02.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-23T07:27:09.522+0000","size":40804,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12727554/YARN-3405.02.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"FairScheduler's preemption cannot happen between sibling in some case","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14383469","id":"14383469","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"And there is another related case which will cause live lock during preemption and scheduling.\nIf necessary, I will create a separated issue for it.\n\nQueue hierarchy described as below:\n{noformat}\n                      root\n              /        |        \\\n          queue-1    queue-2    queue-3     \n          /    \\\nqueue-1-1      queue-1-2\n{noformat}\n\n# Assume cluster resource is 100G in memory\n# Assume queue-1 has max resource limit 20G\n# queue-1-1 is active and it will get max 20G memory(equal to its fairshare)\n# queue-2 is active then, and it require 30G memory(less than its fairshare)\n# queue-3 is active, and it can be assigned with all other resources, 50G memory(larger than its fairshare)\n# queue-1-2 is active, it will cause new preemption request(10G memory and intuitively it can only preempt from its sibling queue-1-1)\n# Actually preemption starts from root, and it will find queue-3 is most over fairshare, and preempt some resources form queue-3.\n# But during scheduling, it will find queue-1 itself arrived it's max fairshare, and cannot assign resource to it. Then resource's again assigned to queue-3\n\nAnd then it repeats between last two steps.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-27T07:37:07.526+0000","updated":"2015-03-27T07:37:07.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14383513","id":"14383513","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"body":"It looks like the code will still check queue-1-1(leaf queue) even queue-1(parent queue)  is not over fair share.\nThis is the code for FSParentQueue#preemptContainer, for this case candidateQueue will become queue-1 because candidateQueue is null at the beginning.\n{code}\n  public RMContainer preemptContainer() {\n    RMContainer toBePreempted = null;\n\n    // Find the childQueue which is most over fair share\n    FSQueue candidateQueue = null;\n    Comparator<Schedulable> comparator = policy.getComparator();\n    for (FSQueue queue : childQueues) {\n      if (candidateQueue == null ||\n          comparator.compare(queue, candidateQueue) > 0) {\n        candidateQueue = queue;\n      }\n    }\n\n    // Let the selected queue choose which of its container to preempt\n    if (candidateQueue != null) {\n      toBePreempted = candidateQueue.preemptContainer();\n    }\n    return toBePreempted;\n  }\n{code}\nOnly leaf queue will not be checked if it is not over fair share.\nThe following is the code for FSLeafQueue#preemptContainer\n{code}\n  public RMContainer preemptContainer() {\n    RMContainer toBePreempted = null;\n\n    // If this queue is not over its fair share, reject\n    if (!preemptContainerPreCheck()) {\n      return toBePreempted;\n    }\n\n    if (LOG.isDebugEnabled()) {\n      LOG.debug(\"Queue \" + getName() + \" is going to preempt a container \" +\n          \"from its applications.\");\n    }\n\n    // Choose the app that is most over fair share\n    Comparator<Schedulable> comparator = policy.getComparator();\n    FSAppAttempt candidateSched = null;\n    readLock.lock();\n    try {\n      for (FSAppAttempt sched : runnableApps) {\n        if (candidateSched == null ||\n            comparator.compare(sched, candidateSched) > 0) {\n          candidateSched = sched;\n        }\n      }\n    } finally {\n      readLock.unlock();\n    }\n\n    // Preempt from the selected app\n    if (candidateSched != null) {\n      toBePreempted = candidateSched.preemptContainer();\n    }\n    return toBePreempted;\n  }\n{code}\npreemptContainerPreCheck is only called at leaf queue. So for this case,  leaf queue queue-1-1 is over fair share, it will be preempted.\nDo I miss the code which prevent queue-1(parent queue) to be recursively preempted?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-27T08:23:27.469+0000","updated":"2015-03-27T08:23:27.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14383546","id":"14383546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks, my mistake on the code detail. And I will verify it works now.\n\nAnd If queue1 level has some other sibling queue(like queue-2) that equals to queue-1's usage/fairshare,  \"candidateQueue\" still may be not the queue-1 itself, because they are equal by comparing, and will depends on the queue order.\nThen queue-1-2 still cannot preempt its sibling, and cause some live lock issue like above second scenario.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-27T08:57:36.714+0000","updated":"2015-03-27T08:57:36.714+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14383615","id":"14383615","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~zxu]\nI have verified that there's no problem in first scenario. \nSecond scenario problem still exists.  \n\nbq. And If queue1 level has some other sibling queue(like queue-2) that equals to queue-1's usage/fairshare, \"candidateQueue\" still may be not the queue-1 itself, because they are equal by comparing, and will depends on the queue order.Then queue-1-2 still cannot preempt its sibling, and cause some live lock issue like above second scenario.\n\nI think for above scenario it maybe results in preemptContainerPreCheck() for queue-2 (leaf queue) will fail, and queue-1-2 cannot get preempt any resources. Live lock will not happen.\n\nI'll update description once you committed above bad cases.\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-27T10:11:04.294+0000","updated":"2015-03-27T10:11:04.294+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14383953","id":"14383953","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"[~peng.zhang] - I haven't looked at the code yet; I think the issue described in the description exists, but don't quite see the livelock. Is this the confirmation you are looking for? \n\nThe back-and-forth is a little confusing, could you update the description with what you think the real problem is. If there is a second problem, let us handle that in a different JIRA and link the two if necessary. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-27T14:50:58.196+0000","updated":"2015-03-27T14:50:58.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14384363","id":"14384363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kasha] is right, There is a possibility for the first scenario. If we have another queue queue-2 which is queue-1's sibling and queue-2 is greater than queue-1 when compare queue-1 and queue-2, then queue-2 will always be picked for preemption and queue-1 won't have chance to be preempted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-27T18:49:13.518+0000","updated":"2015-03-27T18:49:13.518+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14385099","id":"14385099","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"bq. There is a possibility for the first scenario. If we have another queue queue-2 which is queue-1's sibling and queue-2 is greater than queue-1 when compare queue-1 and queue-2, then queue-2 will always be picked for preemption and queue-1 won't have chance to be preempted.\n\nFor this case \"queue-2 is greater than queue-1 when compare queue-1 and queue-2\":\nI think firstly preempt from queue-2(if it is LeafQueue) or queue-2's child Queue is reasonable.\nAnd then when preemption and scheduling cause queue-1 greater than queue-2, it should preempt from queue-1-1 ideally. (I think this may not happen in time by checking code, and maybe cause queue-1 is over preempted. But even if queue-1 is over preempted, during scheduling, the preempted containers will not be all assigned to queue-1, because queue-2 itself is under fair share. Finally it will got a balance & fair state.)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-28T03:53:57.218+0000","updated":"2015-03-28T03:53:57.218+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14385124","id":"14385124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~kasha]\nWhat the real problem I met in our cluster is livelock. After checking code, I think it has some other bad cases like we talked above.\nI list them together because I think they has the same basic problem: \"calculation of preemption request and preemption of container are separated as two phases\", lot of necessary info is lost between these two phases.\n\nFor less confusion, I created YARN-3414 to discuss livelock problem.\nAnd I'll update this description to show non-livelock case that I think.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-28T04:26:16.663+0000","updated":"2015-03-28T04:26:16.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14385135","id":"14385135","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"body":"This issue looks like a Comparator issue, It will be better to consider their child queues also when compare two parent queues.\nIn this case,  queue-1 could be considered as over fair share because its child queue queue-1-1 is over fair share.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zxu","name":"zxu","key":"zxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhihai xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-28T04:53:02.063+0000","updated":"2015-03-28T04:53:02.063+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14385154","id":"14385154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"Yes, changing comparator may solve this specific case, but what if queue-2 has same sub-queue hierarchy like queue-1, and at the same period, the second queue of them get active? Recursive compare still return equal, and the two latter sub-queue will be waiting.\n\nAs for this issue and YARN-3414, IMPO we should combine \"calculation of preemption request and preemption\". For each preemption request of leaf queue, starts preempt upside. If parent queue is under faieshare, found the most over fairshare from sibling, otherwise go up again. Finally when get to the root, it end because root definitively under fairshare.\n\nThis idea can also solve YARN-3414. When found parent has got fairshare(limited by max), it will preempt its sibling.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-28T06:15:00.226+0000","updated":"2015-03-28T06:15:00.226+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14388503","id":"14388503","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"I test this case in cluster: queue-2 will be preempted until its ResourceUsage( consumption - preempted resources)  equal to its fair share, and will not be over preempted.\nAnd then no preemption from sibling queue-1-1, and hang there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-31T13:19:11.689+0000","updated":"2015-03-31T13:19:11.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14390455","id":"14390455","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"I've a primitive idea to fix this and YARN-3414 under current preemption architecture.\n\n1. When calculation preemption request, update parent's preemption request.\n2. if parent's usage reached its fair share, it will not propagate preemption request upside again. So preemption request in parent queue means preemption needed between its children.\n3. During preempting phase, walk from root to downside\n  a. if parent queue has preemption request, it will do preemption between its children for the request(process like now, find the most over fair, and preempt recursively).  \n  b. And then(including after doing 3.a and the case not need preempt between children), traverse its children and repeat 3.a;\n\nThis process bring in traverse of the tree. And I think this will not affect performance severely because there are usually small amount of queues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-01T11:48:36.360+0000","updated":"2015-04-01T11:48:36.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14390471","id":"14390471","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"bq. \n2. if parent's usage reached its fair share, it will not propagate preemption request upside again. So preemption request in parent queue means preemption needed between its children.\n\nmake above statement more clear:\nIf request from children added with current usage less than fair share, parent queue will propagate request upside. This means current queue is under fair share, it need preempt from its sibling that who is over scheduled. When the amount reached current queue's fair share, the above request amount will be stored on current queue. This means these request amount need happen between current queue's children, ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-01T12:16:32.475+0000","updated":"2015-04-01T12:16:32.475+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14492402","id":"14492402","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"I uploaded one patch for this.\nThis patch updated TestFairSchedulerPreemption to test the preemption process and final usage share of queues.\nAnd this patch can also resolve YARN-3414, tested by TestFairSchedulerPreemption#testPreemptionWithFreeResources.\n\nIt now works good for fair policy, but for drf policy it still has some work to do related YARN-3453. I'll fix them in that issue after finishing this.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-13T13:42:39.685+0000","updated":"2015-04-13T13:42:39.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14492467","id":"14492467","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"Other issues for preemption during development, need confirmation:\n# Jobs in the same queue will not trigger preemption, cause resToPreemption() only considers unfair between queues. \n# MapReduce's map task will cause unneeded preemption request, because FSAppAttempt.updateDemand() will count all of ANY, rack and host request, so preemption demand will be triple for one map task. I want to change it to only counting for ANY request, but do not know whether it will affect Non-MapReduce framework. \n# Notion of \"MinResources\" is confusing and easy to misconfigure. Because calculation of fair share considers min, max & weight, when min of one queue is above cluster resources or its parent queue, other queue's fair share is 0, also I found sometimes sum of children's fair share can be larger than parent queue's fair share. I have some suggestions for these notion like below:\n* max resources means maximum resources that one queue can get\n* min resources means under which threshold the queue cannot not be preempted\n* weight notion changed to \"expected fair share\"  - like <10240mb 10cores> (I see weight implementation has memory and cpu, but we use only memory now), and make \"expected fair share\" as the only considered element during calculation of fair share.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-13T14:45:53.224+0000","updated":"2015-04-13T14:45:53.224+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14492482","id":"14492482","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12724934/YARN-3405.01.patch\n  against trunk revision 174d8b3.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:red}-1 findbugs{color}.  The patch appears to introduce 1 new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager.\n\nTest results: https://builds.apache.org/job/PreCommit-YARN-Build/7315//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-YARN-Build/7315//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-resourcemanager.html\nConsole output: https://builds.apache.org/job/PreCommit-YARN-Build/7315//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-13T15:03:10.293+0000","updated":"2015-04-13T15:03:10.293+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14494146","id":"14494146","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~kasha] & [~zxu]\nplz take a look and give some feedback. \nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-14T14:03:11.914+0000","updated":"2015-04-14T14:03:11.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14508536","id":"14508536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"Update patch: only preempt from children when queue is not starved and add test case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-23T06:31:38.327+0000","updated":"2015-04-23T06:31:38.327+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14508539","id":"14508539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12727548/YARN-3405.02.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / 18eb5e7 |\n| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/7468/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-23T06:40:22.838+0000","updated":"2015-04-23T06:40:22.838+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14508711","id":"14508711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"(!) The patch artifact directory on has been removed! \nThis is a fatal error for test-patch.sh.  Aborting. \nJenkins (node H8) information at https://builds.apache.org/job/PreCommit-YARN-Build/7469/ may provide some hints.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-23T09:12:00.849+0000","updated":"2015-04-23T09:12:00.849+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/14742798","id":"14742798","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12727554/YARN-3405.02.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / 332b520 |\n| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/9109/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-14T02:09:39.302+0000","updated":"2015-09-14T02:09:39.302+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/15174865","id":"15174865","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 0s {color} | {color:blue} Docker mode activated. {color} |\n| {color:red}-1{color} | {color:red} patch {color} | {color:red} 0m 5s {color} | {color:red} YARN-3405 does not apply to trunk. Rebase required? Wrong Branch? See https://wiki.apache.org/hadoop/HowToContribute for help. {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12727554/YARN-3405.02.patch |\n| JIRA Issue | YARN-3405 |\n| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/10683/console |\n| Powered by | Apache Yetus 0.3.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-03-02T02:02:38.471+0000","updated":"2016-03-02T02:02:38.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786101/comment/15450959","id":"15450959","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 0s {color} | {color:blue} Docker mode activated. {color} |\n| {color:red}-1{color} | {color:red} patch {color} | {color:red} 0m 6s {color} | {color:red} YARN-3405 does not apply to trunk. Rebase required? Wrong Branch? See https://wiki.apache.org/hadoop/HowToContribute for help. {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12727554/YARN-3405.02.patch |\n| JIRA Issue | YARN-3405 |\n| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/12961/console |\n| Powered by | Apache Yetus 0.3.0   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-31T03:38:52.399+0000","updated":"2016-08-31T03:38:52.399+0000"}],"maxResults":23,"total":23,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-3405/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i27fnr:"}}