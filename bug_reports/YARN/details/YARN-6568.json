{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13069906","self":"https://issues.apache.org/jira/rest/api/2/issue/13069906","key":"YARN-6568","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-05-08T21:38:00.883+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed May 10 12:31:01 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-6568/watchers","watchCount":8,"isWatching":false},"created":"2017-05-08T08:04:08.948+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":60,"aggregatetimeoriginalestimate":60,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331976","id":"12331976","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-08-06T08:40:53.223+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12322906","id":"12322906","name":"fairscheduler","description":"Fair Scheduler"}],"timeoriginalestimate":60,"description":"In our cluster, we find some applications couldn't acquire any container for long time. (Note: we use FairSharePolicy and FairScheduler)\n\nFirst, I found some unreasonable configuration, we set minRes=maxRes. So some application keep pending for long time, we kill some large applicaiton to solve this problem. Then we changed this configuration, this problem relieves. \n\nBut this problem is not completely solved. In our cluster, I found applications in  some queue which request few container keep pending for long time. \n\nI simulate in test cluster. I submit DistributedShell application which run many loo applications to queueA, then I submit my own yarn application which request container and release container constantly to queueB.  At this time, any applicaitons which are submmited to queueA keep pending!\n\nWe know this is the problem of FairSharePolicy, it consider the request of queue. So after sort the queues, some queues which have few request are ordered last all time.\n\nWe know if the AM container is launched, then the request will increase, But FairSharePolicy can't distinguish which request is AM request. I think if am container is assigned, the problem is solved. \n\nOur companion discuss this problem. we recommend set a timeout for queue, it means the time length of a queue is not assigned. If timeout, we set this queue to the first place of queues list. ","customfield_10010":null,"timetracking":{"originalEstimate":"1m","remainingEstimate":"1m","originalEstimateSeconds":60,"remainingEstimateSeconds":60},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331976","id":"12331976","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":60,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"A queue which runs a long time job couldn't acquire any container for long time.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengchenyu","name":"zhengchenyu","key":"zhengchenyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhengchenyu","active":true,"timeZone":"Asia/Harbin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengchenyu","name":"zhengchenyu","key":"zhengchenyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhengchenyu","active":true,"timeZone":"Asia/Harbin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":60,"percent":0},"customfield_12311024":null,"environment":"CentOS 7.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":60,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069906/comment/16001592","id":"16001592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"body":"Not sure if I understand your issue. \n{quote}\nI simulate in test cluster. I submit DistributedShell application which run many loo applications to queueA, then I submit my own yarn application which request container and release container constantly to queueB. At this time, any applicaitons which are submmited to queueA keep pending!\n{quote}\nThat sounds legitimate to me. QueueA gets all resources if no other queues are active. Submitting apps to queueB change queueB from inactive to active which makes queueA only get its own portion instead of all resources in the cluster. To increase weight of queueA can mitigate this issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-05-08T21:38:00.883+0000","updated":"2017-05-08T21:38:00.883+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069906/comment/16002155","id":"16002155","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengchenyu","name":"zhengchenyu","key":"zhengchenyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhengchenyu","active":true,"timeZone":"Asia/Harbin"},"body":"[~yufeigu]\nFirst, in FairSharePolicy.FairShareComparator.compare, weight only take effect when two queue are both not hungry or between two applicaitons.  Even though weights take effect, it's terrible for admin to change the weight dynamically. \n\nSeconds, I said queueA has only one request, but it is am request. queueB has many request, but not any am request. If two queue are also hungry (means two queue's minRes are big enough),  it sorts the queues by this variable 'minShareRatio'( in FairSharePolicy.java). At this time, minShareRatio = resourceUsage / (resourceUsage + request) . Here minShareRatio of queueA is always bigger than minShareRatio of queueB. So queueA can't acquire resource for long time, queueA keep pending for long time. But we know if AM container could launch, more requests would arrive. So I think we need to handle the AM request specially, or set timeout for pending queue. But I tend to the latter, it's easy. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengchenyu","name":"zhengchenyu","key":"zhengchenyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhengchenyu","active":true,"timeZone":"Asia/Harbin"},"created":"2017-05-09T06:38:05.080+0000","updated":"2017-05-09T06:38:05.080+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069906/comment/16003143","id":"16003143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"body":"According to the code in FairSharePolicy.java, {{minShareRatio}} is {{resourceUsage / min(minShare, demand)}} if {{minShare}} is big enough. Why queueA's {{minShareRatio}} is always bigger than queueB's? {{resourceUsage}} of queueA could be zero or will be zero over time in your case.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-05-09T17:38:50.412+0000","updated":"2017-05-09T17:38:50.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069906/comment/16003908","id":"16003908","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengchenyu","name":"zhengchenyu","key":"zhengchenyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhengchenyu","active":true,"timeZone":"Asia/Harbin"},"body":"[~yufeigu]\nSorry, I didn't express definitely! \nI said that the minShare1 which is big enough is configured by fair-scheduler.xml, not the variable 'minShare1'. It equals s1.getMinShare.\nlook the code below. if minShare1 which is configured by fair-scheduler.xml is big enough. the variable 'minShare1' equals s1.getDemand. It means the variable 'minShare1' = resourceUsage + request.\n{code}\nResource minShare1 = Resources.min(RESOURCE_CALCULATOR, null,s1.getMinShare(), s1.getDemand());\n{code}\n\nlook the code below. At this time, minShareRatio1 = resourceUsage1/'minShare1 =  resourceUsage1 / (resourceUsage1+request1)\n\n{code}\nminShareRatio1 = (double) resourceUsage1.getMemory()/ Resources.max(RESOURCE_CALCULATOR, null, minShare1, ONE).getMemory();\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengchenyu","name":"zhengchenyu","key":"zhengchenyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhengchenyu","active":true,"timeZone":"Asia/Harbin"},"created":"2017-05-10T01:56:14.949+0000","updated":"2017-05-10T01:57:05.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13069906/comment/16004604","id":"16004604","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengchenyu","name":"zhengchenyu","key":"zhengchenyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhengchenyu","active":true,"timeZone":"Asia/Harbin"},"body":"I solve this problem, when I set the timeout for queue. \nIn my first version, the timeout of every queue are same. I think it is necessary to set different timeout for queues. By this, we could accelerate specified queue！ ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengchenyu","name":"zhengchenyu","key":"zhengchenyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhengchenyu","active":true,"timeZone":"Asia/Harbin"},"created":"2017-05-10T12:31:01.420+0000","updated":"2017-05-10T12:31:01.420+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-6568/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3embz:"}}