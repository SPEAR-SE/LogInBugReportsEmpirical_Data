{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13127357","self":"https://issues.apache.org/jira/rest/api/2/issue/13127357","key":"YARN-7685","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-01-17T09:43:25.085+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 17 09:43:25 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-7685/watchers","watchCount":3,"isWatching":false},"created":"2017-12-27T10:05:23.651+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334006","id":"12334006","description":"2.7.3 release","name":"2.7.3","archived":false,"released":true,"releaseDate":"2016-08-25"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-01-17T09:43:25.085+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327621","id":"12327621","name":"capacity scheduler"}],"timeoriginalestimate":null,"description":"Have two queues default and tkgrid and two node labels default (exclusivity=true) and tkgrid (exclusivity=false)\r\n\r\ndefault queue = capacity 15% and max capacity is 100% and default node label expression is tkgrid\r\ntkgrid queue = capacity 85% and max capacity is 100% and default node label expression is default\r\n\r\nWhen default queue has occupied the complete node label tkgrid and then a new job submitted into tkgrid queue with node label expression tkgrid will wait in ACCEPTED state forever as there is no space in tkgrid partition for the Application Master. Preemption does not kick in for this scenario.\r\n\r\nAttached capacity-scheduler.xml, RM UI, Nodes and Node Labels screenshot.\r\n\r\n{code}\r\nRepro Steps:\r\n[yarn@bigdata3 root]$ yarn cluster  --list-node-labels \r\nNode Labels: <tkgrid:exclusivity=false>\r\n\r\nJob 1 submitted into default queue which has utilized complete tkgrid node label partition:\r\n\r\nyarn jar /usr/hdp/2.6.1.0-129/hadoop-yarn/hadoop-yarn-applications-distributedshell-2.7.3.2.6.1.0-129.jar  -master_memory 2048 -container_memory 2048 -shell_command sleep -shell_args 2h -timeout 7200000 -jar /usr/hdp/2.6.1.0-129/hadoop-yarn/hadoop-yarn-applications-distributedshell-2.7.3.2.6.1.0-129.jar -queue default  -num_containers 20\r\n\r\nJob 2 submitted into tkgrid queue with AM node label expression as tkgrid which stays at ACCEPTED state forever\r\n\r\nyarn jar /usr/hdp/2.6.1.0-129/hadoop-yarn/hadoop-yarn-applications-distributedshell-2.7.3.2.6.1.0-129.jar  -master_memory 2048 -container_memory 2048 -shell_command sleep -shell_args 2h -timeout 7200000 -jar /usr/hdp/2.6.1.0-129/hadoop-yarn/hadoop-yarn-applications-distributedshell-2.7.3.2.6.1.0-129.jar -queue tkgrid  -node_label_expression tkgrid  -num_containers 20\r\n\r\n\r\n17/12/27 09:31:48 INFO distributedshell.Client: Got application report from ASM for, appId=5, clientToAMToken=null, appDiagnostics=[Wed Dec 27 09:31:39 +0000 2017] Application is Activated, waiting for resources to be assigned for AM.  Details : AM Partition = tkgrid ; Partition Resource = <memory:35840, vCores:56> ; Queue's Absolute capacity = 85.0 % ; Queue's Absolute used capacity = 0.0 % ; Queue's Absolute max capacity = 100.0 % ; , appMasterHost=N/A, appQueue=tkgrid, appMasterRpcPort=-1, appStartTime=1514367099792, yarnAppState=ACCEPTED, distributedFinalState=UNDEFINED, appTrackingUrl=http://bigdata3.openstacklocal:8088/proxy/application_1514366265793_0005/, appUser=yarn\r\n\r\n{code}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12903786","id":"12903786","filename":"capacity-scheduler.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2017-12-27T10:04:43.809+0000","size":4851,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12903786/capacity-scheduler.xml"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12903790","id":"12903790","filename":"Screen Shot 2017-12-27 at 3.28.13 PM.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2017-12-27T10:04:10.604+0000","size":394583,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12903790/Screen+Shot+2017-12-27+at+3.28.13+PM.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12903789","id":"12903789","filename":"Screen Shot 2017-12-27 at 3.28.20 PM.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2017-12-27T10:04:06.682+0000","size":115305,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12903789/Screen+Shot+2017-12-27+at+3.28.20+PM.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12903788","id":"12903788","filename":"Screen Shot 2017-12-27 at 3.28.32 PM.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2017-12-27T10:04:15.084+0000","size":350974,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12903788/Screen+Shot+2017-12-27+at+3.28.32+PM.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12903787","id":"12903787","filename":"Screen Shot 2017-12-27 at 3.31.42 PM.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2017-12-27T10:04:14.414+0000","size":384544,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12903787/Screen+Shot+2017-12-27+at+3.31.42+PM.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Preemption does not happen when a node label partition is fully utilized","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127357/comment/16328552","id":"16328552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Feng+Yuan","name":"Feng Yuan","key":"feng yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=feng+yuan&avatarId=29897","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=feng+yuan&avatarId=29897","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=feng+yuan&avatarId=29897","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=feng+yuan&avatarId=29897"},"displayName":"Feng Yuan","active":true,"timeZone":"Etc/UTC"},"body":"Now 2.7.x version do not support labeled resource preemption.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Feng+Yuan","name":"Feng Yuan","key":"feng yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=feng+yuan&avatarId=29897","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=feng+yuan&avatarId=29897","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=feng+yuan&avatarId=29897","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=feng+yuan&avatarId=29897"},"displayName":"Feng Yuan","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-17T09:43:25.085+0000","updated":"2018-01-17T09:43:25.085+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-7685/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3obc7:"}}