{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13145313","self":"https://issues.apache.org/jira/rest/api/2/issue/13145313","key":"YARN-8031","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-03-16T16:40:29.905+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Mar 17 07:07:32 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-8031/watchers","watchCount":3,"isWatching":false},"created":"2018-03-15T09:41:56.323+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326262","id":"12326262","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-03-17T07:07:32.414+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319323","id":"12319323","name":"nodemanager"}],"timeoriginalestimate":null,"description":"if *yarn.nodemanager.linux-container-executor.cgroups.mount* is set to true and cpu subsystem is not yet mounted, NodeManager will mount the cpu subsystem and then create the control group whose default name is *hadoop-yarn* if the mount step is successful. This procedure works well if cpu subsystem is not yet mounted. However, under some situation cpu subsystem is already mounted before NodeManager starts and NodeManager will fail to start because of no write permission to the *hadoop-yarn* path . For example:\r\n # in OS that use systemd such as centos7 will have cpu subsystem mounted by default on machine startup\r\n # some deamon whose start order is more precedent than NodeManager may also rely on the mounted state of cpu subsystem. In our production environment, we limit the cpu usage of the monitoring and control agent, which starts on reboot\r\n\r\nIn order to solve this problem, container-executor must be able to create the control group *hadoop-yarn* if mounting controller is successful or this controller is already mounted. Besides, if cpu subsystem is used in combination with other subsystem and it's already mounted, container-executor should use the latest mount point of cpu subsystem instread of the one provided by NodeManager.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12914987","id":"12914987","filename":"YARN-8031.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayceAu","name":"jayceAu","key":"jayceau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"JayceAu","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-17T07:01:03.160+0000","size":2288,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12914987/YARN-8031.001.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"NodeManager will fail to start if cpu subsystem is already mounted","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayceAu","name":"jayceAu","key":"jayceau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"JayceAu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayceAu","name":"jayceAu","key":"jayceau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"JayceAu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13145313/comment/16402162","id":"16402162","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miklos.szegedi%40cloudera.com","name":"miklos.szegedi@cloudera.com","key":"miklos.szegedi@cloudera.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=miklos.szegedi%40cloudera.com&avatarId=32342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=miklos.szegedi%40cloudera.com&avatarId=32342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=miklos.szegedi%40cloudera.com&avatarId=32342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=miklos.szegedi%40cloudera.com&avatarId=32342"},"displayName":"Miklos Szegedi","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jayceAu], thank you for raising this. If you have CGroups already mounted, you should set the mount option to false as described here:\r\n\r\n[https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/NodeManagerCgroups.html]\r\n{code:java}\r\nDiscover CGroups mounted already\tThis should be used on newer systems like RHEL7 or Ubuntu16 or if the administrator mounts CGroups before YARN starts. Set yarn.nodemanager.linux-container-executor.cgroups.mount to false and leave other settings set to their defaults. YARN will locate the mount points in /proc/mounts. Common locations include /sys/fs/cgroup and /cgroup. The default location can vary depending on the Linux distribution in use.{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miklos.szegedi%40cloudera.com","name":"miklos.szegedi@cloudera.com","key":"miklos.szegedi@cloudera.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=miklos.szegedi%40cloudera.com&avatarId=32342","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=miklos.szegedi%40cloudera.com&avatarId=32342","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=miklos.szegedi%40cloudera.com&avatarId=32342","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=miklos.szegedi%40cloudera.com&avatarId=32342"},"displayName":"Miklos Szegedi","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-03-16T16:40:29.905+0000","updated":"2018-03-16T16:40:29.905+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13145313/comment/16403294","id":"16403294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayceAu","name":"jayceAu","key":"jayceau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"JayceAu","active":true,"timeZone":"Etc/UTC"},"body":"@Miklos Szegedi, after reading the source code and according to my test result, if set this *yarn.nodemanager.linux-container-executor.cgroups.mount* to false, NM won't create the hierarchy directory hadoop-yarn with cpu controller mounted, which is conflict with what is mentioned in the doc:\r\n\r\n[https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/NodeManagerCgroups.html]\r\n{code:java}\r\n// code placeholder\r\nThe cgroups hierarchy under which to place YARN proccesses(cannot contain commas). If yarn.nodemanager.linux-container-executor.cgroups.mount is false (that is, if cgroups have been pre-configured) and the YARN user has write access to the parent directory, then the directory will be created. If the directory already exists, the administrator has to give YARN write permissions to it recursively.\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayceAu","name":"jayceAu","key":"jayceau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"JayceAu","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-17T07:07:32.414+0000","updated":"2018-03-17T07:07:32.414+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-8031/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3rc1r:"}}