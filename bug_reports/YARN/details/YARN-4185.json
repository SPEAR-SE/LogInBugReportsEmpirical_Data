{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12888625","self":"https://issues.apache.org/jira/rest/api/2/issue/12888625","key":"YARN-4185","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-09-28T23:38:16.912+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 06 01:42:13 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4185/watchers","watchCount":6,"isWatching":false},"created":"2015-09-18T17:59:51.181+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neelesh77","name":"neelesh77","key":"neelesh77","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=neelesh77&avatarId=24299","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=neelesh77&avatarId=24299","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=neelesh77&avatarId=24299","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=neelesh77&avatarId=24299"},"displayName":"Neelesh Srinivas Salian","active":true,"timeZone":"America/Dawson"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-06T01:42:13.669+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"Instead of having a fixed retry interval that starts off very high and stays there, we are better off using an exponential backoff that has the same fixed max limit. Today the retry interval is fixed at 10 sec that can be unnecessarily high especially when NMs could rolling restart within a sec.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Retry interval delay for NM client can be improved from the fixed static retry ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12888625/comment/14934350","id":"14934350","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neelesh77","name":"neelesh77","key":"neelesh77","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=neelesh77&avatarId=24299","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=neelesh77&avatarId=24299","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=neelesh77&avatarId=24299","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=neelesh77&avatarId=24299"},"displayName":"Neelesh Srinivas Salian","active":true,"timeZone":"America/Dawson"},"body":"I would like to work on this JIRA if no one has already begun.\nIf yes, could you please assign the JIRA to me?\n\nThank you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neelesh77","name":"neelesh77","key":"neelesh77","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=neelesh77&avatarId=24299","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=neelesh77&avatarId=24299","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=neelesh77&avatarId=24299","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=neelesh77&avatarId=24299"},"displayName":"Neelesh Srinivas Salian","active":true,"timeZone":"America/Dawson"},"created":"2015-09-28T23:38:16.912+0000","updated":"2015-09-28T23:38:16.912+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12888625/comment/14935452","id":"14935452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neelesh77","name":"neelesh77","key":"neelesh77","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=neelesh77&avatarId=24299","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=neelesh77&avatarId=24299","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=neelesh77&avatarId=24299","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=neelesh77&avatarId=24299"},"displayName":"Neelesh Srinivas Salian","active":true,"timeZone":"America/Dawson"},"body":"Writing up a patch for this.\nQuestions I had:\n1) This would be included for the NMProxy and a new RetryPolicy setting\nexponentialBackoffRetry(5,1000, TimeUnit.MILLISECONDS\nWhat would be the value of the maxRetries?\n\nI see the value set to 5 for NameNodeProxies. Is there an arbitrarily set value or does it need to be taken from the conf?\nThank you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neelesh77","name":"neelesh77","key":"neelesh77","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=neelesh77&avatarId=24299","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=neelesh77&avatarId=24299","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=neelesh77&avatarId=24299","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=neelesh77&avatarId=24299"},"displayName":"Neelesh Srinivas Salian","active":true,"timeZone":"America/Dawson"},"created":"2015-09-29T17:07:07.650+0000","updated":"2015-09-29T17:07:07.650+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12888625/comment/14938190","id":"14938190","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"body":"can we try to reuse the existing values for retries (yarn.client.nodemanager-connect. ) and see if we can be mostly compatible? I am thinking its fine if its not exactly the same behavior","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-30T18:06:40.237+0000","updated":"2015-09-30T18:06:40.237+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12888625/comment/14942528","id":"14942528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neelesh77","name":"neelesh77","key":"neelesh77","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=neelesh77&avatarId=24299","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=neelesh77&avatarId=24299","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=neelesh77&avatarId=24299","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=neelesh77&avatarId=24299"},"displayName":"Neelesh Srinivas Salian","active":true,"timeZone":"America/Dawson"},"body":"Thoughts:\n1) Using the exponentialBackoffRetry policy will have a progression of wait time starting at 1sec per retry assuming it takes a second for the NM to come up.\nHence exponentially, the backoff time increases 2,4,8,16...till 512 as we approach 10 retries.\n\n2) In the current strategy, the wait time is 10 seconds which causes an NM that restarted in 1 second to wait for a retry.\n\n3) In the event of the retries going forward, at the 3rd retry ( the wait time is collectively 7 seconds (1+2+4) as per the exponential strategy) and (30 (10+10+10) seconds as the current static retry)\n\n4) If you keep retrying, collectively the waiting static retry has now waited for 60 seconds versus 2^6 = 64 seconds in the exponential strategy at the 6th retry attempt.\n\nLogic for the Design:\n1) In the event of retries being default to 10, \n   a. I propose after the 3rd attempt, we continue to keep the wait time as 4 seconds and continue the same. \n   Thus the total time comes up to 1,2,4,4,4,4,4,4,4,4 = 35 seconds.\n   b. Versus collectively spending 100 seconds on waiting time in the static retry strategy.\n\n2) Alternatively, the logic could be:\n   a. Have the 1st 3 attempts of retry. If further needed, fall back to the 1sec start of the same logic.\n      So, it looks like this.. (1,2,4)  (1,2,4)  (1,2,4) (1) for 10 retries.\n   b. Thus we get the 10 retries done in collectively 22 seconds versus 100 seconds.\n\nRequesting feedback.\nThank you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neelesh77","name":"neelesh77","key":"neelesh77","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=neelesh77&avatarId=24299","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=neelesh77&avatarId=24299","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=neelesh77&avatarId=24299","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=neelesh77&avatarId=24299"},"displayName":"Neelesh Srinivas Salian","active":true,"timeZone":"America/Dawson"},"created":"2015-10-04T01:42:34.338+0000","updated":"2015-10-04T01:42:34.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12888625/comment/14943809","id":"14943809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"body":"I don't think option 2 where you restart from 1 makes sense. Its also not a goal to minimize the total wait time. The goal should be to minimize the time to recover for short intermittent failure while also waiting long enough for long failures before giving up. Would it be better for us to ramp up to 10 sec exponentially and then do the n retries for 10 sec or do totally n retries including the ramp up.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-05T18:45:19.403+0000","updated":"2015-10-05T18:45:19.403+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12888625/comment/14944384","id":"14944384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neelesh77","name":"neelesh77","key":"neelesh77","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=neelesh77&avatarId=24299","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=neelesh77&avatarId=24299","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=neelesh77&avatarId=24299","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=neelesh77&avatarId=24299"},"displayName":"Neelesh Srinivas Salian","active":true,"timeZone":"America/Dawson"},"body":"[~adhoot], thanks for the clarification.\nSo, the initial retries can be done with backoff times of 1,2,4,8 that is still less then 10 and thus give the opportunity to retry for a short-lived NM restart (under 10 seconds)\nWe can continue to wait 10 seconds of backoff incrementally to accomodate a larger failure time.\n\nThus, the failure times can be under 1,2,4,8,10,10 and so on till the number of retries is exhausted.\nMy only concern is that if the failure lasts longer than the total wait time and the number of retries, there won't be a chance to retry.\n\nI'll write up a patch to exhibit this.\nThank you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neelesh77","name":"neelesh77","key":"neelesh77","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=neelesh77&avatarId=24299","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=neelesh77&avatarId=24299","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=neelesh77&avatarId=24299","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=neelesh77&avatarId=24299"},"displayName":"Neelesh Srinivas Salian","active":true,"timeZone":"America/Dawson"},"created":"2015-10-06T01:42:13.669+0000","updated":"2015-10-06T01:42:13.669+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4185/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2l4qn:"}}