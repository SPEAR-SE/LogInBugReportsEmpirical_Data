{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13179376","self":"https://issues.apache.org/jira/rest/api/2/issue/13179376","key":"YARN-8672","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 16 15:04:32 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-8672/watchers","watchCount":2,"isWatching":false},"created":"2018-08-16T15:02:01.713+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12342758","id":"12342758","name":"3.2.0","archived":false,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=csingh","name":"csingh","key":"csingh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=csingh&avatarId=24876","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=csingh&avatarId=24876","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=csingh&avatarId=24876","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=csingh&avatarId=24876"},"displayName":"Chandni Singh","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-21T22:30:09.410+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319323","id":"12319323","name":"nodemanager"}],"timeoriginalestimate":null,"description":"Precommit builds have been failing in TestContainerManager#testLocalingResourceWhileContainerRunning.  I have been able to reproduce the problem without any patch applied if I run the test enough times.  It looks like something is removing container tokens from the nmPrivate area just as a new localizer starts.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"TestContainerManager#testLocalingResourceWhileContainerRunning occasionally times out","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13179376/comment/16582661","id":"16582661","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Here's some sample output showing the localization failure which I believe leads to the test timeout:\r\n{noformat}\r\n2018-08-14 23:57:37,636 INFO  [NM ContainerManager dispatcher] containermanager.AuxServices (AuxServices.java:handle(350)) - Got event CONTAINER_INIT for appId application_0_0000\r\n2018-08-14 23:57:37,636 INFO  [NM ContainerManager dispatcher] localizer.ResourceLocalizationService (ResourceLocalizationService.java:handle(789)) - Created localizer for container_0_0000_01_000000\r\n2018-08-14 23:57:37,642 INFO  [LocalizerRunner for container_0_0000_01_000000] localizer.ResourceLocalizationService (ResourceLocalizationService.java:writeCredentials(1315)) - Writing credentials to the nmPrivate file /testptch/hadoop/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/target/TestContainerManager-localDir/nmPrivate/container_0_0000_01_000000.tokens\r\n2018-08-14 23:57:37,645 INFO  [LocalizerRunner for container_0_0000_01_000000] nodemanager.DefaultContainerExecutor (DefaultContainerExecutor.java:createUserCacheDirs(836)) - Initializing user nobody\r\n2018-08-14 23:57:37,662 INFO  [LocalizerRunner for container_0_0000_01_000000] nodemanager.DefaultContainerExecutor (DefaultContainerExecutor.java:startLocalizer(166)) - Copying from /testptch/hadoop/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/target/TestContainerManager-localDir/nmPrivate/container_0_0000_01_000000.tokens to /testptch/hadoop/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/target/TestContainerManager-localDir/usercache/nobody/appcache/application_0_0000/container_0_0000_01_000000.tokens\r\n2018-08-14 23:57:37,663 INFO  [LocalizerRunner for container_0_0000_01_000000] nodemanager.DefaultContainerExecutor (DefaultContainerExecutor.java:startLocalizer(174)) - Localizer CWD set to /testptch/hadoop/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/target/TestContainerManager-localDir/usercache/nobody/appcache/application_0_0000 = file:/testptch/hadoop/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/target/TestContainerManager-localDir/usercache/nobody/appcache/application_0_0000\r\n2018-08-14 23:57:37,704 INFO  [NM ContainerManager dispatcher] container.ContainerImpl (ContainerImpl.java:handle(2109)) - Container container_0_0000_01_000000 transitioned from LOCALIZING to SCHEDULED\r\n2018-08-14 23:57:37,705 INFO  [NM ContainerManager dispatcher] scheduler.ContainerScheduler (ContainerScheduler.java:startContainer(541)) - Starting container [container_0_0000_01_000000]\r\n2018-08-14 23:57:37,733 INFO  [NM ContainerManager dispatcher] container.ContainerImpl (ContainerImpl.java:handle(2109)) - Container container_0_0000_01_000000 transitioned from SCHEDULED to RUNNING\r\n2018-08-14 23:57:37,734 INFO  [NM ContainerManager dispatcher] monitor.ContainersMonitorImpl (ContainersMonitorImpl.java:onStartMonitoringContainer(1013)) - Starting resource-monitoring for container_0_0000_01_000000\r\n2018-08-14 23:57:37,771 INFO  [ContainersLauncher #0] nodemanager.DefaultContainerExecutor (DefaultContainerExecutor.java:buildCommandExecutor(370)) - launchContainer: [bash, /testptch/hadoop/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/target/TestContainerManager-localDir/usercache/nobody/appcache/application_0_0000/container_0_0000_01_000000/default_container_executor.sh]\r\n2018-08-14 23:57:38,635 INFO  [main] containermanager.ContainerManagerImpl (ContainerManagerImpl.java:getContainerStatusInternal(1455)) - Getting container-status for container_0_0000_01_000000\r\n2018-08-14 23:57:38,636 INFO  [main] containermanager.ContainerManagerImpl (ContainerManagerImpl.java:getContainerStatusInternal(1469)) - Returning ContainerStatus: [ContainerId: container_0_0000_01_000000, ExecutionType: GUARANTEED, State: RUNNING, Capability: <memory:1024, vCores:1>, Diagnostics: , ExitStatus: -1000, IP: null, Host: null, ContainerSubState: RUNNING]\r\n2018-08-14 23:57:38,636 INFO  [main] containermanager.TestContainerManager (BaseContainerManagerTest.java:waitForContainerState(338)) - Waiting for container to get into one of states [RUNNING]. Current state is RUNNING\r\n2018-08-14 23:57:38,636 INFO  [main] containermanager.TestContainerManager (BaseContainerManagerTest.java:waitForContainerState(343)) - Container state is RUNNING\r\n2018-08-14 23:57:38,651 INFO  [NM ContainerManager dispatcher] localizer.ResourceLocalizationService (ResourceLocalizationService.java:handle(783)) - New REQUEST_RESOURCE_LOCALIZATION localize request for container_0_0000_01_000000, remove old private localizer.\r\n2018-08-14 23:57:38,651 INFO  [NM ContainerManager dispatcher] localizer.ResourceLocalizationService (ResourceLocalizationService.java:handle(789)) - Created localizer for container_0_0000_01_000000\r\n2018-08-14 23:57:38,656 INFO  [LocalizerRunner for container_0_0000_01_000000] localizer.ResourceLocalizationService (ResourceLocalizationService.java:run(1252)) - Localizer failed for container_0_0000_01_000000\r\nExitCodeException exitCode=1: chmod: cannot access '/testptch/hadoop/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/target/TestContainerManager-localDir/nmPrivate/container_0_0000_01_000000.tokens': No such file or directory\r\n\r\n\tat org.apache.hadoop.util.Shell.runCommand(Shell.java:1008)\r\n\tat org.apache.hadoop.util.Shell.run(Shell.java:901)\r\n\tat org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:1213)\r\n\tat org.apache.hadoop.util.Shell.execCommand(Shell.java:1307)\r\n\tat org.apache.hadoop.util.Shell.execCommand(Shell.java:1289)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.setPermission(RawLocalFileSystem.java:865)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem$LocalFSFileOutputStream.<init>(RawLocalFileSystem.java:252)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem$LocalFSFileOutputStream.<init>(RawLocalFileSystem.java:232)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.createOutputStreamWithMode(RawLocalFileSystem.java:331)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.create(RawLocalFileSystem.java:320)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.create(RawLocalFileSystem.java:351)\r\n\tat org.apache.hadoop.fs.FileSystem.primitiveCreate(FileSystem.java:1279)\r\n\tat org.apache.hadoop.fs.DelegateToFileSystem.createInternal(DelegateToFileSystem.java:100)\r\n\tat org.apache.hadoop.fs.ChecksumFs$ChecksumFSOutputSummer.<init>(ChecksumFs.java:353)\r\n\tat org.apache.hadoop.fs.ChecksumFs.createInternal(ChecksumFs.java:400)\r\n\tat org.apache.hadoop.fs.AbstractFileSystem.create(AbstractFileSystem.java:605)\r\n\tat org.apache.hadoop.fs.FileContext$3.next(FileContext.java:696)\r\n\tat org.apache.hadoop.fs.FileContext$3.next(FileContext.java:692)\r\n\tat org.apache.hadoop.fs.FSLinkResolver.resolve(FSLinkResolver.java:90)\r\n\tat org.apache.hadoop.fs.FileContext.create(FileContext.java:698)\r\n\tat org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$LocalizerRunner.writeCredentials(ResourceLocalizationService.java:1314)\r\n\tat org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$LocalizerRunner.run(ResourceLocalizationService.java:1229)\r\n{noformat}\r\n\r\nNote the failure in the above stack trace is for the chmod that occurs immediately after creating a local file for an output stream, implying something asynchronously came along and removed the file.  When it fails it doesn't always fail with the exact same stacktrace, but the common theme is trying to access the container tokens file at some point when it's missing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2018-08-16T15:04:32.031+0000","updated":"2018-08-16T15:04:32.031+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-8672/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3x4bz:"}}