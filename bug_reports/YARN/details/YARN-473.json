{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12636835","self":"https://issues.apache.org/jira/rest/api/2/issue/12636835","key":"YARN-473","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-03-15T08:09:53.658+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 06 08:53:49 UTC 2015","customfield_12310420":"317327","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-473/watchers","watchCount":15,"isWatching":false},"created":"2013-03-13T18:47:01.860+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["usability"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323501","id":"12323501","description":"0.23.6 release","name":"0.23.6","archived":false,"released":true,"releaseDate":"2013-02-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-08-06T08:53:49.388+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319324","id":"12319324","name":"capacityscheduler"}],"timeoriginalestimate":null,"description":"The Capacity Scheduler REST API (http://hadoop.apache.org/docs/r0.23.6/hadoop-yarn/hadoop-yarn-site/ResourceManagerRest.html#Cluster_Scheduler_API) is not returning the correct number of pending applications.  numPendingApplications is almost always zero, even if there are dozens of pending apps.\n\nIn investigating this, I discovered that the Resource Manager's Scheduler webpage is also showing an incorrect but different number of pending applications.  For example, the cluster I'm looking at right now currently has 15 applications in the ACCEPTED state, but the Cluster Metrics table near the top of the page says there are only 2 pending apps.  The REST API says there are zero pending apps.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"317668","customfield_12312823":null,"summary":"Capacity Scheduler webpage and REST API not showing correct number of pending applications","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kthrapp","name":"kthrapp","key":"kthrapp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kendall Thrapp","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kthrapp","name":"kthrapp","key":"kthrapp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kendall Thrapp","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12636835/comment/13603225","id":"13603225","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tnachen","name":"tnachen","key":"tnachen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tnachen&avatarId=20385","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tnachen&avatarId=20385","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tnachen&avatarId=20385","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tnachen&avatarId=20385"},"displayName":"Timothy Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"I'd like to look into this, but I cannot assign this bug to myself. Can someone assign this to me or give me permissions? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tnachen","name":"tnachen","key":"tnachen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tnachen&avatarId=20385","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tnachen&avatarId=20385","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tnachen&avatarId=20385","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tnachen&avatarId=20385"},"displayName":"Timothy Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-15T08:09:53.658+0000","updated":"2013-03-15T08:09:53.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12636835/comment/13603369","id":"13603369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tgraves","name":"tgraves","key":"tgraves","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Graves","active":true,"timeZone":"America/Chicago"},"body":"I gave you contributor status so you can be assigned jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tgraves","name":"tgraves","key":"tgraves","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Graves","active":true,"timeZone":"America/Chicago"},"created":"2013-03-15T13:38:29.310+0000","updated":"2013-03-15T13:38:29.310+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12636835/comment/13803666","id":"13803666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"body":"I haven't seen any updates on this, so assigning this to another contributor. Feel free chime in if you're still wanting this. I'd like to get this committed in the next week or so.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"created":"2013-10-24T02:18:09.185+0000","updated":"2013-10-24T02:18:09.185+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12636835/comment/14659695","id":"14659695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raju.bairishetti","name":"raju.bairishetti","key":"raju.bairishetti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raju Bairishetti","active":true,"timeZone":"Etc/UTC"},"body":"REST API is showing wrong number of pending applications as it was populating the value from *pendingApplications set* (i.e. size of pendingApplications set). IMO, it should get the value from Queue metrics instead of getting from in-memory data structures.\n\nLeafQueue : \n{noformat}\n1) *pendingApplications* : all submitted applications will be added to this set first. \n\n2) *activeApplications* :  applications added to this set from pendingApplications set if the number of active applications are lesser than maximum number of active applications. \n{noformat}\n\nJmx metrics showing appsPending metric properly. AppsPending will be incremented when the application is submitted to Queue and decremented only when the application is actually launched(i.e. allocated some resources to it). \n\nIMO, Rest call for queue info should also use queue metrics instead of depending on other data structures. Applications from pendingApplications set will be removed before the launching of application.\n\npendingApplciations set contains the applications which are not ready for schedulable at this moment.\n\nOne more interesting fact, CapacitySchedulerPage(in UI) has \"Num Non-Schedulable Applications\" and  getting the value form pendingApplications set. Rest API call is correct in this case.\n\n I am thinking couple of approaches to fix this issue:\n{noformat}\n1) Rename the pendingApplications to nonSchedulableApplications in CapacitySchedulerLeafQueueInfo class and introduce new fields (pendingApplications) in the CapacitySchedulerLeafQueueInfo and get this value from QueueMetrics.\n  \n     refactor activeApplications to schedulableApplications and introducing a new field(activeApplications) for the same which tells exactly how many AMs are there.\n\n2. Refactor \"Num Non-Schedulable Applications:\" to \"Num of Pending Applications\"  and  refactor \"Num Schedulable Applications\" to activeApplications. Update properly through QueueMetrics instead of depending on in-memory data structures in the LeafQueue to get the values.\n{noformat}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raju.bairishetti","name":"raju.bairishetti","key":"raju.bairishetti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raju Bairishetti","active":true,"timeZone":"Etc/UTC"},"created":"2015-08-06T08:53:49.388+0000","updated":"2015-08-06T08:53:49.388+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-473/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ir7b:"}}