{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12988983","self":"https://issues.apache.org/jira/rest/api/2/issue/12988983","key":"YARN-5368","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334216","id":"12334216","description":"2.9.0 release","name":"2.9.0","archived":false,"released":true,"releaseDate":"2017-11-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339182","id":"12339182","name":"3.0.0-alpha4","archived":false,"released":true,"releaseDate":"2017-07-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12340356","id":"12340356","name":"2.8.2","archived":false,"released":true,"releaseDate":"2017-10-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-07-13T05:39:51.130+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jun 07 21:40:52 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_21727382617_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_619353161","customfield_12312321":null,"resolutiondate":"2017-03-28T20:34:16.737+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-5368/watchers","watchCount":16,"isWatching":false},"created":"2016-07-13T05:08:41.019+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331976","id":"12331976","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"issuelinks":[{"id":"12521403","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12521403","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13122491","key":"YARN-7603","self":"https://issues.apache.org/jira/rest/api/2/issue/13122491","fields":{"summary":"Memory leak in timeline server","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-12-04T05:31:29.864+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12322904","id":"12322904","name":"timelineserver","description":"YARN Timeline Server"}],"timeoriginalestimate":null,"description":"memory usage of timeline server machine increases gradually.\n\nhttps://gyazo.com/952dad96c77ae053bae2e4d8c8ab0572\n\nplease check since April.\n\nAccording to my investigation, timeline server used about 25GB.\n\ntop command result\n\n{code}\n90577 yarn      20   0 28.4g  25g  12m S  0.0 40.1   5162:53 /usr/java/jdk1.8.0_72/bin/java -Dproc_timelineserver -Xmx1024m -Dhdp.version=2.4.0.0-169 -Dhadoop.log.dir=/var/log/hadoop-yarn/yarn -Dyarn.log.dir=/var/log/hadoop-yarn/yarn ...\n{code}\n\nps command result\n{code}\n$ ps ww 90577\n 90577 ?        Sl   5162:53 /usr/java/jdk1.8.0_72/bin/java -Dproc_timelineserver -Xmx1024m -Dhdp.version=2.4.0.0-169 -Dhadoop.log.dir=/var/log/hadoop-yarn/yarn -Dyarn.log.dir=/var/log/hadoop-yarn/yarn -Dhadoop.log.file=yarn-yarn-timelineserver-myhost.log -Dyarn.log.file=yarn-yarn-timelineserver-myhost.log -Dyarn.home.dir= -Dyarn.id.str=yarn -Dhadoop.root.logger=INFO,EWMA,RFA -Dyarn.root.logger=INFO,EWMA,RFA -Djava.library.path=:/usr/hdp/2.4.0.0-169/hadoop/lib/native/Linux-amd64-64:/usr/hdp/2.4.0.0-169/hadoop/lib/native:/var/lib/ambari-agent/tmp/hadoop_java_io_tmpdir:/usr/hdp/2.4.0.0-169/hadoop/lib/native/Linux-amd64-64:/usr/hdp/2.4.0.0-169/hadoop/lib/native:/var/lib/ambari-agent/tmp/hadoop_java_io_tmpdir -Dyarn.policy.file=hadoop-policy.xml -Djava.io.tmpdir=/var/lib/ambari-agent/tmp/hadoop_java_io_tmpdir -Dhadoop.log.dir=/var/log/hadoop-yarn/yarn -Dyarn.log.dir=/var/log/hadoop-yarn/yarn -Dhadoop.log.file=yarn-yarn-timelineserver-myhost.log -Dyarn.log.file=yarn-yarn-timelineserver-myhost.log -Dyarn.home.dir=/usr/hdp/current/hadoop-yarn-timelineserver -Dhadoop.home.dir=/usr/hdp/2.4.0.0-169/hadoop -Dhadoop.root.logger=INFO,EWMA,RFA -Dyarn.root.logger=INFO,EWMA,RFA -Djava.library.path=:/usr/hdp/2.4.0.0-169/hadoop/lib/native/Linux-amd64-64:/usr/hdp/2.4.0.0-169/hadoop/lib/native:/var/lib/ambari-agent/tmp/hadoop_java_io_tmpdir:/usr/hdp/2.4.0.0-169/hadoop/lib/native/Linux-amd64-64:/usr/hdp/2.4.0.0-169/hadoop/lib/native:/var/lib/ambari-agent/tmp/hadoop_java_io_tmpdir -classpath /usr/hdp/2.4.0.0-169/hadoop/conf:/usr/hdp/2.4.0.0-169/hadoop/conf:/usr/hdp/2.4.0.0-169/hadoop/conf:/usr/hdp/2.4.0.0-169/hadoop/lib/*:/usr/hdp/2.4.0.0-169/hadoop/.//*:/usr/hdp/2.4.0.0-169/hadoop-hdfs/./:/usr/hdp/2.4.0.0-169/hadoop-hdfs/lib/*:/usr/hdp/2.4.0.0-169/hadoop-hdfs/.//*:/usr/hdp/2.4.0.0-169/hadoop-yarn/lib/*:/usr/hdp/2.4.0.0-169/hadoop-yarn/.//*:/usr/hdp/2.4.0.0-169/hadoop-mapreduce/lib/*:/usr/hdp/2.4.0.0-169/hadoop-mapreduce/.//*::/usr/hdp/2.4.0.0-169/tez/*:/usr/hdp/2.4.0.0-169/tez/lib/*:/usr/hdp/2.4.0.0-169/tez/conf:/usr/hdp/2.4.0.0-169/tez/*:/usr/hdp/2.4.0.0-169/tez/lib/*:/usr/hdp/2.4.0.0-169/tez/conf:/usr/hdp/current/hadoop-yarn-timelineserver/.//*:/usr/hdp/current/hadoop-yarn-timelineserver/lib/*:/usr/hdp/2.4.0.0-169/hadoop/conf/timelineserver-config/log4j.properties org.apache.hadoop.yarn.server.applicationhistoryservice.ApplicationHistoryServer\n{code}\n \nAlghough I set -Xmx1024m, actual memory usage is 25GB.\n\nAfter I restart timeline server, memory usage of timeline server machine decreases.\n\nhttps://gyazo.com/130600c17a7d41df8606727a859ae7e3\n\nNow timelineserver uses less than 1GB memory.\n\ntop command result\n{code}\n 6163 yarn      20   0 3959m 783m  46m S  0.3  1.2   3:37.60 /usr/java/jdk1.8.0_72/bin/java -Dproc_timelineserver -Xmx1024m -Dhdp.version=2.4.0.0-169 ...\n{code}\n\nI suspect memory leak at timeline server.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334216","id":"12334216","description":"2.9.0 release","name":"2.9.0","archived":false,"released":true,"releaseDate":"2017-11-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335742","id":"12335742","description":"2.8.1 release","name":"2.8.1","archived":false,"released":true,"releaseDate":"2017-06-08"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339182","id":"12339182","name":"3.0.0-alpha4","archived":false,"released":true,"releaseDate":"2017-07-07"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12859755","id":"12859755","filename":"YARN-5368.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"created":"2017-03-21T16:30:39.705+0000","size":11464,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12859755/YARN-5368.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12860727","id":"12860727","filename":"YARN-5368.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"created":"2017-03-27T21:01:32.359+0000","size":16716,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12860727/YARN-5368.2.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Memory leak in timeline server","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wyukawa","name":"wyukawa","key":"wyukawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=wyukawa&avatarId=13133","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wyukawa&avatarId=13133","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wyukawa&avatarId=13133","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wyukawa&avatarId=13133"},"displayName":"Wataru Yukawa","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wyukawa","name":"wyukawa","key":"wyukawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=wyukawa&avatarId=13133","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wyukawa&avatarId=13133","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wyukawa&avatarId=13133","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wyukawa&avatarId=13133"},"displayName":"Wataru Yukawa","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"HDP2.4\nCentOS 6.7\njdk1.8.0_72","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15374383","id":"15374383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"body":"hi [~wyukawa], \n5th column of the top output which you are pointing to refers to the {{Virtual Memory Size}} which includes all code, data and shared libraries plus pages that have been swapped out and pages that have been mapped but not used. So its not precisely using 25GB of ram.\nAre you facing any particular impact from this and also it would be helpful if you shares how many Open files are present for the timeline service process.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-13T05:39:51.130+0000","updated":"2016-07-13T05:39:51.130+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15374413","id":"15374413","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wyukawa","name":"wyukawa","key":"wyukawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=wyukawa&avatarId=13133","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wyukawa&avatarId=13133","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wyukawa&avatarId=13133","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wyukawa&avatarId=13133"},"displayName":"Wataru Yukawa","active":true,"timeZone":"Etc/UTC"},"body":"Thank you for comment.\n\nI point out 6th column(RSS), not 5th column VSZ(28.4g) .\n\nRSS is 25GB.\n\n>Are you facing any particular impact from this\nnow, nothing.\nbut I'm afraid memory shortage.\n\nlsof -p `pgrep -f timeline` is the following.\n\nhttps://gist.github.com/wyukawa/36ccfde48f118bb1e8e4f2564d4ecc2a\n\nthanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wyukawa","name":"wyukawa","key":"wyukawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=wyukawa&avatarId=13133","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wyukawa&avatarId=13133","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wyukawa&avatarId=13133","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wyukawa&avatarId=13133"},"displayName":"Wataru Yukawa","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-13T06:04:17.608+0000","updated":"2016-07-13T06:04:17.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15625562","id":"15625562","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"[~wyukawa] I believe, this issue with level-db with {{cent-OS 6.7}} only.. Did you get any workaround for this..?\n\nRecently I noticed same issue with {{NodeManger}} when recovery is enabled.NM RES is keep on growing which leads {{ResourceLocalization}} slow.\n\n*When NM RES Memory  more ResourceLocalization took ~3 mins* \n{noformat}\n2016-10-21 13:48:14,481 | INFO  | LocalizerRunner for container_e08_1476679121221_34954_01_000005 | Writing credentials to the nmPrivate file /srv/BigData/data12/yarn/localdir/nmPrivate/container_e08_1476679121221_34954_01_000005.tokens. Credentials list:  | ResourceLocalizationService.java:1238\n 2016-10-21 13:48:14,487  | INFO  | LocalizerRunner for container_e08_1476679121221_34954_01_000006 | Writing credentials to the nmPrivate file /srv/BigData/data5/yarn/localdir/nmPrivate/container_e08_1476679121221_34954_01_000006.tokens. Credentials list:  | ResourceLocalizationService.java:1238\n 2016-10-21 13:51:40,382  | INFO  | IPC Server handler 3 on 26007 | Resource hdfs://hacluster/tmp/hadoop-yarn/staging/IOCLG/.staging/job_1476679121221_34954/libjars/hbase-server-1.0.2.jar(->/srv/BigData/data22/yarn/localdir/usercache/IOCLG/filecache/557841/hbase-server-1.0.2.jar) transitioned from DOWNLOADING to LOCALIZED | LocalizedResource.java:203\n{noformat}\n\n*When normal ResourceLocalization time* \n{noformat}\n2016-10-21 14:19:05,600 | INFO  | LocalizerRunner for container_e10_1477030404479_0013_01_000006 | Writing credentials to the nmPrivate file /srv/BigData/data6/yarn/localdir/nmPrivate/container_e10_1477030404479_0013_01_000006.tokens. Credentials list:  | ResourceLocalizationService.java:1238\n 2016-10-21 14:19:05,600  | INFO  | LocalizerRunner for container_e10_1477030404479_0013_01_000005 | Writing credentials to the nmPrivate file /srv/BigData/data15/yarn/localdir/nmPrivate/container_e10_1477030404479_0013_01_000005.tokens. Credentials list:  | ResourceLocalizationService.java:1238\n 2016-10-21 14:19:07,860  | INFO  | IPC Server handler 2 on 26007 | Resource hdfs://hacluster/tmp/hadoop-yarn/staging/IOCLG/.staging/job_1477030404479_0013/libjars/hbase-server-1.0.2.jar(->/srv/BigData/data15/yarn/localdir/usercache/IOCLG/filecache/558308/hbase-server-1.0.2.jar) transitioned from DOWNLOADING to LOCALIZED | LocalizedResource.java:203\n2016-10-21 14:19:07,898 | INFO  | IPC Server handler 3 on 26007 | Resource hdfs://hacluster/tmp/hadoop-yarn/staging/IOCLG/.staging/job_1477030404479_0013/libjars/hbase-client-1.0.2.jar(->/srv/BigData/data19/yarn/localdir/usercache/IOCLG/filecache/558312/hbase-client-1.0.2.jar) transitioned from DOWNLOADING to LOCALIZED | LocalizedResource.java:203\n{noformat}\n\nI looked at level-db community and did not find any memory leak issue handled after {{1.8}} release. \n\n[~jlowe] any thoughts on this..? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-11-01T14:28:24.255+0000","updated":"2016-11-01T14:28:24.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15626529","id":"15626529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"bq. Recently I noticed same issue with NodeManger when recovery is enabled.NM RES is keep on growing which leads ResourceLocalization slow.\n\nWe have not seen that on our clusters.  Three minutes is a _really_ long time.  Do you have gc logging enabled for the nodemanager JVM?  It would be interesting to know if it was trying to run one or more GC cycles during that time.  If it wasn't GC cycles then I'm not sure how increased off-heap memory would directly contribute to slower resource localization unless the machine was near or at the point where it started swapping.\n\nAs for the timeline server memory usage, it looks like the rolling level db instances are starting to pile up, accumulating a lot of off-heap memory.  Pinging [~jeagles] since I vaguely remember something like this occurring in the past, and there may be a known fix for that issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2016-11-01T20:09:52.469+0000","updated":"2016-11-01T20:09:52.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15626696","id":"15626696","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"body":"The Rolling Level DB does roll by default every hour (configurable). Memory in leveldb is retained until the file is closed and the amount of memory retained by default is a max (read-buffer-size + write-buffer-size) * 2 per hour. Upon startup, historical leveldb are lazily loaded so they don't incur the memory hit until the data in the hour is referenced. What I am wondering is how long the retention period is set for the data. The default time to live (_yarn.timeline-service.ttl-ms_) is 7 days. If you want to reduce memory usage drastically\n\n - reduce the number of leveldb file retained in memory per day:  perhaps set _yarn.timeline-service.rolling-period_ to daily (there is only limited support for changing periods) \n - reduce retention time to meet requirements perhaps set _yarn.timeline-service.ttl-ms_ to a lower number\n - reduce the read cache size: _yarn.timeline-service.leveldb-timeline-store.read-cache-size_ perhaps to 4MB (4194304)\n - reduce the write cache size: _yarn.timeline-service.leveldb-timeline-store.write-buffer-size_ perhaps to 4MB (4194304)\n - implement a yarn patch for rolling leveldb LRU cache so that only a fixed number are in memory at a time and the others are purged until needed \n\nThere is also a _yarn.timeline-service.leveldb-timeline-store.max-open-files_ configuration, but I have limited understanding if that is a global setting or a per rolling instance setting.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"created":"2016-11-01T21:15:35.131+0000","updated":"2016-11-01T21:15:35.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15629088","id":"15629088","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"[~jlowe]  and [~jeagles] thanks for your inputs.\n\nbq. Do you have gc logging enabled for the nodemanager JVM? It would be interesting to know if it was trying to run one or more GC cycles during that time. If it wasn't GC cycles then I'm not sure how increased off-heap memory would directly contribute to slower resource localization unless the machine was near or at the point where it started swapping.\n\nGC looks normal,and after applying the YARN-3491,ResourceLocalization is also normal. But for RES memory increase , need to try with [~jeagles] options. \n\nBut I doubt {{db.compactRange(null, null);}}, file number is not decreasing after this. if we close and open the db then files are got deleted( not from the memory).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-11-02T14:11:02.759+0000","updated":"2016-11-02T14:11:02.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15642909","id":"15642909","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Forgot to update here.. Upon investigation, there was internal change which caused the leveldb leak..:(.. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-11-07T02:50:35.452+0000","updated":"2016-11-07T02:50:35.452+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15643017","id":"15643017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wyukawa","name":"wyukawa","key":"wyukawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=wyukawa&avatarId=13133","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wyukawa&avatarId=13133","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wyukawa&avatarId=13133","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wyukawa&avatarId=13133"},"displayName":"Wataru Yukawa","active":true,"timeZone":"Etc/UTC"},"body":">Did you get any workaround for this..?\nI restart timeline server.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wyukawa","name":"wyukawa","key":"wyukawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=wyukawa&avatarId=13133","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wyukawa&avatarId=13133","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wyukawa&avatarId=13133","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wyukawa&avatarId=13133"},"displayName":"Wataru Yukawa","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-07T03:51:31.847+0000","updated":"2016-11-07T03:51:31.847+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15644781","id":"15644781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"body":"We cross verified whether similar leak existed in the existing ATS code (level DB iterator was not being closed after usage) but was not able to find anywhere else so hope issue did not reoccur to you !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-11-07T17:24:06.969+0000","updated":"2016-11-07T17:24:32.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15934888","id":"15934888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 18s{color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 12m 50s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 19s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 14s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 21s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 13s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 31s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 15s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 17s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 17s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m 17s{color} | {color:green} the patch passed {color} |\n| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 11s{color} | {color:orange} hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice: The patch generated 1 new + 5 unchanged - 1 fixed = 6 total (was 6) {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 18s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 11s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 36s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 12s{color} | {color:green} the patch passed {color} |\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  2m 46s{color} | {color:red} hadoop-yarn-server-applicationhistoryservice in the patch failed. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 16s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 21m 28s{color} | {color:black} {color} |\n\\\\\n\\\\\n|| Reason || Tests ||\n| Failed junit tests | hadoop.yarn.server.timeline.webapp.TestTimelineWebServices |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:a9ad5d6 |\n| JIRA Issue | YARN-5368 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12859755/YARN-5368.1.patch |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux e0e79f287c6a 3.13.0-106-generic #153-Ubuntu SMP Tue Dec 6 15:44:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / 2841666 |\n| Default Java | 1.8.0_121 |\n| findbugs | v3.0.0 |\n| checkstyle | https://builds.apache.org/job/PreCommit-YARN-Build/15343/artifact/patchprocess/diff-checkstyle-hadoop-yarn-project_hadoop-yarn_hadoop-yarn-server_hadoop-yarn-server-applicationhistoryservice.txt |\n| unit | https://builds.apache.org/job/PreCommit-YARN-Build/15343/artifact/patchprocess/patch-unit-hadoop-yarn-project_hadoop-yarn_hadoop-yarn-server_hadoop-yarn-server-applicationhistoryservice.txt |\n|  Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/15343/testReport/ |\n| modules | C: hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice U: hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice |\n| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/15343/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-21T17:00:25.000+0000","updated":"2017-03-21T17:00:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15935019","id":"15935019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"body":"Unit test failure in TestTimelineWebServices is covered by YARN-5934. Checkstyle method length was pre-existing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"created":"2017-03-21T18:22:16.652+0000","updated":"2017-03-21T18:22:16.652+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15935074","id":"15935074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"body":"[~Naganarasimha], I have posted a patch that addresses the missing iterator.close() leak. Let me know if you are ok with the try-with-resources approach to take care of this case","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"created":"2017-03-21T18:30:41.959+0000","updated":"2017-03-21T18:30:41.959+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15935302","id":"15935302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"[~jeagles], nice catch.\nClosing of only the last iterator in the loop must be the reason for leak. \nThe leak we got in NM, albeit due to our private code, was also due to DBIterator not being closed.\n\nUsing try-with-resources approach for DBIterator should be fine. \nHow about using try-with-resources for DBIterator elsewhere in the RollingLevelDBTimelineStore class i.e. where it's not used in the loop, just to make the code consistent.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-03-21T20:41:12.978+0000","updated":"2017-03-21T20:41:12.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15936930","id":"15936930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~jeagles], Sorry missed your comment earlier. Thanks for identifying the cause.\nSimilar to it i was able to find Db Iterator initialized within the loop @ {{RollingLevelDBTimelineStore.getEntityByTime, ln no: 718 - 819}} and closing the last one of the loop only.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-03-22T19:02:39.710+0000","updated":"2017-03-22T19:02:39.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15944081","id":"15944081","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 18s{color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 15m 27s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 21s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 17s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 23s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 15s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 37s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 19s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 23s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 22s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m 22s{color} | {color:green} the patch passed {color} |\n| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 13s{color} | {color:orange} hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice: The patch generated 1 new + 5 unchanged - 1 fixed = 6 total (was 6) {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 22s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 12s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 43s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 14s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green}  3m  8s{color} | {color:green} hadoop-yarn-server-applicationhistoryservice in the patch passed. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 19s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 25m 21s{color} | {color:black} {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:a9ad5d6 |\n| JIRA Issue | YARN-5368 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12860727/YARN-5368.2.patch |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux 3d33552d8645 3.13.0-105-generic #152-Ubuntu SMP Fri Dec 2 15:37:11 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / cd014d5 |\n| Default Java | 1.8.0_121 |\n| findbugs | v3.0.0 |\n| checkstyle | https://builds.apache.org/job/PreCommit-YARN-Build/15399/artifact/patchprocess/diff-checkstyle-hadoop-yarn-project_hadoop-yarn_hadoop-yarn-server_hadoop-yarn-server-applicationhistoryservice.txt |\n|  Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/15399/testReport/ |\n| modules | C: hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice U: hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice |\n| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/15399/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-27T21:33:51.188+0000","updated":"2017-03-27T21:33:51.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15944092","id":"15944092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"body":"Checkstyle warning is pre-existing. [~varun_saxena], tried to make the entire file consistent. There is one case left over that I was not able to find a way to convert easily without method redesign. Let me know what is left for this patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"created":"2017-03-27T21:45:24.863+0000","updated":"2017-03-27T21:45:24.863+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15944202","id":"15944202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~jeagles] for the updated patch fixing the comments.\n\nbq. There is one case left over that I was not able to find a way to convert easily without method redesign. \nThat should be fine.\n\n+1. The changes LGTM.\nI will wait for a day and then commit unless there are opposite opinions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-03-27T23:05:53.891+0000","updated":"2017-03-27T23:13:40.775+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15944647","id":"15944647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"body":"+1. The changes LGTM.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-03-28T06:50:47.940+0000","updated":"2017-03-28T06:50:47.940+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15945589","id":"15945589","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"body":"This patch should apply cleanly to branch-2 and branch-2.8. Let me know if there are difficulties. Since this is an important bug fix, I think it is work going into 2.8 so it can reach 2.8.1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeagles","name":"jeagles","key":"jeagles","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jonathan Eagles","active":true,"timeZone":"America/Chicago"},"created":"2017-03-28T17:27:44.009+0000","updated":"2017-03-28T17:27:44.009+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15945899","id":"15945899","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"Yeah will get this in branch-2.8 too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-03-28T20:32:25.300+0000","updated":"2017-03-28T20:32:25.300+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15945906","id":"15945906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"Committed to trunk, branch-2 and branch-2.8\nThanks [~jeagles] for finding the root cause and fixing it.\nThanks [~wyukawa] for reporting the issue and Naga for additional review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-03-28T20:35:45.695+0000","updated":"2017-03-28T20:35:45.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/15945934","id":"15945934","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #11483 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/11483/])\nYARN-5368. Memory leak in timeline server (Jonathan Eagles via Varun (varunsaxena: rev 01aca54a22c8586d232a8f79fe9977aeb8d09b83)\n* (edit) hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice/src/main/java/org/apache/hadoop/yarn/server/timeline/RollingLevelDBTimelineStore.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-28T20:48:16.564+0000","updated":"2017-03-28T20:48:16.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12988983/comment/16041691","id":"16041691","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"2.8.1 became a security release. Moving fix-version to 2.8.2 after the fact.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-07T21:40:52.989+0000","updated":"2017-06-07T21:40:52.989+0000"}],"maxResults":23,"total":23,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-5368/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i30w87:"}}