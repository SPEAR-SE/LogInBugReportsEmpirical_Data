{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12656070","self":"https://issues.apache.org/jira/rest/api/2/issue/12656070","key":"YARN-897","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324029","id":"12324029","description":"2.1.0-beta release","name":"2.1.0-beta","archived":false,"released":true,"releaseDate":"2013-08-22"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-07-03T17:23:07.571+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 15 21:16:17 UTC 2013","customfield_12310420":"336345","customfield_12312320":null,"customfield_12310222":"10002_*:*_2_*:*_54183817_*|*_1_*:*_2_*:*_1407214115_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-07-20T15:02:09.510+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-897/watchers","watchCount":9,"isWatching":false},"created":"2013-07-03T17:05:31.606+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324137","id":"12324137","description":"2.0.4-alpha bug-fix release","name":"2.0.4-alpha","archived":false,"released":true,"releaseDate":"2013-04-25"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-08-27T22:15:45.403+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319324","id":"12319324","name":"capacityscheduler"}],"timeoriginalestimate":null,"description":"The childQueues of a ParentQueue are stored in a TreeSet where UsedCapacity defines the sort order. This ensures the queue with least UsedCapacity to receive resources next. On containerAssignment we correctly update the order, but we miss to do so on container completions. This corrupts the TreeSet structure, and under-capacity queues might starve for resources.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324029","id":"12324029","description":"2.1.0-beta release","name":"2.1.0-beta","archived":false,"released":true,"releaseDate":"2013-08-22"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12590676","id":"12590676","filename":"TestBugParentQueue.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-03T17:29:05.972+0000","size":16862,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12590676/TestBugParentQueue.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12598296","id":"12598296","filename":"YARN-897-08152013-br-0.23.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-15T21:16:17.323+0000","size":13574,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12598296/YARN-897-08152013-br-0.23.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12591937","id":"12591937","filename":"YARN-897-1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-12T00:01:48.090+0000","size":3625,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12591937/YARN-897-1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12591926","id":"12591926","filename":"YARN-897-2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-11T22:50:07.579+0000","size":3604,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12591926/YARN-897-2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12593228","id":"12593228","filename":"YARN-897-3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-19T18:53:03.236+0000","size":32052,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12593228/YARN-897-3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12593319","id":"12593319","filename":"YARN-897-4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-20T04:52:18.561+0000","size":31728,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12593319/YARN-897-4.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"336669","customfield_12312823":null,"summary":"CapacityScheduler wrongly sorted queues","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13699204","id":"13699204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"body":"The childQueues of a ParentQueue are stored in a TreeSet where UsedCapacity defines the sort order. I believe for the scheduler to work correctly, we must maintain this order explicitly. \nWhen a new container is assigned to an application, the correposnding queue is removed and readded, maintain the order. When a container completes however the UsedCapacity of the queue is\nchanged, but we don't resort the childQueues. This means the TreeSet assumptions are not maintained, and we might miss to assign containers to this queue. \n\nExample:\nParent queue (root) has four child queues with capacities (A:25%, B:25%, C:25%, D:25%). The cluster has 10GB of resources with a minimum allocation of 1GB.\n1-      Through some history we got to assign 1,2,3,4 containers respectively to the queues (note: container = 1GB): status child-queues: root.a(0.4), root.b(0.8), root.c(1.2), root.d(1.6)\n2-      3 containers from D complete, status child-queues: root.a(0.4), root.b(0.8), root.c(1.2), root.d(0.4)\n3-      Now if A and B keep receiving and releasing containers without ever passing the 1.2 mark of C we might have D being stuck behind C and never receive containers. \n\nIn practice this might not show up often because of reservations (that bypass this ordering). If D has reservations pending it might get at least one container, and this will trigger the resorting, thus un-stucking it. \nNonetheless this should be addressed. I discussed this briefly with few folks at Hadoop Summit and we seemed to confirm the problem, but we should double check further. \n\n[~dedcode] will post a small test that triggers the issue, and an idea of patch soon... comments welcome.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-03T17:23:07.571+0000","updated":"2013-07-03T17:23:07.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13699218","id":"13699218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"body":"Simple JUnit Test that triggers the bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-03T17:29:05.975+0000","updated":"2013-07-03T17:29:05.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13699373","id":"13699373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"body":"We spotted this bug while experimenting on dynamic queues updates. The TreeSet methods .contains() and .remove() failed on retrieving a queue that we knew was there, and that gave us a hint that the tree was unsorted properly.\nThe attached test is a [simple junit test | https://issues.apache.org/jira/secure/attachment/12590676/TestBugParentQueue.java] inspired by the already available capacity scheduler tests. It does simulate the scenario that [~curino] describes above and displays the order in which the childQueues is left after a couple of container assignments and completions.\nI will post a first version of a patch that re-inserts the recently completed container's queue (and all its parents) into their respective parents' childQueues. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-03T19:56:54.894+0000","updated":"2013-07-03T19:56:54.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13706109","id":"13706109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ojoshi","name":"ojoshi","key":"ojoshi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ojoshi&avatarId=16634","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ojoshi&avatarId=16634","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ojoshi&avatarId=16634","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ojoshi&avatarId=16634"},"displayName":"Omkar Vinit Joshi","active":true,"timeZone":"America/Los_Angeles"},"body":"[~dedcode] / [~curino] you want to work on the patch or can I take over? seems like an important bug which needs to be fixed. I looked at the code and on container completion it is not resorting the TreeSet which will result into unfairness..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ojoshi","name":"ojoshi","key":"ojoshi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ojoshi&avatarId=16634","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ojoshi&avatarId=16634","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ojoshi&avatarId=16634","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ojoshi&avatarId=16634"},"displayName":"Omkar Vinit Joshi","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-11T18:56:50.471+0000","updated":"2013-07-11T18:56:50.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13706152","id":"13706152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"body":"I agree this need fixing soon. We have a first draft of the patch, we were planning to test it out carefully before posting it, but if you have cycles we can socialize it right-away and we can work on it together.  \n[~dedcode] please post the patch in its current state. [~ojoshi] you can check it out and we can test/verify in the meantime. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-11T19:47:19.815+0000","updated":"2013-07-11T19:47:19.815+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13706181","id":"13706181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"body":"Attached is a first patch attempt to address the bug:\nUpon container completion, which triggers completedContainer(), remove and reinsert the queue into its parent's childQueues. This operation is done recursively starting from the leafQueue where the container got released. \nThus, by handling both cases where usedCapacity is ever changed (assignement and completion) the TreeSet remains properly sorted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-11T20:22:44.593+0000","updated":"2013-07-11T20:22:44.593+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13706284","id":"13706284","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ojoshi","name":"ojoshi","key":"ojoshi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ojoshi&avatarId=16634","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ojoshi&avatarId=16634","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ojoshi&avatarId=16634","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ojoshi&avatarId=16634"},"displayName":"Omkar Vinit Joshi","active":true,"timeZone":"America/Los_Angeles"},"body":"[~dedcode] Thanks for posting the patch... looked at the code.. \n\nbq.     // Can't use childQueues.remove() since the TreeSet might be out of order.\nany reason for this even after this patch? if we don't see any other issues then why not just use childQueues.remove instead of iterating?\n\n* reinsertQueue could be marked synchronized? thoughts? But yeah.. without that too it is thread safe as we are locking it at CapacitySchedulder.nodeUpdate(). but still it is better to mark it.\n\n*         LOG.info(\"Re-sorting queues since queue got completed: \" + childQueue.getQueuePath() + \nnit. line > 80\n\n* at present we send the container completed event to leaf queue and then keep propagating it till root. why not sent the event to root grab the locks from root->leaf and update it? any thoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ojoshi","name":"ojoshi","key":"ojoshi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ojoshi&avatarId=16634","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ojoshi&avatarId=16634","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ojoshi&avatarId=16634","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ojoshi&avatarId=16634"},"displayName":"Omkar Vinit Joshi","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-11T21:47:01.809+0000","updated":"2013-07-11T21:47:01.809+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13706327","id":"13706327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"body":"Omkar, thanks for the quick feedback... \n\nbq. any reason for this even after this patch? if we don't see any other issues then why not just use childQueues.remove instead of iterating?\nI initially thought the same, but I worried that since the underlying capacity attribute has been changed, the TreeSet is already non-consistent? [~dedcode] can you check whether this is true or not? Also can we use some careful operation ordering, and get away with Omkar suggestion?\n\nbq. reinsertQueue could be marked synchronized? thoughts? But yeah.. without that too it is thread safe as we are locking it at CapacitySchedulder.nodeUpdate(). but still it is better to mark it.\n\nWe should probably follow your suggestion (especially if this method will be reused elsewhere), or at least use the lock annotations properly. (again this patch wasn't quite ready)\n\nbq. nit. line > 80\n\nwill do\n\nbq. at present we send the container completed event to leaf queue and then keep propagating it till root. why not sent the event to root grab the locks from root->leaf and update it? any thoughts?\nLock ordering is somewhat delicate (and I worry not very consistent). In general, the idea to lock bottom up should allow for part of the operations (updating of two leaf queues) to be concurrent until the recursion meet at some common ancestor, at which point we serialize. However, at least for some of the operations this is inside a global scheduler lock, so we loose that benefit in the first-place. It might be interesting to review the locks carefully and see whether we can rationalize them further. Although this is delicate, and unless we are lock-bound on the scheduler in practice would not buy us much.  \n\nWe didn't have time to test this through to a level I would be confident PAing this. Omkar do you have any cycle to test this? [~acmurthy],[~tgraves] do you guys have a moment to review this? \n\nBTW we are working on a discrete event simulator, which should allow us to lock-step/debug the entire RM codebase... that would make for easy testing of some of this stuff (more as soon as we get it ready to show it around).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-11T22:13:18.143+0000","updated":"2013-07-11T22:13:18.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13706348","id":"13706348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"body":"Omkar, thanks for the feedback\n{quote}any reason for this even after this patch? if we don't see any other issues then why not just use childQueues.remove instead of iterating?{quote}\nThe tree is already out of order because of the new usedCapacity, the remove() won't work. We have to iterate and add() to fix the order.\n{quote}reinsertQueue could be marked synchronized? thoughts? But yeah.. without that too it is thread safe as we are locking it at CapacitySchedulder.nodeUpdate(). but still it is better to mark it.{quote}\nok, sounds reasonable to put a synchronize there.\n{quote}LOG.info(\"Re-sorting queues since queue got completed: \" + childQueue.getQueuePath() +\nnit. line > 80{quote}\nsure\n{quote}at present we send the container completed event to leaf queue and then keep propagating it till root. why not sent the event to root grab the locks from root->leaf and update it? any thoughts?{quote}\nBecause the released container is linked to a leaf queue and we have to walk bottom up to figure out to which parent propagate. The assignment phase, however, works the way you described.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-11T22:24:38.197+0000","updated":"2013-07-11T22:24:38.197+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13706380","id":"13706380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ojoshi","name":"ojoshi","key":"ojoshi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ojoshi&avatarId=16634","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ojoshi&avatarId=16634","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ojoshi&avatarId=16634","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ojoshi&avatarId=16634"},"displayName":"Omkar Vinit Joshi","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. BTW we are working on a discrete event simulator, which should allow us to lock-step/debug the entire RM codebase... that would make for easy testing of some of this stuff (more as soon as we get it ready to show it around).\ninteresting... \n\nYes I am checking it but it seems to have solved the original problem....checked the test code too seems ok.\n\nbq. The tree is already out of order because of the new usedCapacity, the remove() won't work. We have to iterate and add() to fix the order.\nYeah you are right... releaseResource has already updated it.\nprobably the sequence could have been removeFromParentIfPresent, releaseResource , addToParentIfPresent....however let other folks reply \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ojoshi","name":"ojoshi","key":"ojoshi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ojoshi&avatarId=16634","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ojoshi&avatarId=16634","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ojoshi&avatarId=16634","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ojoshi&avatarId=16634"},"displayName":"Omkar Vinit Joshi","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-11T22:44:47.732+0000","updated":"2013-07-11T22:44:47.732+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13706388","id":"13706388","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"body":"Patch reflecting Omkar's comments. 1) add synchronized to reinsertQueue 2) reduce line length","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-11T22:50:07.582+0000","updated":"2013-07-11T22:50:07.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13706488","id":"13706488","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ojoshi","name":"ojoshi","key":"ojoshi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ojoshi&avatarId=16634","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ojoshi&avatarId=16634","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ojoshi&avatarId=16634","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ojoshi&avatarId=16634"},"displayName":"Omkar Vinit Joshi","active":true,"timeZone":"America/Los_Angeles"},"body":"[~dedcode] please do keep older patches... it helps reviewing by sometimes diffing against older patches and verifying older comments... Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ojoshi","name":"ojoshi","key":"ojoshi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ojoshi&avatarId=16634","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ojoshi&avatarId=16634","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ojoshi&avatarId=16634","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ojoshi&avatarId=16634"},"displayName":"Omkar Vinit Joshi","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-11T23:57:51.404+0000","updated":"2013-07-11T23:57:51.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13713231","id":"13713231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch looks good. Can you please provide a patch which includes the test as well (rather than 2 files). Tx!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T01:22:40.609+0000","updated":"2013-07-19T01:22:40.609+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13713233","id":"13713233","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"On second thoughts - we should get ParentQueue.completedContainer to resort, rather than relying on LeafQueue to make an explicit 'resort' call... ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T01:24:10.982+0000","updated":"2013-07-19T01:24:10.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13713241","id":"13713241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"body":"That is what I tried before, but because the parentQueue doesn't know which queue made the call, we don't know what to reinsert. Basically all we can do is to go down to tree to figure this out. Alternatively, we can modify the signature of completedContainer to include the Queue...\nThat's why we figured that it's more efficient to have the leaf queue explicitly trigger the call.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-19T01:41:32.896+0000","updated":"2013-07-19T01:41:32.896+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13713417","id":"13713417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"body":"[~acmurthy] what's your preference? Keep what we proposed or modify the completedContainer signature?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-19T07:38:57.237+0000","updated":"2013-07-19T07:38:57.237+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13713605","id":"13713605","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"Good point, I think it's appropriate to modify completedContainer to include the queue name. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-19T12:33:18.413+0000","updated":"2013-07-19T12:33:18.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13713943","id":"13713943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"body":"A new version of the patch with completedContainer taking the CSQueue to reinsert as suggested by [~acmurthy].\nAlso the patch now contains the unit test for testing proper childQueues sort order.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-19T18:53:03.239+0000","updated":"2013-07-19T18:53:03.239+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13713971","id":"13713971","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"body":"[YARN-897-3.patch|https://issues.apache.org/jira/secure/attachment/12591926/YARN-897-3.patch]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-19T19:10:23.476+0000","updated":"2013-07-19T19:10:23.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13713991","id":"13713991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:green}+1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12593228/YARN-897-3.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-YARN-Build/1534//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-YARN-Build/1534//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-19T19:33:00.544+0000","updated":"2013-07-19T19:33:00.544+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13714244","id":"13714244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"[~dedcode] One nit - the call to ParentQueue.reinsertQueue should be within the sync block in ParentQueue.completeContainer. There-by, in ParentQueue.reinsertQueue, a simple childQueues.remove(completedChildQueue) followed by childQueues.add(completedChildQueue) should suffice (rather than the iteration) ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-20T00:04:47.727+0000","updated":"2013-07-20T00:04:47.727+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13714328","id":"13714328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"body":"[~acmurthy] Unfortunately, as I pointed above with Omkar, we have to iterate because at that point in time the chilQueues are already out of order and we can't use TreeSet methods. For the same reason assignContainersToChildQueues iterate then add/remove too.\nThis patch moves the code of reinsertQueue inline with completedContainer. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dedcode","name":"dedcode","key":"dedcode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Djellel Eddine Difallah","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-20T04:52:18.564+0000","updated":"2013-07-20T04:52:18.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13714339","id":"13714339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:green}+1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12593319/YARN-897-4.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-YARN-Build/1541//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-YARN-Build/1541//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-20T05:23:11.670+0000","updated":"2013-07-20T05:23:11.670+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13714449","id":"13714449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"I just committed this. Thanks [~dedcode] and [~curino]!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-20T15:02:09.531+0000","updated":"2013-07-20T15:02:09.531+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13714559","id":"13714559","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~acmurthy] for the prompt review!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curino","name":"curino","key":"curino","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=curino&avatarId=21704","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=curino&avatarId=21704","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=curino&avatarId=21704","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=curino&avatarId=21704"},"displayName":"Carlo Curino","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-20T22:52:38.840+0000","updated":"2013-07-20T22:52:38.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656070/comment/13741489","id":"13741489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"body":"Posted patch for branch-0.23","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-15T21:16:17.326+0000","updated":"2013-08-15T21:16:17.326+0000"}],"maxResults":26,"total":26,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-897/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1m0lr:"}}