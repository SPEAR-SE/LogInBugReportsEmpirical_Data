{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12721779","self":"https://issues.apache.org/jira/rest/api/2/issue/12721779","key":"YARN-2175","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-06-19T07:05:25.594+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jan 29 20:48:45 UTC 2018","customfield_12310420":"399975","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2175/watchers","watchCount":15,"isWatching":false},"created":"2014-06-17T21:07:42.933+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326142","id":"12326142","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-01-29T20:48:45.077+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319323","id":"12319323","name":"nodemanager"}],"timeoriginalestimate":null,"description":"There are no timeouts that can be used to limit the time taken by various container startup operations. Localization for example could take a long time and there is no automated way to kill an task if its stuck in these states. These may have nothing to do with the task itself and could be an issue within the platform.\n\nIdeally there should be configurable limits for various states within the NodeManager to limit various states. The RM does not care about most of these and its only between AM and the NM. We can start by making these global configurable defaults and in future we can make it fancier by letting AM override them in the start container request. \n\nThis jira will be used to limit localization time and we can open others if we feel we need to limit other operations.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"400082","customfield_12312823":null,"summary":"Container localization has no timeouts and tasks can be stuck there for a long time","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721779/comment/14037055","id":"14037055","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. there is no way to kill an task if its stuck in these states.\nYARN-1619/YARN-445 should let you do this manually if not automatically.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-19T07:05:25.594+0000","updated":"2014-06-19T07:05:25.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721779/comment/14037337","id":"14037337","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"I also wonder if there's been a regression, since at least in 0.23 containers that are localizing can be killed by the ApplicationMaster.  The MR AM does this when mapreduce.task.timeout triggers a kill of a task due to lack of progress.  The MR AM kills the container and that, in turn, causes the localizer to die because the NM tells the localizer to DIE during its next heartbeat.\n\nAlthough if the localizer gets stuck and stops heartbeating and the NM lost track of it due to the container kill then it seems like we could leak a hung localizer process.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-06-19T13:53:21.639+0000","updated":"2014-06-19T13:53:21.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721779/comment/14049223","id":"14049223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"body":"I should clarify the AM can kill this container manually but each AM will have to implement this logic to detect when localization takes longer and kill when its taking too long. Updating description.\nWe can make it much simpler for administrators and AM writers by having an automatic way to mitigate this. The NodeManager knows each state of the container. Instead of having a back and forth between AM and NM, it will be easier if we just let this be done by NM. We can start with a configurable timeout with a reasonable default. In future we can add ability in the AM to override this during the container request.\nLemme know what you guys think.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-01T19:23:55.374+0000","updated":"2014-07-01T19:23:55.374+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721779/comment/14049586","id":"14049586","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"That is a reasonable proposal, but I'd like to see if there are any other bugs that are causing this to happen. Have we seen this in practice? If so, what is the underlying reason? Too big a resource? The source file-system is down? Or NM has a bug? We should try to address the right individual problem with its solution before we put a band-aid that may still be useful for issues that we cannot just address directly if any.\n\nContrast this with mapreduce.task.timeout. Arguably the config helped users timeout their jobs, but from my experience it prevented us from focusing on fixing point bugs that were hidden in the framework for a long time - it kind of hides the issues. It still is useful, for those unmanageable and unsolvable bugs, but I'd rather first fix the point problems and then put the band-aid. Thoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-02T03:38:19.545+0000","updated":"2014-07-02T03:38:19.545+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721779/comment/14050533","id":"14050533","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"body":"We have seen it happen when the source file system had issues. Some jobs would intermittently take a long time to fail and would succeed in rerun because the jars were put in a new distributed cache location when rerun. Without this timeout we have no lever to mitigate underlying HDFS/Hardware issues out in production until the root cause is identified and fixed. \nAlso in comparison with the mapreduce.task.timeout this seems very focussed on a specific operation - localization. I would expect this timeout would be defaulted to a large value in production (say 30 min) and used only to mitigate when a issue occurs in production.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adhoot","name":"adhoot","key":"adhoot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anubhav Dhoot","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-02T18:32:13.157+0000","updated":"2014-07-02T18:32:13.157+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721779/comment/14050539","id":"14050539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"body":"I ll let Anubhav provide details on the particular instance we ran into this. \n\nbq. We should try to address the right individual problem with its solution before we put a band-aid that may still be useful for issues that we cannot just address directly if any.\nHaving worked on several MR1 production issues, I see your point. I agree we should look into and address individual problems. That said, I also believe in failsafes to avoid bringing down a production cluster or failing a critical job altogether in the face of hardware issues. That gives us time to fix the individual issues correctly when we encounter them, instead of hurrying for a hot fix. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-07-02T18:37:24.139+0000","updated":"2014-07-02T18:37:24.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721779/comment/14050543","id":"14050543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"body":"In MR1, mapred.task.timeout handles localization as well and that has worked very well for our customers. Should we do the same for MR2 as well? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-07-02T18:39:48.378+0000","updated":"2014-07-02T18:39:48.378+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721779/comment/14389173","id":"14389173","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"In our testing, we see this issue with the AM container itself potentially taking longer than 10 mins to localize and the RM kills this attempt since it hasn't heard from it.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-31T18:48:27.347+0000","updated":"2015-03-31T18:48:27.347+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12721779/comment/16343997","id":"16343997","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thinktaocs","name":"thinktaocs","key":"thinktaocs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tao Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"We're facing this issue too. Localization in part of containers may take a long time due to underlying HDFS issues, machine network conditions, etc. AM will request more containers when it doesn't see enough available containers (which finish localization). However Yarn will keep those containers being stuck at localization and there's not a good automatic way to kill them. A dynamically adjusting Timeout feature for \"localizing\" would help here.\r\n\r\nComparing to a \"pre-configured\" timeout value, it'd be better to have a \"dynamically adjusting\" timeout. E.g, we calculate the avg localization time for first 50% containers of 1 app, then set *2 * avg_localizing_time_of_half_containers* as the timeout threshold for rest containers. This requires information of all containers localization time. Hence *RM* would be the appropriate component to implement this feature (container localization timeout). AM may not be a good choice since \"localization\" is a common process of yarn, and we don't want to implement this feature for each type of ApplicationMasters.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thinktaocs","name":"thinktaocs","key":"thinktaocs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tao Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-29T20:48:45.077+0000","updated":"2018-01-29T20:48:45.077+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2175/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1wurz:"}}