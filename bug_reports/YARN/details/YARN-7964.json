{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13140379","self":"https://issues.apache.org/jira/rest/api/2/issue/13140379","key":"YARN-7964","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-08-24T10:36:30.857+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 24 10:36:30 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-7964/watchers","watchCount":3,"isWatching":false},"created":"2018-02-23T00:52:42.524+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341259","id":"12341259","description":"2.7.5 release","name":"2.7.5","archived":false,"released":true,"releaseDate":"2017-12-14"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341435","id":"12341435","description":"3.0.0 GA release","name":"3.0.0","archived":false,"released":true,"releaseDate":"2017-12-13"}],"issuelinks":[{"id":"12541659","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12541659","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"13177381","key":"YARN-8632","self":"https://issues.apache.org/jira/rest/api/2/issue/13177381","fields":{"summary":"Threads in SLS quit without logging exception ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-24T10:36:30.857+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324210","id":"12324210","name":"scheduler-load-simulator"}],"timeoriginalestimate":null,"description":"hi, I am using sls to simulate a large scale cluster, which consists more than 100 nodes and runs more than 4k jobs. I found that MetricsLogRunnable (periodically flush real-time metrics to a file) stops working if the sls takes too long to load sls file.\r\n\r\nMore specifically, the exception is thrown at here in function String generateRealTimeTrackingMetrics() in SLSWebApp.java :\r\n{code:java}\r\nfor (String queue : wrapper.getQueueSet()) {\r\n..........\r\n}\r\n{code}\r\n \r\nThe excepthion is reported as:\r\n2018-02-22 17:13:59,450 INFO sls.SLSRunner: newly creaed job: 6263127055conainer size: 10queue: default\r\njava.lang.NullPointerException\r\nat org.apache.hadoop.yarn.sls.web.SLSWebApp.generateRealTimeTrackingMetrics(SLSWebApp.java:438)\r\nat org.apache.hadoop.yarn.sls.scheduler.SLSCapacityScheduler$MetricsLogRunnable.run(SLSCapacityScheduler.java:724)\r\nat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\nat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\r\nat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\r\nat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\nat java.lang.Thread.run(Thread.java:745)\r\n\r\n \r\n\r\nSo the wrapper.getQueueSet() returns a NullPointer which causes the exception.\r\n\r\nAfter we further analyzing the source code, we noticed that in SLSRunner.java:\r\n{code:java}\r\npublic void start() throws Exception {\r\n    // start resource manager\r\n    startRM();\r\n    // start node managers\r\n    startNM();\r\n    // start application masters\r\n    startAM();\r\n    // set queue & tracked apps information\r\n    ((SchedulerWrapper) rm.getResourceScheduler())\r\n                            .setQueueSet(this.queueAppNumMap.keySet());\r\n    ((SchedulerWrapper) rm.getResourceScheduler())\r\n                            .setTrackedAppSet(this.trackedApps);\r\n    // print out simulation info\r\n    printSimulationInfo();\r\n    // blocked until all nodes RUNNING\r\n    waitForNodesRunning();\r\n    // starting the runner once everything is ready to go,\r\n    runner.start();\r\n  }\r\n{code}\r\n\r\nAs you can see the queue set for tracking is set by  ((SchedulerWrapper)rm.getResourceScheduler())\r\n                            .setQueueSet(this.queueAppNumMap.keySet()); which is done after rm, nm and app initilization. Before the queue set is set, the  MetricsLogRunnable has already been lauched. That's the reason why the queue set is empty and cause NullPointerException.\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Yarn Scheduler Load Simulator (SLS): MetricsLogRunnable stops working when there are too many jobs needed to load from sls","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cxcw","name":"cxcw","key":"cxcw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Chen","active":true,"timeZone":"America/Denver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cxcw","name":"cxcw","key":"cxcw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Chen","active":true,"timeZone":"America/Denver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"I am running sls on a linux server (ubuntu-16.04). The hadoop version is 3.0.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13140379/comment/16591456","id":"16591456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=luxianghao","name":"luxianghao","key":"luxianghao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=luxianghao&avatarId=33482","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=luxianghao&avatarId=33482","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=luxianghao&avatarId=33482","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=luxianghao&avatarId=33482"},"displayName":"Xianghao Lu","active":true,"timeZone":"Asia/Shanghai"},"body":"[~cxcw] Seems duplicate with YARN-8632.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=luxianghao","name":"luxianghao","key":"luxianghao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=luxianghao&avatarId=33482","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=luxianghao&avatarId=33482","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=luxianghao&avatarId=33482","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=luxianghao&avatarId=33482"},"displayName":"Xianghao Lu","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-08-24T10:36:30.857+0000","updated":"2018-08-24T10:36:30.857+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-7964/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3qi3j:"}}