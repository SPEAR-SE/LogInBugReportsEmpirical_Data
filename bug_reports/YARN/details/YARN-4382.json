{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12915245","self":"https://issues.apache.org/jira/rest/api/2/issue/12915245","key":"YARN-4382","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-11-23T07:25:34.536+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Nov 16 12:28:15 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4382/watchers","watchCount":14,"isWatching":false},"created":"2015-11-23T07:03:02.498+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12328972","id":"12328972","description":"2.5.2 release","name":"2.5.2","archived":false,"released":true,"releaseDate":"2014-11-19"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hex108","name":"hex108","key":"hex108","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Gong","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-11-16T12:28:15.799+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319323","id":"12319323","name":"nodemanager"}],"timeoriginalestimate":null,"description":"If we use LinuxContainerExecutor to executor the containers, this question may happens.\nIn the common case, when a container run, a corresponding hierarchy will be created in cgroup dir. And when the container terminate, the hierarchy  will be delete in some seconds(this time can be configured by yarn.nodemanager.linux-container-executor.cgroups.delete-delay-ms).\n\nIn the code, I find that, CgroupsLCEResource send a signal to kill container process asynchronously, and in the same time, it will try to delete the container hierarchy  in configured \"delete-delay-ms\" times. \nBut if the container process be killed for seconds which large than \"delete-delay-ms\" time, the  container hierarchy  will remain for ever.\n\n\n\n\n  ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Container hierarchy in cgroup may remain for ever after the container have be terminated","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lachisis","name":"lachisis","key":"lachisis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"lachisis","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lachisis","name":"lachisis","key":"lachisis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"lachisis","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915245/comment/15021630","id":"15021630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lachisis","name":"lachisis","key":"lachisis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"lachisis","active":true,"timeZone":"Asia/Shanghai"},"body":"If lots of container hierarchys remained, it will make the cpu busy of this node, even when no jobs are running.\n\n------------------------------------------------------------------------------\n   PerfTop:  129889 irqs/sec  kernel:76.3% [100000 cycles],  (all, 16 CPUs)\n------------------------------------------------------------------------------\n\n             samples    pcnt   kernel function\n             _______   _____   _______________\n\n           117166.00 - 59.1% : tg_shares_up\n            35688.00 - 18.0% : _spin_lock_irqsave\n            12045.00 -  6.1% : __set_se_shares\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lachisis","name":"lachisis","key":"lachisis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"lachisis","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-11-23T07:08:45.438+0000","updated":"2015-11-23T07:08:45.438+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915245/comment/15021666","id":"15021666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hex108","name":"hex108","key":"hex108","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Gong","active":true,"timeZone":"Asia/Shanghai"},"body":"'release_agent' in cgroups ([https://www.kernel.org/doc/Documentation/cgroups/cgroups.txt|https://www.kernel.org/doc/Documentation/cgroups/cgroups.txt]) might help for this case. Maybe we could use it to remove empty dirs? SLURM has used it ([http://slurm.schedmd.com/cgroups.html|http://slurm.schedmd.com/cgroups.html]).\n\n{quote}\nIf the notify_on_release flag is enabled (1) in a cgroup, then whenever the last task in the cgroup leaves (exits or attaches to some other cgroup) and the last child cgroup of that cgroup is removed, then the kernel runs the command specified by the contents of the \"release_agent\" file in that hierarchy's root directory, supplying the pathname (relative to the mount point of the cgroup file system) of the abandoned cgroup.  This enables automatic removal of abandoned cgroups.  The default value of notify_on_release in the root cgroup at system boot is disabled (0).  The default value of other cgroups at creation is the current value of their parents' notify_on_release settings. The default value of a cgroup hierarchy's release_agent path is empty.\n{quote}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hex108","name":"hex108","key":"hex108","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Gong","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-11-23T07:25:34.536+0000","updated":"2015-11-23T07:25:34.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915245/comment/15022059","id":"15022059","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hex108","name":"hex108","key":"hex108","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Gong","active":true,"timeZone":"Asia/Shanghai"},"body":"[~lachisis] Thanks for reporting the issue. Please feel free to re-assign to yourself if you starts/wants to work on it. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hex108","name":"hex108","key":"hex108","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Gong","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-11-23T12:58:42.072+0000","updated":"2015-11-23T12:58:42.072+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915245/comment/15023481","id":"15023481","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lachisis","name":"lachisis","key":"lachisis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"lachisis","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks for your reply, Jun Gong. \nI think it is a good idea to use \"release_agent\" to clear the empty container hierarchys. But I am afaid that does \"release_agent\" option suit all the cgroup versions?\nI just test \"release_agent\" option, maybe some mistake, it does not work now.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lachisis","name":"lachisis","key":"lachisis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"lachisis","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-11-24T00:39:42.827+0000","updated":"2015-11-24T00:39:42.827+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915245/comment/15029363","id":"15029363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lachisis","name":"lachisis","key":"lachisis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"lachisis","active":true,"timeZone":"Asia/Shanghai"},"body":"I have tested for the \"release_agent\" feature, and think it is suitable.\nJun Gong , do you make the patch now?  If not, I will assignee to me and make.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lachisis","name":"lachisis","key":"lachisis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"lachisis","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-11-27T02:54:53.023+0000","updated":"2015-11-27T02:54:53.023+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915245/comment/15029670","id":"15029670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hex108","name":"hex108","key":"hex108","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Gong","active":true,"timeZone":"Asia/Shanghai"},"body":"Sorry for late reply. I am working on it, will attach a patch later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hex108","name":"hex108","key":"hex108","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Gong","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-11-27T09:31:05.890+0000","updated":"2015-11-27T09:31:05.890+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915245/comment/15663485","id":"15663485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=XiaopengLi","name":"XiaopengLi","key":"xiaopengli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"XiaopengLi","active":true,"timeZone":"Etc/UTC"},"body":"Hi Jun Gong.I have the interest to fix this problem. But I can not understand what you mean. You want to write the shell command or the script to  release_agent in the cgroup ? The Shell command or the script that can delete the hierarchy or the container  empty dirs.You can write the demo or descirbe your idea?Thanks.：）\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=XiaopengLi","name":"XiaopengLi","key":"xiaopengli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"XiaopengLi","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-14T11:07:23.054+0000","updated":"2016-11-14T11:07:23.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915245/comment/15670310","id":"15670310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hex108","name":"hex108","key":"hex108","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Gong","active":true,"timeZone":"Asia/Shanghai"},"body":"{quote}\nYou want to write the shell command or the script to release_agent in the cgroup ? The Shell command or the script that can delete the hierarchy or the container empty dirs.\n{quote}\nYes. The demo could be found at https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/sec-common_tunable_parameters.html.\n\nPlease feel free to work on it. Sorry for it. I was busy at that time and forgot it...:(","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hex108","name":"hex108","key":"hex108","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Gong","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-11-16T12:28:15.799+0000","updated":"2016-11-16T12:28:15.799+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4382/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ortj:"}}