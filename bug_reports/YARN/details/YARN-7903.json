{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13136932","self":"https://issues.apache.org/jira/rest/api/2/issue/13136932","key":"YARN-7903","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-02-08T01:16:03.586+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Feb 09 04:59:37 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-7903/watchers","watchCount":2,"isWatching":false},"created":"2018-02-07T19:08:12.414+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341436","id":"12341436","description":"3.1.0 release","name":"3.1.0","archived":false,"released":true,"releaseDate":"2018-04-06"}],"issuelinks":[{"id":"12526652","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12526652","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"outwardIssue":{"id":"13137339","key":"YARN-7910","self":"https://issues.apache.org/jira/rest/api/2/issue/13137339","fields":{"summary":"Fix TODO in TestFairSchedulerPreemption#testRelaxLocalityToNotPreemptAM","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12526631","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12526631","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13092704","key":"YARN-6956","self":"https://issues.apache.org/jira/rest/api/2/issue/13092704","fields":{"summary":"preemption may only consider resource requests for one node","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12526620","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12526620","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13124823","key":"YARN-7655","self":"https://issues.apache.org/jira/rest/api/2/issue/13124823","fields":{"summary":"Avoid AM preemption caused by RRs for specific nodes or racks","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=snemeth","name":"snemeth","key":"snemeth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=snemeth&avatarId=33743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=snemeth&avatarId=33743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=snemeth&avatarId=33743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=snemeth&avatarId=33743"},"displayName":"Szilard Nemeth","active":true,"timeZone":"Europe/Budapest"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-29T13:57:18.652+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12322906","id":"12322906","name":"fairscheduler","description":"Fair Scheduler"}],"timeoriginalestimate":null,"description":"We need to specify rack and ANY while submitting a node local resource request, as YARN-7561 discussed. For example:\r\n{code}\r\n    ResourceRequest nodeRequest =\r\n            createResourceRequest(GB, node1.getHostName(), 1, 1, false);\r\n    ResourceRequest rackRequest =\r\n            createResourceRequest(GB, node1.getRackName(), 1, 1, false);\r\n    ResourceRequest anyRequest =\r\n            createResourceRequest(GB, ResourceRequest.ANY, 1, 1, false);\r\n\r\n    List<ResourceRequest> resourceRequests =\r\n            Arrays.asList(nodeRequest, rackRequest, anyRequest);\r\n{code}\r\nHowever, method getStarvedResourceRequests() only consider the first encountered resource, which most likely is ResourceRequest.ANY. That's a mismatch for locality request.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Method getStarvedResourceRequests() only consider the first encountered resource","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13136932/comment/16356327","id":"16356327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Steven+Rand","name":"Steven Rand","key":"steven rand","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Rand","active":true,"timeZone":"America/New_York"},"body":"Agreed that it seems weird/wrong to ignore locality when considering which of an app's RRs to preempt for. I think it's worth noting though that if we change the code to choose the most local request, then we increase the frequency of the failure mode described in YARN-6956, where we fail to preempt because {{getStarvedResourceRequests}} returns only {{NODE_LOCAL}} RRs, and there aren't any preemptable containers on those nodes (even though there are preemptable containers on other nodes). I think that we should try to make progress on that JIRA as well as this one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Steven+Rand","name":"Steven Rand","key":"steven rand","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Rand","active":true,"timeZone":"America/New_York"},"created":"2018-02-08T01:16:03.586+0000","updated":"2018-02-08T01:16:03.586+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13136932/comment/16357515","id":"16357515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\r\nI think that we should try to make progress on that JIRA as well as this one.\r\n{quote}\r\nAgreed.\r\nThe request request in description is actually one RR instead of 3 RRs. If the RR is strict about locality(RelaxLocality is false), I don't think there is need to consider other RRs. However, that's another story if RR's RelaxLocality is true. To enable some kind of delay scheduling for preemption seems a reasonable solution for both YARN-6956 and this Jira. \r\n\r\nI am still confusing about how to parse the multiple RRs of an apps, e.g. the example in the description is actually one RRs instead of 3 RRs, what if there size and container# are different between nodeRequest and rackRequest? Do we consider them one RRs or multiple RRs. Without good understanding of this, I don't think we can make any progress on YARN-6956. Please let me know your thoughts about this. I'll try to dig more about this as well. Thanks. [~Steven Rand].","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-08T20:20:41.821+0000","updated":"2018-02-08T20:20:41.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13136932/comment/16357923","id":"16357923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Steven+Rand","name":"Steven Rand","key":"steven rand","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Rand","active":true,"timeZone":"America/New_York"},"body":"Agreed that having a concept of delay scheduling for preemption is a good idea and would help with both JIRAs. We might be able to use {{FSAppAttempt.getAllowedLocalityLevel}} or {{FSAppAttempt.getAllowedLocalityLevelByTime}}, since those already have logic for checking whether the app has waited longer than the threshold for requests with some {{SchedulerKey}} (which seems to really just mean priority?). I'll defer to others though on whether it makes sense for delay logic in preemption to match delay logic in allocation -- possibly there are differences between the two that call for separate logic.\r\n\r\nI'm also quite confused as to how we should be thinking about different RRs from the same app at the same priority. I spent some time digging through the code today, but don't really understand it yet. There are a couple pieces of code I found that deal with deduping/deconflicting RRs, but I wasn't sure how to interpret them:\r\n\r\n* {{VisitedResourceRequestTracker}} seems to consider RRs with the same priority and capability to be logically the same\r\n* {{AppSchedulingInfo#internalAddResourceRequests}} seems to consider RRs with the same {{SchedulerRequestKey}} and resourceName to be logically the same","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Steven+Rand","name":"Steven Rand","key":"steven rand","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Rand","active":true,"timeZone":"America/New_York"},"created":"2018-02-09T04:59:37.884+0000","updated":"2018-02-09T04:59:37.884+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-7903/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3pwu7:"}}