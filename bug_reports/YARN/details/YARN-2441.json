{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12736057","self":"https://issues.apache.org/jira/rest/api/2/issue/12736057","key":"YARN-2441","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-08-22T14:35:03.005+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 22 15:47:54 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2441/watchers","watchCount":9,"isWatching":false},"created":"2014-08-22T12:48:59.421+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326262","id":"12326262","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-08-22T16:36:01.779+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319323","id":"12319323","name":"nodemanager"}],"timeoriginalestimate":null,"description":"{code}\n2014-08-22 16:43:19,640 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl: Blocking new container-requests as container manager rpc server is still starting.\n2014-08-22 16:43:19,658 INFO org.apache.hadoop.ipc.Server: IPC Server Responder: starting\n2014-08-22 16:43:19,675 INFO org.apache.hadoop.ipc.Server: IPC Server listener on 45026: starting\n2014-08-22 16:43:20,029 INFO org.apache.hadoop.yarn.server.nodemanager.security.NMContainerTokenSecretManager: Updating node address : host-10-18-40-95:45026\n2014-08-22 16:43:20,029 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl: ContainerManager started at /10.18.40.95:45026\n2014-08-22 16:43:20,030 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl: ContainerManager bound to host-10-18-40-95/10.18.40.95:45026\n2014-08-22 16:43:20,073 INFO org.apache.hadoop.ipc.CallQueueManager: Using callQueue class java.util.concurrent.LinkedBlockingQueue\n2014-08-22 16:43:20,098 INFO org.apache.hadoop.ipc.Server: Starting Socket Reader #1 for port 45027\n2014-08-22 16:43:20,158 INFO org.apache.hadoop.yarn.factories.impl.pb.RpcServerFactoryPBImpl: Adding protocol org.apache.hadoop.yarn.server.nodemanager.api.LocalizationProtocolPB to the server\n2014-08-22 16:43:20,178 INFO org.apache.hadoop.ipc.Server: IPC Server Responder: starting\n2014-08-22 16:43:20,192 INFO org.apache.hadoop.ipc.Server: IPC Server listener on 45027: starting\n2014-08-22 16:43:20,210 INFO org.apache.hadoop.ipc.Server: Socket Reader #1 for port 45026: readAndProcess from client 10.18.40.84 threw exception [java.lang.NullPointerException]\njava.lang.NullPointerException\n\tat org.apache.hadoop.yarn.server.nodemanager.security.NMTokenSecretManagerInNM.retrievePassword(NMTokenSecretManagerInNM.java:167)\n\tat org.apache.hadoop.yarn.server.nodemanager.security.NMTokenSecretManagerInNM.retrievePassword(NMTokenSecretManagerInNM.java:43)\n\tat org.apache.hadoop.security.token.SecretManager.retriableRetrievePassword(SecretManager.java:91)\n\tat org.apache.hadoop.security.SaslRpcServer$SaslDigestCallbackHandler.getPassword(SaslRpcServer.java:278)\n\tat org.apache.hadoop.security.SaslRpcServer$SaslDigestCallbackHandler.handle(SaslRpcServer.java:305)\n\tat com.sun.security.sasl.digest.DigestMD5Server.validateClientResponse(DigestMD5Server.java:585)\n\tat com.sun.security.sasl.digest.DigestMD5Server.evaluateResponse(DigestMD5Server.java:244)\n\tat org.apache.hadoop.ipc.Server$Connection.processSaslToken(Server.java:1384)\n\tat org.apache.hadoop.ipc.Server$Connection.processSaslMessage(Server.java:1361)\n\tat org.apache.hadoop.ipc.Server$Connection.saslProcess(Server.java:1275)\n\tat org.apache.hadoop.ipc.Server$Connection.saslReadAndProcess(Server.java:1238)\n\tat org.apache.hadoop.ipc.Server$Connection.processRpcOutOfBandRequest(Server.java:1878)\n\tat org.apache.hadoop.ipc.Server$Connection.processOneRpc(Server.java:1755)\n\tat org.apache.hadoop.ipc.Server$Connection.readAndProcess(Server.java:1519)\n\tat org.apache.hadoop.ipc.Server$Listener.doRead(Server.java:750)\n\tat org.apache.hadoop.ipc.Server$Listener$Reader.doRunLoop(Server.java:624)\n\tat org.apache.hadoop.ipc.Server$Listener$Reader.run(Server.java:595)\n2014-08-22 16:43:20,227 INFO org.apache.hadoop.ipc.Server: Socket Reader #1 for port 45026: readAndProcess from client 10.18.40.84 threw exception [java.lang.NullPointerException]\njava.lang.NullPointerException\n\tat org.apache.hadoop.yarn.server.nodemanager.security.NMTokenSecretManagerInNM.retrievePassword(NMTokenSecretManagerInNM.java:167)\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"NPE in nodemanager after restart","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nishan","name":"nishan","key":"nishan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nishan Shetty","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nishan","name":"nishan","key":"nishan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nishan Shetty","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736057/comment/14106902","id":"14106902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Was this truly running trunk as the Affected Versions field indicates or was this some other version of Hadoop?  Also was this a work-preserving NM restart scenario (i.e.: yarn.nodemanager.recovery.enabled=true) or a typical NM startup?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-08-22T14:35:03.005+0000","updated":"2014-08-22T14:35:03.005+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736057/comment/14106987","id":"14106987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nishan","name":"nishan","key":"nishan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nishan Shetty","active":true,"timeZone":"Asia/Kolkata"},"body":"[~jlowe] Sorry i mentioned the wrong Affected Version. Its branch 2. Work-preserving NM is not enabled, its just plain restart","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nishan","name":"nishan","key":"nishan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nishan Shetty","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-08-22T15:35:03.013+0000","updated":"2014-08-22T15:35:03.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736057/comment/14106999","id":"14106999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Ah, then this seems like a case where a client (likely an AM) is connecting to the NM before the NM has finished registering with the RM to get the secret keys.  Trying to block new container requests at the app level probably isn't going to work in practice because the SASL layer in RPC doesn't let the connection get to the point where the app can try to reject the request.\n\nIMHO we should remove the \"blocking client requests\" code and instead do a delayed server start, sorta like the delay added by YARN-1337 when NM recovery is enabled.  Ideally the RPC layer would support the ability to bind to a server socket but not start accepting requests until later.  That would allow us to register with the RM knowing what our client port is but without trying to let clients through that port until we're really ready.\n\nShorter term fix might be to have the secret manager throw an exception that can be retried by clients if the master key isn't set yet.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-08-22T15:47:54.191+0000","updated":"2014-08-22T15:47:54.191+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2441/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1z89z:"}}