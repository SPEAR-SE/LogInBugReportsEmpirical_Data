{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12965533","self":"https://issues.apache.org/jira/rest/api/2/issue/12965533","key":"YARN-5051","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-05-06T08:59:42.570+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed May 11 09:35:39 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-5051/watchers","watchCount":6,"isWatching":false},"created":"2016-05-06T08:40:22.873+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331976","id":"12331976","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-11T09:35:39.074+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319322","id":"12319322","name":"resourcemanager"}],"timeoriginalestimate":null,"description":"When the RM restartï¼Œthe RM will refuse the Decommission NodeManager register, and I put the NM host removed from exclude_mapred_host file, execute the command\n{noformat}\nyarn rmadmin -refreshNodes\n{noformat} \nstart nodemanager , the decommissioned nodes num can not update","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12802637","id":"12802637","filename":"rm.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-06T08:48:07.999+0000","size":99159,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12802637/rm.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"The RM can't update the Decommissioned Nodes Metric","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12965533/comment/15273813","id":"15273813","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"Is your include hosts file empty?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-06T08:59:42.570+0000","updated":"2016-05-06T08:59:42.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12965533/comment/15273815","id":"15273815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"body":"i think we should put the decommission node in InactiveRMNodes when it is registered\n{code:title=ResourceTrackerService.java|borderStyle=solid}\n    RMNode rmNode = new RMNodeImpl(nodeId, rmContext, host, cmPort, httpPort,\n            resolve(host), capability, nodeManagerVersion);\n    // Check if this node is a 'valid' node\n    if (!this.nodesListManager.isValidNode(host)) {\n      String message =\n              \"Disallowed NodeManager from  \" + host\n                      + \", Sending SHUTDOWN signal to the NodeManager.\";\n      LOG.info(message);\n      response.setDiagnosticsMessage(message);\n      response.setNodeAction(NodeAction.SHUTDOWN);\n       this.rmContext.getInactiveRMNodes().put(rmNode.getNodeID().getHost(), rmNode);\n      return response;\n    }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-06T09:00:32.101+0000","updated":"2016-05-06T09:00:32.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12965533/comment/15273819","id":"15273819","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"body":"The include hosts file not empty also have the same problem","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-06T09:03:52.403+0000","updated":"2016-05-06T09:03:52.403+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12965533/comment/15273825","id":"15273825","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"body":"when the nodemanager start will trigger the AddNodeTransition, the node in the NEW state, will not reduce the value of DecommisionedNMs value.\n{code:title=RMNodeImpl.java|borderStyle=solid}\n    Rpublic static class AddNodeTransition implements\n      SingleArcTransition<RMNodeImpl, RMNodeEvent> {\n\n    @Override\n    public void transition(RMNodeImpl rmNode, RMNodeEvent event) {\n      // Inform the scheduler\n      RMNodeStartedEvent startEvent = (RMNodeStartedEvent) event;\n      List<NMContainerStatus> containers = null;\n\n      String host = rmNode.nodeId.getHost();\n      if (rmNode.context.getInactiveRMNodes().containsKey(host)) {\n\n        // Old node rejoining\n        RMNode previouRMNode = rmNode.context.getInactiveRMNodes().get(host);\n        rmNode.context.getInactiveRMNodes().remove(host);\n        rmNode.updateMetricsForRejoinedNode(previouRMNode.getState());\n      } else {\n        ClusterMetrics.getMetrics().incrNumActiveNodes();\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-06T09:12:18.400+0000","updated":"2016-05-06T09:12:18.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12965533/comment/15273834","id":"15273834","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"body":"I think should add NEW events in updateMetricsForRejoinedNode method processingï¼Œlike this:\n{code:title=RMNodeImpl.java|borderStyle=solid}\n  private void updateMetricsForRejoinedNode(NodeState previousNodeState) {\n    ClusterMetrics metrics = ClusterMetrics.getMetrics();\n    metrics.incrNumActiveNodes();\n\n    switch (previousNodeState) {\n    case LOST:\n      metrics.decrNumLostNMs();\n      break;\n    case REBOOTED:\n      metrics.decrNumRebootedNMs();\n      break;\n    case NEW:\n    case DECOMMISSIONED:\n      metrics.decrDecommisionedNMs();\n      break;\n    case UNHEALTHY:\n      metrics.decrNumUnhealthyNMs();\n      break;\n    default:\n      LOG.debug(\"Unexpected previous node state\");    \n    }\n  }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-06T09:21:29.887+0000","updated":"2016-05-06T09:21:29.887+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12965533/comment/15278743","id":"15278743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm not sure that last suggestion looks right.  I don't have time to go dig in the code at the moment.  [~kshukla], can you comment?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-10T19:44:29.598+0000","updated":"2016-05-10T19:44:29.598+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12965533/comment/15279092","id":"15279092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kshukla","name":"kshukla","key":"kshukla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34050","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"},"displayName":"Kuhu Shukla","active":true,"timeZone":"Etc/UTC"},"body":"[~tangshangwen], Thank you for reporting this. The fix for this issue was part of YARN-3102 AFAICT from the problem statement of this JIRA. Its fix was checked into 2.7.3. It seems you are running 2.7.1? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kshukla","name":"kshukla","key":"kshukla","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34050","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"},"displayName":"Kuhu Shukla","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-10T22:11:35.325+0000","updated":"2016-05-10T22:11:35.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12965533/comment/15279855","id":"15279855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"body":"yes, thanks [~kshukla]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tangshangwen","name":"tangshangwen","key":"tangshangwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"tangshangwen","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-11T09:35:39.074+0000","updated":"2016-05-11T09:35:39.074+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-5051/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2x94f:"}}