{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12692264","self":"https://issues.apache.org/jira/rest/api/2/issue/12692264","key":"YARN-1677","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-04-10T17:15:29.181+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri May 01 21:53:10 UTC 2015","customfield_12310420":"370859","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-1677/watchers","watchCount":8,"isWatching":false},"created":"2014-01-30T12:31:25.040+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325051","id":"12325051","description":"2.2.0 release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-01T21:53:10.535+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319323","id":"12319323","name":"nodemanager"}],"timeoriginalestimate":null,"description":"Hi Yarn developers,\nWe are a group of researchers on software reliability, and recently we did a study and found that majority of the most severe failures in hadoop are caused by bugs in exception handling logic. Therefore we built a simple checking tool that automatically detects some bug patterns that have caused some very severe failures. I am reporting some of the results for Yarn here. Any feedback is much appreciated!\n\n==========================\nCase 1:\nLine: 551, File: \"org/apache/hadoop/yarn/server/nodemanager/containermanager/monitor/ContainersMonitorImpl.java\"\n\n{noformat}\n    switch (monitoringEvent.getType()) {\n    case START_MONITORING_CONTAINER:\n      .. ..\n    default:\n      // TODO: Wrong event.\n    }\n{noformat}\n\nThe switch fall-through (handling any potential unexpected event) is empty. Should we at least print an error message here?\n==========================\n\n==========================\nCase 2:\n  Line: 491, File: \"org/apache/hadoop/yarn/server/nodemanager/NodeStatusUpdaterImpl.java\"\n{noformat}\n          } catch (Throwable e) {\n\n            // TODO Better error handling. Thread can die with the rest of the\n            // NM still running.\n            LOG.error(\"Caught exception in status-updater\", e);\n          }\n{noformat}\n\nThe handler of this very general exception only logs the error. The TODO seems to indicate it is not sufficient.\n==========================\n\n==========================\nCase 3:\nLine: 861, File: \"org/apache/hadoop/yarn/server/nodemanager/containermanager/localizer/ResourceLocalizationService.java\"\n\n   for (LocalResourceStatus stat : remoteResourceStatuses) {\n        LocalResource rsrc = stat.getResource();\n        LocalResourceRequest req = null;\n        try {\n          req = new LocalResourceRequest(rsrc);\n        } catch (URISyntaxException e) {\n          // TODO fail? Already translated several times...\n        }\n\nThe handler for URISyntaxException is empty, and the TODO seems to indicate it is not sufficient.\nThe same code pattern can also be found at:\nLine: 901, File: \"org/apache/hadoop/yarn/server/nodemanager/containermanager/localizer/ResourceLocalizationService.java\"\nLine: 838, File: \"org/apache/hadoop/yarn/server/nodemanager/containermanager/localizer/ResourceLocalizationService.java\"\nLine: 878, File: \"org/apache/hadoop/yarn/server/nodemanager/containermanager/localizer/ResourceLocalizationService.java\"\nAt line: 803, File: org/apache/hadoop/yarn/applications/distributedshell/ApplicationMaster.java, the handler of URISyntaxException also seems not sufficient:\n{noformat}\n       try {\n          shellRsrc.setResource(ConverterUtils.getYarnUrlFromURI(new URI(\n              shellScriptPath)));\n        } catch (URISyntaxException e) {\n          LOG.error(\"Error when trying to use shell script path specified\"\n              + \" in env, path=\" + shellScriptPath);\n          e.printStackTrace();\n\n          // A failure scenario on bad input such as invalid shell script path\n          // We know we cannot continue launching the container\n          // so we should release it.\n          // TODO\n          numCompletedContainers.incrementAndGet();\n          numFailedContainers.incrementAndGet();\n          return;\n        }\n{noformat}\n==========================\n\n==========================\nCase 4:\nLine: 627, File: \"org/apache/hadoop/yarn/server/resourcemanager/rmapp/attempt/RMAppAttemptImpl.java\"\n\n{noformat}\n      try {\n        /* keep the master in sync with the state machine */\n        this.stateMachine.doTransition(event.getType(), event);\n      } catch (InvalidStateTransitonException e) {\n        LOG.error(\"Can't handle this event at current state\", e);\n        /* TODO fail the application on the failed transition */\n      }\n{noformat}\n\nThe handler of this exception only logs the error. The TODO seems to indicate it is not sufficient.\n\nThis exact same code pattern can also be found at:\nLine: 573, File: \"org/apache/hadoop/yarn/server/resourcemanager/rmapp/RMAppImpl.java\"\n==========================\n\n==========================\nCase 5: empty handler for exception: java.lang.InterruptedException\n  Line: 123, File: \"org/apache/hadoop/yarn/server/webproxy/WebAppProxy.java\"\n\n{noformat}\n  public void join() {\n    if(proxyServer != null) {\n      try {\n        proxyServer.join();\n      } catch (InterruptedException e) {\n      }\n    }\n  }\n{noformat}\n\nThe InterruptedException is completely ignored. As a result, any events causing this interrupt will be lost.\n\nMore info on why InterruptedException shouldn't be ignored: http://stackoverflow.com/questions/1087475/when-does-javas-thread-sleep-throw-interruptedexception\n\nThis pattern of handling InterruptedException can be found in a few other places:\nLine: 434, File: org/apache/hadoop/yarn/server/resourcemanager/ResourceManager.java\n{noformat}\n          try {\n            event = eventQueue.take();\n          } catch (InterruptedException e) {\n            LOG.error(\"Returning, interrupted : \" + e);\n            return; // TODO: Kill RM.\n          }\n{noformat}\nLine: 722, File: \"org/apache/hadoop/yarn/server/nodemanager/containermanager/localizer/ResourceLocalizationService.java\"\nLine: 191, File: \"org/apache/hadoop/yarn/server/nodemanager/containermanager/monitor/ContainersMonitorImpl.java\"\nLine: 393, File: \"org/apache/hadoop/yarn/util/LinuxResourceCalculatorPlugin.java\"\nLine: 258, File: \"org/apache/hadoop/yarn/server/nodemanager/containermanager/localizer/LocalizedResource.java\"\n==========================\n\n==========================\nCase 6: potential divide by zero\nline: 581, File: org/apache/hadoop/yarn/server/resourcemanager/scheduler/fifo/FifoScheduler.java\n{noformat}\n    int availableContainers =\n      node.getAvailableResource().getMemory() / capability.getMemory(); \n  // TODO: A buggy\n   // application\n    // with this\n    // zero would\n    // crash the\n    // scheduler.\n{noformat}\n\nShould this potential divide by zero be handled?\n==========================\n\n==========================\nCase 7:\n  Line: 260, File: \"org/apache/hadoop/yarn/server/nodemanager/containermanager/localizer/LocalizedResource.java\"\n{noformat}\n      } catch (YarnException e) {\n        // TODO cleanup\n        return;\n      }\n{noformat}\n\nThe error handler simply returns without proper clean up.\n==========================","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12627695","id":"12627695","filename":"yarn-1677.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=d.yuan","name":"d.yuan","key":"d.yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Yuan","active":true,"timeZone":"Etc/UTC"},"created":"2014-02-07T20:36:55.131+0000","size":14448,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12627695/yarn-1677.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"371164","customfield_12312823":null,"summary":"Potential bugs in exception handlers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=d.yuan","name":"d.yuan","key":"d.yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Yuan","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=d.yuan","name":"d.yuan","key":"d.yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Yuan","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692264/comment/13895001","id":"13895001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=d.yuan","name":"d.yuan","key":"d.yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Yuan","active":true,"timeZone":"Etc/UTC"},"body":"For what it is worth, I am attaching a first attempt to patch these. Feedbacks are much appreciated!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=d.yuan","name":"d.yuan","key":"d.yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Yuan","active":true,"timeZone":"Etc/UTC"},"created":"2014-02-07T20:39:08.121+0000","updated":"2014-02-07T20:39:08.121+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692264/comment/13900332","id":"13900332","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=d.yuan","name":"d.yuan","key":"d.yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Yuan","active":true,"timeZone":"Etc/UTC"},"body":"Hi, is there anything else I could help for these cases?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=d.yuan","name":"d.yuan","key":"d.yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Yuan","active":true,"timeZone":"Etc/UTC"},"created":"2014-02-13T13:34:07.151+0000","updated":"2014-02-13T13:34:07.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692264/comment/13965253","id":"13965253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=d.yuan","name":"d.yuan","key":"d.yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Yuan","active":true,"timeZone":"Etc/UTC"},"body":"Ping. Is there anything else I can help from my side?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=d.yuan","name":"d.yuan","key":"d.yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ding Yuan","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-10T11:47:19.119+0000","updated":"2014-04-10T11:47:19.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692264/comment/13965555","id":"13965555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj.k","name":"devaraj.k","key":"devaraj.k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj K","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Ding for taking up these, Appreciate your work.\n\nCould you split these into multiple Jira's instead of grouping into single Jira. \nAnd also can you add the tests for the changes, please refer http://wiki.apache.org/hadoop/HowToContribute#Making_Changes.\n\nAfter attaching the patch for the issue, please click on the 'Submit Patch' button so that Jenkins can run the patch and also any one can review it.  \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj.k","name":"devaraj.k","key":"devaraj.k","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj K","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-10T17:15:29.181+0000","updated":"2014-04-10T17:15:29.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692264/comment/14524043","id":"14524043","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jianhe","name":"jianhe","key":"jianhe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian He","active":true,"timeZone":"America/Los_Angeles"},"body":"much of the code changed a log. Not able to locate these problems by line number. [~d.yuan], mind checking if these problems still valid ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jianhe","name":"jianhe","key":"jianhe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian He","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-01T21:53:10.535+0000","updated":"2015-05-01T21:53:10.535+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-1677/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1rwzr:"}}