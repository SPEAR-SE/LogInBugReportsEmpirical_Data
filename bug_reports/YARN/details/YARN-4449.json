{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12921431","self":"https://issues.apache.org/jira/rest/api/2/issue/12921431","key":"YARN-4449","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2015-12-12 22:37:56.182","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4449/watchers","watchCount":6,"isWatching":false},"created":"2015-12-12T22:37:56.182+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325256","id":"12325256","description":"2.3.0 release","name":"2.3.0","archived":false,"released":true,"releaseDate":"2014-02-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-12-12T22:38:43.060+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319322","id":"12319322","name":"resourcemanager"}],"timeoriginalestimate":null,"description":"Occasionally, and apparently only when more than one YARN task is running at once, a ResourceManager may return a container that was reserved for the AM launch, which is smaller than the requested container size for a task.\n\nWe observed this as a failure, task killed due to over-memory use.  When investigating, we found the following had happened:\n•\tClient requests AM launch with 1024MB memory \n•\tRM reserves a container _000001 with 1024MB memory\n•\tRM allocates container _000002 with 1024MB memory and launches the AM in that\n•\tWhen the AM starts requesting task containers with 2048MB memory, the reserved _000001 is still there, and the scheduler returns it, because that’s what reserved containers are for.  However it doesn’t check that the reserved container has as much memory as being requested presently.\n\nThis seems to be a timing problem and occurs erratically.  Sorry I could not try this on a newer cluster because it is so hard to reproduce.  However, you can see in our AM's log where it asks for 2000MB and gets 1024MB:\n\n2015-12-09 02:41:10 INFO net.redpoint.yarnapp.ApplicationMaster: TaskLauncher.run: ** STARTING CONTAINER **\n  task = Task['([...] containerRequest=Capability[<memory:2000, vCores:0>]Priority[0], container=container_1446677679275_0312_01_000001, state=new, result=null, diagnostics='null', retries=0]\n  container = Container: [ContainerId: container_1446677679275_0312_01_000001, NodeId: rpb-cdh-kerb-2.office.datalever.com:8041, NodeHttpAddress: rpb-cdh-kerb-2.office.datalever.com:8042, Resource: <memory:1024, vCores:1>, Priority: 0, Token: Token { kind: ContainerToken, service: 192.168.58.41:8041 }, ]\n\nThis is probably more clear in the attached snippet of RM log, where you can see this happening with appid 312 (ignore 311 which is also in there).  You can see that the RM reserves one container, launches the AM in a second, then later returns the reserved container in response to a task container request of 2000MB, so it comes up short.\n\nThis is relatively easy to work around (just reject that container and wait for another) which is why this is minor importance.  But it seems that YARN should give you the memory you requested, and it doesn't in this case.  Perhaps this \"as designed\", but it is certainly unexpected.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12777310","id":"12777310","filename":"app312_rm.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.lilley%40redpoint.net","name":"john.lilley@redpoint.net","key":"john.lilley@redpoint.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"john lilley","active":true,"timeZone":"America/Denver"},"created":"2015-12-12T22:38:43.056+0000","size":67515,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12777310/app312_rm.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ResourceManager can return task container with less than requested memory","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.lilley%40redpoint.net","name":"john.lilley@redpoint.net","key":"john.lilley@redpoint.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"john lilley","active":true,"timeZone":"America/Denver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.lilley%40redpoint.net","name":"john.lilley@redpoint.net","key":"john.lilley@redpoint.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"john lilley","active":true,"timeZone":"America/Denver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Cloudera CDH 5.4.5","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4449/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ptgf:"}}