{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13119585","self":"https://issues.apache.org/jira/rest/api/2/issue/13119585","key":"YARN-7535","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-11-26T21:46:48.513+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Dec 08 06:41:12 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-7535/watchers","watchCount":6,"isWatching":false},"created":"2017-11-20T08:57:21.500+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wilfreds","name":"wilfreds","key":"wilfreds","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wilfred Spiegelenburg","active":true,"timeZone":"Australia/Sydney"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-12-20T11:41:39.205+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319325","id":"12319325","name":"scheduler"}],"timeoriginalestimate":null,"description":"The value of *demand* of leaf queue that we now view on the fair scheduler page shows only the value of *maxResources* when the demand value is greater than *maxResources*. It doesn't reflect the real situation. Most of the time, when we expand the queue, we often rely on seeing the current demand real value.\r\n\r\n{code:java}\r\nprivate void updateDemandForApp(FSAppAttempt sched, Resource maxRes) {\r\n    sched.updateDemand();\r\n    Resource toAdd = sched.getDemand();\r\n    if (LOG.isDebugEnabled()) {\r\n      LOG.debug(\"Counting resource from \" + sched.getName() + \" \" + toAdd\r\n          + \"; Total resource consumption for \" + getName() + \" now \"\r\n          + demand);\r\n    }\r\n    demand = Resources.add(demand, toAdd);\r\n    demand = Resources.componentwiseMin(demand, maxRes);\r\n  }\r\n{code}\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"We should display origin value of demand in fair scheduler page","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daemon","name":"daemon","key":"daemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"YunFan Zhou","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daemon","name":"daemon","key":"daemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"YunFan Zhou","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13119585/comment/16266004","id":"16266004","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daemon","name":"daemon","key":"daemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"YunFan Zhou","active":true,"timeZone":"Etc/UTC"},"body":"Hi, [~yufeigu] [~templedf]\r\n\r\nI'm sorry to bother you, but recently I was wondering why the demand of the queue cannot exceed *maxResources*. Is it a scheduling optimization need or a semantic consideration?\r\n\r\nIf it is a scheduling optimization requirement, I think it is necessary to show the real value when the *demand *value of the queue is displayed on the web page.\r\n\r\nIf it's a semantic consideration, can you give me a place where you can find the exact definition?\r\n\r\nThanks!\r\n\r\nYunFan Zhou","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daemon","name":"daemon","key":"daemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"YunFan Zhou","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-26T13:45:32.781+0000","updated":"2017-11-26T13:45:32.781+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13119585/comment/16266206","id":"16266206","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"body":"Max resource is a hard limit, which means a queue can't use more resources than its max resources. Hence, demand and usage shouldn't be greater than max resources. The exiting code makes sense to me in that sense. Should we display the original demand other than normalized one? I am open to suggestions, and would like to hear more about why needs to show the original. cc [~wilfreds]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yufeigu","name":"yufeigu","key":"yufeigu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yufeigu&avatarId=31240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yufeigu&avatarId=31240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yufeigu&avatarId=31240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yufeigu&avatarId=31240"},"displayName":"Yufei Gu","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-11-26T21:46:48.513+0000","updated":"2017-11-26T21:46:48.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13119585/comment/16266313","id":"16266313","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wilfreds","name":"wilfreds","key":"wilfreds","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wilfred Spiegelenburg","active":true,"timeZone":"Australia/Sydney"},"body":"The code has changed in recent versions, there is no updateDemandForApp any more after YARN-6172.\r\n\r\nDemand for a queue as [~yufeigu] explained should be limited to the maximum the queue can use. So the existing code should be left as is. Changing the calculation would affect the minimum share starvation and some other calculations that use the demand. Having the extra detail on how high demand really is in a queue is could provide some more detail for tuning. The {{FSAppAttempt}} does not cap it so we have the info already.\r\n\r\nSome considerations:\r\n- We could store the extra detail to the {{leafQueue}}. There would not really be an overhead beside some extra local storage.\r\n- Adding it to the {{parentQueue}} to get it for the whole hierarchy would be possible but it does involve overhead. We would then also need to choose if we want the unlimited demand from the child queue or the limited version\r\n- The scheduler state dump is easily changed, \r\n- Do we want to display this in the web UI? It might be confusing to show the two numbers always and the state dump would be a much better place because it can be seen over time instead of just one instance\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wilfreds","name":"wilfreds","key":"wilfreds","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wilfred Spiegelenburg","active":true,"timeZone":"Australia/Sydney"},"created":"2017-11-27T02:36:44.332+0000","updated":"2017-11-27T02:36:44.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13119585/comment/16266597","id":"16266597","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stukid","name":"stukid","key":"stukid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"xuekang","active":true,"timeZone":"Asia/Shanghai"},"body":"I understand that a queue cannot use more resource than its max resources, but demand is not use.\r\nThe users should know how many resources their apps are requesting, and the YARN admin should know how many extra resources should be added to the queue, if the demand is always larger than the max resources. Now, when the demand is larger than the max value,  the demand value in the RM web UI  is just a limit instead of a real demand, which is unreasonable.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stukid","name":"stukid","key":"stukid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"xuekang","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-11-27T09:58:36.775+0000","updated":"2017-11-27T09:58:36.775+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13119585/comment/16266791","id":"16266791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wilfreds","name":"wilfreds","key":"wilfreds","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wilfred Spiegelenburg","active":true,"timeZone":"Australia/Sydney"},"body":"The demand for an application is not limited and is we do not stop adding up demand at any limit for an application.\r\nThis is purely about the maximum demand a queue is assigned for the purpose of scheduling. Showing a demand in a queue that is higher than what could ever be allocated in the queue also does not make sense from a scheduling perspective. I agree that it is one of the possible factors you look at from a tuning perspective.\r\n\r\nDemand should not be the one and only number to base a queue size on. An applications demand is just the requested resources for the Application Master until the application runs. When the AM is not started there is no request for any other resources beside that one AM container. There is thus no demand beside that one container. This means that the demand in a queue is of limited value for tuning the size of a queue. Non runnable applications always skew the demand number. If you run into the maximum size of a queue demand will be skewed unless all applications in all queues are running. Most likely it will give the wrong info and your tuning would be off. If you are not running into the maximum queue size and still have unsatisfied demand something else is going on. Again demand will not be the value you are tuning on in that case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wilfreds","name":"wilfreds","key":"wilfreds","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wilfred Spiegelenburg","active":true,"timeZone":"Australia/Sydney"},"created":"2017-11-27T13:20:24.715+0000","updated":"2017-11-27T13:20:24.715+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13119585/comment/16283125","id":"16283125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wilfreds","name":"wilfreds","key":"wilfreds","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wilfred Spiegelenburg","active":true,"timeZone":"Australia/Sydney"},"body":"[~daemon] if you don't mind I would like to supply a patch for this. Can I assign it to myself?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wilfreds","name":"wilfreds","key":"wilfreds","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wilfred Spiegelenburg","active":true,"timeZone":"Australia/Sydney"},"created":"2017-12-08T06:41:12.472+0000","updated":"2017-12-08T06:41:12.472+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-7535/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3mzm7:"}}