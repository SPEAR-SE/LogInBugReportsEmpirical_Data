{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12946099","self":"https://issues.apache.org/jira/rest/api/2/issue/12946099","key":"YARN-4754","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-03-02T12:51:59.481+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 24 16:35:17 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4754/watchers","watchCount":15,"isWatching":false},"created":"2016-03-02T09:28:37.207+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-10-24T16:35:26.033+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"It is observed that there are too many connections are kept opened to TimelineServer while publishing entities via SystemMetricsPublisher. This cause sometimes resource shortage for other process or RM itself\n\n{noformat}\ntcp        0      0 10.18.99.110:3999       10.18.214.60:59265      ESTABLISHED 115302/java         \ntcp        0      0 10.18.99.110:25001      :::*                    LISTEN      115302/java         \ntcp        0      0 10.18.99.110:25002      :::*                    LISTEN      115302/java         \ntcp        0      0 10.18.99.110:25003      :::*                    LISTEN      115302/java         \ntcp        0      0 10.18.99.110:25004      :::*                    LISTEN      115302/java         \ntcp        0      0 10.18.99.110:25005      :::*                    LISTEN      115302/java         \ntcp        1      0 10.18.99.110:48866      10.18.99.110:8188       CLOSE_WAIT  115302/java         \ntcp        1      0 10.18.99.110:48137      10.18.99.110:8188       CLOSE_WAIT  115302/java         \ntcp        1      0 10.18.99.110:47553      10.18.99.110:8188       CLOSE_WAIT  115302/java         \ntcp        1      0 10.18.99.110:48424      10.18.99.110:8188       CLOSE_WAIT  115302/java         \ntcp        1      0 10.18.99.110:48139      10.18.99.110:8188       CLOSE_WAIT  115302/java         \ntcp        1      0 10.18.99.110:48096      10.18.99.110:8188       CLOSE_WAIT  115302/java         \ntcp        1      0 10.18.99.110:47558      10.18.99.110:8188       CLOSE_WAIT  115302/java         \ntcp        1      0 10.18.99.110:49270      10.18.99.110:8188       CLOSE_WAIT  115302/java         \n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12790899","id":"12790899","filename":"ConnectionLeak.rar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"created":"2016-03-02T09:33:25.604+0000","size":5071,"mimeType":"application/x-rar-compressed","content":"https://issues.apache.org/jira/secure/attachment/12790899/ConnectionLeak.rar"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Too many connection opened to TimelineServer while publishing entities","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15175325","id":"15175325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"body":"As a result of above sometimes RM itself wont get resources to publish which causes entity publish fails.\nException trace-\n{noformat}\n2016-03-01 11:34:34,325 ERROR org.apache.hadoop.yarn.server.resourcemanager.metrics.SystemMetricsPublisher: Error when publishing entity [YARN_APPLICATION,application_1456545891178_0950]\ncom.sun.jersey.api.client.ClientHandlerException: java.net.SocketException: Too many open files\n\tat com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle(URLConnectionClientHandler.java:149)\n\tat org.apache.hadoop.yarn.client.api.impl.TimelineClientImpl$TimelineJerseyRetryFilter$1.run(TimelineClientImpl.java:235)\n\tat org.apache.hadoop.yarn.client.api.impl.TimelineClientImpl$TimelineClientConnectionRetry.retryOn(TimelineClientImpl.java:184)\n\tat org.apache.hadoop.yarn.client.api.impl.TimelineClientImpl$TimelineJerseyRetryFilter.handle(TimelineClientImpl.java:246)\n\tat com.sun.jersey.api.client.Client.handle(Client.java:648)\n\tat com.sun.jersey.api.client.WebResource.handle(WebResource.java:670)\n\tat com.sun.jersey.api.client.WebResource.access$200(WebResource.java:74)\n\tat com.sun.jersey.api.client.WebResource$Builder.post(WebResource.java:563)\n\tat org.apache.hadoop.yarn.client.api.impl.TimelineClientImpl.doPostingObject(TimelineClientImpl.java:481)\n\tat org.apache.hadoop.yarn.client.api.impl.TimelineClientImpl$1.run(TimelineClientImpl.java:324)\n\tat org.apache.hadoop.yarn.client.api.impl.TimelineClientImpl$1.run(TimelineClientImpl.java:321)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:422)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1711)\n\tat org.apache.hadoop.yarn.client.api.impl.TimelineClientImpl.doPosting(TimelineClientImpl.java:321)\n\tat org.apache.hadoop.yarn.client.api.impl.TimelineClientImpl.putEntities(TimelineClientImpl.java:306)\n\tat org.apache.hadoop.yarn.server.resourcemanager.metrics.SystemMetricsPublisher.putEntity(SystemMetricsPublisher.java:456)\n\tat org.apache.hadoop.yarn.server.resourcemanager.metrics.SystemMetricsPublisher.publishApplicationACLsUpdatedEvent(SystemMetricsPublisher.java:320)\n\tat org.apache.hadoop.yarn.server.resourcemanager.metrics.SystemMetricsPublisher.handleSystemMetricsEvent(SystemMetricsPublisher.java:232)\n\tat org.apache.hadoop.yarn.server.resourcemanager.metrics.SystemMetricsPublisher$ForwardingEventHandler.handle(SystemMetricsPublisher.java:473)\n\tat org.apache.hadoop.yarn.server.resourcemanager.metrics.SystemMetricsPublisher$ForwardingEventHandler.handle(SystemMetricsPublisher.java:468)\n\tat org.apache.hadoop.yarn.event.AsyncDispatcher.dispatch(AsyncDispatcher.java:189)\n\tat org.apache.hadoop.yarn.event.AsyncDispatcher$1.run(AsyncDispatcher.java:117)\n\tat java.lang.Thread.run(Thread.java:745)\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"created":"2016-03-02T09:31:01.233+0000","updated":"2016-03-02T09:31:01.233+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15175537","id":"15175537","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"body":"[~rohithsharma], is this 2.7.2 version ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-02T12:51:59.481+0000","updated":"2016-03-02T12:51:59.481+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15175690","id":"15175690","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"I think this is happening because we are not calling {{ClientResponse#close}}.\nThis should be a problem in trunk too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-02T14:42:06.159+0000","updated":"2016-03-02T14:42:06.159+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15175711","id":"15175711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"The relevant code in {{TimelineWriter#putEntities}}.\nclose will close the underlying input stream.\n\n{code}\n  public TimelinePutResponse putEntities(\n      TimelineEntity... entities) throws IOException, YarnException {\n    .....\n    ClientResponse resp = doPosting(entitiesContainer, null);\n    return resp.getEntity(TimelinePutResponse.class);   // ClientResponse object is not closed here.\n  }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-02T14:46:55.950+0000","updated":"2016-03-02T14:46:55.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15175741","id":"15175741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"Sorry, getEntity would close the connection if entity type is not Closeable. I had overlooked that part.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-02T15:00:37.506+0000","updated":"2016-03-02T15:00:37.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15175752","id":"15175752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"body":"Initially i also suspected the same and then realised that if its ClientResponse is read then the stream is closed. so not sure whats leaking the events ..\n[~rohithsharma] any other error logs while processing the events ? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Naganarasimha","name":"Naganarasimha","key":"naganarasimha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naganarasimha G R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-02T15:08:22.622+0000","updated":"2016-03-02T15:08:22.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15177306","id":"15177306","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"I still see 2 places where we are not closing ClientResponse, when we call {{putDomain}} and in {{doPosting}} if response is not 200 OK.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-03T06:17:36.951+0000","updated":"2016-03-03T06:17:36.951+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15177309","id":"15177309","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"This should be closed as per what I understand from Jersey API documentation. [~rohithsharma] can confirm if scenario is same in his case or not.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=varun_saxena","name":"varun_saxena","key":"varun_saxena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-03T06:21:07.987+0000","updated":"2016-03-03T06:21:07.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15177478","id":"15177478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"body":"As I see ATS logs, there were no exception. In RM logs, there was exception as I mentioned in first comment {{SocketException: Too many open files}}.\nI am recovering the applications once again, and will check it out for close_wait connections.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"created":"2016-03-03T08:28:21.844+0000","updated":"2016-03-03T08:28:21.844+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15177506","id":"15177506","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"body":"bq. I still see 2 places where we are not closing ClientResponse, when we call putDomain and in doPosting if response is not 200 OK.\nIt looks to be this is the case. After RM recovery completes, timeline entities are published in background. During this span of time, if there timeline sever is restarted or down for sometime, it is able to see many connections are kept CLOSE_WAIT state.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"created":"2016-03-03T08:57:44.749+0000","updated":"2016-03-03T08:57:44.749+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/15396875","id":"15396875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Ying+Zhang","name":"Ying Zhang","key":"ying zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ying+zhang&avatarId=26746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ying+zhang&avatarId=26746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ying+zhang&avatarId=26746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ying+zhang&avatarId=26746"},"displayName":"Ying Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~varun_saxena], [~rohithsharma], if I understand this correctly, is the following change enough for this?\n\n{code:title=TimelineWriter.java|borderStyle=solid}\n\n// Moving this call \"resp.getEntity(String.class)\" out of the if block of \" if (LOG.isDebugEnabled())\" \n\nprivate ClientResponse doPosting(final Object obj, final String path)\n    throws IOException, YarnException {\n ... ...\n  if (resp == null ||\n      resp.getStatusInfo().getStatusCode()\n          != ClientResponse.Status.OK.getStatusCode()) {\n     ... ...\n    if (resp != null) {\n      msg += \" HTTP error code: \" + resp.getStatus();\n      String output = resp.getEntity(String.class);\n      if (LOG.isDebugEnabled()) {\n        LOG.debug(\"HTTP error code: \" + resp.getStatus()\n            + \" Server response : \\n\" + output);\n      }\n... ...\n}\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Ying+Zhang","name":"Ying Zhang","key":"ying zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ying+zhang&avatarId=26746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ying+zhang&avatarId=26746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ying+zhang&avatarId=26746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ying+zhang&avatarId=26746"},"displayName":"Ying Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-07-28T03:53:27.128+0000","updated":"2016-07-28T03:53:27.128+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/16197704","id":"16197704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subru","name":"subru","key":"subru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=subru&avatarId=21709","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=subru&avatarId=21709","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=subru&avatarId=21709","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=subru&avatarId=21709"},"displayName":"Subru Krishnan","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rohithsharma], [~varun_saxena], [~Ying Zhang], is this still a problem? If so, are we on track for 2.9.0 (27th Oct)? Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subru","name":"subru","key":"subru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=subru&avatarId=21709","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=subru&avatarId=21709","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=subru&avatarId=21709","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=subru&avatarId=21709"},"displayName":"Subru Krishnan","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-10-09T21:12:57.297+0000","updated":"2017-10-09T21:12:57.297+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/16198251","id":"16198251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"body":"It's quite long time I stopped focusing on ATSv1, so I am unable to say does this issue still a valid or not! I need to verify once launching ATSv1 daemon! ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"created":"2017-10-10T06:38:09.798+0000","updated":"2017-10-10T06:38:09.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/16216033","id":"16216033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subru","name":"subru","key":"subru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=subru&avatarId=21709","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=subru&avatarId=21709","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=subru&avatarId=21709","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=subru&avatarId=21709"},"displayName":"Subru Krishnan","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rohithsharma], did you get a chance to check this out? Also, is this still critical now that we have ATS v2 in 2.9?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=subru","name":"subru","key":"subru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=subru&avatarId=21709","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=subru&avatarId=21709","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=subru&avatarId=21709","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=subru&avatarId=21709"},"displayName":"Subru Krishnan","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-10-23T23:24:42.883+0000","updated":"2017-10-23T23:24:42.883+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946099/comment/16217198","id":"16217198","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"body":"Apologies for not looking into this. I have not verified with ATSv1/1.5 yet. I will remove target version and keep it JIRA open as-is. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"created":"2017-10-24T16:35:17.019+0000","updated":"2017-10-24T16:35:17.019+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4754/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2u0sn:"}}