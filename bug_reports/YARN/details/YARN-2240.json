{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12724738","self":"https://issues.apache.org/jira/rest/api/2/issue/12724738","key":"YARN-2240","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2014-07-01T17:38:36.441+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Feb 10 22:43:47 UTC 2015","customfield_12310420":"402921","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_19381683293_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-02-10T22:44:00.952+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2240/watchers","watchCount":8,"isWatching":false},"created":"2014-07-01T14:55:57.692+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326262","id":"12326262","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-02-10T22:44:00.981+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"When the log aggregator is aggregating the logs, it writes the file length first. Then tries to open the log file and if it does not have permission to do that, it ends up just writing an error message to the aggregated logs.\n\nThe mismatch between the file length and the actual length here makes the aggregated logs corrupted.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"402981","customfield_12312823":null,"summary":"yarn logs can get corrupted if the aggregator does not have permissions to the log file it tries to read","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724738/comment/14049104","id":"14049104","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"[~mitdesai], this is interesting. We had seen a bunch of errors that we couldn't find the root cause for. Mind pasting the exception messages that you see on the client or the error message in the logs?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-01T17:38:36.441+0000","updated":"2014-07-01T17:38:36.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724738/comment/14050580","id":"14050580","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"body":"Aggregated Logs Comment\n\n[~vinodkv], here is the error on which it fails.\n\n{noformat}\n2014-06-10 22:06:34,940 [LogAggregationService #1922] ERROR\nlogaggregation.AggregatedLogFormat: Error aggregating log file. Log file\n:\n/grid/0/tmp/yarn-logs/application_1401475649625_135179/container_1401475649625_135179_01_000001/history.txt.appattempt_1401475649625_135179_000001/grid/0/tmp/yarn-logs/application_1401475649625_135179/container_1401475649625_135179_01_000001/history.txt.appattempt_1401475649625_135179_000001\n(Permission denied)\njava.io.FileNotFoundException:\n/grid/0/tmp/yarn-logs/application_1401475649625_135179/container_1401475649625_135179_01_000001/history.txt.appattempt_1401475649625_135179_000001\n(Permission denied)\n         at java.io.FileInputStream.open(Native Method)\n         at java.io.FileInputStream.<init>(FileInputStream.java:138)\n         at\norg.apache.hadoop.io.SecureIOUtils.forceSecureOpenForRead(SecureIOUtils.java:215)\n         at\norg.apache.hadoop.io.SecureIOUtils.openForRead(SecureIOUtils.java:204)\n         at\norg.apache.hadoop.yarn.logaggregation.AggregatedLogFormat$LogValue.write(AggregatedLogFormat.java:196)\n         at\norg.apache.hadoop.yarn.logaggregation.AggregatedLogFormat$LogWriter.append(AggregatedLogFormat.java:311)\n         at\norg.apache.hadoop.yarn.server.nodemanager.containermanager.logaggregation.AppLogAggregatorImpl.uploadLogsForContainer(AppLogAggregatorImpl.java:130)\n         at\norg.apache.hadoop.yarn.server.nodemanager.containermanager.logaggregation.AppLogAggregatorImpl.doAppLogAggregation(AppLogAggregatorImpl.java:166)\n         at\norg.apache.hadoop.yarn.server.nodemanager.containermanager.logaggregation.AppLogAggregatorImpl.run(AppLogAggregatorImpl.java:140)\n         at\norg.apache.hadoop.yarn.server.nodemanager.containermanager.logaggregation.LogAggregationService$2.run(LogAggregationService.java:354)\n         at\njava.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n         at\njava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n         at java.lang.Thread.run(Thread.java:722)\n{noformat}\n\n\nI managed to get into the logs and found that the length for the logs it was reporting was 111K and the corrupted aggregated would read something like this.\nThe portion of the aggregated logs where there is the problem is here.\n{noformat}\n[...]\nLogType: history.txt.appattempt_1401475649625_135179_000001\nLogLength: 111686\nLog Contents:\nError aggregating log file. Log file :\n/grid/0/tmp/yarn-logs/application_1401475649625_135179/container_1401475649625_135179_01_000001/history.txt.appattempt_1401475649625_135179_000001/grid/0/tmp/yarn-logs/application_1401475649625_135179/container_1401475649625_135179_01_000001/history.txt.appattempt_1401475649625_135179_000001\n(Permission\ndenied)\u0006stderr\u00010!stderr_dag_1401475649625_135179_1\u00010&stderr_dag_1401475649625_135179_1_post\u00010\u0006stdout\u00010!stdout_dag_1401475649625_135179_1\u00010&stdout_dag_1401475649625_135179_1_post\u00010\u0006syslog102042014-06-10\n22:05:58,519 INFO [main] org.apache.tez.dag.app.DAGAppMaster: Created\nDAGAppMaster for application appattempt_1401475649625_135179_000001\n[...]\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-02T19:12:45.839+0000","updated":"2014-07-02T19:12:45.839+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724738/comment/14315102","id":"14315102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Is this a dup of YARN-2724?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2015-02-10T22:38:09.759+0000","updated":"2015-02-10T22:38:09.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12724738/comment/14315111","id":"14315111","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for pointing that out [~jlowe]. Closing this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mitdesai","name":"mitdesai","key":"mitdesai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Mit Desai","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-10T22:43:47.180+0000","updated":"2015-02-10T22:43:47.180+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2240/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1xclb:"}}