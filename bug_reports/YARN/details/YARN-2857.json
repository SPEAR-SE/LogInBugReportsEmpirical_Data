{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12750458","self":"https://issues.apache.org/jira/rest/api/2/issue/12750458","key":"YARN-2857","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327585","id":"12327585","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-10-24T22:05:37.448+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Nov 15 15:28:04 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"10002_*:*_2_*:*_569288091_*|*_1_*:*_2_*:*_1245226542_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-11-14T20:49:46.542+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2857/watchers","watchCount":8,"isWatching":false},"created":"2014-10-24T20:47:51.961+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-10T20:10:12.945+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Context:\n\n* Hadoop-2.3.0\n* Using Oozie 4.0.1\n* Pig version 0.11.x\n\nThe job is submitted by Oozie to launch Pig script.\n\n\nThe following exception traces were found on MR task log:\n\nIn syslog:\n{noformat}\n2014-10-24 20:37:29,317 WARN [Thread-5] org.apache.hadoop.util.ShutdownHookManager: ShutdownHook '' failed, java.util.ConcurrentModificationException\njava.util.ConcurrentModificationException\n\tat java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:966)\n\tat java.util.LinkedList$ListItr.next(LinkedList.java:888)\n\tat org.apache.hadoop.yarn.ContainerLogAppender.close(ContainerLogAppender.java:94)\n\tat org.apache.log4j.helpers.AppenderAttachableImpl.removeAllAppenders(AppenderAttachableImpl.java:141)\n\tat org.apache.log4j.Category.removeAllAppenders(Category.java:891)\n\tat org.apache.log4j.Hierarchy.shutdown(Hierarchy.java:471)\n\tat org.apache.log4j.LogManager.shutdown(LogManager.java:267)\n\tat org.apache.hadoop.mapred.TaskLog.syncLogsShutdown(TaskLog.java:286)\n\tat org.apache.hadoop.mapred.TaskLog$2.run(TaskLog.java:339)\n\tat org.apache.hadoop.util.ShutdownHookManager$1.run(ShutdownHookManager.java:54)\n2014-10-24 20:37:29,395 INFO [main] org.apache.hadoop.metrics2.impl.MetricsSystemImpl: Stopping MapTask metrics system...\n{noformat}\n\nin stderr:\n{noformat}\njava.util.ConcurrentModificationException\n\tat java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:966)\n\tat java.util.LinkedList$ListItr.next(LinkedList.java:888)\n\tat org.apache.hadoop.yarn.ContainerLogAppender.close(ContainerLogAppender.java:94)\n\tat org.apache.log4j.helpers.AppenderAttachableImpl.removeAllAppenders(AppenderAttachableImpl.java:141)\n\tat org.apache.log4j.Category.removeAllAppenders(Category.java:891)\n\tat org.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:759)\n\tat org.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:648)\n\tat org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:514)\n\tat org.apache.log4j.PropertyConfigurator.configure(PropertyConfigurator.java:440)\n\tat org.apache.pig.Main.configureLog4J(Main.java:740)\n\tat org.apache.pig.Main.run(Main.java:384)\n\tat org.apache.pig.PigRunner.run(PigRunner.java:49)\n\tat org.apache.oozie.action.hadoop.PigMain.runPigJob(PigMain.java:283)\n\tat org.apache.oozie.action.hadoop.PigMain.run(PigMain.java:223)\n\tat org.apache.oozie.action.hadoop.LauncherMain.run(LauncherMain.java:37)\n\tat org.apache.oozie.action.hadoop.PigMain.main(PigMain.java:76)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:483)\n\tat org.apache.oozie.action.hadoop.LauncherMapper.map(LauncherMapper.java:226)\n\tat org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)\n\tat org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:430)\n\tat org.apache.hadoop.mapred.MapTask.run(MapTask.java:342)\n\tat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:167)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:422)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1548)\n\tat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:162)\n{noformat}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327585","id":"12327585","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12677663","id":"12677663","filename":"ContainerLogAppender.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-28T19:06:09.629+0000","size":5036,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12677663/ContainerLogAppender.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12679992","id":"12679992","filename":"MAPREDUCE-6139.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-06T23:24:19.114+0000","size":1118,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12679992/MAPREDUCE-6139.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12680342","id":"12680342","filename":"MAPREDUCE-6139.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-08T01:08:52.891+0000","size":1462,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12680342/MAPREDUCE-6139.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12680864","id":"12680864","filename":"MAPREDUCE-6139.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-11T20:05:46.871+0000","size":1338,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12680864/MAPREDUCE-6139.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12681144","id":"12681144","filename":"MAPREDUCE-6139-test.01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-12T21:27:04.045+0000","size":2180,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12681144/MAPREDUCE-6139-test.01.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12681381","id":"12681381","filename":"YARN-2857.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-13T19:19:15.452+0000","size":3520,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12681381/YARN-2857.3.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ConcurrentModificationException in ContainerLogAppender","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14183496","id":"14183496","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"I did some investigation/debugging and found the problem happened when ContainerLogAppender.close() is iterating, the ContainerLogAppender.append() was executing by other thread. So append() add an entry and then close() found the ConcurrentModificationException. \n\nThe main question is : append() is a synchronized method and close() is within synchronized block. The question is : how it is possible to execute both such synchronized methods at the same time. Am I missing something?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-24T21:10:55.257+0000","updated":"2014-10-24T21:10:55.257+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14183612","id":"14183612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kamrul], the line doesn't seem to match up with the 2.3.0 source. ContainerLogAppender.close() is l.79-86 in 2.3.0, but your stack trace indicates the exception occurs on line 94. Are there private changes to it? Could you share the source in its entirety?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-24T22:05:37.448+0000","updated":"2014-10-24T22:05:37.448+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14183679","id":"14183679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~sjlee0] for quick answer and catching the missing piece.\n\nYes. this is coming from my debugged code.\n\nThe stack trace coming from the original code ran few days earlier:\nin syslog\n{noformat}\n2014-10-10 01:46:53,188 WARN [main] org.apache.hadoop.util.ShutdownHookManager: ShutdownHook '' failed, java.util.ConcurrentModificationException\njava.util.ConcurrentModificationException\nat java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:966)\nat java.util.LinkedList$ListItr.next(LinkedList.java:888)\nat org.apache.hadoop.yarn.ContainerLogAppender.close(ContainerLogAppender.java:81)\nat org.apache.log4j.helpers.AppenderAttachableImpl.removeAllAppenders(AppenderAttachableImpl.java:141)\nat org.apache.log4j.Category.removeAllAppenders(Category.java:891)\nat org.apache.log4j.Hierarchy.shutdown(Hierarchy.java:471)\nat org.apache.log4j.LogManager.shutdown(LogManager.java:267)\nat org.apache.hadoop.mapred.TaskLog.syncLogsShutdown(TaskLog.java:286)\nat org.apache.hadoop.mapred.TaskLog$2.run(TaskLog.java:339)\nat org.apache.hadoop.util.ShutdownHookManager$1.run(ShutdownHookManager.java:54)\n{noformat}\n\nin stderr\n{noformat}\njava.util.ConcurrentModificationException\nat java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:966)\nat java.util.LinkedList$ListItr.next(LinkedList.java:888)\nat org.apache.hadoop.yarn.ContainerLogAppender.close(ContainerLogAppender.java:81)\nat org.apache.log4j.helpers.AppenderAttachableImpl.removeAllAppenders(AppenderAttachableImpl.java:141)\nat org.apache.log4j.Category.removeAllAppenders(Category.java:891)\nat org.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:759)\nat org.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:648)\nat org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:514)\nat org.apache.log4j.PropertyConfigurator.configure(PropertyConfigurator.java:440)\nat org.apache.pig.Main.configureLog4J(Main.java:740)\nat org.apache.pig.Main.run(Main.java:384)\nat org.apache.pig.PigRunner.run(PigRunner.java:49)\nat org.apache.oozie.action.hadoop.PigMain.runPigJob(PigMain.java:283)\nat org.apache.oozie.action.hadoop.PigMain.run(PigMain.java:223)\nat org.apache.oozie.action.hadoop.LauncherMain.run(LauncherMain.java:37)\nat org.apache.oozie.action.hadoop.PigMain.main(PigMain.java:76)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:483)\nat org.apache.oozie.action.hadoop.LauncherMapper.map(LauncherMapper.java:226)\nat org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)\nat org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:430)\nat org.apache.hadoop.mapred.MapTask.run(MapTask.java:342)\nat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:167)\nat java.security.AccessController.doPrivileged(Native Method)\nat javax.security.auth.Subject.doAs(Subject.java:422)\nat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1548)\nat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:162)\n{noformat}\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-24T22:53:21.513+0000","updated":"2014-10-24T22:53:21.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14187298","id":"14187298","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Updates:\nI added more debugging to find out how close() call is invoking append() call in the same thread. I dump the call stacktrace for this scenarios. Btw, the is the root cause of ConcurrentModificationException.\n\nCase 1: When running with Pig + Oozie. Please note close() is calling append() which modifies the Queue.\n\n{noformat}\nApache Pig version 0.11.1-li0 (rexported) \ncompiled Jan 27 2014, 14:16:26\n\nRun pig script using PigRunner.run() for Pig version 0.8+\nContainerLogAppender.close() STARTED tail.size() :1 Size :36 object org.apache.hadoop.yarn.ContainerLogAppender@458ad742\nIn close() :java.lang.Thread.getStackTrace(Thread.java:1552)\norg.apache.hadoop.yarn.ContainerLogAppender.close(ContainerLogAppender.java:108)\norg.apache.log4j.helpers.AppenderAttachableImpl.removeAllAppenders(AppenderAttachableImpl.java:141)\norg.apache.log4j.Category.removeAllAppenders(Category.java:891)\norg.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:759)\norg.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:648)\norg.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:514)\norg.apache.log4j.PropertyConfigurator.configure(PropertyConfigurator.java:440)\norg.apache.pig.Main.configureLog4J(Main.java:740)\norg.apache.pig.Main.run(Main.java:384)\norg.apache.pig.PigRunner.run(PigRunner.java:49)\norg.apache.oozie.action.hadoop.PigMain.runPigJob(PigMain.java:283)\norg.apache.oozie.action.hadoop.PigMain.run(PigMain.java:223)\norg.apache.oozie.action.hadoop.LauncherMain.run(LauncherMain.java:37)\norg.apache.oozie.action.hadoop.PigMain.main(PigMain.java:76)\nsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\njava.lang.reflect.Method.invoke(Method.java:483)\norg.apache.oozie.action.hadoop.LauncherMapper.map(LauncherMapper.java:226)\norg.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)\norg.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:430)\norg.apache.hadoop.mapred.MapTask.run(MapTask.java:342)\norg.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:167)\njava.security.AccessController.doPrivileged(Native Method)\njavax.security.auth.Subject.doAs(Subject.java:422)\norg.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1548)\norg.apache.hadoop.mapred.YarnChild.main(YarnChild.java:162)\n\nContainerLogAppender.append() STARTED main tail.size() :36 object org.apache.hadoop.yarn.ContainerLogAppender@458ad742\nIn append() :java.lang.Thread.getStackTrace(Thread.java:1552)\norg.apache.hadoop.yarn.ContainerLogAppender.append(ContainerLogAppender.java:75)\norg.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:251)\norg.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:66)\norg.apache.log4j.Category.callAppenders(Category.java:206)\norg.apache.log4j.Category.forcedLog(Category.java:391)\norg.apache.log4j.Category.log(Category.java:856)\norg.apache.commons.logging.impl.Log4JLogger.warn(Log4JLogger.java:197)\norg.apache.hadoop.security.token.Token.getClassForIdentifier(Token.java:118)\norg.apache.hadoop.security.token.Token.decodeIdentifier(Token.java:132)\norg.apache.hadoop.security.token.Token.identifierToString(Token.java:314)\norg.apache.hadoop.security.token.Token.toString(Token.java:334)\norg.apache.log4j.or.DefaultRenderer.doRender(DefaultRenderer.java:37)\norg.apache.log4j.or.RendererMap.findAndRender(RendererMap.java:80)\norg.apache.log4j.spi.LoggingEvent.getRenderedMessage(LoggingEvent.java:368)\norg.apache.log4j.helpers.PatternParser$BasicPatternConverter.convert(PatternParser.java:402)\norg.apache.log4j.helpers.PatternConverter.format(PatternConverter.java:65)\norg.apache.log4j.PatternLayout.format(PatternLayout.java:506)\norg.apache.log4j.WriterAppender.subAppend(WriterAppender.java:310)\norg.apache.log4j.WriterAppender.append(WriterAppender.java:162)\norg.apache.hadoop.yarn.ContainerLogAppender.close(ContainerLogAppender.java:117)\norg.apache.log4j.helpers.AppenderAttachableImpl.removeAllAppenders(AppenderAttachableImpl.java:141)\norg.apache.log4j.Category.removeAllAppenders(Category.java:891)\norg.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:759)\norg.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:648)\norg.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:514)\norg.apache.log4j.PropertyConfigurator.configure(PropertyConfigurator.java:440)\norg.apache.pig.Main.configureLog4J(Main.java:740)\norg.apache.pig.Main.run(Main.java:384)\norg.apache.pig.PigRunner.run(PigRunner.java:49)\norg.apache.oozie.action.hadoop.PigMain.runPigJob(PigMain.java:283)\norg.apache.oozie.action.hadoop.PigMain.run(PigMain.java:223)\norg.apache.oozie.action.hadoop.LauncherMain.run(LauncherMain.java:37)\norg.apache.oozie.action.hadoop.PigMain.main(PigMain.java:76)\nsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\njava.lang.reflect.Method.invoke(Method.java:483)\norg.apache.oozie.action.hadoop.LauncherMapper.map(LauncherMapper.java:226)\norg.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)\norg.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:430)\norg.apache.hadoop.mapred.MapTask.run(MapTask.java:342)\norg.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:167)\njava.security.AccessController.doPrivileged(Native Method)\njavax.security.auth.Subject.doAs(Subject.java:422)\norg.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1548)\norg.apache.hadoop.mapred.YarnChild.main(YarnChild.java:162)\n\n52428 :ContainerLogAppender.append() ENDED main thr id :1 tail.size() :37 object org.apache.hadoop.yarn.ContainerLogAppender@458ad742\n Exception occurred in close() java.util.ConcurrentModificationException\nContainerLogAppender.close() ENDED tail.size() :37 object org.apache.hadoop.yarn.ContainerLogAppender@458ad742\n{noformat}\n\nCase 2: When running with any MR job + Oozie. Please note close() is calling append() which modifies the Queue.\n{noformat}\n52428 :ContainerLogAppender.append() ENDED main thr id :1 tail.size() :55 object org.apache.hadoop.yarn.ContainerLogAppender@327471b5\nContainerLogAppender.close() STARTED tail.size() :25 Size :55 object org.apache.hadoop.yarn.ContainerLogAppender@327471b5\nIn close() :java.lang.Thread.getStackTrace(Thread.java:1552)\norg.apache.hadoop.yarn.ContainerLogAppender.close(ContainerLogAppender.java:108)\norg.apache.log4j.helpers.AppenderAttachableImpl.removeAllAppenders(AppenderAttachableImpl.java:141)\norg.apache.log4j.Category.removeAllAppenders(Category.java:891)\norg.apache.log4j.Hierarchy.shutdown(Hierarchy.java:471)\norg.apache.log4j.LogManager.shutdown(LogManager.java:267)\norg.apache.hadoop.mapred.TaskLog.syncLogsShutdown(TaskLog.java:286)\norg.apache.hadoop.mapred.TaskLog$2.run(TaskLog.java:339)\norg.apache.hadoop.util.ShutdownHookManager$1.run(ShutdownHookManager.java:54)\n\nContainerLogAppender.append() STARTED Thread-5 tail.size() :55 object org.apache.hadoop.yarn.ContainerLogAppender@327471b5\nIn append() :java.lang.Thread.getStackTrace(Thread.java:1552)\norg.apache.hadoop.yarn.ContainerLogAppender.append(ContainerLogAppender.java:75)\norg.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:251)\norg.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:66)\norg.apache.log4j.Category.callAppenders(Category.java:206)\norg.apache.log4j.Category.forcedLog(Category.java:391)\norg.apache.log4j.Category.log(Category.java:856)\norg.apache.commons.logging.impl.Log4JLogger.warn(Log4JLogger.java:197)\norg.apache.hadoop.security.token.Token.getClassForIdentifier(Token.java:118)\norg.apache.hadoop.security.token.Token.decodeIdentifier(Token.java:132)\norg.apache.hadoop.security.token.Token.identifierToString(Token.java:314)\norg.apache.hadoop.security.token.Token.toString(Token.java:334)\norg.apache.log4j.or.DefaultRenderer.doRender(DefaultRenderer.java:37)\norg.apache.log4j.or.RendererMap.findAndRender(RendererMap.java:80)\norg.apache.log4j.spi.LoggingEvent.getRenderedMessage(LoggingEvent.java:368)\norg.apache.log4j.helpers.PatternParser$BasicPatternConverter.convert(PatternParser.java:402)\norg.apache.log4j.helpers.PatternConverter.format(PatternConverter.java:65)\norg.apache.log4j.PatternLayout.format(PatternLayout.java:506)\norg.apache.log4j.WriterAppender.subAppend(WriterAppender.java:310)\norg.apache.log4j.WriterAppender.append(WriterAppender.java:162)\norg.apache.hadoop.yarn.ContainerLogAppender.close(ContainerLogAppender.java:117)\norg.apache.log4j.helpers.AppenderAttachableImpl.removeAllAppenders(AppenderAttachableImpl.java:141)\norg.apache.log4j.Category.removeAllAppenders(Category.java:891)\norg.apache.log4j.Hierarchy.shutdown(Hierarchy.java:471)\norg.apache.log4j.LogManager.shutdown(LogManager.java:267)\norg.apache.hadoop.mapred.TaskLog.syncLogsShutdown(TaskLog.java:286)\norg.apache.hadoop.mapred.TaskLog$2.run(TaskLog.java:339)\norg.apache.hadoop.util.ShutdownHookManager$1.run(ShutdownHookManager.java:54)\n\n52428 :ContainerLogAppender.append() ENDED Thread-5 thr id :25 tail.size() :56 object org.apache.hadoop.yarn.ContainerLogAppender@327471b5\n Exception occurred in close() java.util.ConcurrentModificationException\nContainerLogAppender.close() ENDED tail.size() :56 object org.apache.hadoop.yarn.ContainerLogAppender@327471b5\n\n{noformat}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-28T19:02:58.209+0000","updated":"2014-10-28T19:02:58.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14187304","id":"14187304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Forget to add the modified source code  ContainerLogAppender.java. Please see the attach file to understand the stack trace.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-28T19:06:09.637+0000","updated":"2014-10-28T19:06:09.637+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14187311","id":"14187311","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"\nWhy does  the close() call the super.append()? I think it should call super.close() instead?\n{noformat}\nfor (LoggingEvent event : tail) {\n            super.append(event);\n}\n{noformat}\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-28T19:09:19.548+0000","updated":"2014-10-28T19:09:19.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14187472","id":"14187472","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"I think that call is there by design. The tail queue is an internal buffer and that code is trying to write out the buffered log events. You'll also see super.close() right below this for loop.\n\nI think this is triggering the exception (not that it is the cause but that it triggers the problem):\n\n{noformat}\norg.apache.commons.logging.impl.Log4JLogger.warn(Log4JLogger.java:197)\norg.apache.hadoop.security.token.Token.getClassForIdentifier(Token.java:118)\n{noformat}\n\nI haven't thought much about this, but perhaps another way to solve this is to modify append() not to use the tail queue if it is in the middle of a shutdown.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-28T21:11:29.836+0000","updated":"2014-10-28T21:11:29.836+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14187550","id":"14187550","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~sjlee0] for the reply.\n\nI agree with your suggestion and already started the testing process by blocking append() when it is called from close().\nNot sure if it is the cleaner approach.\nI will update with my testing result.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-28T21:59:21.913+0000","updated":"2014-10-28T21:59:21.913+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14187723","id":"14187723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"Just off the top of my head, how about an approach where if the close() (or shutdown) is in progress append() would simply call super.append() instead of playing with the tail queue? Perhaps a boolean flag to indicate that a shutdown is progress...\n\nThat might be better than blocking (?) append().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-28T23:40:02.387+0000","updated":"2014-10-28T23:40:02.387+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14187810","id":"14187810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Wandering if it will create recursive call. Because, in this case, super.append() is ultimately calling this append(). ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-29T00:43:00.908+0000","updated":"2014-10-29T00:43:00.908+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14187818","id":"14187818","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Forgot to add, in append(), super.append() is called only once when tail is null.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-29T00:45:34.991+0000","updated":"2014-10-29T00:45:34.991+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14189172","id":"14189172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"Good point... What would be your proposal? Do you have a patch that would illustrate your approach?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-29T22:36:07.287+0000","updated":"2014-10-29T22:36:07.287+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14197178","id":"14197178","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~kamrul], thanks for reporting the issue.\n\nThis occurs when there mapreduce.task.userlog.limit.kb > 0. I recommend not to use the original log limit implementation as it has other serious problems such as the potential to lose the valuable diagnostic information in the tail and a long delay until one can see the log to begin with. MAPREDUCE-5672 provided an alternative based on RollingFileAppender that does not have these problems which I recommend to start using.\n\nComing back to the problem in this scenario. One of the pending events in the Queue generated a new warn LogEvent via Token.toString and modified the tail queue while the iterator is still in progress in the {{close}} stack frame. I would fix this as follows: \nintroduce instance boolean variable {{closed}} and set it to {{true}} immediately when {{close}} is invoked. Then we can make CLA's {{append}} a nop when {{closed}} is {{true}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T00:03:16.775+0000","updated":"2014-11-05T00:03:16.775+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14201187","id":"14201187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~sjlee0] and [~jira.shegalov] for the active participation.\n\nI was considering a little different approach that patch I upload in this JIRA. Can you please review it?\n\nBasically, instead of using the iterator based access , I'm using index based. Therefore using LinkedList.\n\nI did some basic testing. As soon as, I get more support, I will do the full testing.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-06T23:23:06.820+0000","updated":"2014-11-06T23:23:06.820+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14201208","id":"14201208","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kamrul], I disagree with this approach for the following reasons:\n1. it does not address the root cause, the CLA appender is never closed and keeps accepting appends although it won't be able to get rid of them. \n2. LinkedList is not a random access data structure. Every time you call {{get}} you end up scanning half of the list on average","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-06T23:34:55.775+0000","updated":"2014-11-06T23:34:55.775+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14201360","id":"14201360","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~jira.shegalov] for you comments.\nMy comments inline\n> 1. it does not address the root cause, the CLA appender is never closed and keeps accepting appends although it won't be able to get rid of them.\n\nI think it will  ultimately be able to close all. Because the same list structure is being appended and close is accessing to those new entries as well. In my testing, I found a case, where close() started with 36 entries in the list and ended up with 38 entries to dealt with. The extra 2 was appended by indirect call from super,append() in the close() method. In other words, list size is increasing at the end and close() will ultimately append them.\n\n> 2. LinkedList is not a random access data structure. Every time you call get you end up scanning half of the list on average\n\nAgree with this comment. ArrayList or some other similar data structure could help in this regard.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T01:15:13.919+0000","updated":"2014-11-07T01:15:13.919+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14201810","id":"14201810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"IMHO this complexity is not necessary or even correct just to be able to deal with accidental logging activity occurring when CLA.close is already in progress.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T08:56:44.745+0000","updated":"2014-11-07T08:56:44.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14202507","id":"14202507","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks again [~jira.shegalov] for your quick and informative comment.\n\nActually I tried the both options : 1. List based 2. using closed variable. Both indeed work. If you think the \"closed\" variable based approach is better I would go with that option. As soon as you reconfirm this, I will post a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T19:24:56.106+0000","updated":"2014-11-07T19:24:56.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14202537","id":"14202537","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kamrul], my comments are non-binding. But yes my preference is for Option 2 based on \"boolean closed\". ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T19:45:17.857+0000","updated":"2014-11-07T19:45:17.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14202855","id":"14202855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~jira.shegalov]. I plan to update the patch soon with option 2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T22:38:14.491+0000","updated":"2014-11-07T22:38:14.491+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14203079","id":"14203079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch based on option 2 that we discussed. I performed a basic testing. planning to do a cluster level testing once I get +ve feedback.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-08T01:08:52.897+0000","updated":"2014-11-08T01:08:52.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14203121","id":"14203121","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12680342/MAPREDUCE-6139.2.patch\n  against trunk revision 4a114dd.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5000//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5000//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-08T01:47:24.249+0000","updated":"2014-11-08T01:47:24.249+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14203289","id":"14203289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the patch [~kamrul]. \n\nReopening CLA violates the javadoc  for [Appender#close|https://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/Appender.html#close()]\n\n1. Let us move \n{code}closing = true;{code} before {code}if (tail != null){code}\n\n2. undo the change try/finally\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-08T07:38:33.610+0000","updated":"2014-11-08T07:38:33.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14206964","id":"14206964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch uploaded addressing review comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-11T20:05:46.881+0000","updated":"2014-11-11T20:05:46.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14207018","id":"14207018","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12680864/MAPREDUCE-6139.3.patch\n  against trunk revision 061bc29.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5007//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5007//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-11T20:42:48.322+0000","updated":"2014-11-11T20:42:48.322+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14207432","id":"14207432","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"LGTM. Just a small nit: I think it's the standard style to have a space between \"//\" and the comment that follows it. It would be good if you could touch up that line in append().\n\n[~jira.shegalov]?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-12T00:45:50.006+0000","updated":"2014-11-12T00:45:50.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14207777","id":"14207777","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kamrul], MAPREDUCE-6139.3.patch looks good to me as well. \nI should have suggested this earlier but could you write a unit test for this bug? \n\nYou can create a test with the logic similar to {{o.a.h.mapred.TestTaskLogAppender}} as something like {{o.a.h.yarn.TestContainerLogAppender}}.\n./hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn. Add tesContainerLogAppenderWithSizeLimit with the regression scenario:\n# Create a Logger {{claLog}}\n# Create a CLA appender {{claAppender}} with size limit\n# claLog.addAppender(claAppender)\n# claLog.info(message1) with {{Object message1}} where message1.toString() calls claLog.info(\"stringmessage\").\n# claAppender.close\n\nSince you ended up fixing CLA in hadoop-yarn-common, this JIRA has to move to YARN project.\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-12T07:43:36.554+0000","updated":"2014-11-12T07:43:36.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14208729","id":"14208729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~kamrul], here is the reproducer unit test that you might want to fold in your patch to make your fix verifiable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-12T21:27:04.051+0000","updated":"2014-11-12T21:27:04.051+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14208785","id":"14208785","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12681144/MAPREDUCE-6139-test.01.patch\n  against trunk revision 782abbb.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common:\n\n                  org.apache.hadoop.yarn.TestContainerLogAppender\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5014//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-MAPREDUCE-Build/5014//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-12T22:02:57.424+0000","updated":"2014-11-12T22:02:57.424+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14209062","id":"14209062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~jira.shegalov] for the test class.\nI will incorporate that in my next patch.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-13T01:32:59.969+0000","updated":"2014-11-13T01:32:59.969+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14210024","id":"14210024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"This belongs to YARN. Moving..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-13T17:11:21.544+0000","updated":"2014-11-13T17:11:21.544+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14210185","id":"14210185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Added test case. Thanks [~jira.shegalov] for the help and comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-13T19:19:15.459+0000","updated":"2014-11-13T19:19:15.459+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14211408","id":"14211408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"Kicking off Jenkins with \"Submit Patch\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-13T22:47:13.541+0000","updated":"2014-11-13T22:47:13.541+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14211457","id":"14211457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:green}+1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12681381/YARN-2857.3.patch\n  against trunk revision 1a2e5cb.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-YARN-Build/5839//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-YARN-Build/5839//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-13T23:22:56.122+0000","updated":"2014-11-13T23:22:56.122+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14211519","id":"14211519","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"Clean Jenkins in the last build demonstrates that the patch fixes the reproducer in the previous build:\n{code}\ntestAppendInClose(org.apache.hadoop.yarn.TestContainerLogAppender)  Time elapsed: 0.066 sec  <<< ERROR!\njava.util.ConcurrentModificationException: null\n\tat java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:761)\n\tat java.util.LinkedList$ListItr.next(LinkedList.java:696)\n\tat org.apache.hadoop.yarn.ContainerLogAppender.close(ContainerLogAppender.java:81)\n\tat org.apache.hadoop.yarn.TestContainerLogAppender.testAppendInClose(TestContainerLogAppender.java:44)\n{code}\n\n. +1(non-binding)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-13T23:58:17.037+0000","updated":"2014-11-13T23:58:17.037+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14211574","id":"14211574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"body":"Can some (binding) people please review it?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kamrul","name":"kamrul","key":"kamrul","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohammad Kamrul Islam","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-14T00:25:59.855+0000","updated":"2014-11-14T00:25:59.855+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14212792","id":"14212792","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"+1 lgtm.  Committing this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-11-14T20:38:28.412+0000","updated":"2014-11-14T20:38:28.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14212804","id":"14212804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Thanks to Mohammad for the contribution and to Sangjin and Gera for additional review!  I committed this to trunk and branch-2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-11-14T20:49:46.575+0000","updated":"2014-11-14T20:49:46.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14212810","id":"14212810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-trunk-Commit #6545 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6545/])\nYARN-2857. ConcurrentModificationException in ContainerLogAppender. Contributed by Mohammad Kamrul Islam (jlowe: rev f2fe8a800e5b0f3875931adba9ae20c6a95aa4ff)\n* hadoop-yarn-project/CHANGES.txt\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/ContainerLogAppender.java\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/TestContainerLogAppender.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-14T20:53:01.801+0000","updated":"2014-11-14T20:53:01.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14213538","id":"14213538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Yarn-trunk #744 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/744/])\nYARN-2857. ConcurrentModificationException in ContainerLogAppender. Contributed by Mohammad Kamrul Islam (jlowe: rev f2fe8a800e5b0f3875931adba9ae20c6a95aa4ff)\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/ContainerLogAppender.java\n* hadoop-yarn-project/CHANGES.txt\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/TestContainerLogAppender.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-15T11:51:51.739+0000","updated":"2014-11-15T11:51:51.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14213547","id":"14213547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Yarn-trunk-Java8 #6 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/6/])\nYARN-2857. ConcurrentModificationException in ContainerLogAppender. Contributed by Mohammad Kamrul Islam (jlowe: rev f2fe8a800e5b0f3875931adba9ae20c6a95aa4ff)\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/TestContainerLogAppender.java\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/ContainerLogAppender.java\n* hadoop-yarn-project/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-15T11:52:22.801+0000","updated":"2014-11-15T11:52:22.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14213620","id":"14213620","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Hdfs-trunk #1934 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1934/])\nYARN-2857. ConcurrentModificationException in ContainerLogAppender. Contributed by Mohammad Kamrul Islam (jlowe: rev f2fe8a800e5b0f3875931adba9ae20c6a95aa4ff)\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/TestContainerLogAppender.java\n* hadoop-yarn-project/CHANGES.txt\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/ContainerLogAppender.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-15T14:19:07.825+0000","updated":"2014-11-15T14:19:07.825+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14213629","id":"14213629","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Hdfs-trunk-Java8 #6 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/6/])\nYARN-2857. ConcurrentModificationException in ContainerLogAppender. Contributed by Mohammad Kamrul Islam (jlowe: rev f2fe8a800e5b0f3875931adba9ae20c6a95aa4ff)\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/TestContainerLogAppender.java\n* hadoop-yarn-project/CHANGES.txt\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/ContainerLogAppender.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-15T14:20:10.707+0000","updated":"2014-11-15T14:20:10.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14213648","id":"14213648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk #1958 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1958/])\nYARN-2857. ConcurrentModificationException in ContainerLogAppender. Contributed by Mohammad Kamrul Islam (jlowe: rev f2fe8a800e5b0f3875931adba9ae20c6a95aa4ff)\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/TestContainerLogAppender.java\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/ContainerLogAppender.java\n* hadoop-yarn-project/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-15T15:17:13.816+0000","updated":"2014-11-15T15:17:13.816+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12750458/comment/14213657","id":"14213657","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Mapreduce-trunk-Java8 #6 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/6/])\nYARN-2857. ConcurrentModificationException in ContainerLogAppender. Contributed by Mohammad Kamrul Islam (jlowe: rev f2fe8a800e5b0f3875931adba9ae20c6a95aa4ff)\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/main/java/org/apache/hadoop/yarn/ContainerLogAppender.java\n* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/TestContainerLogAppender.java\n* hadoop-yarn-project/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-15T15:28:04.864+0000","updated":"2014-11-15T15:28:04.864+0000"}],"maxResults":45,"total":45,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2857/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i21k9r:"}}