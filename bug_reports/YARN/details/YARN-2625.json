{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12744935","self":"https://issues.apache.org/jira/rest/api/2/issue/12744935","key":"YARN-2625","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-10-06T10:41:53.955+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jan 05 13:14:14 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2625/watchers","watchCount":7,"isWatching":false},"created":"2014-09-30T12:47:44.900+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327748","id":"12327748","description":"2.5.1 release","name":"2.5.1","archived":false,"released":true,"releaseDate":"2014-09-05"}],"issuelinks":[{"id":"12446412","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12446412","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"outwardIssue":{"id":"12905833","key":"YARN-4275","self":"https://issues.apache.org/jira/rest/api/2/issue/12905833","fields":{"summary":"Rest API to expose YARN CLASSPATH and other useful system properties","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-19T03:25:31.289+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319416","id":"12319416","name":"api"}],"timeoriginalestimate":null,"description":"There are a couple of issues I have found specifying the CLASSPATH environment variable using the REST API.\n\n1) In the Java client, the CLASSPATH environment is usually made up of either the value of the yarn.application.classpath in yarn-site.xml value or the default YARN classpath value as defined by YarnConfiguration.DEFAULT_YARN_CROSS_PLATFORM_APPLICATION_CLASSPATH. REST API consumers have no method of telling the resource manager to use the default unless they hardcode the default value themselves. If the default ever changes, the code would need to change. \n\n2) If any environment variables are used in the CLASSPATH environment 'value' field, they are evaluated when the values are NULL resulting in bad values in the CLASSPATH. For example, if I had hardcoded the CLASSPATH value to the default of \"$HADOOP_CONF_DIR, $HADOOP_COMMON_HOME/share/hadoop/common/*, $HADOOP_COMMON_HOME/share/hadoop/common/lib/*, $HADOOP_HDFS_HOME/share/hadoop/hdfs/*, $HADOOP_HDFS_HOME/share/hadoop/hdfs/lib/*, $HADOOP_YARN_HOME/share/hadoop/yarn/*, $HADOOP_YARN_HOME/share/hadoop/yarn/lib/*\" the classpath passed to the application master is \":/share/hadoop/common/*:/share/hadoop/common/lib/*:/share/hadoop/hdfs/*:/share/hadoop/hdfs/lib/*:/share/hadoop/yarn/*:/share/hadoop/yarn/lib/*\"\n\nThese two problems require REST API consumers to always have the fully resolved path defined in the yarn.application.classpath value. If the property is missing or contains environment varaibles, the application created by the REST API will fail due to the CLASSPATH being incorrect.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Problems with CLASSPATH in Job Submission REST API","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdhaigh","name":"cdhaigh","key":"cdhaigh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Haigh","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdhaigh","name":"cdhaigh","key":"cdhaigh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Haigh","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12744935/comment/14160170","id":"14160170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"body":"While submitting appliclaiton from REST api, it expects CLASSPATH to be added by application client. As a support, ContainerLaunchContextInfo#setEnvironment() provide to add classpath  variables. I think adding default values at server side may not feasible.\n\nbq. 2) If any environment variables are used in the CLASSPATH environment 'value' field, they are evaluated when the values are NULL resulting in bad values in the CLASSPATH\nThis is because cilent JVM does not resolve $HADOOP_COMMON_HOME environment variable.It is expected to provide full path when submitting from client.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"created":"2014-10-06T10:41:53.955+0000","updated":"2014-10-06T10:41:53.955+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12744935/comment/14160255","id":"14160255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdhaigh","name":"cdhaigh","key":"cdhaigh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Haigh","active":true,"timeZone":"America/New_York"},"body":"Yes, I agree the classpath should be set by the client, but the REST client should not have to know the default classpath just as the Java client does not need to know it. Just as the REST API resolves {{<CPS>}} to either {{:}} or {{;}} based on the underlying operating system, the REST API could look for {{<DEFAULT_YARN_CROSS_PLATFORM_APPLICATION_CLASSPATH>}} and resolve it to {{YarnConfiguration.DEFAULT_YARN_CROSS_PLATFORM_APPLICATION_CLASSPATH}}.\n\n\nAs for environment variables being resolved, when running a Java client against a CDH 5.0.0 cluster, I am able to set the environment to \n\n{{./*:$HADOOP_CLIENT_CONF_DIR:$HADOOP_CONF_DIR:$HADOOP_COMMON_HOME/*:$HADOOP_COMMON_HOME/lib/*:$HADOOP_HDFS_HOME/*:$HADOOP_HDFS_HOME/lib/*:$HADOOP_YARN_HOME/*:$HADOOP_YARN_HOME/lib/*}}\n\nand it works - the environment variables are resolved. Maybe it is the way CDH is setting things up, but the path is not fully resolved when the client specifies it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdhaigh","name":"cdhaigh","key":"cdhaigh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Haigh","active":true,"timeZone":"America/New_York"},"created":"2014-10-06T12:47:40.234+0000","updated":"2014-10-06T12:47:40.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12744935/comment/14160442","id":"14160442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vvasudev","name":"vvasudev","key":"vvasudev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Vasudev","active":true,"timeZone":"Asia/Kolkata"},"body":"[~cdhaigh], you can fetch the config via http://<rm address>:<rm port>/conf. That gives you the xml configuration for the RM. Can you extract yarn.application.classpath from there and use it when submitting your app?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vvasudev","name":"vvasudev","key":"vvasudev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Varun Vasudev","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-10-06T16:20:05.273+0000","updated":"2014-10-06T16:20:05.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12744935/comment/14160455","id":"14160455","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdhaigh","name":"cdhaigh","key":"cdhaigh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Haigh","active":true,"timeZone":"America/New_York"},"body":"To be honest, I never knew about that option - but that does not get me anything more than what I can read from the yarn-site.xml file (although I like not having to have those files around). \n\nIt still has the two problems described above because\n\n1) If the {{yarn.application.classpath}} value is not specified, I still have no way to know the default classpath\n2) If the {{yarn.application.classpath}} value has environment variables in it, they still need to be resolved somehow.\n\nIf the value returned by that URL was the *resolved* classpath, that would be the work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdhaigh","name":"cdhaigh","key":"cdhaigh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Haigh","active":true,"timeZone":"America/New_York"},"created":"2014-10-06T16:27:38.675+0000","updated":"2014-10-06T16:27:38.675+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12744935/comment/14257618","id":"14257618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"bq.  If the default ever changes, the code would need to change.\nThe way the layering works, YARN doesn't know whether the app is JVM based or not (though predominant apps that exist today are all JVM based). Given this, we chose to introduce this yarn.application.classpath as a _simplifying_ configuration property that apps can use. So far, it didn't have any semantic meaning to the platform and it is important to keep it so to keep it so. I think the right solution is for us to introduce some sort of a JAVA universe as a API, we can auto-expand it the way you are asking only if the app specifically says it is a JAVA universe.\n\nbq. For example, if I had hardcoded the CLASSPATH value to the default of \"$HADOOP_CONF_DIR, $HADOOP_COMMON_HOME/share/hadoop/common/, $HADOOP_COMMON_HOME/share/hadoop/common/lib/, $HADOOP_HDFS_HOME/share/hadoop/hdfs/, $HADOOP_HDFS_HOME/share/hadoop/hdfs/lib/, $HADOOP_YARN_HOME/share/hadoop/yarn/, $HADOOP_YARN_HOME/share/hadoop/yarn/lib/\" the classpath passed to the application master is \":/share/hadoop/common/:/share/hadoop/common/lib/:/share/hadoop/hdfs/:/share/hadoop/hdfs/lib/:/share/hadoop/yarn/:/share/hadoop/yarn/lib/\"\nThis is a bug. NodeManager by default exports these environment variables and so the expansion should happen automatically.\n\nAre you using MR jobs? If so, once your clusters start moving to using MR tarballs through distributed-cache scheme (MAPREDUCE-4421), the classpath dictated by mapreduce.application.classpath will simply be a reflection of the directory hierarchy in the tarball and is completely decoupled from the cluster-install or the environment variables.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-23T22:33:11.820+0000","updated":"2014-12-23T22:33:11.820+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12744935/comment/14264577","id":"14264577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdhaigh","name":"cdhaigh","key":"cdhaigh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Haigh","active":true,"timeZone":"America/New_York"},"body":"I am not using MR. I am writing my own AppMaster which requires knowing the path to the Hadoop ecosystem's CLASSPATH. Unless you expect Hadoop to be rewritten in something other than JAVA, most AppMaster jars written in Java will be required to know the CLASSPATH of the Hadoop ecosystem they are expected to run under. If you want to add a REST API to specifically get the CLASSPATH of the Hadoop ecosystem a Java AppMaster will run under, that is fine with me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdhaigh","name":"cdhaigh","key":"cdhaigh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Haigh","active":true,"timeZone":"America/New_York"},"created":"2015-01-05T13:14:14.933+0000","updated":"2015-01-05T13:14:14.933+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2625/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i20mrj:"}}