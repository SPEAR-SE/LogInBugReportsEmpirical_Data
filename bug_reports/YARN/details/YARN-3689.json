{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12831298","self":"https://issues.apache.org/jira/rest/api/2/issue/12831298","key":"YARN-3689","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2015-08-13T03:52:21.196+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 13 07:12:30 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_7348560396_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-08-13T08:53:49.156+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-3689/watchers","watchCount":6,"isWatching":false},"created":"2015-05-20T07:37:48.796+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326262","id":"12326262","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-08-13T08:53:49.182+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12322906","id":"12322906","name":"fairscheduler","description":"Fair Scheduler"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12319325","id":"12319325","name":"scheduler"}],"timeoriginalestimate":null,"description":"In method \"compare\" in \"FifoPolicy.java\" file, the \"s1\" and \"s2\" should change position when compare priority.\n\nI did a test. Configured the schedulerpolicy \"fifo\",  submitted 2 jobs to the same queue.\nThe result is below:\n2015-05-20 11:57:41,449 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: before sort ------------------  \n2015-05-20 11:57:41,449 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: appName:application_1432094103221_0001 appPririty:4  appStartTime:1432094170038\n2015-05-20 11:57:41,449 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: appName:application_1432094103221_0002 appPririty:2  appStartTime:1432094173131\n2015-05-20 11:57:41,449 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: after sort %%%%%%%%%%%%% \n2015-05-20 11:57:41,449 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: appName:application_1432094103221_0001 appPririty:4  appStartTime:1432094170038  \n2015-05-20 11:57:41,449 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: appName:application_1432094103221_0002 appPririty:2  appStartTime:1432094173131  \n\nBut when change the \"s1\" and \"s2\" position like below:\n\npublic int compare(Schedulable s1, Schedulable s2) {\n      int res = s2.getPriority().compareTo(s1.getPriority());\n.........}\n\nThe result:\n2015-05-20 11:36:37,119 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: before sort ------------------ \n2015-05-20 11:36:37,119 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: appName:application_1432090734333_0009 appPririty:4  appStartTime:1432092992503\n2015-05-20 11:36:37,119 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: appName:application_1432090734333_0010 appPririty:2  appStartTime:1432092996437\n2015-05-20 11:36:37,119 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: after sort %%%%%%%%%%%%% \n2015-05-20 11:36:37,119 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: appName:application_1432090734333_0010 appPririty:2  appStartTime:1432092996437\n2015-05-20 11:36:37,119 DEBUG org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FSLeafQueue: appName:application_1432090734333_0009 appPririty:4  appStartTime:1432092992503 \n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"FifoComparator logic is wrong. In method \"compare\" in \"FifoPolicy.java\" file, the \"s1\" and \"s2\" should change position when compare priority ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lyn","name":"lyn","key":"lyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhoulinlin","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lyn","name":"lyn","key":"lyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhoulinlin","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12831298/comment/14694655","id":"14694655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi [~lyn]\n\nThanks for reporting the issue. *org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.policies.FifoPolicy.FifoComparator.compare(Schedulable, Schedulable)* seems fine to me as the lower the priority number, the schedule holds higher value. But i think the problem is in Collection.sort in FSLeafQueue which will order the elements in ascending order. Any thoughts.?\n\nHere is a small test case\n{code}\n\n    //create 2 schedule with priority\n    Schedulable s1 = createSchedulable(1);\n    Schedulable s2 = createSchedulable(2);\n    \n    FifoPolicy fp = new FifoPolicy();\n    Comparator<Schedulable> fpComparator = fp.getComparator();\n    int compare = fpComparator.compare(s1, s2);\n    //ensure smaller the number, is considered higher\n    assertTrue(compare > 0);\n    \n    List<Schedulable> list = new ArrayList<>();\n    list.add(s1);\n    list.add(s2);\n    Collections.sort(list,fpComparator);\n    assertEquals(s1,list.get(0)); //fails\n    assertEquals(s2,list.get(1)); //fails\n  \n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-08-13T03:52:21.196+0000","updated":"2015-08-13T03:52:21.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12831298/comment/14694661","id":"14694661","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"body":"I think it follows the contract of compare, but as Collections.sort is processed, in case of priority its suppose to negate. just flipping the s1 and s2 may serve the purpose, but violate compare contract","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-08-13T04:10:05.514+0000","updated":"2015-08-13T04:10:05.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12831298/comment/14694687","id":"14694687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"body":"As per the application priority design, *Higher Interger* indicates *Higher priority*, so comparator implementation seems to be fine for me. And the test by [~ajithshetty] also proving higher prioirty value i.e 2 is first in the list.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"created":"2015-08-13T05:03:00.871+0000","updated":"2015-08-13T05:03:00.871+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12831298/comment/14694771","id":"14694771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi [~rohithsharma]\n\nThanks for the input. \n\n{quote} *Higher Integer* indicates *Higher priority* {quote}\n\nSo, i think we should flip the operands in org.apache.hadoop.yarn.api.records.Priority.compareTo(Priority)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-08-13T06:13:47.847+0000","updated":"2015-08-13T06:13:47.847+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12831298/comment/14694784","id":"14694784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"body":"Please ignore previous comment, the current code is fine if {quote} *Higher Integer* indicates *Higher Priority* {quote} \ni overlooked it :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-08-13T06:33:16.237+0000","updated":"2015-08-13T06:33:16.237+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12831298/comment/14694829","id":"14694829","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lyn","name":"lyn","key":"lyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhoulinlin","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks!   I thought \"Higher Interger indicates Lower priority\", so I am wrong. The current code is fine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lyn","name":"lyn","key":"lyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhoulinlin","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-08-13T07:12:30.493+0000","updated":"2015-08-13T07:12:30.493+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-3689/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ez3z:"}}