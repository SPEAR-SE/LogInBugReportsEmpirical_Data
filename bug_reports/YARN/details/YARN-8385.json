{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13163222","self":"https://issues.apache.org/jira/rest/api/2/issue/13163222","key":"YARN-8385","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2018-07-05T19:09:50.430+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jul 09 14:11:34 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3356185805_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-07-09T14:11:34.511+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-8385/watchers","watchCount":3,"isWatching":false},"created":"2018-05-31T17:55:08.748+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327585","id":"12327585","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"issuelinks":[{"id":"12535472","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12535472","type":{"id":"12310560","name":"Problem/Incident","inward":"is caused by","outward":"causes","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310560"},"outwardIssue":{"id":"13119993","key":"SPARK-22575","self":"https://issues.apache.org/jira/rest/api/2/issue/13119993","fields":{"summary":"Making Spark Thrift Server clean up its cache","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/3","description":"This issue is being actively worked on at the moment by the assignee.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/inprogress.png","name":"In Progress","id":"3","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-09T14:11:34.550+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"In long running applications, it may happen that many containers are created and killed. A use case is Spark Thrift Server when dynamic allocation is enabled. A lot of containers are killed and the application keeps running indefinitely.\r\n\r\nCurrently, YARN seems to remove the local directories only when the whole application terminates. In the scenario described above, this can cause serious resource leakages. Please, check https://issues.apache.org/jira/browse/SPARK-22575.\r\n\r\nI think YARN should clean up all the local directories of a container when it is killed and not when the whole application terminates.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Clean local directories when a container is killed","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgaido","name":"mgaido","key":"mgaido","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgaido&avatarId=34522","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgaido&avatarId=34522","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgaido&avatarId=34522","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgaido&avatarId=34522"},"displayName":"Marco Gaido","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgaido","name":"mgaido","key":"mgaido","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgaido&avatarId=34522","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgaido&avatarId=34522","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgaido&avatarId=34522","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgaido&avatarId=34522"},"displayName":"Marco Gaido","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13163222/comment/16534030","id":"16534030","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"The container's working directories are cleaned up by YARN immediately after the container terminates (unless the debug delay is configured on the NM).  The application directories are not cleaned up until the application completes, as that is where a container can leave local data that may be accessed by a subsequent container on the node or via an auxiliary service (e.g.: shuffle data served up by a shuffle handler auxiliary service as is done for MapReduce, Tez, and Spark).\r\n\r\nAre you sure the data is being placed in the container's working directory and not the application directory?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2018-07-05T19:09:50.430+0000","updated":"2018-07-05T19:09:50.430+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13163222/comment/16536677","id":"16536677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgaido","name":"mgaido","key":"mgaido","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgaido&avatarId=34522","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgaido&avatarId=34522","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgaido&avatarId=34522","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgaido&avatarId=34522"},"displayName":"Marco Gaido","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for your answer [~jlowe]. As it is stated in the question on SO (https://stackoverflow.com/questions/46893123/how-can-i-make-spark-thrift-server-clean-up-its-cache) I think the application directory is used. I see why the data is not removed by YARN from you comment above, though. So I think we have to investigate why Spark is using the application directory in this case. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgaido","name":"mgaido","key":"mgaido","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgaido&avatarId=34522","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgaido&avatarId=34522","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgaido&avatarId=34522","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgaido&avatarId=34522"},"displayName":"Marco Gaido","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-09T08:31:05.876+0000","updated":"2018-07-09T08:31:05.876+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13163222/comment/16536957","id":"16536957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Closing this as invalid since YARN is deleting the container directory and leaving the application directory as designed.  This appears to be a problem with the application rather than a problem with YARN.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2018-07-09T14:11:34.534+0000","updated":"2018-07-09T14:11:34.534+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-8385/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3udaf:"}}