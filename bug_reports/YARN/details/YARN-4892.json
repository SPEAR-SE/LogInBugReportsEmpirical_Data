{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12954290","self":"https://issues.apache.org/jira/rest/api/2/issue/12954290","key":"YARN-4892","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-03-29T13:42:27.433+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 30 14:31:56 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4892/watchers","watchCount":6,"isWatching":false},"created":"2016-03-29T13:40:08.776+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331976","id":"12331976","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-03-30T14:31:56.027+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319322","id":"12319322","name":"resourcemanager"}],"timeoriginalestimate":null,"description":"Enable resourcemanager recovery, set properties as below:\n<property>\n    <description>Enable RM to recover state after starting. If true, then\n    yarn.resourcemanager.store.class must be specified. </description>\n   <name>yarn.resourcemanager.recovery.enabled</name>\n   <value>true</value>\n</property>\n<property>\n    <description> </description>\n    <name>yarn.resourcemanager.store.class</name>\n<value>org.apache.hadoop.yarn.server.resourcemanager.recovery.FileSystemRMStateStore</value>\n</property>\n<property>\n    <description> </description>\n    <name>yarn.resourcemanager.fs.state-store.uri</name>\n    <value>hdfs://apple02:9000/rmstore</value>\n</property>\n\nrun a distributedshell job, when job running, kill resourcemanager, and then restart resourcemanager, this job can not be finished and will be hung.\nBoth fair-share and capacity scheduler have such issue.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Job will be hung and can not be finished after resource manager restarting and enabling recovery","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiefang0318","name":"xiefang0318","key":"xiefang0318","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fang Xie","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiefang0318","name":"xiefang0318","key":"xiefang0318","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fang Xie","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12954290/comment/15216010","id":"15216010","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks, [~xiefang0318].  Can you give any additional details?  Logs would be particularly helpful.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-03-29T13:42:27.433+0000","updated":"2016-03-29T13:42:27.433+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12954290/comment/15217602","id":"15217602","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"body":"It is really hard to find the problem from given description. At least RM logs will be helpful. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rohithsharma","name":"rohithsharma","key":"rohithsharma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rohith Sharma K S","active":true,"timeZone":"Australia/Sydney"},"created":"2016-03-30T07:42:35.761+0000","updated":"2016-03-30T07:42:35.761+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12954290/comment/15217996","id":"15217996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiefang0318","name":"xiefang0318","key":"xiefang0318","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fang Xie","active":true,"timeZone":"Etc/UTC"},"body":"I don't know if you have reproduced this defect. give more  detailed information here.\n1. This defect is only reproduced when execute distributedshell job as\nhadoop jar /data/hadoop-2.7.1/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.7.1.jar org.apache.hadoop.yarn.applications.distributedshell.Client  -jar /data/hadoop-2.7.1/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.7.1.jar -shell_command sleep -shell_args 2 -num_containers 10 -container_memory 512 -master_memory 512\n\nI can not found this issue when running MapReduce job.\n\n2. Detailed reproduce steps:\n   1>start rm and nm\n    2> run a distributedshell job as\nhadoop jar /data/hadoop-2.7.1/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.7.1.jar org.apache.hadoop.yarn.applications.distributedshell.Client  -jar /data/hadoop-2.7.1/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.7.1.jar -shell_command sleep -shell_args 2 -num_containers 10 -container_memory 512 -master_memory 512\n    3>When job progress reach around 60%, kill RM process.\n    4> start RM again.\n    5> Job can be finished successfully from cli , but when go to Yarn GUI (http://rmaddress:8088), there is a job still  in running status.\n     6> No matter how many times when you restart RM, this job still in running status from GUI\n\n3. This issue can not be found in hadoop 2.6.1 or lower version.\n4. Attach my investigation result here:\n    Before hadoop 2.7.x, when RM killed, Application Mater process will be stoped, but in hadoop 2.7.x, when RM killed, Application Master still alive. in org.apache.hadoop.yarn.applications.distributedshell.ApplicationMaster.java \n protected boolean finish() {\n    // wait for completion.\n\t    while (!done\n        && (numCompletedContainers.get() != numTotalContainers)) {\n      try {\n    \t         Thread.sleep(200);\n      } catch (InterruptedException ex) {}\n    }\n\n    if(timelineClient != null) {\n      publishApplicationAttemptEvent(timelineClient, appAttemptID.toString(),\n          DSEvent.DS_APP_ATTEMPT_END, domainId, appSubmitterUgi);\n    }\n\nThe job can not be finished due to always in loop   \n while (!done\n        && (numCompletedContainers.get() != numTotalContainers)) {\n      try {\n    \t         Thread.sleep(200);\n      } catch (InterruptedException ex) {}\n\nThe value of numCompletedContainers.get() is larger the real number of tasks ( numTotalContainers ).\nSo Application Master can not send job finish message to RM.\n\n\n\n      \n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiefang0318","name":"xiefang0318","key":"xiefang0318","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fang Xie","active":true,"timeZone":"Etc/UTC"},"created":"2016-03-30T13:58:58.265+0000","updated":"2016-03-30T13:58:58.265+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12954290/comment/15218039","id":"15218039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiefang0318","name":"xiefang0318","key":"xiefang0318","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fang Xie","active":true,"timeZone":"Etc/UTC"},"body":"Sorry just correct step #5, job can not be finished from view of cli and Yarn GUI.\nThe root cause is the value of numCompletedContainers is not correct, it add all containers  (before rm killed and after RM restart) which more than the numbers of tasks.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiefang0318","name":"xiefang0318","key":"xiefang0318","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fang Xie","active":true,"timeZone":"Etc/UTC"},"created":"2016-03-30T14:31:56.027+0000","updated":"2016-03-30T14:31:56.027+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-4892/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2vcdb:"}}