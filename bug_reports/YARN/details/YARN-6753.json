{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13083593","self":"https://issues.apache.org/jira/rest/api/2/issue/13083593","key":"YARN-6753","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-06-30T14:27:25.185+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jul 01 01:10:50 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-6753/watchers","watchCount":7,"isWatching":false},"created":"2017-06-29T21:04:14.564+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-01T01:10:50.538+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319323","id":"12319323","name":"nodemanager"}],"timeoriginalestimate":null,"description":"The current NM protobuf definition exposes a subset of the NM internal state via ContainerStateProto.\n\nWe are currently building tools that can use of more fine grain state like LOCALIZING, LOCALIZED, EXIT_WITH_FAILURES etc.\n\nThe proposal is to add more internal states in the API.\n\nI'm not sure if this is considered an Incompatible change or not","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Expose more ContainerImpl states from NM in ContainerStateProto ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roniburd","name":"roniburd","key":"roniburd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roni Burd","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roniburd","name":"roniburd","key":"roniburd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roni Burd","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13083593/comment/16069164","id":"16069164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roniburd","name":"roniburd","key":"roniburd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roni Burd","active":true,"timeZone":"Etc/UTC"},"body":"I was wondering what people feel around exposing some of the internals to allow debugging tools and other AMs to get insight into the NM. I understand that there can be reluctance to take a code dependencies, but by using protobuf the dependency should be weak. There are other internals I would like to expose over time like, Working Directory, etc. \n\n[~wangda] [~jianhe] , any thoughts? Do you have any recommendation what would be a \" kosher\" way of doing this?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roniburd","name":"roniburd","key":"roniburd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roni Burd","active":true,"timeZone":"Etc/UTC"},"created":"2017-06-29T23:09:43.205+0000","updated":"2017-06-29T23:09:43.205+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13083593/comment/16070187","id":"16070187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Technically adding LOCALIZING and LOCALIZED is going to break some clients.  They currently only expect NEW, RUNNING, and COMPLETE.  As soon as we start returning LOCALIZING/LOCALIZED instead of RUNNING that can break clients who are not expecting the new value.\n\nTo be completely backwards compatible the request for container state needs to include client version information so we know which enumerations the client expects.  If it is an older client then the NM can map the new states to the older enums.  For example, if a client asks for container state and doesn't include any client version info then we know we need to map LOCALIZED/LOCALIZING to RUNNING and EXIT_WITH_FAILURES to COMPLETE.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2017-06-30T14:27:25.185+0000","updated":"2017-06-30T14:27:25.185+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13083593/comment/16070427","id":"16070427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roniburd","name":"roniburd","key":"roniburd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roni Burd","active":true,"timeZone":"Etc/UTC"},"body":"[~jlowe] : So the thought is to add a version number to the request, call the existing one v1 and make it the default in protobuf, and if clients ask for v2, then pass the extra params.\n\nAnother way of doing it is to add this as \"detailed state\". So the old states remain as is, but if anyone is interested in the details it can query the state more. This takes advantage of protobufs instead of needing to add a new version field.\n\nAny other thoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roniburd","name":"roniburd","key":"roniburd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roni Burd","active":true,"timeZone":"Etc/UTC"},"created":"2017-06-30T17:12:02.900+0000","updated":"2017-06-30T17:13:24.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13083593/comment/16070605","id":"16070605","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"The approach I proposed also leverages protobufs, passing a new version field in the client request instead of a new detailed info field in the server response.  At a high level they're the same concept -- pass new information in a field that old code will ignore.\n\nI personally think it's cleaner for users to extend the existing enum transparently to the user's code (i.e.: the client version shenanigans will be hidden by the yarn client layer), but it does complicate the server code since it has to translate the container state to the appropriate list of enums.  I don't feel super strongly about it either way.  If we create a separate detailed field, note we'll have the same dilemma if we later add a new container state.  Would we then have a \"super detailed\" state?  ;-)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2017-06-30T19:18:54.040+0000","updated":"2017-06-30T19:18:54.040+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13083593/comment/16070876","id":"16070876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jianhe","name":"jianhe","key":"jianhe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian He","active":true,"timeZone":"America/Los_Angeles"},"body":"Yep, I kinda prefer working on the existing class.  Since the container state is also used by RM for its own logic e.g RMNodeImpl#handleContainerStatus, similar kind of mapping needs to be done there also. \n\nOn a related note, while working on YARN-1503, I also thought to expose the state of whether localization failed or succeeded.  But there I need a more sophisticated localization status per resource, though we probably also need a limit to limit the number resources object returned, otherwise, it could make the getContainerStatus heavy. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jianhe","name":"jianhe","key":"jianhe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian He","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-30T23:45:44.841+0000","updated":"2017-06-30T23:45:44.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13083593/comment/16070923","id":"16070923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roniburd","name":"roniburd","key":"roniburd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roni Burd","active":true,"timeZone":"Etc/UTC"},"body":"ok, so I'm hearing the consensus to be add a version number, and hide the logic in the clients. Default values arae set via protobuf and clients are unaware of the change. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roniburd","name":"roniburd","key":"roniburd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roni Burd","active":true,"timeZone":"Etc/UTC"},"created":"2017-07-01T01:10:50.538+0000","updated":"2017-07-01T01:10:50.538+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-6753/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3gx1r:"}}