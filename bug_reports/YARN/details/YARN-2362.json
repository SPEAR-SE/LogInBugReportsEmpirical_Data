{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12730042","self":"https://issues.apache.org/jira/rest/api/2/issue/12730042","key":"YARN-2362","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12313722","id":"12313722","key":"YARN","name":"Hadoop YARN","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12313722&avatarId=15135","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12313722&avatarId=15135","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12313722&avatarId=15135","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12313722&avatarId=15135"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2014-07-26T19:46:42.058+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 15 21:33:43 UTC 2014","customfield_12310420":"408115","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1745604277_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-08-15T21:33:43.977+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2362/watchers","watchCount":9,"isWatching":false},"created":"2014-07-26T16:40:19.725+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326697","id":"12326697","description":"2.4.1 bug-fix release","name":"2.4.1","archived":false,"released":true,"releaseDate":"2014-06-30"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-08-15T21:33:44.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319324","id":"12319324","name":"capacityscheduler"}],"timeoriginalestimate":null,"description":"Cluster configuration:\nTotal memory: 8GB\nyarn.scheduler.minimum-allocation-mb 256\nyarn.scheduler.capacity.maximum-am-resource-percent 1 (100%, test only config)\n\nApp 1 makes a request for 4.6 GB, succeeds, app transitions to RUNNING state. It subsequently makes a request for 4.6 GB, which cannot be granted and it waits.\n\nApp 2 makes a request for 1 GB - never receives it, so the app stays in the ACCEPTED state for ever.\n\nI think this can happen in leaf queues that are near capacity.\n\nThe fix is likely in LeafQueue.java assignContainers near line 861, where it returns if the assignment would exceed queue capacity, instead of checking if requests for other active applications can be met.\n\n{code:title=LeafQueue.java|borderStyle=solid}\n           // Check queue max-capacity limit\n           if (!assignToQueue(clusterResource, required)) {\n-            return NULL_ASSIGNMENT;\n+            break;\n           }\n{code}\n\nWith this change, the scenario above allows App 2 to start and finish while App 1 continues to wait.\n\nI have a patch available, but wondering if the current behavior is by design.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"408121","customfield_12312823":null,"summary":"Capacity Scheduler: apps with requests that exceed current capacity can starve pending apps","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=venkateshrin","name":"venkateshrin","key":"venkateshrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ram Venkatesh","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=venkateshrin","name":"venkateshrin","key":"venkateshrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ram Venkatesh","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730042/comment/14075476","id":"14075476","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=airbots","name":"airbots","key":"airbots","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=airbots&avatarId=34730","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=airbots&avatarId=34730","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=airbots&avatarId=34730","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=airbots&avatarId=34730"},"displayName":"Chen He","active":true,"timeZone":"America/Los_Angeles"},"body":"This is interesting. In general, user may not submit an application that asks for 50% of the whole cluster resources. It is possible that a cluster has more than 2 applications. If third application finishes, App2 can get enough resource and run. Then, \"deadlock\" breaks. Is this reasonable, [~venkateshrin] ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=airbots","name":"airbots","key":"airbots","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=airbots&avatarId=34730","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=airbots&avatarId=34730","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=airbots&avatarId=34730","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=airbots&avatarId=34730"},"displayName":"Chen He","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-26T19:46:42.058+0000","updated":"2014-07-26T19:46:42.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730042/comment/14075554","id":"14075554","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=venkateshrin","name":"venkateshrin","key":"venkateshrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ram Venkatesh","active":true,"timeZone":"America/Los_Angeles"},"body":"I agree that apps that need the entire cluster capacity  are likely not common. However, I think the scenario above can happen in busy clusters where an app might make a request that exceeds _current_ capacity and hence block all other apps. Yes, whenever more resources get freed up and App1's request is satisfied, only then will App2 run. Note, since we are enumerating the set of active apps, the behavior is actually non-deterministic - if the new app happens to be enumerated before the large app, the allocation request will actually be satisfied. The change proposed here makes it deterministic and can also reduce the wait for jobs that can complete - the downside of course is the large app can now experience starvation if small apps keep getting through. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=venkateshrin","name":"venkateshrin","key":"venkateshrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ram Venkatesh","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-27T05:21:00.945+0000","updated":"2014-07-27T05:21:00.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730042/comment/14075925","id":"14075925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilg","name":"sunilg","key":"sunilg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Govindan","active":true,"timeZone":"Asia/Kolkata"},"body":"Possible duplicate of YARN-1631","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilg","name":"sunilg","key":"sunilg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Govindan","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-07-28T05:59:43.271+0000","updated":"2014-07-28T05:59:43.271+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730042/comment/14075970","id":"14075970","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftnoteasy","name":"leftnoteasy","key":"leftnoteasy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=leftnoteasy&avatarId=18647","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=leftnoteasy&avatarId=18647","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=leftnoteasy&avatarId=18647","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=leftnoteasy&avatarId=18647"},"displayName":"Wangda Tan","active":true,"timeZone":"America/Los_Angeles"},"body":"I think we should fix this,\n{code}\n           if (!assignToQueue(clusterResource, required)) {\n-            return NULL_ASSIGNMENT;\n+            break;\n           }\n{code}\nThe {{return NULL_ASSIGNMENT}} statement means: if an app submitted earlier cannot allocate resource in a queue, the rest of apps in the queue cannot allocate resource in a queue too.\n\nThe {{break}} looks better to me.\n\nAnd I agree this should be a duplicate of YARN-1631","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftnoteasy","name":"leftnoteasy","key":"leftnoteasy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=leftnoteasy&avatarId=18647","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=leftnoteasy&avatarId=18647","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=leftnoteasy&avatarId=18647","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=leftnoteasy&avatarId=18647"},"displayName":"Wangda Tan","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-28T07:01:33.861+0000","updated":"2014-07-28T07:01:33.861+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12730042/comment/14099179","id":"14099179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=venkateshrin","name":"venkateshrin","key":"venkateshrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ram Venkatesh","active":true,"timeZone":"America/Los_Angeles"},"body":"Agree this is a duplicate of YARN-1631 ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=venkateshrin","name":"venkateshrin","key":"venkateshrin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ram Venkatesh","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-15T21:33:43.996+0000","updated":"2014-08-15T21:33:43.996+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/YARN-2362/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1y83z:"}}