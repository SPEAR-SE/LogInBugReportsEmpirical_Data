{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12684673","self":"https://issues.apache.org/jira/rest/api/2/issue/12684673","key":"STORM-99","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2015-01-22T09:41:08.660+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jan 22 16:12:02 UTC 2015","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_34918026975_*|*_5_*:*_1_*:*_0","customfield_12310420":"363745","customfield_12312321":null,"resolutiondate":"2015-01-22T16:12:02.259+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-99/watchers","watchCount":4,"isWatching":false},"created":"2013-12-14T12:44:55.407+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[{"id":"12406095","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12406095","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12684782","key":"STORM-155","self":"https://issues.apache.org/jira/rest/api/2/issue/12684782","fields":{"summary":"Storm rebalancing code causes multiple topologies assigned to a single port","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T01:00:27.234+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"https://github.com/nathanmarz/storm/issues/586\n\nWhen I submitted a lot of topologies(about 15) to the storm cluster, one supervisor throw a runtime exception. I believe that the exception should not be thrown in the normal. The version of the storm is 0.8.1\n\nI tried to reproduce this exception, but failed and after review the nimbus.clj & supervisor.clj, I found nothing. Is it a known bug?\n\nStack Info:\n2013-06-06 14:55:00 supervisor [INFO] Shut down 212aa36c-81a0-4d4d-8104-759d9f128669:f66a0118-7267-4460-9f35-58435c92dc10\n2013-06-06 14:55:00 supervisor [INFO] Shutting down and clearing state for id 8db35c17-9e69-49db-86c3-f7dc90fa42be. Current supervisor time: 1370501700. State: :disallowed, Heartbeat: #backtype.storm.daemon.common.WorkerHeartbeat{:time-secs 1370501699, :storm-id \"case_10-537-1370488327\", :executors #{[7 7] [14 14]}, :port 6708}\n2013-06-06 14:55:00 supervisor [INFO] Shutting down 212aa36c-81a0-4d4d-8104-759d9f128669:8db35c17-9e69-49db-86c3-f7dc90fa42be\n2013-06-06 14:55:00 supervisor [INFO] Shut down 212aa36c-81a0-4d4d-8104-759d9f128669:8db35c17-9e69-49db-86c3-f7dc90fa42be\n2013-06-06 14:55:03 event [ERROR] Error when processing event\njava.lang.RuntimeException: Should not have multiple topologies assigned to one port\nat backtype.storm.daemon.supervisor$read_assignments$fn__4510.doInvoke(supervisor.clj:45)\nat clojure.lang.RestFn.invoke(RestFn.java:421)\nat clojure.core$merge_with$merge_entry__4159.invoke(core.clj:2645)\nat clojure.core$reduce1.invoke(core.clj:880)\nat clojure.core$merge_with$merge2__4161.invoke(core.clj:2648)\nat clojure.core$reduce1.invoke(core.clj:880)\nat clojure.core$reduce1.invoke(core.clj:871)\nat clojure.core$merge_with.doInvoke(core.clj:2649)\nat clojure.lang.RestFn.applyTo(RestFn.java:139)\nat clojure.core$apply.invoke(core.clj:603)\nat backtype.storm.daemon.supervisor$read_assignments.invoke(supervisor.clj:48)\nat backtype.storm.daemon.supervisor$mk_synchronize_supervisor$this__4692.invoke(supervisor.clj:270)\nat backtype.storm.event$event_manager$fn__2484.invoke(event.clj:24)\nat clojure.lang.AFn.run(AFn.java:24)\nat java.lang.Thread.run(Thread.java:679)\n2013-06-06 14:55:03 util [INFO] Halting process: (\"Error when processing an event\")\n\nnimbus log within the crash time\n2013-06-06 14:54:44 nimbus [INFO] Delaying event :remove for 0 secs for case_9-536-1370488243\n2013-06-06 14:54:44 nimbus [INFO] Updated case_9-536-1370488243 with status {:type :killed, :kill-time-secs 0}\n2013-06-06 14:54:45 nimbus [INFO] Killing topology: case_9-536-1370488243\n2013-06-06 14:54:52 EvenScheduler [INFO] Available slots: ([\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6705] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6706] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6709] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6710] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6711])\n2013-06-06 14:54:52 nimbus [INFO] Setting new assignment for topology id case_23-527-1370478607: #backtype.storm.daemon.common.Assignment{:master-code-dir \"/home/admin/install/storm-local/nimbus/stormdist/case_23-527-1370478607\", :node->host {\"212aa36c-81a0-4d4d-8104-759d9f128669\" \"dev163015.sqa.cm6\"}, :executor->node+port {[2 2] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6706], [3 3] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6709], [4 4] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6710], [5 5] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6711], [6 6] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6705], [7 7] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6706], [8 8] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6709], [9 9] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6710], [10 10] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6711], [11 11] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6705], [12 12] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6706], [13 13] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6709], [1 1] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6705]}, :executor->start-time-secs {[2 2] 1370501692, [3 3] 1370501692, [4 4] 1370501692, [5 5] 1370501692, [6 6] 1370501692, [7 7] 1370501692, [8 8] 1370501692, [9 9] 1370501692, [10 10] 1370501692, [11 11] 1370501692, [12 12] 1370501692, [13 13] 1370501692, [1 1] 1370501692}}\n2013-06-06 14:54:52 nimbus [INFO] Cleaning up case_2-486-1370440841\n2013-06-06 14:54:52 nimbus [INFO] Cleaning up case_9-536-1370488243\n2013-06-06 14:54:52 nimbus [INFO] Cleaning up case_7-490-1370441170\n2013-06-06 14:54:53 nimbus [INFO] Delaying event :remove for 0 secs for case_10-537-1370488327\n2013-06-06 14:54:53 nimbus [INFO] Updated case_10-537-1370488327 with status {:type :killed, :kill-time-secs 0}\n2013-06-06 14:54:53 nimbus [INFO] Killing topology: case_10-537-1370488327\n2013-06-06 14:55:03 EvenScheduler [INFO] Available slots: ([\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6700] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6701] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6702] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6703] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6704] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6705] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6706] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6707] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6708] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6709])\n2013-06-06 14:55:03 EvenScheduler [INFO] Available slots: ([\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6705] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6706] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6707] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6708] [\"212aa36c-81a0-4d4d-8104-759d9f128669\" 6709])","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"364051","customfield_12312823":null,"summary":"Multitple topologies assigned to one port","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684673/comment/14287171","id":"14287171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=egoslin","name":"egoslin","key":"egoslin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Goslin","active":true,"timeZone":"Etc/UTC"},"body":"Was this issue fixed by https://issues.apache.org/jira/browse/STORM-155 ?\nWe receive this error in 0.9.2\n\n2015-01-22 06:25:45.138 b.s.event [][Thread-1][ERROR] Error when processing event\njava.lang.RuntimeException: Should not have multiple topologies assigned to one port\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[na:1.8.0_11]\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(Unknown Source) ~[na:1.8.0_11]\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(Unknown Source) ~[na:1.8.0_11]\n        at java.lang.reflect.Constructor.newInstance(Unknown Source) ~[na:1.8.0_11]\n        at clojure.lang.Reflector.invokeConstructor(Reflector.java:180) ~[clojure-1.5.1.jar:na]\n        at backtype.storm.util$throw_runtime.doInvoke(util.clj:753) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\n        at clojure.lang.RestFn.invoke(RestFn.java:408) ~[clojure-1.5.1.jar:na]\n        at backtype.storm.daemon.supervisor$read_assignments$fn__6143.doInvoke(supervisor.clj:65) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\n        at clojure.lang.RestFn.invoke(RestFn.java:421) ~[clojure-1.5.1.jar:na]\n        at clojure.core$merge_with$merge_entry__4279.invoke(core.clj:2698) ~[clojure-1.5.1.jar:na]\n        at clojure.core$reduce1.invoke(core.clj:896) ~[clojure-1.5.1.jar:na]\n        at clojure.core$merge_with$merge2__4281.invoke(core.clj:2701) ~[clojure-1.5.1.jar:na]\n        at clojure.core$reduce1.invoke(core.clj:896) ~[clojure-1.5.1.jar:na]\n        at clojure.core$reduce1.invoke(core.clj:887) ~[clojure-1.5.1.jar:na]\n        at clojure.core$merge_with.doInvoke(core.clj:2702) ~[clojure-1.5.1.jar:na]\n        at clojure.lang.RestFn.applyTo(RestFn.java:139) ~[clojure-1.5.1.jar:na]\n        at clojure.core$apply.invoke(core.clj:619) ~[clojure-1.5.1.jar:na]\n        at backtype.storm.daemon.supervisor$read_assignments.invoke(supervisor.clj:64) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\n        at backtype.storm.daemon.supervisor$mk_synchronize_supervisor$this__6330.invoke(supervisor.clj:303) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\n        at backtype.storm.event$event_manager$fn__2378.invoke(event.clj:39) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\n        at clojure.lang.AFn.run(AFn.java:24) [clojure-1.5.1.jar:na]\n        at java.lang.Thread.run(Unknown Source) [na:1.8.0_11]\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=egoslin","name":"egoslin","key":"egoslin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Goslin","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-22T09:41:08.660+0000","updated":"2015-01-22T09:41:08.660+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684673/comment/14287649","id":"14287649","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"STORM-155 was fixed as a part of 0.9.3, so 0.9.2 still has the issue in it.  STORM-155 also only reduced the window in which the race condition causes the supervisor to crash because it is in the middle of downloading scheduling changes while nimbus is in the middle of uploading them.  There is still the possibility that if nimbus crashes in the middle of uploading the changes, or for some other reason nimbus takes a really long time to upload all the changes the supervisor will still crash after the retries are exhausted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2015-01-22T16:03:50.907+0000","updated":"2015-01-22T16:03:50.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684673/comment/14287656","id":"14287656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"I am closing this as a dupe, if you disagree please reopen it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2015-01-22T16:12:02.303+0000","updated":"2015-01-22T16:12:02.303+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-99/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qp6v:"}}