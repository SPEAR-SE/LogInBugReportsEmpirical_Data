{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12778236","self":"https://issues.apache.org/jira/rest/api/2/issue/12778236","key":"STORM-695","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329843","id":"12329843","name":"1.0.0","archived":false,"released":true,"releaseDate":"2016-04-12"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-03-02T09:14:24.320+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jan 05 21:22:22 UTC 2016","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_26975472694_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2016-01-05T21:22:22.042+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-695/watchers","watchCount":4,"isWatching":false},"created":"2015-02-27T16:11:09.412+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327112","id":"12327112","name":"0.9.3","archived":false,"released":true,"releaseDate":"2014-11-25"}],"customfield_12312339":null,"issuelinks":[{"id":"12409267","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12409267","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12739444","key":"STORM-488","self":"https://issues.apache.org/jira/rest/api/2/issue/12739444","fields":{"summary":"storm CLI tool reports zero exit code on error scenario","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lewuathe","name":"lewuathe","key":"lewuathe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lewuathe&avatarId=25485","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lewuathe&avatarId=25485","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lewuathe&avatarId=25485","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lewuathe&avatarId=25485"},"displayName":"Kai Sasaki","active":true,"timeZone":"Asia/Tokyo"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-01-05T21:22:22.091+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"Commands such as \"storm kill non-existing-topology\" will return an exit code of zero, indicating success when in fact the command failed.\n\nh3. How to reproduce\n\nHere is but one example where the {{storm}} CLI tool violates shell best practices:\n\n{code}\n# Let's kill a topology that is in fact not running in the cluster.\n$ storm kill i-do-not-exist-topo\n<snip>\nException in thread \"main\" NotAliveException(msg:i-do-not-exist-topo is not alive)\n\n# Print the exit code of last command.\n$ echo $?\n0  # <<< but since the kill command failed this should be non-zero!\n{code}\n\nAnother example is the \"storm jar\" command.  If you attempt to submit a topology that has the same name as an existing, running topology, the \"storm jar\" command will not submit the topology -- instead it will print an exception (think: \"the topology FooName is already running\"), which is ok, but it will then exit with a return code of zero, which indicates success (which is wrong).\n\nh3. Impact\n\nThis bug prevents automated deployment tools such as Ansible or Puppet as well as ad-hoc CLI scripting (think: fire-fighting Ops teams) to work properly because Storm violates shell conventions by not returning non-zero exit codes in case of failures.\n\nh3. How to fix\n\nFrom what I understand the solution is two-fold:\n\n# The various Storm commands that are being called by the {{storm}} script must return proper exit codes.\n# The {{storm}} script must store these exit codes and return itself with the respective exit code of the Storm command it actually ran.\n\nFor example, here's the current code that implements the \"storm kill\" command:\n\n{code}\n# In: bin/storm\ndef kill(*args):\n    \"\"\"Syntax: [storm kill topology-name [-w wait-time-secs]]\n\n    Kills the topology with the name topology-name. Storm will \n    first deactivate the topology's spouts for the duration of \n    the topology's message timeout to allow all messages currently \n    being processed to finish processing. Storm will then shutdown \n    the workers and clean up their state. You can override the length \n    of time Storm waits between deactivation and shutdown with the -w flag.\n    \"\"\"\n    exec_storm_class(\n        \"backtype.storm.command.kill_topology\", \n        args=args, \n        jvmtype=\"-client\", \n        extrajars=[USER_CONF_DIR, STORM_BIN_DIR])\n{code}\n\nwhich in turn calls the following code in {{kill_topology.clj}}:\n\n{code}\n;; In: backtype.storm.command.kill-topology\n(ns backtype.storm.command.kill-topology\n  (:use [clojure.tools.cli :only [cli]])\n  (:use [backtype.storm thrift config log])\n  (:import [backtype.storm.generated KillOptions])\n  (:gen-class))\n\n(defn -main [& args]\n  (let [[{wait :wait} [name] _] (cli args [\"-w\" \"--wait\" :default nil :parse-fn #(Integer/parseInt %)])\n        opts (KillOptions.)]\n    (if wait (.set_wait_secs opts wait))\n    (with-configured-nimbus-connection nimbus\n      (.killTopologyWithOpts nimbus name opts)\n      (log-message \"Killed topology: \" name)\n      )))\n{code}\n\nwhich in turn calls the following code in {{nimbus.clj}}:\n\n{code}\n;; In: backtype.storm.daemon.nimbus\n      (^void killTopologyWithOpts [this ^String storm-name ^KillOptions options]\n        (check-storm-active! nimbus storm-name true)\n        (let [topology-conf (try-read-storm-conf-from-name conf storm-name nimbus)]\n          (check-authorization! nimbus storm-name topology-conf \"killTopology\"))\n        (let [wait-amt (if (.is_set_wait_secs options)\n                         (.get_wait_secs options)                         \n                         )]\n          (transition-name! nimbus storm-name [:kill wait-amt] true)\n          ))\n{code}\n\nAs you can see the current implementation does not pass success/failure information back to the caller.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"storm CLI tool reports zero exit code on error scenario, take 2","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miguno","name":"miguno","key":"miguno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=miguno&avatarId=26959","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=miguno&avatarId=26959","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=miguno&avatarId=26959","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=miguno&avatarId=26959"},"displayName":"Michael Noll","active":true,"timeZone":"Europe/Amsterdam"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miguno","name":"miguno","key":"miguno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=miguno&avatarId=26959","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=miguno&avatarId=26959","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=miguno&avatarId=26959","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=miguno&avatarId=26959"},"displayName":"Michael Noll","active":true,"timeZone":"Europe/Amsterdam"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14340333","id":"14340333","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miguno","name":"miguno","key":"miguno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=miguno&avatarId=26959","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=miguno&avatarId=26959","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=miguno&avatarId=26959","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=miguno&avatarId=26959"},"displayName":"Michael Noll","active":true,"timeZone":"Europe/Amsterdam"},"body":"To fix the storm CLI script:  Essentially we must updated the {{exec_storm_class()}} function to understand and pass exit codes of the commands it ran back to the caller.\n\nIdea:\n\n{code}\n$ diff -u storm storm.fixed\n--- storm       2015-02-24 13:59:03.000000000 +0000\n+++ storm.fixed 2015-02-27 15:47:38.373536529 +0000\n@@ -179,11 +179,13 @@\n         \"-cp\", get_classpath(extrajars),\n     ] + jvmopts + [klass] + list(args)\n     print(\"Running: \" + \" \".join(all_args))\n+    return_code = 1 # default return code indicates failure\n     if fork:\n-        os.spawnvp(os.P_WAIT, JAVA_CMD, all_args)\n+        return_code = os.spawnvp(os.P_WAIT, JAVA_CMD, all_args)\n     else:\n         # handling whitespaces in JAVA_CMD\n-        sub.call(all_args)\n+        return_code = sub.call(all_args)\n+    return return_code\n\n def jar(jarfile, klass, *args):\n     \"\"\"Syntax: [storm jar topology-jar-path class ...]\n@@ -490,7 +492,7 @@\n def unknown_command(*args):\n     print(\"Unknown command: [storm %s]\" % ' '.join(sys.argv[1:]))\n     print_usage()\n-    sys.exit(254)\n+    return 254\n\n COMMANDS = {\"jar\": jar, \"kill\": kill, \"shell\": shell, \"nimbus\": nimbus, \"ui\": ui, \"logviewer\": logviewer,\n             \"drpc\": drpc, \"supervisor\": supervisor, \"localconfvalue\": print_localconfvalue,\n@@ -532,7 +534,8 @@\n     parse_config(config_list)\n     COMMAND = args[0]\n     ARGS = args[1:]\n-    (COMMANDS.get(COMMAND, unknown_command))(*ARGS)\n+    return_code = (COMMANDS.get(COMMAND, unknown_command))(*ARGS)\n+    sys.exit(return_code)\n\n if __name__ == \"__main__\":\n     main()\n{code}\n\nAs I said above this diff/patch alone is not sufficient because the Storm commands themselves (e.g. kill_topology.clj) are not returning proper success/failure information.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miguno","name":"miguno","key":"miguno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=miguno&avatarId=26959","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=miguno&avatarId=26959","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=miguno&avatarId=26959","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=miguno&avatarId=26959"},"displayName":"Michael Noll","active":true,"timeZone":"Europe/Amsterdam"},"created":"2015-02-27T16:14:18.865+0000","updated":"2015-02-27T16:14:18.865+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14342955","id":"14342955","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lewuathe","name":"lewuathe","key":"lewuathe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lewuathe&avatarId=25485","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lewuathe&avatarId=25485","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lewuathe&avatarId=25485","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lewuathe&avatarId=25485"},"displayName":"Kai Sasaki","active":true,"timeZone":"Asia/Tokyo"},"body":"[~miguno] CLI tools cannot handle any errors with current command tool. So I think it will be needed. But I have a question. Is there anyway to handle exceptions and errors through thrift interface? Though I am not familiar with thrift so much, I want to know how to do it. Thank you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lewuathe","name":"lewuathe","key":"lewuathe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lewuathe&avatarId=25485","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lewuathe&avatarId=25485","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lewuathe&avatarId=25485","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lewuathe&avatarId=25485"},"displayName":"Kai Sasaki","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-02T09:14:24.320+0000","updated":"2015-03-02T09:14:24.320+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14346591","id":"14346591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miguno","name":"miguno","key":"miguno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=miguno&avatarId=26959","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=miguno&avatarId=26959","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=miguno&avatarId=26959","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=miguno&avatarId=26959"},"displayName":"Michael Noll","active":true,"timeZone":"Europe/Amsterdam"},"body":"> But I have a question. Is there anyway to handle exceptions and errors through thrift interface? Though I am not familiar with thrift so much, I want to know how to do it. Thank you.\n\nKai, unfortunately I don't know either (Thrift). :-/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miguno","name":"miguno","key":"miguno","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=miguno&avatarId=26959","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=miguno&avatarId=26959","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=miguno&avatarId=26959","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=miguno&avatarId=26959"},"displayName":"Michael Noll","active":true,"timeZone":"Europe/Amsterdam"},"created":"2015-03-04T08:21:00.685+0000","updated":"2015-03-04T08:21:00.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14346770","id":"14346770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lewuathe","name":"lewuathe","key":"lewuathe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lewuathe&avatarId=25485","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lewuathe&avatarId=25485","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lewuathe&avatarId=25485","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lewuathe&avatarId=25485"},"displayName":"Kai Sasaki","active":true,"timeZone":"Asia/Tokyo"},"body":"[~miguno]Thanks. I'll find out how to do it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lewuathe","name":"lewuathe","key":"lewuathe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lewuathe&avatarId=25485","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lewuathe&avatarId=25485","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lewuathe&avatarId=25485","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lewuathe&avatarId=25485"},"displayName":"Kai Sasaki","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-04T11:19:54.800+0000","updated":"2015-03-04T11:19:54.800+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14346863","id":"14346863","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user Lewuathe opened a pull request:\n\n    https://github.com/apache/storm/pull/456\n\n    [STORM-695] storm CLI tool reports zero exit code on error scenario\n\n    Handling `java.lang.RuntimeException` and `NotAliveException` in storm command.\n    This feature can be useful for handling a exit code returned from shell command.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/Lewuathe/storm STORM-695\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/456.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #456\n    \n----\ncommit 7e36ce579f0dcbcf4dfe5942b906a6e94a1815e8\nAuthor: lewuathe <lewuathe@me.com>\nDate:   2015-03-04T13:14:51Z\n\n    [STORM-695] storm CLI tool reports zero exit code on error scenario\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-04T13:18:44.411+0000","updated":"2015-03-04T13:18:44.411+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14346870","id":"14346870","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Lewuathe commented on the pull request:\n\n    https://github.com/apache/storm/pull/456#issuecomment-77156141\n  \n    However the topology is submitted with `storm shell`, this cannot track exception because `spawnvp` seems to return no stdout and stderr. I don't know the reason why in this case `spawnvp` is called. Can I migrate these two cases into `subprocess.check_output`?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-04T13:22:13.342+0000","updated":"2015-03-04T13:22:13.342+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14346877","id":"14346877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user miguno commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/456#discussion_r25774104\n  \n    --- Diff: bin/storm ---\n    @@ -183,7 +209,16 @@ def exec_storm_class(klass, jvmtype=\"-server\", jvmopts=[], extrajars=[], args=[]\n             os.spawnvp(os.P_WAIT, JAVA_CMD, all_args)\n         else:\n             # handling whitespaces in JAVA_CMD\n    -        sub.call(all_args)\n    +        try:\n    +            ret = sub.check_output(all_args, stderr=sub.STDOUT)\n    +            print(ret)\n    +        except sub.CalledProcessError as e:\n    +            # Handling exception with stdout and stderr\n    +            if e.returncode != 0:\n    --- End diff --\n    \n    I think this check is redundant, given what the Python docs say:\n    \n    > subprocess.check_output(): [...] If the return code was non-zero it raises a CalledProcessError.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-04T13:35:16.458+0000","updated":"2015-03-04T13:35:16.458+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14346878","id":"14346878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user miguno commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/456#discussion_r25774112\n  \n    --- Diff: bin/storm ---\n    @@ -183,7 +209,16 @@ def exec_storm_class(klass, jvmtype=\"-server\", jvmopts=[], extrajars=[], args=[]\n             os.spawnvp(os.P_WAIT, JAVA_CMD, all_args)\n         else:\n             # handling whitespaces in JAVA_CMD\n    -        sub.call(all_args)\n    +        try:\n    +            ret = sub.check_output(all_args, stderr=sub.STDOUT)\n    +            print(ret)\n    --- End diff --\n    \n    Why the print?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-04T13:35:31.413+0000","updated":"2015-03-04T13:35:31.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14346883","id":"14346883","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user miguno commented on the pull request:\n\n    https://github.com/apache/storm/pull/456#issuecomment-77159580\n  \n    Many thanks for the PR, Kai!\n    \n    > However if the topology is submitted with `storm shell`, this cannot track exception because spawnvp seems to return no stdout and stderr.\n    \n    See [my comment](https://issues.apache.org/jira/browse/STORM-695?focusedCommentId=14340333&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14340333) in the STORM-695 JIRA ticket.  `os.spawnvp` returns the exit code of the process:\n    \n    ```python\n    # return code can be 0 or non-zero, i.e. there will be no exception thrown like for sub.check_output\n    return_code = os.spawnvp(os.P_WAIT, JAVA_CMD, all_args)\n    ```\n    \n    However the problem is that Storm is currently not returning any non-zero return codes, even in the face of errors.  I haven't had the chance to test-drive your code yet, but the code in the PR might not work for the same reason:\n    \n    ```python\n     try:\n        ret = sub.check_output(all_args, stderr=sub.STDOUT)\n        print(ret)\n      except sub.CalledProcessError as e:\n    ```\n    \n    If I understand the Python docs correctly, the `CalledProcessError` will only be thrown if the process returns with a non-zero exit code, and with current Storm this won't happen -- the return code will always be zero I think.\n    \n    One workaround could be to slightly adjust the code in the PR to simply grep for error messages in `STDOUT` / `STDERR` --  regardless of what the return code of the process is -- and, if there is a match, consider the process/command failed.\n    \n    (And please correct me if I'm wrong.)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-04T13:45:30.435+0000","updated":"2015-03-04T13:45:30.435+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14347674","id":"14347674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Lewuathe commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/456#discussion_r25820615\n  \n    --- Diff: bin/storm ---\n    @@ -183,7 +209,16 @@ def exec_storm_class(klass, jvmtype=\"-server\", jvmopts=[], extrajars=[], args=[]\n             os.spawnvp(os.P_WAIT, JAVA_CMD, all_args)\n         else:\n             # handling whitespaces in JAVA_CMD\n    -        sub.call(all_args)\n    +        try:\n    +            ret = sub.check_output(all_args, stderr=sub.STDOUT)\n    +            print(ret)\n    --- End diff --\n    \n    Because `check_output` absolutes all outout from command. It is necessary to `print` alternatively to see stdout.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-04T22:22:41.435+0000","updated":"2015-03-04T22:22:41.435+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14347692","id":"14347692","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Lewuathe commented on the pull request:\n\n    https://github.com/apache/storm/pull/456#issuecomment-77264323\n  \n    @miguno Thank you for comment. I tested the error handling and exit code of current storm command. And I found when any exception has occurred `check_output` returns non-zero code(just only 1).  So with this patch, storm command can detect the occurrence of exception. But error exit code always be 1, so in order to specify what exception is occurred, we must parse stdout and stderr. This is what I was trying to do with this PR.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-04T22:29:18.399+0000","updated":"2015-03-04T22:29:18.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14356723","id":"14356723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user miguno commented on the pull request:\n\n    https://github.com/apache/storm/pull/456#issuecomment-78243873\n  \n    Sorry that I haven't had the time yet to follow-up.  Please stay tuned!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-11T11:08:16.188+0000","updated":"2015-03-11T11:08:16.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14357767","id":"14357767","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/storm/pull/456#issuecomment-78392307\n  \n    Why do we want to distinguish between different errors in the exit code?  \n    \n    I would rather see the commands themselves handle this instead of the python code, the coupling between the script and the java code is too high for me to feel comfortable relying on this functionality.  If I have a java program that catches the exception and outputs the error differently this code will not work.  What is more the original problem still exists in those cases, and storm will exit with a 0 exit code on error.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-11T23:06:30.638+0000","updated":"2015-03-11T23:06:30.638+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14357827","id":"14357827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on the pull request:\n\n    https://github.com/apache/storm/pull/456#issuecomment-78397516\n  \n    IMHO I agree @revans2, parsing stdout by regular expression would become easily broken by later commits.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-11T23:45:41.473+0000","updated":"2015-03-11T23:45:41.473+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/14369278","id":"14369278","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Lewuathe commented on the pull request:\n\n    https://github.com/apache/storm/pull/456#issuecomment-83543346\n  \n    @revans2 @HeartSaVioR Thank you for reviewing. \n    We should not distinguish error types with exit code. So JVM return code informs us the occurrence of some exception, I'll update to return exit code 1 when any exception has been occurred. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-19T12:50:34.222+0000","updated":"2015-03-19T12:50:34.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/15083760","id":"15083760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/storm/pull/456#issuecomment-169130180\n  \n    @Lewuathe I am sorry that this fell off of my radar.  The code looks great. I am +1\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-05T20:51:49.643+0000","updated":"2016-01-05T20:51:49.643+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/15083819","id":"15083819","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/456\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-05T21:21:01.227+0000","updated":"2016-01-05T21:21:01.227+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12778236/comment/15083822","id":"15083822","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Thanks [~lewuathe],\n\nSorry this took so long to go in.  I merged this into master.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2016-01-05T21:22:22.082+0000","updated":"2016-01-05T21:22:22.082+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-695/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i265iv:"}}