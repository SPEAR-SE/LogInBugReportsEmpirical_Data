{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12829036","self":"https://issues.apache.org/jira/rest/api/2/issue/12829036","key":"STORM-814","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-05-13T00:45:41.678+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu May 14 19:49:41 UTC 2015","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-814/watchers","watchCount":6,"isWatching":false},"created":"2015-05-12T01:13:52.127+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327112","id":"12327112","name":"0.9.3","archived":false,"released":true,"releaseDate":"2014-11-25"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-14T19:49:41.658+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324393","id":"12324393","name":"storm-kafka","description":"Storm Kafka Integration"}],"timeoriginalestimate":null,"description":"I am running few test for storm topology with kafka. \n\nCreated a topic with 16 partitions and emitted 10k messages/sec with each message 1k size.\n\nWhen I set the kafka spout parallelism to 1, I am getting latency of 8.9 ms\n\nbut  when i increase the parallelism to 8, I am getting latency of 1.2 sec.\n\nSettings : \nMAX_SPOUT SPENDING set to 1000-5000\n\nString zkConnString = \"zookeeper1:2181\";\n        String kafkaTopic = \"messages\";\n        String zkRootPath = \"/kafkaStorm\";\n        String zkOffSetID = \"kafka\";\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Kafka Spout performance","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshkuch","name":"rajeshkuch","key":"rajeshkuch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kucharlapati","active":true,"timeZone":"America/New_York"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshkuch","name":"rajeshkuch","key":"rajeshkuch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kucharlapati","active":true,"timeZone":"America/New_York"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Centos, AWS , M3.2xlarge instances","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12829036/comment/14541117","id":"14541117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rajeshkuch] This is expected behavior. If you want to get optimal throughput your partitions and spout parallelism should match. In your case when you have 16 parttioins and 1 spout parallelism all of the topic partitions will be assigned 1 spout to read from and when you increased it to 8 each of the spout instance gets 2 per spout instance. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-13T00:45:41.678+0000","updated":"2015-05-13T00:45:41.678+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12829036/comment/14541210","id":"14541210","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshkuch","name":"rajeshkuch","key":"rajeshkuch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kucharlapati","active":true,"timeZone":"America/New_York"},"body":"Here is the situation\n\nNo of Partitions : 16\n\nSpout parallelism : 1 then performance is 9ms\nSpout parallelism : 16 then latency is 2 sec.\n\nIt should be the other way. If I have parallelism to same as partitions then the performance should be optimal.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshkuch","name":"rajeshkuch","key":"rajeshkuch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kucharlapati","active":true,"timeZone":"America/New_York"},"created":"2015-05-13T02:28:56.157+0000","updated":"2015-05-13T02:28:56.157+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12829036/comment/14541222","id":"14541222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rajeshkuch] sorry read it the other way round. How is your topology looks like is it only the Kafkaspout in the topology or are there any bolts. Can you also post KafkaSpout config.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-13T02:36:33.248+0000","updated":"2015-05-13T02:36:33.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12829036/comment/14541236","id":"14541236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshkuch","name":"rajeshkuch","key":"rajeshkuch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kucharlapati","active":true,"timeZone":"America/New_York"},"body":"Here is the bolt latency information\n\nbol2\t32\t32\t2123660\t2123660\t0.035\t1.081\t2123620\t1.069\t2123520\t0\t\t\t\nbolt3\t8\t8\t2120980\t0\t       0.095\t        0.906\t2121280\t0.908\t2121280\t0\t\t\t\nbolt1\t8\t8\t2124180\t2124180\t0.090\t0.957\t2125860\t0.950\t2125840\t0\n\nKafka spout information\n\nSpouts (All time)\nkafkaspout\t8\t8\t2125680\t2125680\t2050.919\t2116780\t0\t\n\n\nIts simple topology with total execution less than 3 ms. I am running this topology with 4 supervisors with one worker node each.\n\nThere are no specific config info set on kafka spout. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshkuch","name":"rajeshkuch","key":"rajeshkuch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kucharlapati","active":true,"timeZone":"America/New_York"},"created":"2015-05-13T02:53:17.751+0000","updated":"2015-05-13T02:53:17.751+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12829036/comment/14541253","id":"14541253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ncleung","name":"ncleung","key":"ncleung","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nathan Leung","active":true,"timeZone":"Etc/UTC"},"body":"How is your data pushed to kafka?  It is plausible that the numbers you see are due to max spout pending.\n\nIf you are receiving data in bursts, you would pull them off much faster with 8 spouts than 1.  Then the spout output queues would be relatively large in size, and since the tuple is sitting in the output queue longer, the overall latency is higher.  The burstiness would account for low bolt capacity figures; typically high spout output queue sizes correlate with higher bolt utilization than you're seeing.\n\nAnyways, it seems odd to me to point at a very specific application profile and then come to the conclusion that there is a bug in the spout.  You should run your tests with spout only and do throughput tests.  If you can pull less data off of kafka with 8 spouts than 1, then I would agree that something is odd.  But even that (purely hypothetical situation) would seem to be more likely to sit with the kafka client than with the storm implementation of kafka spout.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ncleung","name":"ncleung","key":"ncleung","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nathan Leung","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-13T03:19:14.566+0000","updated":"2015-05-13T03:19:14.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12829036/comment/14544255","id":"14544255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshkuch","name":"rajeshkuch","key":"rajeshkuch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kucharlapati","active":true,"timeZone":"America/New_York"},"body":"I ran the same test with one spout only and here is are the results\n\nTotal No of partitions : 8\n\nTest 1:\nKafka Spout parallelism : 8 \nLatency : 1.649\nSpout Pending : 1000\n\nTest2\nKafka Spout parallelism : 1 \nLatency : 1.149\nSpout Pending : 8000\n\nSame test with one spout and one bolt\n\nTest 1:\nKafka Spout parallelism : 8 \nLatency : 23 ms\nSpout Pending : 1000\n\nTest2\nKafka Spout parallelism : 1 \nLatency : 1.7 ms\nSpout Pending : 8000\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshkuch","name":"rajeshkuch","key":"rajeshkuch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kucharlapati","active":true,"timeZone":"America/New_York"},"created":"2015-05-14T19:49:41.658+0000","updated":"2015-05-14T19:49:41.658+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-814/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2elen:"}}