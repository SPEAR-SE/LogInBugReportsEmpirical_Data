{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12787066","self":"https://issues.apache.org/jira/rest/api/2/issue/12787066","key":"STORM-738","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-03-31T21:36:46.604+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jun 23 21:37:28 UTC 2015","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-738/watchers","watchCount":2,"isWatching":false},"created":"2015-03-31T15:53:00.488+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327123","id":"12327123","description":"security feature branch","name":"0.10.0","archived":false,"released":true,"releaseDate":"2015-11-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12328864","id":"12328864","name":"0.9.3-rc2","archived":false,"released":true},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329548","id":"12329548","name":"0.9.4","archived":false,"released":true,"releaseDate":"2015-03-25"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329843","id":"12329843","name":"1.0.0","archived":false,"released":true,"releaseDate":"2016-04-12"}],"customfield_12312339":null,"issuelinks":[{"id":"12420501","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12420501","type":{"id":"12310060","name":"Container","inward":"Is contained by","outward":"contains","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310060"},"outwardIssue":{"id":"12818770","key":"STORM-758","self":"https://issues.apache.org/jira/rest/api/2/issue/12818770","fields":{"summary":"Very busy ShellBolt subprocess with Non-ACK mode cannot respond heartbeat just in time","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12412447","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12412447","type":{"id":"12310060","name":"Container","inward":"Is contained by","outward":"contains","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310060"},"outwardIssue":{"id":"12787168","key":"STORM-742","self":"https://issues.apache.org/jira/rest/api/2/issue/12787168","fields":{"summary":"Very busy ShellBolt subprocess with ACK mode cannot respond heartbeat just in time","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12412928","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12412928","type":{"id":"12310060","name":"Container","inward":"Is contained by","outward":"contains","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310060"},"outwardIssue":{"id":"12788337","key":"STORM-756","self":"https://issues.apache.org/jira/rest/api/2/issue/12788337","fields":{"summary":"[multilang] Introduce overflow control mechanism","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-09-29T02:49:00.953+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327951","id":"12327951","name":"storm-multilang","description":"Storm integration with other programming languages"}],"timeoriginalestimate":null,"description":"hi, all\n\nwe have a topology, which have 3 components(spout->parser->saver) and the parser is Multilang bolt with python. We do not use ACK mechanism.\n\nwe found 2 problems with Mutilang python script.\n1) the parser python scripts may hold too many tuples and consume too many memory;\n2) with MultiLang heartbeat mechanism described by  https://issues.apache.org/jira/browse/STORM-513, the python script always timeout to heartbeat, even when the parser bolt is normal, cause supervisor to restart itself.\n\n!storm_multilang.png!\n\nShellBolt process === Father-Process\nPythonScript process === Child-Process\n\nThe reason is :\n1) when topology do not use ACK mechanism, the spout do not have Overflow-control ability, if the stream have too many tuples comes,  spout will send all the tuples to parser's ShellBolt process(Father-Process);\n2) parser's ShellBolt process just put the tuples to _pendingWrites queue, if the _pendingWrites queue does not have limit;\n3) parser's PythonScript process(Child-Process) call readMsg() to read a tuple from STDIN, handle the tuple, and emit a new tuple to its father process through STDOUT, and then call readTaskIds() from STDIN.  Because Father-Process's queue already have too many other tuples, Child-Process will read all the tuples to pending_commands, util received TaskIds.\n4) so Child-Process process's pending_commands may contains too many tuples and consume too many memory.\n\nAs to heartbeat, because there are too many pending_commands need Child-Process to handle, and Child-Process's every emit operation will need more I/O read operations from STDIN. It may need 10 seconds to handle one tuple, and this will cause the heartbeat tuple not handle quickly, and timeout will happen.\n\nEven if Father-Process's _pendingWrites have limits, for example 1000, Child-Process may needs 1000 x 1000 read operations then it can handle the heartbeat tuple.\n\n[~revans2] [~kabhwan] this related to Multilang and heartbeat, please help to confirm the two problems.\n\nI think Father-Process and Child-Process need Overflow-Control Protocol to control the python script's memory usage.\nAnd heartbeat tuple needs a separate queue(pending_heartbeats), and Child-Process handle heartbeat tuple at high priority. [~kabhwan] wish to hear your opinion.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12708444","id":"12708444","filename":"storm_multilang.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-31T15:54:03.135+0000","size":63409,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12708444/storm_multilang.png"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Multilang needs Overflow-Control mechanism and HeartBeat timeout problem","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":"2015-03-31","customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14389461","id":"14389461","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"[~dashengju]\nLet me say about heartbeat timeout issue.\n\nFirst, I described a constraint from at first of PR, and you encounter this situation.\nhttps://github.com/apache/storm/pull/286#issuecomment-58366793\n\nBelow links are describing why I introduce this constraint.\nhttps://github.com/apache/storm/pull/286#issuecomment-61719213\nhttps://github.com/apache/storm/pull/286#issuecomment-62295232\nhttps://github.com/apache/storm/pull/286#issuecomment-62295379\n\nSecond, it is actually a bug. ;(\nIn ShellSpout heartbeat is updated whether message from subprocess is sync or not. So we can avoid constraint which I described already.\nBut it doesn't applied to ShellBolt. \nI will take care of it. Thanks for letting me know!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-03-31T21:36:46.604+0000","updated":"2015-03-31T21:36:46.604+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14389520","id":"14389520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"About overflow-control, I don't think it's good for ShellBolt to see subprocess memory usage cause it's on JVM.\n\nActually I think it is a natural behavior. If you use normal Bolt, your JVM process will have an issue unless you increase enough parallelism or worker count.\nSubprocess still have a chance to launch threads or processes to take care of flooding tuples. In this situation launching threads seems not resolve this issue cause it is a parser and python (normally) uses GIL.\n\nCould you have more Parser ShellBolt workers and see it helps?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-03-31T22:18:51.761+0000","updated":"2015-03-31T22:18:51.761+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14389876","id":"14389876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"body":"[~kabhwan]  \nWith normal JVM bolt, all tuples are cached in Netty, and we can limit the jvm memory size. So it will not consume all the machine's memory.\n\nBut with python bolt, the python process's memory can not control. \nI do not think it's good for ShellBolt to see subprocess memory usage. I think we can limit Python script's queue size, when the queue is getting full, It can tell the ShellBolt's writerThread just stop send tuples.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-01T02:04:15.556+0000","updated":"2015-04-01T02:04:15.556+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14389885","id":"14389885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"AFAIK it would be a comparison between OOME from one worker (JVM) and OOM issue from OS.\nSeems like we can't avoid both things with your situation (we cannot block flooding tuples with unacked, am I right?), but definitely latter is more dangerous.\n\nIt's about the strategy, so I'd like to hear opinion from other contributors and committers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-01T02:12:51.138+0000","updated":"2015-04-01T02:12:51.138+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14389941","id":"14389941","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"body":"Yes, It's more dangerous in OOM issue from OS. It affect other normal topology.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-01T03:46:45.376+0000","updated":"2015-04-01T03:46:45.376+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14394106","id":"14394106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"I thought overflow-control once more, and there seems to two different approaches to get over.\n\nA. ShellBolt side control\n\nWe can modify ShellBolt to have sent tuple ids list, and stop sending tuples when list exceeds configured max value. In order to achieve this, subprocess should notify \"tuple id is complete\" to ShellBolt.\n\n- It introduces new commands for multi-lang, \"proceed\" (or better name)\n- ShellBolt stores in-progress-of-processing tuples list.\n- Its overhead could be big, subprocess should always notify to ShellBolt when any tuples are processed. \n\nB. subprocess side control\n\nWe can modify subprocess to check pending queue after reading tuple.\nIf it exceeds configured max value, subprocess can request \"delay\" to ShellBolt for slowing down.\nWhen ShellBolt receives \"delay\", BoltWriterRunnable should stop polling pending queue and continue polling later.\n\nHow long ShellBolt wait for resending? Its unit would be \"delay time\" or \"tuple count\". I don't know which is better yet.\n\n- It introduces new commands for multi-lang, \"delay\" (or better name)\n- I don't think it would be introduced soon, but subprocess can request delay based on own statistics. (ex. pending tuple count * average tuple processed time for time unit, average pending tuple count for count unit)\n-- We can leave when and how much to request \"delay\" to user. User can make his/her own algorithm to control flooding.\n\nIn my opinion B seems to more natural cause current issue is by subprocess side so it would be better to let subprocess overcome it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-03T05:54:54.137+0000","updated":"2015-04-03T05:54:54.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14396246","id":"14396246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Filed an issue (https://issues.apache.org/jira/browse/STORM-756) and pull request based on this idea.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-05T14:20:36.393+0000","updated":"2015-04-05T14:20:36.393+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14482325","id":"14482325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Please note that design constraint still exists when subprocess handles tuples which takes very long time.\nI'll take care of 'very busy bolt' only.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-07T00:47:08.447+0000","updated":"2015-04-07T00:47:08.447+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14482655","id":"14482655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"body":"[~kabhwan]  I have two questions about heartbeat mechanism:\n1) I think the heartbeat mechanism should not related to ACK or NON-ACK mechanism. I means heartbeat should not rely on  ACK or NON-ACK, or else.\n2) the heartbeat design constraint(subprocess is alive but cannot process \"heartbeat\" tuple in time) is always happen. For example: a) if ShellBolt handle one tuple need more time, may exceed the timeout, but it handle other tuples quickly;  b)  currently, the ShellBolt handle one tuple, emit the result, and read all the tuples from stdin to get the id,  read all the tuples from stdin needs long time, which cause exceed timeout. So I think we should remove the  heartbeat design constraint. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-07T06:08:26.685+0000","updated":"2015-04-07T06:08:26.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14482797","id":"14482797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Let me reply your questions.\n\nFirst of all, please refer https://github.com/apache/storm/pull/286#issuecomment-61719213 for some backgrounds.\n\nWe already know that it's better to remove design constraint, by letting subprocess sending heartbeat periodically.\nTo tell the truth, issue lies on 'multi-lang'.\nThreads should read/write stdin/stdout with synchronized, but I don't know PHP / Perl supports this.\n\nIt's up to Storm Community to make a decision, dropping some languages if it cannot support.\nAfter decision, I'll remove design constraint and make it work. \n(Though I need to help with node.js implementation. :) )","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-07T08:32:24.968+0000","updated":"2015-04-07T08:32:24.968+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12787066/comment/14598420","id":"14598420","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"[~dashengju]\nVia STORM-738 I removed the heartbeat design constraint, by let subprocess updates local pid file periodically.\nIf it is accepted, whole heartbeat timeout issues should be resolved.\nCould you check it makes sense?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-06-23T21:37:28.716+0000","updated":"2015-06-23T21:37:28.716+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-738/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i27ljz:"}}