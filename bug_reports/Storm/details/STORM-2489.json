{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13066226","self":"https://issues.apache.org/jira/rest/api/2/issue/13066226","key":"STORM-2489","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":10800,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339656","id":"12339656","name":"1.1.1","archived":false,"released":true,"releaseDate":"2017-08-01"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341047","id":"12341047","name":"1.2.0","archived":false,"released":true,"releaseDate":"2018-02-15"}],"aggregatetimespent":10800,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-04-24T05:20:13.368+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed May 03 03:36:02 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3135654923_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-05-30T10:20:43.469+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2489/watchers","watchCount":2,"isWatching":false},"created":"2017-04-24T03:19:48.593+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335747","id":"12335747","name":"1.0.2","archived":false,"released":true,"releaseDate":"2016-08-10"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-03T15:12:23.612+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"The attachment is my test script, one of my test results is:\n```\nexpired=1...55\nget=56...4024\nnew=56...4024\nRecived=3969,RecivedTotal=3969\nexpired=56...4020\nget=4021...8191\nnew=4025...8191\nRecived=4171,RecivedTotal=8140\nSendTotal=12175\nexpired=4021...8188\nget=8189...12175\nnew=8192...12175\nRecived=3987,RecivedTotal=12127\n```\nThis test result shows that some tuples appear in the expired list directly, we lost these data if we just use get() to get tuples, this is the first bug.\nThe second: the tuples of get() has overlap, the getNew() seems alright.\n\nThe problem not happen definitely, may need to try several times.\n\nActually, I'm newbie about storm, so I'm not sure this is a bug indeed, or, I use it in wrong way?","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"3h","remainingEstimateSeconds":0,"timeSpentSeconds":10800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12864700","id":"12864700","filename":"TumblingWindowIssue.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"created":"2017-04-24T03:19:48.629+0000","size":3804,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12864700/TumblingWindowIssue.java"}],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Overlap and data loss on WindowedBolt based on Duration","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":10800,"total":10800,"percent":100},"environment":"windows 10, eclipse, jdk1.7","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10431","value":"Important","id":"10431"}],"progress":{"progress":10800,"total":10800,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15980736","id":"15980736","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"body":"[~wangkui] thanks for reporting the issue. Processing-time based windows internally uses a ScheduledExecutor. It maybe that the tasks are not triggered exactly after the tumbling window interval causing some overlap. To debug further, can you also print the window end timestamp (https://github.com/apache/storm/blob/master/storm-client/src/jvm/org/apache/storm/windowing/Window.java#L55) each time the execute is invoked? \"getEndTimestamp\" returns the reference processing time which is used to calculate the window boundaries.\n\nYou will need build storm from the latest master and run your examples against that since \"getEndTimestamp\" is not available in any of the released versions of storm.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-04-24T05:20:13.368+0000","updated":"2017-04-24T05:20:13.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15982316","id":"15982316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"body":"[~arunmahadevan] Sorry for late response, call on getStartTimestamp() and getEndTimestamp(), I got following log:\nTimestamp_start-end=1493089795102-1493089800102\nexpired=1...56\nget=57...4085\nnew=57...4085\nRecived=4029,RecivedTotal=4029\nTimestamp_start-end=1493089800101-1493089805101\nexpired=57...4084\nget=4085...8049\nnew=4086...8049\nRecived=3965,RecivedTotal=7994\nSendTotal=11705\nTimestamp_start-end=1493089805102-1493089810102\nexpired=4085...8047\nget=8048...11705\nnew=8050...11705\nRecived=3658,RecivedTotal=11652\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"created":"2017-04-25T03:26:30.811+0000","updated":"2017-04-25T03:26:30.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15982487","id":"15982487","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"body":"[~wangkui], posted a potential fix - https://github.com/apache/storm/pull/2090\n\nYou might want to try your tests with the patch (you can apply the patch or clone https://github.com/arunmahadevan/storm/tree/STORM-2489)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-04-25T07:20:00.777+0000","updated":"2017-04-25T07:20:00.777+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15984353","id":"15984353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"body":"[~arunmahadevan] I tested several times with your patch, now it seems all right, no tuples overlap. Thank you!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"created":"2017-04-26T08:16:32.337+0000","updated":"2017-04-26T08:16:32.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15984368","id":"15984368","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"body":"[~arunmahadevan] Eh, it still lose data, following is one test result, and you can see that the 15073 is lost:\nTimestamp_start-end=1493195565070-1493195570070\nexpired=\nget=1...3757\nnew=1...3757\nRecived=3757,RecivedTotal=3757\nTimestamp_start-end=1493195570070-1493195575070\nexpired=1...3757\nget=3758...7579\nnew=3758...7579\nRecived=3822,RecivedTotal=7579\nTimestamp_start-end=1493195575070-1493195580070\nexpired=3758...7579\nget=7580...11276\nnew=7580...11276\nRecived=3697,RecivedTotal=11276\nTimestamp_start-end=1493195580070-1493195585070\nexpired=7580...11276\nget=11277...15072\nnew=11277...15072\nRecived=3796,RecivedTotal=15072\nSendTotal=15162\nTimestamp_start-end=1493195585070-1493195590070\nexpired=11277...15073\nget=15074...15162\nnew=15074...15162\nRecived=89,RecivedTotal=15161","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"created":"2017-04-26T08:38:22.570+0000","updated":"2017-04-26T08:38:22.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15984369","id":"15984369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"body":"[~wangkui] thanks for the update. I made some minor changes to the patch today. If you could pull the latest changes and run your tests a few times will be great. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-04-26T08:38:27.996+0000","updated":"2017-04-26T08:38:27.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15984426","id":"15984426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"body":"[~wangkui], I made some minor tweak to process the tuples with some time offset, please pull the current changes and test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-04-26T09:18:07.686+0000","updated":"2017-04-26T09:18:07.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15984429","id":"15984429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"body":"[~arunmahadevan] I pull and test again, yes, no tuple lost now. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"created":"2017-04-26T09:18:38.078+0000","updated":"2017-04-26T09:18:38.078+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15984624","id":"15984624","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"body":"[~wangkui], when you get some time can you pull the updated changes and test again ? The earlier approach might have issues if the clock continuously drifts and lead to lost and overlapping tuples. I made some changes to address it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-04-26T11:36:42.217+0000","updated":"2017-04-26T11:36:42.217+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15986049","id":"15986049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"body":"[~arunmahadevan] I test again, as the same arguments as before, it seems all right. But when I make the spout emit more frequently, the ahead tuples are expired, following test I spout data with out sleep() and use Duration(4sec) window bolt, \nTimestamp_start-end=1493271145887-1493271149887\nexpired=1...291972\nget=291973...1189440\nnew=291973...1189440\nRecived=897468,RecivedTotal=897468\n13:32:34.470 [pool-45-thread-1] WARN  o.a.s.w.TimeEvictionPolicy - Possible clock drift or long running computation in window; Previous eviction time: 1493271149887, current eviction time: 1493271154469\nTimestamp_start-end=1493271150469-1493271154469\nexpired=291973...1189440\nget=1189441...2888803\nnew=1189441...2888803\nRecived=1699363,RecivedTotal=2596831\n13:32:39.213 [pool-45-thread-1] WARN  o.a.s.w.TimeEvictionPolicy - Possible clock drift or long running computation in window; Previous eviction time: 1493271154469, current eviction time: 1493271159212\nSendTotal=5435440\nTimestamp_start-end=1493271155212-1493271159212\nexpired=1189441...2888803\nget=2888804...5069647\nnew=2888804...5069647\nRecived=2180844,RecivedTotal=4777675\n13:32:42.311 [pool-45-thread-1] WARN  o.a.s.w.TimeEvictionPolicy - Possible clock drift or long running computation in window; Previous eviction time: 1493271159212, current eviction time: 1493271162310\nTimestamp_start-end=1493271158310-1493271162310\nexpired=2888804...5069647\nget=5069648...5435440\nnew=5069648...5435440\nRecived=365793,RecivedTotal=5143468\n13:32:45.195 [pool-45-thread-1] WARN  o.a.s.w.TimeEvictionPolicy - Possible clock drift or long running computation in window; Previous eviction time: 1493271162310, current eviction time: 1493271165194\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"created":"2017-04-27T05:41:04.418+0000","updated":"2017-04-27T05:41:04.418+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15992758","id":"15992758","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"body":"[~wangkui], the initial tuples expired because the trigger was not fired exactly after the window interval but after a delay. When I tested in local mode with spout emitting without a delay, the trigger happened after 6s (for a 4s tumbling window). This may be because the system is overwhelmed with data and not able to schedule the trigger thread on time. In this case the initial tuples (0 - 2s) will not be considered in the first window. \n\nTypically the window duration should be such that all the tuples within a window can be processed before the next window trigger, otherwise the next window trigger will be delayed and it will lead to incorrect results. You should use a real cluster with multiple hosts/workers and split the data among these workers to handle such high data rates.\n\nAnother option would be to use event time windows where each event contains a \"timestamp\" field and the window calculations are done based on the actual event time instead of system time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-05-02T11:41:30.680+0000","updated":"2017-05-02T11:43:41.422+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/comment/15994230","id":"15994230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"body":"[~arunmahadevan] So that's it, I got, thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wangkui","name":"wangkui","key":"wangkui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangkui","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-03T03:36:02.921+0000","updated":"2017-05-03T03:36:02.921+0000"}],"maxResults":12,"total":12,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2489/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":19,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/41923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user arunmahadevan opened a pull request:\n\n    https://github.com/apache/storm/pull/2090\n\n    STORM-2489: Overlap and data loss on WindowedBolt based on Duration\n\n    - Fixed time eviction to not evict events beyond current timestamp.\n    - Modified time trigger to compute the reference tim based on window duration.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/arunmahadevan/storm STORM-2489\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2090.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2090\n    \n----\ncommit 09cf77bb84ddcf5ab05757ac4f72ab1d20cf1e82\nAuthor: Arun Mahadevan <arunm@apache.org>\nDate:   2017-04-25T07:07:43Z\n\n    STORM-2489: Overlap and data loss on WindowedBolt based on Duration\n    \n    - Fixed time eviction to not evict events beyond current timestamp.\n    - Modified time trigger to compute the reference tim based on window duration.\n\n----\n","created":"2017-04-25T07:16:03.100+0000","updated":"2017-04-25T07:16:03.100+0000","started":"2017-04-25T07:16:03.100+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"41923","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/41935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user harshach commented on the issue:\n\n    https://github.com/apache/storm/pull/2090\n  \n    +1\n","created":"2017-04-25T15:38:14.487+0000","updated":"2017-04-25T15:38:14.487+0000","started":"2017-04-25T15:38:14.485+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"41935","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/41981","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r113366037\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -109,13 +112,22 @@ private Runnable newTriggerTask() {\n             return new Runnable() {\n                 @Override\n                 public void run() {\n    +                // compute the current trigger timestamp based on prevTriggerTimestamp,\n    +                // since the calculation based on System.currentTimeMillis might have a slight drift\n    +                long now = System.currentTimeMillis();\n    +                long triggerTs = prevTriggerTimestamp == 0 ? now : prevTriggerTimestamp + duration;\n    +                prevTriggerTimestamp = triggerTs;\n    +                if (Math.abs(triggerTs - now) > 1000) {\n    --- End diff --\n    \n    Did we think about an option to execute a bolt in a different thread to avoid timing issues in trigger because of user code?\n","created":"2017-04-26T05:03:12.456+0000","updated":"2017-04-26T05:03:12.456+0000","started":"2017-04-26T05:03:12.456+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"41981","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/41982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r113363343\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -62,7 +63,9 @@ public void reset() {\n     \n         @Override\n         public void start() {\n    -        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), duration, duration, TimeUnit.MILLISECONDS);\n    +        // initial delay is slightly less than the duration so that the initial tuples wont't expire due to time drift\n    +        long initialDelay = duration - Math.min((long) (duration * .1), 100);\n    +        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), initialDelay, duration, TimeUnit.MILLISECONDS);\n    --- End diff --\n    \n    If the initial delay is slightly less than the given duration then its subsequent scheduling will happen after the given period of initialDelay which can be earlier than expected. Is not it?\n","created":"2017-04-26T05:03:12.459+0000","updated":"2017-04-26T05:03:12.459+0000","started":"2017-04-26T05:03:12.456+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"41982","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/41985","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r113368411\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -62,7 +63,9 @@ public void reset() {\n     \n         @Override\n         public void start() {\n    -        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), duration, duration, TimeUnit.MILLISECONDS);\n    +        // initial delay is slightly less than the duration so that the initial tuples wont't expire due to time drift\n    +        long initialDelay = duration - Math.min((long) (duration * .1), 100);\n    +        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), initialDelay, duration, TimeUnit.MILLISECONDS);\n    --- End diff --\n    \n    Subsequent scheduling will happen after \"duration\" which would be the window sliding interval.\n","created":"2017-04-26T05:30:55.552+0000","updated":"2017-04-26T05:30:55.552+0000","started":"2017-04-26T05:30:55.551+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"41985","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/41986","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r113368417\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -109,13 +112,22 @@ private Runnable newTriggerTask() {\n             return new Runnable() {\n                 @Override\n                 public void run() {\n    +                // compute the current trigger timestamp based on prevTriggerTimestamp,\n    +                // since the calculation based on System.currentTimeMillis might have a slight drift\n    +                long now = System.currentTimeMillis();\n    +                long triggerTs = prevTriggerTimestamp == 0 ? now : prevTriggerTimestamp + duration;\n    +                prevTriggerTimestamp = triggerTs;\n    +                if (Math.abs(triggerTs - now) > 1000) {\n    --- End diff --\n    \n    The timing issues are due to the scheduled executor (which uses nanoTime) which does not exactly trigger after the duration when measured with System.currentTimeMillis. Theres a mismatch of a few ms, which is addressed here. In general user code is expected to return before the next trigger. If user code takes more time than the trigger interval still we set the next trigger timestamp correctly and execute as soon as they return from execute, but this should be very rare and users are not expected to do this, so we log the warning. I don't think we want multiple concurrent executes (i.e trigger execute when they haven't returned from the first execute)\n","created":"2017-04-26T05:30:58.750+0000","updated":"2017-04-26T05:30:58.750+0000","started":"2017-04-26T05:30:58.750+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"41986","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/41990","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r113369191\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -62,7 +63,9 @@ public void reset() {\n     \n         @Override\n         public void start() {\n    -        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), duration, duration, TimeUnit.MILLISECONDS);\n    +        // initial delay is slightly less than the duration so that the initial tuples wont't expire due to time drift\n    +        long initialDelay = duration - Math.min((long) (duration * .1), 100);\n    +        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), initialDelay, duration, TimeUnit.MILLISECONDS);\n    --- End diff --\n    \n    subsequentTrigger(x) = initialDelay + x*(delay)\n    Right, but the subsequent triggers may happen earlier as the initialDelay is slightly reduced.\n    \n\n","created":"2017-04-26T05:40:18.818+0000","updated":"2017-04-26T05:40:18.818+0000","started":"2017-04-26T05:40:18.818+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"41990","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/41991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r113369572\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -109,13 +112,22 @@ private Runnable newTriggerTask() {\n             return new Runnable() {\n                 @Override\n                 public void run() {\n    +                // compute the current trigger timestamp based on prevTriggerTimestamp,\n    +                // since the calculation based on System.currentTimeMillis might have a slight drift\n    +                long now = System.currentTimeMillis();\n    +                long triggerTs = prevTriggerTimestamp == 0 ? now : prevTriggerTimestamp + duration;\n    +                prevTriggerTimestamp = triggerTs;\n    +                if (Math.abs(triggerTs - now) > 1000) {\n    --- End diff --\n    \n    OK, Throwing warning incase of large drifts looks fine for now.\n    \n    Multiple concurrent executes will not happen as there is only one thread which executes the bolt and the subsequent bolt executions wait till the current execution is done.\n    \n\n","created":"2017-04-26T05:44:25.981+0000","updated":"2017-04-26T05:44:25.981+0000","started":"2017-04-26T05:44:25.980+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"41991","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/41996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r113383001\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -62,7 +63,9 @@ public void reset() {\n     \n         @Override\n         public void start() {\n    -        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), duration, duration, TimeUnit.MILLISECONDS);\n    +        // initial delay is slightly less than the duration so that the initial tuples wont't expire due to time drift\n    +        long initialDelay = duration - Math.min((long) (duration * .1), 100);\n    +        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), initialDelay, duration, TimeUnit.MILLISECONDS);\n    --- End diff --\n    \n    We cant't guarantee the absolute time at which the trigger will fire since it depends on when and how long storm takes to initialize the bolt. Only the relative time difference between two window firings can be guaranteed. The issue was that the first trigger was firing a few milliseconds after the duration which was causing the initial tuples to directly expire. I have refactored the logic to not depend on the initial delay being slightly lesser.\n","created":"2017-04-26T07:32:17.024+0000","updated":"2017-04-26T07:32:17.024+0000","started":"2017-04-26T07:32:17.021+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"41996","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43220","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r117821993\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -62,7 +62,9 @@ public void reset() {\n     \n         @Override\n         public void start() {\n    -        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), duration, duration, TimeUnit.MILLISECONDS);\n    +        // initial delay is slightly less than the duration so that the initial tuples wont't expire due to time drift\n    +        long initialDelay = duration - Math.min((long) (duration * .1), 10);\n    +        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), initialDelay, duration, TimeUnit.MILLISECONDS);\n    --- End diff --\n    \n    Won't this still be vulnerable to losing initial tuples if the first execution is delayed longer than expected for some reason?\n    \n    I'm wondering if we could make this more reliable by tracking the time we consider expired instead of/in addition to tracking what time it is now. Tuples between the prevExpired timestamp and the nowExpired timestamp are tuples we can't be sure have been processed, so they should be included in the window. Since the expired timestamps also move ~duration every onTrigger, we still get the tuples expired we expect. For the first onTrigger, we can just process all the tuples because we can tell it's the first call since the prevExpired timestamp isn't set yet.\n","created":"2017-05-22T19:04:53.654+0000","updated":"2017-05-22T19:04:53.654+0000","started":"2017-05-22T19:04:53.653+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43220","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on the issue:\n\n    https://github.com/apache/storm/pull/2090\n  \n    I'm wondering if you guys with some experience with windowing would mind taking a look at the question posted in https://github.com/apache/storm/pull/2127? It also has to do with tuples possibly getting expired before they're passed to the user's code, and affects the same policies as this PR.\n","created":"2017-05-22T19:08:36.166+0000","updated":"2017-05-22T19:08:36.166+0000","started":"2017-05-22T19:08:36.165+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43221","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r117826059\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -62,7 +62,9 @@ public void reset() {\n     \n         @Override\n         public void start() {\n    -        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), duration, duration, TimeUnit.MILLISECONDS);\n    +        // initial delay is slightly less than the duration so that the initial tuples wont't expire due to time drift\n    +        long initialDelay = duration - Math.min((long) (duration * .1), 10);\n    +        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), initialDelay, duration, TimeUnit.MILLISECONDS);\n    --- End diff --\n    \n    Also since this is likely going to rely on in-bolt state to avoid expiring tuples before the user sees them, I think we should add to the documentation that this set of policies don't guarantee at-least-once processing.\n","created":"2017-05-22T19:26:37.662+0000","updated":"2017-05-22T19:26:37.662+0000","started":"2017-05-22T19:26:37.662+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43223","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43466","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r118845346\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeTriggerPolicy.java ---\n    @@ -62,7 +62,9 @@ public void reset() {\n     \n         @Override\n         public void start() {\n    -        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), duration, duration, TimeUnit.MILLISECONDS);\n    +        // initial delay is slightly less than the duration so that the initial tuples wont't expire due to time drift\n    +        long initialDelay = duration - Math.min((long) (duration * .1), 10);\n    +        executorFuture = executor.scheduleAtFixedRate(newTriggerTask(), initialDelay, duration, TimeUnit.MILLISECONDS);\n    --- End diff --\n    \n    @srdo, I removed the initial delay and changed the logic so that the initial events are processed in the first window. Subsequent windows will be adjusted so that even if the trigger is slightly off, the events are considered. \n    \n    The processing time windows collects the events into windows based on system timestamp so the user may not see all the events. However the processed events are still guaranteed at-least once based on storm's acking mechanisms. \n    \n    With the proposed patch we do a best effort to slightly adjust the window sizes if the triggers are off and log warnings if it exceeds a threshold.\n","created":"2017-05-28T17:13:10.166+0000","updated":"2017-05-28T17:13:10.166+0000","started":"2017-05-28T17:13:10.165+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43466","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43468","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r118845794\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeEvictionPolicy.java ---\n    @@ -41,8 +47,10 @@ public TimeEvictionPolicy(int windowLength) {\n         public Action evict(Event<T> event) {      \n             long now = evictionContext == null ? System.currentTimeMillis() : evictionContext.getReferenceTime();\n             long diff = now - event.getTimestamp();\n    -        if (diff >= windowLength) {\n    +        if (diff >= (windowLength + delta)) {\n                 return Action.EXPIRE;\n    +        } else if (diff < 0) { // do not process events beyond current ts\n    +            return Action.KEEP;\n    --- End diff --\n    \n    Nitpick: I think the events are ordered when iterated over in WindowManager, so returning Action.STOP might be marginally faster.\n","created":"2017-05-28T17:42:41.080+0000","updated":"2017-05-28T17:42:41.080+0000","started":"2017-05-28T17:42:41.079+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43468","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43469","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r118845758\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeEvictionPolicy.java ---\n    @@ -54,7 +62,22 @@ public void track(Event<T> event) {\n     \n         @Override\n         public void setContext(EvictionContext context) {\n    -        this.evictionContext = context;\n    +        EvictionContext prevContext = evictionContext;\n    +        evictionContext = context;\n    +        // compute window length adjustment (delta) to account for time drift\n    +        if (context != null && context.getSlidingInterval() != null) {\n    --- End diff --\n    \n    Nitpick: I'd rather not check for null unless there's a good reason. As far as I can tell there's no reason to reset the EvictionContext to null, so I'd rather we get an NPE if it happens unexpectedly, so we can fix what is likely a bug.\n","created":"2017-05-28T17:42:41.217+0000","updated":"2017-05-28T17:42:41.217+0000","started":"2017-05-28T17:42:41.216+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43469","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on the issue:\n\n    https://github.com/apache/storm/pull/2090\n  \n    +1\n","created":"2017-05-28T17:48:16.574+0000","updated":"2017-05-28T17:48:16.574+0000","started":"2017-05-28T17:48:16.574+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43470","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43472","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r118846419\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeEvictionPolicy.java ---\n    @@ -41,8 +47,10 @@ public TimeEvictionPolicy(int windowLength) {\n         public Action evict(Event<T> event) {      \n             long now = evictionContext == null ? System.currentTimeMillis() : evictionContext.getReferenceTime();\n             long diff = now - event.getTimestamp();\n    -        if (diff >= windowLength) {\n    +        if (diff >= (windowLength + delta)) {\n                 return Action.EXPIRE;\n    +        } else if (diff < 0) { // do not process events beyond current ts\n    +            return Action.KEEP;\n    --- End diff --\n    \n    yes, ideally events should be ordered since its processing time, unless `System.currentTimeMillis` goes backwards, so I assumed it could be out of order.\n","created":"2017-05-28T18:15:06.829+0000","updated":"2017-05-28T18:15:06.829+0000","started":"2017-05-28T18:15:06.828+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43472","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2090#discussion_r118846424\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/windowing/TimeEvictionPolicy.java ---\n    @@ -54,7 +62,22 @@ public void track(Event<T> event) {\n     \n         @Override\n         public void setContext(EvictionContext context) {\n    -        this.evictionContext = context;\n    +        EvictionContext prevContext = evictionContext;\n    +        evictionContext = context;\n    +        // compute window length adjustment (delta) to account for time drift\n    +        if (context != null && context.getSlidingInterval() != null) {\n    --- End diff --\n    \n    Addressed\n","created":"2017-05-28T18:15:15.602+0000","updated":"2017-05-28T18:15:15.602+0000","started":"2017-05-28T18:15:15.601+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43473","issueId":"13066226"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13066226/worklog/43526","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2090\n","created":"2017-05-30T09:19:08.752+0000","updated":"2017-05-30T09:19:08.752+0000","started":"2017-05-30T09:19:08.752+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"43526","issueId":"13066226"}]},"customfield_12311820":"0|i3dzmn:"}}