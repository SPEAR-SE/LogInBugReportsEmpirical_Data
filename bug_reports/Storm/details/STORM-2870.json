{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13127296","self":"https://issues.apache.org/jira/rest/api/2/issue/13127296","key":"STORM-2870","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":9600,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341047","id":"12341047","name":"1.2.0","archived":false,"released":true,"releaseDate":"2018-02-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341265","id":"12341265","name":"1.1.2","archived":false,"released":true,"releaseDate":"2018-02-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341596","id":"12341596","name":"1.0.6","archived":false,"released":true,"releaseDate":"2018-02-14"}],"aggregatetimespent":9600,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Dec 28 04:28:52 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3864764_*|*_3_*:*_1_*:*_90867823_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-12-28T04:28:52.461+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2870/watchers","watchCount":1,"isWatching":false},"created":"2017-12-27T02:09:59.954+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341047","id":"12341047","name":"1.2.0","archived":false,"released":true,"releaseDate":"2018-02-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341265","id":"12341265","name":"1.1.2","archived":false,"released":true,"releaseDate":"2018-02-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341596","id":"12341596","name":"1.0.6","archived":false,"released":true,"releaseDate":"2018-02-14"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-12-28T04:28:52.518+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"{code}\r\n    private void setUpFlushTask() {\r\n        ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();\r\n        Runnable task = new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                try {\r\n                    if(dirty) {\r\n                        eventLogWriter.flush();\r\n                        dirty = false;\r\n                    }\r\n                } catch (IOException ex) {\r\n                    LOG.error(\"Error flushing \" + eventLogPath, ex);\r\n                    throw new RuntimeException(ex);\r\n                }\r\n            }\r\n        };\r\n\r\n        scheduler.scheduleAtFixedRate(task, FLUSH_INTERVAL_MILLIS, FLUSH_INTERVAL_MILLIS, TimeUnit.MILLISECONDS);\r\n}\r\n{code}\r\n\r\nThe code block initializes ExecutorService locally, which served threads are not daemons so it can prevent JVM to be exit successfully.\r\n\r\nMoreover it should be considered as bad case: not labeling thread name. I observed the process hung and got jstack, but hard to know where is the root, because leaked thread has default thread name.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"2h 40m","remainingEstimateSeconds":0,"timeSpentSeconds":9600},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"FileBasedEventLogger leaks non-daemon ExecutorService which prevents process to be finished","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":9600,"total":9600,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":9600,"total":9600,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/comment/16305046","id":"16305046","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Merged into master, 1.x, 1.1.x, 1.0.x branches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2017-12-28T04:28:52.510+0000","updated":"2017-12-28T04:28:52.510+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2870/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":17,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user HeartSaVioR opened a pull request:\n\n    https://github.com/apache/storm/pull/2482\n\n    STORM-2870 Properly shutdown ExecutorService in FileBasedEventLogger\n\n    * extract local variable 'scheduler' to one of fields\r\n    * gracefully shutdown the scheduler\r\n    \r\n    I followed the guide of Javadoc for implementing `closeFlushScheduler()` properly.\r\n    https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ExecutorService.html\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/HeartSaVioR/storm STORM-2870\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2482.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2482\n    \n----\ncommit 1d0621d82140ef58a9644f2750b7944b7a26fab9\nAuthor: Jungtaek Lim <kabhwan@...>\nDate:   2017-12-27T02:52:19Z\n\n    STORM-2870 Properly shutdown ExecutorService in FileBasedEventLogger\n    \n    * extract local variable 'scheduler' to one of fields\n    * gracefully shutdown the scheduler\n\n----\n","created":"2017-12-27T03:08:05.718+0000","updated":"2017-12-27T03:08:05.718+0000","started":"2017-12-27T03:08:05.714+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63525","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user HeartSaVioR opened a pull request:\n\n    https://github.com/apache/storm/pull/2483\n\n    (1.x) STORM-2870 Properly shutdown ExecutorService in FileBasedEventLogger\n\n    * extract local variable 'scheduler' to one of fields\r\n    * gracefully shutdown the scheduler\r\n    \r\n    PR for master branch: #2482 \r\n    I think this can be easily cherry-picked to 1.1.x-branch and 1.0.x-branch.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/HeartSaVioR/storm STORM-2870-1.x\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2483.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2483\n    \n----\ncommit 8597da777d59bff8bc5706e6b649547197859e4b\nAuthor: Jungtaek Lim <kabhwan@...>\nDate:   2017-12-27T02:52:19Z\n\n    STORM-2870 Properly shutdown ExecutorService in FileBasedEventLogger\n    \n    * extract local variable 'scheduler' to one of fields\n    * gracefully shutdown the scheduler\n\n----\n","created":"2017-12-27T03:09:53.774+0000","updated":"2017-12-27T03:09:53.774+0000","started":"2017-12-27T03:09:53.774+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63528","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2483#discussion_r158759249\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/metric/FileBasedEventLogger.java ---\n    @@ -60,8 +64,12 @@ private void initLogWriter(Path logFilePath) {\n     \n     \n         private void setUpFlushTask() {\n    -        ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();\n    -        Runnable task = new Runnable() {\n    +        ThreadFactory threadFactory = new ThreadFactoryBuilder()\n    +                .setNameFormat(\"event-logger-flush-%d\")\n    --- End diff --\n    \n    should we add `setDaemon(true)` ?\n","created":"2017-12-27T03:48:47.144+0000","updated":"2017-12-27T03:48:47.144+0000","started":"2017-12-27T03:48:47.143+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63532","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63533","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on the issue:\n\n    https://github.com/apache/storm/pull/2483\n  \n    +1 LGTM, left one comment.\n","created":"2017-12-27T03:49:58.127+0000","updated":"2017-12-27T03:49:58.127+0000","started":"2017-12-27T03:49:58.126+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63533","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63534","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2482#discussion_r158759325\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/metric/FileBasedEventLogger.java ---\n    @@ -59,8 +62,12 @@ private void initLogWriter(Path logFilePath) {\n     \n     \n         private void setUpFlushTask() {\n    -        ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();\n    -        Runnable task = new Runnable() {\n    +        ThreadFactory threadFactory = new ThreadFactoryBuilder()\n    +                .setNameFormat(\"event-logger-flush-%d\")\n    --- End diff --\n    \n    should we add `setDaemon(true)` ?\n","created":"2017-12-27T03:50:41.682+0000","updated":"2017-12-27T03:50:41.682+0000","started":"2017-12-27T03:50:41.681+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63534","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63535","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on the issue:\n\n    https://github.com/apache/storm/pull/2482\n  \n    +1 LGTM, left one comment.\n","created":"2017-12-27T03:50:48.439+0000","updated":"2017-12-27T03:50:48.439+0000","started":"2017-12-27T03:50:48.438+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63535","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2482#discussion_r158760474\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/metric/FileBasedEventLogger.java ---\n    @@ -120,8 +127,30 @@ protected String buildLogMessage(EventInfo event) {\n         public void close() {\n             try {\n                 eventLogWriter.close();\n    +\n             } catch (IOException ex) {\n                 LOG.error(\"Error closing event log.\", ex);\n             }\n    +\n    +        closeFlushScheduler();\n    +    }\n    +\n    +    private void closeFlushScheduler() {\n    +        if (flushScheduler != null) {\n    +            flushScheduler.shutdown();\n    +            try {\n    +                if (!flushScheduler.awaitTermination(1, TimeUnit.SECONDS)) {\n    --- End diff --\n    \n    nit: You may want to have multiple iterations(which can be 2 or more) with while loop instead of nested if conditionals.\n","created":"2017-12-27T04:14:57.247+0000","updated":"2017-12-27T04:14:57.247+0000","started":"2017-12-27T04:14:57.246+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63538","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2482#discussion_r158760377\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/metric/FileBasedEventLogger.java ---\n    @@ -59,8 +62,12 @@ private void initLogWriter(Path logFilePath) {\n     \n     \n         private void setUpFlushTask() {\n    -        ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();\n    -        Runnable task = new Runnable() {\n    +        ThreadFactory threadFactory = new ThreadFactoryBuilder()\n    +                .setNameFormat(\"event-logger-flush-%d\")\n    --- End diff --\n    \n    By default daemon is set as false, it should be set as true.\n","created":"2017-12-27T04:14:57.248+0000","updated":"2017-12-27T04:14:57.248+0000","started":"2017-12-27T04:14:57.247+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63539","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2482#discussion_r158762585\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/metric/FileBasedEventLogger.java ---\n    @@ -59,8 +62,12 @@ private void initLogWriter(Path logFilePath) {\n     \n     \n         private void setUpFlushTask() {\n    -        ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();\n    -        Runnable task = new Runnable() {\n    +        ThreadFactory threadFactory = new ThreadFactoryBuilder()\n    +                .setNameFormat(\"event-logger-flush-%d\")\n    --- End diff --\n    \n    @arunmahadevan @satishd \r\n    \r\n    I intended to set daemon as false, since I would like to provide a chance to shutdown gracefully, via to wait for current running task to be finished instead of killing immediately.\r\n    Typically `shutdownNow()` will trigger interrupt and run() method looks like be able to handle interrupt (though it will throw RuntimeException).\r\n    \r\n    If we are in favor of guaranteeing JVM shutdown more than graceful shutdown, I'm happy to  change it.\n","created":"2017-12-27T04:58:05.683+0000","updated":"2017-12-27T04:58:05.683+0000","started":"2017-12-27T04:58:05.683+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63549","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63550","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2482#discussion_r158762721\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/metric/FileBasedEventLogger.java ---\n    @@ -120,8 +127,30 @@ protected String buildLogMessage(EventInfo event) {\n         public void close() {\n             try {\n                 eventLogWriter.close();\n    +\n             } catch (IOException ex) {\n                 LOG.error(\"Error closing event log.\", ex);\n             }\n    +\n    +        closeFlushScheduler();\n    +    }\n    +\n    +    private void closeFlushScheduler() {\n    +        if (flushScheduler != null) {\n    +            flushScheduler.shutdown();\n    +            try {\n    +                if (!flushScheduler.awaitTermination(1, TimeUnit.SECONDS)) {\n    --- End diff --\n    \n    Most of cases in codebase we call shutdownNow() and doesn't wait more. I'll follow the case.\n","created":"2017-12-27T05:01:08.157+0000","updated":"2017-12-27T05:01:08.157+0000","started":"2017-12-27T05:01:08.156+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63550","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63553","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2482#discussion_r158764626\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/metric/FileBasedEventLogger.java ---\n    @@ -59,8 +62,12 @@ private void initLogWriter(Path logFilePath) {\n     \n     \n         private void setUpFlushTask() {\n    -        ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();\n    -        Runnable task = new Runnable() {\n    +        ThreadFactory threadFactory = new ThreadFactoryBuilder()\n    +                .setNameFormat(\"event-logger-flush-%d\")\n    --- End diff --\n    \n    I'm in favor of guaranteeing JVM shutdown in this case as I have seen dangling worker scenarios are hard for users to debug and maintain. \n","created":"2017-12-27T05:38:19.279+0000","updated":"2017-12-27T05:38:19.279+0000","started":"2017-12-27T05:38:19.279+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63553","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2482#discussion_r158766251\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/metric/FileBasedEventLogger.java ---\n    @@ -59,8 +62,12 @@ private void initLogWriter(Path logFilePath) {\n     \n     \n         private void setUpFlushTask() {\n    -        ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();\n    -        Runnable task = new Runnable() {\n    +        ThreadFactory threadFactory = new ThreadFactoryBuilder()\n    +                .setNameFormat(\"event-logger-flush-%d\")\n    --- End diff --\n    \n    OK, makes sense. Will add `setDaemon(true)`.\n","created":"2017-12-27T06:06:33.570+0000","updated":"2017-12-27T06:06:33.570+0000","started":"2017-12-27T06:06:33.568+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63563","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2482#discussion_r158766595\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/metric/FileBasedEventLogger.java ---\n    @@ -59,8 +62,12 @@ private void initLogWriter(Path logFilePath) {\n     \n     \n         private void setUpFlushTask() {\n    -        ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();\n    -        Runnable task = new Runnable() {\n    +        ThreadFactory threadFactory = new ThreadFactoryBuilder()\n    +                .setNameFormat(\"event-logger-flush-%d\")\n    --- End diff --\n    \n    Addressed.\n","created":"2017-12-27T06:11:29.155+0000","updated":"2017-12-27T06:11:29.155+0000","started":"2017-12-27T06:11:29.154+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63564","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63570","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2482\n  \n    @arunmahadevan @satishd \r\n    Thanks for reviewing. I addressed review comments. Please take a look again. I'll squash commits into one once I got +1. Thanks!\n","created":"2017-12-27T06:33:42.776+0000","updated":"2017-12-27T06:33:42.776+0000","started":"2017-12-27T06:33:42.775+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63570","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2482\n  \n    Thanks. Squashed.\n","created":"2017-12-27T07:24:47.713+0000","updated":"2017-12-27T07:24:47.713+0000","started":"2017-12-27T07:24:47.713+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63579","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63726","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2482\n","created":"2017-12-28T03:01:35.422+0000","updated":"2017-12-28T03:01:35.422+0000","started":"2017-12-28T03:01:35.421+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63726","issueId":"13127296"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13127296/worklog/63746","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2483\n","created":"2017-12-28T04:25:25.411+0000","updated":"2017-12-28T04:25:25.411+0000","started":"2017-12-28T04:25:25.410+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"63746","issueId":"13127296"}]},"customfield_12311820":"0|i3oayn:"}}