{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13179125","self":"https://issues.apache.org/jira/rest/api/2/issue/13179125","key":"STORM-3195","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2018-08-16T04:11:45.301+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 16 13:30:40 UTC 2018","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1010121_*|*_6_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2018-08-15T17:28:16.641+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3195/watchers","watchCount":2,"isWatching":false},"created":"2018-08-15T17:11:26.549+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-16T13:30:40.869+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"\r\n{code:java}\r\n2018-08-15 15:49:06.550 o.a.s.d.n.Nimbus timer [ERROR] Error while processing event\r\njava.lang.RuntimeException: java.lang.IllegalArgumentException: Don't know how to convert 1.7604166666666667 to int\r\n        at org.apache.storm.daemon.nimbus.Nimbus.lambda$launchServer$48(Nimbus.java:2837) ~[storm-server-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.StormTimer$1.run(StormTimer.java:110) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.StormTimer$StormTimerTask.run(StormTimer.java:226) [storm-client-2.0.0.y.jar:2.0.0.y]\r\nCaused by: java.lang.IllegalArgumentException: Don't know how to convert 1.7604166666666667 to int\r\n        at org.apache.storm.utils.ObjectReader.getInt(ObjectReader.java:78) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.StormCommon.addAcker(StormCommon.java:256) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.StormCommon.systemTopologyImpl(StormCommon.java:523) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.StormCommon.systemTopology(StormCommon.java:440) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.StormCommon.stormTaskInfoImpl(StormCommon.java:544) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.StormCommon.stormTaskInfo(StormCommon.java:460) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.nimbus.Nimbus.computeExecutors(Nimbus.java:1732) ~[storm-server-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.nimbus.Nimbus.getOrUpdateExecutors(Nimbus.java:1357) ~[storm-server-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.nimbus.Nimbus.computeExecutorToComponent(Nimbus.java:1752) ~[storm-server-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.nimbus.Nimbus.readTopologyDetails(Nimbus.java:1582) ~[storm-server-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.nimbus.Nimbus.getResourcesForTopology(Nimbus.java:2034) ~[storm-server-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.nimbus.Nimbus.getClusterInfoImpl(Nimbus.java:2676) ~[storm-server-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.nimbus.Nimbus.sendClusterMetricsToExecutors(Nimbus.java:2701) ~[storm-server-2.0.0.y.jar:2.0.0.y]\r\n        at org.apache.storm.daemon.nimbus.Nimbus.lambda$launchServer$48(Nimbus.java:2834) ~[storm-server-2.0.0.y.jar:2.0.0.y]\r\n        ... 2 more\r\n{code}\r\n\r\nWe were rolling upgrading our storm cluster to 2.x and we found this error from nimbus.log. It's not necessary to do rolling upgrade but good news is we basically made it work. \r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"IllegalArgumentException when rolling upgrade nimbus from 1.x to 2.x","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ethanli","name":"ethanli","key":"ethanli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ethanli&avatarId=32192","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ethanli&avatarId=32192","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ethanli&avatarId=32192","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ethanli&avatarId=32192"},"displayName":"Ethan Li","active":true,"timeZone":"America/Chicago"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ethanli","name":"ethanli","key":"ethanli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ethanli&avatarId=32192","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ethanli&avatarId=32192","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ethanli&avatarId=32192","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ethanli&avatarId=32192"},"displayName":"Ethan Li","active":true,"timeZone":"America/Chicago"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13179125/comment/16581388","id":"16581388","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ethanli","name":"ethanli","key":"ethanli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ethanli&avatarId=32192","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ethanli&avatarId=32192","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ethanli&avatarId=32192","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ethanli&avatarId=32192"},"displayName":"Ethan Li","active":true,"timeZone":"America/Chicago"},"body":"Community 1.x will not have this issue because https://github.com/apache/storm/pull/2325 wasn't merged into 1.x. The worker count will always be int and acker executer number will always be int. \r\n\r\nOur internal version 1.x has https://github.com/apache/storm/pull/2325 feature. And that's why it happened. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ethanli","name":"ethanli","key":"ethanli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ethanli&avatarId=32192","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ethanli&avatarId=32192","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ethanli&avatarId=32192","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ethanli&avatarId=32192"},"displayName":"Ethan Li","active":true,"timeZone":"America/Chicago"},"created":"2018-08-15T17:28:16.663+0000","updated":"2018-08-15T17:28:16.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13179125/comment/16581928","id":"16581928","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"[~ethanli]\r\nI'm wondering the symptom itself: shouldn't worker count as well as acker executor number be integer? No one would say worker count is 1.66 and acker executor count is 2.33, so the value itself looks somewhat incorrect to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2018-08-16T04:11:45.301+0000","updated":"2018-08-16T04:11:45.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13179125/comment/16582511","id":"16582511","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ethanli","name":"ethanli","key":"ethanli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ethanli&avatarId=32192","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ethanli&avatarId=32192","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ethanli&avatarId=32192","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ethanli&avatarId=32192"},"displayName":"Ethan Li","active":true,"timeZone":"America/Chicago"},"body":"Yeah this is our internal code. We have a piece of code in nimbu.clj similar to https://github.com/apache/storm/pull/2325 but it's in clojure: \r\n\r\n{code:java}\r\n(defn estimated-worker-count-for-ras-topo [storm-conf topology]\r\n  (let [component-parallelism-mp (into {} (map #(vector (first %) (component-parallelism storm-conf (second %))) (all-components topology)))\r\n        bolt-memory-requirement (into {} (map #(vector (first %) (.getOnHeapMemoryMb (second %))) (into {} (ResourceUtils/getBoltsResources topology storm-conf))))\r\n        spout-memory-requirement (into {} (map #(vector (first %) (.getOnHeapMemoryMb (second %))) (into {} (ResourceUtils/getSpoutsResources topology storm-conf))))\r\n        component-memory-requirement (merge bolt-memory-requirement spout-memory-requirement)\r\n        total-memory-required (reduce + (vals (merge-with * component-memory-requirement component-parallelism-mp)))\r\n        worker-heap-memory (get storm-conf WORKER-HEAP-MEMORY-MB)\r\n        ]\r\n    (/ total-memory-required worker-heap-memory)))\r\n{code}\r\nThis returns a double value. \r\n\r\nWe don't need to worry about it in the community code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ethanli","name":"ethanli","key":"ethanli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ethanli&avatarId=32192","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ethanli&avatarId=32192","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ethanli&avatarId=32192","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ethanli&avatarId=32192"},"displayName":"Ethan Li","active":true,"timeZone":"America/Chicago"},"created":"2018-08-16T13:30:40.869+0000","updated":"2018-08-16T13:30:40.869+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3195/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3x2sn:"}}