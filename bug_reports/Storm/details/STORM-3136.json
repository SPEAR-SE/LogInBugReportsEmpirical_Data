{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13169279","self":"https://issues.apache.org/jira/rest/api/2/issue/13169279","key":"STORM-3136","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":3000,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false}],"aggregatetimespent":3000,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-07-10T03:54:43.758+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 10 03:54:43 UTC 2018","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1333153_*|*_3_*:*_1_*:*_880859491_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2018-07-10T03:54:43.725+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3136/watchers","watchCount":1,"isWatching":false},"created":"2018-06-29T22:51:31.124+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-10T03:54:43.761+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12331115","id":"12331115","name":"integration-test"}],"timeoriginalestimate":null,"description":"The integration test appears flaky, e.g. https://travis-ci.org/apache/storm/jobs/397471420.\r\n\r\nWe should try to fix this. I also find the integration test code hard to read and understand, so I'd like to do some cleanup.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"50m","remainingEstimateSeconds":0,"timeSpentSeconds":3000},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Fix flaky integration test, and make it more readable","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":3000,"total":3000,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":3000,"total":3000,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13169279/comment/16537963","id":"16537963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Thanks [~Srdo], I merged into master.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2018-07-10T03:54:43.758+0000","updated":"2018-07-10T03:54:43.758+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3136/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":5,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13169279/worklog/117660","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user srdo opened a pull request:\n\n    https://github.com/apache/storm/pull/2746\n\n    STORM-3136: Fix flaky integration test, clean up that code to be more…\n\n    … readable\r\n    \r\n    https://issues.apache.org/jira/browse/STORM-3136\r\n    \r\n    * Deduplicated the test spouts and bolts a bit. \r\n    * Made sure all test spouts are waiting a reasonable amount of time between emits. If the log rolls during the tests, the tests will fail. I think this is the reason for the flakiness. It was fixed for some tests in an earlier PR, but I missed that the spout code had so many duplicates. \r\n    * Added some documentation\r\n    * Replaced a bunch of Guava code with streams. Deleted unused code. Simplified some classes, e.g. TimeDataWindow\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/srdo/storm STORM-3136\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2746.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2746\n    \n----\ncommit 739fc2ca48e7e2d91a0d11c3606b31e9483a33b3\nAuthor: Stig Rohde Døssing <srdo@...>\nDate:   2018-06-28T19:17:38Z\n\n    STORM-3136: Fix flaky integration test, clean up that code to be more readable\n\n----\n","created":"2018-06-29T23:02:36.357+0000","updated":"2018-06-29T23:02:36.357+0000","started":"2018-06-29T23:02:36.357+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"117660","issueId":"13169279"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13169279/worklog/117832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on the issue:\n\n    https://github.com/apache/storm/pull/2746\n  \n    Ran this 4 times on top of the changes from https://github.com/apache/storm/pull/2733 on Travis, runs of the integration test passed. \n","created":"2018-06-30T10:30:48.562+0000","updated":"2018-06-30T10:30:48.562+0000","started":"2018-06-30T10:30:48.562+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"117832","issueId":"13169279"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13169279/worklog/121017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2746#discussion_r201144238\n  \n    --- Diff: integration-test/src/main/java/org/apache/storm/st/topology/window/TimeDataIncrementingSpout.java ---\n    @@ -0,0 +1,64 @@\n    +/*\n    + * Copyright 2018 The Apache Software Foundation.\n    + *\n    + * Licensed under the Apache License, Version 2.0 (the \"License\");\n    + * you may not use this file except in compliance with the License.\n    + * You may obtain a copy of the License at\n    + *\n    + *      http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.storm.st.topology.window;\n    +\n    +import java.util.Map;\n    +import java.util.Random;\n    +import java.util.concurrent.ThreadLocalRandom;\n    +import org.apache.storm.spout.SpoutOutputCollector;\n    +import org.apache.storm.st.topology.TestableTopology;\n    +import org.apache.storm.st.topology.window.data.TimeData;\n    +import org.apache.storm.st.utils.StringDecorator;\n    +import org.apache.storm.st.utils.TimeUtil;\n    +import org.apache.storm.task.TopologyContext;\n    +import org.apache.storm.topology.OutputFieldsDeclarer;\n    +import org.apache.storm.topology.base.BaseRichSpout;\n    +import org.apache.storm.tuple.Values;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +public class TimeDataIncrementingSpout extends BaseRichSpout {\n    +        private static final Logger LOG = LoggerFactory.getLogger(TimeDataIncrementingSpout.class);\n    +        private final Random rng = new Random();\n    --- End diff --\n    \n    unused?\n","created":"2018-07-09T21:03:26.789+0000","updated":"2018-07-09T21:03:26.789+0000","started":"2018-07-09T21:03:26.788+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"121017","issueId":"13169279"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13169279/worklog/121024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2746#discussion_r201149188\n  \n    --- Diff: integration-test/src/main/java/org/apache/storm/st/topology/window/TimeDataIncrementingSpout.java ---\n    @@ -0,0 +1,64 @@\n    +/*\n    + * Copyright 2018 The Apache Software Foundation.\n    + *\n    + * Licensed under the Apache License, Version 2.0 (the \"License\");\n    + * you may not use this file except in compliance with the License.\n    + * You may obtain a copy of the License at\n    + *\n    + *      http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.storm.st.topology.window;\n    +\n    +import java.util.Map;\n    +import java.util.Random;\n    +import java.util.concurrent.ThreadLocalRandom;\n    +import org.apache.storm.spout.SpoutOutputCollector;\n    +import org.apache.storm.st.topology.TestableTopology;\n    +import org.apache.storm.st.topology.window.data.TimeData;\n    +import org.apache.storm.st.utils.StringDecorator;\n    +import org.apache.storm.st.utils.TimeUtil;\n    +import org.apache.storm.task.TopologyContext;\n    +import org.apache.storm.topology.OutputFieldsDeclarer;\n    +import org.apache.storm.topology.base.BaseRichSpout;\n    +import org.apache.storm.tuple.Values;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +public class TimeDataIncrementingSpout extends BaseRichSpout {\n    +        private static final Logger LOG = LoggerFactory.getLogger(TimeDataIncrementingSpout.class);\n    +        private final Random rng = new Random();\n    --- End diff --\n    \n    Yes, nice catch\n","created":"2018-07-09T21:14:15.379+0000","updated":"2018-07-09T21:14:15.379+0000","started":"2018-07-09T21:14:15.378+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"121024","issueId":"13169279"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13169279/worklog/121185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2746\n","created":"2018-07-10T03:54:09.980+0000","updated":"2018-07-10T03:54:09.980+0000","started":"2018-07-10T03:54:09.979+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"121185","issueId":"13169279"}]},"customfield_12311820":"0|i3venj:"}}