{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12684754","self":"https://issues.apache.org/jira/rest/api/2/issue/12684754","key":"STORM-128","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2013-12-15 04:58:58.636","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"363826","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-128/watchers","watchCount":2,"isWatching":false},"created":"2013-12-15T04:58:58.636+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T00:31:34.823+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"https://github.com/nathanmarz/storm/issues/696\n\nIn our environment we have 3 DRPC servers running. This was done mainly for availability and capacity. However, we noticed that when even one of these servers is down, topologies fail to start with the following exception:\n\njava.lang.RuntimeException: org.apache.thrift7.transport.TTransportException: java.net.NoRouteToHostException: No route to host\nat backtype.storm.drpc.DRPCInvocationsClient.(DRPCInvocationsClient.java:23)\nat backtype.storm.drpc.DRPCSpout.open(DRPCSpout.java:65)\nat storm.trident.spout.RichSpoutBatchTriggerer.open(RichSpoutBatchTriggerer.java:41)\nat backtype.storm.daemon.executor$fn__3985$fn__3997.invoke(executor.clj:460)\nat backtype.storm.util$async_loop$fn__465.invoke(util.clj:375)\nat clojure.lang.AFn.run(AFn.java:24)\nat java.lang.Thread.run(Thread.java:722)\nCaused by: org.apache.thrift7.transport.TTransportException: java.net.NoRouteToHostException: No route to host\nat org.apache.thrift7.transport.TSocket.open(TSocket.java:183)\nat org.apache.thrift7.transport.TFramedTransport.open(TFramedTransport.java:81)\nat backtype.storm.drpc.DRPCInvocationsClient.connect(DRPCInvocationsClient.java:30)\nat backtype.storm.drpc.DRPCInvocationsClient.(DRPCInvocationsClient.java:21)\n... 6 more\nCaused by: java.net.NoRouteToHostException: No route to host\nat java.net.PlainSocketImpl.socketConnect(Native Method)\nat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)\nat java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)\nat java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)\nat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:391)\nat java.net.Socket.connect(Socket.java:579)\nat org.apache.thrift7.transport.TSocket.open(TSocket.java:178)\n... 9 more\n\nI was wondering if it makes sense to make Storm handle this gracefully instead of failing fast. Otherwise, the DRPC servers become a SPOF.\n\nIf the topologies are already running the topology usually just logs an error message and continues.\n\n----------\ndkador: +1 on figuring out how to make the DRPC stuff not a SOP. I'd be happy to look into it myself but not sure where to start. Any guidance?\n\n----------\nrijuk: For reference, the stack trace I see when a DRPC server goes down while a topology is running is the following. In this case, the topology continues to function normally.\n\n[backtype.storm.drpc.DRPCSpout Thread-65]: Failed to fetch DRPC result from DRPC server\norg.apache.thrift7.transport.TTransportException: java.net.ConnectException: Connection refused\nat org.apache.thrift7.transport.TSocket.open(TSocket.java:183)\nat org.apache.thrift7.transport.TFramedTransport.open(TFramedTransport.java:81)\nat backtype.storm.drpc.DRPCInvocationsClient.connect(DRPCInvocationsClient.java:30)\nat backtype.storm.drpc.DRPCInvocationsClient.fetchRequest(DRPCInvocationsClient.java:53)\nat backtype.storm.drpc.DRPCSpout.nextTuple(DRPCSpout.java:89)\nat storm.trident.spout.RichSpoutBatchTriggerer.nextTuple(RichSpoutBatchTriggerer.java:68)\nat backtype.storm.daemon.executor$fn__3985$fn__3997$fn__4026.invoke(executor.clj:502)\nat backtype.storm.util$async_loop$fn__465.invoke(util.clj:377)\nat clojure.lang.AFn.run(AFn.java:24)\nat java.lang.Thread.run(Thread.java:722)\nCaused by: java.net.ConnectException: Connection refused\nat java.net.PlainSocketImpl.socketConnect(Native Method)\nat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)\nat java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)\nat java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)\nat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:391)\nat java.net.Socket.connect(Socket.java:579)\nat org.apache.thrift7.transport.TSocket.open(TSocket.java:178)\n... 9 more\n\nIn this case I'd the host up, but the DRPC server process was down. Hence the ConnectException. But, the behavior is the same even when the host is unreachable, except for the Exception type.\n\n@dkador, I'm not sure what the right solution is. One naive solution I can think of is to make DRPCInvocationsClient constructor rethrow TException instead of throwing a RuntimeException. Obviously, you'll have to make sure that all callers of this higher up in the stack handle this exception properly.\n\nActually, on second thoughts that's not a good idea. You probably still want the DRPCInvocationsClient object to be constructed. So, maybe you can log an error and just eat that exception. All other methods in that class call \"connect\" if necessary anyway.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"364132","customfield_12312823":null,"summary":"Topology fails to start if a configured DRPC server is down","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-128/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qpon:"}}