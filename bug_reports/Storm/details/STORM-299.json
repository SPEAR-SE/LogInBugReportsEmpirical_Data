{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12710700","self":"https://issues.apache.org/jira/rest/api/2/issue/12710700","key":"STORM-299","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2014-04-29T15:20:16.156+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Apr 29 22:23:46 UTC 2014","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_330784595_*|*_5_*:*_1_*:*_0","customfield_12310420":"389021","customfield_12312321":null,"resolutiondate":"2014-04-29T22:24:53.288+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-299/watchers","watchCount":2,"isWatching":false},"created":"2014-04-26T02:31:48.718+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326789","id":"12326789","name":"0.9.0.1","archived":false,"released":true,"releaseDate":"2013-12-06"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-05T02:17:31.452+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"We are running a topology that processes about 10K tuples a second on a single worker. There are about 80 executor threads across 3 different Bolt types, each receiving a tick tuple at a frequency of 1 second. We observe that the tick tuples stop coming in after few hours or sometime even after a day. The nimbus UI also shows that the tick tuples count has frozen whereas the same set of bolts continue to process tuples from other spouts. I have taken a stack trace and it shows following:\n\n\"Thread-8\" daemon prio=10 tid=0x00007f1a0fed2000 nid=0x4438 runnable [0x00007f19a5e01000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:349)\n        at com.lmax.disruptor.AbstractMultithreadedClaimStrategy.waitForFreeSlotAt(AbstractMultithreadedClaimStrategy.java:99)\n        at com.lmax.disruptor.AbstractMultithreadedClaimStrategy.incrementAndGet(AbstractMultithreadedClaimStrategy.java:49)\n        at com.lmax.disruptor.Sequencer.next(Sequencer.java:127)\n        at backtype.storm.utils.DisruptorQueue.publish(DisruptorQueue.java:113)\n        at backtype.storm.disruptor$publish.invoke(disruptor.clj:51)\n        at backtype.storm.disruptor$publish.invoke(disruptor.clj:53)\n        at backtype.storm.daemon.executor$setup_ticks_BANG_$fn__3885.invoke(executor.clj:299)\n        at backtype.storm.timer$schedule_recurring$this__1839.invoke(timer.clj:79)\n        at backtype.storm.timer$mk_timer$thread_fn__1822$fn__1823.invoke(timer.clj:32)\n        at backtype.storm.timer$mk_timer$thread_fn__1822.invoke(timer.clj:25)\n        at clojure.lang.AFn.run(AFn.java:24)\n        at java.lang.Thread.run(Thread.java:744)\n \n   Locked ownable synchronizers:\n        - None\n \n\"Thread-268-__system\" prio=10 tid=0x00007f1a0ef45000 nid=0x46b5 runnable [0x00007f17ef574000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0x000000073d9a2060> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2176)\n        at com.lmax.disruptor.BlockingWaitStrategy.waitFor(BlockingWaitStrategy.java:87)\n        at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:54)\n        at backtype.storm.utils.DisruptorQueue.consumeBatchWhenAvailable(DisruptorQueue.java:56)\n        at backtype.storm.disruptor$consume_batch_when_available.invoke(disruptor.clj:62)\n        at backtype.storm.daemon.executor$eval4023$fn__4024$fn__4038$fn__4089.invoke(executor.clj:749)\n        at backtype.storm.util$async_loop$fn__364.invoke(util.clj:400)\n        at clojure.lang.AFn.run(AFn.java:24)\n        at java.lang.Thread.run(Thread.java:744)\n \n   Locked ownable synchronizers:\n        - None\n\nWe are running storm-0.9.0_wip21 and I would be glad to provide any other information.\n\nAlso see https://issues.apache.org/jira/browse/STORM-106.\n\nThanks,\nSushant","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"389267","customfield_12312823":null,"summary":"tick tuples stop in a long running topology","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sushantk","name":"sushantk","key":"sushantk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushant Kumar","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sushantk","name":"sushantk","key":"sushantk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushant Kumar","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12710700/comment/13984398","id":"13984398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"This seems to indicate that a tick tuple was trying to publish to the receive queue of an executor, but could not because the queue was full.  While at the same time an executor, possibly a different one, was waiting for data to be available on its queue.  I'm not sure that there is any way to tie the two together, in fact if the two are for the same queue it probably means that you have found a bug in disruptor.  If this is reproducible, we should be able to get to the bottom of it, so long as you are OK with sharing stack traces, and possibly a heap dump of a worker experiencing this issue.  If this is something you are not going to be able to share it will be much more difficult to track down what is happening.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-04-29T15:20:16.156+0000","updated":"2014-04-29T15:20:16.156+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12710700/comment/13984901","id":"13984901","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sushantk","name":"sushantk","key":"sushantk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushant Kumar","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~revans2] to discuss this with me.\n\nThe root cause was a spout that blocks in the nextTuple method for a long time (hours) listening on a socket. Note that the spout doesn't emit anything in that time frame and therefore doesn't have any pending ack or fail to be called; topology doesn't use anchoring as well.\n\nApparently spout's receive queue is used by storm for metrics and system stream. Spout's thread (the one that also calls nextTuple) pulls these ticks out from that queue. The metrics and system stream are driven by a global timer thread, which gets blocked on trying to publish a new tuple to the spout's receive queue. The blocked global timer thread causes a complete halt of tick tuples to other bolt instances.\n \nIt will be good to document that a spout should NEVER sleep more than few seconds to keep the system running.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sushantk","name":"sushantk","key":"sushantk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushant Kumar","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-29T22:23:46.955+0000","updated":"2014-04-29T22:23:46.955+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-299/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1v0db:"}}