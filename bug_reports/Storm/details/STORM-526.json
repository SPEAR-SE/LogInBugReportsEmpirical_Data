{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12747222","self":"https://issues.apache.org/jira/rest/api/2/issue/12747222","key":"STORM-526","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 10 07:10:42 UTC 2014","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-526/watchers","watchCount":1,"isWatching":false},"created":"2014-10-10T07:03:43.044+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326452","id":"12326452","name":"0.9.2-incubating","archived":false,"released":true,"releaseDate":"2014-06-25"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-09-29T02:57:39.395+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"We use a cluster of 3 zookeepers, all 3 ip addresses are in the storm.yml file. We were restarting one zookeeper, and once it was ready, we restarted the second zookeeper. All this time the third zookeeper was \"green\" (as monitored by Netfix Exhibitor).\n\nAt this same time nimbus has \"decided\" to remove all topologies (log entry is \"Corrupt topology my-topology-xxx has state on zookeeper but doesn't have a local dir on Nimbus. Cleaning up...\").\n\nI looked at the relevant code and I am not entirely sure the log message describes correctly the code.\n\nCould anyone please read the nimbus.clj#cleanup-corrupt-topologies and explain under what conditions does nimbus act in that way ?\nhttps://github.com/apache/storm/blob/v0.9.2-incubating/storm-core/src/clj/backtype/storm/daemon/nimbus.clj#L854\n\n\nLog file:\n2014-10-01 10:47:19 b.s.d.nimbus [INFO] Corrupt topology my-topology-1-2-1412151059 has state on zookeeper but doesn't have a local dir on Nimbus. Cleaning up...\n2014-10-01 10:47:19 b.s.d.nimbus [INFO] Corrupt topology my-topology-0-1-1412151059 has state on zookeeper but doesn't have a local dir on Nimbus. Cleaning up...\n2014-10-01 10:47:19 b.s.d.nimbus [INFO] Corrupt topology my-topology-3-4-1412151062 has state on zookeeper but doesn't have a local dir on Nimbus. Cleaning up...\n2014-10-01 10:47:19 b.s.d.nimbus [INFO] Corrupt topology my-topology-2-3-1412151060 has state on zookeeper but doesn't have a local dir on Nimbus. Cleaning up...\n2014-10-01 10:47:19 b.s.d.nimbus [INFO] Starting Nimbus server...\n2014-10-01 10:47:20 b.s.d.nimbus [INFO] Cleaning up my-topology-1-2-1412151059\n2014-10-01 10:47:20 b.s.d.nimbus [INFO] Cleaning up my-topology-0-1-1412151059\n2014-10-01 10:47:20 b.s.d.nimbus [INFO] Cleaning up my-topology-3-4-1412151062\n2014-10-01 10:47:20 b.s.d.nimbus [INFO] Cleaning up my-topology-2-3-1412151060\n2014-10-01 10:52:16 b.s.d.nimbus [INFO] Shutting down master\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Nimbus triggered complete removal of all topologies due to maintenance in 2 out of 3 zookeeper servers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=itaifrenkel","name":"itaifrenkel","key":"itaifrenkel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=itaifrenkel&avatarId=20102","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=itaifrenkel&avatarId=20102","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=itaifrenkel&avatarId=20102","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=itaifrenkel&avatarId=20102"},"displayName":"Itai Frenkel","active":true,"timeZone":"Asia/Jerusalem"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=itaifrenkel","name":"itaifrenkel","key":"itaifrenkel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=itaifrenkel&avatarId=20102","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=itaifrenkel&avatarId=20102","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=itaifrenkel&avatarId=20102","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=itaifrenkel&avatarId=20102"},"displayName":"Itai Frenkel","active":true,"timeZone":"Asia/Jerusalem"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"AWS EC2 ubuntu","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12747222/comment/14166494","id":"14166494","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=itaifrenkel","name":"itaifrenkel","key":"itaifrenkel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=itaifrenkel&avatarId=20102","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=itaifrenkel&avatarId=20102","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=itaifrenkel&avatarId=20102","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=itaifrenkel&avatarId=20102"},"displayName":"Itai Frenkel","active":true,"timeZone":"Asia/Jerusalem"},"body":"If anyone has had the same problem we overcome it by fixing our zookeeper issues. We disabled exhibitor s3 backups since they perform CPU intensive compression, and moved to ephemeral SSD drives. We also disabled automatic restarts of zookeepers by exhibitor and only trigger a pagerduty alert when one of the zookeepers is down.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=itaifrenkel","name":"itaifrenkel","key":"itaifrenkel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=itaifrenkel&avatarId=20102","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=itaifrenkel&avatarId=20102","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=itaifrenkel&avatarId=20102","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=itaifrenkel&avatarId=20102"},"displayName":"Itai Frenkel","active":true,"timeZone":"Asia/Jerusalem"},"created":"2014-10-10T07:10:42.822+0000","updated":"2014-10-10T07:10:42.822+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-526/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i210qv:"}}