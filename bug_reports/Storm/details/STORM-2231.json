{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13025078","self":"https://issues.apache.org/jira/rest/api/2/issue/13025078","key":"STORM-2231","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":4800,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341047","id":"12341047","name":"1.2.0","archived":false,"released":true,"releaseDate":"2018-02-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341265","id":"12341265","name":"1.1.2","archived":false,"released":true,"releaseDate":"2018-02-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341278","id":"12341278","name":"1.0.5","archived":false,"released":true,"releaseDate":"2017-09-15"}],"aggregatetimespent":4800,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-08-17T19:47:25.163+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Aug 28 20:05:39 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_22907302896_*|*_3_*:*_1_*:*_160486469_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-08-26T12:34:55.248+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2231/watchers","watchCount":4,"isWatching":false},"created":"2016-12-02T12:51:45.995+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335587","id":"12335587","name":"1.0.1","archived":false,"released":true,"releaseDate":"2016-05-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335748","id":"12335748","name":"1.1.0","archived":false,"released":true,"releaseDate":"2017-03-29"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-08-28T20:05:39.195+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"I use simple topology with one spout (9 workers) and one bolt (9 workers).\nI have topology.backpressure.enable: false in storm.yaml.\nSpouts send about 10 000 000 tuples in 10 minutes. Pending for spout is 80 000.\nBolts buffer theirs tuples for 60 seconds and flush to database and ack tuples in parallel (10 threads).\nI read that OutputCollector can be used in many threads safely, so i use it.\nI don't have any bottleneck in bolts(flushing to database) or spouts(kafka spout), but about 2% of tuples fail due to tuple processing timeout (fails are recordered in spout stats only).\nI am sure that bolts ack all tuples. But some of acks don't come to spouts.\n\nWhile multi-threaded acking i see many errors in worker logs like that:\n2016-12-01 13:21:10.741 o.a.s.u.DisruptorQueue [ERROR] NULL found in disruptor-executor[3 3]-send-queue:853877\n\nI tried to use synchronized wrapper around OutputCollector to fix the error. But it didn't help.\n\nI found the workaround that helps me: i do all processing in bolt in multiple threads but call OutputCollector.ack methods in a one single separate thread.\n\nI think Storm has an error in the multi-threaded use of OutputCollector.\n\nIf my topology has much less load, like 500 000 tuples per 10 minutes, then  i don't lose any acks.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"1h 20m","remainingEstimateSeconds":0,"timeSpentSeconds":4800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"NULL in DisruptorQueue while multi-threaded ack","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chemist","name":"chemist","key":"chemist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kharitonov","active":true,"timeZone":"Europe/Moscow"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chemist","name":"chemist","key":"chemist","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kharitonov","active":true,"timeZone":"Europe/Moscow"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":4800,"total":4800,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":4800,"total":4800,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16131194","id":"16131194","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"body":"I'm also seeing this in 1.1.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-17T19:47:25.163+0000","updated":"2017-08-17T19:47:25.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16139736","id":"16139736","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"[~chemist] [~kevinconaway]\nCould you give us some information around this? Also could you share why you're launching threads in bolt and ack from there instead of increasing tasks or additional bolts? For me it is possible use cases but didn't see the case actually.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2017-08-24T07:58:20.892+0000","updated":"2017-08-24T07:58:20.892+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16139831","id":"16139831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"[~chemist] [~kevinconaway]\nI guess I found suspicious spot, but possible fixes may affect performance so would like to spend some time to do performance tests on fixes.\nI didn't reproduce the issue and don't know it is easy to reproduce, so if one of you can help testing and verifying the patch it should be really helpful.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2017-08-24T09:45:15.896+0000","updated":"2017-08-24T09:45:15.896+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16140005","id":"16140005","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"body":"In our case the bolts send data to an external service asynchronously. The tuples are acked in a callback listener on the future that is returned from this call. \n\nWe see this when occur when we get a large spike in traffic\n\nWe are happy to take a look at the patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-24T12:59:59.215+0000","updated":"2017-08-24T12:59:59.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16140235","id":"16140235","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"[~kevinconaway]\nPlease take a look at https://github.com/apache/storm/pull/2293\nPlease also let me know if you would help to reproduce but prefer having patched specific version of jar instead of building it yourself. I'll build and provide it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2017-08-24T16:11:42.419+0000","updated":"2017-08-24T16:11:42.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16140273","id":"16140273","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"body":"Will this patch apply on 1.1.x?\n\nIs the workaround here to synchronize on the outputcollector before using it? Did i read your pr comment correctly?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-24T16:36:33.087+0000","updated":"2017-08-24T16:36:33.087+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16142789","id":"16142789","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"[~kevinconaway]\nI just merged this into all 1.x version lines, so the patch will be shipped to 1.1.2. I would be appreciated if you can test this patch before releasing. \n\nBtw, I guess only the case that \"wrapping output collector with synchronized keyword doesn't help\" is N tasks : 1 executor. If it is not your case and wrapping output collector doesn't work in your case, please let me know details on your topology.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2017-08-26T12:26:08.808+0000","updated":"2017-08-26T12:26:08.808+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16142791","id":"16142791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Merged to master, 1.x, 1.1.x, 1.0.x branches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2017-08-26T12:34:55.315+0000","updated":"2017-08-26T12:34:55.315+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16143997","id":"16143997","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"body":"[~kabhwan] Per your suggestion, I am now synchronzing on the outputcollector before acking or failing a tuple.  However, I still see the issue when a spike of traffic arrives.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-28T16:53:53.335+0000","updated":"2017-08-28T17:14:57.969+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/comment/16144262","id":"16144262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"body":"[~kabhwan] btw I can confirm that your patch fixes the issue with this test case that I wrote:\n\nGiven that the underlying issue is a race condition, you may need to run it a few times but the error always shows up for me.\n\nPer my comment above, attempting to _synchronize_ on the outputcollector also doesn't work when the disruptor-queue producer type is single threaded.  I'm not sure what the workaround should be without your patch in place\n\n{code:java}\npackage org.apache.storm;\n\nimport org.apache.storm.task.OutputCollector;\nimport org.apache.storm.task.TopologyContext;\nimport org.apache.storm.testing.AckFailMapTracker;\nimport org.apache.storm.testing.FeederSpout;\nimport org.apache.storm.testing.MkClusterParam;\nimport org.apache.storm.testing.TestJob;\nimport org.apache.storm.testing.TrackedTopology;\nimport org.apache.storm.topology.OutputFieldsDeclarer;\nimport org.apache.storm.topology.TopologyBuilder;\nimport org.apache.storm.topology.base.BaseRichBolt;\nimport org.apache.storm.tuple.Fields;\nimport org.apache.storm.tuple.Tuple;\nimport org.apache.storm.tuple.Values;\nimport org.junit.Test;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.UUID;\nimport java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.LinkedBlockingQueue;\nimport java.util.concurrent.TimeUnit;\n\npublic class Storm2231 {\n\n    @Test\n    public void runTest() {\n        Config daemonConfig = new Config();\n        daemonConfig.put(Config.STORM_LOCAL_HOSTNAME, \"localhost\");\n\n        MkClusterParam clusterParams = new MkClusterParam();\n        clusterParams.setDaemonConf(daemonConfig);\n\n        Testing.withTrackedCluster(clusterParams, new TestJob() {\n            @Override\n            public void run(ILocalCluster cluster) throws Exception {\n                AckFailMapTracker tracker = new AckFailMapTracker();\n\n                final FeederSpout spout = new FeederSpout(new Fields(\"message\"));\n                spout.setAckFailDelegate(tracker);\n\n                TopologyBuilder builder = new TopologyBuilder();\n                builder.setSpout(\"spout\", spout, 50);\n                builder.setBolt(\"bolt\", new ExampleBolt(), 10).shuffleGrouping(\"spout\");\n\n                Config topologyConfig = new Config();\n                topologyConfig.setDebug(false);\n\n                TrackedTopology tracked = Testing.mkTrackedTopology(cluster, builder.createTopology());\n                cluster.submitTopology(String.valueOf(System.nanoTime()), topologyConfig, tracked.getTopology());\n\n                ExecutorService service = Executors.newCachedThreadPool();\n\n                for (int i=0; i < 20; i++) {\n                    service.submit(new Runnable() {\n                        @Override\n                        public void run() {\n                            for (int j=0; j <= 500_000; j++) {\n                                String messageId = Thread.currentThread().getId() + \"-\" + UUID.randomUUID().toString();\n                                synchronized (spout) {\n                                    spout.feed(new Values(messageId), messageId);\n                                }\n                            }\n                        }\n                    });\n                }\n\n                service.shutdown();\n                service.awaitTermination(1, TimeUnit.DAYS);\n            }\n        });\n    }\n\n    public static class ExampleBolt extends BaseRichBolt {\n\n        private transient ExecutorService executorService;\n        private transient BlockingQueue<Runnable> callbackQueue;\n        private transient OutputCollector outputCollector;\n\n        @Override\n        public void prepare(Map stormConf, TopologyContext context, OutputCollector collector) {\n            outputCollector = collector;\n            callbackQueue = new LinkedBlockingQueue<>();\n            executorService = Executors.newCachedThreadPool();\n            for (int i =0; i < 5; i++) {\n                executorService.submit(new Runnable() {\n                    @Override\n                    public void run() {\n                        while (!Thread.currentThread().isInterrupted()) {\n                            List<Runnable> callbacks = new ArrayList<>();\n                            callbackQueue.drainTo(callbacks);\n                            for (Runnable callback : callbacks) {\n                                callback.run();\n                            }\n                            try {\n                                Thread.sleep(100);\n                            } catch (InterruptedException ex) {\n                                Thread.currentThread().interrupt();\n                            }\n                        }\n                    }\n                });\n            }\n        }\n\n        @Override\n        public void execute(final Tuple input) {\n            try {\n                callbackQueue.put(new Runnable() {\n                    @Override\n                    public void run() {\n                        outputCollector.ack(input);\n                    }\n                });\n            } catch (InterruptedException ex) {\n                Thread.currentThread().interrupt();\n                outputCollector.fail(input);\n            }\n        }\n\n        @Override\n        public void declareOutputFields(OutputFieldsDeclarer declarer) {\n\n        }\n\n        @Override\n        public void cleanup() {\n            executorService.shutdownNow();\n        }\n    }\n}\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinconaway","name":"kevinconaway","key":"kevinconaway","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kevinconaway&avatarId=29140","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kevinconaway&avatarId=29140","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kevinconaway&avatarId=29140","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kevinconaway&avatarId=29140"},"displayName":"Kevin Conaway","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-28T20:05:39.195+0000","updated":"2017-08-28T20:05:39.195+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2231/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":8,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/worklog/51095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user HeartSaVioR opened a pull request:\n\n    https://github.com/apache/storm/pull/2293\n\n    STORM-2231 Fix multi-threads issue on executor send queue\n\n    [STORM-2231](https://issues.apache.org/jira/browse/STORM-2231) is an issue to report broken thread-safety on output collector. We mostly considered about grouper implementation, but there's a spot in other side as well.\n    \n    In DisruptorQueue, each incoming threads have each ThreadLocalBatcher, meaning that 'synchronized' in add() can synchronize incoming thread and background flusher thread, but not between incoming threads.\n    Hopefully DisruptorQueue publish*() are implemented to respect thread-safety, but it relies on RingBuffer producer option (Sequencer in RingBuffer), and unfortunately we set producer to SINGLE, not MULTI for executor batch queue. It seems one of optimization but we seemed to miss a spot.  \n    \n    So there're two simple options to choose: just using same ThreadLocalBatcher instance for all incoming thread (class name should be changed) or just changing producer mode to MULTI. This patch addresses later option, because it is just simple, and expected to be faster than former.\n    \n    The change is expected to bring any kind of performance hit, so may also need to do some performance tests against the patch.\n    \n    @revans2 Could you take a look at? It is related to disruptor batching.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/HeartSaVioR/storm STORM-2231\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2293.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2293\n    \n----\ncommit 2b15fc4fc7189f2f42a0fea13f2ca00a6675d6c7\nAuthor: Jungtaek Lim <kabhwan@gmail.com>\nDate:   2017-08-24T11:11:41Z\n\n    STORM-2231 Fix multi-threads issue on executor send queue\n    \n    * we have use cases which launches threads and emit/ack concurrently\n    * launched threads will create ThreadLocalBatcher for each\n      * hence 'synchronized' in add() wouldn't help unlike background flushes\n\n----\n","created":"2017-08-24T15:59:56.320+0000","updated":"2017-08-24T15:59:56.320+0000","started":"2017-08-24T15:59:56.314+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51095","issueId":"13025078"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/worklog/51096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2293\n  \n    Attached perf. test numbers.\n    \n    TVL, rate 100000, topology.max.spout.pending=5000\n    \n    > before patch\n    \n    uptime:  241 acked: 3,015,580 acked/sec: 100,519.33 failed:        0 99%:      48,562,175 99.9%:      68,943,871 min:       6,598,656 max:     113,115,135 mean:   16,473,567.56 stddev:    7,837,977.69 user:    209,500 sys:     31,370 gc:      4,059 mem:     603.67\n    uptime:  241 acked: 3,015,560 acked/sec: 100,518.67 failed:        0 99%:      59,047,935 99.9%:     118,292,479 min:       6,529,024 max:     190,054,399 mean:   16,693,789.11 stddev:   10,039,823.68 user:    210,070 sys:     31,890 gc:      3,942 mem:     696.79\n    uptime:  240 acked: 3,013,360 acked/sec: 100,445.33 failed:        0 99%:      43,450,367 99.9%:      60,948,479 min:       6,533,120 max:      95,354,879 mean:   16,021,801.15 stddev:    6,956,089.85 user:    209,140 sys:     32,040 gc:      3,699 mem:     565.77\n    \n    > after patch\n    \n    uptime:  240 acked: 3,013,520 acked/sec: 100,450.67 failed:        0 99%:      70,975,487 99.9%:     126,418,943 min:       6,533,120 max:     209,321,983 mean:   17,371,349.66 stddev:   11,903,746.03 user:    212,520 sys:     30,080 gc:      4,248 mem:     680.16\n    uptime:  240 acked: 3,014,140 acked/sec: 100,471.33 failed:        0 99%:      87,425,023 99.9%:     148,504,575 min:       6,488,064 max:     240,517,119 mean:   18,471,646.86 stddev:   14,432,363.00 user:    213,850 sys:     30,490 gc:      4,334 mem:     656.84\n    uptime:  240 acked: 3,015,380 acked/sec: 100,512.67 failed:        0 99%:      49,119,231 99.9%:      77,791,231 min:       6,656,000 max:     132,579,327 mean:   16,009,039.03 stddev:    7,829,363.14 user:    206,440 sys:     31,640 gc:      3,828 mem:   1,066.89\n    \n    It seems to be clear performance hit which is expected. \n    \n    So maybe, 2 cents, if we have consensus that the use case is minor (initiating poll to user@/dev@, or any other approaches), we can consider about not supporting thread-safety on output collector for the benefit of major use cases.\n","created":"2017-08-24T16:06:51.800+0000","updated":"2017-08-24T16:06:51.800+0000","started":"2017-08-24T16:06:51.799+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51096","issueId":"13025078"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/worklog/51099","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user kevinconaway commented on the issue:\n\n    https://github.com/apache/storm/pull/2293\n  \n    Can you explain the results a bit? From my reading, the number of tuples acked/second is nearly the same\n","created":"2017-08-24T17:29:40.165+0000","updated":"2017-08-24T17:29:40.165+0000","started":"2017-08-24T17:29:40.162+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51099","issueId":"13025078"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/worklog/51103","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2293\n  \n    @kevinconaway\n    TVL topology tries to keep up acked/second rate so unless topology can't keep up, it should be similar to what we set to rate. (100000)\n    \n    So this tries to lock throughput, and see latency and also CPU / memory usage. The result fluctuates, so we run the test multiple times.\n","created":"2017-08-24T21:15:12.805+0000","updated":"2017-08-24T21:15:12.805+0000","started":"2017-08-24T21:15:12.801+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51103","issueId":"13025078"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/worklog/51145","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2293\n","created":"2017-08-26T12:18:09.232+0000","updated":"2017-08-26T12:18:09.232+0000","started":"2017-08-26T12:18:09.225+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51145","issueId":"13025078"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/worklog/51146","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2293\n  \n    FYI: also merged into 1.x version line (1.x, 1.1.x, 1.0.x) via cherry-picking https://github.com/apache/storm/commit/501ef1489813753b9bbec72c0b43b6b696277c4a\n","created":"2017-08-26T12:20:05.291+0000","updated":"2017-08-26T12:20:05.291+0000","started":"2017-08-26T12:20:05.290+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51146","issueId":"13025078"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/worklog/51147","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user kevinconaway commented on the issue:\n\n    https://github.com/apache/storm/pull/2293\n  \n    So is the performance hit not a concern here?\n    \n    Is the workaround to synchronize on the outputcollector?\n","created":"2017-08-26T12:24:39.543+0000","updated":"2017-08-26T12:24:39.543+0000","started":"2017-08-26T12:24:39.539+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51147","issueId":"13025078"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025078/worklog/51148","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2293\n  \n    @kevinconaway \n    I think I'm late on commenting to JIRA issue. Performance hit is not avoidable in this case.\n    \n    As I commented earlier, if we have consensus that the use case is minor (initiating poll to user@/dev@, or any other approaches), we can consider about not supporting thread-safety on output collector for the benefit of major use cases. We could even make grouper code thread-unsafe and gain more performance improvement if we're OK to drop it.\n    \n    If we drop thread-safety of output collector, even wrapping output collector will not work if you have the case - N tasks : 1 executor, because output collector instance is created per each task but executor send queue is shared.\n","created":"2017-08-26T12:34:06.237+0000","updated":"2017-08-26T12:34:06.237+0000","started":"2017-08-26T12:34:06.237+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51148","issueId":"13025078"}]},"customfield_12311820":"0|i372pb:"}}