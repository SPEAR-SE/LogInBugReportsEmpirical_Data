{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12820758","self":"https://issues.apache.org/jira/rest/api/2/issue/12820758","key":"STORM-770","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-04-14T22:39:04.251+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun May 31 08:55:22 UTC 2015","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-770/watchers","watchCount":10,"isWatching":false},"created":"2015-04-14T08:55:13.303+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326452","id":"12326452","name":"0.9.2-incubating","archived":false,"released":true,"releaseDate":"2014-06-25"}],"customfield_12312339":null,"issuelinks":[{"id":"12421242","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12421242","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12786813","key":"STORM-737","self":"https://issues.apache.org/jira/rest/api/2/issue/12786813","fields":{"summary":"Workers may try to send to closed connections","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12421608","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12421608","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12821761","key":"STORM-790","self":"https://issues.apache.org/jira/rest/api/2/issue/12821761","fields":{"summary":"Log \"task id is null\" instead of let worker died (NPE in consumeBatchToCursor)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12426274","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12426274","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12833974","key":"STORM-841","self":"https://issues.apache.org/jira/rest/api/2/issue/12833974","fields":{"summary":"Thread-safeness of OutputCollector has documented contrary to two official doc.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/20","id":"20","description":"Documentation or Website","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/documentation.png","name":"Documentation","subtask":false}}}}],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-05T01:15:53.192+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"We got the following exception after our topology had been up for ~2 days, and I was wondering if it might be related. \nLooks like \"task\" in \"mk-transfer-fn\" is null, making \"(.add remote (TaskMessage. task (.serialize serializer tuple)))\" fail on NPE (worker.clj:128, storm-core-0.9.2-incubating.jar)\n\njava.lang.RuntimeException: java.lang.NullPointerException\nat backtype.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:128) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\nat backtype.storm.utils.DisruptorQueue.consumeBatchWhenAvailable(DisruptorQueue.java:99) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\nat backtype.storm.disruptor$consume_batch_when_available.invoke(disruptor.clj:80) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\nat backtype.storm.disruptor$consume_loop_STAR_$fn__758.invoke(disruptor.clj:94) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\nat backtype.storm.util$async_loop$fn__457.invoke(util.clj:431) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\nat clojure.lang.AFn.run(AFn.java:24) [clojure-1.5.1.jar:na]\nat java.lang.Thread.run(Thread.java:745) [na:1.7.0_72]\nCaused by: java.lang.NullPointerException: null\nat clojure.lang.RT.intCast(RT.java:1087) ~[clojure-1.5.1.jar:na]\nat backtype.storm.daemon.worker$mk_transfer_fn$fn__5748.invoke(worker.clj:128) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\nat backtype.storm.daemon.executor$start_batch_transfer_GT_worker_handler_BANG$fn__5483.invoke(executor.clj:256) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\nat backtype.storm.disruptor$clojure_handler$reify__745.onEvent(disruptor.clj:58) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\nat backtype.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:125) ~[storm-core-0.9.2-incubating.jar:0.9.2-incubating]\n... 6 common frames omitted,java.lang.RuntimeException: java.lang.NullPointerException\n\nAny ideas?\n\nP.S.\nAlso saw it here: \nhttp://mail-archives.apache.org/mod_mbox/storm-user/201501.mbox/%3CCABcMBhCusXXU=V1e66wfUATGYH1euQnd1SiOG65-Tp8xLWx0ww@mail.gmail.com%3E\n\nhttps://mail-archives.apache.org/mod_mbox/storm-user/201408.mbox/%3CCAJuQM_4KXHSH2_X08ujuQR76m2C+Dswp0fCiJBmfCAeyqgsFHQ@mail.gmail.com%3E\n\nComment from Bobby\nhttp://mail-archives.apache.org/mod_mbox/storm-user/201501.mbox/%3C574363643.2791948.1420470097280.JavaMail.yahoo@jws10027.mail.ne1.yahoo.com%3E\n\n{quote}\nWhat version of storm are you using?  Are any of the bolts shell bolts?  There is a known\nissue where this can happen if two shell bolts share an executor, because they are multi-threaded. \n- Bobby\n{quote}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"NullPointerException in consumeBatchToCursor","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14495046","id":"14495046","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Could you reproduce this situation? I'm interested on issue but it seems that we doesn't have enough informations.\n\nBtw, you can hook events with implementing ITaskHook, please refer http://storm.apache.org/documentation/Hooks.html.\nSince you're (and I'm) suspecting task id is null, apply-hooks would throw Exception when creating one of EmitInfo, SpoutAckInfo, SpoutFailInfo, BoltExecuteInfo, BoltAckInfo, BoltFailInfo because it receives int, not Integer.\nOr in EmitInfo, there's outTasks field which we can check one or more elements (out task id) is null.\n\nAfter applying then we could become closer to null task id.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-14T22:39:04.251+0000","updated":"2015-04-14T22:43:02.466+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14495060","id":"14495060","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"It seems that out task id could be null. It's broadcast tuple, and it will be sent to all tasks.\n\n{code}\n(defn mk-task-receiver [executor-data tuple-action-fn]\n  (let [^KryoTupleDeserializer deserializer (:deserializer executor-data)\n        task-ids (:task-ids executor-data)\n        debug? (= true (-> executor-data :storm-conf (get TOPOLOGY-DEBUG)))\n        ]\n    (disruptor/clojure-handler\n      (fn [tuple-batch sequence-id end-of-batch?]\n        (fast-list-iter [[task-id msg] tuple-batch]\n          (let [^TupleImpl tuple (if (instance? Tuple msg) msg (.deserialize deserializer msg))]\n            (when debug? (log-message \"Processing received message FOR \" task-id \" TUPLE: \" tuple))\n            (if task-id\n              (tuple-action-fn task-id tuple)\n              ;; null task ids are broadcast tuples\n              (fast-list-iter [task-id task-ids]\n                (tuple-action-fn task-id tuple)\n                ))\n            ))))))\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-14T22:45:56.123+0000","updated":"2015-04-14T22:45:56.123+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14495805","id":"14495805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"body":"Just to make sure I follow, are you saying 'null' is a valid value for a task, or that a task can get a value of 'null' in certain cases, and it's bug?\n\nIt took ~2 days for the topology to break last time I ran it. Since I've restarted it, it's been running ok for about 3 days now. \nSo unfortunately, I haven't been able to reproduce it yet. If it's indeed a race condition, it might be tricky to reproduce.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"created":"2015-04-15T07:38:22.056+0000","updated":"2015-04-15T07:38:22.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14496146","id":"14496146","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"I mean 'out-task-id', but never mind. It seems not related to this issue.\n\nIf you don't mind, could you provide source code snippet which includes topology configuration (Spout / Bolt declaration) and nimbus / supervisor / worker logs if you have?\nMore informations about topology DAG, grouping, fields (if you use field grouping), emit type (direct or not), what component raises NPE (spout or bolt), etc. are very appreciated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-15T13:09:53.914+0000","updated":"2015-04-15T13:09:53.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14496199","id":"14496199","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"https://github.com/apache/storm/commit/861a92eab8740cfc0f83ac4d7ade9a2ab04a8b9b\n\nMaybe it wasn't an issue before this commit (introduced on 0.9.2-incubating) because \n- transfer-fn could publish pair of null task value and serialized tuples without issue (no conversion is being processed)\n-- Please refer mk-transfer-fn\n- transfer-tuple-handler finds node-port with null task value, maybe fail to find, then silently discard tuple\n-- Please refer mk-transfer-tuples-handler\n\nI still don't get why task becomes null (It may be related to grouping, I found some scenario which tasks-fn may return null or [null]), but if it's possible, and there's no issue to discard tuples with null task value, we can easily apply it by modifying mk-transfer-fn.\n\nThough null task value is not acceptable, we need to check null task value before encountering NPE (maybe we can log it when emitting), and log it with various informations for debug.\n\n[~clockfly]\nSince you're author of commit, I wish to hear your motivation / intention of these changeset.\n\nto. committers \nPlease clarify when null task value occurs and whether null task value is acceptable or not.\n\nThanks in advance!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-15T13:55:59.907+0000","updated":"2015-04-15T14:05:42.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14496240","id":"14496240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"body":"The exception reported was observed in one of the bolts, after we had experimented with substantially increasing the traffic being handled by the topology at hand. Its core logic has not been changed in the past few months.\n\nPerhaps it's worth noting that the exception happened all of a sudden, there were no previous warnings or indications of distress in the logs. Once the exception took place, the topology could not recover and went into a restart loop.\n\nTopology details:\nWe're using 'fieldsGrouping', running 2 workers per machine, where the topology at hand is assigned 10 workers (i.e., it is running on 5 nodes). Each worker is assigned 24 executors.\nWe have a total of 5 components, 4 bolts and 1 kafka spout.\nDirect emit is not employed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"created":"2015-04-15T14:30:07.524+0000","updated":"2015-04-15T14:36:08.662+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14496360","id":"14496360","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"body":"I observed the same issue with almost similar environment \n\n- the bolt reads default streams from 2 other bolts with grouping on 2 fields\n- performs heavy cpu operations and also asyncronous i/o operations (core.async).\n- produces no tuples, but some metrics\n- uses (core.async/go CSP-thread to do fails/acks of tuples, so tuples to fail/ack are communicated using core.async/channel, there is one go-routine that checks the channel and does the ack/fail). // I can smell there may exist some problem here with thread-safety... not sure though. It worked long time without issues.\n- What is very important, at the time of the fail and about 30 minutes before, the topology was running near the capacity limit on that scale (performance tests). So, assume there is always data in those 2 streams. \nOn a 2 times lower rate the issue is not observed.\n\nAlso \"the exception happened all of a sudden, there were no previous warnings or indications of distress in the logs.\" The topology recovered in several minutes after the load was decreased back to \"normal\". No rebalance, re-deploy, or nodes restarts were accomplished.\n\nI have also prepared all the logs, let me know if they also bring someting. \nAlso, the part that is missing in logs above: \n{code}\n// Assumed the java.lang.RuntimeException: java.lang.NullPointerException happened at 14:32:30.682\n// supervisor.log\n2015-04-15T14:33:02.360 b.s.d.supervisor [INFO] Shutting down and clearing state for id 9acc8f8a-4593-4798-87d2-5dfbffc5ac39. Current supervisor time: 1429101182. State: :timed-out, Heartbeat: #backtype.storm.daemon.common.WorkerHeartbeat{:time-secs 1429101151, :storm-id \"changed-topology-name-380-1428677575\", :executors #{[30 30] [-1 -1]}, :port 6709}\n2015-04-15T14:33:02.364 b.s.util [INFO] Error when trying to kill 42221. Process is probably already dead.\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-15T15:28:44.341+0000","updated":"2015-04-15T15:28:44.341+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14496409","id":"14496409","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"body":"Interesting, our topology never recovered on its own and we had to restart it manually.\nWe did not reduce the load though, which remained high ever since we cranked it up and saw the exception in the first place.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"created":"2015-04-15T15:46:58.874+0000","updated":"2015-04-15T15:46:58.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14497125","id":"14497125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Did nimbus node too busy? \nNimbus should detect killed / hanging worker by heartbeat, and ask supervisor to kill it and restart worker.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-15T22:19:13.006+0000","updated":"2015-04-15T22:19:13.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14497147","id":"14497147","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"It seems that we can find similar conditions from two situations, high load, field grouping.\n\nBtw, I can't find any thread-unsafe possibilities from field-grouper. Maybe I'll try to dig other things (DisruptorQueue).\n\n{code}\n(defn- mk-fields-grouper [^Fields out-fields ^Fields group-fields ^List target-tasks]\n  (let [num-tasks (count target-tasks)\n        task-getter (fn [i] (.get target-tasks i))]\n    (fn [task-id ^List values]\n      (-> (.select out-fields group-fields values)\n          tuple/list-hash-code\n          (mod num-tasks)\n          task-getter))))\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-15T22:30:33.246+0000","updated":"2015-04-15T22:30:33.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14497649","id":"14497649","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"body":"I did not see any abnormal stats reported by the nimbus, CPU, soft-interrupts, network, nothing seemed out of the ordinary.\n\nI have to admit though, that we rarely see a topology ever recover on its own when a bolt fails. When a bolt goes down, it results in cascading failures in other bolts trying communicate with it, which makes them fail as a result. This usually creates a situation where the various components of the topology would go up and down in waves, without ever reaching a state where all are up successfully. \n\nHowever, I don't think it's particularly related to the case at hand, just a background story.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"created":"2015-04-16T07:02:26.660+0000","updated":"2015-04-16T07:02:26.660+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14497686","id":"14497686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"body":"Regarding nimbus-node in 2nd case - everything seems to be fine.\nThe worker in our case is detected ~32 seconds later after exception happened as {{:timed-out}} and then is tried to be killed by supervisor, but is already dead. See the supervisor log above.\n\nIn regards to recovering the topology functioning on it's own, in our case we have observed such behaviour some times ago (on storm 0.9.2-incubating) and made a conclusion that this was STORM-537.\nOn storm-0.9.3 this issue reported to be fixed, and I confirm that in our case same topology could return to functioning state on it's own.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-16T07:56:04.837+0000","updated":"2015-04-16T07:57:07.407+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14499225","id":"14499225","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Before finding root cause of this issue, it would be better to let worker not killed by this issue but just log with WARN or ERROR level.\n\nIt really makes sense cause before 0.9.2 Storm silently ignores tuple, and with Guaranteeing Message Processing, after timed-out tuple will be replayed. (It isn't applied to non-ack)\n\nI'll make a new issue addressing it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-17T04:29:53.816+0000","updated":"2015-04-17T04:29:53.816+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14499262","id":"14499262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"STORM-790 addresses my comment - log strange behavior instead of killing entire worker.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-17T05:15:10.540+0000","updated":"2015-04-17T05:15:10.540+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14501774","id":"14501774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"body":"Just happened again, this time after the topology ran for about ~2.5 days.\nFrom what we're seeing here, it looks like it's pretty safe to say this issue is not a one timer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"created":"2015-04-19T10:04:07.828+0000","updated":"2015-04-19T10:04:07.828+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14502208","id":"14502208","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"[~staslev]\nCould you try patch STORM-790 and try again?\nIt needs to replace lib/storm-core*.jar from your cluster and restart cluster.\n\nIf you're not sure about patching source and build your own, I can provide patched storm-core*.jar","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-20T01:21:17.517+0000","updated":"2015-04-20T01:21:17.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14503542","id":"14503542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"When you run patched version of Storm, please share log messages if any kind of \"Can't transfer tuple - task value is null. tuple information ... \" messages are available. \nPlease notice it will be WARN level.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-20T20:22:56.860+0000","updated":"2015-04-20T20:22:56.860+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14506822","id":"14506822","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"body":"I had a chance to test 0.9.4 with this patch on it, have not seen neither the exception, nor the WARN level message. It is already second day as it runs.\nI observe some other errors, but I am sure now that they are side-effects of trying 0.9.4 as they happen in other bolts. The bolt that had the NPE is now functioning without errors.\n\nNext step is to revert to pure 0.9.3 with only this patch applied.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-22T10:59:36.556+0000","updated":"2015-04-22T11:01:07.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14507018","id":"14507018","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Thanks for following up!\nWe would be better to have newly added logs to continue resolving. You're doing a great job!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-22T13:01:32.078+0000","updated":"2015-04-22T13:01:32.078+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14507221","id":"14507221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"body":"So, the 0.9.3 deploy went fine, it is about 3 hours running. I have not seen the exception, but I have seen the 2 WARN messages that we are looking for. We have all logs machine-processed and indexed for search, so I can guarantee, than in the cluster (6 machines) in last 3 hours only 2 of such WARN occurred.\nHowever, the scenario is different now.\n\nThe messages are unfortunately not as helpful as expected, because there is no tuple information printed.\n\nThe exception happens on different bolts of different topologies. \nBut both of them do some prepare operations - they prepare sessions and statements for work with Cassandra.\n\n\n{code}\n\n2015-04-22T14:30:44.689+0200 b.s.d.executor [INFO] Prepared bolt db-reader:(4)\n2015-04-22T14:30:44.789+0200 b.s.d.worker [WARN] Can't transfer tuple - task value is null. tuple information: \n\n// ... after this it works normally.\n\n{code}\n\non the second bolt it is the same, topology and the name of the bolt is different.\n\n{code}\n\n2015-04-22T14:51:48.847+0200 b.s.d.executor [INFO] Prepared bolt db-writer:(28)\n2015-04-22T14:51:55.525+0200 b.s.d.worker [WARN] Can't transfer tuple - task value is null. tuple information: \n\n{code}\n\n\nWhat may be a hint, is that storm is using netty for message transfer, and so does cassandra, which is initialized in prepare-method in these bolts. I doubt that this could somehow interfere, but decided to mention this.\n\nThese are cassandra driver and it's dependencies.\n{code}\n[com.datastax.cassandra/cassandra-driver-core \"2.1.2\"]\n     [com.codahale.metrics/metrics-core \"3.0.2\"]\n     [io.netty/netty \"3.9.0.Final\"]\n{code}\n\nStorm 0.9.3 is using same version {{<netty.version>3.9.0.Final</netty.version>}}\n\nI will let the patched 0.9.3 running and will observe if the issue appear further and under which circumstances.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-22T15:05:08.730+0000","updated":"2015-04-22T15:05:08.730+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14508036","id":"14508036","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Thanks!\n\nYour input makes me feeling...\n\n- The problem occurs more than I thought. IMO, it is a really major issue and it should be addressed.\n- My patch works fine, so it should be introduced to prevent random worker crash.\n- Tuple information doesn't print anything. It is a hint itself.\n-- Normally it should print like {noformat}15937 [Thread-106-disruptor-executor[12 12]-send-queue] WARN  backtype.storm.daemon.worker - transfering tuple - task value is 3 and tuple information: source: __acker:12, stream: __ack_ack, id: {}, [8773541098787514395]{noformat}\n-- Here is TupleImpl's toString()\n{code}\n    @Override\n    public String toString() {\n        return \"source: \" + getSourceComponent() + \":\" + taskId + \", stream: \" + streamId + \", id: \"+ id.toString() + \", \" + values.toString();\n    }\n{code}\n-- TridentTupleView doesn't implement toString(), but it should print object information as same as Object.toString()\n-- It shows that at that time tuple variable was not referencing instance of TupleImpl. Maybe empty Array or empty String?\n\nCould you drag message to determine that tuple's information has spaces or new line? Thanks in advance!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-22T22:29:14.008+0000","updated":"2015-04-22T22:30:20.709+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14508054","id":"14508054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"http://www.michael-noll.com/blog/2013/06/21/understanding-storm-internal-message-buffers/\n\nAFAIK it is related to sending, from User Logic to Worker Send Thread in post's illustration.\nBut we met strange tuple before transmitting, so I don't think it is related to Netty for now.\n\nIt may be related to Disruptor since Disruptor plays as queue, and User Logic could never emit non-tuple.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-22T22:44:03.214+0000","updated":"2015-04-22T22:44:03.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14508169","id":"14508169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"I've modified STORM-790 to leave tuple's type which gives us perfect evidence.\n[~pershyn] If you really don't mind, could you apply updated patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-22T23:45:46.547+0000","updated":"2015-04-22T23:45:46.547+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14508718","id":"14508718","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"body":"Thanks :)\n\nI have extended the patch a bit and applied.\n\nThere is a {{backtype.storm.daemon.worker/mk-transfer-local-fn}}, and I observed, that it produces quite frequently the \"Received invalid messages for unknown tasks. Dropping...\".\n\nI am really curious, so I extended the {{mk-transfer-local-fn}} to print a bit more info about the \"unknown\" tuple-batch.\n\n{code}\n ;...\n   (log-warn \"Received invalid messages for unknown tasks. Dropping... tuple-batch type: \" (type tuple-batch) \", value: \" tuple-batch)\n ;...\n{code}\n\nSo, now the storm-0.9.3 with this patch is running. Logs are monitored, so I am looking forward to get more information.\n\nThanks for your work ;-)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-23T09:14:14.573+0000","updated":"2015-04-23T09:14:39.270+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14508987","id":"14508987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Great!\nI'm also looking forward to see it. Thanks for follow up again! :)\n\nBtw, it'll print type / information of both tuple (which was a reason to crash) and whole tuple-batch, right?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-23T12:43:18.425+0000","updated":"2015-04-23T12:46:08.684+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14509038","id":"14509038","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"body":"So, I have got the first one. Again, it happens after the bolt was initialized after rebalance (not on initial submit).\n\nThis is the line that is built into the storm-core (from patch):\n{code}\n(log-warn \"Can't transfer tuple - task value is null. tuple type: \" (type tuple) \" and information: \" tuple))\n{code}\n\nThis is the result that it produces:\n{code}\n// happens strait after {{prepare}} method of a bolt.\n2015-04-23T14:46:59.517+0200 b.s.d.worker [WARN] Can't transfer tuple - task value is null. tuple type:  and information: \n{code}\n\nI am confused why we don't see {{nil}} there. Is it possible that {{log-warn}} prints nothing instead? \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-23T13:27:27.204+0000","updated":"2015-04-23T13:28:08.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14509858","id":"14509858","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"I am confused, too. I'm beginner to clojure, I don't even think about it could be possible.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-23T21:32:31.651+0000","updated":"2015-04-23T21:32:31.651+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14512514","id":"14512514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"I just got it. \nhttps://groups.google.com/d/msg/clojure/s15BAMnZlCM/8K-Px1CqdeEJ\n\nMaybe tuple is nil as you assumed.\nI'll update my PR to print nil properly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-25T14:45:05.035+0000","updated":"2015-04-25T14:45:05.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14512521","id":"14512521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"OK, I've updated it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-25T14:51:14.925+0000","updated":"2015-04-25T14:51:14.925+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14517213","id":"14517213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"body":"Good finding, I thought the log-warn is having same behaviour as {{print}}, and {{print}} prints {{nil}}.\n\nSo, I have patched the 0.9.3 again and let it running couple days.\nSince then I have observed several following messages. They happen mostly after deploying new topology or rebalancing. But as well in the middle of the workflow. Some times there are handled exceptions around. So, in user code there is exception thrown and handled.\n\n{code}\n2015-04-27T16:37:33.011+0200 b.s.d.executor [INFO] Prepared bolt db-writer:(21)\n2015-04-27T16:39:02.503+0200 b.s.d.worker [WARN] Can't transfer tuple - task value is nil. tuple type: nil and information: nil\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-28T15:34:09.274+0000","updated":"2015-04-28T15:35:32.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14518335","id":"14518335","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Good.\nDid you extend the patch as you mentioned and see what tuple-batch's type and value are?\nIf you did, could you share what it printed out?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-28T23:19:12.015+0000","updated":"2015-04-28T23:19:12.015+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14521072","id":"14521072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"body":"I did extended it, but so far there were no such errors (Dropping unknown messages) observed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pershyn","name":"pershyn","key":"pershyn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Pershyn","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-30T07:39:58.752+0000","updated":"2015-04-30T07:39:58.752+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14526499","id":"14526499","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhussonnois","name":"fhussonnois","key":"fhussonnois","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Florian Hussonnois","active":true,"timeZone":"Etc/UTC"},"body":"We observed the same issue with storm 0.9.3.\nWe got the NPE after our topology had been up for few minutes.\n\nThe exception occurred only with bolts executing tuples in batch (using TickTuple). The bolt does async cassandra statements. Each tuple is ack/fail by a single thread instantiated in the prepare method (ThreadPoolExecutor).\n\nCould the issue be caused by acking tuples from a thread that is not a storm task ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fhussonnois","name":"fhussonnois","key":"fhussonnois","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Florian Hussonnois","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-04T10:19:01.397+0000","updated":"2015-05-04T10:19:01.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14562091","id":"14562091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"[~fhussonnois] \nThanks for information! I think I'm too late to comment.\n\nActually there're some issues with documentation.\n\nhttp://storm.apache.org/documentation/Concepts.html says\n\n{quote}\nIts perfectly fine to launch new threads in bolts that do processing asynchronously. OutputCollector is thread-safe and can be called at any time.\n{quote}\n\nand http://storm.apache.org/documentation/Troubleshooting.html says\n\n{quote}\nThis is caused by having multiple threads issue methods on the OutputCollector. All emits, acks, and fails must happen on the same thread. One subtle way this can happen is if you make a IBasicBolt that emits on a separate thread. IBasicBolt's automatically ack after execute is called, so this would cause multiple threads to use the OutputCollector leading to this exception. When using a basic bolt, all emits must happen in the same thread that runs execute.\n{quote}\n\nIt is a contradiction, and at least for now OutputCollector is not thread-safe.\nhttps://www.mail-archive.com/dev@storm.incubator.apache.org/msg00939.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-05-28T00:43:14.430+0000","updated":"2015-05-28T00:43:14.430+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14566445","id":"14566445","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"OK. I got a hint from archive of Storm Dev mailing list.\nhttps://www.mail-archive.com/dev@storm.incubator.apache.org/msg00939.html\n\nAs we know already (or not) OutputCollector is not thread-safe.\nAnd if you don't respect this, task id and tuple could be null, and it could throw NPE with various causes.\n\nBefore 0.9.2, cause of NPE is \"KryoTupleSerializer.serialize() tries to serialize null\", cause tuple is null.\nAt 0.9.2 or upper version, cause of NPE is \"clojure.lang.RT.intCast() tries to cast null\", cause task id is null.\n\nPlease leave replies when you found another cases. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-05-31T08:23:23.322+0000","updated":"2015-05-31T08:23:23.322+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14566448","id":"14566448","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"body":"Thanks, I am indeed aware of that (we've probably read the same posts :) ).\nI'm synchronizing on the output collector instance before invoking on it, the exception I've reported in this ticket happens with the synchronization in place.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"created":"2015-05-31T08:29:39.385+0000","updated":"2015-05-31T08:29:39.385+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14566457","id":"14566457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Yes. It seems to be one kind of way to reach this issue.\nBut I can't find other ways, for example, meet NPE from Bolt which doesn't launch new thread.\nCan I see your Bolt implementation if you don't really mind?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-05-31T08:42:40.108+0000","updated":"2015-05-31T08:42:40.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820758/comment/14566464","id":"14566464","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"body":"I'll check if that's something that can be arranged.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=staslev","name":"staslev","key":"staslev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=staslev&avatarId=30630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=staslev&avatarId=30630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=staslev&avatarId=30630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=staslev&avatarId=30630"},"displayName":"Stas Levin","active":true,"timeZone":"Asia/Jerusalem"},"created":"2015-05-31T08:55:22.700+0000","updated":"2015-05-31T08:55:22.700+0000"}],"maxResults":38,"total":38,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-770/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2d7uv:"}}