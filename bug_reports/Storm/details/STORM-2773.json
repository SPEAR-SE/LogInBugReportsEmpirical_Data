{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13108185","self":"https://issues.apache.org/jira/rest/api/2/issue/13108185","key":"STORM-2773","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":10200,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":10200,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2017-10-10 03:03:56.474","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2773/watchers","watchCount":1,"isWatching":false},"created":"2017-10-10T03:03:56.474+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liuzhaokun","name":"liuzhaokun","key":"liuzhaokun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liuzhaokun","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-03-20T06:50:18.095+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12332475","id":"12332475","name":"storm-client"}],"timeoriginalestimate":null,"description":"There is a cluster which includes three nodes named storm1,storm2,storm3.And there is a drpcserver in every node,a worker which has been started on strom1.When strom1 was down with hardware failure,my drpc topology won't work,when I send request from drpcclient.\r\nAs storm1 was down,so the worker will be restarted on another node,but it can't Initialize successfully because the call method of Adder will throw a RuntimeException,when drpcspout try to connect to storm1,so the worker will restart again. \r\n\r\nIn conclusion,If a drpcserver node in cluster is down,drpc cluster won't work until we modify the drpc.server configuration and restart the cluster,but in production,it's difficult to restart whole cluster.\r\n\r\nSo I think we should catch the RuntimeException and log it,and the drpc topology will work normally.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"2h 50m","remainingEstimateSeconds":0,"timeSpentSeconds":10200},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"If a drpcserver node in cluster is down,drpc cluster won't work if we don't modify the drpc.server configuration and restart the cluster","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liuzhaokun","name":"liuzhaokun","key":"liuzhaokun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liuzhaokun","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liuzhaokun","name":"liuzhaokun","key":"liuzhaokun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liuzhaokun","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":10200,"total":10200,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":10200,"total":10200,"percent":100},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2773/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":17,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/54062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user liu-zhaokun opened a pull request:\n\n    https://github.com/apache/storm/pull/2365\n\n    [STORM-2773]If a drpcserver node in cluster is down,drpc cluster won't work if we don't modify the drpc.server configuration and restart the cluster\n\n    [https://issues.apache.org/jira/browse/STORM-2773](https://issues.apache.org/jira/browse/STORM-2773)\r\n    \r\n    There is a cluster which includes three nodes named storm1,storm2,storm3.And there is a drpcserver in every node,a worker which has been started on strom1.When strom1 was down with hardware failure,my drpc topology won't work,when I send request from drpcclient.\r\n    As storm1 was down,so the worker will be restarted on another node,but it can't Initialize successfully because the call method of Adder will throw a RuntimeException,when drpcspout try to connect to storm1,so the worker will restart again.\r\n    In conclusion,If a drpcserver node in cluster is down,drpc cluster won't work until we modify the drpc.server configuration and restart the cluster,but in production,it's difficult to restart whole cluster.\r\n    So I think we should catch the RuntimeException and log it,and the drpc topology will work normally.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/liu-zhaokun/storm master1010\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2365.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2365\n    \n----\ncommit d3dec0d3ca80db518511bf26810d20035ce0ae81\nAuthor: liuzhaokun <liu.zhaokun@zte.com.cn>\nDate:   2017-10-10T03:05:23Z\n\n    [STORM-2773] If a drpcserver node in cluster is down,drpc cluster won't work if we don't modify the drpc.server configuration and restart the cluster\n\n----\n","created":"2017-10-10T03:09:31.705+0000","updated":"2017-10-10T03:09:31.705+0000","started":"2017-10-10T03:09:31.702+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"54062","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/54152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2365#discussion_r143807656\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/drpc/DRPCSpout.java ---\n    @@ -105,13 +105,19 @@ public Adder(String server, int port, Map<String, Object> conf) {\n     \n             @Override\n             public Void call() throws Exception {\n    -            DRPCInvocationsClient c = new DRPCInvocationsClient(conf, server, port);\n    -            synchronized (_clients) {\n    -                _clients.add(c);\n    +            try{\n    +                DRPCInvocationsClient c = new DRPCInvocationsClient(conf, server, port);\n    +                synchronized (_clients) {\n    +                    _clients.add(c);\n    +                }\n    +            }catch (Exception e){\n    +                LOG.warn(\"Can't connect to some drpcserver when init drpcspout,please check your cluster.\");\n    --- End diff --\n    \n    If we are going to warn can we at least log what the exception was that made it so we cannot connect?\n","created":"2017-10-10T18:06:46.995+0000","updated":"2017-10-10T18:06:46.995+0000","started":"2017-10-10T18:06:46.977+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"54152","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/54153","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2365#discussion_r143807488\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/drpc/DRPCSpout.java ---\n    @@ -105,13 +105,19 @@ public Adder(String server, int port, Map<String, Object> conf) {\n     \n             @Override\n             public Void call() throws Exception {\n    -            DRPCInvocationsClient c = new DRPCInvocationsClient(conf, server, port);\n    -            synchronized (_clients) {\n    -                _clients.add(c);\n    +            try{\n    +                DRPCInvocationsClient c = new DRPCInvocationsClient(conf, server, port);\n    +                synchronized (_clients) {\n    +                    _clients.add(c);\n    +                }\n    +            }catch (Exception e){\n    +                LOG.warn(\"Can't connect to some drpcserver when init drpcspout,please check your cluster.\");\n    +            }finally {\n    +                return null;\n    --- End diff --\n    \n    I'm not really sure about having a return in a finally block.  Will it not eat every exception that is ever thrown?  I'm not sure that we want that.\n","created":"2017-10-10T18:06:47.343+0000","updated":"2017-10-10T18:06:47.343+0000","started":"2017-10-10T18:06:47.342+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"54153","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/54154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    You are also going to need to fix the checkstyle errors.\n","created":"2017-10-10T18:07:14.537+0000","updated":"2017-10-10T18:07:14.537+0000","started":"2017-10-10T18:07:14.534+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"54154","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/54226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user liu-zhaokun commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    @revans2 \r\n    I have fix the checkstyle errors and log the exception.Could you help me review this PR again?\n","created":"2017-10-11T10:14:56.717+0000","updated":"2017-10-11T10:14:56.717+0000","started":"2017-10-11T10:14:56.715+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"54226","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/54246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    Actually I have dug deeper, and I think we want to do this differently, although it will be just as simple of a change.\r\n    \r\n    Currently a ConnectException is thrown deep down that end up being wrapped and bubbles up to be a RuntimeException which you are catching and simply not adding that client to the list of clients.  The issue I am concerned about is what happens if the node is temporarily down and will come back up.  Before this would cause the worker to restart until it was back up (not ideal but would work).  With this patch we will end up never having the spout connect to that drpc server.\r\n    \r\n    I think the proper fix is actually here\r\n    \r\n    https://github.com/liu-zhaokun/storm/blob/d92f1a9c8d7442d4959fec57813fc5de42b179a9/storm-client/src/jvm/org/apache/storm/drpc/DRPCInvocationsClient.java#L44\r\n    \r\n    If instead of letting the Exception bubble up and be handled by the Spout we instead will catch/log it and set the AtomicReference to null.  This will allow the spout to do its reconnect logic periodically to try and recover, but will still keep the spout up and running if a node is completely removed.\r\n    \r\n    Longer term it might be interesting to try and replace the config with a location in zookeeper where the DRPC servers can register, so we can add/remove DRPC servers as needed and the system automatically adjusts.\n","created":"2017-10-11T14:30:27.885+0000","updated":"2017-10-11T14:30:27.885+0000","started":"2017-10-11T14:30:27.884+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"54246","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/54539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user liu-zhaokun commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    In the long term, it's difficult for us to improve drpc. But would you like to help merge this PR? \n","created":"2017-10-16T01:19:22.550+0000","updated":"2017-10-16T01:19:22.550+0000","started":"2017-10-16T01:19:22.549+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"54539","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/54555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    @liu-zhaokun I'm not sure you understood my comment from before.  This current code has a bug in it.  If a DRPC server is down when the spout comes up, even temporarily down, it will never try and connect again.  This is not acceptable.  We need it to keep trying periodically.  I think we can fix it by making the change at \r\n    \r\n    https://github.com/liu-zhaokun/storm/blob/d92f1a9c8d7442d4959fec57813fc5de42b179a9/storm-client/src/jvm/org/apache/storm/drpc/DRPCInvocationsClient.java#L44\r\n    \r\n    instead.\n","created":"2017-10-16T13:46:02.857+0000","updated":"2017-10-16T13:46:02.857+0000","started":"2017-10-16T13:46:02.856+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"54555","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/55595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user liu-zhaokun commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    @revans2 \r\n    I try to fix this bug follow your advice,but I found the original bug occurred in line 41 [https://github.com/liu-zhaokun/storm/blob/d92f1a9c8d7442d4959fec57813fc5de42b179a9/storm-client/src/jvm/org/apache/storm/drpc/DRPCInvocationsClient.java#L41](https://github.com/liu-zhaokun/storm/blob/d92f1a9c8d7442d4959fec57813fc5de42b179a9/storm-client/src/jvm/org/apache/storm/drpc/DRPCInvocationsClient.java#L41) drpcinvocationclient wan't to establish connection with the thrift server.And I am not sure we should fix this bug in line 41.Could you give me some suggestion?Thanks.\n","created":"2017-10-26T11:11:26.918+0000","updated":"2017-10-26T11:11:26.918+0000","started":"2017-10-26T11:11:26.914+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"55595","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/55627","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    @liu-zhaokun You are correct I had forgotten the ThriftClient establishes the connection then initializes the _protocol member and then finally the Client itself is created which will read from the protocol.\r\n    \r\n    The solution is that we need a way to not call reconnect from the constructor of ThriftClient.  We have that in a few cases for testing/local mode\r\n    \r\n    https://github.com/liu-zhaokun/storm/blob/d92f1a9c8d7442d4959fec57813fc5de42b179a9/storm-client/src/jvm/org/apache/storm/security/auth/ThriftClient.java#L73-L75\r\n    \r\n     But I think we want another parameter to the constructor to say don't do this, so we can try and connect ourselves and if it fails we can ignore it and go on.\r\n\n","created":"2017-10-26T20:36:12.673+0000","updated":"2017-10-26T20:36:12.673+0000","started":"2017-10-26T20:36:12.671+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"55627","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/55641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user liu-zhaokun commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    @revans2 \r\n    Do you mean there no need to reconnect when I create a DRPCInvocationClient instance?\n","created":"2017-10-27T06:57:46.780+0000","updated":"2017-10-27T06:57:46.780+0000","started":"2017-10-27T06:57:46.779+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"55641","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/55922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    Currently ThriftClient will connect to the server itself in the constructor.  What we want to do is to optionally not do that, and instead let the DRPCInvocationsClient do it in a location where it can catch the exception and ignore it, because we know it is going to try again to reconnect later.\n","created":"2017-10-30T17:50:14.380+0000","updated":"2017-10-30T17:50:14.380+0000","started":"2017-10-30T17:50:14.379+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"55922","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/58538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user liu-zhaokun commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    Hi,@revans2,I'm not sure whether the ci's failure related to me.And I have add a retry to DRPCInvaction,could you help me to review it? \n","created":"2017-11-25T06:37:34.428+0000","updated":"2017-11-25T06:37:34.428+0000","started":"2017-11-25T06:37:34.424+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"58538","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/58825","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user liu-zhaokun commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    @HeartSaVioR \r\n    Hi,are you available to help me review this PR?\n","created":"2017-11-28T00:54:04.191+0000","updated":"2017-11-28T00:54:04.191+0000","started":"2017-11-28T00:54:04.189+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"58825","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/59479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user liu-zhaokun commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    @HeartSaVioR  @revans2 \r\n    Hi,are you available to help me review this PR?\n","created":"2017-12-04T06:08:06.011+0000","updated":"2017-12-04T06:08:06.011+0000","started":"2017-12-04T06:08:06.010+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"59479","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/64311","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user liu-zhaokun commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    Hi,@revans2,I'm not sure whether the ci's failure related to me.And I have add a retry to DRPCInvaction,could you help me to review it?\n","created":"2018-01-02T08:13:29.747+0000","updated":"2018-01-02T08:13:29.747+0000","started":"2018-01-02T08:13:29.745+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"64311","issueId":"13108185"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13108185/worklog/82175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user liu-zhaokun commented on the issue:\n\n    https://github.com/apache/storm/pull/2365\n  \n    @revans2 \r\n    Hi,revans! I guess you  forgot this PR after a long time.I just want to know if this PR is available because I used to work hard to make it. Even if you think it is not good enough, I hope you can reply to me rather than ignore it.\n","created":"2018-03-20T06:50:18.090+0000","updated":"2018-03-20T06:50:18.090+0000","started":"2018-03-20T06:50:18.090+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"82175","issueId":"13108185"}]},"customfield_12311820":"0|i3l2cf:"}}