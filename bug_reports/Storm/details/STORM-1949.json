{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12987370","self":"https://issues.apache.org/jira/rest/api/2/issue/12987370","key":"STORM-1949","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-07-07T06:44:35.446+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Nov 15 22:49:15 UTC 2017","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1949/watchers","watchCount":21,"isWatching":false},"created":"2016-07-07T03:06:30.328+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[{"id":"12474357","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12474357","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12987950","key":"STORM-1956","self":"https://issues.apache.org/jira/rest/api/2/issue/12987950","fields":{"summary":"Disable Backpressure by default","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abellina","name":"abellina","key":"abellina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Bellina","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-11-15T22:49:15.784+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"Problem can be reproduced by this [Word count topology|https://github.com/hortonworks/storm/blob/perftopos1.x/examples/storm-starter/src/jvm/org/apache/storm/starter/perf/FileReadWordCountTopo.java]\nwithin a IDE.\nI ran it with 1 spout instance, 2 splitter bolt instances, 2 counter bolt instances.\n\nThe problem is more easily reproduced with WC topology as it causes an explosion of tuples due to splitting a sentence tuple into word tuples. As the bolts have to process more tuples than the  spout is producing, spout needs to operate slower.\n\nThe amount of time it takes for the topology to stall can vary.. but typically under 10 mins. \n\n*My theory:*  I suspect there is a race condition in the way ZK is being utilized to enable/disable back pressure. When congested (i.e pressure exceeds high water mark), the bolt's worker records this congested situation in ZK by creating a node. Once the congestion is reduced below the low water mark, it deletes this node. \nThe spout's worker has setup a watch on the parent node, expecting a callback whenever there is change in the child nodes. On receiving the callback the spout's worker lists the parent node to check if there are 0 or more child nodes.... it is essentially trying to figure out the nature of state change in ZK to determine whether to throttle or not. Subsequently  it setsup another watch in ZK to keep an eye on future changes.\n\nWhen there are multiple bolts, there can be rapid creation/deletion of these ZK nodes. Between the time the worker receives a callback and sets up the next watch.. many changes may have undergone in ZK which will go unnoticed by the spout. \n\nThe condition that the bolts are no longer congested may not get noticed as a result of this.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12824080","id":"12824080","filename":"1.x-branch-works-perfect.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-17T05:17:58.976+0000","size":437924,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12824080/1.x-branch-works-perfect.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12825141","id":"12825141","filename":"wordcounttopo.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-23T22:22:13.553+0000","size":5253,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12825141/wordcounttopo.zip"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Backpressure can cause spout to stop emitting and stall topology","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15365694","id":"15365694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"body":"can we also have a thread stack taken after the topology gets stalled? It may be of help in debugging the problem further. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-07T06:44:35.446+0000","updated":"2016-07-07T06:44:35.446+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15365705","id":"15365705","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"And I think we need to include section to UI representing \"in-backpressure\" by which components/tasks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2016-07-07T06:54:15.689+0000","updated":"2016-07-07T06:54:15.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15367799","id":"15367799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"We have a backup on the write where we will poll every 100ms to be sure everything is in sync.  We should have a backup polling for reading the data from ZK too.  I thought we did, because we have that on all of the other triggers from ZK, but looking at the code I don't see it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2016-07-08T15:16:26.164+0000","updated":"2016-07-08T15:16:26.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15368451","id":"15368451","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"body":"[~revans2] Not sure what you mean by \"back on the write\" .. are u saying have background thread that simply polls ZK every so often ?  That might fix this issue.\n\nHowever, there is one basic issue with this BP mechanism in general. It can put too much load on ZK. For each enable/disable throttle signal raised by any worker we have all this interaction going on with ZK..\n\n- Some worker adds/deletes ZK node \n- ZK issues callbacks to all workers with watches setup\n- All those workers will list the parent node in ZK to count the number of children (expensive?)\n- All those workers will setup another watch in ZK\n \nGiven that PaceMaker was introduced to take load off of ZK... this approach feels like a regression in terms of ability to scale. There are some other issues as well but thats for later.\n\nAfter reviewing BP, I done feel it is sufficiently mature to be considered stable and ready for production. \n\nIMO Until we have a more solid BP mechanism we should disable it by default as soon as possible. I can open another jira for that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-08T20:49:43.794+0000","updated":"2016-07-08T20:53:11.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15368473","id":"15368473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"+1. Given that there are few issues we should turn it off in defaults.yaml.\n\nMy understanding of backpressure by talking to/debugging with [~roshan_naik] is as soon as we hit the higher or lower ceiling we take an action. \nI would like to see if we can add a time duration to understand that if the bolt is actually hit the ceiling continuously i.e we are not constantly sending signal to spout turn it on or off. Lets say as user if I set this time duration to 1min we can check the higher watermark being hit consistently for 1min than send a signal to turn on back pressure and similarly on lower watermark part. Otherwise we can end up generating false positives on turning on back pressure. \n\nAlso agree with [~roshan_naik] about increased load on zookeeper. If possible explore the possibility of it by a message transfer back to spout or via acker. I am not clear if this is possible need to look into it.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-08T21:06:27.920+0000","updated":"2016-07-08T21:06:27.920+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15368525","id":"15368525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"[~roshan_naik],\n\nWhen writing to ZK every 100 ms we will check to be sure that the ZK state matches the local worker state, just in case there is a race condition and they got off some how.  So yes we should have a backup thread to poll ZK for backpressure in case we get off some how with the triggers.\n\nAs for the load on ZooKeeper yes, that too is one of my concerns, and we at Yahoo have been holding off turning it on by default until it has stabilized a bit and until we have moved all of our clusters to pacemaker.  We expect to turn it on fairly soon.  How expensive is it though?  If you are running zookeeper in the default configuration it can be very expensive because you are constrained by a single disk's IOps, and if you have lots of throttling going on then those IOps can get eaten up fairly quickly.  If you have the flush turned off, then it is going to be constrained by the write log to the disk, or by the network whichever saturates first.  If it is the write log then you get about 80MB/sec of writes, this is just writing a small amount of metadata, so it should not have that big of an impact, but I have not really measured it.  If the network then reads will likely saturate first because of the listings, but again this is a relatively small amount of metadata, so it should have a relatively small impact.\n\nIf you want to turn it off in defaults.yaml that is fine, just file a separate JIRA for that.  If you have a better solution that will reduce the load on ZK that would be great, again file another JIRA for that and we can discuss details there.  I am skeptical that we will get anywhere near as good of a throughput if we put in a delay of some sort, and I think we would start to run into issues with heaps filling up if we put in too much of a delay.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2016-07-08T21:31:24.767+0000","updated":"2016-07-08T21:31:24.767+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15368640","id":"15368640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"body":"\nHave not worked out a concrete solution to avoiding ZK as yet. But [~sriharsha]'s  line of thinking is interesting ... basically see if we can use the internal messaging system as opposed to messaging over ZK. \n\nOpened STORM-1956 for disabling BP by default. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-08T22:59:09.233+0000","updated":"2016-07-08T22:59:09.233+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15370045","id":"15370045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"I'm OK to disable backpressure by default for short time, but we should work on resolving backpressure issue now, and enable backpressure again at next release or so.\nThis is not same as 'event logging', cause event logging is a kind of unique feature of Storm, but backpressure is common feature of recent streaming frameworks. Also backpressure is the only choice of non-ACK topology which needs throttle.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2016-07-11T01:11:12.175+0000","updated":"2016-07-11T01:11:12.175+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15370729","id":"15370729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"I am not sure that we can use our internal messaging as is to make this work.  The messages to turn on and off backpressure would likely get blocked behind actual data messages and never make it to the spout that is throttled off.  I would prefer to see us go towards the model of JStorm and have a topology master, there is a lot of work that ZK is doing that could be moved over to a master. It could easily take over the responsibilities of both pacemaker/ZK(for metrics) and ZK for backpressure.\n\nI'm not sure I am ready to let the master reschedule the topology itself, I prefer to still have centralized scheduling, but I could be persuaded.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2016-07-11T13:16:35.148+0000","updated":"2016-07-11T13:16:35.148+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15370949","id":"15370949","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"body":"I have the same concern as Jungtake with disabling backpressue by default. If my understanding is correct, transfer queues are not bounded anymore and if acking is not enabled, can keep growing. This will result in out of memory exceptions. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-11T15:15:27.496+0000","updated":"2016-07-11T15:15:27.496+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15370955","id":"15370955","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~abhishek.agarwal] [~kabhwan] As we can see keeping this as default is resulting in performance degradation that we are unable to fix in near-term. Since this is a new feature turning it off by default makes sense until we figure out more details.\n[~kabhwan] of course the idea is to fix any issues and make it default.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-11T15:19:05.608+0000","updated":"2016-07-11T15:19:05.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15370998","id":"15370998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"body":"[~sriharsha] We can disable the back-pressure. But I want to know what will be the alternative for topologies with non-acking? If backpressure is not enabled, there should be some other way to bound the send/receive queues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-11T15:36:01.702+0000","updated":"2016-07-11T15:36:01.702+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15371002","id":"15371002","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~abhishek.agarwal] we don't have alternative for non-acking before this back pressure feature. We always told users to depend on acking & topology.max.spout.pending if they need a way to control the fast spout.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-11T15:38:01.361+0000","updated":"2016-07-11T15:38:01.361+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15371017","id":"15371017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knusbaum","name":"knusbaum","key":"knusbaum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knusbaum&avatarId=22452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knusbaum&avatarId=22452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knusbaum&avatarId=22452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knusbaum&avatarId=22452"},"displayName":"Kyle Nusbaum","active":true,"timeZone":"America/Chicago"},"body":"I'm okay with polling ZK for changes as a fix (for now) so we can keep backpressure on by default. There are obviously issues with the design of backpressure in general, but polling shouldn't make these issues significantly worse. I don't think the load on ZK will increase appreciably from a few nodes polling. The load problem is inherent to other parts of backpressure design.\n\nWe could also turn it off by default, but it's nice to have a flow-control mechanism that works automatically without needing the user to perform acking. It might be some time until we have a better system in place. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knusbaum","name":"knusbaum","key":"knusbaum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knusbaum&avatarId=22452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knusbaum&avatarId=22452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knusbaum&avatarId=22452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knusbaum&avatarId=22452"},"displayName":"Kyle Nusbaum","active":true,"timeZone":"America/Chicago"},"created":"2016-07-11T15:47:59.907+0000","updated":"2016-07-11T15:47:59.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15371055","id":"15371055","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"body":"ok. my understanding was that spout will continue emitting new tuples even if consumer is not consuming fast enough. But that won't happen because spout doesn't emit further if transfer queue is full - \nhttps://github.com/apache/storm/blob/1.x-branch/storm-core/src/clj/org/apache/storm/daemon/executor.clj#L647\n[~kabhwan] doesn't this address your concern? \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-11T16:02:24.100+0000","updated":"2016-07-11T16:02:24.100+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15371086","id":"15371086","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~knusbaum] another issue that we've seen is erratic toggling between back pressure on/off. IMO adding a time duration before turning the back pressure on/off might yield a better experience here. Currently we toggle as soon as we hit the higher watermark , how about we observe the pattern for configurable amount of time before we turn on the back pressure. Does this makes sense.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-11T16:17:25.062+0000","updated":"2016-07-11T16:17:25.062+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15372645","id":"15372645","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"If my understanding is right, DisruptorQueue.publish() is only called with block=true from background thread (Flusher), and for other threads it's not blocked. (This change is from Disruptor Batching of Storm 1.0.0.)\nSo receive queues for tasks will receive tuples anyway unless OOME has occurred. There's no blocking on consumer side.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2016-07-12T10:13:19.882+0000","updated":"2016-07-12T10:15:18.807+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15372729","id":"15372729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"body":"I see. You mean to say that consumer may be slow but transfer thread will continue to populate receive queues. Since transfer thread doesn't slow down, spout too will keep pumping out the data. is that correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishek.agarwal","name":"abhishek.agarwal","key":"abhishek.agarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Agarwal","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-12T11:30:59.686+0000","updated":"2016-07-12T11:30:59.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15372766","id":"15372766","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Receive thread in downstream is not blocked at all, so transfer thread in upstream is not blocked at all unless there're some other issues which make worker unable to send messages (for example,  downstream worker crash)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2016-07-12T11:57:53.153+0000","updated":"2016-07-12T11:57:53.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15376701","id":"15376701","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Removing EPIC since hotfix (STORM-1956) is applied to 1.0.2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2016-07-14T09:57:27.700+0000","updated":"2016-07-14T09:57:27.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15423891","id":"15423891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"body":"1.x-branch, back pressure works perfect!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-17T05:07:51.298+0000","updated":"2016-08-17T05:07:51.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15423899","id":"15423899","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~roshan_naik] [~revans2] [~knusbaum] [~kabhwan],\n\nI tested with the word count example sent by Roshan, the results is: Backpressure works fine for 1.x-branch while in master (2.x), we have a NullPointerExecution in SpoutExecutor.\n\n(1) in 1.x-branch, back pressure works well (see the attached screenshot). The back pressure flag gets set and unset intermittently depending on the population in disruptor queues. [~roshan_naik], I think your guess of reason (racing condition) is incorrect since we have cyclic check of flags every 100 ms, as mentioned by Bobby.\n\n\n(2) in test for master, I see the topology gets stalled quickly, less than a minute. But the reason is not because of the bug of back pressure, it is due to the NullPointerException in Executor.\nhttps://github.com/apache/storm/blob/master/storm-core/src/jvm/org/apache/storm/executor/spout/SpoutExecutor.java#L205\n[~Cody] Could you help with this NPE since you worked on Storm-1277? \nThanks a lot!\n\n\n 80 2016-08-16 21:19:15.102 o.a.s.m.EventLoggerBolt [INFO] EventLoggerBolt prepare called\n 81 2016-08-16 21:19:15.107 o.a.s.m.FileBasedEventLogger [INFO] logFilePath /Users/zliu6/git/joe/storm/storm-dist/binary/target/storm/logs/workers-artifacts/FileReadWordCountTopo-1-1471407540/6700    /events.log\n 82 2016-08-16 21:19:15.110 o.a.s.e.b.BoltExecutor [INFO] Prepared bolt __eventlogger:[2]\n 83 2016-08-16 21:20:17.242 o.a.s.u.Utils [ERROR] Async loop died!\n 84 java.lang.RuntimeException: java.lang.NullPointerException\n 85     at org.apache.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:468) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n 86     at org.apache.storm.utils.DisruptorQueue.consumeBatchWhenAvailable(DisruptorQueue.java:434) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n 87     at org.apache.storm.utils.DisruptorQueue.consumeBatch(DisruptorQueue.java:424) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n 88     at org.apache.storm.executor.spout.SpoutExecutor$2.call(SpoutExecutor.java:137) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n 89     at org.apache.storm.utils.Utils$7.run(Utils.java:2227) [storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n 90     at java.lang.Thread.run(Thread.java:745) [?:1.8.0_77]\n 91 Caused by: java.lang.NullPointerException\n 92     at org.apache.storm.executor.spout.SpoutExecutor.tupleActionFn(SpoutExecutor.java:205) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n 93     at org.apache.storm.executor.Executor.onEvent(Executor.java:257) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n 94     at org.apache.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:455) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n 95     ... 5 more\n 96 2016-08-16 21:20:17.860 o.a.s.e.e.ReportError [ERROR] Error\n 97 java.lang.RuntimeException: java.lang.RuntimeException: java.lang.NullPointerException\n 98     at org.apache.storm.utils.Utils$7.run(Utils.java:2237) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n 99     at java.lang.Thread.run(Thread.java:745) [?:1.8.0_77]\n100 Caused by: java.lang.RuntimeException: java.lang.NullPointerException\n101     at org.apache.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:468) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n102     at org.apache.storm.utils.DisruptorQueue.consumeBatchWhenAvailable(DisruptorQueue.java:434) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n103     at org.apache.storm.utils.DisruptorQueue.consumeBatch(DisruptorQueue.java:424) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n104     at org.apache.storm.executor.spout.SpoutExecutor$2.call(SpoutExecutor.java:137) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n105     at org.apache.storm.utils.Utils$7.run(Utils.java:2227) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n106     ... 1 more\n107 Caused by: java.lang.NullPointerException\n108     at org.apache.storm.executor.spout.SpoutExecutor.tupleActionFn(SpoutExecutor.java:205) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n109     at org.apache.storm.executor.Executor.onEvent(Executor.java:257) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n110     at org.apache.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:455) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n111     at org.apache.storm.utils.DisruptorQueue.consumeBatchWhenAvailable(DisruptorQueue.java:434) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n112     at org.apache.storm.utils.DisruptorQueue.consumeBatch(DisruptorQueue.java:424) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n113     at org.apache.storm.executor.spout.SpoutExecutor$2.call(SpoutExecutor.java:137) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n114     at org.apache.storm.utils.Utils$7.run(Utils.java:2227) ~[storm-core-2.0.0-SNAPSHOT.jar:2.0.0-SNAPSHOT]\n115     ... 1 more\n\n \n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-17T05:14:20.449+0000","updated":"2016-08-17T05:19:11.202+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15423902","id":"15423902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"body":"[~kabhwan] [~revans2], once the NPE is fixed, we may enable the back pressure by default again. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-17T05:17:03.542+0000","updated":"2016-08-17T05:17:03.542+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15423908","id":"15423908","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~zhuoliu]  The problem we encountered not the storm workers are unable to add a node in zookeeper but it rather happening very fast thus erratic on/off behavior with backpressure. Thats what we are discussing in this jira. Its not just NPE but the current behavior in backpressure not ideal and there are some proposals here in improving it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-17T05:24:01.813+0000","updated":"2016-08-17T05:24:01.813+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15423916","id":"15423916","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"body":"With BP disabled the topo ran fine. Dont think saw any NPE during my runs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-17T05:28:05.628+0000","updated":"2016-08-17T05:28:05.628+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15423925","id":"15423925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"body":"Hi roshan,\nCould you test 1-x branch with bp enabled? \nSo here bp just helped us find a bug in other parts of storm: the pending queue of spout executor gets polled and referenced before a null checking.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-17T05:36:39.123+0000","updated":"2016-08-17T05:36:39.123+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15423934","id":"15423934","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"body":"Hi Sriharsha, yep, I was talking about the short-term diagnosis of the root cause. In the long term, if we have such as topology master's appearance to take the back pressure or more other responsibility, I would be happy to see that. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-17T05:43:16.189+0000","updated":"2016-08-17T05:51:01.776+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15423970","id":"15423970","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cody","name":"Cody","key":"cody","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cody&avatarId=25318","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cody&avatarId=25318","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cody&avatarId=25318","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cody&avatarId=25318"},"displayName":"Cody","active":true,"timeZone":"Asia/Hong_Kong"},"body":"OK, I will look into the NPE issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Cody","name":"Cody","key":"cody","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cody&avatarId=25318","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cody&avatarId=25318","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cody&avatarId=25318","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cody&avatarId=25318"},"displayName":"Cody","active":true,"timeZone":"Asia/Hong_Kong"},"created":"2016-08-17T06:22:30.706+0000","updated":"2016-08-17T06:22:30.706+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15425987","id":"15425987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=danny0405","name":"danny0405","key":"danny0405","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yuzhao Chen","active":true,"timeZone":"Asia/Harbin"},"body":"I have test storm 1.0.1 ABP in our staging cluster[ 10 machine nodes and a topology with 32 workers, 120 executors ] on, the topology will stall within 10 mins very possibly\n    i see that when all the topology tasks throttle off, the backpressure root node on ZK still have child nodes which cause   the \"stall\", if i delete the child node manually, the spouts will continue to consume normally(but will again stall within 10 minutes), so  i agree with @Roshan Naik","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=danny0405","name":"danny0405","key":"danny0405","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yuzhao Chen","active":true,"timeZone":"Asia/Harbin"},"created":"2016-08-18T06:55:57.023+0000","updated":"2016-08-18T07:01:04.175+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15427450","id":"15427450","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"body":"[~danny0405] thanks sincerely for the testing. \nI checked back the code,\nIn\nhttps://github.com/apache/storm/blob/master/storm-core/src/clj/org/apache/storm/daemon/worker.clj#L156\nto reduce the traffic to ZK, we checked the previous flag to update to Zookeeper only when it is necessary (the flag has changed), but still there may some very weird case we have inconsistency between local \"prev-backpressure-flag\" and the worker backpressure node at Zookeeper (see STORM-1949).\n(One such weird case I would think of is: the worker-backpressure call does not update the zk flag successfully but no exception was caught and the local flag updating still succeeds),\nI was commenting at https://github.com/apache/storm/pull/1627 to suggest a tradeoff remedy to achieve better resilience.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-19T01:21:48.666+0000","updated":"2016-08-19T01:21:48.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15429427","id":"15429427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abellina","name":"abellina","key":"abellina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Bellina","active":true,"timeZone":"Etc/UTC"},"body":"[~roshan_naik] I was going to run your example to reproduce but the link doesn't work anymore. Can you provide an updated link?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abellina","name":"abellina","key":"abellina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Bellina","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-20T15:41:57.329+0000","updated":"2016-08-20T15:41:57.329+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15430073","id":"15430073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abellina","name":"abellina","key":"abellina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Bellina","active":true,"timeZone":"Etc/UTC"},"body":"I replicated a halted topology using my own WordCount but the way I got it to halt was to set the receive buffer size to be very small 4. \n\nI took a heap dump of the worker that was set in the backpressure znode and found that one of the executors had the backpressure atomic variable set to true, while the disruptor queue's _throttleOn was false.\n\nI tried running the same topology with the executor-specific change in https://github.com/apache/storm/pull/1632, and it didn't halt. That change removes the backpressure atomic variable, in favor of the disruptor's _throttleOn. However, this needs more testing. I'll try other things tomorrow and comment here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abellina","name":"abellina","key":"abellina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alessandro Bellina","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-22T05:26:11.727+0000","updated":"2016-08-22T05:26:11.727+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15433752","id":"15433752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"body":"Attaching the wordcount topo that i used.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-23T22:22:13.558+0000","updated":"2016-08-23T22:22:13.558+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15433795","id":"15433795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"body":"The amount of  *additional* pressure this BP mechanism adds to ZK in it current state really should be sufficient reason to leave it disabled by default. If we fix the problem I noted in the description, as per Bobby's suggestion, that would put even more pressure on ZK. Putting such pressure on ZK (or Nimbus) from any subsystem in Storm is essentially a regression in terms of scaling ability, which then begets future fixes (PaceMaker for instance)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-23T22:50:34.669+0000","updated":"2016-08-23T22:50:34.669+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15434123","id":"15434123","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"body":"[~abellina] thanks for the diagnosis, that is super helpful. This shows that the root cause should not be: we are not syncing correctly between local worker flag and remote zk worker entry for backpressure;\nrather: we are not syncing the disruptorQueue.getBackpressure() with the flag in executor data correctly.\nSince our refactoring in https://github.com/apache/storm/pull/1627  is directly accessing the disruptor queue to get the backpressure flag rather than having an additional flag in executor data which is error-prone when flipping,\nwe may NOT need to add the ADDITIONAL ZK pressure which I mentioned previously in the JIRA.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-24T03:16:30.325+0000","updated":"2016-08-24T03:16:30.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15453966","id":"15453966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~roshan_naik], [~abellina] has https://github.com/apache/storm/pull/1632 merged into 2.x master. Would you mind testing your example with the latest master? See if the refactoring has fixed the bug you mentioned. Thank you in advance!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2016-09-01T01:29:01.386+0000","updated":"2016-09-01T01:29:01.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/15993879","id":"15993879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"body":"Sorry I have not been able to put time on this. Looks like some users on the mailing list are also running into this issue in production.  I am unable to give this time for at least a couple weeks, but I dont want to be a blocker to getting this fix into 1.x. I have shared the topology here in the jira, would be great if we got some help on this ? [~abellina] or [~zhuoliu] would you be able to give it a shot ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=roshan_naik","name":"roshan_naik","key":"roshan_naik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roshan Naik","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-05-02T22:04:51.324+0000","updated":"2017-05-02T22:05:16.620+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/16254304","id":"16254304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vaibhavnir007","name":"vaibhavnir007","key":"vaibhavnir007","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vaibhav","active":true,"timeZone":"Etc/UTC"},"body":"We are using Storm version 1.0.1.2.5.3.0-37 and the issue is still reproducible                                                           ,                                                                      \r\n                                                                                                                                                                                                                                                        \r\n                                                                                                                                                                                                                              ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vaibhavnir007","name":"vaibhavnir007","key":"vaibhavnir007","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vaibhav","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-15T22:10:55.132+0000","updated":"2017-11-15T22:10:55.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987370/comment/16254372","id":"16254372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"body":"[~vaibhavnir007] thanks for the information.\r\nSee https://issues.apache.org/jira/browse/STORM-2039\r\nI see the fix from [~abellina] went into 2.0.0, 1.1.0, 1.0.3,\r\nso 1.0.1* may not have it. Really appreciate if you could try with 1.0.3 or up. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhuoliu","name":"zhuoliu","key":"zhuoliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhuoliu&avatarId=33064","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhuoliu&avatarId=33064","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhuoliu&avatarId=33064","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhuoliu&avatarId=33064"},"displayName":"Zhuo Liu","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-15T22:49:15.784+0000","updated":"2017-11-15T22:49:15.784+0000"}],"maxResults":39,"total":39,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1949/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i30msv:"}}