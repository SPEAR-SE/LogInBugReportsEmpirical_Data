{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12763762","self":"https://issues.apache.org/jira/rest/api/2/issue/12763762","key":"STORM-605","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-01-06T09:20:21.872+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Nov 10 01:13:09 UTC 2015","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-605/watchers","watchCount":7,"isWatching":false},"created":"2014-12-25T13:51:22.318+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327112","id":"12327112","name":"0.9.3","archived":false,"released":true,"releaseDate":"2014-11-25"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-11-10T01:13:09.478+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"\nWe had a bunch of topologies running very well under Storm 0.8.2 until last\nweek when we switched to storm 0.9.2-incubating. We use the clojure DSL,\nand clojure 1.5.1 (only).\n\nSince the change, we have a large topology (about 30 bolts, parallellism=10\nor 20 per bolt, total 372 tasks on 10 workers) that fails on startup with\nseveral bolts showing the exception :\n\njava.lang.RuntimeException: java.lang.IllegalStateException: Attempting to\ncall unbound fn: #'entry-dedup.bolt/dedup__ at\nbacktype.storm.clojure.ClojureBolt.prepare(ClojureBolt.java:77) ...\n\nThis can occur on one or several bolts at random and is not consistent\nbetween restarts.\n\nThe topology is indeed quite long to initialize (a dozen seconds) due to several models being loaded but this was OK in 0.8.2.\n\nAnother (shorter) topology works most of the time but shows this behaviour\non some restarts sometimes.\n\nWe found a workaround that works most of the time : start the topology in\nthe INACTIVE state, then wait 200 seconds, then activate it. But this\ndoesn't really solve our problem because sometimes Storm tries to rebalance\nthe topologies by itself and reassigns the topology without our little trick, effectively crashing them.\n\nThe same behavior is present with storm 0.9.3.\n\nSo maybe something changed in storm that introduces a kind of race\ncondition during initializaion of some bolts on larger topologies ? Maybe this is a consequence to the switch to Netty ?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Attempting to call unbound fn during bolt prepare","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phyce","name":"phyce","key":"phyce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philippe Guillebert","active":true,"timeZone":"Europe/Paris"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phyce","name":"phyce","key":"phyce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philippe Guillebert","active":true,"timeZone":"Europe/Paris"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14265888","id":"14265888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"body":"i'm the same as you. we use clojureDSL under storm 0.9.2-incubating . we also found that and have no idea.\nwe expected this bug can be resolved as soon as possible","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-06T09:20:21.872+0000","updated":"2015-01-06T09:20:21.872+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14266373","id":"14266373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~phyce] [~newday1] If possible can you please provide a sample topology which can reproduce this issue. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-06T16:46:16.488+0000","updated":"2015-01-06T16:46:16.488+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14311925","id":"14311925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"body":"[~sriharsha] hello, i found something today though i don't know why it was\n\nhere is the thing , we use clojure dsl under storm . The bolt always loop died when it run the prepare function,So i guess\nmaybe something wrong happen when load the clojure code. Then i build a storm from github mirror, modify the sources and add some log where storm load the clojure bolt\n\nbacktype.storm.utils/Utils\n    public static IFn loadClojureFn(String namespace, String name) {\n        try {\n            clojure.lang.Compiler.eval(RT.readString(\"(require '\" + namespace + \")\"));\n        } catch (Exception e) {\nLOG.error(\"读取clojure bolt代码异常 namespace=\" + namespace + \", name=\" + name, e);\n        }\n        return (IFn) RT.var(namespace, name).deref();\n    }\n\nhere is the log when the bolt throw exception\n\n2015-02-09 16:19:02 b.s.u.Utils [ERROR] 读取clojure bolt代码异常 namespace=com.pajk.risk.storm.clj.engine, name=count-bolt__\nclojure.lang.Compiler$CompilerException: java.lang.RuntimeException: Unable to resolve symbol: conditionCache in this context, compiling:(com/pajk/risk/storm/clj/calc.clj:12:13)\n\tat clojure.lang.Compiler.analyze(Compiler.java:6464) ~[clojure-1.6.0.jar:na]\n\tat clojure.lang.Compiler.analyze(Compiler.java:6406) ~[clojure-1.6.0.jar:na]\n\tat clojure.lang.Compiler$HostExpr$Parser.parse(Compiler.java:924) ~[clojure-1.6.0.jar:na]\n\tat clojure.lang.Compiler.analyzeSeq(Compiler.java:6644) ~[clojure-1.6.0.jar:na]\n\tat clojure.lang.Compiler.analyze(Compiler.java:6445) ~[clojure-1.6.0.jar:na]\n\tat clojure.lang.Compiler.analyzeSeq(Compiler.java:6632) ~[clojure-1.6.0.jar:na]\n\tat clojure.lang.Compiler.analyze(Compiler.java:6445) ~[clojure-1.6.0.jar:na]\n\nbut i do define the conditionCache in a another clojure file, and i load it by :use , here is my code\n\n(ns com.pajk.risk.storm.clj.calc\n  (:import (java.util Map)\n           (com.pajk.risk.engine.api.model UniformEvent))\n  (:use com.pajk.risk.storm.clj.cache)\n  (:use com.pajk.risk.storm.clj.mock)\n  (:use com.pajk.risk.storm.clj.util)\n  (:require [clojure.tools.logging :as log]))\n\nconditionCache is defined in com.pajk.risk.storm.clj.cache\n\n(def ^LoadingCache conditionCache (-> (CacheBuilder/newBuilder)\n                                      (.maximumSize 10000)\n                                      (.build (proxy [CacheLoader] [] (load [^String key]\n                                                                        (AviatorEvaluator/compile key))))))\n\nMy question is how the storm load my clojure bolt and how to load its dependency , Thx\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"created":"2015-02-09T08:34:46.218+0000","updated":"2015-02-09T08:38:04.992+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14315731","id":"14315731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"body":"i am so confused about it. i wrote a test to load the clojure function in java, That's ok. My code is as follows\ni can get the reference successful\n\npublic class ClojureDslLoadTest {\n    public static void main(String[] args) {\n        System.out.println(loadClojureFn(\"com.pajk.risk.storm.clj.confdata\", \"init-all-test\"));\n        System.out.println(loadClojureFn(\"com.pajk.risk.storm.clj.util\", \"load-json\"));\n    }\n\n    public static IFn loadClojureFn(String namespace, String name) {\n        try {\n            clojure.lang.Compiler.eval(RT.readString(\"(require '\" + namespace + \")\"));\n        } catch (Exception e) {\n            //if playing from the repl and defining functions, file won't exist\n            e.printStackTrace();\n        }\n        return (IFn) RT.var(namespace, name).deref();\n    }\n}\n\nBut under storm, i caught the Exception \n\nclojure.lang.Compiler$CompilerException: java.lang.RuntimeException: Unable to resolve symbol: load-json in this context, compiling:(com/pajk/risk/storm/clj/confdata.clj:42:36)\n\tat clojure.lang.Compiler.analyze(Compiler.java:6464) ~[clojure-1.6.0.jar:na]\n\nI have no idea ..\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"created":"2015-02-11T07:52:50.329+0000","updated":"2015-02-11T07:53:21.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14316363","id":"14316363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~newday1] Thanks for the details. I'll work on reproducing it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-11T15:26:41.839+0000","updated":"2015-02-11T15:26:41.839+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14339865","id":"14339865","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"body":"[~sriharsha] \n\nhi, i found something interesting.\nwhen i merge all my clj sources to one clj file , it works fine.\nIs this a classpath problem? But it is under the same classpath whether it works fine  or failed\n\ni print my classpath when storm load the prepare method\n\n2015-02-26 11:00:14 b.s.c.ClojureBolt [INFO] Storm开始加载bolt闭包com.pajk.risk.storm.clj.engine_count-bolt__ classpath=/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/ring-devel-1.3\n.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/slf4j-api-1.7.5.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/commons-lang-2.5.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/\nlib/storm-core-0.10.0-SNAPSHOT.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/math.numeric-tower-0.0.1.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/commons-codec-1.6.jar:/ho\nme/admin/apache-storm-0.10.0-SNAPSHOT/lib/crypto-equality-1.0.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/reflectasm-1.07-shaded.jar:/home/admin/apache-storm-0.10.0-SNAPSHO\nT/lib/ns-tracker-0.2.2.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/curator-client-2.4.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/commons-exec-1.1.jar:/home/admin/apac\nhe-storm-0.10.0-SNAPSHOT/lib/tools.namespace-0.2.4.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/asm-4.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/chill-java-0.3.5.jar:/\nhome/admin/apache-storm-0.10.0-SNAPSHOT/lib/ring-core-1.1.5.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/clj-time-0.8.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/ring-s\nervlet-1.3.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/httpclient-4.3.3.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/jline-2.11.jar:/home/admin/apache-storm-0.10.0-SNAP\nSHOT/lib/hadoop-auth-2.4.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/commons-io-2.4.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/tools.logging-0.2.3.jar:/home/admin/apa\nche-storm-0.10.0-SNAPSHOT/lib/clout-1.0.1.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/compojure-1.1.3.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/jetty-security-7.6.13.v\n20130916.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/disruptor-2.10.1.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/servlet-api-2.5.jar:/home/admin/apache-storm-0.10.0-SNA\nPSHOT/lib/jetty-servlets-7.6.13.v20130916.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/objenesis-1.2.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/ring-anti-forgery-1.0.0.j\nar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/jetty-http-7.6.13.v20130916.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/javax.servlet-2.5.0.v201103041518.jar:/home/admin/apac\nhe-storm-0.10.0-SNAPSHOT/lib/logback-core-1.0.13.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/clojure-1.6.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/carbonite-1.4.0.ja\nr:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/jetty-continuation-7.6.13.v20130916.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/logback-classic-1.0.13.jar:/home/admin/apache-s\ntorm-0.10.0-SNAPSHOT/lib/curator-framework-2.4.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/snakeyaml-1.11.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/java.classpath-0.\n2.2.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/ring-jetty-adapter-1.3.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/jetty-servlet-7.6.13.v20130916.jar:/home/admin/apach\ne-storm-0.10.0-SNAPSHOT/lib/json-simple-1.1.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/minlog-1.2.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/tools.cli-0.2.4.jar:/home/\nadmin/apache-storm-0.10.0-SNAPSHOT/lib/core.incubator-0.1.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/commons-logging-1.1.3.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib\n/crypto-random-1.2.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/kryo-2.21.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/httpcore-4.3.2.jar:/home/admin/apache-storm-0.10.0\n-SNAPSHOT/lib/joda-time-2.3.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/jetty-io-7.6.13.v20130916.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/tools.macro-0.1.0.jar:/home\n/admin/apache-storm-0.10.0-SNAPSHOT/lib/log4j-over-slf4j-1.6.6.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/jetty-client-7.6.13.v20130916.jar:/home/admin/apache-storm-0.10.0-S\nNAPSHOT/lib/jetty-util-7.6.13.v20130916.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/jetty-server-7.6.13.v20130916.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/jgrapht-cor\ne-0.9.0.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/commons-fileupload-1.2.1.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/lib/clj-stacktrace-0.2.7.jar:/home/admin/apache-stor\nm-0.10.0-SNAPSHOT/lib/hiccup-0.3.6.jar:/home/admin/apache-storm-0.10.0-SNAPSHOT/conf:/home/admin/storm/localdir/supervisor/stormdist/risk-engine-4-1424919605/stormjar.jar\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"created":"2015-02-27T08:14:32.788+0000","updated":"2015-02-27T08:15:20.490+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14341389","id":"14341389","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"body":"[~sriharsha] [~phyce]\nHello , i found the root cause .\nBecause we package storm-jar include the clj sources\nStorm may load the .clj source or .class , they conflict ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=newday1","name":"newday1","key":"newday1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Li Chaomo","active":true,"timeZone":"Etc/UTC"},"created":"2015-02-28T06:54:01.680+0000","updated":"2015-02-28T06:54:01.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14371520","id":"14371520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremyheiler","name":"jeremyheiler","key":"jeremyheiler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeremyheiler&avatarId=21716","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeremyheiler&avatarId=21716","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeremyheiler&avatarId=21716","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeremyheiler&avatarId=21716"},"displayName":"Jeremy Heiler","active":true,"timeZone":"America/New_York"},"body":"I've been running into this issue as well. It has been more apparent when we did not AOT compile the project, however, we're now seeing it for external libraries that are AOT compiled. I am not yet convinced that this is a race condition between the loading of clj and class files. Is there any proof for that claim?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremyheiler","name":"jeremyheiler","key":"jeremyheiler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeremyheiler&avatarId=21716","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeremyheiler&avatarId=21716","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeremyheiler&avatarId=21716","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeremyheiler&avatarId=21716"},"displayName":"Jeremy Heiler","active":true,"timeZone":"America/New_York"},"created":"2015-03-20T15:57:19.225+0000","updated":"2015-03-20T15:57:19.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14371575","id":"14371575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jeremyheiler] Could you give details on which storm version are you using and you are also seeing the same error as\n\" Attempting to\ncall unbound fn: #'entry-dedup.bolt/dedup__ at\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-20T16:29:17.901+0000","updated":"2015-03-20T16:29:17.901+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14371593","id":"14371593","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremyheiler","name":"jeremyheiler","key":"jeremyheiler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeremyheiler&avatarId=21716","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeremyheiler&avatarId=21716","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeremyheiler&avatarId=21716","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeremyheiler&avatarId=21716"},"displayName":"Jeremy Heiler","active":true,"timeZone":"America/New_York"},"body":"I'm using Storm 0.9.3 (with Netty). And yes, I am seeing the same \"unbound fn\" error, of course with different vars.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremyheiler","name":"jeremyheiler","key":"jeremyheiler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeremyheiler&avatarId=21716","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeremyheiler&avatarId=21716","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeremyheiler&avatarId=21716","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeremyheiler&avatarId=21716"},"displayName":"Jeremy Heiler","active":true,"timeZone":"America/New_York"},"created":"2015-03-20T16:43:55.883+0000","updated":"2015-03-20T16:43:55.883+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14375058","id":"14375058","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jeremyheiler] If possible can you give us an example topology where you seeing this issue. I tried to reproduce this with example shell topologies I am not seeing any errors or issues with them.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-22T17:14:17.384+0000","updated":"2015-03-22T17:14:17.384+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14548108","id":"14548108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phyce","name":"phyce","key":"phyce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philippe Guillebert","active":true,"timeZone":"Europe/Paris"},"body":"As far as we can tell, since we upgraded to Storm 0.9.4 we did not reproduce this issue. So maybe it got solved by 0.9.4 as a side effect. Can you guys reproduce once you upgrade to 0.9.4 ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phyce","name":"phyce","key":"phyce","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philippe Guillebert","active":true,"timeZone":"Europe/Paris"},"created":"2015-05-18T14:49:57.455+0000","updated":"2015-05-18T14:49:57.455+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14598059","id":"14598059","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremyheiler","name":"jeremyheiler","key":"jeremyheiler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeremyheiler&avatarId=21716","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeremyheiler&avatarId=21716","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeremyheiler&avatarId=21716","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeremyheiler&avatarId=21716"},"displayName":"Jeremy Heiler","active":true,"timeZone":"America/New_York"},"body":"This is not fixed in 0.9.5, at least for my usage.\n\nHowever, I had isolated one instance of this error to  a custom spout. It would happen when nextTuple is called for the first time. If I put a try/catch in nextTuple, catching IllegalStateException so that the unbound var error is ignored, it eventually stops happening after ~25 seconds on a 1-spout/4-bolt topology with no parallelism.\n\nWhat could cause this race condition?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremyheiler","name":"jeremyheiler","key":"jeremyheiler","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeremyheiler&avatarId=21716","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeremyheiler&avatarId=21716","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeremyheiler&avatarId=21716","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeremyheiler&avatarId=21716"},"displayName":"Jeremy Heiler","active":true,"timeZone":"America/New_York"},"created":"2015-06-23T17:54:33.810+0000","updated":"2015-06-23T17:54:33.810+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14647871","id":"14647871","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmangi","name":"rmangi","key":"rmangi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Mangi","active":true,"timeZone":"Etc/UTC"},"body":"Same problem here with 0.10.0-beta1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmangi","name":"rmangi","key":"rmangi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Mangi","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-30T16:05:05.388+0000","updated":"2015-07-30T16:05:05.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14649783","id":"14649783","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmangi","name":"rmangi","key":"rmangi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Mangi","active":true,"timeZone":"Etc/UTC"},"body":"I can reproduce this with storm running off the git head as well. I just built and deployed it. Not bundling the storm jar in my uberjar. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmangi","name":"rmangi","key":"rmangi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Mangi","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-31T20:29:48.861+0000","updated":"2015-07-31T20:29:48.861+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14660206","id":"14660206","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmangi","name":"rmangi","key":"rmangi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Mangi","active":true,"timeZone":"Etc/UTC"},"body":"A bit more discovery. Taking my bolts and spouts and putting them in the same .clj file seems to have fixed it. This suggests to me that when Utils.loadClojureFn requires the namespace for one, the other isn't also being loaded. There are no references from my bolts to my spouts except in the topology, so maybe it's when the topology is resolved that the problem manifests?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmangi","name":"rmangi","key":"rmangi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Mangi","active":true,"timeZone":"Etc/UTC"},"created":"2015-08-06T16:01:09.872+0000","updated":"2015-08-06T16:01:09.872+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12763762/comment/14997778","id":"14997778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donlee","name":"donlee","key":"donlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"don lee","active":true,"timeZone":"America/Los_Angeles"},"body":"In my case, streamparse api were used to run locally and submit code to STORM cluster, and  it didn't happen during prepare, when I ran it locally it was ok but when it is submitted to STORM cluster, I got\n\njava.lang.RuntimeException: java.lang.IllegalStateException: Attempting to call unbound fn\n\nclojure version is 1.5.1, storm version is 0.9.5, sparse 2.1.3\n\nthe error was due to calling \"call-to-outside-function\" within spout execute, and that function can be 3rd party library as well, the code is as follows:\n\n(defn call-to-outside-function [someArg]\n    (do stuff ....))\n\n(defspout kw-spout [\"something\"]\n  [conf context collector]\n        (spout\n            (nextTuple []\n                (Thread/sleep 100)\n                (call-to-outside-function \"someArgs\")\n                (emit-spout! collector (\"not important\"))\n                )\n            (ack [id])\n            ))\n\nIt is related to this bug ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donlee","name":"donlee","key":"donlee","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"don lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-10T01:13:09.478+0000","updated":"2015-11-10T01:13:09.478+0000"}],"maxResults":17,"total":17,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-605/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i23rxj:"}}