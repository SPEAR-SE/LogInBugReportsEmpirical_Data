{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12684769","self":"https://issues.apache.org/jira/rest/api/2/issue/12684769","key":"STORM-143","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327123","id":"12327123","description":"security feature branch","name":"0.10.0","archived":false,"released":true,"releaseDate":"2015-11-05"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-04-27T08:52:50.568+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Apr 28 00:58:06 UTC 2016","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_74717105012_*|*_5_*:*_1_*:*_0","customfield_12310420":"363841","customfield_12312321":null,"resolutiondate":"2016-04-28T00:58:21.061+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-143/watchers","watchCount":3,"isWatching":false},"created":"2013-12-15T06:13:16.223+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[{"id":"12382652","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12382652","type":{"id":"12310060","name":"Container","inward":"Is contained by","outward":"contains","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310060"},"inwardIssue":{"id":"12693940","key":"STORM-231","self":"https://issues.apache.org/jira/rest/api/2/issue/12693940","fields":{"summary":"Early warning on worker crash + logging of early errors","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}},{"id":"12465116","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12465116","type":{"id":"12310051","name":"Supercedes","inward":"is superceded by","outward":"supercedes","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310051"},"inwardIssue":{"id":"12832301","key":"STORM-833","self":"https://issues.apache.org/jira/rest/api/2/issue/12832301","fields":{"summary":"Logging framework logback -> log4j 2.x","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/16","id":"16","description":"Created by JIRA Software - do not edit or delete. Issue type for a user story.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21145&avatarType=issuetype","name":"Story","subtask":false,"avatarId":21145}}}}],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-04-28T00:58:21.214+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"https://github.com/nathanmarz/storm/issues/489\n\nhttps://github.com/nathanmarz/storm/blob/master/src/clj/backtype/storm/util.clj#L349\n\nWhen we launch a process, standard out is written to a system buffer and does not appear to be read. Also, nothing is redirected to standard in. This can have the following effects:\n\nA worker can hang when initializing (e.g. UnsatisfiedLinkError looking for jzmq), and it will be unable to communicate the error as standard out is being swallowed.\nA process that writes too much to standard out will block if the buffer fills\nA process that tries to read form standard in for any reason will block.\nPerhaps we can redirect standard out to an .out file, and redirect /dev/null to the standard in stream of the process?\n\n----------\nnathanmarz: Storm redirects stdout to the logging system. It's worked fine for us in our topologies.\n\n----------\nd2r: We see in worker.clj, in mk-worker, where there is a call to redirect-stdio-to-slf4j!. This would not seem to help in cases such as we are seeing when there is a problem launching the worker itself.\n\n(defn -main [storm-id assignment-id port-str worker-id]\n  (let [conf1 (read-storm-config)\n        login_conf_file (System/getProperty \"java.security.auth.login.config\")\n        conf (if login_conf_file (merge conf1 {\"java.security.auth.login.config\" login_conf_file}) conf1)]\n    (validate-distributed-mode! conf)\n    (mk-worker conf nil (java.net.URLDecoder/decode storm-id) assignment-id (Integer/parseInt port-str) worker-id)))\nIf anything were to go wrong (CLASSPATH, jvm opts, misconfiguration...) before -main or before mk-worker, then any output would be lost. The symptom we saw was that the topology sat around apparently doing nothing, yet there was no log indicating that the workers were failing to start.\n\nIs there other redirection to logs that I'm missing?\n\n----------\nxiaokang: we use bash to launch worker process and redirect its stdout to woker-port.out file. it heleped us find the zeromq jni problem that cause the jvm crash without any log.\n\n----------\nnathanmarz: @d2r Yea, that's all I was referring to. If we redirect stdout, will the code that redirects stdout to the logging system still take effect? This is important because we can control the size of the logfiles (via the logback config) but not the size of the redirected stdout file.\n\n----------\nd2r: My hunch is that it will work as it does now, except that any messages that are getting thrown away before that point would go to a file instead. I can play with it and find out. We wouldn't want to change the redirection, just restore visibility to any output that might occur prior to the redirection. There should be some safety valve to control the size of any new .out in case something goes berserk.\n\n@xiaokang I see how that would work. We also need to make sure redirection continues to work as it currently does for the above reason.\n\n----------\nxiaokang: @d2r @nathanmarz In out cluster, storm's stdout redirection still works for any System.out output while JNI errors goes to worker-port.out file. I think it will be nice to use the same worker-port.log file for bash stdout redirection since logback can control log file size. But it is a little bit ugly to use bash to launch worker java process.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"364147","customfield_12312823":null,"summary":"Launching a process throws away standard out; can hang","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684769/comment/15259806","id":"15259806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikdw","name":"erikdw","key":"erikdw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erikdw&avatarId=26098","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erikdw&avatarId=26098","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erikdw&avatarId=26098","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erikdw&avatarId=26098"},"displayName":"Erik Weathers","active":true,"timeZone":"Etc/UTC"},"body":"[~revans2] : seems this issue is fixed with the LogWriter that was introduced in storm-0.10.0.  I cannot find a ticket for that feature to link this against though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikdw","name":"erikdw","key":"erikdw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erikdw&avatarId=26098","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erikdw&avatarId=26098","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erikdw&avatarId=26098","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erikdw&avatarId=26098"},"displayName":"Erik Weathers","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-27T08:52:50.568+0000","updated":"2016-04-27T08:52:50.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684769/comment/15260170","id":"15260170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"If you know the file that was changed, or some code that was changed as a part of it, both blame and history can be big helps in getting the traceability.  We don't squash commits though so it can sometimes not give you what you want.  But in this case it works out OK, but you may need to expand the commit comment to find the JIRA number\n\nhttps://github.com/apache/storm/commits/0.10.x-branch/storm-core/src/jvm/backtype/storm/LogWriter.java\n\nSTORM-833\n\nand the pull request for it shows LogWriter being added.\n\nhttps://github.com/apache/storm/pull/562/files\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2016-04-27T13:44:45.575+0000","updated":"2016-04-27T13:44:45.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684769/comment/15261323","id":"15261323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikdw","name":"erikdw","key":"erikdw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erikdw&avatarId=26098","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erikdw&avatarId=26098","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erikdw&avatarId=26098","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erikdw&avatarId=26098"},"displayName":"Erik Weathers","active":true,"timeZone":"Etc/UTC"},"body":"Aha (hadn't clicked the {{...}} on the GitHub UI)!  I'll mark this ticket as closed then, thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikdw","name":"erikdw","key":"erikdw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=erikdw&avatarId=26098","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=erikdw&avatarId=26098","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=erikdw&avatarId=26098","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=erikdw&avatarId=26098"},"displayName":"Erik Weathers","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-28T00:58:06.754+0000","updated":"2016-04-28T00:58:06.754+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-143/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qprz:"}}