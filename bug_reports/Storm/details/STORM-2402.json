{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13049637","self":"https://issues.apache.org/jira/rest/api/2/issue/13049637","key":"STORM-2402","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":4200,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":4200,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 15 14:27:32 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_515150915_*|*_6_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-03-15T14:27:32.467+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2402/watchers","watchCount":1,"isWatching":false},"created":"2017-03-09T15:21:41.592+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12337341","id":"12337341","name":"1.0.3","archived":false,"released":true,"releaseDate":"2017-02-14"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-03-15T17:06:17.085+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12331080","id":"12331080","name":"storm-kafka-client"}],"timeoriginalestimate":null,"description":"We need a {{KafkaSpout}} that writes unprocessable records to a \"dead-letter-topic\". For this to function we sub-classed {{KafkaSpout}} and added the corresponding code. Without the incoming patch sub-classses can not have access to the actual tuples/records but just the {{KafkaSpoutMessageId}} in {{ack()}} and {{fail()}}.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"1h 10m","remainingEstimateSeconds":0,"timeSpentSeconds":4200},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"KafkaSpout sub-classes should be able to customize tuple processing","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sakanaou","name":"sakanaou","key":"sakanaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Klessing","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sakanaou","name":"sakanaou","key":"sakanaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Klessing","active":true,"timeZone":"Europe/Berlin"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":4200,"total":4200,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":4200,"total":4200,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13049637/comment/15926257","id":"15926257","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sakanaou","name":"sakanaou","key":"sakanaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Klessing","active":true,"timeZone":"Europe/Berlin"},"body":"As comments on the PR on github showed there is a cleaner solution already available. This request can be safely discarged.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sakanaou","name":"sakanaou","key":"sakanaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Klessing","active":true,"timeZone":"Europe/Berlin"},"created":"2017-03-15T14:27:32.496+0000","updated":"2017-03-15T14:27:32.496+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2402/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":7,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13049637/worklog/38787","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user sakanaou opened a pull request:\n\n    https://github.com/apache/storm/pull/1993\n\n    STORM-2402: KafkaSpout sub-classes should be able to customize tuple processing\n\n    We need a `KafkaSpout` that writes unprocessable records to a \"dead-letter-topic\". For this to function we sub-classed `KafkaSpout` and added the corresponding code. Without this patch sub-classses can not have access to the actual tuples/records but just the `KafkaSpoutMessageId` in `ack()` and `fail()`.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/sakanaou/storm STORM-2402\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/1993.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #1993\n    \n----\ncommit a3460d6980f1746262e93053ffa61173a3af6996\nAuthor: sakanaou <sakanaou@users.noreply.github.com>\nDate:   2017-03-09T15:25:20Z\n\n    STORM-2402: Allow subclasses of KafkaSpout to react on emitted records\n\n----\n","created":"2017-03-09T15:28:07.374+0000","updated":"2017-03-09T15:28:07.374+0000","started":"2017-03-09T15:28:07.373+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38787","issueId":"13049637"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13049637/worklog/39051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user harshach commented on the issue:\n\n    https://github.com/apache/storm/pull/1993\n  \n    @sakanaou Instead of providing a method like you've in PR, I recommend you to provide TupleBuilder interface with a default implementation that can be pluggable via config option. This will allow users to write their own implementation and configure it.\n","created":"2017-03-13T20:37:36.728+0000","updated":"2017-03-13T20:37:36.728+0000","started":"2017-03-13T20:37:36.728+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39051","issueId":"13049637"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13049637/worklog/39056","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hmcl commented on the issue:\n\n    https://github.com/apache/storm/pull/1993\n  \n    @sakanaou I am just about to commit a fix that gives the option to emit or not emit null tuples as configured in `KafkaSpoutConfig`. The case of non processable records is already supported if you implement a suitable [RecordTranslator](https://github.com/apache/storm/blob/master/external/storm-kafka-client/src/main/java/org/apache/storm/kafka/spout/RecordTranslator.java) that has its [apply](https://github.com/apache/storm/blob/master/external/storm-kafka-client/src/main/java/org/apache/storm/kafka/spout/RecordTranslator.java#L39) method return [KafkaTuple](https://github.com/apache/storm/blob/master/external/storm-kafka-client/src/main/java/org/apache/storm/kafka/spout/KafkaTuple.java) instances. You can have an instance of `KafkaTuple` that is associated with the \"dead-letter-topic\" stream to handle invalid records. \n    \n    Based on the above,  don't think the changes proposed in this pull request are necessary.\n","created":"2017-03-13T23:23:09.706+0000","updated":"2017-03-13T23:23:09.706+0000","started":"2017-03-13T23:23:09.704+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39056","issueId":"13049637"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13049637/worklog/39076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user sakanaou commented on the issue:\n\n    https://github.com/apache/storm/pull/1993\n  \n    Thanks for your suggestions, @harshach & @hmcl. Maybe I didn't find the correct way to handle our request yet in the provided architecture. But to make it more clear: The records/tuples are not per se invalid and should go straight to a \"dead-letter-topic\". The system is more about resilience in such a way that it should not be a big problem if a system, that lies behind a downward bolt, is temporarily unavailable. Instead of simply \"skipping\" such failed records (after their retry count is reached) they should then - and only then - be written to the mentioned \"dead-letter-topic\". We did so in the overwritten `fail()` of our `KafkaSpout` and built a map from `KafkaSpoutMessageId` to the `ConsumerRecord` with the help of the proposed `emittingTuple()`.\n    \n    But I assume we could work out a solution solely based on the mentioned `RecordTranslator` (or `KafkaSpoutTupleBuilder` in our case as we are still on Storm 1.0.2).\n","created":"2017-03-14T08:10:35.460+0000","updated":"2017-03-14T08:10:35.460+0000","started":"2017-03-14T08:10:35.460+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39076","issueId":"13049637"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13049637/worklog/39170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on the issue:\n\n    https://github.com/apache/storm/pull/1993\n  \n    If `RecordTranslator.apply` was given access to the `KafkaSpoutMessageId` (or current number of retries), you could redirect tuples that have been retried sufficiently many times to another stream using `KafkaTuple` as @hmcl mentioned. That allows you to write the failed tuples to the dead letter topic from a KafkaBolt instead of doing it from inside the spout. It would be cleaner IMO.\n","created":"2017-03-14T19:25:24.465+0000","updated":"2017-03-14T19:25:24.465+0000","started":"2017-03-14T19:25:24.465+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39170","issueId":"13049637"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13049637/worklog/39263","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user sakanaou commented on the issue:\n\n    https://github.com/apache/storm/pull/1993\n  \n    Then this PR can be safely closed and discarded. Thanks for your input.\n","created":"2017-03-15T14:24:55.968+0000","updated":"2017-03-15T14:24:55.968+0000","started":"2017-03-15T14:24:55.966+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39263","issueId":"13049637"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13049637/worklog/39264","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user sakanaou closed the pull request at:\n\n    https://github.com/apache/storm/pull/1993\n","created":"2017-03-15T14:24:56.391+0000","updated":"2017-03-15T14:24:56.391+0000","started":"2017-03-15T14:24:56.391+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39264","issueId":"13049637"}]},"customfield_12311820":"0|i3b6lr:"}}