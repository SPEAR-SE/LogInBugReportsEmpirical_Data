{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13118637","self":"https://issues.apache.org/jira/rest/api/2/issue/13118637","key":"STORM-2820","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":1200,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false}],"aggregatetimespent":1200,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-11-16T23:00:11.580+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 16 23:00:11 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_508359_*|*_3_*:*_1_*:*_95977562_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-11-16T23:00:11.534+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2820/watchers","watchCount":2,"isWatching":false},"created":"2017-11-15T20:12:05.675+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ethanli","name":"ethanli","key":"ethanli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ethanli&avatarId=32192","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ethanli&avatarId=32192","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ethanli&avatarId=32192","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ethanli&avatarId=32192"},"displayName":"Ethan Li","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-11-16T23:00:11.872+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"https://github.com/apache/storm/blob/master/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java#L2548\r\n{code:java}\r\n   @VisibleForTesting\r\n    static void validateTopologyWorkerMaxHeapSizeConfigs(\r\n        Map<String, Object> stormConf, StormTopology topology) {\r\n        double largestMemReq = getMaxExecutorMemoryUsageForTopo(topology, stormConf);\r\n        double topologyWorkerMaxHeapSize =\r\n            ObjectReader.getDouble(stormConf.get(Config.TOPOLOGY_WORKER_MAX_HEAP_SIZE_MB), 768.0);\r\n        if (topologyWorkerMaxHeapSize < largestMemReq) {\r\n            throw new IllegalArgumentException(\r\n                \"Topology will not be able to be successfully scheduled: Config \"\r\n                    + \"TOPOLOGY_WORKER_MAX_HEAP_SIZE_MB=\"\r\n                    + topologyWorkerMaxHeapSize\r\n                    + \" < \" + largestMemReq + \" (Largest memory requirement of a component in the topology).\"\r\n                    + \" Perhaps set TOPOLOGY_WORKER_MAX_HEAP_SIZE_MB to a larger amount\");\r\n        }\r\n    }\r\n{code}\r\n\r\nThe topologyWorkerMaxHeapSize in the above code is either the value from topology configuration (set by the topology) or 768.0. It never picks up the value set by nimbus . \r\n\r\nA test:\r\nI set \r\n{code:java}\r\ntopology.worker.max.heap.size.mb: 2000.0\r\n{code}\r\nin storm.yaml.\r\n\r\nAnd have the WordCountTopology to have the WordCount bolt with memory load of 1024MB.\r\n\r\n{code:java}\r\nbuilder.setBolt(\"count\", new WordCount(), 12).fieldsGrouping(\"split\", new Fields(\"word\")).setMemoryLoad(1024);\r\n{code}\r\n\r\nI got an error when submitting this topology. The nimbus log shows \r\n\r\n\r\n{code:java}\r\n2017-11-15 19:46:43.085 o.a.s.d.n.Nimbus pool-14-thread-2 [WARN] Topology submission exception. (topology name='wc')\r\njava.lang.IllegalArgumentException: Topology will not be able to be successfully scheduled: Config TOPOLOGY_WORKER_MAX_HEAP_SIZE_MB=768.0 < 1024.0 (Largest memory requirement of a component in the topology). Perhaps set TOPOLOGY_WORKER_MAX_HEAP_SIZE_MB to a larger amount\r\n{code}\r\n\r\n\r\n\r\n\r\n \r\n","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"20m","remainingEstimateSeconds":0,"timeSpentSeconds":1200},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"validateTopologyWorkerMaxHeapSizeConfigs function never picks up the value set by nimbus ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ethanli","name":"ethanli","key":"ethanli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ethanli&avatarId=32192","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ethanli&avatarId=32192","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ethanli&avatarId=32192","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ethanli&avatarId=32192"},"displayName":"Ethan Li","active":true,"timeZone":"America/Chicago"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ethanli","name":"ethanli","key":"ethanli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ethanli&avatarId=32192","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ethanli&avatarId=32192","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ethanli&avatarId=32192","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ethanli&avatarId=32192"},"displayName":"Ethan Li","active":true,"timeZone":"America/Chicago"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":1200,"total":1200,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":1200,"total":1200,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13118637/comment/16256109","id":"16256109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Thanks [~ethanli],\r\n\r\nI merged this into master.  Keep up the good work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2017-11-16T23:00:11.580+0000","updated":"2017-11-16T23:00:11.580+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2820/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":2,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13118637/worklog/57561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user Ethanlm opened a pull request:\n\n    https://github.com/apache/storm/pull/2424\n\n    [STORM-2820] fix validateTopologyWorkerMaxHeapSizeConfigs function never picks up the value set by nimbus problem\n\n    As stated in https://issues.apache.org/jira/browse/STORM-2820, the validateTopologyWorkerMaxHeapSizeConfigs use either the value from topology configuration (set by the topology) or 768.0. It never picks up the value set by nimbus.\r\n    \r\n    Tested it manually.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/Ethanlm/storm STORM-2820\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2424.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2424\n    \n----\ncommit 1e957a64af1a3ea2855bbb29e28f94b87ae91932\nAuthor: Ethan Li <ethanopensource@gmail.com>\nDate:   2017-11-15T20:15:30Z\n\n    [STORM-2820] fix validateTopologyWorkerMaxHeapSizeConfigs function never picks up the value set by nimbus problem\n\n----\n","created":"2017-11-15T20:19:57.744+0000","updated":"2017-11-15T20:19:57.744+0000","started":"2017-11-15T20:19:57.740+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"57561","issueId":"13118637"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13118637/worklog/57690","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2424\n","created":"2017-11-16T23:00:11.857+0000","updated":"2017-11-16T23:00:11.857+0000","started":"2017-11-16T23:00:11.856+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"57690","issueId":"13118637"}]},"customfield_12311820":"0|i3mtrz:"}}