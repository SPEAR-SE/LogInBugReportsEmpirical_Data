{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12732490","self":"https://issues.apache.org/jira/rest/api/2/issue/12732490","key":"STORM-442","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327123","id":"12327123","description":"security feature branch","name":"0.10.0","archived":false,"released":true,"releaseDate":"2015-11-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12342364","id":"12342364","name":"0.9.7","archived":false,"released":true,"releaseDate":"2016-09-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-08-07T09:12:23.388+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jan 06 21:29:47 UTC 2015","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_13181963566_*|*_5_*:*_1_*:*_0","customfield_12310420":"410518","customfield_12312321":null,"resolutiondate":"2015-01-06T21:29:47.881+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-442/watchers","watchCount":4,"isWatching":false},"created":"2014-08-07T07:50:24.391+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327112","id":"12327112","name":"0.9.3","archived":false,"released":true,"releaseDate":"2014-11-25"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-12-28T04:37:21.206+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327951","id":"12327951","name":"storm-multilang","description":"Storm integration with other programming languages"}],"timeoriginalestimate":null,"description":"In ShellBolt,  the _readerThread read command from python/shell process, and handle like this:\n\n try {\n        ShellMsg shellMsg = _process.readShellMsg();\n        ...                \n } catch (InterruptedException e) {\n } catch (Throwable t) {\n        die(t);\n }\n\nAnd in the die function, getProcessTerminationInfoString will read getErrorsString() from processErrorStream.\n\n private void die(Throwable exception) {\n \n         String processInfo = _process.getProcessInfoString() + _process.getProcessTerminationInfoString();\n \n         _exception = new RuntimeException(processInfo, exception);\n \n }\n\nso when ShellBolt got exception(for example, readShellMsg() throw NPE ) ,  but it is not an error from sub process,  then getProcessTerminationInfoString will be hang because processErrorStream have no data to read.\n\nOn the other hand, as [~xiaokang] says ShellBolt should fail fast on exception ( https://github.com/apache/incubator-storm/pull/46 ) , I think it is not a good idea to read error info from stream.\nBecause [~xiaokang] 's PR is based old version, so I will move his code to this PR, and modify some other place in ShellSpout.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"410512","customfield_12312823":null,"summary":"multilang ShellBolt/ShellSpout die() can be hang when Exception happened","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dashengju","name":"dashengju","key":"dashengju","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"DashengJu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":"2014-08-14","customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14089041","id":"14089041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user dashengju opened a pull request:\n\n    https://github.com/apache/incubator-storm/pull/218\n\n    [STORM-442] multilang ShellBolt/ShellSpout die() can be hang when Exception happened\n\n    In ShellBolt, the _readerThread read command from python/shell process, and handle like this:\n     try\n     { \n        ShellMsg shellMsg = _process.readShellMsg(); \n        ... \n     } catch (InterruptedException e) {\n     } catch (Throwable t) { \n        die(t); \n     }\n    \n    And in the die function, getProcessTerminationInfoString will read getErrorsString() from processErrorStream.\n    \n    private void die(Throwable exception) { \n         String processInfo = _process.getProcessInfoString() + _process.getProcessTerminationInfoString(); \n         _exception = new RuntimeException(processInfo, exception); \n    }\n    \n    so when ShellBolt got exception(for example, readShellMsg() throw NPE ) , but it is not an error from sub process, then getProcessTerminationInfoString will be hang because processErrorStream have no data to read.\n    \n    On the other hand, as Kang Xiao says ShellBolt should fail fast on exception ( https://github.com/apache/incubator-storm/pull/46 ) , I think it is not a good idea to read error info from stream.\n    \n    Because Kang Xiao 's PR is based old version, so I will move his code to this PR, and modify the same place in ShellSpout.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/dashengju/incubator-storm Multilang_die_hang\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/incubator-storm/pull/218.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #218\n    \n----\ncommit b35883daa1dbbdec6d10dd34630c2f8ea27d6833\nAuthor: JuDasheng <judasheng@meituan.com>\nDate:   2014-08-07T09:08:11Z\n\n    solve multilang ShellBolt/ShellSpout die() can be hang when Exception happened\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-07T09:12:23.388+0000","updated":"2014-08-07T09:12:23.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14104769","id":"14104769","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user harshach commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/218#issuecomment-52857974\n  \n    @dashengju  Can you clarify \"getProcessTerminationInfoString will be hang because processErrorStream have no data to read\". Which case it might hang , looking at the code https://github.com/apache/incubator-storm/blob/master/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L135 If there is no data in processErrorStream it returns empty string.\n    If possible can you add a unit test. Thanks.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-20T23:08:13.118+0000","updated":"2014-08-20T23:08:13.118+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14153809","id":"14153809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user d2r commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/218#discussion_r18249411\n  \n    --- Diff: storm-core/src/jvm/backtype/storm/spout/ShellSpout.java ---\n    @@ -152,8 +152,9 @@ private void querySubprocess() {\n                     }\n                 }\n             } catch (Exception e) {\n    -            String processInfo = _process.getProcessInfoString() + _process.getProcessTerminationInfoString();\n    -            throw new RuntimeException(processInfo, e);\n    +            LOG.error(\"Halting process: ShellSpout died.\", e);\n    --- End diff --\n    \n    I think we should change [ShellProcess#getErrorsStream](https://github.com/apache/storm/blob/24b5eefb1553ae37951807502a433f24d3e95ec1/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L135-L145) so that it checks that there is actually something to read.\n    \n    This would fix a couple of other places where a hang looks possible:\n    \n    * https://github.com/apache/storm/blob/24b5eefb1553ae37951807502a433f24d3e95ec1/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L68\n    * https://github.com/apache/storm/blob/24b5eefb1553ae37951807502a433f24d3e95ec1/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L70\n    * https://github.com/apache/storm/blob/24b5eefb1553ae37951807502a433f24d3e95ec1/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L101\n    \n    ShellProcess#logErrorStream [does this](https://github.com/apache/storm/blob/24b5eefb1553ae37951807502a433f24d3e95ec1/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L123-L133).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-30T21:42:08.791+0000","updated":"2014-09-30T21:42:08.791+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14187540","id":"14187540","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user d2r commented on the pull request:\n\n    https://github.com/apache/storm/pull/218#issuecomment-60838694\n  \n    Hi @dashengju, any update on this pull request?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-28T21:55:23.088+0000","updated":"2014-10-28T21:55:23.088+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14188317","id":"14188317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user dashengju commented on the pull request:\n\n    https://github.com/apache/storm/pull/218#issuecomment-60918647\n  \n    @d2r  I had no time work on this pull request those days. \n    I will verify the problem, make some unit test and submit update on the pull request next few days.\n    any suggestion? \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-29T12:55:23.816+0000","updated":"2014-10-29T12:55:23.816+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14189171","id":"14189171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on the pull request:\n\n    https://github.com/apache/storm/pull/218#issuecomment-61017158\n  \n    Is there a relation between parent process's exception and subprocess's stderr?\n    If it's not, and we should capture it from parent, I think spout may have stderr reader with new thread.\n    Because it may not be right way to capture it when only parent process raises exception.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-29T22:36:03.907+0000","updated":"2014-10-29T22:36:03.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14189530","id":"14189530","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user dashengju commented on the pull request:\n\n    https://github.com/apache/storm/pull/218#issuecomment-61038451\n  \n    @HeartSaVioR , \n    parent process's exception contains two types: 1) net io error caused; for example, subprocess report an error to stderr and exit; 2) parent process's handle logic exception.\n    as 1), we want to read from stderr to get more information; \n    as 2), as you say, it may not be right way to capture it when only parent process raises exception.\n    \n    @d2r 's suggestion, we should change ShellProcess#getErrorsStream so that it checks that there is actually something to read.\n    \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-30T02:44:57.073+0000","updated":"2014-10-30T02:44:57.073+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14189565","id":"14189565","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user dashengju closed the pull request at:\n\n    https://github.com/apache/storm/pull/218\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-30T03:19:49.288+0000","updated":"2014-10-30T03:19:49.288+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14189581","id":"14189581","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user dashengju commented on the pull request:\n\n    https://github.com/apache/storm/pull/218#issuecomment-61041868\n  \n    sorry closed this pull request by accident, I will create a new PR by same title.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-30T03:40:23.069+0000","updated":"2014-10-30T03:40:23.069+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14189590","id":"14189590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user dashengju opened a pull request:\n\n    https://github.com/apache/storm/pull/305\n\n    [STORM-442] multilang ShellBolt/ShellSpout die() can be hang when Exception happened\n\n    @d2r , @harshach , @HeartSaVioR ,  I closed the old pull request by accident, so I opened a new one, and move all the comments to here.\n    ------------------------------------------------------------------------------------------------\n    In ShellBolt, the _readerThread read command from python/shell process, and handle like this:\n    try\n    { \n    ShellMsg shellMsg = _process.readShellMsg(); \n    ... \n    } catch (InterruptedException e) {\n    } catch (Throwable t) { \n    die(t); \n    }\n    \n    And in the die function, getProcessTerminationInfoString will read getErrorsString() from processErrorStream.\n    \n    private void die(Throwable exception) { \n    String processInfo = _process.getProcessInfoString() + _process.getProcessTerminationInfoString(); \n    _exception = new RuntimeException(processInfo, exception); \n    }\n    \n    so when ShellBolt got exception(for example, readShellMsg() throw NPE ) , but it is not an error from sub process, then getProcessTerminationInfoString will be hang because processErrorStream have no data to read.\n    \n    ------------------------------------------------------------------------------------------------\n    harshach commented on 21 Aug\n    @dashengju Can you clarify \"getProcessTerminationInfoString will be hang because processErrorStream have no data to read\". Which case it might hang , looking at the code https://github.com/apache/incubator-storm/blob/master/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L135 If there is no data in processErrorStream it returns empty string.\n    If possible can you add a unit test. Thanks.\n    \n    ------------------------------------------------------------------------------------------------\n    d2r added a note 29 days ago\n    I think we should change ShellProcess#getErrorsStream so that it checks that there is actually something to read.\n    \n    This would fix a couple of other places where a hang looks possible:\n    \n    https://github.com/apache/storm/blob/24b5eefb1553ae37951807502a433f24d3e95ec1/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L68\n    https://github.com/apache/storm/blob/24b5eefb1553ae37951807502a433f24d3e95ec1/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L70\n    https://github.com/apache/storm/blob/24b5eefb1553ae37951807502a433f24d3e95ec1/storm-core/src/jvm/backtype/storm/utils/ShellProcess.java#L101\n    \n    ShellProcess#logErrorStream does this.\n    \n    ------------------------------------------------------------------------------------------------\n    d2r commented a day ago\n    Hi @dashengju, any update on this pull request?\n    \n    ------------------------------------------------------------------------------------------------ \n    dashengju commented 15 hours ago\n    @d2r I had no time work on this pull request those days. \n    I will verify the problem, make some unit test and submit update on the pull request next few days.\n    any suggestion?\n    \n    ------------------------------------------------------------------------------------------------\n    HeartSaVioR commented 5 hours ago\n    Is there a relation between parent process's exception and subprocess's stderr?\n    If it's not, and we should capture it from parent, I think spout may have stderr reader with new thread.\n    Because it may not be right way to capture it when only parent process raises exception.\n    \n    ------------------------------------------------------------------------------------------------ \n    dashengju commented an hour ago\n    @HeartSaVioR , \n    parent process's exception contains two types: 1) net io error caused; for example, subprocess report an error to stderr and exit; 2) parent process's handle logic exception.\n    as 1), we want to read from stderr to get more information; \n    as 2), as you say, it may not be right way to capture it when only parent process raises exception.\n    \n    @d2r 's suggestion, we should change ShellProcess#getErrorsStream so that it checks that there is actually something to read.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/dashengju/storm Multilang_die_hang\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/305.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #305\n    \n----\ncommit ac5a18dc30ee6e9257eb5c18c0c87e7c7e944b23\nAuthor: JuDasheng <judasheng@meituan.com>\nDate:   2014-10-30T03:46:21Z\n\n    change ShellProcess#getErrorsStream so that it checks that there is actually something to read.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-30T03:51:11.493+0000","updated":"2014-10-30T03:51:11.493+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14189854","id":"14189854","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user dashengju commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61065703\n  \n    please do not review this pull request now.\n    we need some tests to reprocess the problem and verify the solution. when it is ready to review, I will ask for review at here.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-30T09:38:14.725+0000","updated":"2014-10-30T09:38:14.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14191297","id":"14191297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user dashengju commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61213166\n  \n    We have reproduced the problem： ShellProcess#getErrorsStream is hang when only parent process raises exception and subprocess still work.\n    \n    as @d2r 's suggestion, we changed ShellProcess#getErrorsStream so that it checks that there is actually something to read, as ShellProcess#logErrorStream does, the problem is solved.\n    \n    @d2r , @revans2 , please help to review this pull request.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-31T03:50:53.041+0000","updated":"2014-10-31T03:50:53.041+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14191868","id":"14191868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61269957\n  \n    If we're narrowing issue to just handle parent process's Exception hang, looks good to me.\n    (We can make it better with extracting logic that reads from stderr to method, since it's duplicated from logErrorStream() and getErrorsString(). )\n    \n    This could be off-topic, but is there no chance to occur that subprocess writes stderr for some reason but parent process runs well without Exception? If it can possible, is parent process responsible to read stderr and do something (like logging, raise Exception, etc.)?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-31T14:41:32.125+0000","updated":"2014-10-31T14:41:32.125+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14194339","id":"14194339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user dashengju commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61447792\n  \n    @HeartSaVioR \n    \n    yes, there is a chance to occur that subprocess writes stderr for some reason but parent process runs well without Exception.  When this happens, parent process will check, and log then to log system.\n    \n    Below is the ShellBolt and PythonBolt communication flow. As you can see, when the ShellBolt send a tuple to Python, it will read from stderr(call logErrorStream()) to see anything to log, and log info them.\n    ![image](https://cloud.githubusercontent.com/assets/4263520/4879565/29834344-632d-11e4-99e3-051d1ae627c5.png)\n    \n    Below is the ShellSpout and PythonSpout communication flow. When the ShellSpout ask for a new tuple, it will read from stderr(call logErrorStream()) to see anything to log, and log info them.\n    ![image](https://cloud.githubusercontent.com/assets/4263520/4879593/c0273256-632d-11e4-9af7-c4a8e49d3f64.png)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-03T07:53:34.608+0000","updated":"2014-11-03T07:53:34.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14194377","id":"14194377","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61453891\n  \n    @dashengju \n    Yes, ShellSpout/Bolt read stderr from subprocess after sending tuple immediately.\n    \n    I'm afraid that this may cannot cover all cases, and ShellBolt could read stderr message after sending \"next\" tuple if PythonBolt doesn't write stderr immediately.\n    Please remember ShellBolt has no \"sync\". It just send a message and forget, and doesn't wait for \n    PythonBolt if it has any stderr message regarding that tuple.\n    \n    Btw, it's not related to current PR. It's just my 2 cents, so take your time.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-03T09:20:58.371+0000","updated":"2014-11-03T09:20:58.371+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14196038","id":"14196038","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user clockfly commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/305#discussion_r19798787\n  \n    --- Diff: storm-core/src/jvm/backtype/storm/utils/ShellProcess.java ---\n    @@ -135,7 +135,14 @@ public void logErrorStream() {\n         public String getErrorsString() {\n             if (processErrorStream != null) {\n                 try {\n    -                return IOUtils.toString(processErrorStream);\n    +                StringBuilder sb = new StringBuilder();\n    +                while (processErrorStream.available() > 0) {\n    +                    int bufferSize = processErrorStream.available();\n    --- End diff --\n    \n    It is not safe to use available(). Check http://stackoverflow.com/questions/804951/is-it-possible-to-read-from-a-inputstream-with-a-timeout\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-04T12:13:04.933+0000","updated":"2014-11-04T12:13:04.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14196040","id":"14196040","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user clockfly commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61631128\n  \n    \n    @dashengju \n    \n    When parent fails while child shell process is running correctly, should we call cleanup() to kill the suprocess first?\n    \n    This has two benefits:\n    1. avoid zoombie sub process to exist\n    2. Avoid blocking at sub process errorstream reading.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-04T12:14:56.904+0000","updated":"2014-11-04T12:14:56.904+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14196044","id":"14196044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user itaifrenkel commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61631559\n  \n    @clockfly - Please clarify. When you say \"the parent process fails\" do you mean that the worker process is no longer running? If this is the case that process cannot call cleanup() since it is not running. We are using os specific hooks in the child process to receive signal when parent process dies. Another cross platform alternative is using file lock checks. Either way, are you sure this is related to this pull request ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-04T12:19:30.396+0000","updated":"2014-11-04T12:19:30.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14196047","id":"14196047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user clockfly commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61631943\n  \n    @itaifrenkel,\n    \n    ```\n     When you say \"the parent process fails\" do you mean that the worker process is no longer running?\n    ```\n    No, it means the case described by dashengju, that an exception is thrown in the java space(not originated from sub process)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-04T12:23:25.132+0000","updated":"2014-11-04T12:23:25.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14196050","id":"14196050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user clockfly commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61632248\n  \n    dashengju is describling a use scenario that parent process blocks while trying to read error stream data from sub-process (parent java space throw an exception, which trigger the error handling).\n    \n    Becasue sub-process is still running, there is no EOF of errorStream, so errorStream.read() will blocks.\n    \n    If in this scenario, we can make sure the child process is dead by called child.destroy(), then there will be an EOF signalled to its error Stream, and parent process will not block.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-04T12:26:19.667+0000","updated":"2014-11-04T12:26:19.667+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14196930","id":"14196930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/305#discussion_r19839876\n  \n    --- Diff: storm-core/src/jvm/backtype/storm/utils/ShellProcess.java ---\n    @@ -135,7 +135,14 @@ public void logErrorStream() {\n         public String getErrorsString() {\n             if (processErrorStream != null) {\n                 try {\n    -                return IOUtils.toString(processErrorStream);\n    +                StringBuilder sb = new StringBuilder();\n    +                while (processErrorStream.available() > 0) {\n    +                    int bufferSize = processErrorStream.available();\n    --- End diff --\n    \n    I'm curious to. Is it not safe because of chance of blocking, or available() can always return 0 with some InputStream subclasses so we cannot read any messages from subprocess?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-04T22:05:43.894+0000","updated":"2014-11-04T22:05:43.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14197882","id":"14197882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user dashengju commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-61774651\n  \n    @clockfly  \n    I think it is not a good idea to kill sub process. Because when we catch a exception, we do not know whether sub process is still running. \"kill pid\" may cause other error.\n    \n    By the way, when parent process is exist, the sub process will exit when read from stdin encounter a EOF, so sub process  will not zoombie.\n    \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-05T08:32:54.892+0000","updated":"2014-11-05T08:32:54.892+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14257411","id":"14257411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-67989780\n  \n    I see this has not had that much traffic in quite a while.  The code to me looks acceptable.  I am not really happy with calling .available() twice, but I can live with it.  There is the possibility of a race if two different threads call getErrorsString or logErrorStream at the same time, but as the way the code is currently used that should not be a problem.  I am +1 on checking this in, but would like to know if others have any option.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-23T19:36:39.026+0000","updated":"2014-12-23T19:36:39.026+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14266793","id":"14266793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/storm/pull/305#issuecomment-68936183\n  \n    No other comments in the past two weeks so I am going to check this in.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-06T21:23:30.557+0000","updated":"2015-01-06T21:23:30.557+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14266804","id":"14266804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/305\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-06T21:29:05.714+0000","updated":"2015-01-06T21:29:05.714+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732490/comment/14266807","id":"14266807","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Thanks [~dashengju],\n\nI merged this into master.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2015-01-06T21:29:47.927+0000","updated":"2015-01-06T21:29:47.927+0000"}],"maxResults":26,"total":26,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-442/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ymnj:"}}