{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13166491","self":"https://issues.apache.org/jira/rest/api/2/issue/13166491","key":"STORM-3110","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":6600,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343340","id":"12343340","name":"1.2.3","archived":false,"released":false}],"aggregatetimespent":6600,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-06-25T00:55:13.035+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jun 25 00:55:13 UTC 2018","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_782771525_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2018-06-25T00:55:12.996+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3110/watchers","watchCount":1,"isWatching":false},"created":"2018-06-15T23:29:01.541+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-06-25T00:55:26.556+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"While running in secure mode, supervisor sets the worker user (in workers local state) as the user that launched the topology.\r\n\r\n \r\n{code:java}\r\nSET worker-user 4d67a6be-4c80-4622-96af-f94706d58553 foo\r\n{code}\r\n \r\n\r\nHowever the worker OS process does not actually run as the user \"foo\" (instead runs as storm user) unless {{supervisor.run.worker.as.user}} is also set.\r\n\r\nIf the supervisor's assignment changes, the supervisor in some cases checks if all processes are dead by matching the \"pid+user\". Here if the worker is running as a different user (say storm) the supervisor wrongly assumes that the worker process is dead.\r\n\r\nLater when supervisor tries to launch a worker at that same port, it throws a bind exception\r\n\r\no.a.s.m.n.Server main [INFO] Create Netty Server Netty-server-localhost-6700, buffer_size: 5242880, maxWorkers: 1\r\n o.a.s.d.worker main [ERROR] Error on initialization of server mk-worker\r\n org.apache.storm.shade.org.jboss.netty.channel.ChannelException: Failed to bind to: 0.0.0.0/0.0.0.0:6700\r\n at org.apache.storm.shade.org.jboss.netty.bootstrap.ServerBootstrap.bind(ServerBootstrap.java:272) ~[storm-core-1.2.0.3.1.0.0-501.jar:1.2.0.3.1.0.0-501]\r\n  ","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"1h 50m","remainingEstimateSeconds":0,"timeSpentSeconds":6600},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Supervisor does not kill all worker processes in secure mode in case of user mismatch","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmahadevan","name":"arunmahadevan","key":"arunmahadevan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun Mahadevan","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":6600,"total":6600,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":6600,"total":6600,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/comment/16521746","id":"16521746","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Thanks [~arunmahadevan], I merged into master and 1.x-branch.\r\n\r\nFor master branch I squashed commits and pushed. The commit is https://github.com/apache/storm/commit/82deb62dd3a6f58e5569244517bc93647fcab2a2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2018-06-25T00:55:13.035+0000","updated":"2018-06-25T00:55:13.035+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3110/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":11,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/112485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user arunmahadevan opened a pull request:\n\n    https://github.com/apache/storm/pull/2721\n\n    STORM-3110: Skip the user while checking isProcessAlive\n\n    \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/arunmahadevan/storm STORM-3110-1\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2721.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2721\n    \n----\ncommit 1d43937a12d5632d1c64e5701b8443a179595062\nAuthor: Arun Mahadevan <arunm@...>\nDate:   2018-06-15T23:32:53Z\n\n    STORM-3110: Skip the user while checking isProcessAlive\n\n----\n","created":"2018-06-15T23:38:15.429+0000","updated":"2018-06-15T23:38:15.429+0000","started":"2018-06-15T23:38:15.428+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"112485","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/112487","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on the issue:\n\n    https://github.com/apache/storm/pull/2721\n  \n    @revans2 , @HeartSaVioR, can you take a look?\n","created":"2018-06-15T23:47:32.470+0000","updated":"2018-06-15T23:47:32.470+0000","started":"2018-06-15T23:47:32.469+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"112487","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/112715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user danny0405 commented on the issue:\n\n    https://github.com/apache/storm/pull/2721\n  \n    For security, I think we need to keep the if user check, we should fix it but not through deleting it.\n","created":"2018-06-18T10:20:38.014+0000","updated":"2018-06-18T10:20:38.014+0000","started":"2018-06-18T10:20:38.013+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"112715","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/112812","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on the issue:\n\n    https://github.com/apache/storm/pull/2721\n  \n    Unless `supervisor.run.worker.as.user` is set, the worker process runs as \"storm\" user. I guess the supervisor should always check \"if all processes are dead\" by just looking if the worker pids are alive than doing user comparison, since there is no mapping between the user that launched the topology (e.g kerberos user) and the actual OS user that worker is running as (this is always storm).. In the \"run as user\" container the \"kill\" command is launched by switching to the OS user that worker is actually running as here - https://github.com/apache/storm/blob/1.x-branch/storm-core/src/jvm/org/apache/storm/daemon/supervisor/RunAsUserContainer.java#L55 and that should take care of the security.\r\n\n","created":"2018-06-18T16:30:44.590+0000","updated":"2018-06-18T16:30:44.590+0000","started":"2018-06-18T16:30:44.590+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"112812","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/112816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on the issue:\n\n    https://github.com/apache/storm/pull/2721\n  \n    Also note that supervisor might be killing the workers in response to an assignment change triggered by nimbus (may be due to user triggered kill or rebalance) and the supervisor has no idea of which end user/action might have triggered this. The authorization checks to see if the user has permissions to kill/rebalance the topology is already happening at nimbus so I think we are good.\r\n\n","created":"2018-06-18T16:43:28.178+0000","updated":"2018-06-18T16:43:28.178+0000","started":"2018-06-18T16:43:28.177+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"112816","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/113100","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2721\n  \n    I'm not an expert of Supervisor V2 but just based on my understanding of this issue, I guess we may want to address this to two different situations:\r\n    \r\n    1. `supervisor.run.worker.as.user` is set\r\n    \r\n    Supervisor should check the process with `worker` account (can be read via worker state).\r\n    \r\n    2. `supervisor.run.worker.as.user` is unset\r\n    \r\n    Supervisor should check the process with `supervisor` account, as workers will be always launched with `supervisor` account.\r\n    \r\n    In any cases, if the worker is running with different account, it might be considered as wrong process or out of sync. Ideally I think it should be corrected (kill the process) but it might open security issue (account A editing pid file for worker A1 and let Supervisor kill arbitrary process running with other account) so error or critical log message might be a best bet.\r\n    \r\n    I'm not sure how many cases we can encounter above case, but unless the hole is huge, I guess checking with above logic would work.\r\n    \r\n    @arunmahadevan @revans2 Please correct me if I'm missing here and/or there's better way to handle this.\n","created":"2018-06-19T08:48:46.418+0000","updated":"2018-06-19T08:48:46.418+0000","started":"2018-06-19T08:48:46.418+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"113100","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/113105","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2721\n  \n    My ideal thought depends on the assumption that we could get OS account for current JVM process in safe way. If there's no way to do it, I agree this PR might be a best bet.\n","created":"2018-06-19T08:52:57.108+0000","updated":"2018-06-19T08:52:57.108+0000","started":"2018-06-19T08:52:57.107+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"113105","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/113711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2721\n  \n    So you are running with authentication, but run as user is disabled, because you are running on windows. That is a use case that I missed, sorry about that.  \r\n    \r\n    This is not a security issue as we kill the process as the user that owns the container.  When run as user is enabled we do it as the user that launched the process, when it is disabled we do it as the supervisor user.  This means the OS will prevent us from killing a process we shouldn't, even if a worker self reports a process that it should not.\r\n    \r\n    The entire reason I put the user check in was to avoid a problem with PID reuse.  OSes typically rotate through PIDs in a way to avoid situations where a process dies and its PID is quickly handed to another process, but with how storm self reports PIDs through the file system... I just wanted to be cautious.\r\n    \r\n    Removing the user check entirely should be fine, the issue you might run into is that if a PID is reused too quickly by a different user you might be stuck trying to kill is process that you are not allowed to and end up stuck waiting for it to die forever.  The simple fix for me would be to have the Container pass in  `System.getProperty(\"user.name\")` for the user name, with a comment about why, and have RunAsUserContainer pass the real user in.\n","created":"2018-06-20T13:27:41.567+0000","updated":"2018-06-20T13:27:41.567+0000","started":"2018-06-20T13:27:41.566+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"113711","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/114517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on the issue:\n\n    https://github.com/apache/storm/pull/2721\n  \n    @revans2 , i have refactored the code so that we check for \"user.name\" in the normal container and the result of `getWorkerUser` in the RunAsUserContainer. \r\n    \r\n    The `getWorkerUser` is used in other places to set the user in the workers local state and apparently used to do some authorization checks in the log viewer. I did not want to affect that behavior so I introduced a new function to return the OS user that the worker is expected to run as that invokes the `getWorkerUser` in the run as container.\r\n    \r\n    This issue happens in posix environment as well and most of the users dont set the `supervisor.run.worker.as.user` config but run storm in secure mode.\n","created":"2018-06-21T22:09:18.062+0000","updated":"2018-06-21T22:09:18.062+0000","started":"2018-06-21T22:09:18.061+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"114517","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/114975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user raghavgautam commented on the issue:\n\n    https://github.com/apache/storm/pull/2721\n  \n    \uD83D\uDC4D \n","created":"2018-06-23T00:24:03.491+0000","updated":"2018-06-23T00:24:03.491+0000","started":"2018-06-23T00:24:03.491+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"114975","issueId":"13166491"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166491/worklog/115255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2721\n","created":"2018-06-25T00:34:47.959+0000","updated":"2018-06-25T00:34:47.959+0000","started":"2018-06-25T00:34:47.959+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"115255","issueId":"13166491"}]},"customfield_12311820":"0|i3uxpr:"}}