{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13171821","self":"https://issues.apache.org/jira/rest/api/2/issue/13171821","key":"STORM-3148","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":11400,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false}],"aggregatetimespent":11400,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2018-07-12 20:04:34.919","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_97167248_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2018-07-13T23:04:02.141+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3148/watchers","watchCount":1,"isWatching":false},"created":"2018-07-12T20:04:34.919+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-13T23:04:09.728+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12332475","id":"12332475","name":"storm-client"}],"timeoriginalestimate":null,"description":"We recently ran into an integration test failure. (TestingTest).\r\n\r\nIt looks like the only way for this error to happen would be if there was an internal bug in kryo, or if we were using Output from multiple threads.  It is the latter.\r\n\r\n \r\n\r\norg.apache.storm.messaging.netty.Server creates a single KryoValuesSerializer and KryoValuesDeserializer instance.  These get passed through StormServerPipelineFactory and added to each channel (if there are multiple channels there are multiple threads) and we can mess up both encoding and decoding messages.\r\n\r\n \r\n{code:java}\r\n2018-07-12 17:41:49.408 [Netty-server-localhost-1030-worker-1] ERROR org.apache.storm.messaging.netty.StormServerHandler - server errors in handling the request\r\norg.apache.storm.shade.io.netty.handler.codec.EncoderException: java.lang.ArrayIndexOutOfBoundsException\r\n    at org.apache.storm.shade.io.netty.handler.codec.MessageToMessageEncoder.write(MessageToMessageEncoder.java:106) ~[shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.invokeWrite0(AbstractChannelHandlerContext.java:738) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.invokeWriteAndFlush(AbstractChannelHandlerContext.java:801) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:814) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.writeAndFlush(AbstractChannelHandlerContext.java:794) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.DefaultChannelPipeline.writeAndFlush(DefaultChannelPipeline.java:1066) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannel.writeAndFlush(AbstractChannel.java:305) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.messaging.netty.Server.channelActive(Server.java:261) [storm-client-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.messaging.netty.StormServerHandler.channelActive(StormServerHandler.java:40) [storm-client-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelActive(AbstractChannelHandlerContext.java:213) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelActive(AbstractChannelHandlerContext.java:199) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelActive(AbstractChannelHandlerContext.java:192) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.ChannelInboundHandlerAdapter.channelActive(ChannelInboundHandlerAdapter.java:64) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelActive(AbstractChannelHandlerContext.java:213) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelActive(AbstractChannelHandlerContext.java:199) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelActive(AbstractChannelHandlerContext.java:192) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelActive(DefaultChannelPipeline.java:1422) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelActive(AbstractChannelHandlerContext.java:213) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelActive(AbstractChannelHandlerContext.java:199) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.DefaultChannelPipeline.fireChannelActive(DefaultChannelPipeline.java:941) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannel$AbstractUnsafe.register0(AbstractChannel.java:518) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannel$AbstractUnsafe.access$200(AbstractChannel.java:423) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.AbstractChannel$AbstractUnsafe$1.run(AbstractChannel.java:482) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:465) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:884) [shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    at java.lang.Thread.run(Thread.java:745) [?:1.8.0_60]\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException\r\n    at java.lang.System.arraycopy(Native Method) ~[?:1.8.0_60]\r\n    at com.esotericsoftware.kryo.io.Output.toBytes(Output.java:130) ~[kryo-3.0.3.jar:?]\r\n    at org.apache.storm.serialization.KryoValuesSerializer.serializeObject(KryoValuesSerializer.java:50) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.messaging.netty.BackPressureStatus.buffer(BackPressureStatus.java:68) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.messaging.netty.BackPressureStatusEncoder.encode(BackPressureStatusEncoder.java:34) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.messaging.netty.BackPressureStatusEncoder.encode(BackPressureStatusEncoder.java:24) ~[storm-client-2.0.0.y.jar:2.0.0.y]\r\n    at org.apache.storm.shade.io.netty.handler.codec.MessageToMessageEncoder.write(MessageToMessageEncoder.java:88) ~[shaded-deps-2.0.0.y.jar:2.0.0.y]\r\n    ... 27 more\r\n   {code}","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"3h 10m","remainingEstimateSeconds":0,"timeSpentSeconds":11400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"StormServerPipelineFactory can deserialize messages incorrectly","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":11400,"total":11400,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":11400,"total":11400,"percent":100},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3148/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":19,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122501","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user revans2 opened a pull request:\n\n    https://github.com/apache/storm/pull/2762\n\n    STORM-3148: Avoid threading issues with kryo\n\n    I am going to run some perf tests just to be sure, but the only real impact should be slightly more memory usage, and no more than we have to 1.x topologies.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/revans2/incubator-storm STORM-3148\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2762.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2762\n    \n----\ncommit 911a0d7006ca79ec41d9a5692fbd417f1931cbb4\nAuthor: Robert (Bobby) Evans <evans@...>\nDate:   2018-07-12T20:58:20Z\n\n    STORM-3148: Avoid threading issues with kryo\n\n----\n","created":"2018-07-12T21:00:31.636+0000","updated":"2018-07-12T21:00:31.636+0000","started":"2018-07-12T21:00:31.636+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122501","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2762\n  \n    I am seeing some issues with this patch under heavy load let me debug it before merging anything.\n","created":"2018-07-12T21:19:22.394+0000","updated":"2018-07-12T21:19:22.394+0000","started":"2018-07-12T21:19:22.393+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122510","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2762\n  \n    The error appears to be related to a separate JIRA around backpressure status, but I want to be sure.\n","created":"2018-07-12T21:22:55.015+0000","updated":"2018-07-12T21:22:55.015+0000","started":"2018-07-12T21:22:55.015+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122512","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2762\n  \n    I fixed the issues with backpressure.  It turns out that the system bolt was reporting backpressure too.  So I updated the code to filter it out on the sending side, but to deal with the error appropriately on the receiving side.\n","created":"2018-07-12T21:51:01.461+0000","updated":"2018-07-12T21:51:01.461+0000","started":"2018-07-12T21:51:01.460+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122516","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2762\n  \n    Oh and the perf tests look good now.  I was able to do 100,000 sentences per second on my MBP on ThroughputVsLatency.  I couldn't really compare the memory usage as even without my change it would not run because of the backpressure issue.\n","created":"2018-07-12T21:55:02.929+0000","updated":"2018-07-12T21:55:02.929+0000","started":"2018-07-12T21:55:02.928+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122517","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122523","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202196741\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/messaging/netty/StormClientHandler.java ---\n    @@ -47,12 +47,20 @@ public void channelRead(ChannelHandlerContext ctx, Object message) throws Except\n                 BackPressureStatus status = (BackPressureStatus) message;\n                 if (status.bpTasks != null) {\n                     for (Integer bpTask : status.bpTasks) {\n    -                    remoteBpStatus[bpTask].set(true);\n    +                    try {\n    +                        remoteBpStatus[bpTask].set(true);\n    +                    } catch (ArrayIndexOutOfBoundsException e) {\n    --- End diff --\n    \n    Could this happen in normal situation? I guess we don't expect it. I don't think catching exception would hurt, but just to be sure about this.\n","created":"2018-07-12T22:22:21.632+0000","updated":"2018-07-12T22:22:21.632+0000","started":"2018-07-12T22:22:21.632+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122523","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202299829\n  \n    --- Diff: storm-client/test/jvm/org/apache/storm/messaging/netty/BackPressureStatusTest.java ---\n    @@ -0,0 +1,35 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with\n    + * this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version\n    + * 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n    + *\n    + * http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n    + * and limitations under the License.\n    + */\n    +\n    +package org.apache.storm.messaging.netty;\n    +\n    +import java.io.IOException;\n    +import java.util.Arrays;\n    +import org.apache.storm.serialization.KryoValuesSerializer;\n    +import org.apache.storm.shade.io.netty.buffer.ByteBuf;\n    +import org.apache.storm.shade.io.netty.buffer.UnpooledByteBufAllocator;\n    +import org.apache.storm.utils.Utils;\n    +import org.junit.jupiter.api.Test;\n    +\n    +import static org.junit.jupiter.api.Assertions.*;\n    +\n    +class BackPressureStatusTest {\n    +\n    +    @Test\n    +    void bufferTest() throws IOException {\n    --- End diff --\n    \n    What is this test demonstrating?\n","created":"2018-07-13T09:46:41.214+0000","updated":"2018-07-13T09:46:41.214+0000","started":"2018-07-13T09:46:41.213+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122731","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122733","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202300189\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/messaging/netty/StormClientHandler.java ---\n    @@ -47,12 +47,20 @@ public void channelRead(ChannelHandlerContext ctx, Object message) throws Except\n                 BackPressureStatus status = (BackPressureStatus) message;\n                 if (status.bpTasks != null) {\n                     for (Integer bpTask : status.bpTasks) {\n    -                    remoteBpStatus[bpTask].set(true);\n    +                    try {\n    +                        remoteBpStatus[bpTask].set(true);\n    +                    } catch (ArrayIndexOutOfBoundsException e) {\n    --- End diff --\n    \n    I'm also not sure why this can happen?\n","created":"2018-07-13T09:48:08.493+0000","updated":"2018-07-13T09:48:08.493+0000","started":"2018-07-13T09:48:08.492+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122733","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202341617\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/messaging/netty/StormClientHandler.java ---\n    @@ -47,12 +47,20 @@ public void channelRead(ChannelHandlerContext ctx, Object message) throws Except\n                 BackPressureStatus status = (BackPressureStatus) message;\n                 if (status.bpTasks != null) {\n                     for (Integer bpTask : status.bpTasks) {\n    -                    remoteBpStatus[bpTask].set(true);\n    +                    try {\n    +                        remoteBpStatus[bpTask].set(true);\n    +                    } catch (ArrayIndexOutOfBoundsException e) {\n    --- End diff --\n    \n    So there are two issues happening in the jira.  Previously when under heavy load a backpressure messsage would be sent.  Under the old code this might contain a -1 which would cause an ArrayIndexOutOFBoundsException to happen.  When it did some backpressure status updates in the message might be lost (specifically the ones that turn off backpressure) and the topology would stop processing.  I fixed the cause of the -1 indexes, but I thought it would be best to also guard against future problems and if there is one we can process the rest of the status updates.\n","created":"2018-07-13T13:01:48.349+0000","updated":"2018-07-13T13:01:48.349+0000","started":"2018-07-13T13:01:48.348+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122770","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202342773\n  \n    --- Diff: storm-client/test/jvm/org/apache/storm/messaging/netty/BackPressureStatusTest.java ---\n    @@ -0,0 +1,35 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with\n    + * this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version\n    + * 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n    + *\n    + * http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n    + * and limitations under the License.\n    + */\n    +\n    +package org.apache.storm.messaging.netty;\n    +\n    +import java.io.IOException;\n    +import java.util.Arrays;\n    +import org.apache.storm.serialization.KryoValuesSerializer;\n    +import org.apache.storm.shade.io.netty.buffer.ByteBuf;\n    +import org.apache.storm.shade.io.netty.buffer.UnpooledByteBufAllocator;\n    +import org.apache.storm.utils.Utils;\n    +import org.junit.jupiter.api.Test;\n    +\n    +import static org.junit.jupiter.api.Assertions.*;\n    +\n    +class BackPressureStatusTest {\n    +\n    +    @Test\n    +    void bufferTest() throws IOException {\n    --- End diff --\n    \n    The original problem was because kryo was throwing an exception trying to serialize a BackPressureStatus message.  I wrote this test initially to try and debug what was happening, and I ended up serializing millions of BackPressureStatus in loops to try and verify that it was working properly.  When I failed I remembered that kryo was not thread safe and started looking around there.  If you want me to delete it I can.\n","created":"2018-07-13T13:06:15.887+0000","updated":"2018-07-13T13:06:15.887+0000","started":"2018-07-13T13:06:15.886+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122772","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122773","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202342969\n  \n    --- Diff: storm-client/test/jvm/org/apache/storm/messaging/netty/BackPressureStatusTest.java ---\n    @@ -0,0 +1,35 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with\n    + * this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version\n    + * 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n    + *\n    + * http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n    + * and limitations under the License.\n    + */\n    +\n    +package org.apache.storm.messaging.netty;\n    +\n    +import java.io.IOException;\n    +import java.util.Arrays;\n    +import org.apache.storm.serialization.KryoValuesSerializer;\n    +import org.apache.storm.shade.io.netty.buffer.ByteBuf;\n    +import org.apache.storm.shade.io.netty.buffer.UnpooledByteBufAllocator;\n    +import org.apache.storm.utils.Utils;\n    +import org.junit.jupiter.api.Test;\n    +\n    +import static org.junit.jupiter.api.Assertions.*;\n    +\n    +class BackPressureStatusTest {\n    +\n    +    @Test\n    +    void bufferTest() throws IOException {\n    --- End diff --\n    \n    Actually I'll just delete it because there is no reason to keep it, especially because we don't verify the result in any way.\n","created":"2018-07-13T13:06:58.073+0000","updated":"2018-07-13T13:06:58.073+0000","started":"2018-07-13T13:06:58.073+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122773","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202343054\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/messaging/netty/StormClientHandler.java ---\n    @@ -47,12 +47,20 @@ public void channelRead(ChannelHandlerContext ctx, Object message) throws Except\n                 BackPressureStatus status = (BackPressureStatus) message;\n                 if (status.bpTasks != null) {\n                     for (Integer bpTask : status.bpTasks) {\n    -                    remoteBpStatus[bpTask].set(true);\n    +                    try {\n    +                        remoteBpStatus[bpTask].set(true);\n    +                    } catch (ArrayIndexOutOfBoundsException e) {\n    --- End diff --\n    \n    OK. Makes sense. I know message of exception will contain the index which will be included to log message, but explicitly write in log message would help users to find the index while grepping since it can be found within same line.\n","created":"2018-07-13T13:07:18.233+0000","updated":"2018-07-13T13:07:18.233+0000","started":"2018-07-13T13:07:18.233+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122774","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122776","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202343846\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/messaging/netty/StormClientHandler.java ---\n    @@ -47,12 +47,20 @@ public void channelRead(ChannelHandlerContext ctx, Object message) throws Except\n                 BackPressureStatus status = (BackPressureStatus) message;\n                 if (status.bpTasks != null) {\n                     for (Integer bpTask : status.bpTasks) {\n    -                    remoteBpStatus[bpTask].set(true);\n    +                    try {\n    +                        remoteBpStatus[bpTask].set(true);\n    +                    } catch (ArrayIndexOutOfBoundsException e) {\n    --- End diff --\n    \n    Makes sense, thanks.\n","created":"2018-07-13T13:10:29.906+0000","updated":"2018-07-13T13:10:29.906+0000","started":"2018-07-13T13:10:29.905+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122776","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122777","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202344011\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/messaging/netty/StormClientHandler.java ---\n    @@ -47,12 +47,20 @@ public void channelRead(ChannelHandlerContext ctx, Object message) throws Except\n                 BackPressureStatus status = (BackPressureStatus) message;\n                 if (status.bpTasks != null) {\n                     for (Integer bpTask : status.bpTasks) {\n    -                    remoteBpStatus[bpTask].set(true);\n    +                    try {\n    +                        remoteBpStatus[bpTask].set(true);\n    +                    } catch (ArrayIndexOutOfBoundsException e) {\n    +                        LOG.error(\"BP index out of bounds {}\", e);\n    --- End diff --\n    \n    Nit: Is it intentional that the stack trace is stripped here?\n","created":"2018-07-13T13:11:09.659+0000","updated":"2018-07-13T13:11:09.659+0000","started":"2018-07-13T13:11:09.628+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122777","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202344217\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/messaging/netty/StormClientHandler.java ---\n    @@ -47,12 +47,24 @@ public void channelRead(ChannelHandlerContext ctx, Object message) throws Except\n                 BackPressureStatus status = (BackPressureStatus) message;\n                 if (status.bpTasks != null) {\n                     for (Integer bpTask : status.bpTasks) {\n    -                    remoteBpStatus[bpTask].set(true);\n    +                    try {\n    +                        remoteBpStatus[bpTask].set(true);\n    +                    } catch (ArrayIndexOutOfBoundsException e) {\n    +                        //Just in case we get something we are confused about\n    +                        // we can continue processing the rest of the tasks\n    +                        LOG.error(\"BP index out of bounds {}\", e);\n    --- End diff --\n    \n    Is it intentional that the stack trace is stripped here?\n","created":"2018-07-13T13:12:12.931+0000","updated":"2018-07-13T13:12:12.931+0000","started":"2018-07-13T13:12:12.930+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122778","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122779","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on the issue:\n\n    https://github.com/apache/storm/pull/2762\n  \n    +1\n","created":"2018-07-13T13:25:20.567+0000","updated":"2018-07-13T13:25:20.567+0000","started":"2018-07-13T13:25:20.552+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122779","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202431655\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/messaging/netty/StormClientHandler.java ---\n    @@ -47,12 +47,24 @@ public void channelRead(ChannelHandlerContext ctx, Object message) throws Except\n                 BackPressureStatus status = (BackPressureStatus) message;\n                 if (status.bpTasks != null) {\n                     for (Integer bpTask : status.bpTasks) {\n    -                    remoteBpStatus[bpTask].set(true);\n    +                    try {\n    +                        remoteBpStatus[bpTask].set(true);\n    +                    } catch (ArrayIndexOutOfBoundsException e) {\n    +                        //Just in case we get something we are confused about\n    +                        // we can continue processing the rest of the tasks\n    +                        LOG.error(\"BP index out of bounds {}\", e);\n    --- End diff --\n    \n    Yes, because when this was happening it was happening everywhere, and there is only one line under the try catch block so there isn't a lot of confusion about what happened.\n","created":"2018-07-13T18:09:27.420+0000","updated":"2018-07-13T18:09:27.420+0000","started":"2018-07-13T18:09:27.419+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122991","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/122992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2762#discussion_r202431877\n  \n    --- Diff: storm-client/src/jvm/org/apache/storm/messaging/netty/StormClientHandler.java ---\n    @@ -47,12 +47,20 @@ public void channelRead(ChannelHandlerContext ctx, Object message) throws Except\n                 BackPressureStatus status = (BackPressureStatus) message;\n                 if (status.bpTasks != null) {\n                     for (Integer bpTask : status.bpTasks) {\n    -                    remoteBpStatus[bpTask].set(true);\n    +                    try {\n    +                        remoteBpStatus[bpTask].set(true);\n    +                    } catch (ArrayIndexOutOfBoundsException e) {\n    --- End diff --\n    \n    There is no way to disable backpressure right now.  It didn't crash because this is running under netty.   Netty will catch the exception and pass it off to an exception handler/the future.  I didn't trace down the exact path and why we were not handling this exception to cause it to come down, but I will file a follow on JIRA to examine it.\n","created":"2018-07-13T18:10:23.903+0000","updated":"2018-07-13T18:10:23.903+0000","started":"2018-07-13T18:10:23.903+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122992","issueId":"13171821"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13171821/worklog/123078","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2762\n","created":"2018-07-13T23:04:09.723+0000","updated":"2018-07-13T23:04:09.723+0000","started":"2018-07-13T23:04:09.722+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"123078","issueId":"13171821"}]},"customfield_12311820":"0|i3vu93:"}}