{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12822915","self":"https://issues.apache.org/jira/rest/api/2/issue/12822915","key":"STORM-794","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329843","id":"12329843","name":"1.0.0","archived":false,"released":true,"releaseDate":"2016-04-12"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-05-04T07:54:56.378+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 12 15:50:56 UTC 2015","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1038123224_*|*_3_*:*_1_*:*_16621868676_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2015-11-12T15:50:56.027+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-794/watchers","watchCount":3,"isWatching":false},"created":"2015-04-22T06:17:44.169+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327112","id":"12327112","name":"0.9.3","archived":false,"released":true,"releaseDate":"2014-11-25"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-11-12T15:50:56.061+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"I met an issue from Trident Topology in production env.\n\nNormally, when we kill a topology via UI, Nimbus changes Topology status to \"killed\", and when Spout determines new status, it becomes deactivated so bolts can handle remain tuples within wait-time.\nAFAIK that's how Storm guarantees graceful shutdown.\n\nBut, Trident Topology seems not handle \"deactivate\" while we try shutdown topology gracefully.\nMasterBatchCoordinator never stops making next transaction, so Trident Spout never stops emitting, bolts (function) always take care of tuples.\n\nTopology setting\n- 1 worker, 1 acker\n- max spout pending: 1\n- TOPOLOGY_TRIDENT_BATCH_EMIT_INTERVAL_MILLIS : 5\n-- It may be weird but MasterBatchCoordinator's default value is 1\n\n* Nimbus log\n\n{code}\n2015-04-20 09:59:07.954 INFO  [pool-5-thread-41][nimbus] Delaying event :remove for 120 secs for BFDC-topology-DynamicCollect-68c9d7b4-72-1429491015\n...\n2015-04-20 09:59:07.955 INFO  [pool-5-thread-41][nimbus] Updated BFDC-topology-DynamicCollect-68c9d7b4-72-1429491015 with status {:type :killed, :kill-time-secs 120}\n...\n2015-04-20 10:01:07.956 INFO  [timer][nimbus] Killing topology: BFDC-topology-DynamicCollect-68c9d7b4-72-1429491015\n...\n2015-04-20 10:01:14.448 INFO  [timer][nimbus] Cleaning up BFDC-topology-DynamicCollect-68c9d7b4-72-1429491015\n{code}\n\n* Supervisor log\n\n{code}\n2015-04-20 10:01:07.960 INFO  [Thread-1][supervisor] Removing code for storm id BFDC-topology-DynamicCollect-68c9d7b4-72-1429491015\n2015-04-20 10:01:07.962 INFO  [Thread-2][supervisor] Shutting down and clearing state for id 9719259e-528c-4336-abf9-592c1bb9a00b. Current supervisor time: 1429491667. State: :disallowed, Heartbeat: #backtype.storm.daemon.common.WorkerHeartbeat{:time-secs 1429491667, :storm-id \"BFDC-topology-DynamicCollect-68c9d7b4-72-1429491015\", :executors #{[2 2] [3 3] [4 4] [5 5] [6 6] [7 7] [8 8] [9 9] [10 10] [11 11] [12 12] [13 13] [14 14] [-1 -1] [1 1]}, :port 6706}\n2015-04-20 10:01:07.962 INFO  [Thread-2][supervisor] Shutting down 5bc084a2-b668-4610-86f6-9b93304d40a8:9719259e-528c-4336-abf9-592c1bb9a00b\n2015-04-20 10:01:08.974 INFO  [Thread-2][supervisor] Shut down 5bc084a2-b668-4610-86f6-9b93304d40a8:9719259e-528c-4336-abf9-592c1bb9a00b\n{code}\n\n* Worker log\n\n{code}\n2015-04-20 10:01:07.985 INFO  [Thread-33][worker] Shutting down worker BFDC-topology-DynamicCollect-68c9d7b4-72-1429491015 5bc084a2-b668-4610-86f6-9b93304d40a8 6706\n2015-04-20 10:01:07.985 INFO  [Thread-33][worker] Shutting down receive thread\n2015-04-20 10:01:07.988 WARN  [Thread-33][ExponentialBackoffRetry] maxRetries too large (300). Pinning to 29\n2015-04-20 10:01:07.988 INFO  [Thread-33][StormBoundedExponentialBackoffRetry] The baseSleepTimeMs [100] the maxSleepTimeMs [1000] the maxRetries [300]\n2015-04-20 10:01:07.988 INFO  [Thread-33][Client] New Netty Client, connect to localhost, 6706, config: , buffer_size: 5242880\n2015-04-20 10:01:07.991 INFO  [client-schedule-service-1][Client] Reconnect started for Netty-Client-localhost/127.0.0.1:6706... [0]\n2015-04-20 10:01:07.996 INFO  [Thread-33][loader] Shutting down receiving-thread: [BFDC-topology-DynamicCollect-68c9d7b4-72-1429491015, 6706]\n...\n2015-04-20 10:01:08.044 INFO  [Thread-33][Client] Closing Netty Client Netty-Client-localhost/127.0.0.1:6706\n2015-04-20 10:01:08.044 INFO  [Thread-33][Client] Waiting for pending batchs to be sent with Netty-Client-localhost/127.0.0.1:6706..., timeout: 600000ms, pendings: 1\n{code}\n\nI found activating log, but cannot find deactivating log.\n\n{code}\n2015-04-20 09:50:24.556 INFO  [Thread-30-$mastercoord-bg0][executor] Activating spout $mastercoord-bg0:(1)\n{code}\n\nPlease note that it doesn't work when I just push button to \"deactivate\" topology via UI.\n\nWe're changing our Topology to normal Spout-Bolt, but personally I'd like to see it resolved. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Trident Topology with some situation seems not handle deactivate during graceful shutdown","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/14506599","id":"14506599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Out of curiosity, waiting 1 sec to prepare shutdown seems to be too short.\n\nIt seems that worker couldn't execute whole shutdown function before worker has been killed by supervisor.\n(Please correct me if I'm wrong! :) )\n\nLast log which is in shutdown function is \"Shutting down receive thread\".\n\n{code}\n        shutdown* (fn []\n                    (log-message \"Shutting down worker \" storm-id \" \" assignment-id \" \" port)\n                    (doseq [[_ socket] @(:cached-node+port->socket worker)]\n                      ;; this will do best effort flushing since the linger period\n                      ;; was set on creation\n                      (.close socket))\n                    (log-message \"Shutting down receive thread\")\n                    (receive-thread-shutdown)\n                    (log-message \"Shut down receive thread\")\n                    (log-message \"Terminating messaging context\")\n                    (log-message \"Shutting down executors\")\n                    (doseq [executor @executors] (.shutdown executor))\n                    (log-message \"Shut down executors\")\n                                        \n                    ;;this is fine because the only time this is shared is when it's a local context,\n                    ;;in which case it's a noop\n                    (.term ^IContext (:mq-context worker))\n                    (log-message \"Shutting down transfer thread\")\n                    (disruptor/halt-with-interrupt! (:transfer-queue worker))\n\n                    (.interrupt transfer-thread)\n                    (.join transfer-thread)\n                    (log-message \"Shut down transfer thread\")\n                    (cancel-timer (:heartbeat-timer worker))\n                    (cancel-timer (:refresh-connections-timer worker))\n                    (cancel-timer (:refresh-active-timer worker))\n                    (cancel-timer (:executor-heartbeat-timer worker))\n                    (cancel-timer (:user-timer worker))\n                    \n                    (close-resources worker)\n                    \n                    ;; TODO: here need to invoke the \"shutdown\" method of WorkerHook\n                    \n                    (.remove-worker-heartbeat! (:storm-cluster-state worker) storm-id assignment-id port)\n                    (log-message \"Disconnecting from storm cluster state context\")\n                    (.disconnect (:storm-cluster-state worker))\n                    (.close (:cluster-state worker))\n                    (log-message \"Shut down worker \" storm-id \" \" assignment-id \" \" port))\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-22T07:47:10.477+0000","updated":"2015-04-22T07:50:23.803+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/14507033","id":"14507033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"I've tested \"deactivate\" to storm-starter's TridentWordCount and it works.\nMaybe some situations prevent checking state.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-22T13:18:38.276+0000","updated":"2015-04-22T13:18:38.276+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/14507202","id":"14507202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Sorry for last comment, completely misleading.\nStorm-starter's DRPC Stream was registered to Spout, and FixedBatchSpout is also registered to Bolt.\n\nMy only odd thing is why $mastercoord-bg0 didn't be deactivated.\nI have similar 6 topologies and all topologies ran into same situation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-04-22T14:56:56.074+0000","updated":"2015-04-22T14:56:56.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/14526316","id":"14526316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"I found the issue.\n\nI modified executor.clj to add logs representing size of overflow-buffer, pending, max-spout-pending, and active flag.\n\n{code}\n(let [active? @(:storm-active-atom executor-data)\n                curr-count (.get emitted-count)]\n            (do\n              (log-message \"overflow-buffer's size \" (.size overflow-buffer) \" and pending size \" (.size pending)\n                \" and max-spout-pending \" max-spout-pending \" and active \" active?)\n\n              (if (and (.isEmpty overflow-buffer)\n                   (or (not max-spout-pending)\n                       (< (.size pending) max-spout-pending)))\n              (if active?\n                (do\n                  (when-not @last-active\n                    (reset! last-active true)\n                    (log-message \"Activating spout \" component-id \":\" (keys task-datas))\n                    (fast-list-iter [^ISpout spout spouts] (.activate spout)))\n\n                  (fast-list-iter [^ISpout spout spouts]\n                    (do\n                      (log-message \"pending size \" (.size pending) \" and max-spout-pending \" max-spout-pending\n                        \" and active \" active?)\n                      (.nextTuple spout))))\n                (do\n                  (when @last-active\n                    (reset! last-active false)\n                    (log-message \"Deactivating spout \" component-id \":\" (keys task-datas))\n                    (fast-list-iter [^ISpout spout spouts] (.deactivate spout)))\n                  ;; TODO: log that it's getting throttled\n                  (Time/sleep 100))))\n              )\n            (if (and (= curr-count (.get emitted-count)) active?)\n              (do (.increment empty-emit-streak)\n                  (.emptyEmit spout-wait-strategy (.get empty-emit-streak)))\n              (.set empty-emit-streak 0)\n              )) \n{code}\n\nAnd below is logs. Please take a look at tx 41696:0.\n\n{noformat}\n2015-05-04 14:02:37.198 INFO  [Thread-16-$mastercoord-bg0][executor] Acking message 41696:0\n2015-05-04 14:02:37.198 INFO  [Thread-16-$mastercoord-bg0][task] Emitting: $mastercoord-bg0 $commit [41696:0]\n2015-05-04 14:02:37.198 INFO  [Thread-16-$mastercoord-bg0][task] Emitting: $mastercoord-bg0 __ack_init [-6284616655193060224 0 1]\n2015-05-04 14:02:37.199 INFO  [Thread-16-$mastercoord-bg0][executor] overflow-buffer's size 0 and pending size 10 and max-spout-pending 10 and active true\n2015-05-04 14:02:37.199 INFO  [Thread-4-__acker][executor] Processing received message source: $mastercoord-bg0:1, stream: __ack_init, id: {}, [-6284616655193060224 0 1]\n2015-05-04 14:02:37.199 INFO  [Thread-4-__acker][task] Emitting direct: 1; __acker __ack_ack [-6284616655193060224]\n2015-05-04 14:02:37.200 INFO  [Thread-16-$mastercoord-bg0][executor] Processing received message source: __acker:3, stream: __ack_ack, id: {}, [-6284616655193060224]\n2015-05-04 14:02:37.200 INFO  [Thread-16-$mastercoord-bg0][executor] Acking message 41696:0\n2015-05-04 14:02:37.200 INFO  [Thread-16-$mastercoord-bg0][task] Emitting: $mastercoord-bg0 $success [41696:0]\n2015-05-04 14:02:37.200 INFO  [Thread-2-$spoutcoord-spout0][executor] Processing received message source: $mastercoord-bg0:1, stream: $success, id: {}, [41696:0]\n2015-05-04 14:02:37.203 INFO  [Thread-16-$mastercoord-bg0][task] Emitting: $mastercoord-bg0 $batch [41706:0]\n2015-05-04 14:02:37.204 INFO  [Thread-16-$mastercoord-bg0][task] Emitting: $mastercoord-bg0 __ack_init [8327784611027372914 600406483975750023 1]\n2015-05-04 14:02:37.204 INFO  [Thread-2-$spoutcoord-spout0][executor] Processing received message source: $mastercoord-bg0:1, stream: $batch, id: {8327784611027372914=600406483975750023}, [41706:0]\n2015-05-04 14:02:37.204 INFO  [Thread-4-__acker][executor] Processing received message source: $mastercoord-bg0:1, stream: __ack_init, id: {}, [8327784611027372914 600406483975750023 1]\n2015-05-04 14:02:37.204 INFO  [Thread-16-$mastercoord-bg0][executor] overflow-buffer's size 0 and pending size 10 and max-spout-pending 10 and active true\n{noformat}\n\nWhen MasterBatchCoordinator.ack() has called and its attempt state is COMMITTING, MasterBatchCoordinator treats current tx to be completed, AND it starts new transaction immediately by increasing current tx id and calling sync() directly.\nYou can find that mastercoord-bg0 emits 41696:0 to $success and starts 41706 (note that max spout pending is 10). Async loop comes too late.\n\nSo, though executor can know that active is false, above if-statement could be always false so executor is never deactivated.\n\nps. My spout can sleep more than 1 sec before emitting from emitBatch(), but I don't think it should be issue. \nBtw, complete latency of batch is about 20 secs. At this time Spout doesn't emit anything from emitBatch(). \n{noformat}\n2015-05-04 14:02:17.173 INFO  [Thread-16-$mastercoord-bg0][task] Emitting: $mastercoord-bg0 $batch [41696:0]\n2015-05-04 14:02:37.198 INFO  [Thread-16-$mastercoord-bg0][task] Emitting: $mastercoord-bg0 $commit [41696:0]\n2015-05-04 14:02:37.200 INFO  [Thread-16-$mastercoord-bg0][task] Emitting: $mastercoord-bg0 $success [41696:0]\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-05-04T06:39:28.307+0000","updated":"2015-05-18T21:31:52.812+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/14526325","id":"14526325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"IMO, predicate for nextTuple and deactivate should be different.\nCurrent predicate is for nextTuple, not deactivate.\nWhat's the reason that Spout waits pending tuples count to be lower then max spout pending?\nDeactivate should be performed ASAP to prevent Spout emitting new tuples and let bolts have time to process pending tuples.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-05-04T06:56:00.217+0000","updated":"2015-05-04T06:56:00.217+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/14526380","id":"14526380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user HeartSaVioR opened a pull request:\n\n    https://github.com/apache/storm/pull/542\n\n    STORM-794 Modify Spout async loop to treat activate/deactivate ASAP\n\n    Currently when overflow buffer is not empty or pending is equal or greater than max spout pending, Spout doesn't handle activate / deactivate.\n    \n    I've met this scenario with Trident topology, max spout pending is 10, $batch's complete latency is about to 20 sec.\n    Please refer https://issues.apache.org/jira/browse/STORM-794 for more description.\n    \n    After applying this patch to 0.9.3, issue is resolved, though it still handles already emitted batches. \n    \n    >> deactivate\n    ```\n    2015-05-04 16:35:52.127 INFO  [Thread-12-spout0][RecollectSpout] batchId <46253> start\n    2015-05-04 16:35:53.538 INFO  [Thread-16-$mastercoord-bg0][executor] Deactivating spout $mastercoord-bg0:(1)\n    2015-05-04 16:35:54.130 INFO  [Thread-12-spout0][RecollectSpout] batchId <46244> end\n    2015-05-04 16:35:54.130 INFO  [Thread-12-spout0][RecollectSpout] batchId <46254> start\n    ...\n    2015-05-04 16:36:10.153 INFO  [Thread-12-spout0][RecollectSpout] batchId <46262> start\n    ...\n    2015-05-04 16:36:12.297 INFO  [Thread-12-spout0][RecollectSpout] batchId <46262> end\n    ... no more batch emitted (46253 + 10 = 46263, no txid 46263 found)\n    ```\n    \n    >> activate\n    ```\n    2015-05-04 16:42:23.715 INFO  [Thread-16-$mastercoord-bg0][executor] Activating spout $mastercoord-bg0:(1)\n    ...\n    2015-05-04 16:42:23.721 INFO  [Thread-12-spout0][RecollectSpout] batchId <46263> start\n    2015-05-04 16:42:25.159 INFO  [Thread-12-spout0][RecollectSpout] batchId <46264> start\n    2015-05-04 16:42:27.162 INFO  [Thread-12-spout0][RecollectSpout] batchId <46265> start\n    ```\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/HeartSaVioR/storm STORM-794\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/542.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #542\n    \n----\ncommit 39aaa4c29242d42cd30097176d08d66bad99661d\nAuthor: Jungtaek Lim <kabhwan@gmail.com>\nDate:   2015-05-04T07:25:54Z\n\n    Modify Spout async loop to treat deactivate ASAP\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-04T07:54:56.378+0000","updated":"2015-05-04T07:54:56.378+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/14526403","id":"14526403","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on the pull request:\n\n    https://github.com/apache/storm/pull/542#issuecomment-98628505\n  \n    Kafka test failures again. Other things are OK.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-04T08:20:35.222+0000","updated":"2015-05-04T08:20:35.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/14569885","id":"14569885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on the pull request:\n\n    https://github.com/apache/storm/pull/542#issuecomment-108116505\n  \n    @ptgoetz @revans2 \n    I'd like you to take a look. Thanks!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-06-02T22:29:55.863+0000","updated":"2015-06-02T22:29:55.863+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/15001154","id":"15001154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/storm/pull/542#issuecomment-155917369\n  \n    @HeartSaVioR is this something you still want?  I like the idea of the change, and the code looks good, but we would need to upmerge.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-11T21:36:15.704+0000","updated":"2015-11-11T21:36:15.704+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/15001237","id":"15001237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on the pull request:\n\n    https://github.com/apache/storm/pull/542#issuecomment-155928236\n  \n    @revans2 \n    Yes, as I described to [JIRA issue](https://issues.apache.org/jira/browse/STORM-794?focusedCommentId=14526316&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14526316), MasterBatchCoordinator doesn't play well with async loop, since it  handles emitting batch independently. MasterBatchCoordinator could make pending tuple count always same to max spout pending in point of async loop's view, which makes async loop to never trigger deactivate.\n    I'll do upmerge and let you know. Thanks!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-11T22:22:20.665+0000","updated":"2015-11-11T22:22:20.665+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/15001353","id":"15001353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on the pull request:\n\n    https://github.com/apache/storm/pull/542#issuecomment-155947307\n  \n    @revans2 Upmerged.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-11T23:51:11.915+0000","updated":"2015-11-11T23:51:11.915+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/15002235","id":"15002235","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/storm/pull/542#issuecomment-156138322\n  \n    The changes look good to me and all of the tests pass so I am +1 for this.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-12T15:28:57.394+0000","updated":"2015-11-12T15:28:57.394+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/15002276","id":"15002276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/542\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-12T15:50:13.728+0000","updated":"2015-11-12T15:50:13.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12822915/comment/15002281","id":"15002281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Thanks [~kabhwan],\n\nI just merged this into master.  Thanks for the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2015-11-12T15:50:56.057+0000","updated":"2015-11-12T15:50:56.057+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-794/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2dkxz:"}}