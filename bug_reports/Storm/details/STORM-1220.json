{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12914613","self":"https://issues.apache.org/jira/rest/api/2/issue/12914613","key":"STORM-1220","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329843","id":"12329843","name":"1.0.0","archived":false,"released":true,"releaseDate":"2016-04-12"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-11-19T21:34:30.564+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 26 21:25:24 UTC 2015","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4311867_*|*_3_*:*_1_*:*_512957042_*|*_4_*:*_1_*:*_18881_*|*_6_*:*_2_*:*_89019664","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2015-11-26T21:25:43.676+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1220/watchers","watchCount":3,"isWatching":false},"created":"2015-11-19T21:00:36.247+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wheat9","name":"wheat9","key":"wheat9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haohui Mai","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-11-26T21:25:43.700+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Currently the kafka spout takes a {{ByteBuffer}} from Kafka. However, the serialization scheme takes a {{byte[]}} array as input. Therefore the current implementation copies the {{ByteBuffer}} to a new {{byte[]}} array in order to hook everything together.\n\nThis jira proposes to changes the interfaces of serialization scheme to avoid copying the data twice in the spout.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Avoid double copying in the Kafka spout","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wheat9","name":"wheat9","key":"wheat9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haohui Mai","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wheat9","name":"wheat9","key":"wheat9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haohui Mai","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15014428","id":"15014428","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user haohui opened a pull request:\n\n    https://github.com/apache/storm/pull/894\n\n    STORM-1220. Avoid double copying in the Kafka spout.\n\n    Currently the Kafka spout performs an extra copy for all payloads in Kafka when integrating with Storm. This PR proposes to avoid the extra copy to improve performance.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/haohui/storm STORM-1220\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/894.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #894\n    \n----\ncommit 0850c7a3059bec664524d842ea98aecc5e19889f\nAuthor: Haohui Mai <wheat9@apache.org>\nDate:   2015-11-19T21:32:20Z\n\n    STORM-1220. Avoid double copying in the Kafka spout.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-19T21:34:30.564+0000","updated":"2015-11-19T21:34:30.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15015195","id":"15015195","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/894#discussion_r45434875\n  \n    --- Diff: storm-core/src/jvm/backtype/storm/spout/RawScheme.java ---\n    @@ -18,11 +18,13 @@\n     package backtype.storm.spout;\n     \n     import backtype.storm.tuple.Fields;\n    +\n    +import java.nio.ByteBuffer;\n     import java.util.List;\n     import static backtype.storm.utils.Utils.tuple;\n     \n     public class RawScheme implements Scheme {\n    -    public List<Object> deserialize(byte[] ser) {\n    +    public List<Object> deserialize(ByteBuffer ser) {\n    --- End diff --\n    \n    Will this break the compatibility at the receiver ?. Earlier the tuple contained a `byte[]` and with the change it would contain a `ByteBuffer`.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-20T04:27:41.722+0000","updated":"2015-11-20T04:27:41.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15015197","id":"15015197","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/894#discussion_r45435067\n  \n    --- Diff: external/storm-kafka/src/jvm/storm/kafka/StringScheme.java ---\n    @@ -20,21 +20,23 @@\n     import backtype.storm.spout.Scheme;\n     import backtype.storm.tuple.Fields;\n     import backtype.storm.tuple.Values;\n    +import backtype.storm.utils.Utils;\n     \n     import java.io.UnsupportedEncodingException;\n    +import java.nio.ByteBuffer;\n     import java.util.List;\n     \n     public class StringScheme implements Scheme {\n     \n         public static final String STRING_SCHEME_KEY = \"str\";\n     \n    -    public List<Object> deserialize(byte[] bytes) {\n    +    public List<Object> deserialize(ByteBuffer bytes) {\n             return new Values(deserializeString(bytes));\n         }\n     \n    -    public static String deserializeString(byte[] string) {\n    +    public static String deserializeString(ByteBuffer string) {\n             try {\n    -            return new String(string, \"UTF-8\");\n    +            return new String(Utils.toByteArray(string), \"UTF-8\");\n    --- End diff --\n    \n    This would create a copy. If the ByteBuffer is array backed, you could use `ByteBuffer.array()` to avoid copy.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-20T04:32:19.698+0000","updated":"2015-11-20T04:32:19.698+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15015227","id":"15015227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user harshach commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/894#discussion_r45436089\n  \n    --- Diff: storm-core/src/jvm/backtype/storm/spout/RawScheme.java ---\n    @@ -18,11 +18,13 @@\n     package backtype.storm.spout;\n     \n     import backtype.storm.tuple.Fields;\n    +\n    +import java.nio.ByteBuffer;\n     import java.util.List;\n     import static backtype.storm.utils.Utils.tuple;\n     \n     public class RawScheme implements Scheme {\n    -    public List<Object> deserialize(byte[] ser) {\n    +    public List<Object> deserialize(ByteBuffer ser) {\n    --- End diff --\n    \n    @arunmahadevan it might but I don't seen any one using this apart from KafkaSpout\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-20T05:00:23.128+0000","updated":"2015-11-20T05:00:23.128+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15015237","id":"15015237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/894#discussion_r45436425\n  \n    --- Diff: storm-core/src/jvm/backtype/storm/spout/RawScheme.java ---\n    @@ -18,11 +18,13 @@\n     package backtype.storm.spout;\n     \n     import backtype.storm.tuple.Fields;\n    +\n    +import java.nio.ByteBuffer;\n     import java.util.List;\n     import static backtype.storm.utils.Utils.tuple;\n     \n     public class RawScheme implements Scheme {\n    -    public List<Object> deserialize(byte[] ser) {\n    +    public List<Object> deserialize(ByteBuffer ser) {\n    --- End diff --\n    \n    @harshach Actually I was referring to the receiver (the bolts) that might be currently doing something like `byte[] bytes = inputTuple.getBinaryByField(\"bytes\");` to get the data emitted from kafka spout. It appears that the `deserialize` method returns a tuple that wraps the input ByteBuffer which gets emitted.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-20T05:10:46.060+0000","updated":"2015-11-20T05:10:46.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15018983","id":"15018983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user harshach commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/894#discussion_r45529315\n  \n    --- Diff: storm-core/src/jvm/backtype/storm/spout/RawScheme.java ---\n    @@ -18,11 +18,13 @@\n     package backtype.storm.spout;\n     \n     import backtype.storm.tuple.Fields;\n    +\n    +import java.nio.ByteBuffer;\n     import java.util.List;\n     import static backtype.storm.utils.Utils.tuple;\n     \n     public class RawScheme implements Scheme {\n    -    public List<Object> deserialize(byte[] ser) {\n    +    public List<Object> deserialize(ByteBuffer ser) {\n    --- End diff --\n    \n    @arunmahadevan good point. we can use ByteBuffer.array() to have same signature.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-20T22:51:21.821+0000","updated":"2015-11-20T22:51:21.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15021154","id":"15021154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/894#discussion_r45563324\n  \n    --- Diff: external/storm-kafka/src/jvm/storm/kafka/StringScheme.java ---\n    @@ -20,23 +20,27 @@\n     import backtype.storm.spout.Scheme;\n     import backtype.storm.tuple.Fields;\n     import backtype.storm.tuple.Values;\n    +import backtype.storm.utils.Utils;\n     \n    -import java.io.UnsupportedEncodingException;\n    +import java.nio.ByteBuffer;\n    +import java.nio.charset.Charset;\n    +import java.nio.charset.StandardCharsets;\n     import java.util.List;\n     \n     public class StringScheme implements Scheme {\n    -\n    +    private static final Charset UTF8_CHARSET = StandardCharsets.UTF_8;\n         public static final String STRING_SCHEME_KEY = \"str\";\n     \n    -    public List<Object> deserialize(byte[] bytes) {\n    +    public List<Object> deserialize(ByteBuffer bytes) {\n             return new Values(deserializeString(bytes));\n         }\n     \n    -    public static String deserializeString(byte[] string) {\n    -        try {\n    -            return new String(string, \"UTF-8\");\n    -        } catch (UnsupportedEncodingException e) {\n    -            throw new RuntimeException(e);\n    +    public static String deserializeString(ByteBuffer string) {\n    +        if (!string.hasArray()) {\n    --- End diff --\n    \n    I think this should be `if (string.hasArray())`\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-22T19:40:17.938+0000","updated":"2015-11-22T19:40:17.938+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15021161","id":"15021161","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/894#discussion_r45563348\n  \n    --- Diff: external/storm-kafka/src/jvm/storm/kafka/StringScheme.java ---\n    @@ -20,23 +20,27 @@\n     import backtype.storm.spout.Scheme;\n     import backtype.storm.tuple.Fields;\n     import backtype.storm.tuple.Values;\n    +import backtype.storm.utils.Utils;\n     \n    -import java.io.UnsupportedEncodingException;\n    +import java.nio.ByteBuffer;\n    +import java.nio.charset.Charset;\n    +import java.nio.charset.StandardCharsets;\n     import java.util.List;\n     \n     public class StringScheme implements Scheme {\n    -\n    +    private static final Charset UTF8_CHARSET = StandardCharsets.UTF_8;\n         public static final String STRING_SCHEME_KEY = \"str\";\n     \n    -    public List<Object> deserialize(byte[] bytes) {\n    +    public List<Object> deserialize(ByteBuffer bytes) {\n             return new Values(deserializeString(bytes));\n         }\n     \n    -    public static String deserializeString(byte[] string) {\n    -        try {\n    -            return new String(string, \"UTF-8\");\n    -        } catch (UnsupportedEncodingException e) {\n    -            throw new RuntimeException(e);\n    +    public static String deserializeString(ByteBuffer string) {\n    +        if (!string.hasArray()) {\n    +            int base = string.arrayOffset();\n    +            return new String(string.array(), base + string.position(), base + string.limit());\n    --- End diff --\n    \n    `String` ctor takes length as the last arg, so you need to pass `limit - pos`. Also the charset is missing.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-22T19:42:54.996+0000","updated":"2015-11-22T19:42:54.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15023459","id":"15023459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user harshach commented on the pull request:\n\n    https://github.com/apache/storm/pull/894#issuecomment-159112473\n  \n    +1. @arunmahadevan can you take a look at it.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-24T00:24:04.248+0000","updated":"2015-11-24T00:24:04.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15023705","id":"15023705","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user arunmahadevan commented on the pull request:\n\n    https://github.com/apache/storm/pull/894#issuecomment-159140476\n  \n    Overall it looks good. I think https://github.com/apache/storm/pull/894#discussion_r45434875 should be addressed. Otherwise it may break existing bolts.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-24T03:28:30.477+0000","updated":"2015-11-24T03:28:30.477+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15027358","id":"15027358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user haohui commented on the pull request:\n\n    https://github.com/apache/storm/pull/894#issuecomment-159699064\n  \n    Addressed in the latest patch.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-25T18:48:26.140+0000","updated":"2015-11-25T18:48:26.140+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15027417","id":"15027417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user harshach commented on the pull request:\n\n    https://github.com/apache/storm/pull/894#issuecomment-159705658\n  \n    +1\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-25T19:18:35.170+0000","updated":"2015-11-25T19:18:35.170+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15027492","id":"15027492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/894\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-25T19:58:07.252+0000","updated":"2015-11-25T19:58:07.252+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15027498","id":"15027498","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user harshach commented on the pull request:\n\n    https://github.com/apache/storm/pull/894#issuecomment-159716347\n  \n    Thanks @haohui  merged into master.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-25T19:59:21.411+0000","updated":"2015-11-25T19:59:21.411+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15027561","id":"15027561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wheat9","name":"wheat9","key":"wheat9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haohui Mai","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the reviews and commits.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wheat9","name":"wheat9","key":"wheat9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haohui Mai","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-25T20:41:45.137+0000","updated":"2015-11-25T20:41:45.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12914613/comment/15029253","id":"15029253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Reopening to set fix version.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2015-11-26T21:25:24.809+0000","updated":"2015-11-26T21:25:24.809+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1220/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2onxj:"}}