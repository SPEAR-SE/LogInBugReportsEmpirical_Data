{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13002018","self":"https://issues.apache.org/jira/rest/api/2/issue/13002018","key":"STORM-2077","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2016-09-02T06:44:42.538+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Oct 19 14:07:47 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_26133104188_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-06-30T22:23:23.091+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2077/watchers","watchCount":8,"isWatching":false},"created":"2016-09-01T11:11:38.945+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335747","id":"12335747","name":"1.0.2","archived":false,"released":true,"releaseDate":"2016-08-10"}],"customfield_12312339":null,"issuelinks":[{"id":"12527478","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12527478","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"13004109","key":"STORM-2087","self":"https://issues.apache.org/jira/rest/api/2/issue/13004109","fields":{"summary":"Storm-kafka-client: Failed tuples are not always replayed ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12487934","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12487934","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"13024691","key":"STORM-2229","self":"https://issues.apache.org/jira/rest/api/2/issue/13024691","fields":{"summary":"KafkaSpout does not resend failed tuples","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-02-19T19:36:17.135+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12331080","id":"12331080","name":"storm-kafka-client"}],"timeoriginalestimate":null,"description":"KafkaSpout does not retry all failed tuples.\n\nWe used following Configuration:\n        Map<String, Object> props = new HashMap<>();\n        props.put(KafkaSpoutConfig.Consumer.GROUP_ID, \"c1\");\n        props.put(KafkaSpoutConfig.Consumer.KEY_DESERIALIZER, ByteArrayDeserializer.class.getName());\n        props.put(KafkaSpoutConfig.Consumer.VALUE_DESERIALIZER, ByteArrayDeserializer.class.getName());\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, broker.bootstrapServer());\n\n        KafkaSpoutStreams kafkaSpoutStreams = new KafkaSpoutStreams.Builder(FIELDS_KAFKA_EVENT, new String[]{\"test-topic\"}).build();\n\n        KafkaSpoutTuplesBuilder<byte[], byte[]> kafkaSpoutTuplesBuilder = new KafkaSpoutTuplesBuilder.Builder<>(new KeyValueKafkaSpoutTupleBuilder(\"test-topic\")).build();\n        KafkaSpoutRetryService retryService = new KafkaSpoutLoggedRetryExponentialBackoff(KafkaSpoutLoggedRetryExponentialBackoff.TimeInterval.milliSeconds(1), KafkaSpoutLoggedRetryExponentialBackoff.TimeInterval.milliSeconds(1), 3, KafkaSpoutLoggedRetryExponentialBackoff.TimeInterval.seconds(1));\n\n        KafkaSpoutConfig<byte[], byte[]> config = new KafkaSpoutConfig.Builder<>(props, kafkaSpoutStreams, kafkaSpoutTuplesBuilder, retryService)\n                .setFirstPollOffsetStrategy(UNCOMMITTED_LATEST)\n                .setMaxUncommittedOffsets(30)\n                .setOffsetCommitPeriodMs(10)\n                .setMaxRetries(3)\n                .build();\n\nkafkaSpout = new org.apache.storm.kafka.spout.KafkaSpout<>(config);\n\n\nThe downstream bolt fails every tuple and we expect, that those tuple will all be replayed. But that's not the case for every tuple.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"KafkaSpout doesn't retry failed tuples","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tobiasmaier","name":"tobiasmaier","key":"tobiasmaier","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tobias Maier","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tobiasmaier","name":"tobiasmaier","key":"tobiasmaier","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tobias Maier","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/15457702","id":"15457702","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mauzhang","name":"mauzhang","key":"mauzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manu Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~tobiasmaier], have you turned on acker ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mauzhang","name":"mauzhang","key":"mauzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manu Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-09-02T06:44:42.538+0000","updated":"2016-09-02T06:44:42.538+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/15708652","id":"15708652","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=db3f","name":"db3f","key":"db3f","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthias Klein","active":true,"timeZone":"Etc/UTC"},"body":"The problem seems to be the following piece of code:\n\n{code}\npublic class KafkaSpout<K, V> extends BaseRichSpout {\n//...\nprivate void doSeekRetriableTopicPartitions() {\n//...\n           if (offsetAndMeta != null) {\n                kafkaConsumer.seek(rtp, offsetAndMeta.offset() + 1);  // seek to the next offset that is ready to commit in next commit cycle\n            } else {\n                kafkaConsumer.seekToEnd(toArrayList(rtp));    // Seek to last committed offset <-- Indeed seeks to end of partition\n            }\n{code}\n\nHowever, this code seeks to the end of the partition, not to the last committed offset. The following change seems to repair the issue:\n\n{code}\n           if (offsetAndMeta != null) {\n                kafkaConsumer.seek(rtp, offsetAndMeta.offset() + 1);  // seek to the next offset that is ready to commit in next commit cycle\n            } else {\n                OffsetAndMetadata committed = kafkaConsumer.committed(rtp);\n                if(committed == null) { \n                   // Nothing yet committed\n                    kafkaConsumer.seekToBeginning(toArrayList(rtp));\n                } else {\n                    // seek to entry after last committed offset\n                    kafkaConsumer.seek(rtp, committed.offset() + 1);\n                }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=db3f","name":"db3f","key":"db3f","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthias Klein","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-30T13:52:49.301+0000","updated":"2016-11-30T13:54:02.203+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/15711113","id":"15711113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=db3f","name":"db3f","key":"db3f","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthias Klein","active":true,"timeZone":"Etc/UTC"},"body":"By the way: this issue is not assigned to the right component: it should be storm-kafka-client. Opening a new Issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=db3f","name":"db3f","key":"db3f","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthias Klein","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-01T06:59:55.901+0000","updated":"2016-12-01T06:59:55.901+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/15712237","id":"15712237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asmaier","name":"asmaier","key":"asmaier","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Maier","active":true,"timeZone":"Etc/UTC"},"body":"Is this ticket related to STORM-2087 ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asmaier","name":"asmaier","key":"asmaier","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andreas Maier","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-01T15:22:28.478+0000","updated":"2016-12-01T15:22:28.478+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/15712731","id":"15712731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ptgoetz","name":"ptgoetz","key":"ptgoetz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"P. Taylor Goetz","active":true,"timeZone":"America/Havana"},"body":"Quoting [~db3f] from STORM-2229 (provides additional detail on a proposed fix):\n\nWhen the topology fails a tuple, it is never resent by the KafkaSpout. This can easily be shown by constructing a small topology failing every tuple.\n\nApparent reason:\n\n{code}\npublic class KafkaSpout<K, V> extends BaseRichSpout {\n//...\nprivate void doSeekRetriableTopicPartitions() {\n        final Set<TopicPartition> retriableTopicPartitions = retryService.retriableTopicPartitions();\n\n        for (TopicPartition rtp : retriableTopicPartitions) {\n            final OffsetAndMetadata offsetAndMeta = acked.get(rtp).findNextCommitOffset();\n            if (offsetAndMeta != null) {\n                kafkaConsumer.seek(rtp, offsetAndMeta.offset() + 1);  // seek to the next offset that is ready to commit in next commit cycle\n            } else {\n                kafkaConsumer.seekToEnd(toArrayList(rtp));    // Seek to last committed offset <== Does seek to end of partition\n            }\n        }\n    }\n{code}\n\nThe code seeks to the end of the partition instead of seeking to the first uncommited offset.\n\nPreliminary fix (worked for me, but needs to be checked by an expert)\n\n{code}\n    private void doSeekRetriableTopicPartitions() {\n        final Set<TopicPartition> retriableTopicPartitions = retryService.retriableTopicPartitions();\n\n        for (TopicPartition rtp : retriableTopicPartitions) {\n            final OffsetAndMetadata offsetAndMeta = acked.get(rtp).findNextCommitOffset();\n            if (offsetAndMeta != null) {\n                kafkaConsumer.seek(rtp, offsetAndMeta.offset() + 1);  // seek to the next offset that is ready to commit in next commit cycle\n            } else {\n                OffsetAndMetadata committed = kafkaConsumer.committed(rtp);\n                if(committed == null) {\n                    // No offsets commited yet for this partition - start from beginning \n                    kafkaConsumer.seekToBeginning(toArrayList(rtp));\n                } else {\n                   // Seek to first uncommitted offset\n                    kafkaConsumer.seek(rtp, committed.offset() + 1);\n                }\n            }\n        }\n    }\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ptgoetz","name":"ptgoetz","key":"ptgoetz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"P. Taylor Goetz","active":true,"timeZone":"America/Havana"},"created":"2016-12-01T18:47:44.431+0000","updated":"2016-12-01T18:47:44.431+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/15725148","id":"15725148","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liurenjie1024","name":"liurenjie1024","key":"liurenjie1024","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Renjie Liu","active":true,"timeZone":"Asia/Chongqing"},"body":"I think the patch is incorrect since the consumer has already seeked to the correct position in the ConsumerRebalanceListener. If the committed is not found, we should just ignore the this partition.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liurenjie1024","name":"liurenjie1024","key":"liurenjie1024","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Renjie Liu","active":true,"timeZone":"Asia/Chongqing"},"created":"2016-12-06T10:53:33.713+0000","updated":"2016-12-06T10:53:33.713+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/15725900","id":"15725900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=childnode","name":"childnode","key":"childnode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=childnode&avatarId=16263","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=childnode&avatarId=16263","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=childnode&avatarId=16263","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=childnode&avatarId=16263"},"displayName":"Marcel \"childNo͡.de\" Trautwein","active":true,"timeZone":"Europe/Berlin"},"body":"Just to throw some attention at: open / pending Pull-Request from (possible dup) STORM-2087 :\nhttps://github.com/apache/storm/pull/1679\n\nPerhaps the patch above is no (more) needed but the PR should be forced","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=childnode","name":"childnode","key":"childnode","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=childnode&avatarId=16263","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=childnode&avatarId=16263","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=childnode&avatarId=16263","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=childnode&avatarId=16263"},"displayName":"Marcel \"childNo͡.de\" Trautwein","active":true,"timeZone":"Europe/Berlin"},"created":"2016-12-06T16:01:52.476+0000","updated":"2016-12-06T16:01:52.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/15728427","id":"15728427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=db3f","name":"db3f","key":"db3f","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthias Klein","active":true,"timeZone":"Etc/UTC"},"body":"As ist stands, the currenmt Version in git has a different patch for this: \n\n{code}\n    kafkaConsumer.seek(rtp, acked.get(rtp).committedOffset + 1);\n{code}\n \nIm going to test the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=db3f","name":"db3f","key":"db3f","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthias Klein","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-07T10:43:38.206+0000","updated":"2016-12-07T10:43:38.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/15735033","id":"15735033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=db3f","name":"db3f","key":"db3f","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthias Klein","active":true,"timeZone":"Etc/UTC"},"body":"The current fix works form me. As far as I am concerned, this issue could be closed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=db3f","name":"db3f","key":"db3f","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthias Klein","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-09T11:18:49.736+0000","updated":"2016-12-09T11:18:49.736+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13002018/comment/16211085","id":"16211085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apiwoni","name":"apiwoni","key":"apiwoni","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andre Piwoni","active":true,"timeZone":"Etc/UTC"},"body":"I think this solution provides alternative way to set offset but there's nothing wrong with seekToEnd because it probably worked as designed and here's why. seekToEnd uses OffsetResetStrategy.LATEST to set end offset and what this means is that if there's an offset maintained for the consumer partition by Kafka (Zookeeper or special Kafka topic called consumer_offsets) then seekToEnd goes to latest committed offset; otherwise when there's no existing consumer offset it goes to the end of partition. There are many ways that Kafka can loose tracking of consumer offsets but you can verify it by setting expire offset parameter to some ridiculously short period. This is probably what happened.\r\nThe alternative solution also works because it sets offset explicity and I hope out of range cases are handled.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apiwoni","name":"apiwoni","key":"apiwoni","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andre Piwoni","active":true,"timeZone":"Etc/UTC"},"created":"2017-10-19T14:07:47.635+0000","updated":"2017-10-19T14:07:47.635+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2077/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i334mv:"}}