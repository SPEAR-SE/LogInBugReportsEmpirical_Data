{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12860803","self":"https://issues.apache.org/jira/rest/api/2/issue/12860803","key":"STORM-1022","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-10-19T11:09:59.398+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Nov 02 07:53:24 UTC 2016","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1022/watchers","watchCount":4,"isWatching":false},"created":"2015-08-31T21:03:19.381+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-11-02T08:17:27.347+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"We upgraded to 0.9.5 ando ran into the following exception. The supervisors did go down:\n\n1 caution in our upgrade is we started a new nimbus, without any supervisors attached. Then we deployed topologies (from CICD). Next we build new supervisors and the supervisors will start on startup. However, in between the network service is restarted (due to hostname changed during the build <- chef). Just wanna throw this out in case this makes a difference.\n\nIn other word, it could be that supervisors started, picked up work,  then network restarted. \n\n{code}\nSEVERE: RuntimeException while executing runnable org.apache.storm.guava.util.concurrent.Futures$4@445058b with executor org.apache.storm.guava.util.concurrent.MoreExecutors$SameThreadExecutorService@691bc565\njava.lang.RuntimeException: Failed to connect to Netty-Client-usw2b-grunt-drone32-prod.amz.relateiq.com/10.30.103.202:6700\nat backtype.storm.messaging.netty.Client.connect(Client.java:308)\nat backtype.storm.messaging.netty.Client.access$1100(Client.java:78)\nat backtype.storm.messaging.netty.Client$2.reconnectAgain(Client.java:297)\nat backtype.storm.messaging.netty.Client$2.onSuccess(Client.java:283)\nat backtype.storm.messaging.netty.Client$2.onSuccess(Client.java:275)\nat org.apache.storm.guava.util.concurrent.Futures$4.run(Futures.java:1181)\nat org.apache.storm.guava.util.concurrent.MoreExecutors$SameThreadExecutorService.execute(MoreExecutors.java:297)\nat org.apache.storm.guava.util.concurrent.ExecutionList.executeListener(ExecutionList.java:156)\nat org.apache.storm.guava.util.concurrent.ExecutionList.execute(ExecutionList.java:145)\nat org.apache.storm.guava.util.concurrent.ListenableFutureTask.done(ListenableFutureTask.java:91)\nat java.util.concurrent.FutureTask.finishCompletion(FutureTask.java:384)\nat java.util.concurrent.FutureTask.set(FutureTask.java:233)\nat java.util.concurrent.FutureTask.run(FutureTask.java:274)\nat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\nat java.util.concurrent.FutureTask.run(FutureTask.java:266)\nat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\nat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\nat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.RuntimeException: Giving up to connect to Netty-Client-usw2b-grunt-drone32-prod.amz.relateiq.com/10.30.103.202:6700 after 102 failed attempts\nat backtype.storm.messaging.netty.Client.connect(Client.java:303)\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"disconnectiong between workers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cywjackson","name":"cywjackson","key":"cywjackson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jackson Chung","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cywjackson","name":"cywjackson","key":"cywjackson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jackson Chung","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12860803/comment/14963167","id":"14963167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaihind213","name":"jaihind213","key":"jaihind213","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"vishnu rao","active":true,"timeZone":"Etc/UTC"},"body":"I came across the same exception while using STORM  '0.10.0.2.3.0.0-2557' in hortonworks data plaform 2.3.\n\nBefore this exception hits, a runtime exception was thrown which resulted in supervisor restarting workers , there by leading to \n'SEVERE: RuntimeException while executing runnable org.apache.storm.guava.util.concurrent.Futures'. \n\nHere is my scenario:\n\n(1) i have registered a metrics consumer for my topology:\nconf.registerMetricsConsumer(NewRelicMetricConsumer.class,10);\n\n(2) the topology starts off  (in the example below at 2015-10-19T06:53)\n2015-10-19T06:53:17.757-0400 b.s.d.supervisor [INFO] 6afff1fd-4741-49a8-bd38-769146e28d81 still hasn't started\n\n(3) The metrics consumer threw a Runtime exception which results in storm \"Async loop died\" and 'Worker died'\n-----------------------------------------------------------------------------------------------\n015-10-19 06:54:31 b.s.util [ERROR] Async loop died!\njava.lang.RuntimeException: java.lang.ClassCastException: java.util.HashMap cannot be cast to java.lang.Number\n\tat backtype.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:128) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.utils.DisruptorQueue.consumeBatchWhenAvailable(DisruptorQueue.java:99) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.disruptor$consume_batch_when_available.invoke(disruptor.clj:80) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.daemon.executor$fn__7014$fn__7027$fn__7078.invoke(executor.clj:808) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.util$async_loop$fn__545.invoke(util.clj:475) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat clojure.lang.AFn.run(AFn.java:22) [clojure-1.6.0.jar:na]\n\tat java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]\nCaused by: java.lang.ClassCastException: java.util.HashMap cannot be cast to java.lang.Number\n\tat com.pocketmath.nebula.metric.storm.NewRelicMetricConsumer.handleDataPoints(NewRelicMetricConsumer.java:55) ~[stormjar.jar:na]\n\tat backtype.storm.metric.MetricsConsumerBolt.execute(MetricsConsumerBolt.java:55) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.daemon.executor$fn__7014$tuple_action_fn__7016.invoke(executor.clj:670) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.daemon.executor$mk_task_receiver$fn__6937.invoke(executor.clj:426) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.disruptor$clojure_handler$reify__6513.onEvent(disruptor.clj:58) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:125) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\t... 6 common frames omitted\n2015-10-19 06:54:31 b.s.d.executor [ERROR] \njava.lang.RuntimeException: java.lang.ClassCastException: java.util.HashMap cannot be cast to java.lang.Number\n\tat backtype.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:128) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.utils.DisruptorQueue.consumeBatchWhenAvailable(DisruptorQueue.java:99) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.disruptor$consume_batch_when_available.invoke(disruptor.clj:80) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.daemon.executor$fn__7014$fn__7027$fn__7078.invoke(executor.clj:808) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.util$async_loop$fn__545.invoke(util.clj:475) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat clojure.lang.AFn.run(AFn.java:22) [clojure-1.6.0.jar:na]\n\tat java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]\nCaused by: java.lang.ClassCastException: java.util.HashMap cannot be cast to java.lang.Number\n\tat com.test.metric.storm.NewRelicMetricConsumer.handleDataPoints(NewRelicMetricConsumer.java:55) ~[stormjar.jar:na]\n\tat backtype.storm.metric.MetricsConsumerBolt.execute(MetricsConsumerBolt.java:55) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.daemon.executor$fn__7014$tuple_action_fn__7016.invoke(executor.clj:670) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.daemon.executor$mk_task_receiver$fn__6937.invoke(executor.clj:426) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.disruptor$clojure_handler$reify__6513.onEvent(disruptor.clj:58) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\tat backtype.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:125) ~[storm-core-0.10.0.2.3.0.0-2557.jar:0.10.0.2.3.0.0-2557]\n\t... 6 common frames omitted\n-----------------------------------------------------------------------------------------------\n\n(3) the supervisor detects death and re-launches worker\n\n2015-10-19T06:54:42.557-0400 b.s.d.supervisor [INFO] Worker Process 6afff1fd-4741-49a8-bd38-769146e28d81 has died!\n2015-10-19T06:54:42.557-0400 b.s.d.supervisor [INFO] Shutting down and clearing state for id 6afff1fd-4741-49a8-bd38-769146e28d81. Current supervisor time: 1445252082. State: :timed-out, Heartbeat: {:time-secs 1445252079, :storm-id \"ambari_test3-27-1445251979\", :executors [[41 41] [33 33] [1 1] [53 53] [65 65] [9 9] [57 57] [-1 -1] [61 61] [13 13] [21 21] [5 5] [29 29] [45 45] [37 37] [25 25] [49 49] [17 17]], :port 6700}\n2015-10-19T06:54:42.557-0400 b.s.d.supervisor [INFO] Shutting down 5f60d8c8-4895-4dab-ae04-709434648e26:6afff1fd-4741-49a8-bd38-769146e28d81——\n\n2015-10-19T06:54:43.567-0400 b.s.d.supervisor [INFO] Launching worker with command: ..........................\n\n-----------------------------------------------------------------------------------------------\n(4) moments later as we wait for worker startup.. we get the exception:\n\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:Oct 19, 2015 7:03:15 AM org.apache.storm.guava.util.concurrent.ExecutionList executeListener\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:SEVERE: RuntimeException while executing runnable org.apache.storm.guava.util.concurrent.Futures$4@3bdb38ba with executor org.apache.storm.guava.util.concurrent.MoreExecutors$SameThreadExecutorService@351cd1b1\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:java.lang.RuntimeException: Failed to connect to Netty-Client-ip-10-5-xx.xxxx/10.5.xx.xxx:6701\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at backtype.storm.messaging.netty.Client.connect(Client.java:300)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at backtype.storm.messaging.netty.Client.access$1100(Client.java:66)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at backtype.storm.messaging.netty.Client$2.reconnectAgain(Client.java:289)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at backtype.storm.messaging.netty.Client$2.onSuccess(Client.java:275)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at backtype.storm.messaging.netty.Client$2.onSuccess(Client.java:267)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at org.apache.storm.guava.util.concurrent.Futures$4.run(Futures.java:1181)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at org.apache.storm.guava.util.concurrent.MoreExecutors$SameThreadExecutorService.execute(MoreExecutors.java:297)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at org.apache.storm.guava.util.concurrent.ExecutionList.executeListener(ExecutionList.java:156)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at org.apache.storm.guava.util.concurrent.ExecutionList.execute(ExecutionList.java:145)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at org.apache.storm.guava.util.concurrent.ListenableFutureTask.done(ListenableFutureTask.java:91)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.util.concurrent.FutureTask.finishCompletion(FutureTask.java:384)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.util.concurrent.FutureTask.set(FutureTask.java:233)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.util.concurrent.FutureTask.run(FutureTask.java:274)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at java.lang.Thread.run(Thread.java:745)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:Caused by: java.lang.RuntimeException: Giving up to connect to Netty-Client-ip-10-5-xx.xxxx/10.5.xx.xxx:6701 after 32 failed attempts\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       at backtype.storm.messaging.netty.Client.connect(Client.java:295)\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:       ... 19 more\n2015-10-19T07:03:15.557-0400 b.s.util [WARN] Worker Process cf9fc058-0bda-40f7-8450-cb9037cb05c3:\n2015-10-19T07:03:41.748-0400 b.s.d.supervisor [INFO] Worker Process 4366cfef-65fa-4385-b36a-eb4c272f4324 exited with code: 20\n2015-10-19T07:03:42.611-0400 b.s.d.supervisor [INFO] Worker Process 4366cfef-65fa-4385-b36a-eb4c272f4324 has died!\n2015-10-19T07:03:42.611-0400 b.s.d.supervisor [INFO] Shutting down and clearing state for id 4366cfef-65fa-4385-b36a-eb4c272f4324. Current supervisor time: 1445252622. State: :timed-out, Heartbeat: {:time-secs 1445252620, :storm-id \"ambari_test3-27-1445251979\", :executors [[47 47] [7 7] [51 51] [3 3] [39 39] [35 35] [43 43] [63 63] [23 23] [11 11] [31 31] [-1 -1] [55 55] [19 19] [27 27] [59 59] [15 15]], :port 6701}\n\n------------------------\n\nOn disabling my buggy metrics consumer, the exception no longer appeared.\n\nHope this helps.\n\n---\nVishnu Rao","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaihind213","name":"jaihind213","key":"jaihind213","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"vishnu rao","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-19T11:09:59.398+0000","updated":"2015-10-19T11:09:59.398+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12860803/comment/14963324","id":"14963324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"[~jaihind213],\n\nThe error you are reporting looks like it is caused by code that is not a part of storm.\n```at com.pocketmath.nebula.metric.storm.NewRelicMetricConsumer.handleDataPoints(NewRelicMetricConsumer.java:55)```\n\nI'm not sure exactly who is providing that to you.  It could be that we have changed one of the metrics in a non-compatible way, but I cannot tell from just the stack trace.  I might be able to tell if I had the source code to NewRelicMetricConsumer.java.\n\nDo you have any more information on this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2015-10-19T13:47:27.008+0000","updated":"2015-10-19T13:47:27.008+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12860803/comment/14963506","id":"14963506","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaihind213","name":"jaihind213","key":"jaihind213","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"vishnu rao","active":true,"timeZone":"Etc/UTC"},"body":"hi Robert,\n\nThe Stack trace provided is of the Metric Consumer I registered with storm.\ni.e. \"at com.pocketmath.nebula.metric.storm.NewRelicMetricConsumer.handleDataPoints(NewRelicMetricConsumer.java:55)`\" belongs to my metric consumer code.\n\nThe metric consumer code threw a Runtime exception which resulted in the worker dying and supervisor trying to restart it.\n\nIn my Scenario, the Metric Consumer threw the Runtime exception and that lead to the main exception reported in the description.\n\nAny Metric Consumer which throws a runtime exception should lead to this scenario.\n\n-vishnu rao","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaihind213","name":"jaihind213","key":"jaihind213","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"vishnu rao","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-19T15:57:31.964+0000","updated":"2015-10-19T15:57:31.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12860803/comment/14963534","id":"14963534","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Yes exactly.  I'm not really sure how that relates to this JIRA which is a network disconnection happening between workers, possibly when the remote worker was restarted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2015-10-19T16:09:03.485+0000","updated":"2015-10-19T16:09:03.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12860803/comment/14963542","id":"14963542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaihind213","name":"jaihind213","key":"jaihind213","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"vishnu rao","active":true,"timeZone":"Etc/UTC"},"body":"hi Robert,\n\nthe scenario i mentioned lead to the same exception mentioned in this jira\n\nhence i wanted to share this scenario too, but in my case the worker died.\n\n-vishnu","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaihind213","name":"jaihind213","key":"jaihind213","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"vishnu rao","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-19T16:14:34.407+0000","updated":"2015-10-19T16:14:34.407+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12860803/comment/15628118","id":"15628118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=howardhl","name":"howardhl","key":"howardhl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Howard Lee","active":true,"timeZone":"Asia/Shanghai"},"body":"Recently we meet the same problem caused by Netty after several times retrial except that It's not caused by supervisor but worker them selfs.\n{quote}\n2016-10-24T17:12:05.981+0800 STDIO [ERROR] Oct 24, 2016 5:12:05 PM org.apache.storm.guava.util.concurrent.ExecutionList executeListener\nSEVERE: RuntimeException while executing runnable org.apache.storm.guava.util.concurrent.Futures$4@43f31edc with executor org.apache.storm.guava.util.concurrent.MoreExecutors$SameThreadExecutorService@e6f205e\njava.lang.RuntimeException: Failed to connect to Netty-Client-xxx/xx.xx.xx.173:6721\n        at backtype.storm.messaging.netty.Client.connect(Client.java:308)\n        at backtype.storm.messaging.netty.Client.access$1100(Client.java:78)\n        at backtype.storm.messaging.netty.Client$2.reconnectAgain(Client.java:297)\n        at backtype.storm.messaging.netty.Client$2.onSuccess(Client.java:283)\n        at backtype.storm.messaging.netty.Client$2.onSuccess(Client.java:275)\n        at org.apache.storm.guava.util.concurrent.Futures$4.run(Futures.java:1181)\n        at org.apache.storm.guava.util.concurrent.MoreExecutors$SameThreadExecutorService.execute(MoreExecutors.java:297)\n        at org.apache.storm.guava.util.concurrent.ExecutionList.executeListener(ExecutionList.java:156)\n        at org.apache.storm.guava.util.concurrent.ExecutionList.execute(ExecutionList.java:145)\n        at org.apache.storm.guava.util.concurrent.ListenableFutureTask.done(ListenableFutureTask.java:91)\n        at java.util.concurrent.FutureTask$Sync.innerSet(FutureTask.java:251)\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:439)\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:98)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:206)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.RuntimeException: Giving up to connect to Netty-Client-sd-bigdata-storm5-73-173.idc.vip.com/10.208.73.173:6721 after 12 failed attempts\n        at backtype.storm.messaging.netty.Client.connect(Client.java:303)\n        ... 20 more\n{quote}\nwhen workers start, they tried to connect each other. After several times retrial, one worker failed, and throw an *RuntimeException*. The *RuntimeException* is swallowed by guava, as shown in the error stack. The code is as following in ExecutionList.java line 154 in guava 16.0.1:\n{code:java}\nprivate static void executeListener(Runnable runnable, Executor executor) {\n    try {\n      executor.execute(runnable);\n    } catch (RuntimeException e) {\n      // Log it and keep going, bad runnable and/or executor.  Don't\n      // punish the other runnables if we're given a bad one.  We only\n      // catch RuntimeException because we want Errors to propagate up.\n      log.log(Level.SEVERE, \"RuntimeException while executing runnable \"\n          + runnable + \" with executor \" + executor, e);\n    }\n  }\n{code}\nThe RuntimeException will never been thrown to the timer thread of worker and thus will not cause the dead of the worker. And the worker will never try to reconnect again. The worker should die, so that supervisor will pull it up again——this won't happen if this bug exists.\nOur storm version is 0.9.4 . And I can see the storm 0.9.6 has removed guava in the code. So the problem was solved in new version of storm.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=howardhl","name":"howardhl","key":"howardhl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Howard Lee","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-11-02T07:53:24.889+0000","updated":"2016-11-02T08:17:26.833+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1022/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2jm7r:"}}