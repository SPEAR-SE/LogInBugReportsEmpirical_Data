{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13044946","self":"https://issues.apache.org/jira/rest/api/2/issue/13044946","key":"STORM-2371","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":12600,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false}],"aggregatetimespent":12600,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu May 04 00:35:11 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_6150267502_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-05-04T00:35:11.252+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2371/watchers","watchCount":1,"isWatching":false},"created":"2017-02-21T20:10:43.801+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rabaner","name":"rabaner","key":"rabaner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjan Banerjee","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-08-24T05:43:27.802+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327324","id":"12327324","name":"storm-eventhubs","description":"MS Azure Event Hubs Integration"}],"timeoriginalestimate":null,"description":"The existing AMQP client of eventhub is causing random issues like NPE on the client side after a period of inactivity. The proposal is to use the latest eventhub client library provided by Microsoft.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"3.5h","remainingEstimateSeconds":0,"timeSpentSeconds":12600},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Replace existing AMQP eventhub client with the lastest one from Microsoft eventhubs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rabaner","name":"rabaner","key":"rabaner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjan Banerjee","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rabaner","name":"rabaner","key":"rabaner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjan Banerjee","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":12600,"total":12600,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":12600,"total":12600,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/comment/15876813","id":"15876813","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rabaner","name":"rabaner","key":"rabaner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjan Banerjee","active":true,"timeZone":"Etc/UTC"},"body":"Created pull request \nhttps://github.com/apache/storm/pull/1951","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rabaner","name":"rabaner","key":"rabaner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjan Banerjee","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-21T21:57:22.040+0000","updated":"2017-02-21T21:57:22.040+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/comment/15876825","id":"15876825","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rabaner","name":"rabaner","key":"rabaner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjan Banerjee","active":true,"timeZone":"Etc/UTC"},"body":"cc [~rperi] [~ptgoetz]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rabaner","name":"rabaner","key":"rabaner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjan Banerjee","active":true,"timeZone":"Etc/UTC"},"created":"2017-02-21T22:02:47.843+0000","updated":"2017-02-21T22:02:47.843+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/comment/15995962","id":"15995962","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rabaner","name":"rabaner","key":"rabaner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjan Banerjee","active":true,"timeZone":"Etc/UTC"},"body":"PR merged on the main branch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rabaner","name":"rabaner","key":"rabaner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranjan Banerjee","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-04T00:35:11.288+0000","updated":"2017-05-04T00:35:11.288+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2371/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":23,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/37436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user rban1 opened a pull request:\n\n    https://github.com/apache/storm/pull/1951\n\n    STORM-2371 Implementing new eventhub driver\n\n    Changing the undelying receiver implementation with the latest Eventhub receiver\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/rban1/storm master\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/1951.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #1951\n    \n----\ncommit 098272d753f406754ad17f4ba3ecd6a08881d82c\nAuthor: Ranjan Banerjee <rabaner@microsoft.com>\nDate:   2017-02-21T21:51:16Z\n\n    Implementing new eventhub driver\n\n----\n","created":"2017-02-21T21:56:06.110+0000","updated":"2017-02-21T21:56:06.110+0000","started":"2017-02-21T21:56:06.110+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"37436","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/37610","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1951#discussion_r102767172\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/bolt/EventHubBolt.java ---\n    @@ -22,10 +22,8 @@\n     import org.slf4j.Logger;\n     import org.slf4j.LoggerFactory;\n     \n    -import com.microsoft.eventhubs.client.EventHubClient;\n    +import com.microsoft.azure.eventhubs.*;\n    --- End diff --\n    \n    >.*; [](start = 36, length = 3)\n    \n    nit: keep them expanded - usual pattern in OS is to specifically import\n","created":"2017-02-23T17:20:07.420+0000","updated":"2017-02-23T17:20:07.420+0000","started":"2017-02-23T17:20:07.418+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"37610","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/37611","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1951#discussion_r102768443\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/bolt/EventHubBolt.java ---\n    @@ -70,10 +69,9 @@ public void prepare(Map config, TopologyContext context,\n     \t\tlogger.info(\"creating sender: \" + boltConfig.getConnectionString()\n     \t\t\t\t+ \", \" + boltConfig.getEntityPath() + \", \" + myPartitionId);\n     \t\ttry {\n    -\t\t\tEventHubClient eventHubClient = EventHubClient.create(\n    -\t\t\t\t\tboltConfig.getConnectionString(),\n    -\t\t\t\t\tboltConfig.getEntityPath());\n    -\t\t\tsender = eventHubClient.createPartitionSender(myPartitionId);\n    +\t\t\tehClient = EventHubClient.createFromConnectionString(boltConfig.getConnectionString()).get();\n    --- End diff --\n    \n    >get [](start = 90, length = 3)\n    \n    use methods ending with sync(...) - which could return cleaner exception stacks\n","created":"2017-02-23T17:25:23.427+0000","updated":"2017-02-23T17:25:23.427+0000","started":"2017-02-23T17:25:23.427+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"37611","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/37612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1951#discussion_r102769617\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/bolt/EventHubBolt.java ---\n    @@ -84,12 +82,39 @@ public void prepare(Map config, TopologyContext context,\n     \t@Override\n     \tpublic void execute(Tuple tuple) {\n     \t\ttry {\n    -\t\t\tsender.send(boltConfig.getEventDataFormat().serialize(tuple));\n    +\t\t\tEventData sendEvent = new EventData(boltConfig.getEventDataFormat().serialize(tuple));\n    +\t\t\tif(boltConfig.getPartitionMode() && sender!=null)\n    +\t\t\t\tsender.send(sendEvent).get();\n    +\t\t\telse if(boltConfig.getPartitionMode() && sender==null)\n    +\t\t\t\tthrow new EventHubException(\"Sender is null\");\n    +\t\t\telse if(!boltConfig.getPartitionMode() && ehClient!=null)\n    +\t\t\t\tehClient.send(sendEvent).get();\n    +\t\t\telse if(!boltConfig.getPartitionMode() && ehClient==null)\n    +\t\t\t\tthrow new EventHubException(\"ehclient is null\");\n     \t\t\tcollector.ack(tuple);\n     \t\t} catch (EventHubException ex) {\n     \t\t\tcollector.reportError(ex);\n     \t\t\tcollector.fail(tuple);\n     \t\t}\n    +\t\tcatch (Exception e){\n    +\n    +\t\t}\n    --- End diff --\n    \n    Why catch-all ?\n    This could potentially make this bolt a blackhole :)\n","created":"2017-02-23T17:30:23.703+0000","updated":"2017-02-23T17:30:23.703+0000","started":"2017-02-23T17:30:23.703+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"37612","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/37613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1951#discussion_r102770531\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/EventHubReceiverImpl.java ---\n    @@ -65,24 +69,38 @@ public EventHubReceiverImpl(EventHubSpoutConfig config, String partitionId) {\n       }\n     \n       @Override\n    -  public void open(IEventHubFilter filter) throws EventHubException {\n    -    logger.info(\"creating eventhub receiver: partitionId=\" + partitionId + \n    -    \t\t\", filterString=\" + filter.getFilterString());\n    +  public void open(String offset) throws EventHubException {\n    +    logger.info(\"creating eventhub receiver: partitionId=\" + partitionId +\n    +            \", offset=\" + offset);\n         long start = System.currentTimeMillis();\n    -    receiver = new ResilientEventHubReceiver(connectionString, entityName,\n    -    \t\tpartitionId, consumerGroupName, defaultCredits, filter);\n    -    receiver.initialize();\n    -    \n    +    try {\n    +      ehClient = EventHubClient.createFromConnectionString(connectionString).get();\n    +      receiver = ehClient.createEpochReceiver(\n    +              consumerGroupName,\n    +              partitionId,\n    +              offset,\n    +              false,\n    +              1).get();\n    +    }catch (Exception e){\n    +      logger.info(\"Exception in creating EventhubClient\"+e.toString());\n    +    }\n         long end = System.currentTimeMillis();\n         logger.info(\"created eventhub receiver, time taken(ms): \" + (end-start));\n       }\n     \n       @Override\n    -  public void close() {\n    +  public void close(){\n         if(receiver != null) {\n    -      receiver.close();\n    +      try {\n    +        receiver.close().get();\n    --- End diff --\n    \n    >.get() [](start = 24, length = 6)\n    \n    if receiver.close() fails - this results into connection leak; handle this case. something like:\n    receiver.whenComplete(() -> { ehClient.closeSync() }).get();\n","created":"2017-02-23T17:34:07.553+0000","updated":"2017-02-23T17:34:07.553+0000","started":"2017-02-23T17:34:07.552+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"37613","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/37617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1951#discussion_r102773626\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/EventHubReceiverImpl.java ---\n    @@ -92,50 +110,34 @@ public boolean isOpen() {\n       }\n     \n       @Override\n    -  public EventData receive(long timeoutInMilliseconds) {\n    +  public EventData receive() {\n         long start = System.currentTimeMillis();\n    -    Message message = receiver.receive(timeoutInMilliseconds);\n    +    Iterable<com.microsoft.azure.eventhubs.EventData> receivedEvents=null;\n    +        /*Get one message at a time for backward compatibility behaviour*/\n    +    try {\n    +      receivedEvents = receiver.receive(1).get();\n    +    }catch (Exception e){\n    +      logger.error(\"Exception occured during receive\"+e.toString());\n    +    }\n         long end = System.currentTimeMillis();\n         long millis = (end - start);\n         receiveApiLatencyMean.update(millis);\n         receiveApiCallCount.incr();\n    -    \n    -    if (message == null) {\n    -      //Temporary workaround for AMQP/EH bug of failing to receive messages\n    -      /*if(timeoutInMilliseconds > 100 && millis < timeoutInMilliseconds/2) {\n    -        throw new RuntimeException(\n    -            \"Restart EventHubSpout due to failure of receiving messages in \"\n    -            + millis + \" millisecond\");\n    -      }*/\n    +    if (receivedEvents == null) {\n           return null;\n         }\n    -\n         receiveMessageCount.incr();\n    -\n    -    MessageId messageId = createMessageId(message);\n    -    return EventData.create(message, messageId);\n    -  }\n    -  \n    -  private MessageId createMessageId(Message message) {\n    -    String offset = null;\n    -    long sequenceNumber = 0;\n    -\n    -    for (Section section : message.getPayload()) {\n    -      if (section instanceof MessageAnnotations) {\n    -        MessageAnnotations annotations = (MessageAnnotations) section;\n    -        HashMap annonationMap = (HashMap) annotations.getValue();\n    -\n    -        if (annonationMap.containsKey(OffsetKey)) {\n    -          offset = (String) annonationMap.get(OffsetKey);\n    -        }\n    -\n    -        if (annonationMap.containsKey(SequenceNumberKey)) {\n    -          sequenceNumber = (Long) annonationMap.get(SequenceNumberKey);\n    -        }\n    -      }\n    +    MessageId messageId=null;\n    +    Message message=null;\n    +    for (com.microsoft.azure.eventhubs.EventData receivedEvent : receivedEvents) {\n    --- End diff --\n    \n    >for (com.microsoft.azure.eventhubs.EventData receivedEvent : receivedEvents) { [](start = 4, length = 78)\n    \n    Why ? In the receive(1) call above code - you explicitly specified receive 1 message - so remove this..\n","created":"2017-02-23T17:47:42.776+0000","updated":"2017-02-23T17:47:42.776+0000","started":"2017-02-23T17:47:42.776+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"37617","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/37619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1951#discussion_r102774770\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/EventHubReceiverImpl.java ---\n    @@ -92,50 +110,34 @@ public boolean isOpen() {\n       }\n     \n       @Override\n    -  public EventData receive(long timeoutInMilliseconds) {\n    +  public EventData receive() {\n         long start = System.currentTimeMillis();\n    -    Message message = receiver.receive(timeoutInMilliseconds);\n    +    Iterable<com.microsoft.azure.eventhubs.EventData> receivedEvents=null;\n    +        /*Get one message at a time for backward compatibility behaviour*/\n    +    try {\n    +      receivedEvents = receiver.receive(1).get();\n    +    }catch (Exception e){\n    +      logger.error(\"Exception occured during receive\"+e.toString());\n    +    }\n         long end = System.currentTimeMillis();\n         long millis = (end - start);\n         receiveApiLatencyMean.update(millis);\n         receiveApiCallCount.incr();\n    -    \n    -    if (message == null) {\n    -      //Temporary workaround for AMQP/EH bug of failing to receive messages\n    -      /*if(timeoutInMilliseconds > 100 && millis < timeoutInMilliseconds/2) {\n    -        throw new RuntimeException(\n    -            \"Restart EventHubSpout due to failure of receiving messages in \"\n    -            + millis + \" millisecond\");\n    -      }*/\n    +    if (receivedEvents == null) {\n           return null;\n         }\n    -\n         receiveMessageCount.incr();\n    -\n    -    MessageId messageId = createMessageId(message);\n    -    return EventData.create(message, messageId);\n    -  }\n    -  \n    -  private MessageId createMessageId(Message message) {\n    -    String offset = null;\n    -    long sequenceNumber = 0;\n    -\n    -    for (Section section : message.getPayload()) {\n    -      if (section instanceof MessageAnnotations) {\n    -        MessageAnnotations annotations = (MessageAnnotations) section;\n    -        HashMap annonationMap = (HashMap) annotations.getValue();\n    -\n    -        if (annonationMap.containsKey(OffsetKey)) {\n    -          offset = (String) annonationMap.get(OffsetKey);\n    -        }\n    -\n    -        if (annonationMap.containsKey(SequenceNumberKey)) {\n    -          sequenceNumber = (Long) annonationMap.get(SequenceNumberKey);\n    -        }\n    -      }\n    +    MessageId messageId=null;\n    +    Message message=null;\n    +    for (com.microsoft.azure.eventhubs.EventData receivedEvent : receivedEvents) {\n    +      messageId = new MessageId(partitionId,\n    +              receivedEvent.getSystemProperties().getOffset(),\n    +              receivedEvent.getSystemProperties().getSequenceNumber());\n    +      List<Section> body = new ArrayList<Section>();\n    +      body.add(new Data(new Binary((new String(receivedEvent.getBody(), Charset.defaultCharset())).getBytes())));\n    +      message = new Message(body);\n    --- End diff --\n    \n    This is not equivalent to the existing behavior. Message could have other amqp sections - ApplicationProperties and SystemProperties.\n    Ideally, you should return com.microsoft.azure.eventhubs.EventData. Please remove the EventData type created in the spout library - to eliminate confusion.\n","created":"2017-02-23T17:52:48.930+0000","updated":"2017-02-23T17:52:48.930+0000","started":"2017-02-23T17:52:48.930+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"37619","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/37620","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on the issue:\n\n    https://github.com/apache/storm/pull/1951\n  \n    :clock1:\n","created":"2017-02-23T17:54:33.702+0000","updated":"2017-02-23T17:54:33.702+0000","started":"2017-02-23T17:54:33.701+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"37620","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user rban1 opened a pull request:\n\n    https://github.com/apache/storm/pull/1985\n\n    STORM-2371: New eventhub implementation\n\n    Made the changes with the latest comments\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/rban1/storm eventhub1\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/1985.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #1985\n    \n----\ncommit e3545aa692673bd379d88d5009c2b8662a9817ec\nAuthor: Ranjan Banerjee <rabaner@microsoft.com>\nDate:   2017-03-03T03:28:49Z\n\n    STORM-2371: New eventhub implementation\n\n----\n","created":"2017-03-03T03:37:04.598+0000","updated":"2017-03-03T03:37:04.598+0000","started":"2017-03-03T03:37:04.598+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38119","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38139","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on the issue:\n\n    https://github.com/apache/storm/pull/1985\n  \n    I think you should push these changes back to your previous PR here https://github.com/apache/storm/pull/1951, otherwise it's hard to know which comments you're talking about. It also makes it harder for reviewers to know whether an issue has already been discussed.\n","created":"2017-03-03T14:50:16.998+0000","updated":"2017-03-03T14:50:16.998+0000","started":"2017-03-03T14:50:16.991+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38139","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38153","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user rban1 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104227737\n  \n    --- Diff: external/storm-eventhubs/pom.xml ---\n    @@ -95,6 +95,11 @@\n                 <version>${eventhubs.client.version}</version>\n             </dependency>\n             <dependency>\n    +            <groupId>com.microsoft.azure</groupId>\n    +            <artifactId>azure-eventhubs</artifactId>\n    +            <version>0.11.0</version>\n    --- End diff --\n    \n    make it a property\n","created":"2017-03-03T19:41:02.943+0000","updated":"2017-03-03T19:41:02.943+0000","started":"2017-03-03T19:41:02.941+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38153","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user rban1 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104228014\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/bolt/EventHubBolt.java ---\n    @@ -18,14 +18,16 @@\n     package org.apache.storm.eventhubs.bolt;\n     \n     import java.util.Map;\n    +import java.util.concurrent.ExecutionException;\n    --- End diff --\n    \n    order the imports\n","created":"2017-03-03T19:42:35.682+0000","updated":"2017-03-03T19:42:35.682+0000","started":"2017-03-03T19:42:35.681+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38154","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38157","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user rban1 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104231241\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/EventHubReceiverImpl.java ---\n    @@ -65,77 +60,80 @@ public EventHubReceiverImpl(EventHubSpoutConfig config, String partitionId) {\n       }\n     \n       @Override\n    -  public void open(IEventHubFilter filter) throws EventHubException {\n    -    logger.info(\"creating eventhub receiver: partitionId=\" + partitionId + \n    -    \t\t\", filterString=\" + filter.getFilterString());\n    +  public void open(String offset) throws EventHubException {\n    +    logger.info(\"creating eventhub receiver: partitionId=\" + partitionId +\n    +            \", offset=\" + offset);\n         long start = System.currentTimeMillis();\n    -    receiver = new ResilientEventHubReceiver(connectionString, entityName,\n    -    \t\tpartitionId, consumerGroupName, defaultCredits, filter);\n    -    receiver.initialize();\n    -    \n    +    try {\n    +      ehClient = EventHubClient.createFromConnectionStringSync(connectionString);\n    +      receiver = ehClient.createEpochReceiverSync(\n    +              consumerGroupName,\n    +              partitionId,\n    +              offset,\n    +              false,\n    +              1);\n    +    }catch (Exception e){\n    +      logger.info(\"Exception in creating EventhubClient\"+e.toString());\n    +    }\n         long end = System.currentTimeMillis();\n         logger.info(\"created eventhub receiver, time taken(ms): \" + (end-start));\n       }\n     \n       @Override\n    -  public void close() {\n    +  public void close(){\n         if(receiver != null) {\n    -      receiver.close();\n    +      try {\n    +        receiver.close().whenComplete((voidargs,error)->{\n    +          try{\n    +            if(error!=null){\n    +              logger.error(\"Exception during receiver close phase\"+error.toString());\n    +            }\n    +            ehClient.closeSync();\n    +          }catch (Exception e){\n    +            logger.error(\"Exception during ehclient close phase\"+e.toString());\n    +          }\n    +        }).get();\n    +      }catch (InterruptedException e){\n    +        logger.error(\"Exception occured during close phase\"+e.toString());\n    +      }catch (ExecutionException e){\n    +        logger.error(\"Exception occured during close phase\"+e.toString());\n    +      }\n           logger.info(\"closed eventhub receiver: partitionId=\" + partitionId );\n           receiver = null;\n    +      ehClient =  null;\n         }\n       }\n    +\n       \n       @Override\n       public boolean isOpen() {\n         return (receiver != null);\n       }\n     \n       @Override\n    -  public EventData receive(long timeoutInMilliseconds) {\n    +  public EventDataWrap receive() {\n         long start = System.currentTimeMillis();\n    -    Message message = receiver.receive(timeoutInMilliseconds);\n    +    Iterable<EventData> receivedEvents=null;\n    +    /*Get one message at a time for backward compatibility behaviour*/\n    +    try {\n    +      receivedEvents = receiver.receiveSync(1);\n    +    }catch (Exception e){\n    +      logger.error(\"Exception occured during receive\"+e.toString());\n    +    }\n         long end = System.currentTimeMillis();\n         long millis = (end - start);\n         receiveApiLatencyMean.update(millis);\n         receiveApiCallCount.incr();\n    -    \n    -    if (message == null) {\n    -      //Temporary workaround for AMQP/EH bug of failing to receive messages\n    -      /*if(timeoutInMilliseconds > 100 && millis < timeoutInMilliseconds/2) {\n    -        throw new RuntimeException(\n    -            \"Restart EventHubSpout due to failure of receiving messages in \"\n    -            + millis + \" millisecond\");\n    -      }*/\n    +    if (receivedEvents == null) {\n    --- End diff --\n    \n    check for length also\n","created":"2017-03-03T19:58:38.153+0000","updated":"2017-03-03T19:58:38.153+0000","started":"2017-03-03T19:58:38.153+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38157","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38178","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104280523\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/EventHubReceiverImpl.java ---\n    @@ -65,77 +60,80 @@ public EventHubReceiverImpl(EventHubSpoutConfig config, String partitionId) {\n       }\n     \n       @Override\n    -  public void open(IEventHubFilter filter) throws EventHubException {\n    -    logger.info(\"creating eventhub receiver: partitionId=\" + partitionId + \n    -    \t\t\", filterString=\" + filter.getFilterString());\n    +  public void open(String offset) throws EventHubException {\n    +    logger.info(\"creating eventhub receiver: partitionId=\" + partitionId +\n    +            \", offset=\" + offset);\n         long start = System.currentTimeMillis();\n    -    receiver = new ResilientEventHubReceiver(connectionString, entityName,\n    -    \t\tpartitionId, consumerGroupName, defaultCredits, filter);\n    -    receiver.initialize();\n    -    \n    +    try {\n    +      ehClient = EventHubClient.createFromConnectionStringSync(connectionString);\n    +      receiver = ehClient.createEpochReceiverSync(\n    +              consumerGroupName,\n    +              partitionId,\n    +              offset,\n    +              false,\n    +              1);\n    --- End diff --\n    \n    Please refrain from using catch all exceptions and move to catching more specific exceptions...\n","created":"2017-03-04T05:54:48.904+0000","updated":"2017-03-04T05:54:48.904+0000","started":"2017-03-04T05:54:48.902+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38178","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104280244\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/StringEventDataScheme.java ---\n    @@ -46,19 +39,11 @@\n       private static final long serialVersionUID = 1L;\n     \n       @Override\n    -  public List<Object> deserialize(Message message) {\n    +  public List<Object> deserialize(EventData eventData) {\n         final List<Object> fieldContents = new ArrayList<Object>();\n    -\n    -    for (Section section : message.getPayload()) {\n    -      if (section instanceof Data) {\n    -        Data data = (Data) section;\n    -        fieldContents.add(new String(data.getValue().getArray()));\n    -      } else if (section instanceof AmqpValue) {\n    -        AmqpValue amqpValue = (AmqpValue) section;\n    -        fieldContents.add(amqpValue.getValue().toString());\n    -      }\n    -    }\n    -    \n    +    String messageData = \"\";\n    +    messageData = new String (eventData.getBody(),eventData.getBodyOffset(),eventData.getBodyLength(),Charset.defaultCharset());\n    --- End diff --\n    \n    Add null check for getbody()\n","created":"2017-03-04T05:54:48.904+0000","updated":"2017-03-04T05:54:48.904+0000","started":"2017-03-04T05:54:48.902+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38177","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104280323\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/EventDataScheme.java ---\n    @@ -46,25 +42,11 @@\n     \tprivate static final long serialVersionUID = 1L;\n     \n     \t@Override\n    -\tpublic List<Object> deserialize(Message message) {\n    +\tpublic List<Object> deserialize(EventData eventData) {\n     \t\tfinal List<Object> fieldContents = new ArrayList<Object>();\n    -\n    -\t\tMap metaDataMap = new HashMap();\n     \t\tString messageData = \"\";\n    -\n    -\t\tfor (Section section : message.getPayload()) {\n    -\t\t\tif (section instanceof Data) {\n    -\t\t\t\tData data = (Data) section;\n    -\t\t\t\tmessageData = new String(data.getValue().getArray());\n    -\t\t\t} else if (section instanceof AmqpValue) {\n    -\t\t\t\tAmqpValue amqpValue = (AmqpValue) section;\n    -\t\t\t\tmessageData = amqpValue.getValue().toString();\n    -\t\t\t} else if (section instanceof ApplicationProperties) {\n    -\t\t\t\tfinal ApplicationProperties applicationProperties = (ApplicationProperties) section;\n    -\t\t\t\tmetaDataMap = applicationProperties.getValue();\n    -\t\t\t}\n    -\t\t}\n    -\n    +\t\tmessageData = new String (eventData.getBody(),eventData.getBodyOffset(),eventData.getBodyLength(),Charset.defaultCharset());\n    --- End diff --\n    \n    Null check getBody\n","created":"2017-03-04T05:54:48.904+0000","updated":"2017-03-04T05:54:48.904+0000","started":"2017-03-04T05:54:48.903+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38179","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user SreeramGarlapati commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104280360\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/EventDataScheme.java ---\n    @@ -46,25 +42,11 @@\n     \tprivate static final long serialVersionUID = 1L;\n     \n     \t@Override\n    -\tpublic List<Object> deserialize(Message message) {\n    +\tpublic List<Object> deserialize(EventData eventData) {\n     \t\tfinal List<Object> fieldContents = new ArrayList<Object>();\n    -\n    -\t\tMap metaDataMap = new HashMap();\n     \t\tString messageData = \"\";\n    -\n    -\t\tfor (Section section : message.getPayload()) {\n    -\t\t\tif (section instanceof Data) {\n    -\t\t\t\tData data = (Data) section;\n    -\t\t\t\tmessageData = new String(data.getValue().getArray());\n    -\t\t\t} else if (section instanceof AmqpValue) {\n    -\t\t\t\tAmqpValue amqpValue = (AmqpValue) section;\n    -\t\t\t\tmessageData = amqpValue.getValue().toString();\n    -\t\t\t} else if (section instanceof ApplicationProperties) {\n    -\t\t\t\tfinal ApplicationProperties applicationProperties = (ApplicationProperties) section;\n    -\t\t\t\tmetaDataMap = applicationProperties.getValue();\n    -\t\t\t}\n    -\t\t}\n    -\n    +\t\tmessageData = new String (eventData.getBody(),eventData.getBodyOffset(),eventData.getBodyLength(),Charset.defaultCharset());\n    --- End diff --\n    \n    The old code handles the case when AmqpValue is species as payload - if you need that support here - you will need to wait until 0.12.0\n    Refer to this pr for details : https://github.com/Azure/azure-event-hubs-java/pull/66\n","created":"2017-03-04T05:54:49.004+0000","updated":"2017-03-04T05:54:49.004+0000","started":"2017-03-04T05:54:49.004+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38180","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user rban1 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104561111\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/StringEventDataScheme.java ---\n    @@ -46,19 +39,11 @@\n       private static final long serialVersionUID = 1L;\n     \n       @Override\n    -  public List<Object> deserialize(Message message) {\n    +  public List<Object> deserialize(EventData eventData) {\n         final List<Object> fieldContents = new ArrayList<Object>();\n    -\n    -    for (Section section : message.getPayload()) {\n    -      if (section instanceof Data) {\n    -        Data data = (Data) section;\n    -        fieldContents.add(new String(data.getValue().getArray()));\n    -      } else if (section instanceof AmqpValue) {\n    -        AmqpValue amqpValue = (AmqpValue) section;\n    -        fieldContents.add(amqpValue.getValue().toString());\n    -      }\n    -    }\n    -    \n    +    String messageData = \"\";\n    +    messageData = new String (eventData.getBody(),eventData.getBodyOffset(),eventData.getBodyLength(),Charset.defaultCharset());\n    --- End diff --\n    \n    will do\n","created":"2017-03-07T00:30:49.546+0000","updated":"2017-03-07T00:30:49.546+0000","started":"2017-03-07T00:30:49.546+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38305","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38306","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user rban1 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104561293\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/EventDataScheme.java ---\n    @@ -46,25 +42,11 @@\n     \tprivate static final long serialVersionUID = 1L;\n     \n     \t@Override\n    -\tpublic List<Object> deserialize(Message message) {\n    +\tpublic List<Object> deserialize(EventData eventData) {\n     \t\tfinal List<Object> fieldContents = new ArrayList<Object>();\n    -\n    -\t\tMap metaDataMap = new HashMap();\n     \t\tString messageData = \"\";\n    -\n    -\t\tfor (Section section : message.getPayload()) {\n    -\t\t\tif (section instanceof Data) {\n    -\t\t\t\tData data = (Data) section;\n    -\t\t\t\tmessageData = new String(data.getValue().getArray());\n    -\t\t\t} else if (section instanceof AmqpValue) {\n    -\t\t\t\tAmqpValue amqpValue = (AmqpValue) section;\n    -\t\t\t\tmessageData = amqpValue.getValue().toString();\n    -\t\t\t} else if (section instanceof ApplicationProperties) {\n    -\t\t\t\tfinal ApplicationProperties applicationProperties = (ApplicationProperties) section;\n    -\t\t\t\tmetaDataMap = applicationProperties.getValue();\n    -\t\t\t}\n    -\t\t}\n    -\n    +\t\tmessageData = new String (eventData.getBody(),eventData.getBodyOffset(),eventData.getBodyLength(),Charset.defaultCharset());\n    --- End diff --\n    \n    Thanks. Is there any changes for now that you see in the serialization code that needs to be incorporated? Otherwise I will keep an eye for the 0.12.0 version and then incorporate AmqpValue also as a payload\n","created":"2017-03-07T00:32:08.492+0000","updated":"2017-03-07T00:32:08.492+0000","started":"2017-03-07T00:32:08.491+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38306","issueId":"13044946"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13044946/worklog/38307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user rban1 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1985#discussion_r104561334\n  \n    --- Diff: external/storm-eventhubs/src/main/java/org/apache/storm/eventhubs/spout/EventHubReceiverImpl.java ---\n    @@ -65,77 +60,80 @@ public EventHubReceiverImpl(EventHubSpoutConfig config, String partitionId) {\n       }\n     \n       @Override\n    -  public void open(IEventHubFilter filter) throws EventHubException {\n    -    logger.info(\"creating eventhub receiver: partitionId=\" + partitionId + \n    -    \t\t\", filterString=\" + filter.getFilterString());\n    +  public void open(String offset) throws EventHubException {\n    +    logger.info(\"creating eventhub receiver: partitionId=\" + partitionId +\n    +            \", offset=\" + offset);\n         long start = System.currentTimeMillis();\n    -    receiver = new ResilientEventHubReceiver(connectionString, entityName,\n    -    \t\tpartitionId, consumerGroupName, defaultCredits, filter);\n    -    receiver.initialize();\n    -    \n    +    try {\n    +      ehClient = EventHubClient.createFromConnectionStringSync(connectionString);\n    +      receiver = ehClient.createEpochReceiverSync(\n    +              consumerGroupName,\n    +              partitionId,\n    +              offset,\n    +              false,\n    +              1);\n    --- End diff --\n    \n    Will do\n","created":"2017-03-07T00:32:23.911+0000","updated":"2017-03-07T00:32:23.911+0000","started":"2017-03-07T00:32:23.911+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"38307","issueId":"13044946"}]},"customfield_12311820":"0|i3aean:"}}