{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12833459","self":"https://issues.apache.org/jira/rest/api/2/issue/12833459","key":"STORM-839","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12333021","id":"12333021","name":"0.9.6","archived":false,"released":true,"releaseDate":"2015-11-05"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-05-29T10:11:33.206+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 14 19:19:06 UTC 2015","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4074904821_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2015-07-14T19:19:06.885+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-839/watchers","watchCount":4,"isWatching":false},"created":"2015-05-28T15:24:02.101+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329548","id":"12329548","name":"0.9.4","archived":false,"released":true,"releaseDate":"2015-03-25"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eshioji","name":"eshioji","key":"eshioji","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Enno Shioji","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-05T01:31:09.097+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"See the thread dump below that shows the deadlock. client-worker-1 is holding 7b5a7fa5 and waiting on 1446a1e9. Thread-10-disruptor-worker-transfer-queue is holding 1446a1e9 and is waiting on 7b5a7fa5.\n\n(Thread dump is truncated to show only the relevant parts)\n\n2015-05-28 15:37:15\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (24.72-b04 mixed mode):\n\n\n\"Thread-10-disruptor-worker-transfer-queue\" - Thread t@52\n   java.lang.Thread.State: BLOCKED\n\tat org.apache.storm.netty.channel.socket.nio.AbstractNioWorker.cleanUpWriteBuffer(AbstractNioWorker.java:398)\n\t- waiting to lock <7b5a7fa5> (a java.lang.Object) owned by \"client-worker-1\" t@25\n\tat org.apache.storm.netty.channel.socket.nio.AbstractNioWorker.writeFromUserCode(AbstractNioWorker.java:128)\n\tat org.apache.storm.netty.channel.socket.nio.NioClientSocketPipelineSink.eventSunk(NioClientSocketPipelineSink.java:84)\n\tat org.apache.storm.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendDownstream(DefaultChannelPipeline.java:779)\n\tat org.apache.storm.netty.channel.Channels.write(Channels.java:725)\n\tat org.apache.storm.netty.handler.codec.oneone.OneToOneEncoder.doEncode(OneToOneEncoder.java:71)\n\tat org.apache.storm.netty.handler.codec.oneone.OneToOneEncoder.handleDownstream(OneToOneEncoder.java:59)\n\tat org.apache.storm.netty.channel.DefaultChannelPipeline.sendDownstream(DefaultChannelPipeline.java:591)\n\tat org.apache.storm.netty.channel.DefaultChannelPipeline.sendDownstream(DefaultChannelPipeline.java:582)\n\tat org.apache.storm.netty.channel.Channels.write(Channels.java:704)\n\tat org.apache.storm.netty.channel.Channels.write(Channels.java:671)\n\tat org.apache.storm.netty.channel.AbstractChannel.write(AbstractChannel.java:248)\n\tat backtype.storm.messaging.netty.Client.flushMessages(Client.java:480)\n\t- locked <1446a1e9> (a backtype.storm.messaging.netty.Client)\n\tat backtype.storm.messaging.netty.Client.send(Client.java:412)\n\t- locked <1446a1e9> (a backtype.storm.messaging.netty.Client)\n\tat backtype.storm.utils.TransferDrainer.send(TransferDrainer.java:54)\n\tat backtype.storm.daemon.worker$mk_transfer_tuples_handler$fn__5014$fn__5015.invoke(worker.clj:334)\n\tat backtype.storm.daemon.worker$mk_transfer_tuples_handler$fn__5014.invoke(worker.clj:332)\n\tat backtype.storm.disruptor$clojure_handler$reify__1446.onEvent(disruptor.clj:58)\n\tat backtype.storm.utils.DisruptorQueue.consumeBatchToCursor(DisruptorQueue.java:125)\n\tat backtype.storm.utils.DisruptorQueue.consumeBatchWhenAvailable(DisruptorQueue.java:99)\n\tat backtype.storm.disruptor$consume_batch_when_available.invoke(disruptor.clj:80)\n\tat backtype.storm.disruptor$consume_loop_STAR_$fn__1459.invoke(disruptor.clj:94)\n\tat backtype.storm.util$async_loop$fn__458.invoke(util.clj:463)\n\tat clojure.lang.AFn.run(AFn.java:24)\n\tat java.lang.Thread.run(Unknown Source)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"client-worker-1\" - Thread t@25\n   java.lang.Thread.State: BLOCKED\n\tat backtype.storm.messaging.netty.Client.closeChannelAndReconnect(Client.java:501)\n\t- waiting to lock <1446a1e9> (a backtype.storm.messaging.netty.Client) owned by \"Thread-10-disruptor-worker-transfer-queue\" t@52\n\tat backtype.storm.messaging.netty.Client.access$1400(Client.java:78)\n\tat backtype.storm.messaging.netty.Client$3.operationComplete(Client.java:492)\n\tat org.apache.storm.netty.channel.DefaultChannelFuture.notifyListener(DefaultChannelFuture.java:427)\n\tat org.apache.storm.netty.channel.DefaultChannelFuture.notifyListeners(DefaultChannelFuture.java:413)\n\tat org.apache.storm.netty.channel.DefaultChannelFuture.setFailure(DefaultChannelFuture.java:380)\n\tat org.apache.storm.netty.channel.socket.nio.AbstractNioWorker.cleanUpWriteBuffer(AbstractNioWorker.java:437)\n\t- locked <7b5a7fa5> (a java.lang.Object)\n\tat org.apache.storm.netty.channel.socket.nio.AbstractNioWorker.close(AbstractNioWorker.java:373)\n\tat org.apache.storm.netty.channel.socket.nio.NioWorker.read(NioWorker.java:93)\n\tat org.apache.storm.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n\tat org.apache.storm.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n\tat org.apache.storm.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n\tat org.apache.storm.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n\tat org.apache.storm.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n\tat org.apache.storm.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n\tat java.lang.Thread.run(Unknown Source)\n\n   Locked ownable synchronizers:\n\t- locked <75e528fd> (a java.util.concurrent.ThreadPoolExecutor$Worker)\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Deadlock hazard in backtype.storm.messaging.netty.Client","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eshioji","name":"eshioji","key":"eshioji","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Enno Shioji","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eshioji","name":"eshioji","key":"eshioji","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Enno Shioji","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14563575","id":"14563575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eshioji","name":"eshioji","key":"eshioji","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Enno Shioji","active":true,"timeZone":"Etc/UTC"},"body":"I've started working on a fix because the topology I'm working on is behaving unstable, which I'm suspecting is because of this. I'll submit a pull request when the code is tested.\n\nBranch is at: https://github.com/eshioji/storm/tree/STORM-839","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eshioji","name":"eshioji","key":"eshioji","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Enno Shioji","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-28T19:53:34.386+0000","updated":"2015-05-28T19:53:34.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14564520","id":"14564520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user eshioji opened a pull request:\n\n    https://github.com/apache/storm/pull/565\n\n    STORM-839\n\n    This fixes the reported deadlock between `disruptor-worker-transfer-queue` thread and `client-worker` thread, which seem to have been introduced by STORM-329.\n    \n    After reviewing the `v0.9.4` code, my conclusion was that the background flushing task can be removed without real change in the behavior. By doing this, the synchronization that was involved in the deadlock can be removed altogether.\n    \n    My reasoning is as follows:\n     - One has three option to deal with Netty's buffer filling up:\n      1. Discard incoming new messages\n      2. Block client thread until there is space (back pressure)\n      3. Keep buffering up until OOME is thrown\n     - My guess is that the `v0.9.4` code attempted to implement option (i), but actually the behavior is option (iii). When Netty's `Channel.isWritable` returns false in `Client.send`, the thread avoids writing to the `Channel` and leaves messages in the `Channel.messageBatch` field, which the background task flushes when the `Channel.isWritable` starts to return true again. However, if `Client.send` is called again before this (which should be common), the content of `Channel.messageBatch` is written and buffered on the `Channel` anyways, because `flushMessages` does not check `Channel.isWritable`.\n     - AFAIU we like option (ii), but this requires more work. Between option (i) and option (iii), IMO (iii) is superior because if OOME happens, the user can reduce MAX_PENDING_TUPLES to prevent this. Discarding messages would be harder to diagnose.\n     - If we are content with option (ii), we can remove the background flushing task and related synchronization altogether, removing the source of deadlock. We'd simply write and buffer onto the unbounded buffer of `Channel`, and if there are too many pending messages, the worker will die of OOME, and the user should reduce this with indirect means like reducing MAX_PENDING_TUPLES until option (ii) is implemented in the future.\n    \n    Thoughts @miguno ?\n    \n    \n    \n     \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/eshioji/storm STORM-839\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/565.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #565\n    \n----\ncommit 98f4e619d54052b73a309d23ab7214953e4c7774\nAuthor: Sriharsha Chintalapani <mail@harsha.io>\nDate:   2015-02-05T18:08:05Z\n\n    STORM-130: Supervisor getting killed due to java.io.FileNotFoundException: File '../stormconf.ser' does not exist.\n    \n    Signed-off-by: P. Taylor Goetz <ptgoetz@gmail.com>\n\ncommit a1e5893e1b94c224d39fedf11583b216c21351c8\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-02-24T20:46:12Z\n\n    update changelog for STORM-130\n\ncommit 62788f295bb1fb1cc83b99c30f82beb40eea5f25\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-02-24T23:03:40Z\n\n    port STORM-329 fix to 0.9.x\n\ncommit 81016c2ed7222da99138bc9971e335533d4cb518\nAuthor: Michael G. Noll <mnoll@verisign.com>\nDate:   2015-02-16T09:01:27Z\n\n    Track how many messages are being dropped when a connection is unavailable\n    \n    Signed-off-by: P. Taylor Goetz <ptgoetz@gmail.com>\n\ncommit 97a76fc896de508f015dbe32f1473ddbf10d736b\nAuthor: Michael G. Noll <mnoll@verisign.com>\nDate:   2015-02-16T09:03:07Z\n\n    Clarify name of method for dropping messages\n    \n    Signed-off-by: P. Taylor Goetz <ptgoetz@gmail.com>\n\ncommit 9138d9fc255639b4d0d43657379ce467591e8ef2\nAuthor: Michael G. Noll <mnoll@verisign.com>\nDate:   2015-02-16T09:07:35Z\n\n    Change log level for intentionally dropping messages from WARN to ERROR\n    \n    This change makes the log level for dropping messages consistent in\n    Client.java.\n    \n    Signed-off-by: P. Taylor Goetz <ptgoetz@gmail.com>\n\ncommit 6b06d8468ff5e743fb12b85dd84fe0931041c2c3\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-02-24T23:18:43Z\n\n    add STORM-329 to changelog\n\ncommit e63fb2af9086e2b2e688662ca42a4b4d0112274b\nAuthor: Parth Brahmbhatt <brahmbhatt.parth@gmail.com>\nDate:   2015-03-03T00:06:58Z\n\n    STORM-693: when bolt fails to write tuple, it should report error instead of silently acking.\n    \n    Signed-off-by: P. Taylor Goetz <ptgoetz@gmail.com>\n\ncommit 92836de540ec8ab90d7591b96ba02126e80b5c3a\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T14:59:56Z\n\n    add STORM-693 to changelog\n\ncommit c19e482b70f18d690ad165c78551860506486095\nAuthor: Parth Brahmbhatt <brahmbhatt.parth@gmail.com>\nDate:   2015-02-20T19:56:22Z\n\n    STORM-682: supervisor should handle worker state corruption gracefully.\n    \n    Signed-off-by: P. Taylor Goetz <ptgoetz@gmail.com>\n\ncommit f0de11a20fe2f20dc1dc2f485549e0dc342f8680\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T15:05:30Z\n\n    add STORM-682 to changelog\n\ncommit 835a410c879dc1eb02d9670410f65fe0be6f28c6\nAuthor: Parth Brahmbhatt <brahmbhatt.parth@gmail.com>\nDate:   2015-01-14T20:27:35Z\n\n    STORM-559: ZkHosts in README should use 2181 as port.\n    \n    Signed-off-by: P. Taylor Goetz <ptgoetz@gmail.com>\n\ncommit 30e0be8616c89cb1f8a51fcf462f76a075e6e964\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T15:11:16Z\n\n    add STORM-559 to changelog\n\ncommit b1bbacb7134d17ff47c2e8b8857a66244a4d1d4f\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T15:28:11Z\n\n    add missing import in supervisor.clj\n\ncommit edf596bac8feab0c8721f7de94474e5549858355\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T16:21:38Z\n\n    [maven-release-plugin] prepare release v0.9.4\n\ncommit 48d10e20eb3c750fc41fcf0bef3d49501cf6d5a4\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T16:21:45Z\n\n    [maven-release-plugin] prepare for next development iteration\n\ncommit 41f44f9914d4f27d0db3f211a85f88301533f09b\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T17:59:39Z\n\n    Revert \"[maven-release-plugin] prepare for next development iteration\"\n    \n    This reverts commit 48d10e20eb3c750fc41fcf0bef3d49501cf6d5a4.\n\ncommit 233603c3cbd729fdfabd2759bfa7705811996aa4\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T18:00:11Z\n\n    Revert \"[maven-release-plugin] prepare release v0.9.4\"\n    \n    This reverts commit edf596bac8feab0c8721f7de94474e5549858355.\n\ncommit 61e1b5c3e226122143c91bbd7527b605f8ed8727\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T18:05:51Z\n\n    add Apache license header to ConnectionWithStatus.java\n\ncommit 00091d7952681a39281aa171adfad133a5e26330\nAuthor: P. Taylor Goetz <ptgoetz@gmail.com>\nDate:   2015-03-18T18:13:57Z\n\n    [maven-release-plugin] prepare release v0.9.4\n\ncommit ed8ab3ec194f19c75fc2f5c000609204f04b50e8\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-28T19:42:05Z\n\n    Simplified the flow and removed the lock that was causing the deadlock\n\ncommit 91b8eb3840432e47b79f40abebec8304627732a8\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-28T19:46:17Z\n\n    Bump version\n\ncommit b7d84bdc7fd3de34f45a94131cdbb6bfbd3763dc\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-28T21:27:31Z\n\n    Remove background flushing because it doesn't seem necessary. Netty's Channel queues up written data on an unbounded buffer. The background flushing seems to have been added to avoid this, but in practice it was probably doing it anyways because flushMessages(), which is called by send() doesn't check for isWritable. Moreover, queuing on an unbounded buffer seems fine because back pressure is provided by MAX_PENDING_TUPLE. If OOME occurs due to this buffer overflowing, it seems reasonable that one has to reduce MAX_PENDING_TUPLE, rather than Storm trying to cope with it by dropping messages.\n\ncommit 679e42bc1e38f51c2759667b03cb45322c6a793b\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-28T21:31:35Z\n\n    Change to a SNAPSHOT version for deployment purposes\n\ncommit 27a92e2aa3488c0203f500306e0583ff9e7e1e82\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-29T09:32:16Z\n\n    Remove (now) dead comment and code\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-29T10:11:33.206+0000","updated":"2015-05-29T10:11:33.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14564522","id":"14564522","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user eshioji commented on the pull request:\n\n    https://github.com/apache/storm/pull/565#issuecomment-106765335\n  \n    Argh sorry I should have opened this against Storm v0.9.4, I worked off v0.9.4 tag.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-29T10:13:06.721+0000","updated":"2015-05-29T10:13:06.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14564523","id":"14564523","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user eshioji closed the pull request at:\n\n    https://github.com/apache/storm/pull/565\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-29T10:13:06.881+0000","updated":"2015-05-29T10:13:06.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14564539","id":"14564539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user eshioji opened a pull request:\n\n    https://github.com/apache/storm/pull/566\n\n    [STORM-839] Deadlock hazard in backtype.storm.messaging.netty.Client\n\n    (I accidentally did a PR against master with the same content, please ignore that one)\n    \n    This fixes the reported deadlock between `disruptor-worker-transfer-queue` thread and `client-worker` thread, which seem to have been introduced by STORM-329.\n    \n    After reviewing the `v0.9.4` code, my conclusion was that the background flushing task can be removed without real change in the behavior. By doing this, the synchronization that was involved in the deadlock can be removed altogether.\n    \n    My reasoning is as follows:\n     - One has three option to deal with Netty's buffer filling up:\n      1. Discard incoming new messages\n      2. Block client thread until there is space (back pressure)\n      3. Keep buffering up until OOME is thrown\n     - My guess is that the `v0.9.4` code attempted to implement option (i), but actually the behavior is option (iii). When Netty's `Channel.isWritable` returns false in `Client.send`, the thread avoids writing to the `Channel` and leaves messages in the `Channel.messageBatch` field, which the background task flushes when the `Channel.isWritable` starts to return true again. However, if `Client.send` is called again before this (which should be common), the content of `Channel.messageBatch` is written and buffered on the `Channel` anyways, because `flushMessages` does not check `Channel.isWritable`.\n     - AFAIU we like option (ii), but this requires more work. Between option (i) and option (iii), IMO (iii) is superior because if OOME happens, the user can reduce MAX_PENDING_TUPLES to prevent this. Discarding messages would be harder to diagnose.\n     - If we are content with option (ii), we can remove the background flushing task and related synchronization altogether, removing the source of deadlock. We'd simply write and buffer onto the unbounded buffer of `Channel`, and if there are too many pending messages, the worker will die of OOME, and the user should reduce this with indirect means like reducing MAX_PENDING_TUPLES until option (ii) is implemented in the future.\n    \n    Thoughts @miguno ?\n    \n    \n    \n     \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/eshioji/storm STORM-839\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/566.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #566\n    \n----\ncommit ed8ab3ec194f19c75fc2f5c000609204f04b50e8\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-28T19:42:05Z\n\n    Simplified the flow and removed the lock that was causing the deadlock\n\ncommit 91b8eb3840432e47b79f40abebec8304627732a8\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-28T19:46:17Z\n\n    Bump version\n\ncommit b7d84bdc7fd3de34f45a94131cdbb6bfbd3763dc\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-28T21:27:31Z\n\n    Remove background flushing because it doesn't seem necessary. Netty's Channel queues up written data on an unbounded buffer. The background flushing seems to have been added to avoid this, but in practice it was probably doing it anyways because flushMessages(), which is called by send() doesn't check for isWritable. Moreover, queuing on an unbounded buffer seems fine because back pressure is provided by MAX_PENDING_TUPLE. If OOME occurs due to this buffer overflowing, it seems reasonable that one has to reduce MAX_PENDING_TUPLE, rather than Storm trying to cope with it by dropping messages.\n\ncommit 679e42bc1e38f51c2759667b03cb45322c6a793b\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-28T21:31:35Z\n\n    Change to a SNAPSHOT version for deployment purposes\n\ncommit 27a92e2aa3488c0203f500306e0583ff9e7e1e82\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-29T09:32:16Z\n\n    Remove (now) dead comment and code\n\ncommit 09bf6e1b5d9d351f2a60cd9a32e0239752cf437a\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-05-29T10:23:46Z\n\n    Merge branch '0.9.x-branch' into STORM-839\n    \n    Conflicts:\n    \texamples/storm-starter/pom.xml\n    \texternal/storm-hbase/pom.xml\n    \texternal/storm-hdfs/pom.xml\n    \texternal/storm-kafka/pom.xml\n    \tpom.xml\n    \tstorm-buildtools/maven-shade-clojure-transformer/pom.xml\n    \tstorm-core/pom.xml\n    \tstorm-dist/binary/pom.xml\n    \tstorm-dist/source/pom.xml\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-29T10:27:08.215+0000","updated":"2015-05-29T10:27:08.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14564547","id":"14564547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user eshioji commented on the pull request:\n\n    https://github.com/apache/storm/pull/566#issuecomment-106768270\n  \n    @Hailei Thanks for the comment. Could you review my reasoning in the [PR comment above](https://github.com/apache/storm/pull/566#issue-82369808)?  \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-29T10:35:25.007+0000","updated":"2015-05-29T10:35:25.007+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14564602","id":"14564602","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Hailei commented on the pull request:\n\n    https://github.com/apache/storm/pull/566#issuecomment-106778432\n  \n    >we can remove the background flushing task and related synchronization altogether, removing the source of deadlock. We'd simply write and buffer onto the unbounded buffer of Channel\n    +1 I agree with you.flushMessages don't check isWritable,So the last message batch check it is not useful.\n    Block client thread until there is space (back pressure) is better.It can snap out of OOM.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-29T11:26:08.061+0000","updated":"2015-05-29T11:26:08.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14564717","id":"14564717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user eshioji commented on the pull request:\n\n    https://github.com/apache/storm/pull/566#issuecomment-106792295\n  \n    @Hailei I see. \n    \n    > Block client thread until there is space (back pressure) is better.It can snap out of OOM.\n    \n    Agreed, but my understanding is that this needs quite a bit more work. At the least, the change can't be contained within `Client.java`. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-29T12:39:29.758+0000","updated":"2015-05-29T12:39:29.758+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14564737","id":"14564737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user miguno commented on the pull request:\n\n    https://github.com/apache/storm/pull/566#issuecomment-106795826\n  \n    > My reasoning is as follows:\n    > \n    > * One has three option to deal with Netty's buffer filling up:\n    >     1. Discard incoming new messages\n    >     2. Block client thread until there is space (back pressure)\n    >     3. Keep buffering up until OOME is thrown\n    >\n    > My guess is that the v0.9.4 code attempted to implement option (i), but actually the behavior is option (iii).\n    \n    The code's intention was actually (iii).  As you described back pressure (ii) was not picked because this will require a significant amount of work, which was thus out of scope for fixing STORM-329.  The reason (iii) was preferred over (i) was also as you described -- if (and only if) users have enabled acking = guaranteed message processing for a topology, they can prevent OOM errors from happening by setting [`topology.max.spout.pending`](https://github.com/apache/storm/blob/master/conf/defaults.yaml#L180).\n    \n    I'll have to look at your code in more detail before commenting.  I'll also ping @ptgoetz, @clockfly, @tedxia, and @revans2 who were involved in this significant patch (sorry for the spam, folks!).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-29T12:56:18.082+0000","updated":"2015-05-29T12:56:18.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14564789","id":"14564789","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user eshioji commented on the pull request:\n\n    https://github.com/apache/storm/pull/566#issuecomment-106800904\n  \n    Just as a heads up, I'm seeing STORM-763 as well (300 ERROR messages per second per machine) in our cluster. My initial gut feeling is that maybe reconnect isn't getting enough run time from the ScheduledExecutor. Depending on the results I might create another PR for 763.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-29T13:21:11.176+0000","updated":"2015-05-29T13:21:11.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14566473","id":"14566473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user eshioji commented on the pull request:\n\n    https://github.com/apache/storm/pull/566#issuecomment-107148613\n  \n    Hi @miguno , thanks for taking the time. I think I have a [fix for STORM-763](https://github.com/apache/storm/pull/568) which builds on this PR. Let me know what you think!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-31T09:07:42.447+0000","updated":"2015-05-31T09:07:42.447+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14612923","id":"14612923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user eshioji opened a pull request:\n\n    https://github.com/apache/storm/pull/616\n\n    Storm 763/839 0.11.x\n\n    This is a port of PR #568 . It fixes STORM-839 (Deadlock) and STORM-763 (Establish Netty reconnects asynchronously and reduce verbosity of error logs)\n    \n    @revans2 This is the PR for master. I ran the performance test against master's HEAD and the results were in-line with the results I got in #568 . I'll create a separate PR for 0.10.x\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/eshioji/storm STORM-763_0.11.x\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/616.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #616\n    \n----\ncommit b1411aa63383801913cb1340a8b51c5bb46db0ba\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-07-01T12:54:33Z\n\n    This fixes STORM-763 and STORM-839\n\ncommit 935e87accc85340549f44effa8a675e950747faa\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-07-02T17:56:23Z\n\n    Remove obsolete TODO\n\ncommit 7af467723b5c4b0beedc40626a8c56bc7c3e0d21\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-07-03T00:02:00Z\n\n    Bring back removal of client from context upon closing\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-03T07:07:37.773+0000","updated":"2015-07-03T07:07:37.773+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14612982","id":"14612982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user eshioji opened a pull request:\n\n    https://github.com/apache/storm/pull/617\n\n    Storm 763/839 0.10.x\n\n    This is a port of PR #568 from 0.9.x to 0.10.x. It fixes STORM-839 (Deadlock) and STORM-763 (Establish Netty reconnects asynchronously and reduce verbosity of error logs)\n    \n    The content is equivalent to the PR for 0.11.x (#616)\n    \n    @revans2 This is the PR for 0.10.x. I also ran the performance test for this and the results were again inline with what I got with 0.9.x. I get build failure on my machine but I get the same failure with 0.10.x HEAD, so I'm guessing it's unrelated to this change. \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/eshioji/storm STORM-763_0.10.x\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/617.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #617\n    \n----\ncommit 286bacdf49937d1e8576eff27dfc887824ffdbbb\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-07-02T18:01:01Z\n\n    This fixes STORM-763 and STORM-839\n\ncommit a2502c3bc3bcd4caf3800bb645058abb61d2a071\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-07-02T23:51:32Z\n\n    Merge remote-tracking branch 'upstream/0.10.x-branch' into STORM-763_0.10.x\n    \n    # Conflicts:\n    #\tstorm-core/src/jvm/backtype/storm/messaging/netty/Client.java\n\ncommit f5db06ce2809c3b66f2d797f979f8c40133c2f60\nAuthor: Enno Shioji <eshioji@gmail.com>\nDate:   2015-07-03T00:02:00Z\n\n    Bring back removal of client from context on closing\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-03T08:12:29.418+0000","updated":"2015-07-03T08:12:29.418+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14626880","id":"14626880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/616\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-14T19:05:45.060+0000","updated":"2015-07-14T19:05:45.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14626881","id":"14626881","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/617\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-14T19:06:10.652+0000","updated":"2015-07-14T19:06:10.652+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14626883","id":"14626883","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/566\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-07-14T19:06:39.882+0000","updated":"2015-07-14T19:06:39.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12833459/comment/14626906","id":"14626906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Thanks [~eshioji],\n\nI merged this into master, branch-0.10.x and branch-0.9.x.  You may want to talk to [~ptgoetz] about doing a 0.9.6 release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2015-07-14T19:19:06.912+0000","updated":"2015-07-14T19:19:06.912+0000"}],"maxResults":17,"total":17,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-839/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2fbqn:"}}