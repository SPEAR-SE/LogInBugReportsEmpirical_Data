{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12720112","self":"https://issues.apache.org/jira/rest/api/2/issue/12720112","key":"STORM-342","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326452","id":"12326452","name":"0.9.2-incubating","archived":false,"released":true,"releaseDate":"2014-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-06-09T20:10:12.857+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jun 12 21:03:39 UTC 2014","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_284663007_*|*_5_*:*_1_*:*_0","customfield_12310420":"398311","customfield_12312321":null,"resolutiondate":"2014-06-12T21:04:19.955+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-342/watchers","watchCount":3,"isWatching":false},"created":"2014-06-09T13:59:56.998+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clockfly","name":"clockfly","key":"clockfly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean Zhong","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T00:46:26.937+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"h2. STORM-342: Message loss, executor hang, or message disorder\n\nDisruptor helper class contains a potential contention bug between consumer and producer. It can cause consume queue hang, message loss, or message disorder.\n\n{code:title=Disruptor.java|borderStyle=solid}\nclass Disruptor {\n...\n    public void publish(Object obj, boolean block) throws InsufficientCapacityException {\n        if(consumerStartedFlag) {\n            final long id;\n            if(block) {\n                id = _buffer.next();\n            } else {\n                id = _buffer.tryNext(1);\n            }\n            final MutableObject m = _buffer.get(id);\n            m.setObject(obj);\n            _buffer.publish(id);\n        } else {\n            _cache.add(obj);\n            if(consumerStartedFlag) flushCache();\n        }\n    }\n\n    public void consumerStarted() {\n        if(!consumerStartedFlag) {\n            consumerStartedFlag = true;\n            flushCache();\n        }\n    }\n}\n{code}\n\n\nConsumer\n\n{code:title=Task Executor Thread|borderStyle=solid}\n  (disruptor/consumer-started! receive-queue)\n  (fn []            \n     (disruptor/consume-batch-when-available receive-queue event-handler)\n{code}\n\nh3. Howto: Executor Hang, message loss:\n\n1. [Consumer Thread] consumer not started.\n2. [Producer A Thread] publish message \"1\", as \"consumerStartedFlag\" == false, it will be added it into cache.\n3. [Consumer Thread] consumerStarted() is called. consumerStartedFlag is set to true, but flushCache() is not called yet.\n4. As \"consumerStartedFlag\" is true now, new produced message will be published to RingBuffer.\n5. [Producer B Thread] generates enough message, and make RingBuffer full.\n6. [Consumer Thread] flushCache() is called in consumerStarted()\n7. [Consumer Thread] FLUSH_CACHE object is published RingBuffer in blocking way, As now RingBuffer is full, the consumer thread will be blocked.\n8. [Consumer Thread] consumeBatch() will never called, so the RingBuffer is always full, and the consumer thread is always blocked.\n\nh3. Howto: Message Disorder\n\n1. [Consumer Thread] consumer not started.\n2. [Producer A Thread] publish message \"1\", as \"consumerStartedFlag\" == false, it will be added it into cache.\n3. [Consumer Thread] consumerStarted() is called. consumerStartedFlag is set to true, but flushCache() is not called yet.\n4. As \"consumerStartedFlag\" is true now, new produced message will be published to RingBuffer.\n5. [Producer A Thread] publish a new message \"2\", it will be published directly in RingBuffer.\n6. [Consumer Thread] flushCache() is called in consumerStarted()\n7. [Consumer Thread] FLUSH_CACHE message is published RingBuffer, FLUSH_CACHE message is written after message \"2\".\n8. [Consumer Thread] consumeBatch() is called, first it picks \"2\", then it picks FLUSH_CACHE, will represents \"1\"\n9. We produce in Producer A Thread in order \"1\", \"2\", but we received in consumer thread \"2\", \"1\"\n10. Message order is wrong.\n\nI found this after troubleshooting a tricky random failure(1 in 100 times). It usually happen when producer and consumer colocated in same process, for example,  the task send queue thread as producer, produce message to local task receive queue in same worker.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"398438","customfield_12312823":null,"summary":"Contention in Disruptor Queue which may cause message loss or out of order","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clockfly","name":"clockfly","key":"clockfly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean Zhong","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clockfly","name":"clockfly","key":"clockfly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean Zhong","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14025212","id":"14025212","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clockfly","name":"clockfly","key":"clockfly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean Zhong","active":true,"timeZone":"Asia/Shanghai"},"body":"why cache is introduced in Disruptor queue? The logic for SingleThreadedClaimStrategy is different with MultiThreadedClaimStrategy.\n\nFor SingleThreadedClaimStrategy, it will mark consumerStartedFlag directly in constructor, and no cache will be used.\n\nIn Disprutor,  \n{code:title=Disruptor.java|borderStyle=solid}\n    public DisruptorQueue(String queueName, ClaimStrategy claim, WaitStrategy wait) {\n         this._queueName = PREFIX + queueName;\n         \n         LOG.info(\"========Disruptor queueName\" +  _queueName + \", \" + claim.getClass().toString() + \", \" + wait.getClass().toString());\n         \n        _buffer = new RingBuffer<MutableObject>(new ObjectEventFactory(), claim, wait);\n        _consumer = new Sequence();\n        _barrier = _buffer.newBarrier();\n        _buffer.setGatingSequences(_consumer);\n        if(claim instanceof SingleThreadedClaimStrategy) {\n            consumerStartedFlag = true;\n        }\n    }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clockfly","name":"clockfly","key":"clockfly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean Zhong","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-06-09T14:17:54.223+0000","updated":"2014-06-09T14:18:24.985+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14025260","id":"14025260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clockfly","name":"clockfly","key":"clockfly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean Zhong","active":true,"timeZone":"Asia/Shanghai"},"body":"This have more seveve impact.\n\nIt can cause hang, and message loss.\nSuppose, during this contention time, publisher has published enough message, and make the buffer full.\nThen when consumer call flushcache() to publish FLUSH_CACHE message into RingBuffer, it will block forever, as there is no free slots available.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clockfly","name":"clockfly","key":"clockfly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean Zhong","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-06-09T15:10:39.214+0000","updated":"2014-06-09T15:10:39.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14025674","id":"14025674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Wow great work finding this, it looks like it was a beast to debug.  Do you have a fix in mind for this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-06-09T20:10:12.857+0000","updated":"2014-06-09T20:10:12.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14026377","id":"14026377","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user clockfly opened a pull request:\n\n    https://github.com/apache/incubator-storm/pull/136\n\n    STORM-342: Message loss, executor hang, or message disorder due to contention in Disruptor queue under multi-thread mode.\n\n    STORM-342: Message loss, executor hang, or message disorder\n    -------------------------\n    \n    Disruptor helper class contains a potential contention bug between consumer and producer. It can cause consume queue hang, message loss, or message disorder.\n    \n    ```java\n    Disruptor.java\n    class Disruptor {\n    ...\n        public void publish(Object obj, boolean block) throws InsufficientCapacityException {\n            if(consumerStartedFlag) {\n                final long id;\n                if(block) {\n                    id = _buffer.next();\n                } else {\n                    id = _buffer.tryNext(1);\n                }\n                final MutableObject m = _buffer.get(id);\n                m.setObject(obj);\n                _buffer.publish(id);\n            } else {\n                _cache.add(obj);\n                if(consumerStartedFlag) flushCache();\n            }\n        }\n        \n        public void consumerStarted() {\n            if(!consumerStartedFlag) {\n                consumerStartedFlag = true;\n                flushCache();\n            }\n        }\n    }\n    ```\n    \n    Consumer\n    ```lisp\n    ;;Executor thead\n      (disruptor/consumer-started! receive-queue)\n      (fn []            \n         (disruptor/consume-batch-when-available receive-queue event-handler)\n    ```\n    \n    Howto: Executor Hang, message loss:\n    ------------------------\n    1. [Consumer Thread] consumer not started.\n    2. [Producer A Thread] publish message \"1\", as \"consumerStartedFlag\" == false, it will be added it into cache.\n    3. [Consumer Thread] consumerStarted() is called. consumerStartedFlag is set to true, but flushCache() is not called yet.\n    4. As \"consumerStartedFlag\" is true now, new produced message will be published to RingBuffer.\n    5. [Producer B Thread] generates enough message, and make RingBuffer full.\n    6. [Consumer Thread] flushCache() is called in consumerStarted() \n    7. [Consumer Thread] FLUSH_CACHE object is published RingBuffer in blocking way, As now RingBuffer is full, the consumer thread will be blocked.\n    8. [Consumer Thread] consumeBatch() will never called, so the RingBuffer is always full, and the consumer thread is always blocked.\n    \n    Howto: Message Disorder\n    -----------------------------------\n    1. [Consumer Thread] consumer not started.\n    2. [Producer A Thread] publish message \"1\", as \"consumerStartedFlag\" == false, it will be added it into cache.\n    3. [Consumer Thread] consumerStarted() is called. consumerStartedFlag is set to true, but flushCache() is not called yet.\n    4. As \"consumerStartedFlag\" is true now, new produced message will be published to RingBuffer.\n    5. [Producer A Thread] publish a new message \"2\", it will be published directly in RingBuffer.\n    6. [Consumer Thread] flushCache() is called in consumerStarted() \n    7. [Consumer Thread] FLUSH_CACHE message is published RingBuffer, FLUSH_CACHE message is written after message \"2\".\n    8. [Consumer Thread] consumeBatch() is called, first it picks \"2\", then it picks FLUSH_CACHE, will represents \"1\"\n    9. We produce in Producer A Thread in order \"1\", \"2\", but we received in consumer thread \"2\", \"1\"\n    10. Message order is wrong.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/clockfly/incubator-storm disruptor_message_loss_hang_or_disorder\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/incubator-storm/pull/136.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #136\n    \n----\ncommit 72b1f592885abc8c02c6902aa0eb6499bacae7f2\nAuthor: Sean Zhong <clockfly@gmail.com>\nDate:   2014-06-10T11:54:11Z\n\n    STORM-342: Message loss, executor hang, or message disorder due to contention in Disruptor queue under multi-thread mode.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-10T12:15:19.482+0000","updated":"2014-06-10T12:15:19.482+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14026388","id":"14026388","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user clockfly commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/136#issuecomment-45607328\n  \n    This bug was found during a scenario test, it happens 1 in 100 times.\n    With this fix, I rerun the same test for 500 times, and not seeing this error again.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-10T12:34:34.597+0000","updated":"2014-06-10T12:34:34.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14027282","id":"14027282","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clockfly","name":"clockfly","key":"clockfly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean Zhong","active":true,"timeZone":"Asia/Shanghai"},"body":"[~revans2], patch ready https://github.com/apache/incubator-storm/pull/136","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clockfly","name":"clockfly","key":"clockfly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sean Zhong","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-06-11T00:55:27.149+0000","updated":"2014-06-11T00:55:27.149+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14027957","id":"14027957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user gna-phetsarath commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/136#issuecomment-45762704\n  \n    Is this patch compatible with storm-0.8.1? or do we have to upgrade and patch?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-11T16:09:06.303+0000","updated":"2014-06-11T16:09:06.303+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14028118","id":"14028118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/136#discussion_r13663702\n  \n    --- Diff: storm-core/src/jvm/backtype/storm/utils/DisruptorQueue.java ---\n    @@ -62,6 +69,13 @@ public DisruptorQueue(String queueName, ClaimStrategy claim, WaitStrategy wait)\n             _buffer.setGatingSequences(_consumer);\n             if(claim instanceof SingleThreadedClaimStrategy) {\n                 consumerStartedFlag = true;\n    +        } else {\n    +            // make sure we flush the pending messages in cache first\n    +            try {\n    +                publishDirect(FLUSH_CACHE, true);\n    +            } catch (InsufficientCapacityException e) {\n    +                throw new RuntimeException(\"This code should be unreachable!\");\n    --- End diff --\n    \n    Can we include e as the cause of the RuntimeException.  There have been times where I thought code should be unreachable, and when we did reach it in production I had no way to debug what happened.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-11T17:55:35.416+0000","updated":"2014-06-11T17:55:35.416+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14028668","id":"14028668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user clockfly commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/136#issuecomment-45818844\n  \n    @gna-phetsarath, it should be compatible with 0.8.1.\n    \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T00:57:00.627+0000","updated":"2014-06-12T00:57:00.627+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14028669","id":"14028669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user clockfly commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/136#discussion_r13683241\n  \n    --- Diff: storm-core/src/jvm/backtype/storm/utils/DisruptorQueue.java ---\n    @@ -62,6 +69,13 @@ public DisruptorQueue(String queueName, ClaimStrategy claim, WaitStrategy wait)\n             _buffer.setGatingSequences(_consumer);\n             if(claim instanceof SingleThreadedClaimStrategy) {\n                 consumerStartedFlag = true;\n    +        } else {\n    +            // make sure we flush the pending messages in cache first\n    +            try {\n    +                publishDirect(FLUSH_CACHE, true);\n    +            } catch (InsufficientCapacityException e) {\n    +                throw new RuntimeException(\"This code should be unreachable!\");\n    --- End diff --\n    \n    fixed.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T00:57:15.774+0000","updated":"2014-06-12T00:57:15.774+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14029405","id":"14029405","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/136#issuecomment-45918625\n  \n    Sorry it took me so long to finish the review.  I wanted to be sure I truly understood what was happening.  +1 looks like a great fix.  If someone else could take a look at this that would be awesome.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T16:58:13.034+0000","updated":"2014-06-12T16:58:13.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14029456","id":"14029456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user gna-phetsarath commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/136#issuecomment-45921906\n  \n    I had to fork and backport it to 0.8.1-- I could not take the patch directly.  I'll create a pull request once we test it on our side.  So far, we are seeing positive results.  Will be creating a pull request soon.  Thanks for the fix.\n    \n    https://github.com/gna-phetsarath/incubator-storm/tree/0.8.1-disruptor_queue_fix\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T17:24:48.515+0000","updated":"2014-06-12T17:24:48.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14029746","id":"14029746","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user ptgoetz commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/136#issuecomment-45942819\n  \n    +1 looks good.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T20:21:20.960+0000","updated":"2014-06-12T20:21:20.960+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720112/comment/14029802","id":"14029802","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/incubator-storm/pull/136\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T21:03:39.224+0000","updated":"2014-06-12T21:03:39.224+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-342/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1wkp3:"}}