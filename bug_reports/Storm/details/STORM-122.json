{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12684746","self":"https://issues.apache.org/jira/rest/api/2/issue/12684746","key":"STORM-122","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-03-19T23:20:10.026+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 25 22:08:07 UTC 2014","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"363818","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-122/watchers","watchCount":4,"isWatching":false},"created":"2013-12-15T03:17:27.880+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T00:27:29.321+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"https://github.com/nathanmarz/storm/issues/745\n\nApologies if this ticket is off-base, I'm not an expert in this area. We've been testing an existing topology we ran on Storm 0.8.1 on a deployment of Storm 0.9.0-rc2. The only roadblock we've encountered so far is the presence of the log4j-over-slf4j jar in the newer version. It turns out that log4j-over-slf4j is incompatible with slf4j-log4j12.\n\nBasically our topology uses slf4j as the the logging facade and log4j as the backend, which I've heard is a common pattern. It seems that in order to migrate to the new Storm version we must either move our code off of log4j or delete the log4j-over-slf4j jar from the storm classpath.\n\nAre we doing something crazy here? I'm open to alternate solutions, but it seems like an issue to break legacy topologies over logging. My understanding based on #144 was that Storm was migrating completely to slf4j, is this no longer true? Any insight, advice, or fixes would be helpful.\n\n--------\njmlogan: You're going to have to exclude log4j and log4j-over-slf4j. Storm calls mostly seem to be slf4j, but it is not logger-agonistic. In 0.9.0, it will force logback onto your classpath at runtime, and will crash if it has multiple adapters.\n\nIf you see a job failing to launch, right after updating, it's probably this issue. We ended up just excluding log4j from the offending dependencies.\n\n\n---------\nbakks: Hey, thanks for your response. The issue is that log4j-over-slf4j is now a Storm dependency, so its loaded into the topology classpath by default. This wasn't true in earlier Storm versions, so perhaps this is intentional, but our topology which used to work now doesn't. It seems like there is now no way to use log4j as an slf4j backend. If that is the new state of the world, its fine, but it seems like an issue and I'm hoping for a workaround.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"364124","customfield_12312823":null,"summary":"log4j-over-slf4j in 0.9.0-rc2 breaks existing topologies","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684746/comment/13941157","id":"13941157","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peterklipfel","name":"peterklipfel","key":"peterklipfel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Klipfel","active":true,"timeZone":"Etc/UTC"},"body":"I'm using sbt. I've been trying to exclude any and all logging dependencies. This error will not go away and has now cost me days of development time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peterklipfel","name":"peterklipfel","key":"peterklipfel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Klipfel","active":true,"timeZone":"Etc/UTC"},"created":"2014-03-19T23:20:10.026+0000","updated":"2014-03-19T23:20:10.026+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684746/comment/13943140","id":"13943140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"By default the packaging we suggest groups to use is the maven-assembly-plugin with jar-with-dependencies\n\nhttp://maven.apache.org/plugins/maven-assembly-plugin/descriptor-refs.html#jar-with-dependencies\n\nYou can manually exclude the slf4j-log4j12 in your pom under all of the dependencies, or you can create your own assembly config that excludes them there.  The main difference here is that logging may cause some problems in your unit tests (NOTE: I just threw this together and have not tested it}\n\n{code:xml}\n<assembly xmlns=\"http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.0\" \n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xsi:schemaLocation=\"http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.0 http://maven.apache.org/xsd/assembly-1.1.0.xsd\">\n  <id>jar-with-dependencies-but-no-log4j</id>\n  <formats>\n    <format>jar</format>\n  </formats>\n  <includeBaseDirectory>false</includeBaseDirectory>\n  <dependencySets>\n    <dependencySet>\n      <outputDirectory>/</outputDirectory>\n      <useProjectArtifact>true</useProjectArtifact>\n      <unpack>true</unpack>\n      <scope>runtime</scope>\n      <excludes>\n        <exclude>org.slf4j:slf4j-log4j12</exclude>\n        <exclude>log4j:log4j</exclude>\n      </excludes>\n    </dependencySet>\n  </dependencySets>\n</assembly>\n{code}\n\nThe other thing to be aware of is that running \n{code}\nmvn dependency:tree\n{code}\n\nWill print out exactly which dependencies are being pulled in and where they are coming from.  Be aware that once you squash one version of a dependency with an exclude, you need to run the command again, because it only prints out a dependency once, and if multiple things are pulling it in, the next one will bubble up to the top.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-03-21T15:13:57.661+0000","updated":"2014-03-21T15:13:57.661+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684746/comment/13943146","id":"13943146","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Do you think it would be enough to document this so it is simpler to fix topologies? Or are you looking for us to switch back to log4j? Or do you want something radical/scary like munge with submitted topology jars and try to strip out problematic classes? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-03-21T15:18:05.669+0000","updated":"2014-03-21T15:18:05.669+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684746/comment/13947238","id":"13947238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peterklipfel","name":"peterklipfel","key":"peterklipfel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Klipfel","active":true,"timeZone":"Etc/UTC"},"body":"I ended up manually excluding all log4j dependencies from included libraries that required them and removing all log4j code from the codebase. I think that better documenting this would be a good way to move forward. The things that I tried before this caused very strange behavior in storm (I tried things like munging classpaths and jars).\n\nHere is a sample from the build.sbt\n{code:title=build.sbt}\n\"com.datastax.cassandra\" % \"cassandra-driver-core\" % \"1.0.3\"\n    exclude (\"org.slf4j\", \"slf4j-api\")\n    exclude (\"org.slf4j\", \"slf4j-log4j12\")\n    exclude (\"log4j\", \"log4j\"),\n...\n{code}\n\nI found them with sbt dependency-graph combined with a command like\n{code}\nfind ~/.ivy2/cache/ -exec grep -ln slf4j {} \\;\n{code}\n\nI hope that helps anyone else that might hit this issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peterklipfel","name":"peterklipfel","key":"peterklipfel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Klipfel","active":true,"timeZone":"Etc/UTC"},"created":"2014-03-25T22:08:07.821+0000","updated":"2014-03-25T22:08:07.821+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-122/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qpmv:"}}