{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12686087","self":"https://issues.apache.org/jira/rest/api/2/issue/12686087","key":"STORM-183","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327112","id":"12327112","name":"0.9.3","archived":false,"released":true,"releaseDate":"2014-11-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-12-23T17:02:07.760+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jun 25 14:04:11 UTC 2014","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_15942204659_*|*_5_*:*_1_*:*_0","customfield_12310420":"365044","customfield_12312321":null,"resolutiondate":"2014-06-25T14:04:11.951+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-183/watchers","watchCount":3,"isWatching":false},"created":"2013-12-23T01:40:47.333+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[{"id":"12380299","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12380299","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12684751","key":"STORM-126","self":"https://issues.apache.org/jira/rest/api/2/issue/12684751","fields":{"summary":"Add Lifecycle support API for worker nodes","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T01:01:20.599+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"if the process is killed forcefully from the OS or if it's crashing due to resource issues (e.g., out of memory), shutdown hooks won't be invoked.\n-TERM (15) \nThe process is requested to stop running; it should try to exit cleanly \n-KILL (9) \nThe process will be killed by the kernel; this signal cannot be ignored.\nSo should we better use 'kill -15' ?\nSee:\nhttps://github.com/apache/incubator-storm/blob/master/storm-core/src/clj/backtype/storm/util.clj#L392\n\n\n\nhttps://github.com/apache/incubator-storm/blob/master/storm-core/src/clj/backtype/storm/daemon/supervisor.clj#L175\n\nwill never be called for supervisor:\nhttps://github.com/apache/incubator-storm/blob/master/storm-core/src/clj/backtype/storm/daemon/supervisor.clj#L396\n\nwill never be called for worker:\nhttps://github.com/apache/incubator-storm/blob/master/storm-core/src/clj/backtype/storm/daemon/worker.clj#L421\n\n\nWe'd better add something like :\n(.addShutdownHook (Runtime/getRuntime) (Thread. (fn [] (.shutdown mk-sv))))))  ?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12620111","id":"12620111","filename":"STORM-183-1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caofangkun","name":"caofangkun","key":"caofangkun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=caofangkun&avatarId=23151","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=caofangkun&avatarId=23151","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=caofangkun&avatarId=23151","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=caofangkun&avatarId=23151"},"displayName":"caofangkun","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-12-23T01:52:24.124+0000","size":2109,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12620111/STORM-183-1.patch"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"365352","customfield_12312823":null,"summary":"Supervisor/worker shutdown hook should be called in distributed mode.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caofangkun","name":"caofangkun","key":"caofangkun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=caofangkun&avatarId=23151","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=caofangkun&avatarId=23151","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=caofangkun&avatarId=23151","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=caofangkun&avatarId=23151"},"displayName":"caofangkun","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caofangkun","name":"caofangkun","key":"caofangkun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=caofangkun&avatarId=23151","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=caofangkun&avatarId=23151","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=caofangkun&avatarId=23151","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=caofangkun&avatarId=23151"},"displayName":"caofangkun","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/13855331","id":"13855331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caofangkun","name":"caofangkun","key":"caofangkun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=caofangkun&avatarId=23151","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=caofangkun&avatarId=23151","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=caofangkun&avatarId=23151","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=caofangkun&avatarId=23151"},"displayName":"caofangkun","active":true,"timeZone":"Asia/Shanghai"},"body":"After the patch:\nkill -15 supervisor_pid \ntail -20f $STORM_HOME/logs/supervisor.log \n2013-12-20 10:34:47 b.s.d.supervisor [INFO] Shutting down supervisor ae96c39c-5e62-4e88-824d-3e5b05ac31bf\n2013-12-20 10:34:47 b.s.event [INFO] Event manager interrupted\n2013-12-20 10:34:47 b.s.event [INFO] Event manager interrupted\n2013-12-20 10:34:47 o.a.z.ZooKeeper [INFO] Session: 0x1430dbb25c00027 closed\n2013-12-20 10:34:47 o.a.z.ClientCnxn [INFO] EventThread shut down\n\n\nkill -9 worker_pid \ntail -100f $STORM_HOME/logs/worker-6101.log \n2013-12-20 10:35:01 b.s.d.worker [INFO] Shutting down receive thread\n2013-12-20 10:35:01 b.s.m.loader [INFO] Shutting down receiving-thread: [WordCountTopology-1-1387364272, 39931]\n2013-12-20 10:35:01 b.s.m.loader [INFO] Receiving-thread:[WordCountTopology-1-1387364272, 39931] received shutdown notice\n2013-12-20 10:35:01 b.s.m.loader [INFO] Waiting for receiving-thread:[WordCountTopology-1-1387364272, 39931] to die\n2013-12-20 10:35:01 b.s.m.loader [INFO] Shutdown receiving-thread: [WordCountTopology-1-1387364272, 39931]\n2013-12-20 10:35:01 b.s.d.worker [INFO] Shut down receive thread\n2013-12-20 10:35:01 b.s.d.worker [INFO] Terminating messaging context\n2013-12-20 10:35:01 b.s.d.worker [INFO] Shutting down executors\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shutting down executor __acker:[3 3]\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shut down executor __acker:[3 3]\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shutting down executor count:[7 7]\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shut down executor count:[7 7]\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shutting down executor count:[11 11]\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shut down executor count:[11 11]\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shutting down executor count:[15 15]\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shut down executor count:[15 15]\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shutting down executor split:[19 19]\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shut down executor split:[19 19]\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shutting down executor split:[23 23]\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shut down executor split:[23 23]\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shutting down executor spout:[27 27]\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shut down executor spout:[27 27]\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shutting down executor __system:[-1 -1]\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.d.executor [INFO] Shut down executor __system:[-1 -1]\n2013-12-20 10:35:01 b.s.d.worker [INFO] Shut down executors\n2013-12-20 10:35:01 b.s.d.worker [INFO] Shutting down transfer thread\n2013-12-20 10:35:01 b.s.util [INFO] Async loop interrupted!\n2013-12-20 10:35:01 b.s.d.worker [INFO] Shut down transfer thread\n2013-12-20 10:35:01 b.s.d.worker [INFO] Shutting down default resources\n2013-12-20 10:35:01 b.s.d.worker [INFO] Shut down default resources\n2013-12-20 10:35:01 b.s.d.worker [INFO] Disconnecting from storm cluster state context\n2013-12-20 10:35:01 o.a.z.ClientCnxn [INFO] EventThread shut down\n2013-12-20 10:35:01 o.a.z.ZooKeeper [INFO] Session: 0x1430dbb25c00031 closed\n2013-12-20 10:35:01 b.s.d.worker [INFO] Shut down worker WordCountTopology-1-1387364272 ae96c39c-5e62-4e88-824d-3e5b05ac31bf 39931","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caofangkun","name":"caofangkun","key":"caofangkun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=caofangkun&avatarId=23151","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=caofangkun&avatarId=23151","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=caofangkun&avatarId=23151","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=caofangkun&avatarId=23151"},"displayName":"caofangkun","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-12-23T01:52:24.129+0000","updated":"2013-12-23T01:52:24.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/13855764","id":"13855764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"My only issue here is that we really would want to back up the kill -15 with a kill -9 a little while later.  We cannot be sure that the process is down unless we use the -9.  But this would either mean that we have to wait a certain amount of time no matter what in between the two calls or we need a way to check if the process is still up.  I can see the check being added in later if needed, but I don't want to rely on user code to always exit cleanly when asked politely.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2013-12-23T17:02:07.760+0000","updated":"2013-12-23T17:02:07.760+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14029970","id":"14029970","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user Parth-Brahmbhatt opened a pull request:\n\n    https://github.com/apache/incubator-storm/pull/139\n\n     STORM-183: supervisor and worker should rugister with runtime for shutd...\n\n    ...own hooks. Supervisors should use kill -15 before kill -9 to allow workers to perform cleanup.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/Parth-Brahmbhatt/incubator-storm STORM-183\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/incubator-storm/pull/139.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #139\n    \n----\ncommit f15714c0a8342147c9cfe4410c86c0a325d30a4b\nAuthor: Parth-Brahmbhatt <pbrahmbhatt@hw10960.local>\nDate:   2014-06-12T22:54:34Z\n\n     STORM-183: supervisor and worker should rugister with runtime for shutdown hooks. Supervisors should use kill -15 before kill -9 to allow workers to perform cleanup.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T23:02:39.773+0000","updated":"2014-06-12T23:02:39.773+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14030862","id":"14030862","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#issuecomment-46036698\n  \n    Some changes were not pushed with the last commit so pushed them and resending now.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-13T17:16:21.530+0000","updated":"2014-06-13T17:16:21.530+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14030904","id":"14030904","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#discussion_r13763330\n  \n    --- Diff: storm-core/src/clj/backtype/storm/util.clj ---\n    @@ -412,6 +404,41 @@\n     (defn sleep-until-secs [target-secs]\n       (Time/sleepUntil (* (long target-secs) 1000)))\n     \n    +(def ^:const sig-kill 9)\n    +\n    +(def ^:const sig-term 15)\n    +\n    +(defn send-signal-to-process [pid signum]\n    --- End diff --\n    \n    With the new coding guidelines, could you put the parameter list on a separate line?\n    \n    ```\n    (defn send-signal-to-process\n      [pid signum]\n      ...)\n    ```\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-13T17:57:08.864+0000","updated":"2014-06-13T17:57:08.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14030974","id":"14030974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#discussion_r13765591\n  \n    --- Diff: storm-core/src/clj/backtype/storm/daemon/worker.clj ---\n    @@ -448,4 +448,6 @@\n     (defn -main [storm-id assignment-id port-str worker-id]  \n       (let [conf (read-storm-config)]\n         (validate-distributed-mode! conf)\n    -    (mk-worker conf nil storm-id assignment-id (Integer/parseInt port-str) worker-id)))\n    +    (.addShutdownHook (Runtime/getRuntime)\n    --- End diff --\n    \n    I'm not sure that this shutdown hook will be called in all cases.  Most places the worker code calls Runtime.halt on error, which does not call any of the shutdown hooks.  It just exits.  I think that was done because shutdown hooks can lock up, and if they do the process does not exit.  So we could get zombie processes.  Typically I have seen this addressed by installing a shutdown hook that will let the other shutdown hooks run for a maximum amount of time, at which point it calls Runtime.halt.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-13T18:38:53.165+0000","updated":"2014-06-13T18:38:53.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14031003","id":"14031003","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#discussion_r13766558\n  \n    --- Diff: storm-core/src/clj/backtype/storm/util.clj ---\n    @@ -412,6 +404,41 @@\n     (defn sleep-until-secs [target-secs]\n       (Time/sleepUntil (* (long target-secs) 1000)))\n     \n    +(def ^:const sig-kill 9)\n    +\n    +(def ^:const sig-term 15)\n    +\n    +(defn send-signal-to-process [pid signum]\n    --- End diff --\n    \n    adding this, can you also point me to the guidelines you are referring to.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-13T18:58:26.104+0000","updated":"2014-06-13T18:58:26.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14031069","id":"14031069","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#discussion_r13768469\n  \n    --- Diff: storm-core/src/clj/backtype/storm/util.clj ---\n    @@ -412,6 +404,41 @@\n     (defn sleep-until-secs [target-secs]\n       (Time/sleepUntil (* (long target-secs) 1000)))\n     \n    +(def ^:const sig-kill 9)\n    +\n    +(def ^:const sig-term 15)\n    +\n    +(defn send-signal-to-process [pid signum]\n    --- End diff --\n    \n    This was just recently merged in. The guidelines are under\n    https://github.com/apache/incubator-storm/blob/master/DEVELOPER.md#contribute-code\n    In the paragraph starting with 'Please use idiomatic Clojure style'\n    \n    For the most part it is place parameters in a separate line from the function name.  Use document strings as needed.  Don't have closing ')' on their own line.  I know we don't follow it everywhere, but we are trying to start.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-13T19:42:12.312+0000","updated":"2014-06-13T19:42:12.312+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14031252","id":"14031252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#issuecomment-46065430\n  \n    addressed comments , Would appreciate any suggestions for a better and less verbose name for function add-shutdown-hook-with-force-kill-in-1-sec.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-13T22:10:11.613+0000","updated":"2014-06-13T22:10:11.613+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14032590","id":"14032590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#issuecomment-46197891\n  \n    There are a number of merge conflicts now.  Could you please upmerge to master.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T16:02:32.840+0000","updated":"2014-06-16T16:02:32.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14032959","id":"14032959","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#issuecomment-46238986\n  \n    Ran into some weird git issues so just forked off a new repo and created a new pull request, https://github.com/apache/incubator-storm/pull/143. The fork was created like an hour ago so should not have any merge conflicts. I can merge to my master if it makes any easier for you to review.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T21:16:04.527+0000","updated":"2014-06-16T21:16:04.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033025","id":"14033025","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#issuecomment-46241120\n  \n    Could you close this pull request then, and add STORM-183 to the other one?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T21:35:37.121+0000","updated":"2014-06-16T21:35:37.121+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033032","id":"14033032","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt closed the pull request at:\n\n    https://github.com/apache/incubator-storm/pull/139\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T21:37:18.823+0000","updated":"2014-06-16T21:37:18.823+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033041","id":"14033041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#issuecomment-46241965\n  \n    closed this one, not sure what you mean by add STORM-183, do you mean adding \"STORM-183\" text as prefix to pull request and commit message?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T21:43:13.635+0000","updated":"2014-06-16T21:43:13.635+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033065","id":"14033065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#discussion_r13833165\n  \n    --- Diff: storm-core/src/clj/backtype/storm/util.clj ---\n    @@ -388,13 +388,51 @@\n         (catch IOException e\n           (log-message \"Could not extract \" dir \" from \" jarpath))))\n     \n    -(defn ensure-process-killed! [pid]\n    +(defn sleep-secs [secs]\n    +  (when (pos? secs)\n    +    (Time/sleep (* (long secs) 1000))))\n    +\n    +(defn sleep-until-secs [target-secs]\n    +  (Time/sleepUntil (* (long target-secs) 1000)))\n    +\n    +(def ^:const sig-kill 9)\n    +\n    +(def ^:const sig-term 15)\n    +\n    +(defn send-signal-to-process\n    +  [pid signum]\n    +  (try-cause\n    +    (exec-command! (str (if on-windows?\n    +                          (if (== signum sig-kill) \"taskkill /f /pid \" \"taskkill /pid \")\n    +                          (str \"kill -\" signum \" \"))\n    +                     pid))\n    +    (catch ExecuteException e\n    +      (log-message \"Error when trying to kill \" pid \". Process is probably already dead.\"))))\n    +\n    +(defn force-kill-process\n    +  [pid]\n    +  (send-signal-to-process pid sig-kill))\n    +\n    +(defn kill-process-with-sig-term\n    +  [pid]\n    +  (send-signal-to-process pid sig-term))\n    +\n    +(defn ensure-process-killed!\n    +  [pid]\n       ;; TODO: should probably do a ps ax of some sort to make sure it was killed\n       (try-cause\n    -    (exec-command! (str (if on-windows? \"taskkill /f /pid \" \"kill -9 \") pid))\n    +    (kill-process-with-sig-term pid)\n         (catch ExecuteException e\n           (log-message \"Error when trying to kill \" pid \". Process is probably already dead.\"))))\n     \n    +(defn add-shutdown-hook-with-force-kill-in-1-sec\n    --- End diff --\n    \n    I was thinking that this would not run some other function before calling sleep.  The Shutdown hook runs when the process is going to exit, if the other function gets stuck (which I was able to do in my testing) then the process never exits.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T21:59:28.408+0000","updated":"2014-06-16T21:59:28.408+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033066","id":"14033066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#discussion_r13833188\n  \n    --- Diff: storm-core/src/clj/backtype/storm/util.clj ---\n    @@ -388,13 +388,51 @@\n         (catch IOException e\n           (log-message \"Could not extract \" dir \" from \" jarpath))))\n     \n    -(defn ensure-process-killed! [pid]\n    +(defn sleep-secs [secs]\n    +  (when (pos? secs)\n    +    (Time/sleep (* (long secs) 1000))))\n    +\n    +(defn sleep-until-secs [target-secs]\n    +  (Time/sleepUntil (* (long target-secs) 1000)))\n    +\n    +(def ^:const sig-kill 9)\n    +\n    +(def ^:const sig-term 15)\n    +\n    +(defn send-signal-to-process\n    +  [pid signum]\n    +  (try-cause\n    +    (exec-command! (str (if on-windows?\n    +                          (if (== signum sig-kill) \"taskkill /f /pid \" \"taskkill /pid \")\n    +                          (str \"kill -\" signum \" \"))\n    +                     pid))\n    +    (catch ExecuteException e\n    +      (log-message \"Error when trying to kill \" pid \". Process is probably already dead.\"))))\n    +\n    +(defn force-kill-process\n    +  [pid]\n    +  (send-signal-to-process pid sig-kill))\n    +\n    +(defn kill-process-with-sig-term\n    +  [pid]\n    +  (send-signal-to-process pid sig-term))\n    +\n    +(defn ensure-process-killed!\n    +  [pid]\n       ;; TODO: should probably do a ps ax of some sort to make sure it was killed\n       (try-cause\n    -    (exec-command! (str (if on-windows? \"taskkill /f /pid \" \"kill -9 \") pid))\n    +    (kill-process-with-sig-term pid)\n         (catch ExecuteException e\n           (log-message \"Error when trying to kill \" pid \". Process is probably already dead.\"))))\n     \n    +(defn add-shutdown-hook-with-force-kill-in-1-sec\n    +  \"adds the user supplied function as a shutdown hook for cleanup.\n    +   Also adds a function that sleeps for a second and then sends kill -9 to process to avoid any zombie process in case\n    +   cleanup function hangs.\"\n    +  [func]\n    +  (.addShutdownHook (Runtime/getRuntime) (Thread. #((func)\n    +                                                     (sleep-secs 1)\n    +                                                     (force-kill-process (process-pid))))))\n    --- End diff --\n    \n    I would prefer to do a Runtime.halt here instead of force-kill-process.  I think it is more future proof.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T22:00:04.314+0000","updated":"2014-06-16T22:00:04.314+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033085","id":"14033085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user ptgoetz commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/139#issuecomment-46244421\n  \n    Yes, just prefix the title with the JIRA ID.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T22:08:12.221+0000","updated":"2014-06-16T22:08:12.221+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033088","id":"14033088","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#discussion_r13833622\n  \n    --- Diff: storm-core/src/clj/backtype/storm/util.clj ---\n    @@ -388,13 +388,51 @@\n         (catch IOException e\n           (log-message \"Could not extract \" dir \" from \" jarpath))))\n     \n    -(defn ensure-process-killed! [pid]\n    +(defn sleep-secs [secs]\n    +  (when (pos? secs)\n    +    (Time/sleep (* (long secs) 1000))))\n    +\n    +(defn sleep-until-secs [target-secs]\n    +  (Time/sleepUntil (* (long target-secs) 1000)))\n    +\n    +(def ^:const sig-kill 9)\n    +\n    +(def ^:const sig-term 15)\n    +\n    +(defn send-signal-to-process\n    +  [pid signum]\n    +  (try-cause\n    +    (exec-command! (str (if on-windows?\n    +                          (if (== signum sig-kill) \"taskkill /f /pid \" \"taskkill /pid \")\n    +                          (str \"kill -\" signum \" \"))\n    +                     pid))\n    +    (catch ExecuteException e\n    +      (log-message \"Error when trying to kill \" pid \". Process is probably already dead.\"))))\n    +\n    +(defn force-kill-process\n    +  [pid]\n    +  (send-signal-to-process pid sig-kill))\n    +\n    +(defn kill-process-with-sig-term\n    +  [pid]\n    +  (send-signal-to-process pid sig-term))\n    +\n    +(defn ensure-process-killed!\n    +  [pid]\n       ;; TODO: should probably do a ps ax of some sort to make sure it was killed\n       (try-cause\n    -    (exec-command! (str (if on-windows? \"taskkill /f /pid \" \"kill -9 \") pid))\n    +    (kill-process-with-sig-term pid)\n         (catch ExecuteException e\n           (log-message \"Error when trying to kill \" pid \". Process is probably already dead.\"))))\n     \n    +(defn add-shutdown-hook-with-force-kill-in-1-sec\n    --- End diff --\n    \n    You are right, I want to avoid a model where people have to call (.addShutdownHook blah blah) and then remember to call (add-shutdown-hook-with-force-kill-in-1-sec). \n    How about adding the use function and the actual forcing function as two seperate shutdown hook threads? \n    (defn add-shutdown-hook-with-force-kill-in-1-sec\n      [func]\n      (.addShutdownHook (Runtime/getRuntime) (Thread. #(func)))\n      (.addShutdownHook (Runtime/getRuntime) (Thread. #((sleep-secs 1)\n                                                        (.halt (RunTime/getRunTime) 20)))))\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T22:11:05.983+0000","updated":"2014-06-16T22:11:05.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033089","id":"14033089","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#discussion_r13833623\n  \n    --- Diff: storm-core/src/clj/backtype/storm/util.clj ---\n    @@ -388,13 +388,51 @@\n         (catch IOException e\n           (log-message \"Could not extract \" dir \" from \" jarpath))))\n     \n    -(defn ensure-process-killed! [pid]\n    +(defn sleep-secs [secs]\n    +  (when (pos? secs)\n    +    (Time/sleep (* (long secs) 1000))))\n    +\n    +(defn sleep-until-secs [target-secs]\n    +  (Time/sleepUntil (* (long target-secs) 1000)))\n    +\n    +(def ^:const sig-kill 9)\n    +\n    +(def ^:const sig-term 15)\n    +\n    +(defn send-signal-to-process\n    +  [pid signum]\n    +  (try-cause\n    +    (exec-command! (str (if on-windows?\n    +                          (if (== signum sig-kill) \"taskkill /f /pid \" \"taskkill /pid \")\n    +                          (str \"kill -\" signum \" \"))\n    +                     pid))\n    +    (catch ExecuteException e\n    +      (log-message \"Error when trying to kill \" pid \". Process is probably already dead.\"))))\n    +\n    +(defn force-kill-process\n    +  [pid]\n    +  (send-signal-to-process pid sig-kill))\n    +\n    +(defn kill-process-with-sig-term\n    +  [pid]\n    +  (send-signal-to-process pid sig-term))\n    +\n    +(defn ensure-process-killed!\n    +  [pid]\n       ;; TODO: should probably do a ps ax of some sort to make sure it was killed\n       (try-cause\n    -    (exec-command! (str (if on-windows? \"taskkill /f /pid \" \"kill -9 \") pid))\n    +    (kill-process-with-sig-term pid)\n         (catch ExecuteException e\n           (log-message \"Error when trying to kill \" pid \". Process is probably already dead.\"))))\n     \n    +(defn add-shutdown-hook-with-force-kill-in-1-sec\n    +  \"adds the user supplied function as a shutdown hook for cleanup.\n    +   Also adds a function that sleeps for a second and then sends kill -9 to process to avoid any zombie process in case\n    +   cleanup function hangs.\"\n    +  [func]\n    +  (.addShutdownHook (Runtime/getRuntime) (Thread. #((func)\n    +                                                     (sleep-secs 1)\n    +                                                     (force-kill-process (process-pid))))))\n    --- End diff --\n    \n    done.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T22:11:08.765+0000","updated":"2014-06-16T22:11:08.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033095","id":"14033095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46245056\n  \n    I have also hit a few situations where the kill -9 never came out.  I saw the kill -15 but not the final death blow.  I can reproduce it by launching several word count applications on a 1 node cluster, and then killing them 1 at a time (whichever one has the full 3 workers running)  Eventually I am left with several workers that refuse to die.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T22:15:34.991+0000","updated":"2014-06-16T22:15:34.991+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033116","id":"14033116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46246787\n  \n    i am trying to reproduce this but in my case the worker always ends up killing, I am testing with the new change where the force-shutdown runs in a separate thread so it is not blocked by the other shutdown hook function. How r u killing the workers? Did you make any other code changes locally to ensure workers hang around longer?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T22:35:11.079+0000","updated":"2014-06-16T22:35:11.079+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033140","id":"14033140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46248380\n  \n    When I ran I did run jstack on the workers and all of them were stuck somewhere in the shutdown.  So if you fixed the worker you would not see this.\n    \n    ```\"Thread-23\" #51 prio=5 os_prio=31 tid=0x00007f91a1059000 nid=0xb103 in Object.wait() [0x0000000193600000]\n       java.lang.Thread.State: WAITING (on object monitor)\n    \tat java.lang.Object.wait(Native Method)\n    \tat java.lang.Thread.join(Thread.java:1244)\n    \t- locked <0x000000011a65d4f8> (a java.lang.Thread)\n    \tat java.lang.Thread.join(Thread.java:1318)\n    \tat backtype.storm.util$async_loop$reify__1051.join(util.clj:486)\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    \tat java.lang.reflect.Method.invoke(Method.java:483)\n    \tat clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93)\n    \tat clojure.lang.Reflector.invokeNoArgInstanceMember(Reflector.java:298)\n    \tat backtype.storm.daemon.executor$mk_executor$reify__5504.shutdown(executor.clj:353)\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    \tat java.lang.reflect.Method.invoke(Method.java:483)\n    \tat clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93)\n    \tat clojure.lang.Reflector.invokeNoArgInstanceMember(Reflector.java:298)\n    \tat backtype.storm.daemon.worker$fn__5930$exec_fn__2806__auto____5931$shutdown_STAR___5949.invoke(worker.clj:392)\n    \tat backtype.storm.daemon.worker$fn__5930$exec_fn__2806__auto__$reify__5975.shutdown(worker.clj:423)\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    \tat java.lang.reflect.Method.invoke(Method.java:483)\n    \tat clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93)\n    \tat clojure.lang.Reflector.invokeNoArgInstanceMember(Reflector.java:298)\n    \tat backtype.storm.daemon.worker$_main$fn__6002.invoke(worker.clj:455)\n    \tat backtype.storm.util$add_shutdown_hook_with_force_kill_in_1_sec$fn__975.invoke(util.clj:433)\n    \tat clojure.lang.AFn.run(AFn.java:24)\n    \tat java.lang.Thread.run(Thread.java:744)```\n    \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T22:55:32.175+0000","updated":"2014-06-16T22:55:32.175+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033172","id":"14033172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46250710\n  \n    I have tried with both old and new code and I still can not reproduce this. I have tried killing the process with both SIGTERM and SIGINT, in both cases the process terminates.\n    \n    If you are killing in some other way or if you have some other local code change to make workers sleep during shutdown phase then let me know. \n    \n    I have checked in the change to make the final shutdown blow run in a separate thread.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-16T23:27:04.206+0000","updated":"2014-06-16T23:27:04.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14033747","id":"14033747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46302266\n  \n    I do like combining the two shutdown hooks together.\n    \n    I understand what is happening now with the leaked processes now.  I was confused about exactly what the code was supposed to be doing.\n    \n    I thought that the supervisor would send a sig term to the process, and then wait a while and send a sig kill to it.  I didn't realize that instead it was just sending a sigterm, and letting the worker send the sigkill to itself.\n    \n    The issue with not having the supervisor force-kill the child is that a bug in the worker, or in a child process the worker forks, could result in the process being leaked.  \n    \n    I don't want to do the sleep right after the sigterm, because if there are multiple workers the sleeps will add up.  I think we want to modify sync-processes in the supervisor to do 2 passes over the workers that need to be killed.  The first pass would ask the worker to exit (sigterm).  The second pass would force-kill the worker and cleanup the directories associated with it.  There could be a 1 second sleep in between if any workers were being killed (I don't want to sleep if no workers are shutting down). \n    \n    Does that sound reasonable?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-17T12:53:56.071+0000","updated":"2014-06-17T12:53:56.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14034015","id":"14034015","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46333200\n  \n    Not sure why a bug in the worker would cause leaked processes even when we already have a shutdown hook in workers that should kill it in a second but I am no expert on unix  signal processing so I will trust you on that. Added the supervisor sequence to do what you have proposed. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-17T16:44:08.242+0000","updated":"2014-06-17T16:44:08.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14034107","id":"14034107","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"It is mostly to cover all possible situations.  In unix a process can install a handler for SIGTERM and actually ignore it entirely.  But SIGKILL cannot be ignored.  The OS will not give the user process any chance to handle it.  Java handles SIGTERM and calls System.exit when it happens.  But if the shutdown handlers lock up for some reason we have effectively ignored the SIGTERM.  In my case something happened so the executor would not exit, not sure why, but this caused the shutdown to never finish. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-06-17T17:49:43.929+0000","updated":"2014-06-17T17:49:43.929+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14037574","id":"14037574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46592535\n  \n    @revans2  When you have a chance can you please review the latest change? I have implemented what you proposed in your last comment.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-19T17:41:05.669+0000","updated":"2014-06-19T17:41:05.669+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14037866","id":"14037866","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46615057\n  \n    Thanks for the update.  It looks good, but a few minor things to rearrange. Thanks for sticking with this it will be a huge benefit to storm once it is in.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-19T20:52:46.534+0000","updated":"2014-06-19T20:52:46.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14037974","id":"14037974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46622640\n  \n    Thanks for clarifying that, I forgot that is what it was doing. Looking forward to your update reordering the supervisor cleanup order.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-19T22:00:42.620+0000","updated":"2014-06-19T22:00:42.620+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14039234","id":"14039234","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46717551\n  \n    Superviosr cleanup order has been updated. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-20T19:29:51.206+0000","updated":"2014-06-20T19:29:51.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14039443","id":"14039443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-46732024\n  \n    I am a +1.  Everything seems to be working OK.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-20T22:09:47.389+0000","updated":"2014-06-20T22:09:47.389+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14042762","id":"14042762","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user ptgoetz commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-47037071\n  \n    +1\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-24T22:04:02.077+0000","updated":"2014-06-24T22:04:02.077+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14043473","id":"14043473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/143#issuecomment-47103756\n  \n    @Parth-Brahmbhatt I am going to merge this in, but I want to make sure I give the proper credit, both in the README and on the JIRA.  For now I am just including your github account, but if you want me to assign the JIRA to you and update the README please let me know which JIRA account to use.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-25T13:57:24.894+0000","updated":"2014-06-25T13:57:24.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14043479","id":"14043479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/incubator-storm/pull/143\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-25T14:03:27.312+0000","updated":"2014-06-25T14:03:27.312+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686087/comment/14043480","id":"14043480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"I merged this into master, Thanks Parth-Brahmbhatt for the pull request.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-06-25T14:04:11.978+0000","updated":"2014-06-25T14:04:11.978+0000"}],"maxResults":35,"total":35,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-183/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qx73:"}}