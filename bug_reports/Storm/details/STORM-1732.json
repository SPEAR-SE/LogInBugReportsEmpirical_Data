{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12962646","self":"https://issues.apache.org/jira/rest/api/2/issue/12962646","key":"STORM-1732","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2016-06-15T10:42:37.200+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Feb 14 04:20:20 UTC 2018","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_56894284032_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2018-02-14T04:20:20.699+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1732/watchers","watchCount":3,"isWatching":false},"created":"2016-04-26T16:22:16.703+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329843","id":"12329843","name":"1.0.0","archived":false,"released":true,"releaseDate":"2016-04-12"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-02-14T04:20:20.733+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"*Lets say a worker has been started by the supervisor*\n\n2016-04-26 16:11:48.716 [o.a.s.d.supervisor] INFO: Launching worker with assignment {:storm-id \"Lightning-1-1461683473\", :executors [[12 12] [54 54] [42 42] [24 24] [18 18] [6 6] [48 48] [30 30] [36 36]], :resources #object[org.apache.storm.generated.WorkerResources 0x10bac1e4 \"WorkerResources(mem_on_heap:0.0, mem_off_heap:0.0, cpu:0.0)\"]} for this supervisor 477ae22e-1a2b-4ea3-afd5-cb969f25e732 on port 6700 with id a5d51626-6e9f-4614-9ebb-a6263c140ca2\n2016-04-26 16:11:48.727 [o.a.s.d.supervisor] INFO: Launching worker with command: 'C:\\LightningDeployment\\Java\\bin\\java' '-cp' ........ \n2016-04-26 16:11:48.910 [o.a.s.config] INFO: SET worker-user a5d51626-6e9f-4614-9ebb-a6263c140ca2 LIGHTNINGVM14$\n\n\n*note this bit is is new for storm 1.0.0*\n\n\n2016-04-26 16:11:49.405 [o.a.s.d.supervisor] INFO: Creating symlinks for worker-id: a5d51626-6e9f-4614-9ebb-a6263c140ca2 storm-id: Lightning-1-1461683473 to its port artifacts directory\n2016-04-26 16:11:50.251 [o.a.s.d.supervisor] INFO: Creating symlinks for worker-id: a5d51626-6e9f-4614-9ebb-a6263c140ca2 storm-id: Lightning-1-1461683473 for files(1): (\"resources\")\n\n\n\n*When a worker dies we correctly see some clean up and a new worker started...*\n\n\n\n2016-04-26 16:15:35.520 [o.a.s.d.supervisor] INFO: Worker Process a5d51626-6e9f-4614-9ebb-a6263c140ca2 exited with code: 20\n2016-04-26 16:15:39.674 [o.a.s.d.supervisor] INFO: Worker Process a5d51626-6e9f-4614-9ebb-a6263c140ca2 has died!\n2016-04-26 16:15:39.675 [o.a.s.d.supervisor] INFO: Shutting down and clearing state for id a5d51626-6e9f-4614-9ebb-a6263c140ca2. Current supervisor time: 1461683739. State: :timed-out, Heartbeat: {:time-secs 1461683734, :storm-id \"Lightning-1-1461683473\", :executors [[12 12] [54 54] [42 42] [24 24] [18 18] [6 6] [48 48] [30 30] [-1 -1] [36 36]], :port 6700}\n2016-04-26 16:15:39.676 [o.a.s.d.supervisor] INFO: Shutting down 477ae22e-1a2b-4ea3-afd5-cb969f25e732:a5d51626-6e9f-4614-9ebb-a6263c140ca2\n2016-04-26 16:15:39.676 [o.a.s.config] INFO: GET worker-user a5d51626-6e9f-4614-9ebb-a6263c140ca2\n2016-04-26 16:15:39.677 [o.a.s.d.supervisor] INFO: Worker Process a5d51626-6e9f-4614-9ebb-a6263c140ca2 has died!\n2016-04-26 16:15:39.681 [o.a.s.d.supervisor] INFO: Worker Process a5d51626-6e9f-4614-9ebb-a6263c140ca2 has died!\n2016-04-26 16:15:39.857 [o.a.s.util] INFO: Error when trying to kill 1352. Process is probably already dead.\n2016-04-26 16:15:39.955 [o.a.s.util] INFO: Error when trying to kill 2372. Process is probably already dead.\n2016-04-26 16:15:40.009 [o.a.s.util] INFO: Error when trying to kill 4932. Process is probably already dead.\n2016-04-26 16:15:40.009 [o.a.s.d.supervisor] INFO: Sleep 10 seconds for execution of cleanup threads on worker.\n2016-04-26 16:15:49.677 [o.a.s.d.supervisor] INFO: Worker Process a5d51626-6e9f-4614-9ebb-a6263c140ca2 has died!\n2016-04-26 16:15:49.679 [o.a.s.d.supervisor] INFO: Worker Process a5d51626-6e9f-4614-9ebb-a6263c140ca2 has died!\n2016-04-26 16:15:50.056 [o.a.s.util] INFO: Error when trying to kill 1352. Process is probably already dead.\n2016-04-26 16:15:50.119 [o.a.s.util] INFO: Error when trying to kill 2372. Process is probably already dead.\n2016-04-26 16:15:50.175 [o.a.s.util] INFO: Error when trying to kill 4932. Process is probably already dead.\n2016-04-26 16:15:50.257 [o.a.s.config] INFO: REMOVE worker-user a5d51626-6e9f-4614-9ebb-a6263c140ca2\n2016-04-26 16:15:50.257 [o.a.s.d.supervisor] INFO: Shut down 477ae22e-1a2b-4ea3-afd5-cb969f25e732:a5d51626-6e9f-4614-9ebb-a6263c140ca2\n2016-04-26 16:15:50.257 [o.a.s.d.supervisor] INFO: Launching worker with assignment {:storm-id \"Lightning-1-1461683473\", :executors [[12 12] [54 54] [42 42] [24 24] [18 18] [6 6] [48 48] [30 30] [36 36]], :resources #object[org.apache.storm.generated.WorkerResources 0x20e1ad4f \"WorkerResources(mem_on_heap:0.0, mem_off_heap:0.0, cpu:0.0)\"]} for this supervisor 477ae22e-1a2b-4ea3-afd5-cb969f25e732 on port 6700 with id e413447b-c9ca-417d-8e55-e10dd0edc6a4\n\n\n*When the worker has been cleaned up, it seems the folders that the symlinks are pointing to are also cleaned (this maybe a windows only problem)*\n\n*This is bad as it deletes the contents of the \"resources\" directory and hence any multilang stuff that was in those directories*\n\n*also I think STORM-876 introduced this problem*","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12801006","id":"12801006","filename":"potentalFix.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairywelly","name":"hairywelly","key":"hairywelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"gareth smith","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-27T12:27:04.741+0000","size":1453,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12801006/potentalFix.patch"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Resources are deleted when worker dies","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairywelly","name":"hairywelly","key":"hairywelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"gareth smith","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairywelly","name":"hairywelly","key":"hairywelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"gareth smith","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Windows","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12962646/comment/15260043","id":"15260043","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairywelly","name":"hairywelly","key":"hairywelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"gareth smith","active":true,"timeZone":"Etc/UTC"},"body":"I've added what I think would be a potential fix\nI've tested this locally and it fixes the bug\nnote The deleteRecursiveIfExists function (that tests for symlinks and doesn't recurse through them) may have an equivalent in some other library...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairywelly","name":"hairywelly","key":"hairywelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"gareth smith","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-27T12:27:04.746+0000","updated":"2016-04-27T12:27:04.746+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12962646/comment/15331520","id":"15331520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=simon.whittemore%40gmail.com","name":"simon.whittemore@gmail.com","key":"simon.whittemore@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Whittemore","active":true,"timeZone":"Etc/UTC"},"body":"I think we are seeing this issue as well, also running on Windows, storm 1.0.1.\n\nWe can reproduce this issue by \"rebalancing\" the topology, subsequent to this, some of our multilang resource files are missing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=simon.whittemore%40gmail.com","name":"simon.whittemore@gmail.com","key":"simon.whittemore@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Whittemore","active":true,"timeZone":"Etc/UTC"},"created":"2016-06-15T10:42:37.200+0000","updated":"2016-06-15T10:42:37.200+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12962646/comment/16088082","id":"16088082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"body":"[~hairywelly] Please open a PR at https://github.com/apache/storm. There's much better chance of someone reviewing your fix there, and it'll also get run through our CI setup. Thanks :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"created":"2017-07-14T21:15:32.604+0000","updated":"2017-07-14T21:15:32.604+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12962646/comment/16363460","id":"16363460","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"We introduced Supervisor V2 in 1.0.3 which completely renew the code on Supervisor. We don't track old supervisor issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2018-02-14T04:20:20.722+0000","updated":"2018-02-14T04:20:20.722+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1732/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2wrcn:"}}