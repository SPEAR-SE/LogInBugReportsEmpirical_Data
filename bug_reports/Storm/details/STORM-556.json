{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12755322","self":"https://issues.apache.org/jira/rest/api/2/issue/12755322","key":"STORM-556","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327112","id":"12327112","name":"0.9.3","archived":false,"released":true,"releaseDate":"2014-11-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2014-11-15T03:07:12.256+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Dec 05 03:22:10 UTC 2014","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1787541553_*|*_4_*:*_1_*:*_15256_*|*_6_*:*_2_*:*_26604278484","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2015-10-09T01:27:04.363+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-556/watchers","watchCount":3,"isWatching":false},"created":"2014-11-14T10:49:49.094+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["ClientID","hangup","netty"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326452","id":"12326452","name":"0.9.2-incubating","archived":false,"released":true,"releaseDate":"2014-06-25"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxw","name":"fxw","key":"fxw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xavier Fu","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T01:27:04.385+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"if a storm worker die then restarted and the nimbus  reassign the task on the restarted worker with same host:port， the upstream task will not reconnect the host:port and the topology will hang up。\n\nbecause the connect has broken and netty Client flush timer \nif (null != channel && channel.isWritable()) {\n                            flush(channel);\n}\nalways false.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"netty Client  reconnect bug","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxw","name":"fxw","key":"fxw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xavier Fu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxw","name":"fxw","key":"fxw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xavier Fu","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12755322/comment/14213303","id":"14213303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"I response it based on current master, so you can checkout current master and see it helps.\n\n(Need citation)\n\nIf channelRef is null, it does reconnect when task have a message to send (by send() method).\n\nhttp://netty.io/4.0/api/io/netty/channel/Channel.html#isWritable()\nhttp://stackoverflow.com/questions/11786528/can-a-netty-nio-channel-be-writable-but-not-connected#comment15913035_11791721\n\nSeems like isWritable() return false if and only if write buffer is full. It doesn't check socket is broken.\n\nSo I think it doesn't always false.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2014-11-15T03:07:12.256+0000","updated":"2014-11-15T03:07:12.256+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12755322/comment/14214308","id":"14214308","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxw","name":"fxw","key":"fxw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xavier Fu","active":true,"timeZone":"Etc/UTC"},"body":"the channelRef  will not be null.\nAlso the netty event loop close the socket,  but th Client don't register any callback to monitor the socket close event,  so the channelRef  is pointing to a closed channel,  and the send() fuction pass to add message to buffer。\n\nI have writed code to test Netty isWritable().\nAfter  connected the server, test program sleep then I shutdown the server. when the test program wake up,  the result is:\n\nconnect OK\nnowritable\nnoconnected\n\n\n{code:title=testNetty.java|borderStyle=solid}\n        @Test\n\tpublic void testNetty() {\n\t\tThreadFactory bossFactory = new NettyRenameThreadFactoryX(\"client\"\n\t\t\t\t+ \"-boss\");\n\t\tThreadFactory workerFactory = new NettyRenameThreadFactoryX(\"client\"\n\t\t\t\t+ \"-worker\");\n\t\tNioClientSocketChannelFactory factory = new NioClientSocketChannelFactory(\n\t\t\t\tExecutors.newCachedThreadPool(bossFactory),\n\t\t\t\tExecutors.newCachedThreadPool(workerFactory), 2);\n\t\tClientBootstrap bootstrap = new ClientBootstrap(factory);\n\t\tbootstrap.setOption(\"tcpNoDelay\", true);\n\t\tbootstrap.setOption(\"sendBufferSize\", 10000);\n\t\tbootstrap.setOption(\"keepAlive\", true);\n\n\t\t// Set up the pipeline factory.\n\t\tbootstrap.setPipelineFactory(new StormClientPipelineFactoryX());\n\n\t\t// Start the connection attempt.\n\t\tInetSocketAddress remote_addr = new InetSocketAddress(\n\t\t\t\t\"XXX.XXX.XXX.XXX\", 1234);\n\t\tChannelFuture future = bootstrap.connect(remote_addr);\n\t\tfuture.awaitUninterruptibly();\n\t\tChannel current = future.getChannel();\n\t\tif (!future.isSuccess()) {\n\t\t\tif (null != current) {\n\t\t\t\tcurrent.close();\n\t\t\t}\n\t\t} else {\n\n\t\t\tSystem.out.println(\"connect OK\");\n\t\t}\n\t\ttry {\n\t\t\tThread.sleep(1000 * 10);\n\t\t} catch (InterruptedException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\te.printStackTrace();\n\t\t}\n\n\t\tif (current.isWritable()) {\n\t\t\tSystem.out.println(\"writable\");\n\t\t} else {\n\t\t\tSystem.out.println(\"nowritable\");\n\t\t}\n\n\t\tif (current.isConnected()) {\n\t\t\tSystem.out.println(\"connected\");\n\t\t} else {\n\t\t\tSystem.out.println(\"noconnected\");\n\t\t}\n\t}\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxw","name":"fxw","key":"fxw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xavier Fu","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-17T06:01:15.728+0000","updated":"2014-11-17T07:11:59.138+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12755322/comment/14235004","id":"14235004","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxw","name":"fxw","key":"fxw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xavier Fu","active":true,"timeZone":"Etc/UTC"},"body":"https://issues.apache.org/jira/browse/STORM-406","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxw","name":"fxw","key":"fxw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xavier Fu","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-05T03:22:10.629+0000","updated":"2014-12-05T03:22:10.629+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-556/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i22div:"}}