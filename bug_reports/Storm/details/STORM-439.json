{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12732130","self":"https://issues.apache.org/jira/rest/api/2/issue/12732130","key":"STORM-439","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327112","id":"12327112","name":"0.9.3","archived":false,"released":true,"releaseDate":"2014-11-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-08-05T21:39:24.209+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 07 19:29:28 UTC 2014","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5438530453_*|*_5_*:*_1_*:*_0","customfield_12310420":"410159","customfield_12312321":null,"resolutiondate":"2014-10-07T19:28:10.008+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-439/watchers","watchCount":6,"isWatching":false},"created":"2014-08-05T20:45:59.603+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326452","id":"12326452","name":"0.9.2-incubating","archived":false,"released":true,"releaseDate":"2014-06-25"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-05T01:57:55.763+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"We recently upgraded to 0.9.2 from 0.8.2 or so. One of our topologies had a percent encoded value in the id 'destination%F5backfill' (or interpreted 'destination_backfill'). The UI is unable to view this topology giving us the error,\n\n{code}\nNotAliveException(msg:destination_backfill-2-1407261676)\nat backtype.storm.generated.Nimbus$getTopologyInfo_result.read(Nimbus.java:11347)\n\tat org.apache.thrift7.TServiceClient.receiveBase(TServiceClient.java:78)\n\tat backtype.storm.generated.Nimbus$Client.recv_getTopologyInfo(Nimbus.java:491)\n\tat backtype.storm.generated.Nimbus$Client.getTopologyInfo(Nimbus.java:478)\n\tat backtype.storm.ui.core$topology_page.invoke(core.clj:587)\n\tat backtype.storm.ui.core$fn__8229.invoke(core.clj:796)\n\tat compojure.core$make_route$fn__3365.invoke(core.clj:93)\n\tat compojure.core$if_route$fn__3353.invoke(core.clj:39)\n\tat compojure.core$if_method$fn__3346.invoke(core.clj:24)\n\tat compojure.core$routing$fn__3371.invoke(core.clj:106)\n\tat clojure.core$some.invoke(core.clj:2443)\n\tat compojure.core$routing.doInvoke(core.clj:106)\n\tat clojure.lang.RestFn.applyTo(RestFn.java:139)\n\tat clojure.core$apply.invoke(core.clj:619)\n\tat compojure.core$routes$fn__3375.invoke(core.clj:111)\n\tat ring.middleware.reload$wrap_reload$fn__7540.invoke(reload.clj:14)\n\tat backtype.storm.ui.core$catch_errors$fn__8268.invoke(core.clj:858)\n\tat ring.middleware.keyword_params$wrap_keyword_params$fn__4029.invoke(keyword_params.clj:27)\n\tat ring.middleware.nested_params$wrap_nested_params$fn__4068.invoke(nested_params.clj:65)\n\tat ring.middleware.params$wrap_params$fn__4001.invoke(params.clj:55)\n\tat ring.middleware.multipart_params$wrap_multipart_params$fn__4096.invoke(multipart_params.clj:103)\n\tat ring.middleware.flash$wrap_flash$fn__4277.invoke(flash.clj:14)\n\tat ring.middleware.session$wrap_session$fn__4266.invoke(session.clj:43)\n\tat ring.middleware.cookies$wrap_cookies$fn__4197.invoke(cookies.clj:160)\n\tat ring.adapter.jetty$proxy_handler$fn__7179.invoke(jetty.clj:16)\n\tat ring.adapter.jetty.proxy$org.mortbay.jetty.handler.AbstractHandler$0.handle(Unknown Source)\n\tat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\n\tat org.mortbay.jetty.Server.handle(Server.java:326)\n\tat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\n\tat org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:928)\n\tat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:549)\n\tat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)\n\tat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\n\tat org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:228)\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\n{code}\n\nSo it seems the UI is translating the percent encoded value which causes this issue. We shouldn't be putting these values in our topologies id in the first place but thought I would log this to see if you wanted to try to limit what characters are allowed in a topology id.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"410152","customfield_12312823":null,"summary":"UI unable to view topologies with percent encoded values in id","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbaugher","name":"bbaugher","key":"bbaugher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Baugher","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbaugher","name":"bbaugher","key":"bbaugher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Baugher","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14086834","id":"14086834","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~bbaugher] are you able to see the above topology name \"destination_backfill\" in UI main page(/index.html) as part of topology summary section. NotAliveException thrown if it can't find the topology name for a given topology id .","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-05T21:39:24.209+0000","updated":"2014-08-05T21:39:24.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14086841","id":"14086841","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbaugher","name":"bbaugher","key":"bbaugher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Baugher","active":true,"timeZone":"Etc/UTC"},"body":"Yes I see the topology as part of the main page but its id is 'destination%F5backfill'. Following the link gives me that error because it changes the id.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbaugher","name":"bbaugher","key":"bbaugher","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Baugher","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-05T21:45:28.461+0000","updated":"2014-08-05T21:45:28.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14086870","id":"14086870","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"body":"[~bbaugher] Thanks.  I am able to reproduce this. We should encode these at the nimbus level. I'll send a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sriharsha","name":"sriharsha","key":"sriharsha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sriharsha Chintalapani","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-05T22:06:46.393+0000","updated":"2014-08-05T22:06:46.393+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14087774","id":"14087774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagit","name":"dagit","key":"dagit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagit&avatarId=25742","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagit&avatarId=25742","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagit&avatarId=25742","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagit&avatarId=25742"},"displayName":"Derek Dagit","active":true,"timeZone":"America/Chicago"},"body":"1) For me, the string \"destination%5Fbackfill\" breaks on master now because the back-end is looking for the decoded '_'.\n\n2) Interestingly, the string \"destination%F5backfill\" breaks on master, but not because the encoding did not happen; it breaks on the client side because %F5 (not %5F as perhaps you meant) does not actually decode.  The error comes from purl.js, where it tries to parse the URI to get the topology ID, but the string is not able to parse the %F5.\n\nYou can see it happen when you call decodeURI('%F5').  When you decodeURI('%5F'), you just get the underscore.\n\nIt seems we 1) are decoding when we shouldn't and 2) neglecting to encode when we should.\n\nI agree that using either string in a topology name are valid use cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagit","name":"dagit","key":"dagit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagit&avatarId=25742","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagit&avatarId=25742","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagit&avatarId=25742","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagit&avatarId=25742"},"displayName":"Derek Dagit","active":true,"timeZone":"America/Chicago"},"created":"2014-08-06T15:12:45.425+0000","updated":"2014-08-06T15:12:45.425+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14106480","id":"14106480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"body":"For me the destination_backfill works just fine. \n\nAs Derek pointed out destination%5Fbackfill fails, but that is not really a nimbus issue. The client is sending a get request with already decoded url so client sends denstination_backfill which is what master looks for and fails. The decoding happens as part of topology.html which tries to construct a new url by decoding the windows own url using purl.js\n\ndestination%F5backfill fails because purl.js is trying to decode a non encoded string. \n\nEven if we encode the url on server side , purl.js decodes it twice once during the data: phase and then during the param: extraction phase. So for a string like Even if we encode the url on server side , purl.js decodes it twice so destination%5Fbackfill is encoded to destination%255Fbackfill on server side. This gets decoded twice on client side converting to original destination%5Fbackfill in the first data phase and then to destination_backfill which is the string sent to nimbus.\n\nWe either need to fix purl.js library or move to ajax.url. I haven't yet had success with ajax.url but not sure what the root cause is in that library.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-22T05:20:48.186+0000","updated":"2014-08-22T05:20:48.186+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14110381","id":"14110381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"body":"I have opened up an issue https://github.com/allmarkedup/purl/issues/86 for fixing the purl.js bug in the purl.js repo.  \n\nIn the mean time I have started using an alternative library, jquery's url plugin http://plugins.jquery.com/url/.\n\nI found a bug on the server side code due to which we were double decoding the url params. Once during clout.core's CompiledRoute method and then in our ui/core.clj in all the Get and Post methods. This bug again results in the same effect as the bug in purl.js. I have removed the decoding from core.clj. Please let me know if you want me to open a separate issue for the bug.\n\nAs we are using mustache templates with anchor tags there is no way to encode topologyids on client side without either moving away from mustache or replacing all anchor tags with some jquery onclick binding. If we just send the encoded id's back to client then both, the anchor tag and the user's display text, appears encoded. To overcome this I had to update the response on the server side to include both the encoded and normal ids. \n\nI have tested the ui locally with topology name = destination%@#$^*-_=+backfill. I will send a pull request shortly. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=parth.brahmbhatt","name":"parth.brahmbhatt","key":"parth.brahmbhatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Parth Brahmbhatt","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-26T06:37:03.719+0000","updated":"2014-08-26T06:37:03.719+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14110401","id":"14110401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user Parth-Brahmbhatt opened a pull request:\n\n    https://github.com/apache/incubator-storm/pull/242\n\n    STORM-439: Replace purl.js with jquery url plugin to support special cha...\n\n    ...racters in topology names.\n    \n    BugFix: Remove double decoding from the ui server, currently the decoding happens as part of clout.core.clj and ui.core.clj. Removed the decoding from ui.core.clj.\n    Encode all url components on server side. Added the encodedId as response param to ensure the url from client side uses encoded component but the user still sees unencoded value.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/Parth-Brahmbhatt/incubator-storm STORM-439\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/incubator-storm/pull/242.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #242\n    \n----\ncommit c0eec64c74a97ff8a1ba28488a5c2775f4f81bfd\nAuthor: Parth Brahmbhatt <brahmbhatt.parth@gmail.com>\nDate:   2014-08-26T04:12:50Z\n\n    STORM-439: Replace purl.js with jquery url plugin to support special characters in topology names.\n    BugFix: Remove double decoding from the ui server, currently the decoding happens as part of clout.core.clj and ui.core.clj. Removed the decoding from ui.core.clj.\n    Encode all url components on server side. Added the encodedId as response param to ensure the url from client side uses encoded component but the user still sees unencoded value.\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-26T06:49:55.548+0000","updated":"2014-08-26T06:49:55.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14110719","id":"14110719","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/242#discussion_r16714479\n  \n    --- Diff: storm-core/src/clj/backtype/storm/ui/core.clj ---\n    @@ -424,7 +424,7 @@\n                              (if bolt-summs\n                                (mapfn bolt-summs)\n                                (mapfn spout-summs)))\n    -                :link (url-format \"/component.html?id=%s&topology_id=%s\" id storm-id)\n    +                :link (url-format \"/component.html?id=%s&topology_id=%s\" (url-encode id) (url-encode storm-id))\n    --- End diff --\n    \n    Why do we need to double encode the id and storm-id?  url-format already encodes them once.\n    \n    ```\n    (defn url-format [fmt & args]\n      (String/format fmt\n        (to-array (map #(url-encode (str %)) args))))\n    ```\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-26T14:00:34.867+0000","updated":"2014-08-26T14:00:34.867+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14110741","id":"14110741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/242#issuecomment-53427732\n  \n    OK so mustache will do HTML escaping with the ```{{var}}``` like syntax, but it will not do URL encoding. So we have added in URL encoded ids to the result of the REST APIs to allow us to not bother with doing the URL encoding in the browser.  That seems OK I guess.  But why are we not url decoding the url parameters in the REST API any more?  Is it because the ring framework already decodes them for us?  And I am really confused why in the visualization-data function we need to double url encode the ids in the link? From the look of it, it is because we take those parameters and place them in a new URL for the rest call.  I would much rather have the browser encode them again when making them a part of the URL.  encodeURIComponent should be what we want and is a standard part of javascript.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-26T14:23:11.584+0000","updated":"2014-08-26T14:23:11.584+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14110747","id":"14110747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/242#issuecomment-53428003\n  \n    Oh and if we don't need/use purl any more we should remove it and the license section for it.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-26T14:24:54.826+0000","updated":"2014-08-26T14:24:54.826+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14110952","id":"14110952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on a diff in the pull request:\n\n    https://github.com/apache/incubator-storm/pull/242#discussion_r16726994\n  \n    --- Diff: storm-core/src/clj/backtype/storm/ui/core.clj ---\n    @@ -424,7 +424,7 @@\n                              (if bolt-summs\n                                (mapfn bolt-summs)\n                                (mapfn spout-summs)))\n    -                :link (url-format \"/component.html?id=%s&topology_id=%s\" id storm-id)\n    +                :link (url-format \"/component.html?id=%s&topology_id=%s\" (url-encode id) (url-encode storm-id))\n    --- End diff --\n    \n    I missed this , I just blindly went through all the urls and encoded the components. Not sure why in my testing I was not able to catch this though. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-26T17:06:16.663+0000","updated":"2014-08-26T17:06:16.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14110954","id":"14110954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/incubator-storm/pull/242#issuecomment-53454343\n  \n    Our mustache templates have anchor tags where we just do the following \n    \n    <a href=\"/topology.html?id={{id}}\">{{name}}</a>\n    \n    As you already mentioned mustache does the escaping but not encoding. So the above results in unencoded url which results in the bug that we are trying to fix.  I have tried reading through mustache docs and googling around to see if there is any way to invoke javascript functions like encodeURIComponent as part of mustache template and I haven't had much luck. The only suggestion was to send lambda constructs as response from server side which is no different then just sending encoded components. There are 3 other alternatives that I could think of:\n    \n    1) Encode and server side, which is what we are doing right now.\n    2)  Process the json on browser side before rendering using mustache. Pretty much the same thing as above but the client will have to loop through json response twice once to encode and once to render using mustache.\n    3) Use a more powerful library than mustache or replace all anchor tags with some div's with onclick being handled by jquery. \n    \n    The easiest of 3 was the 1st option so I went with it. That said, I am not sure what are the general best practices so I don't mind changing it to option 2 or 3 or any other idea that someone else can propose.\n    \n    The URL decoding happens as part of https://github.com/weavejester/clout/blob/master/src/clout/core.clj#L96\n    So the decoding on our side results in a bug. \n    \n    test%5Ftest -> browser sends encoded test%255Ftest -> clout decodes to test%5Ftest -> our code decodes again and tries to look for test_test topology which is not alive. \n    \n    I can remove the purl.js but I am not sure which library is actually better so if anyone has any comparison points please let me know. I am planning to fix the purl.js bug so if the change request gets approved we can always revert back to it. \n    \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-26T17:06:21.917+0000","updated":"2014-08-26T17:06:21.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14146777","id":"14146777","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/storm/pull/242#issuecomment-56726151\n  \n    I am really sorry that it took me so long to look at this again since you made the last commit.  It looks great. But now it needs to be upmerged because some of the templates were reformatted.  Again looks great +1.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-24T19:37:08.708+0000","updated":"2014-09-24T19:37:08.708+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14146859","id":"14146859","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Parth-Brahmbhatt commented on the pull request:\n\n    https://github.com/apache/storm/pull/242#issuecomment-56735833\n  \n    upmerged.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-24T20:46:01.282+0000","updated":"2014-09-24T20:46:01.282+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14149607","id":"14149607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user revans2 commented on the pull request:\n\n    https://github.com/apache/storm/pull/242#issuecomment-56985857\n  \n    +1 looks great.  Give a few more days for others to comment on the upmerge.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-26T16:32:46.567+0000","updated":"2014-09-26T16:32:46.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14154174","id":"14154174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user harshach commented on the pull request:\n\n    https://github.com/apache/storm/pull/242#issuecomment-57407000\n  \n    +1 looks good. Tested this on a cluster.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-01T01:18:22.790+0000","updated":"2014-10-01T01:18:22.790+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14154294","id":"14154294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user ptgoetz commented on the pull request:\n\n    https://github.com/apache/storm/pull/242#issuecomment-57415388\n  \n    +1 If no one minds, I'd like to merge this one so I can verify the licensing is correct (no code changed).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-01T03:42:57.130+0000","updated":"2014-10-01T03:42:57.130+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12732130/comment/14162370","id":"14162370","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/242\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-07T19:29:28.209+0000","updated":"2014-10-07T19:29:28.209+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-439/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ykgv:"}}