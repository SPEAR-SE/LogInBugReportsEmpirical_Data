{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12736289","self":"https://issues.apache.org/jira/rest/api/2/issue/12736289","key":"STORM-467","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-08-25T19:06:07.051+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Aug 25 22:08:58 UTC 2014","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-467/watchers","watchCount":4,"isWatching":false},"created":"2014-08-23T22:10:37.060+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326452","id":"12326452","name":"0.9.2-incubating","archived":false,"released":true,"releaseDate":"2014-06-25"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-09-29T02:58:33.155+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"When issuing the storm jar command, the command will launch with some cached version of the jar contents even if no jar file is now present at the location specified on the command line. This should instead cause an error so that a user is actually running what they think they are.\n\nThe second part of this is that some part of storm is caching topology classes so that when debugging errors, old code is executed instead of the new version of a class. I would argue that storm should attempt to destroy cached topology classes if presented with a new version or when an active topology is terminated. Again this is to avoid running versions of code that are not those which have been specified.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12664195","id":"12664195","filename":"Exclamation.jar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"created":"2014-08-25T19:47:21.516+0000","size":3097,"mimeType":"application/java-archive","content":"https://issues.apache.org/jira/secure/attachment/12664195/Exclamation.jar"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12664196","id":"12664196","filename":"Exclamation2.jar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"created":"2014-08-25T19:47:21.521+0000","size":1991,"mimeType":"application/java-archive","content":"https://issues.apache.org/jira/secure/attachment/12664196/Exclamation2.jar"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12664197","id":"12664197","filename":"ExclamationBolt.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"created":"2014-08-25T19:47:21.526+0000","size":973,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12664197/ExclamationBolt.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12664198","id":"12664198","filename":"ExclamationTopology.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"created":"2014-08-25T19:47:21.531+0000","size":2251,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12664198/ExclamationTopology.java"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"storm jar executes non-existant or old jar files and classes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"debian linux wheezy and squeeze with java 1.7.0_67","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736289/comment/14109521","id":"14109521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"[~longtimer] I agree that we should have an error if jar is not found.  When you run {code}storm jar{code} it sets the classpath to be more or less the same as \n\n{code}\n`storm classpath`:$JAR\n{code}\n\nso if you specified your class name properly java should blow up with a class not found exception. The only way I can think of to make it run an older version of your code it to explicitly point it to an older version of the code, but I could be wrong. Also when we run a  worker process the jar used is associated with the topology-id.  We cache it, but only for workers that are a part o the exact same topology instance.  Do you have a reproducible use case that we can use to debug this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-08-25T19:06:07.051+0000","updated":"2014-08-25T19:06:07.051+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736289/comment/14109630","id":"14109630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"body":"A simple example to demonstrate the problem is the following:\n\nUse a version of the ExclamationTopology class where the ExclamationBolt is extracted to its own class. Create one jar, Exclamation.jar, with both classes included. Create a second jar, Exclamation2.jar, with only the ExclamationTopology class included.\n\nRun the first jar in storm and then kill it from the UI after a few minutes from the UI:\n\nstorm jar /home/jason/storm/application/Exclamation.jar com.server.analyzing.test.ExclamationTopology test\n\nNext run the second jar in storm and then kill it from the UI after a few minutes from the UI:\n\nstorm jar /home/jason/storm/application/Exclamation2.jar com.server.analyzing.test.ExclamationTopology test\n\nThe second jar lacks the important ExclamationBolt class but runs in my installation on debian because it references some cached version of the class. No error is raised that I see. The storm installation is simply a download and extract of the tar.gz from the apache storm website.\n\nThis is not the only scenario, but a simple one to create. The more difficult scenario is when a class is updated with new functionality but an old version of the class runs instead of the updated version. I am running with the Oracle JDK.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"created":"2014-08-25T19:47:21.536+0000","updated":"2014-08-25T19:47:21.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736289/comment/14109693","id":"14109693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"I think I have figured this out, but I am not totally sure.  Where do you have storm installed? and where have you placed your copies of Exclamation.jar and Exclamation2.jar?\n\nboth storm classpath and storm jar will add all jars in STORM_HOME and STORM_HOME/lib to the classpath.  For me when I downloaded your jars that meant that both Exclamation jars were at the head of the classpath.  When I moved them to a different directory everything worked as expected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-08-25T20:48:08.232+0000","updated":"2014-08-25T20:48:08.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736289/comment/14109811","id":"14109811","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"body":"I am not sure what STORM_HOME refers to. There is no environment variable that I see like that. Do you mean STORM_DIR as per the storm python script? In any case, I have storm in /usr/local/bin/apache-storm-0.9.2-incubating and it contains bin, lib, conf, README.markdown, etc.\n\nThe test files are in a subdirectory of my home directory /home/jason/storm/application and storm.local.dir from the storm.yaml file is set to be /home/jason/storm.\n\nHowever, if I move my code out of /home/jason/storm/application to /tmp/application and launch pointing to the new location, the problem still remains and I am able to launch even though the class is not present. Even if I remove the jar containing the class completely from the node, the topology still runs with a cached version of the bolt class.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"created":"2014-08-25T21:52:59.712+0000","updated":"2014-08-25T21:54:00.374+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736289/comment/14109837","id":"14109837","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Yes sorry STORM_HOME I saw referring to the location where storm is installed STORM_DIR.\n\nThanks for responding then what I found is not what you are seeing and I have not been able to reproduce the problem yet.  I will keep trying.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-08-25T22:06:35.825+0000","updated":"2014-08-25T22:06:35.825+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736289/comment/14109840","id":"14109840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"body":"I think that this is an issue of cache cleanup. However, if there is a possibility for mismatches due to merged classpaths, it would make sense to actively seek these out and issue a warning given the number of classes that storm will load on its own. I remember seeing an application sometime back that just populated a HashMap with the fully qualified class name as the key and the source directory of the jar as the value. When hashing found a duplicate, a warning was raised so that a person knew which two jars conflicted. Just a thought.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=longtimer","name":"longtimer","key":"longtimer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Kania","active":true,"timeZone":"America/Toronto"},"created":"2014-08-25T22:08:58.807+0000","updated":"2014-08-25T22:08:58.807+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-467/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1z9ov:"}}