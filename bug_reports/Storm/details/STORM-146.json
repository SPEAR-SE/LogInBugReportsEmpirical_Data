{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12684773","self":"https://issues.apache.org/jira/rest/api/2/issue/12684773","key":"STORM-146","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326452","id":"12326452","name":"0.9.2-incubating","archived":false,"released":true,"releaseDate":"2014-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2013-12-15 06:20:08.704","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_7553609211_*|*_5_*:*_1_*:*_0","customfield_12310420":"363845","customfield_12312321":null,"resolutiondate":"2014-03-12T16:33:37.879+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-146/watchers","watchCount":1,"isWatching":false},"created":"2013-12-15T06:20:08.704+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[{"id":"12382632","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12382632","type":{"id":"12310060","name":"Container","inward":"Is contained by","outward":"contains","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310060"},"inwardIssue":{"id":"12693914","key":"STORM-216","self":"https://issues.apache.org/jira/rest/api/2/issue/12693914","fields":{"summary":"Secure Multi-tenant Storm","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/14","id":"14","description":"An overarching type made of sub-tasks","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21130&avatarType=issuetype","name":"Umbrella","subtask":false,"avatarId":21130}}}}],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T01:00:36.738+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"https://github.com/nathanmarz/storm/issues/480\n\ncommit d0473a06a32815e1945b2fffe5af395fb9432192\nAuthor: Jason Jackson <jackson@twitter.com>\nDate:   Fri Feb 1 00:49:01 2013 -0800\n\n    upgrade Zookeeper 3.4.5\n\ndiff --git a/project.clj b/project.clj\nindex 7f59387..725f8c9 100644\n--- a/project.clj\n+++ b/project.clj\n@@ -9,7 +9,9 @@\n                   :exclusions [org.slf4j/slf4j-api]]\n                  [clj-time \"0.4.1\"]\n                  [com.netflix.curator/curator-framework \"1.0.1\"\n-                  :exclusions [log4j/log4j]]\n+                  :exclusions [log4j/log4j org.apache.zookeeper/zookeeper]]\n+                 [org.apache.zookeeper/zookeeper \"3.4.5\" \n+                  :exclusions [com.sun.jmx/jmxri com.sun.jdmk/jmxtools javax.jms/jms log4j/log4j jline org.slf4j/slf4j-log4j12]]\n                  [backtype/jzmq \"2.1.0\"]\n                  [com.googlecode.json-simple/json-simple \"1.1\"]\n                  [compojure \"1.1.3\"]\ndiff --git a/src/clj/backtype/storm/zookeeper.clj b/src/clj/backtype/storm/zookeeper.clj\nindex 76858a7..c591cf6 100644\n--- a/src/clj/backtype/storm/zookeeper.clj\n+++ b/src/clj/backtype/storm/zookeeper.clj\n@@ -6,7 +6,7 @@\n             ZooDefs ZooDefs$Ids CreateMode WatchedEvent Watcher$Event Watcher$Event$KeeperState\n             Watcher$Event$EventType KeeperException$NodeExistsException])\n   (:import [org.apache.zookeeper.data Stat])\n-  (:import [org.apache.zookeeper.server ZooKeeperServer NIOServerCnxn$Factory])\n+  (:import [org.apache.zookeeper.server ZooKeeperServer NIOServerCnxnFactory])\n   (:import [java.net InetSocketAddress BindException])\n   (:import [java.io File])\n   (:import [backtype.storm.utils Utils ZookeeperAuthInfo])\n@@ -132,7 +132,7 @@\n   (let [localfile (File. localdir)\n         zk (ZooKeeperServer. localfile localfile 2000)\n         [retport factory] (loop [retport (if port port 2000)]\n-                            (if-let [factory-tmp (try-cause (NIOServerCnxn$Factory. (InetSocketAddress. retport))\n+                            (if-let [factory-tmp (try-cause (doto (NIOServerCnxnFactory.) (.configure (InetSocketAddress. retport) 0))\n                                               (catch BindException e\n                                                 (when (> (inc retport) (if port port 65535))\n                                                   (throw (RuntimeException. \"No port is available to launch an inprocess zookeeper.\")))))]\ndiff --git a/src/jvm/backtype/storm/utils/Utils.java b/src/jvm/backtype/storm/utils/Utils.java\nindex 36d4d5c..aacdd8f 100644\n--- a/src/jvm/backtype/storm/utils/Utils.java\n+++ b/src/jvm/backtype/storm/utils/Utils.java\n@@ -293,8 +293,8 @@ public class Utils {\n             serverPorts.add(zkServer + \":\" + Utils.getInt(port));\n         }\n         String zkStr = StringUtils.join(serverPorts, \",\") + root; \n+\n         try {\n-            \n             CuratorFrameworkFactory.Builder builder = CuratorFrameworkFactory.builder()\n                     .connectString(zkStr)\n                     .connectionTimeoutMs(Utils.getInt(conf.get(Config.STORM_ZOOKEEPER_CONNECTION_TIMEOUT)))\nThis patch causes transactional-test to hang non-deterministically. \nAlso if you try to upgrade both curator and zk same thing. \nAlso, zk inprocess is much slower in 3.4.x branch, \none way to solve this is to reuse inprocess zookeeper's instead of constantly starting them up and shutting them down in unit tests.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"364151","customfield_12312823":null,"summary":"Unit test regression when storm is compiled with 3.4.5 zookeeper","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xumingming","name":"xumingming","key":"xumingming","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354"},"displayName":"James Xu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-146/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qpsv:"}}