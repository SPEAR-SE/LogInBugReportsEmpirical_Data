{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12987183","self":"https://issues.apache.org/jira/rest/api/2/issue/12987183","key":"STORM-1946","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335747","id":"12335747","name":"1.0.2","archived":false,"released":true,"releaseDate":"2016-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335748","id":"12335748","name":"1.1.0","archived":false,"released":true,"releaseDate":"2017-03-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-07-06T17:18:20.822+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 08 14:00:41 UTC 2016","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_145171444_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2016-07-08T07:24:52.425+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1946/watchers","watchCount":4,"isWatching":false},"created":"2016-07-06T15:05:21.374+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["patch"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":"STORM-1855","customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slava92","name":"slava92","key":"slava92","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10435","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10435","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10435","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10435"},"displayName":"Slava Andreyev","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-07-08T14:00:41.967+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"When storm stars a large number of ShellBolt-s that consume a lot of CPU time to initialize, it creates a lot of contention between processes for CPU resource. That leads to [BoltHeartbeatTimerTask|https://github.com/apache/storm/blob/master/storm-core/src/jvm/org/apache/storm/task/ShellBolt.java#L142] being fired up after 1 second delay _before_ [setHeartbeat()|https://github.com/apache/storm/blob/master/storm-core/src/jvm/org/apache/storm/task/ShellBolt.java#L145] assigns initial value to [lastHeartbeatTimestamp|https://github.com/apache/storm/blob/master/storm-core/src/jvm/org/apache/storm/task/ShellBolt.java#L91] variable.\nAs a result when {{BoltHeartbeatTimeTask}} fires up for the first time, [getLastHeartbeat()|https://github.com/apache/storm/blob/master/storm-core/src/jvm/org/apache/storm/task/ShellBolt.java#L316] returns value of *0*. This in turn leads bolt to die with [\"subprocess heartbeat timeout\"|https://github.com/apache/storm/blob/master/storm-core/src/jvm/org/apache/storm/task/ShellBolt.java#L322] message.\nThe fix is to place {{setHeartBeat()}} _before_ {{BoltHeartbeatTimerTask}} is created. The patch for this is attached.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12816439","id":"12816439","filename":"ShellBolt.java.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slava92","name":"slava92","key":"slava92","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10435","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10435","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10435","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10435"},"displayName":"Slava Andreyev","active":true,"timeZone":"America/New_York"},"created":"2016-07-06T15:07:39.588+0000","size":1040,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12816439/ShellBolt.java.patch"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ShellBolt.java - On busy system BoltHeartbeatTimerTask fires before setHeartbeat() is executed","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slava92","name":"slava92","key":"slava92","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10435","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10435","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10435","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10435"},"displayName":"Slava Andreyev","active":true,"timeZone":"America/New_York"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slava92","name":"slava92","key":"slava92","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10435","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10435","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10435","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10435"},"displayName":"Slava Andreyev","active":true,"timeZone":"America/New_York"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10430","value":"Patch","id":"10430"}],"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987183/comment/15364428","id":"15364428","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slava92","name":"slava92","key":"slava92","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10435","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10435","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10435","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10435"},"displayName":"Slava Andreyev","active":true,"timeZone":"America/New_York"},"body":"A patch to fix the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slava92","name":"slava92","key":"slava92","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10435","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10435","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10435","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10435"},"displayName":"Slava Andreyev","active":true,"timeZone":"America/New_York"},"created":"2016-07-06T15:07:39.592+0000","updated":"2016-07-06T15:07:39.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987183/comment/15364673","id":"15364673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user slava92 opened a pull request:\n\n    https://github.com/apache/storm/pull/1542\n\n    STORM-1946: initialize lastHeartbeatTimestamp before starting heartbeat task\n\n    When storm stars a large number of ShellBolt-s that consume a lot of CPU time to initialize, it creates a lot of contention between processes for CPU resource. That leads to BoltHeartbeatTimerTask being fired up after 1 second delay before setHeartbeat() assigns initial value to lastHeartbeatTimestamp variable.\n    As a result when BoltHeartbeatTimeTask fires up for the first time, getLastHeartbeat() returns value of 0. This in turn leads bolt to die with \"subprocess heartbeat timeout\" message.\n    The fix is to place setHeartBeat() before BoltHeartbeatTimerTask is created. The patch for this is attached.\n\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/slava92/storm master\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/1542.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #1542\n    \n----\ncommit d38c40026ab5dac266986896424e6c25a440e512\nAuthor: Slava Andreyev <sandreyev@ets.org>\nDate:   2016-07-06T17:14:09Z\n\n    initialize lastHeartbeatTimestamp before starting heartbeat task\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-06T17:18:20.822+0000","updated":"2016-07-06T17:18:20.822+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987183/comment/15365401","id":"15365401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/1542\n  \n    +1 Great finding.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-07T00:40:28.252+0000","updated":"2016-07-07T00:40:28.252+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987183/comment/15367337","id":"15367337","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/1542\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-08T07:22:52.499+0000","updated":"2016-07-08T07:22:52.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987183/comment/15367342","id":"15367342","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Thanks [~slava92], I merged into master, 1.x, 1.0.x branches respectively.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2016-07-08T07:24:52.689+0000","updated":"2016-07-08T07:24:52.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987183/comment/15367705","id":"15367705","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slava92","name":"slava92","key":"slava92","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10435","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10435","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10435","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10435"},"displayName":"Slava Andreyev","active":true,"timeZone":"America/New_York"},"body":"Great. Thanks for taking care of it so fast.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slava92","name":"slava92","key":"slava92","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10435","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10435","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10435","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10435"},"displayName":"Slava Andreyev","active":true,"timeZone":"America/New_York"},"created":"2016-07-08T14:00:41.967+0000","updated":"2016-07-08T14:00:41.967+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-1946/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i30ln3:"}}