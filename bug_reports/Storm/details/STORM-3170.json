{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13176241","self":"https://issues.apache.org/jira/rest/api/2/issue/13176241","key":"STORM-3170","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":7800,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false}],"aggregatetimespent":7800,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-08-03T16:13:17.663+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 03 16:13:17 UTC 2018","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_90801879_*|*_3_*:*_1_*:*_64389747_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2018-08-03T16:13:17.632+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3170/watchers","watchCount":1,"isWatching":false},"created":"2018-08-01T21:06:46.043+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengdai","name":"zhengdai","key":"zhengdai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"},"displayName":"Zhengdai Hu","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-03T16:13:17.667+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12332926","id":"12332926","name":"storm-webapp"}],"timeoriginalestimate":null,"description":"In DirectoryCleaner#deleteOldestWhileTooLarge, the original implementation calls file#delete without checking if it succeeds or not, and they're always reported as deleted. This prevents DirectoryCleaner from clean up other files and invalidates any metrics built on top of this.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"2h 10m","remainingEstimateSeconds":0,"timeSpentSeconds":7800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"DirectoryCleaner may not correctly report correct number of deleted files","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengdai","name":"zhengdai","key":"zhengdai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"},"displayName":"Zhengdai Hu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhengdai","name":"zhengdai","key":"zhengdai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"},"displayName":"Zhengdai Hu","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":7800,"total":7800,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":7800,"total":7800,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/comment/16568423","id":"16568423","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Thanks [~zhengdai],\r\n\r\nÂ \r\n\r\nI merged this into master.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2018-08-03T16:13:17.663+0000","updated":"2018-08-03T16:13:17.663+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-3170/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":13,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/129978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user zd-project opened a pull request:\n\n    https://github.com/apache/storm/pull/2788\n\n    STORM-3170: Fixed bug to eliminate invalid file deletion\n\n    https://issues.apache.org/jira/browse/STORM-3170\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/zd-project/storm STORM-3170\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2788.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2788\n    \n----\ncommit 8f69c241b90b00205cae195be990795c44fb7a96\nAuthor: Zhengdai Hu <hu.zhengdai@...>\nDate:   2018-08-01T21:28:53Z\n\n    STORM-3170: Fixed bug to eliminate invalid file deletion\n    \n    with trivial refactoring\n\n----\n","created":"2018-08-01T21:29:38.604+0000","updated":"2018-08-01T21:29:38.604+0000","started":"2018-08-01T21:29:38.604+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"129978","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/129979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user zd-project commented on the issue:\n\n    https://github.com/apache/storm/pull/2788\n  \n    This will affect #2754 \n","created":"2018-08-01T21:31:11.479+0000","updated":"2018-08-01T21:31:11.479+0000","started":"2018-08-01T21:31:11.479+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"129979","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130558","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2788#discussion_r207327029\n  \n    --- Diff: storm-webapp/src/main/java/org/apache/storm/daemon/logviewer/utils/DirectoryCleaner.java ---\n    @@ -133,10 +123,15 @@ public int compare(File f1, File f2) {\n                 }\n                 while (!stack.isEmpty() && toDeleteSize > 0) {\n                     File file = stack.pop();\n    -                toDeleteSize -= file.length();\n    -                LOG.info(\"Delete file: {}, size: {}, lastModified: {}\", file.getCanonicalPath(), file.length(), file.lastModified());\n    -                file.delete();\n    -                deletedFiles++;\n    +                final String canonicalPath = file.getCanonicalPath();\n    +                final long fileSize = file.length();\n    +                final long lastModified = file.lastModified();\n    +                //Original implementation doesn't actually check if delete succeeded or not.\n    +                if (file.delete()) {\n    --- End diff --\n    \n    I agree that we should make this check, but won't this change make the outer while loop run again on the same files if the files couldn't be deleted?\n","created":"2018-08-02T18:22:41.596+0000","updated":"2018-08-02T18:22:41.596+0000","started":"2018-08-02T18:22:41.595+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130558","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130559","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2788#discussion_r207327774\n  \n    --- Diff: storm-webapp/src/test/java/org/apache/storm/daemon/logviewer/testsupport/MockRemovableFileBuilder.java ---\n    @@ -0,0 +1,29 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.\n    + * See the NOTICE file distributed with this work for additional information regarding copyright ownership.\n    + * The ASF licenses this file to you under the Apache License, Version 2.0 (the \"License\");\n    + * you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n    + * <p>\n    + * http://www.apache.org/licenses/LICENSE-2.0\n    + * <p>\n    + * Unless required by applicable law or agreed to in writing,\n    + * software distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and limitations under the License.\n    + */\n    +\n    +package org.apache.storm.daemon.logviewer.testsupport;\n    +\n    +import org.mockito.Mockito;\n    +\n    +import java.io.File;\n    +\n    +public class MockRemovableFileBuilder extends MockFileBuilder {\n    +    @Override\n    +    public File build() {\n    +        File mockFile = super.build();\n    +        Mockito.when(mockFile.delete()).thenReturn(true);\n    --- End diff --\n    \n    This stubbing is a little weird. It'll make the files pretend to be deleteable, but once you delete the file it'll still say it exists, and calling delete again will still return true.\r\n    \r\n    Is the reason we're mocking File rather than creating temporary files for performance reasons?\n","created":"2018-08-02T18:25:17.435+0000","updated":"2018-08-02T18:25:17.435+0000","started":"2018-08-02T18:25:17.434+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130559","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130562","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user zd-project commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2788#discussion_r207328701\n  \n    --- Diff: storm-webapp/src/test/java/org/apache/storm/daemon/logviewer/testsupport/MockRemovableFileBuilder.java ---\n    @@ -0,0 +1,29 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.\n    + * See the NOTICE file distributed with this work for additional information regarding copyright ownership.\n    + * The ASF licenses this file to you under the Apache License, Version 2.0 (the \"License\");\n    + * you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n    + * <p>\n    + * http://www.apache.org/licenses/LICENSE-2.0\n    + * <p>\n    + * Unless required by applicable law or agreed to in writing,\n    + * software distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and limitations under the License.\n    + */\n    +\n    +package org.apache.storm.daemon.logviewer.testsupport;\n    +\n    +import org.mockito.Mockito;\n    +\n    +import java.io.File;\n    +\n    +public class MockRemovableFileBuilder extends MockFileBuilder {\n    +    @Override\n    +    public File build() {\n    +        File mockFile = super.build();\n    +        Mockito.when(mockFile.delete()).thenReturn(true);\n    --- End diff --\n    \n    I'm simply leveraging what's already out there. Maybe it's easier to control the behavior of a file in this way? I'll look into the implementation to see if I can alter behavior after calling `#delete`\n","created":"2018-08-02T18:28:25.693+0000","updated":"2018-08-02T18:28:25.693+0000","started":"2018-08-02T18:28:25.693+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130562","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user zd-project commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2788#discussion_r207376890\n  \n    --- Diff: storm-webapp/src/main/java/org/apache/storm/daemon/logviewer/utils/DirectoryCleaner.java ---\n    @@ -133,10 +123,15 @@ public int compare(File f1, File f2) {\n                 }\n                 while (!stack.isEmpty() && toDeleteSize > 0) {\n                     File file = stack.pop();\n    -                toDeleteSize -= file.length();\n    -                LOG.info(\"Delete file: {}, size: {}, lastModified: {}\", file.getCanonicalPath(), file.length(), file.lastModified());\n    -                file.delete();\n    -                deletedFiles++;\n    +                final String canonicalPath = file.getCanonicalPath();\n    +                final long fileSize = file.length();\n    +                final long lastModified = file.lastModified();\n    +                //Original implementation doesn't actually check if delete succeeded or not.\n    +                if (file.delete()) {\n    --- End diff --\n    \n    I'm wondering if we should use forcedelete here directly?\n","created":"2018-08-02T21:16:04.473+0000","updated":"2018-08-02T21:16:04.473+0000","started":"2018-08-02T21:16:04.472+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130637","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130863","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2788#discussion_r207539609\n  \n    --- Diff: storm-webapp/src/test/java/org/apache/storm/daemon/logviewer/testsupport/MockRemovableFileBuilder.java ---\n    @@ -0,0 +1,29 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.\n    + * See the NOTICE file distributed with this work for additional information regarding copyright ownership.\n    + * The ASF licenses this file to you under the Apache License, Version 2.0 (the \"License\");\n    + * you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n    + * <p>\n    + * http://www.apache.org/licenses/LICENSE-2.0\n    + * <p>\n    + * Unless required by applicable law or agreed to in writing,\n    + * software distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and limitations under the License.\n    + */\n    +\n    +package org.apache.storm.daemon.logviewer.testsupport;\n    +\n    +import org.mockito.Mockito;\n    +\n    +import java.io.File;\n    +\n    +public class MockRemovableFileBuilder extends MockFileBuilder {\n    +    @Override\n    +    public File build() {\n    +        File mockFile = super.build();\n    +        Mockito.when(mockFile.delete()).thenReturn(true);\n    --- End diff --\n    \n    @zd-project you can control it more fully, but it gets a little more complicated.  Not a big deal but if it is causing problems it can be done.\n","created":"2018-08-03T13:13:03.765+0000","updated":"2018-08-03T13:13:03.765+0000","started":"2018-08-03T13:13:03.765+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130863","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on the issue:\n\n    https://github.com/apache/storm/pull/2788\n  \n    +1, thanks for fixing the issue with nondeleteable files. The solution looks good. Please squash and we can merge.\n","created":"2018-08-03T15:36:07.477+0000","updated":"2018-08-03T15:36:07.477+0000","started":"2018-08-03T15:36:07.477+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130902","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130907","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user zd-project commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2788#discussion_r207586437\n  \n    --- Diff: storm-webapp/src/test/java/org/apache/storm/daemon/logviewer/testsupport/MockRemovableFileBuilder.java ---\n    @@ -0,0 +1,29 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.\n    + * See the NOTICE file distributed with this work for additional information regarding copyright ownership.\n    + * The ASF licenses this file to you under the Apache License, Version 2.0 (the \"License\");\n    + * you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n    + * <p>\n    + * http://www.apache.org/licenses/LICENSE-2.0\n    + * <p>\n    + * Unless required by applicable law or agreed to in writing,\n    + * software distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and limitations under the License.\n    + */\n    +\n    +package org.apache.storm.daemon.logviewer.testsupport;\n    +\n    +import org.mockito.Mockito;\n    +\n    +import java.io.File;\n    +\n    +public class MockRemovableFileBuilder extends MockFileBuilder {\n    +    @Override\n    +    public File build() {\n    +        File mockFile = super.build();\n    +        Mockito.when(mockFile.delete()).thenReturn(true);\n    --- End diff --\n    \n    Should I still concern about this issue then? @revans2 @srdo \n","created":"2018-08-03T15:41:07.979+0000","updated":"2018-08-03T15:41:07.979+0000","started":"2018-08-03T15:41:07.979+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130907","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2788#discussion_r207587402\n  \n    --- Diff: storm-webapp/src/test/java/org/apache/storm/daemon/logviewer/testsupport/MockRemovableFileBuilder.java ---\n    @@ -0,0 +1,29 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.\n    + * See the NOTICE file distributed with this work for additional information regarding copyright ownership.\n    + * The ASF licenses this file to you under the Apache License, Version 2.0 (the \"License\");\n    + * you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n    + * <p>\n    + * http://www.apache.org/licenses/LICENSE-2.0\n    + * <p>\n    + * Unless required by applicable law or agreed to in writing,\n    + * software distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and limitations under the License.\n    + */\n    +\n    +package org.apache.storm.daemon.logviewer.testsupport;\n    +\n    +import org.mockito.Mockito;\n    +\n    +import java.io.File;\n    +\n    +public class MockRemovableFileBuilder extends MockFileBuilder {\n    +    @Override\n    +    public File build() {\n    +        File mockFile = super.build();\n    +        Mockito.when(mockFile.delete()).thenReturn(true);\n    --- End diff --\n    \n    No, it's just me nitpicking. We can always replace it if it becomes an issue to use in tests.\n","created":"2018-08-03T15:44:11.013+0000","updated":"2018-08-03T15:44:11.013+0000","started":"2018-08-03T15:44:11.013+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130911","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130914","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user zd-project commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2788#discussion_r207587787\n  \n    --- Diff: storm-webapp/src/test/java/org/apache/storm/daemon/logviewer/testsupport/MockRemovableFileBuilder.java ---\n    @@ -0,0 +1,29 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.\n    + * See the NOTICE file distributed with this work for additional information regarding copyright ownership.\n    + * The ASF licenses this file to you under the Apache License, Version 2.0 (the \"License\");\n    + * you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n    + * <p>\n    + * http://www.apache.org/licenses/LICENSE-2.0\n    + * <p>\n    + * Unless required by applicable law or agreed to in writing,\n    + * software distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and limitations under the License.\n    + */\n    +\n    +package org.apache.storm.daemon.logviewer.testsupport;\n    +\n    +import org.mockito.Mockito;\n    +\n    +import java.io.File;\n    +\n    +public class MockRemovableFileBuilder extends MockFileBuilder {\n    +    @Override\n    +    public File build() {\n    +        File mockFile = super.build();\n    +        Mockito.when(mockFile.delete()).thenReturn(true);\n    --- End diff --\n    \n    Okay I'll just file a minor jira then\n","created":"2018-08-03T15:45:31.603+0000","updated":"2018-08-03T15:45:31.603+0000","started":"2018-08-03T15:45:31.603+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130914","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/storm/pull/2788\n  \n    Still +1\n","created":"2018-08-03T15:48:41.097+0000","updated":"2018-08-03T15:48:41.097+0000","started":"2018-08-03T15:48:41.097+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130917","issueId":"13176241"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13176241/worklog/130925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2788\n","created":"2018-08-03T16:13:02.661+0000","updated":"2018-08-03T16:13:02.661+0000","started":"2018-08-03T16:13:02.661+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"130925","issueId":"13176241"}]},"customfield_12311820":"0|i3wlaf:"}}