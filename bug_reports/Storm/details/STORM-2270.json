{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13031838","self":"https://issues.apache.org/jira/rest/api/2/issue/13031838","key":"STORM-2270","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":7200,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335748","id":"12335748","name":"1.1.0","archived":false,"released":true,"releaseDate":"2017-03-29"}],"aggregatetimespent":7200,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-02-08T20:53:52.229+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Feb 08 20:53:52 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3087918109_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-02-08T20:53:52.199+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2270/watchers","watchCount":2,"isWatching":false},"created":"2017-01-04T03:08:34.138+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["easyfix"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":"STORM-1856","customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329843","id":"12329843","name":"1.0.0","archived":false,"released":true,"releaseDate":"2016-04-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12333021","id":"12333021","name":"0.9.6","archived":false,"released":true,"releaseDate":"2015-11-05"}],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-02-08T20:53:52.237+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324393","id":"12324393","name":"storm-kafka","description":"Storm Kafka Integration"}],"timeoriginalestimate":null,"description":"Kafka spout should consume from latest when ZK offset bigger than latest offset[ an TopicOffsetOutOfRangeException thrown out ], especially when Kafka topic change it's leader and some data lost, if we consume from earliest offset, much meaningless duplicate records will be re-consumed. So, we should consume from latest offset instead.\n","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"2h","remainingEstimateSeconds":0,"timeSpentSeconds":7200},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Kafka spout should consume from latest when zk committed offset bigger than latest offset","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=danny0405","name":"danny0405","key":"danny0405","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yuzhao Chen","active":true,"timeZone":"Asia/Harbin"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=danny0405","name":"danny0405","key":"danny0405","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yuzhao Chen","active":true,"timeZone":"Asia/Harbin"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":7200,"total":7200,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":7200,"total":7200,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/comment/15858527","id":"15858527","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ptgoetz","name":"ptgoetz","key":"ptgoetz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"P. Taylor Goetz","active":true,"timeZone":"America/Havana"},"body":"Merged to 1.x-branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ptgoetz","name":"ptgoetz","key":"ptgoetz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"P. Taylor Goetz","active":true,"timeZone":"America/Havana"},"created":"2017-02-08T20:53:52.229+0000","updated":"2017-02-08T20:53:52.229+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2270/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":12,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/34599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user danny0405 opened a pull request:\n\n    https://github.com/apache/storm/pull/1851\n\n    Kafka spout should consume from latest when zk offset bigger than latest offset\n\n    Kafka spout should consume from latest when ZK offset bigger than latest offset[ an TopicOffsetOutOfRangeException thrown out ], especially when Kafka topic change it's leader and some data lost, if we consume from earliest offset, much meaningless duplicate records will be re-consumed. So, we should consume from latest offset instead.\n    This is the jira task: [STORM-2270](https://issues.apache.org/jira/browse/STORM-2270)\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/danny0405/storm cyz-dev\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/1851.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #1851\n    \n----\ncommit 032f1f33af93c99c27c53a6fb0cbe83f8d5fdb8b\nAuthor: chenyuzhao <chenyuzhao@meituan.com>\nDate:   2017-01-04T02:57:01Z\n\n    kafka spout consume from latest when zk offset bigger than latest offset\n\n----\n","created":"2017-01-04T03:13:03.127+0000","updated":"2017-01-04T03:13:03.127+0000","started":"2017-01-04T03:13:03.126+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"34599","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/34751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/1851\n  \n    Please change the PR's title to add a prefix \"STORM-2270\" so that it can be automatically linked.\n","created":"2017-01-05T02:39:27.225+0000","updated":"2017-01-05T02:39:27.225+0000","started":"2017-01-05T02:39:27.224+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"34751","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/34757","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user danny0405 commented on the issue:\n\n    https://github.com/apache/storm/pull/1851\n  \n    @HeartSaVioR thx, i have changed the title\n","created":"2017-01-05T03:17:49.686+0000","updated":"2017-01-05T03:17:49.686+0000","started":"2017-01-05T03:17:49.686+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"34757","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/35601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user harshach commented on the issue:\n\n    https://github.com/apache/storm/pull/1851\n  \n    +1\n","created":"2017-01-14T05:24:36.779+0000","updated":"2017-01-14T05:24:36.779+0000","started":"2017-01-14T05:24:36.779+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"35601","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/35787","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1851#discussion_r96600516\n  \n    --- Diff: external/storm-kafka/src/jvm/org/apache/storm/kafka/PartitionManager.java ---\n    @@ -199,7 +199,12 @@ private void fill() {\n             try {\n                 msgs = KafkaUtils.fetchMessages(_spoutConfig, _consumer, _partition, offset);\n             } catch (TopicOffsetOutOfRangeException e) {\n    -            offset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.EarliestTime());\n    +            long partitionLatestOffset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.LatestTime());\n    +            if (partitionLatestOffset < offset) {\n    +                offset = partitionLatestOffset;\n    +            } else {\n    +                offset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.EarliestTime());\n    +            }\n                 // fetch failed, so don't update the fetch metrics\n                 \n                 //fix bug [STORM-643] : remove outdated failed offsets\n    --- End diff --\n    \n    @danny0405\n    if processingNewTuples is false, we still need to know earliest available offset since discarding logic assumes offset is the earliest available offset. If not it might discard some tuples which offsets are still available on topic.\n","created":"2017-01-18T10:07:15.135+0000","updated":"2017-01-18T10:07:15.135+0000","started":"2017-01-18T10:07:15.135+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"35787","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/36173","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user harshach commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1851#discussion_r97459031\n  \n    --- Diff: external/storm-kafka/src/jvm/org/apache/storm/kafka/PartitionManager.java ---\n    @@ -199,7 +199,12 @@ private void fill() {\n             try {\n                 msgs = KafkaUtils.fetchMessages(_spoutConfig, _consumer, _partition, offset);\n             } catch (TopicOffsetOutOfRangeException e) {\n    -            offset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.EarliestTime());\n    +            long partitionLatestOffset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.LatestTime());\n    +            if (partitionLatestOffset < offset) {\n    +                offset = partitionLatestOffset;\n    +            } else {\n    +                offset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.EarliestTime());\n    +            }\n                 // fetch failed, so don't update the fetch metrics\n                 \n                 //fix bug [STORM-643] : remove outdated failed offsets\n    --- End diff --\n    \n    @HeartSaVioR  Given that this code is inside TopicOffsetOutOfRangeException, which can only happen if the spout requested for an offset that's not in Kafka Topic. So in which case do you see that we might disregard the valid offsets.\n","created":"2017-01-24T01:46:06.652+0000","updated":"2017-01-24T01:46:06.652+0000","started":"2017-01-24T01:46:06.651+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"36173","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/36174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1851#discussion_r97461150\n  \n    --- Diff: external/storm-kafka/src/jvm/org/apache/storm/kafka/PartitionManager.java ---\n    @@ -199,7 +199,12 @@ private void fill() {\n             try {\n                 msgs = KafkaUtils.fetchMessages(_spoutConfig, _consumer, _partition, offset);\n             } catch (TopicOffsetOutOfRangeException e) {\n    -            offset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.EarliestTime());\n    +            long partitionLatestOffset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.LatestTime());\n    +            if (partitionLatestOffset < offset) {\n    +                offset = partitionLatestOffset;\n    +            } else {\n    +                offset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.EarliestTime());\n    +            }\n                 // fetch failed, so don't update the fetch metrics\n                 \n                 //fix bug [STORM-643] : remove outdated failed offsets\n    --- End diff --\n    \n    @harshach \n    Either is fine for me, but if we would want to keep this, comments below the if statement needs to be reflected since comment is based on precondition that offset is equal to earliest time.\n","created":"2017-01-24T02:08:09.102+0000","updated":"2017-01-24T02:08:09.102+0000","started":"2017-01-24T02:08:09.101+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"36174","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/36637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user harshach commented on the issue:\n\n    https://github.com/apache/storm/pull/1851\n  \n    @danny0405 can you add comments in the TopicOffsetOutOfRangeException block on when that case will encounter.\n","created":"2017-02-02T21:57:22.082+0000","updated":"2017-02-02T21:57:22.082+0000","started":"2017-02-02T21:57:22.081+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"36637","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/36650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/1851#discussion_r99265466\n  \n    --- Diff: external/storm-kafka/src/jvm/org/apache/storm/kafka/PartitionManager.java ---\n    @@ -199,7 +199,12 @@ private void fill() {\n             try {\n                 msgs = KafkaUtils.fetchMessages(_spoutConfig, _consumer, _partition, offset);\n             } catch (TopicOffsetOutOfRangeException e) {\n    -            offset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.EarliestTime());\n    +            long partitionLatestOffset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.LatestTime());\n    +            if (partitionLatestOffset < offset) {\n    +                offset = partitionLatestOffset;\n    +            } else {\n    +                offset = KafkaUtils.getOffset(_consumer, _partition.topic, _partition.partition, kafka.api.OffsetRequest.EarliestTime());\n    +            }\n                 // fetch failed, so don't update the fetch metrics\n                 \n                 //fix bug [STORM-643] : remove outdated failed offsets\n    --- End diff --\n    \n    @danny0405 @harshach \n    Sorry My bad. I found that I confused earliest and latest... We're good to go.\n","created":"2017-02-03T02:10:25.319+0000","updated":"2017-02-03T02:10:25.319+0000","started":"2017-02-03T02:10:25.319+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"36650","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/36651","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/1851\n  \n    +1 Thanks for the great contribution.\n","created":"2017-02-03T02:10:43.646+0000","updated":"2017-02-03T02:10:43.646+0000","started":"2017-02-03T02:10:43.646+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"36651","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/36654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/1851\n  \n    @harshach I found my mistake, and now I'm +1 to merge. Do you want to wait @danny0405 for adding comments?\n","created":"2017-02-03T02:38:09.209+0000","updated":"2017-02-03T02:38:09.209+0000","started":"2017-02-03T02:38:09.208+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"36654","issueId":"13031838"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031838/worklog/36947","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/1851\n","created":"2017-02-08T20:51:38.469+0000","updated":"2017-02-08T20:51:38.469+0000","started":"2017-02-08T20:51:38.469+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"36947","issueId":"13031838"}]},"customfield_12311820":"0|i388e7:"}}