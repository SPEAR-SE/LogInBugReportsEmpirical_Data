{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13091961","self":"https://issues.apache.org/jira/rest/api/2/issue/13091961","key":"STORM-2675","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":6000,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341047","id":"12341047","name":"1.2.0","archived":false,"released":true,"releaseDate":"2018-02-15"}],"aggregatetimespent":6000,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-08-03T18:34:38.797+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Sep 13 08:04:05 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_87918037_*|*_3_*:*_1_*:*_3504560209_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-09-13T08:04:05.391+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2675/watchers","watchCount":5,"isWatching":false},"created":"2017-08-02T18:09:27.205+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":"STORM-2710","customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335748","id":"12335748","name":"1.1.0","archived":false,"released":true,"releaseDate":"2017-03-29"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-09-13T08:04:14.950+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12331080","id":"12331080","name":"storm-kafka-client"}],"timeoriginalestimate":null,"description":"Every time I restart the topology the spout was picking the earliest message even though poll strategy is set UNCOMMITTED_EARLIEST.  I looked at Kafka's  __consumer_offsets topic to see if spout (consumer) is committing the offsets but did not find any commits. I am not even able to locate the code in the KafkaTridentSpoutEmitter class where we are updating the commits?\n\n    conf.put(Config.TOPOLOGY_DEBUG, true);\n    conf.put(Config.TOPOLOGY_WORKERS, 1);\n    conf.put(Config.TOPOLOGY_MAX_SPOUT_PENDING, 4); //tried with1 as well\n    conf.put(Config.TRANSACTIONAL_ZOOKEEPER_ROOT, \"/aggregate\");\n    conf.put(Config.TRANSACTIONAL_ZOOKEEPER_SERVERS, Arrays.asList(new String[]{\"localhost\"}));\n    conf.put(Config.TRANSACTIONAL_ZOOKEEPER_PORT, 2181);\n\n protected static KafkaSpoutConfig<String, String> getPMStatKafkaSpoutConfig() {\n    ByTopicRecordTranslator<String, String> byTopic =\n        new ByTopicRecordTranslator<>((r) -> new Values(r.topic(), r.key(), r.value()),\n            new Fields(TOPIC, PARTITION_KEY, PAYLOAD), SENSOR_STREAM);\n\n    return new KafkaSpoutConfig.Builder<String, String>(Utils.getBrokerHosts(),\n        StringDeserializer.class, null, Utils.getKafkaEnrichedPMSTopicName())\n            .setMaxPartitionFectchBytes(10 * 1024) // 10 KB\n            .setRetry(getRetryService())\n            .setOffsetCommitPeriodMs(10_000)\n            .setFirstPollOffsetStrategy(FirstPollOffsetStrategy.UNCOMMITTED_EARLIEST)\n            .setMaxUncommittedOffsets(250)\n            .setProp(\"value.deserializer\", \"io.confluent.kafka.serializers.KafkaAvroDeserializer\")\n            .setProp(\"schema.registry.url\",\"http://localhost:8081\")\n            .setProp(\"specific.avro.reader\",true)\n            .setGroupId(AGGREGATION_CONSUMER_GROUP)\n            .setRecordTranslator(byTopic).build();\n  }\n\nStream pmStatStream =\n        topology.newStream(\"statStream\", new KafkaTridentSpoutOpaque<>(getPMStatKafkaSpoutConfig())).parallelismHint(1)\n\nstorm-version - 1.1.0","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"1h 40m","remainingEstimateSeconds":0,"timeSpentSeconds":6000},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"KafkaTridentSpoutOpaque not committing offsets to Kafka","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":6000,"total":6000,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":6000,"total":6000,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16113255","id":"16113255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"body":"Hi.\n\nSorry about the following wall of text, I wrote some notes while debugging this, and I thought it might be helpful to understand how Trident works.\n\nAs I understand it Trident spouts don't save progress to Kafka. The progress should be saved to Storm's Zookeeper. The OpaquePartitionedTridentKafkaSpout should be getting passed the previous batch's ending offset as part of the metadata passed to emitPartitionBatch.\n\nI'm not very experienced with how Trident works internally, but from what I can tell, the spout will be asked to emit a batch with a given transaction id via emitPartitionBatch, as well as some metadata for the last batch. The return value is some metadata that can be used to construct the following batch later. In Kafka's case the metadata is the starting and end offsets for the batch. The metadata is saved to Zookeeper once state has been committed for the batch. When a batch succeeds, the metadata for earlier batches are removed from Zookeeper. If the spout worker is restarted, the last committed metadata is read back from Zookeeper, which should determine which offset the spout restarts at.\n\nhttps://github.com/apache/storm/blob/64e29f365c9b5d3e15b33f33ab64e200345333e4/storm-client/src/jvm/org/apache/storm/trident/spout/OpaquePartitionedTridentSpoutExecutor.java is the code that wraps around the OpaquePartitionedTridentKafkaSpout. The writes to Zookeeper should happen via the RotatingTransactionalState object here https://github.com/apache/storm/blob/64e29f365c9b5d3e15b33f33ab64e200345333e4/storm-client/src/jvm/org/apache/storm/trident/spout/OpaquePartitionedTridentSpoutExecutor.java#L116. If the spout has just restarted and there is no in-memory metadata for the last batch, the last committed metadata is read from Zookeeper here https://github.com/apache/storm/blob/64e29f365c9b5d3e15b33f33ab64e200345333e4/storm-client/src/jvm/org/apache/storm/trident/spout/OpaquePartitionedTridentSpoutExecutor.java#L140.\n\nHere is the metadata returned by emitPartitionBatch from the kafka spout https://github.com/apache/storm/blob/master/external/storm-kafka-client/src/main/java/org/apache/storm/kafka/spout/trident/KafkaTridentSpoutEmitter.java#L130\nIt should contain the first and last offsets for the current batch.\n\nThe metadata path in Zookeeper is constructed from these two classes https://github.com/apache/storm/blob/64e29f365c9b5d3e15b33f33ab64e200345333e4/storm-client/src/jvm/org/apache/storm/trident/topology/state/TransactionalState.java#L63 and https://github.com/apache/storm/blob/a4afacd9617d620f50cf026fc599821f7ac25c79/storm-client/src/jvm/org/apache/storm/trident/topology/state/RotatingTransactionalState.java. OpaquePartitionedTridentSpoutExecutor will create instances of each of these, based on the partition ids returned by the spout emitter. For example, for me the Zookeeper path for metadata for the Trident spout in examples/storm-kafka-client-examples TridentKafkaClientWordCountNamedTopics was /transactional/spout1/user/test-trident@0 and /transactional/spout1/user/test-trident-1@0. The path format for the kafka spout is /$transactional.zookeeper.root/$spoutComponentName/user/$topicName@partitionNumber. \n\nWhen I ran the TridentKafkaWordCountNamedTopics example on master, shut it down and restarted it, I think I got the behavior you described. Here is the Zookeeper metadata after I shut down the example topology the first time:\n{code}\nget /transactional/spout1/user/test-trident@0/6204\norg.apache.storm.kafka.spout.trident.KafkaTridentSpoutBatchMetadata@507e1faf{topicPartition=test-trident-0, firstOffset=1412, lastOffset=1412}\n{code}\nAfter restart\n{code}\nget /transactional/spout1/user/test-trident@0/6271\norg.apache.storm.kafka.spout.trident.KafkaTridentSpoutBatchMetadata@50982f4e{topicPartition=test-trident-0, firstOffset=71, lastOffset=71}\n{code}\nI tried logging the RotatingTransactionalState on creation.\n{code}\n2017-08-03 17:44:37.767 o.a.s.t.t.s.RotatingTransactionalState Thread-26-spout-spout1-executor[10, 10] [DEBUG] Created RotatingTransactionalState{_state=org.apache.storm.trident.topology.state.TransactionalState@29823124, _subdir='test-trident@0', _curr={6204=null}} org.apache.storm.trident.topology.state.RotatingTransactionalState.<init>(RotatingTransactionalState.java:47)\n{code}\nThe txid is correct, but the associated metadata object is null, which causes the spout to restart.\n\nI looked into it a bit more, and it turns out the TransactionalState code assumes the metadata object can be round trip serialized/deserialized with the json-simple library. When json-simple can't figure out how to json serialize an object, it'll instead quietly return the object's toString (IMO it should be throwing an exception instead of quietly doing the wrong thing). That's what ends up being saved to Zookeeper for the Kafka spout, and our metadata object's toString doesn't return json. When TransactionalState tries to load the metadata back in from Zookeeper, it (apparently deliberately) uses a method from json-simple that quietly returns null if json parsing fails. The result is that we end up both quietly failing to write the metadata properly to Zookeeper, and quietly fail to read the incorrectly serialized data back. The spout ends up restarting every time the executor is rebooted, because it can't read the data in Zookeeper. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"created":"2017-08-03T18:34:38.797+0000","updated":"2017-08-03T18:34:38.797+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16113299","id":"16113299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"body":"thanks Stig for analysis.. somehow I was thrown out by https://github.com/apache/storm/blob/master/external/storm-kafka-client/src/main/java/org/apache/storm/kafka/spout/trident/KafkaTridentSpoutEmitter.java#L167  where Kafka consumer looks at last offset from Kafka __consumer_offset topic and since we are not updating the offset in Kafka its always start from earliest message in case of UNCOMMITTED_EARLIEST strategy? \nSo now my doubt is even if we fix the issue with Zookeeper metadata parsing isn't the above logic going to ignore that information. To me it seems like incomplete implementation?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-03T18:54:27.697+0000","updated":"2017-08-03T18:54:27.697+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16113331","id":"16113331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"body":"Yes, I think we should remove the part where it looks at consumer.committed. I'd also like to change the handling of first poll strategy a bit, because it's inconsistent with the way it works for the regular spout. Right now there is no real difference between UNCOMMITED_EARLIEST/LATEST and EARLIEST/LATEST. I think we should change it so if the strategy is EARLIEST/LATEST and isFirstPoll is true, it should seek to start/end even if lastBatchMeta is set. That's how the regular spout works, it ignores how far any previous instances got when it restarts. Then UNCOMMITTED_* should do the same only if lastBatchMeta is null and isFirstPoll is true.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"created":"2017-08-03T19:16:52.684+0000","updated":"2017-08-03T19:16:52.684+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16113356","id":"16113356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"body":"Yes make sense..\nwhat do you think is next step to get it fixed?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-03T19:36:33.078+0000","updated":"2017-08-03T19:36:33.078+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16113379","id":"16113379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"body":"I think we should change the metadata object so it returns a Map to Trident instead of the current KafkaTridentSpoutBatchMetadata. json-simple knows how to handle Map. I'll open a PR soon assuming it works. It might be nice in the future to replace json-simple with something more flexible, like Jackson so spout implementations can use whatever object type they want, but for now I'd rather just fix this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"created":"2017-08-03T19:53:48.394+0000","updated":"2017-08-03T19:55:23.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16118747","id":"16118747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"body":"Do we have any SLA for the fix? Don't want to rush you but just need to plan on my side since current version is not very useful for my use case?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-08T17:51:27.474+0000","updated":"2017-08-08T17:51:27.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16118788","id":"16118788","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"body":"[~Preet] No promises, but I'm hoping to have a PR up sometime late this week for master.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"created":"2017-08-08T18:16:30.871+0000","updated":"2017-08-08T18:16:30.871+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16119147","id":"16119147","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"body":"[~Preet] Opened a PR here https://github.com/apache/storm/pull/2271. I'd appreciate it if you would check if it works for you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"created":"2017-08-08T22:48:51.848+0000","updated":"2017-08-08T22:48:51.848+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16126698","id":"16126698","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"body":"hi srd, sorry did not see your last message before. I will test it.\ndo I need to pull master (storm-kafka-client) and use this patch to generate the new artifact or is there any specific 1.1.0 branch I can use for checkout?\n\nAlso, do you know how early can we have a maven version with this PR?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Preet","name":"Preet","key":"preet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10439","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10439","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10439","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10439"},"displayName":"Preet Puri","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-15T01:26:26.059+0000","updated":"2017-08-15T01:52:45.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16126870","id":"16126870","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"body":"[~Preet] 1.x version https://github.com/srdo/storm/tree/STORM-2675-1.x. I don't know when the next release will be, but there's at least one other issue with the Trident spout I think we should fix before releasing (https://issues.apache.org/jira/browse/STORM-2691).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"created":"2017-08-15T06:52:14.985+0000","updated":"2017-08-15T06:52:14.985+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16152228","id":"16152228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janithkv","name":"janithkv","key":"janithkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"Janith Kaiprath Valiyalappil","active":true,"timeZone":"America/Chicago"},"body":"I had assumed if \nauto.commit.enable is true, and \nauto.commit.interval.ms is relatively small, and\nif we do not force kill the topology, all consumed messages would be automatically committed by the kafka consumer. If this was the case, then when we start with UNCOMMITED_EARLIEST/LATEST we should be continuing from the last committed position. This would be the case only for the first batch, and all later batches would depend on zookeeper.\n\nI am just curious, why it didn't follow the above behavior even with the above bug where first metadata is always null.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janithkv","name":"janithkv","key":"janithkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"Janith Kaiprath Valiyalappil","active":true,"timeZone":"America/Chicago"},"created":"2017-09-04T07:56:24.348+0000","updated":"2017-09-04T07:56:24.348+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16152848","id":"16152848","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"body":"[~janithkv] As far as I can tell it does follow your description when auto commit is true. Auto commit is disabled by default for KafkaSpoutConfig though. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Srdo","name":"Srdo","key":"srdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stig Rohde Døssing","active":true,"timeZone":"Europe/Copenhagen"},"created":"2017-09-04T18:26:57.491+0000","updated":"2017-09-04T18:26:57.491+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16153090","id":"16153090","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janithkv","name":"janithkv","key":"janithkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"Janith Kaiprath Valiyalappil","active":true,"timeZone":"America/Chicago"},"body":"[~Srdo], thanks for confirming that. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janithkv","name":"janithkv","key":"janithkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"Janith Kaiprath Valiyalappil","active":true,"timeZone":"America/Chicago"},"created":"2017-09-05T04:13:46.662+0000","updated":"2017-09-05T04:13:46.662+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16158704","id":"16158704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"[~Srdo],\n\nI merged your pull request into master, but when I tried to cherry-pick it into 1.x I got merge conflicts.  If you want this in the 1.x line please put up a pull request for that.  Thanks for all your work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2017-09-08T14:27:52.207+0000","updated":"2017-09-08T14:27:52.207+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/comment/16164279","id":"16164279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Also merged into 1.x branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2017-09-13T08:04:05.437+0000","updated":"2017-09-13T08:04:05.437+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2675/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":10,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/50271","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user srdo opened a pull request:\n\n    https://github.com/apache/storm/pull/2271\n\n    STORM-2675: Fix storm-kafka-client Trident spout failing to serialize meta objects to Zookeeper\n\n    See https://issues.apache.org/jira/browse/STORM-2675\n    \n    This builds on https://github.com/apache/storm/pull/2268, so please ignore the first commit.\n    \n    Trident uses json-simple under the hood to persist some objects to Zookeeper. This isn't mentioned on the API docs (or I missed it), so the current storm-kafka-client implementation returns a bunch of objects json-simple can't figure out how to serialize. The result is that json-simple writes the toString of the objects to Zookeeper, which can't be read back out. This causes the Trident Kafka spout to start over every time it's rebooted.\n    \n    TransactionalState, which is used by Trident to read/write to/from Zookeeper, uses JSONValue.parse to read. That function fails quietly by returning null when there's a parsing error. There's a note in the code that we deliberately don't use the version of the parse function that throws exception on error, but we should at least log when it happens, since it's likely to be due to a bug in the spout or coordinator.\n    \n    This PR makes the following changes:\n    * Manually serialize meta objects to List or Map so json-simple can handle them.\n    * Print a warning log when TransactionalState fails to deserialize something from Zookeeper.\n    * Fix the Trident Kafka spout's logic around first polls. It was referring to the committed offset of the KafkaConsumer, which is never updated because we don't commit to Kafka. The offsets are instead stored in Zookeeper via the meta object returned by Emitter.emitPartitionBatch.\n    * Fix the generic type of Coordinator on OpaquePartitionedTridentSpout. It should use the same type as the first parameter for Emitter, since OpaquePartitionedSpoutExecutor will call getOrderedPartitions and getPartitionsForTask on the emitter with the object returned by Coordinator.getPartitionsForBatch. I don't think this is a breaking change, since this was a de facto constraint anyway.\n    * Clarify in a comment on Subscription that Trident expects partitions to remain assigned to specific tasks. As far as I can tell there's a potential issue with the batch metadata cache kept by OpaqueTridentSpoutExecutor getting outdated if partitions are shuffled without workers dying.\n    \n    If anyone has suggestions for tests of this, I'm happy to add some. I'm wondering why we don't use Kryo for serialization to Zookeeper, since the json-simple library is so inflexible (it can only handle some collections and primitive wrappers).\n\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/srdo/storm STORM-2675\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2271.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2271\n    \n----\ncommit 4db257ff00ce4bb54bbdd7850fa9e4787752c7ad\nAuthor: Stig Rohde Døssing <srdo@apache.org>\nDate:   2017-08-08T11:04:04Z\n\n    STORM-2689: Simplify dependency configuration for storm-kafka-examples and storm-kafka-client-examples\n\ncommit 9288b88ffa088878dafc84bd5780754f1212988c\nAuthor: Stig Rohde Døssing <srdo@apache.org>\nDate:   2017-08-04T00:53:42Z\n\n    STORM-2675: Fix storm-kafka-client Trident spout failing to serialize meta objects to Zookeeper\n\n----\n","created":"2017-08-08T22:46:18.665+0000","updated":"2017-08-08T22:46:18.665+0000","started":"2017-08-08T22:46:18.663+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"50271","issueId":"13091961"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/50272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on the issue:\n\n    https://github.com/apache/storm/pull/2271\n  \n    Also stumbled on an issue with the way the coordinator and spout communicate, which I've put here https://issues.apache.org/jira/browse/STORM-2691. \n","created":"2017-08-08T22:57:41.385+0000","updated":"2017-08-08T22:57:41.385+0000","started":"2017-08-08T22:57:41.383+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"50272","issueId":"13091961"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/50434","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hmcl commented on the issue:\n\n    https://github.com/apache/storm/pull/2271\n  \n    @srdo shouldn't this [PR](https://github.com/apache/storm/pull/2174) come in before this one?\n","created":"2017-08-10T15:26:35.981+0000","updated":"2017-08-10T15:26:35.981+0000","started":"2017-08-10T15:26:35.969+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"50434","issueId":"13091961"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/50437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on the issue:\n\n    https://github.com/apache/storm/pull/2271\n  \n    @hmcl See my comment on that PR, I think the fixes are not related, but if we make the suggested changes we'll probably need to update this too. The changes should solve STORM-2691 though.\n","created":"2017-08-10T17:45:27.779+0000","updated":"2017-08-10T17:45:27.779+0000","started":"2017-08-10T17:45:27.778+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"50437","issueId":"13091961"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/51062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2271#discussion_r134869659\n  \n    --- Diff: examples/storm-kafka-examples/pom.xml ---\n    @@ -43,19 +48,19 @@\n                 <groupId>org.apache.storm</groupId>\n                 <artifactId>storm-kafka</artifactId>\n                 <version>${project.version}</version>\n    -            <scope>${provided.scope}</scope>\n    +            <scope>${kafka.dependency.scope}</scope>\n             </dependency>\n             <dependency>\n                 <groupId>org.apache.kafka</groupId>\n                 <artifactId>${storm.kafka.artifact.id}</artifactId>\n                 <version>${storm.kafka.version}</version>\n    -            <scope>${provided.scope}</scope>\n    +            <scope>${kafka.dependency.scope}</scope>\n             </dependency>\n             <dependency>\n                 <groupId>org.apache.kafka</groupId>\n                 <artifactId>kafka-clients</artifactId>\n                 <version>${storm.kafka.version}</version>\n    -            <scope>${provided.scope}</scope>\n    +            <scope>${kafka.dependency.scope}</scope>\n    --- End diff --\n    \n    Can we just make this compile like the others?  You can still override it in your jars if you want to.\n","created":"2017-08-23T21:06:09.522+0000","updated":"2017-08-23T21:06:09.522+0000","started":"2017-08-23T21:06:09.520+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51062","issueId":"13091961"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/51063","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user srdo commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2271#discussion_r134874369\n  \n    --- Diff: examples/storm-kafka-examples/pom.xml ---\n    @@ -43,19 +48,19 @@\n                 <groupId>org.apache.storm</groupId>\n                 <artifactId>storm-kafka</artifactId>\n                 <version>${project.version}</version>\n    -            <scope>${provided.scope}</scope>\n    +            <scope>${kafka.dependency.scope}</scope>\n             </dependency>\n             <dependency>\n                 <groupId>org.apache.kafka</groupId>\n                 <artifactId>${storm.kafka.artifact.id}</artifactId>\n                 <version>${storm.kafka.version}</version>\n    -            <scope>${provided.scope}</scope>\n    +            <scope>${kafka.dependency.scope}</scope>\n             </dependency>\n             <dependency>\n                 <groupId>org.apache.kafka</groupId>\n                 <artifactId>kafka-clients</artifactId>\n                 <version>${storm.kafka.version}</version>\n    -            <scope>${provided.scope}</scope>\n    +            <scope>${kafka.dependency.scope}</scope>\n    --- End diff --\n    \n    Sure, since storm-kafka-client-examples doesn't depend on storm-kafka-examples anymore this isn't important. I'll change it to compile in storm-kafka-client-examples too.\n","created":"2017-08-23T21:21:46.234+0000","updated":"2017-08-23T21:21:46.234+0000","started":"2017-08-23T21:21:46.233+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51063","issueId":"13091961"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/51941","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2271\n","created":"2017-09-08T14:25:51.956+0000","updated":"2017-09-08T14:25:51.956+0000","started":"2017-09-08T14:25:51.955+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"51941","issueId":"13091961"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/52020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user srdo opened a pull request:\n\n    https://github.com/apache/storm/pull/2317\n\n    STORM-2675 (1.x): Fix storm-kafka-client Trident spout failing to serialize…\n\n    … meta objects to Zookeeper\n    \n    1.x version of https://github.com/apache/storm/pull/2271.\n    \n    The only changes should be replacing streams with regular for-each, and this version doesn't modify the storm-kafka-client-examples.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/srdo/storm STORM-2675-1.x\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2317.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2317\n    \n----\ncommit 9e137eeb40e74c46e515db4bf65a1963874da6c5\nAuthor: Stig Rohde Døssing <srdo@apache.org>\nDate:   2017-08-04T00:53:42Z\n\n    STORM-2675: Fix storm-kafka-client Trident spout failing to serialize meta objects to Zookeeper\n\n----\n","created":"2017-09-10T11:08:48.421+0000","updated":"2017-09-10T11:08:48.421+0000","started":"2017-09-10T11:08:48.408+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"52020","issueId":"13091961"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/52297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2317\n  \n    Built in my local and verified it passed with JDK 7. +1 \n","created":"2017-09-13T07:05:15.378+0000","updated":"2017-09-13T07:05:15.378+0000","started":"2017-09-13T07:05:15.377+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"52297","issueId":"13091961"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091961/worklog/52326","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/storm/pull/2317\n","created":"2017-09-13T08:04:14.945+0000","updated":"2017-09-13T08:04:14.945+0000","started":"2017-09-13T08:04:14.943+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"52326","issueId":"13091961"}]},"customfield_12311820":"0|i3ic3z:"}}