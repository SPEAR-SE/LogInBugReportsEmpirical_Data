{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12691860","self":"https://issues.apache.org/jira/rest/api/2/issue/12691860","key":"STORM-204","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2014-01-28 22:08:57.718","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"370507","customfield_12312321":null,"resolutiondate":null,"workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-204/watchers","watchCount":1,"isWatching":false},"created":"2014-01-28T22:08:57.718+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":["local","local-job-runner","testing"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":86400,"aggregatetimeoriginalestimate":86400,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T00:24:16.423+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":86400,"description":"We've been testing some Storm topologies using \"lein repl\". Based on the storm-starter project, our local testing environment offers a Clojure function (run-local!), which builts up the topology using the Clojure DSL and runs it. The issue is that there are conditions that can cause topology to fail; the exception thrown then crashes the Storm worker, which, in turn, crashes the lein repl itself. This is frustrating since part of the purpose of running a local cluster is to test it from something like a REPL.\n\nI think I've narrowed down what's going wrong. You can see an example session with stacktrace here:\n\nhttps://gist.github.com/amontalenti/8677464#file-example_storm_crashing_lein-txt-L142-L173\n\nThe way I created this error is by renaming my Python module before running the topology, so that the Python file could not be found.\n\nI think what's going on is that the ShellBolt is throwing a RuntimeException, which is uncaught by whatever is running the ShellBolt. This, in turn, crashes the worker: \"Error when launching multilang subprocess\". The executor notices that the worker dies, but is a bit zealous and decides to call (halt-process!) on it. Under the hood, halt-process! uses Runtime.getRuntime#halt, which is a forcible kill of the running JVM. Since the JVM, in this case, is \"lein repl\", I think this is what ultimately kills the REPL.\n\nhttp://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html#halt(int)\n\nI suppose there are two possible fixes here. One is to make the Storm worker a little more resilient to a misconfigured ShellBolt. The other is to make the halt-process! call not run when a REPL environment is detected.\n\nI am glad to work on either of these fixes once the issue is confirmed and a path forward is suggested.","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":86400,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"370817","customfield_12312823":null,"summary":"Local topologies that throw exceptions can crash the REPL","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amontalenti","name":"amontalenti","key":"amontalenti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=amontalenti&avatarId=19897","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=amontalenti&avatarId=19897","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=amontalenti&avatarId=19897","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=amontalenti&avatarId=19897"},"displayName":"Andrew Montalenti","active":true,"timeZone":"America/New_York"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amontalenti","name":"amontalenti","key":"amontalenti","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=amontalenti&avatarId=19897","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=amontalenti&avatarId=19897","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=amontalenti&avatarId=19897","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=amontalenti&avatarId=19897"},"displayName":"Andrew Montalenti","active":true,"timeZone":"America/New_York"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":86400,"percent":0},"environment":"$ java -version\njava version \"1.7.0_45\"\nJava(TM) SE Runtime Environment (build 1.7.0_45-b18)\nJava HotSpot(TM) 64-Bit Server VM (build 24.45-b08, mixed mode)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":86400,"percent":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-204/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ruvr:"}}