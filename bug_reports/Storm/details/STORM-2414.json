{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13056145","self":"https://issues.apache.org/jira/rest/api/2/issue/13056145","key":"STORM-2414","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":19200,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335748","id":"12335748","name":"1.1.0","archived":false,"released":true,"releaseDate":"2017-03-29"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339564","id":"12339564","name":"1.0.4","archived":false,"released":true,"releaseDate":"2017-07-28"}],"aggregatetimespent":19200,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Mar 20 08:54:54 UTC 2017","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_9165154_*|*_3_*:*_1_*:*_449198351_*|*_5_*:*_1_*:*_0","customfield_12310420":"9223372036854775807","customfield_12312321":null,"resolutiondate":"2017-03-20T08:54:54.820+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2414/watchers","watchCount":1,"isWatching":false},"created":"2017-03-15T01:35:31.362+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334657","id":"12334657","name":"2.0.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335748","id":"12335748","name":"1.1.0","archived":false,"released":true,"releaseDate":"2017-03-29"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339564","id":"12339564","name":"1.0.4","archived":false,"released":true,"releaseDate":"2017-07-28"}],"customfield_12312339":null,"issuelinks":[],"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-03-20T08:54:54.855+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"When BlobStore.deleteBlob is called, it always tries to get blobs if not existed on local because the logic needs to check ACL with given subject. That is not necessary when syncing up blobs in follower Nimbuses.\n\nMore generically, some subjects have write privilege for any blobs (say, superuser or admin) and for them BlobStore doesn't need to check (even download) meta's ACL and just deletes them from storage.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"5h 20m","remainingEstimateSeconds":0,"timeSpentSeconds":19200},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[],"customfield_12312340":null,"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Skip checking meta's ACL when subject has write privileges for any blobs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":19200,"total":19200,"percent":100},"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":19200,"total":19200,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/comment/15932341","id":"15932341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"body":"Merged into master, 1.x, 1.0.x branches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kabhwan","name":"kabhwan","key":"kabhwan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jungtaek Lim","active":true,"timeZone":"Asia/Seoul"},"created":"2017-03-20T08:54:54.850+0000","updated":"2017-03-20T08:54:54.850+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-2414/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":32,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user HeartSaVioR opened a pull request:\n\n    https://github.com/apache/storm/pull/2005\n\n    STORM-2414 Skip checking ACL when clearing already removed blob from …\n\n    …local / HDFS blobstore\n    \n    Syncing up blobs throws KeyNotFoundException when deleting blobs which are already deleted from ZK.\n    Currently deleting blob requires pulling the latest change first to check ACL. That makes sense, but in above case we already deleted the blob from ZK so it just fails. We need to have \"force delete\" when request for deletion comes from syncing up blobs.\n    \n    * add new method: clearRemovedBlob\n      * skip checking ACL while deleting when blob is already removed from ZK\n    \n    This patch is easy to be cherry-picked to master and 1.0.x branches as well.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/HeartSaVioR/storm STORM-2414-1.x\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/storm/pull/2005.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #2005\n    \n----\ncommit d0ef90e24d567ccb87c5de545f5478a17e37f68e\nAuthor: Jungtaek Lim <kabhwan@gmail.com>\nDate:   2017-03-15T03:47:14Z\n\n    STORM-2414 Skip checking ACL when clearing already removed blob from local / HDFS blobstore\n    \n    * add new method: clearRemovedBlob\n      * skip checking ACL while deleting when blob is already removed from ZK\n\n----\n","created":"2017-03-15T04:05:25.984+0000","updated":"2017-03-15T04:05:25.984+0000","started":"2017-03-15T04:05:25.984+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39174","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user harshach commented on the issue:\n\n    https://github.com/apache/storm/pull/2005\n  \n    +1\n\n","created":"2017-03-15T23:37:14.232+0000","updated":"2017-03-15T23:37:14.232+0000","started":"2017-03-15T23:37:14.232+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39299","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39306","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106334482\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/BlobStore.java ---\n    @@ -128,6 +128,15 @@\n         public abstract void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException;\n     \n         /**\n    +     * Clear the blob data and metadata which is already removed from ZK.\n    +     * Implementation should just remove the blob as it is.\n    +     * This method should be used ONLY for syncing up blobs in Nimbus.\n    +     * @param key Key for the blob.\n    +     * @throws AuthorizationException\n    +     */\n    +    public abstract void clearRemovedBlob(String key) throws AuthorizationException;\n    --- End diff --\n    \n    Is `BlobStore` a public API, which users can write their own implementations? If so, then this change would not be a backward compatible change for those users.\n","created":"2017-03-16T03:52:06.086+0000","updated":"2017-03-16T03:52:06.086+0000","started":"2017-03-16T03:52:06.085+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39306","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106340804\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -231,6 +231,18 @@ public void deleteBlob(String key, Subject who) throws AuthorizationException, K\n         }\n     \n         @Override\n    +    public void clearRemovedBlob(String key) throws AuthorizationException {\n    +        validateKey(key);\n    +        // not pulling recent change and checking ACL\n    --- End diff --\n    \n    if you handle this in deleteBlob itself, we don't need to add new api to blobstore. i.e. if getStoredBlobMeta throws KeyNotFoundException, just log it and skip the ACL check and proceed with deleting the keys.\n","created":"2017-03-16T05:19:11.814+0000","updated":"2017-03-16T05:19:11.814+0000","started":"2017-03-16T05:19:11.813+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39316","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106342738\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/BlobStore.java ---\n    @@ -128,6 +128,15 @@\n         public abstract void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException;\n     \n         /**\n    +     * Clear the blob data and metadata which is already removed from ZK.\n    +     * Implementation should just remove the blob as it is.\n    +     * This method should be used ONLY for syncing up blobs in Nimbus.\n    +     * @param key Key for the blob.\n    +     * @throws AuthorizationException\n    +     */\n    +    public abstract void clearRemovedBlob(String key) throws AuthorizationException;\n    --- End diff --\n    \n    @satishd \n    Yes but no one would implement their own BlobStore. \n    Btw, as @arunmahadevan suggested, we can do it without this change. I'll change it.\n","created":"2017-03-16T05:42:42.306+0000","updated":"2017-03-16T05:42:42.306+0000","started":"2017-03-16T05:42:42.306+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39317","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106342906\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -231,6 +231,18 @@ public void deleteBlob(String key, Subject who) throws AuthorizationException, K\n         }\n     \n         @Override\n    +    public void clearRemovedBlob(String key) throws AuthorizationException {\n    +        validateKey(key);\n    +        // not pulling recent change and checking ACL\n    --- End diff --\n    \n    @arunmahadevan \n    Yes I was thinking about that way but over-thought about false-positive (when ZK is down, throwing Exception, etc). KeyNotFoundException clearly states that ZK is accessible and key is not exist so no false-positive. Thanks I'll address this.\n","created":"2017-03-16T05:45:00.088+0000","updated":"2017-03-16T05:45:00.088+0000","started":"2017-03-16T05:45:00.088+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39318","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106343405\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/BlobStore.java ---\n    @@ -128,6 +128,15 @@\n         public abstract void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException;\n     \n         /**\n    +     * Clear the blob data and metadata which is already removed from ZK.\n    +     * Implementation should just remove the blob as it is.\n    +     * This method should be used ONLY for syncing up blobs in Nimbus.\n    +     * @param key Key for the blob.\n    +     * @throws AuthorizationException\n    +     */\n    +    public abstract void clearRemovedBlob(String key) throws AuthorizationException;\n    --- End diff --\n    \n    @HeartSaVioR :) May not want to assume no one implements their store when it is a public API. Anyways, good that  `deleteBlob` can be changed to handle this scenario.\n","created":"2017-03-16T05:50:43.393+0000","updated":"2017-03-16T05:50:43.393+0000","started":"2017-03-16T05:50:43.393+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39319","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39320","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106346237\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,9 +219,20 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    --- End diff --\n    \n    Here KeyNotFoundException is thrown when blob is removed from ZK.\n","created":"2017-03-16T06:23:52.179+0000","updated":"2017-03-16T06:23:52.179+0000","started":"2017-03-16T06:23:52.177+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39320","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39321","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106346290\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,9 +219,20 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    +        } catch (KeyNotFoundException e) {\n    +            // not exist in ZK so this blob should be deleted regardless of permission\n    +            checkPermission = false;\n    +        }\n    +\n    +        if (checkPermission) {\n    +            SettableBlobMeta meta = getStoredBlobMeta(key);\n    --- End diff --\n    \n    Here KeyNotFoundException is thrown when blob file is not found.\n","created":"2017-03-16T06:24:27.540+0000","updated":"2017-03-16T06:24:27.540+0000","started":"2017-03-16T06:24:27.540+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39321","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2005\n  \n    @harshach @satishd @arunmahadevan Addressed. Please review again. Thanks in advance!\n","created":"2017-03-16T06:25:00.136+0000","updated":"2017-03-16T06:25:00.136+0000","started":"2017-03-16T06:25:00.135+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39322","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106346689\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,9 +219,20 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    +        } catch (KeyNotFoundException e) {\n    +            // not exist in ZK so this blob should be deleted regardless of permission\n    --- End diff --\n    \n    maybe just add some logs here.\n","created":"2017-03-16T06:28:57.049+0000","updated":"2017-03-16T06:28:57.049+0000","started":"2017-03-16T06:28:57.049+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39323","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on the issue:\n\n    https://github.com/apache/storm/pull/2005\n  \n    +1\n","created":"2017-03-16T06:46:36.666+0000","updated":"2017-03-16T06:46:36.666+0000","started":"2017-03-16T06:46:36.666+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39324","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106349077\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,9 +219,20 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    --- End diff --\n    \n    Sorry I was mistaken... Even if there's no key on ZK, KeyNotFoundException is not thrown.\n    KeyNotFoundException is thrown only when there's race condition between ZK node update and removing node from ZK.\n","created":"2017-03-16T06:54:45.882+0000","updated":"2017-03-16T06:54:45.882+0000","started":"2017-03-16T06:54:45.881+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39325","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on the issue:\n\n    https://github.com/apache/storm/pull/2005\n  \n    @arunmahadevan @satishd \n    Sorry please take a look again. Actually origin issue was observed when meta blob file is already deleted. (I've mistaken the codebase.) Changed to ignore the FNF exception when deleting file.\n","created":"2017-03-16T14:25:27.031+0000","updated":"2017-03-16T14:25:27.031+0000","started":"2017-03-16T14:25:27.030+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39352","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39362","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106439220\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,9 +219,20 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    --- End diff --\n    \n    If it does not throw `KeyNotFoundException` when there is no key on ZK then how do you find out whether the given key exists or not on ZK so that you can set `checkPermission` as `false`.\n","created":"2017-03-16T14:55:57.730+0000","updated":"2017-03-16T14:55:57.730+0000","started":"2017-03-16T14:55:57.730+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39362","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39364","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user satishd commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106440281\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,17 +219,44 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    +        } catch (KeyNotFoundException e) {\n    +            LOG.warn(\"Detected deletion from ZK for the key {} while pulling the latest change. Needs to be deleted. key: {}\", key);\n    +            checkPermission = false;\n    +        }\n    +\n    +        if (checkPermission) {\n    +            try {\n    +                SettableBlobMeta meta = getStoredBlobMeta(key);\n    +                _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +            } catch (KeyNotFoundException e) {\n    +                // meta file is not exist, skip handling error to delete data file\n    --- End diff --\n    \n    nit: meta file does not exist\n","created":"2017-03-16T14:59:26.703+0000","updated":"2017-03-16T14:59:26.703+0000","started":"2017-03-16T14:59:26.702+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39364","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user arunmahadevan commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106455903\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,17 +219,44 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    +        } catch (KeyNotFoundException e) {\n    +            LOG.warn(\"Detected deletion from ZK for the key {} while pulling the latest change. Needs to be deleted. key: {}\", key);\n    +            checkPermission = false;\n    +        }\n    +\n    +        if (checkPermission) {\n    --- End diff --\n    \n    Instead of this can you combine the two `try...catch` into something like\n    ```java\n    try {\n     checkForBlobOrDownload(key);\n     SettableBlobMeta meta = getStoredBlobMeta(key);\n     _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    } catch (KeyNotFoundException e) {\n     LOG.warn(...);\n    }\n    ```\n\n","created":"2017-03-16T15:52:11.591+0000","updated":"2017-03-16T15:52:11.591+0000","started":"2017-03-16T15:52:11.590+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39371","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39412","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106584243\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,17 +219,44 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    +        } catch (KeyNotFoundException e) {\n    +            LOG.warn(\"Detected deletion from ZK for the key {} while pulling the latest change. Needs to be deleted. key: {}\", key);\n    +            checkPermission = false;\n    +        }\n    +\n    +        if (checkPermission) {\n    --- End diff --\n    \n    The meaning for KeyNotFoundException is different between `checkForBlobOrDownload` and `getStoredBlobMeta`. First one indicates ZK node is not exist and second one indicates META blob file in local is not exist.\n","created":"2017-03-17T05:01:15.914+0000","updated":"2017-03-17T05:01:15.914+0000","started":"2017-03-17T05:01:15.913+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39412","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39414","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106584346\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,17 +219,44 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    +        } catch (KeyNotFoundException e) {\n    +            LOG.warn(\"Detected deletion from ZK for the key {} while pulling the latest change. Needs to be deleted. key: {}\", key);\n    +            checkPermission = false;\n    +        }\n    +\n    +        if (checkPermission) {\n    +            try {\n    +                SettableBlobMeta meta = getStoredBlobMeta(key);\n    +                _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +            } catch (KeyNotFoundException e) {\n    +                // meta file is not exist, skip handling error to delete data file\n    --- End diff --\n    \n    Thanks addressed.\n","created":"2017-03-17T05:03:07.062+0000","updated":"2017-03-17T05:03:07.062+0000","started":"2017-03-17T05:03:07.061+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39414","issueId":"13056145"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056145/worklog/39415","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user HeartSaVioR commented on a diff in the pull request:\n\n    https://github.com/apache/storm/pull/2005#discussion_r106584890\n  \n    --- Diff: storm-core/src/jvm/org/apache/storm/blobstore/LocalFsBlobStore.java ---\n    @@ -219,9 +219,20 @@ public void setBlobMeta(String key, SettableBlobMeta meta, Subject who) throws A\n         @Override\n         public void deleteBlob(String key, Subject who) throws AuthorizationException, KeyNotFoundException {\n             validateKey(key);\n    -        checkForBlobOrDownload(key);\n    -        SettableBlobMeta meta = getStoredBlobMeta(key);\n    -        _aclHandler.hasPermissions(meta.get_acl(), WRITE, who, key);\n    +\n    +        boolean checkPermission = true;\n    +        try {\n    +            checkForBlobOrDownload(key);\n    --- End diff --\n    \n    Maybe we would need to check ZK and set checkPermission to false. \n    If there's race condition so ZK node didn't exist but added later, we might skip pulling latest information and delete the blob in local anyway, but it should be occurred only from standby Nimbus and the blob will be re-pulled at next sync up.\n    \n    I'll make appropriate change. Thanks.\n","created":"2017-03-17T05:11:48.476+0000","updated":"2017-03-17T05:11:48.476+0000","started":"2017-03-17T05:11:48.475+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"39415","issueId":"13056145"}]},"customfield_12311820":"0|i3ca1r:"}}