{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12698657","self":"https://issues.apache.org/jira/rest/api/2/issue/12698657","key":"STORM-250","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12314820","id":"12314820","key":"STORM","name":"Apache Storm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13260","id":"13260","description":"Apache Storm Related","name":"Storm"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-03-04T17:17:16.863+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Mar 07 18:34:30 UTC 2014","customfield_12312320":null,"customfield_12310222":null,"customfield_12310420":"377015","customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-250/watchers","watchCount":2,"isWatching":false},"created":"2014-03-04T16:07:21.869+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":["storm","ui"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"customfield_12312339":null,"issuelinks":[],"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-09T00:23:00.942+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12327950","id":"12327950","name":"storm-core","description":"Core storm daemons and APIs including trident"}],"timeoriginalestimate":null,"description":"Occasionally, the ui daemon runs out of available file handles and can't open a socket to the nimbus:\n\n# grep -A1 ERROR ui.log \n2014-02-28 07:44:14 o.a.t.t.TSocket [ERROR] Could not configure socket.\njava.net.SocketException: Too many open files\n--\n2014-03-01 16:44:10 o.a.t.t.TSocket [ERROR] Could not configure socket.\njava.net.SocketException: Too many open files\n--\n2014-03-03 01:29:04 o.a.t.t.TSocket [ERROR] Could not configure socket.\njava.net.SocketException: Too many open files\n--\n2014-03-03 01:34:04 o.a.t.t.TSocket [ERROR] Could not configure socket.\njava.net.SocketException: Too many open files\n--\n2014-03-04 09:39:01 o.a.t.t.TSocket [ERROR] Could not configure socket.\njava.net.SocketException: Too many open files\n--\n2014-03-04 09:45:33 o.a.t.t.TSocket [ERROR] Could not configure socket.\njava.net.SocketException: Too many open files","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12633203","id":"12633203","filename":"lsof.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=veetow","name":"veetow","key":"veetow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vito Laurenza","active":true,"timeZone":"Etc/UTC"},"created":"2014-03-06T18:52:40.616+0000","size":68923,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12633203/lsof.txt"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"377310","customfield_12312823":null,"summary":"Storm UI: Too many open files","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=veetow","name":"veetow","key":"veetow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vito Laurenza","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=veetow","name":"veetow","key":"veetow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vito Laurenza","active":true,"timeZone":"Etc/UTC"},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"# cat /etc/redhat-release \nCentOS release 6.2 (Final)\n# uname -a\nLinux {{redacted}} 2.6.32-220.el6.x86_64 #1 SMP Tue Dec 6 19:48:22 GMT 2011 x86_64 x86_64 x86_64 GNU/Linux\n# ulimit -a\ncore file size          (blocks, -c) 0\ndata seg size           (kbytes, -d) unlimited\nscheduling priority             (-e) 0\nfile size               (blocks, -f) unlimited\npending signals                 (-i) 30514\nmax locked memory       (kbytes, -l) 64\nmax memory size         (kbytes, -m) unlimited\nopen files                      (-n) 1024\npipe size            (512 bytes, -p) 8\nPOSIX message queues     (bytes, -q) 819200\nreal-time priority              (-r) 0\nstack size              (kbytes, -s) 10240\ncpu time               (seconds, -t) unlimited\nmax user processes              (-u) 1024\nvirtual memory          (kbytes, -v) unlimited\nfile locks                      (-x) unlimited","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12698657/comment/13919642","id":"13919642","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"When this is happening have you checked to see where all of the file handles are being used?  you can run sudo lsof -p PID and look to see what is taking all of the file handles.  There might be a leak somewhere in there that we need to deal with.  If all of them look normal boosting the open file limit seems reasonable.  1024 is a good limit for most things, but a heavily used web server often will need more then that. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-03-04T17:17:16.863+0000","updated":"2014-03-04T17:17:16.863+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12698657/comment/13921190","id":"13921190","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=veetow","name":"veetow","key":"veetow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vito Laurenza","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~revans2],\n\nIt seems to clear up by itself so I haven't caught it in the act.  I'll have to see if I can cron an lsof if the number of open file handles goes too high.\n\n--Vito","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=veetow","name":"veetow","key":"veetow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vito Laurenza","active":true,"timeZone":"Etc/UTC"},"created":"2014-03-05T18:44:12.341+0000","updated":"2014-03-05T18:44:12.341+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12698657/comment/13922881","id":"13922881","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=veetow","name":"veetow","key":"veetow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vito Laurenza","active":true,"timeZone":"Etc/UTC"},"body":"Attached is lsof output showing file descriptors held open for many sockets which no longer exist.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=veetow","name":"veetow","key":"veetow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vito Laurenza","active":true,"timeZone":"Etc/UTC"},"created":"2014-03-06T18:52:40.620+0000","updated":"2014-03-06T18:52:40.620+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12698657/comment/13924174","id":"13924174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"Reading through things lsof seems to report 'can't identify protocol' when the socket is closed, but the file descriptor is not closed.\n\nsee http://stackoverflow.com/questions/7911840/seeing-too-many-lsof-cant-identify-protocol\n\nThere could be other situations too.  My guess would be that for some reason a code path is being executed for thrift where the socket is not fully closed and we end up relying on the garbage collector to clean up the connection.  Java streams typically have a finalizer in them that will close the underlying file handle when called, but It takes two passes of the gc before they can be collected.  I have seen similar issues in other projects where a burst of traffic would make it difficult for them all to shut down.\n\nI am not sure what is causing it here though.  I cannot reproduce it with the version of storm that I have been running, but I have not tried it with 0.9.0.1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2014-03-07T18:34:30.394+0000","updated":"2014-03-07T18:34:30.394+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/STORM-250/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1sysn:"}}