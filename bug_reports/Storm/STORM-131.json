{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [{
            "description": "Core storm daemons and APIs including trident",
            "id": "12327950",
            "name": "storm-core",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12327950"
        }],
        "created": "2013-12-15T05:12:43.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354"
            },
            "displayName": "James Xu",
            "key": "xumingming",
            "name": "xumingming",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=xumingming",
            "timeZone": "Asia/Shanghai"
        },
        "customfield_10010": null,
        "customfield_12310220": null,
        "customfield_12310222": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310420": "363829",
        "customfield_12310920": "364135",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i1qppb:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "2013-12-15 05:12:43.0",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "https://github.com/nathanmarz/storm/issues/259\n\nWe have a great deal of Storm integration tests in our project (Storm version 0.7.3) using local topology. We have only one topology operational at any moment in time. As tests run they are organized in groups. Each group works within the boundaries of a topology. When the tests finish executing they shutdown their local cluster, then the new group of tests launches its own cluster.\n\nWe see with some remarkable regularity failures related to, what looks like, incorrect Zookeeper shutdown, which leads to a JVM exit (which is a disaster as no test information is recorded at the end). Here is what we see in the main error log (log level: WARN and higher):\n\n{code}\n2012-07-07 00:22:58,420 WARN [ConnectionStateManager-0|]@jenkins com.netflix.curator.framework.state.ConnectionStateManager\n=> There are no ConnectionStateListeners registered.\n\n2012-07-07 00:22:58,534 WARN [Thread-23-EventThread|]@jenkins backtype.storm.cluster\n=> Received event :disconnected::none: with disconnected Zookeeper.\n\n2012-07-07 00:23:00,013 WARN [Thread-23-SendThread(localhost:2000)|]@jenkins org.apache.zookeeper.ClientCnxn\n=> Session 0x1385ece8f1b0017 for server null, unexpected error, closing socket connection and attempting reconnect\n\njava.net.ConnectException: Connection refused\nat sun.nio.ch.SocketChannelImpl.$$YJP$$checkConnect(Native Method)\nat sun.nio.ch.SocketChannelImpl.checkConnect(SocketChannelImpl.java)\nat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:567)\nat org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1119)\n2012-07-07 00:23:01,527 WARN [Thread-23-SendThread(localhost:2000)|]@jenkins org.apache.zookeeper.ClientCnxn\n=> Session 0x1385ece8f1b0017 for server null, unexpected error, closing socket connection and attempting reconnect\n\njava.net.ConnectException: Connection refused\nat sun.nio.ch.SocketChannelImpl.$$YJP$$checkConnect(Native Method)\nat sun.nio.ch.SocketChannelImpl.checkConnect(SocketChannelImpl.java)\nat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:567)\nat org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1119)\n2012-07-07 00:23:03,510 WARN [Thread-23-SendThread(localhost:2000)|]@jenkins org.apache.zookeeper.ClientCnxn\n=> Session 0x1385ece8f1b0017 for server null, unexpected error, closing socket connection and attempting reconnect\n\njava.net.ConnectException: Connection refused\nat sun.nio.ch.SocketChannelImpl.$$YJP$$checkConnect(Native Method)\nat sun.nio.ch.SocketChannelImpl.checkConnect(SocketChannelImpl.java)\nat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:567)\nat org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1119)\n2012-07-07 00:23:04,687 WARN [Thread-23-SendThread(localhost:2000)|]@jenkins org.apache.zookeeper.ClientCnxn\n=> Session 0x1385ece8f1b0017 for server null, unexpected error, closing socket connection and attempting reconnect\n\njava.net.ConnectException: Connection refused\nat sun.nio.ch.SocketChannelImpl.$$YJP$$checkConnect(Native Method)\nat sun.nio.ch.SocketChannelImpl.checkConnect(SocketChannelImpl.java)\nat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:567)\nat org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1119)\n2012-07-07 00:23:05,961 WARN [Thread-23-SendThread(localhost:2000)|]@jenkins org.apache.zookeeper.ClientCnxn\n=> Session 0x1385ece8f1b0017 for server null, unexpected error, closing socket connection and attempting reconnect\n\njava.net.ConnectException: Connection refused\nat sun.nio.ch.SocketChannelImpl.$$YJP$$checkConnect(Native Method)\nat sun.nio.ch.SocketChannelImpl.checkConnect(SocketChannelImpl.java)\nat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:567)\nat org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1119)\n2012-07-07 00:23:07,588 WARN [Thread-23-SendThread(localhost:2000)|]@jenkins org.apache.zookeeper.ClientCnxn\n=> Session 0x1385ece8f1b0017 for server null, unexpected error, closing socket connection and attempting reconnect\n\njava.net.ConnectException: Connection refused\nat sun.nio.ch.SocketChannelImpl.$$YJP$$checkConnect(Native Method)\nat sun.nio.ch.SocketChannelImpl.checkConnect(SocketChannelImpl.java)\nat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:567)\nat org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1119)\n2012-07-07 00:23:07,691 ERROR [Thread-23-EventThread|]@jenkins com.netflix.curator.framework.imps.CuratorFrameworkImpl\n=> Background operation retry gave up\n\norg.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\nat org.apache.zookeeper.KeeperException.create(KeeperException.java:90)\nat com.netflix.curator.framework.imps.CuratorFrameworkImpl.processBackgroundOperation(CuratorFrameworkImpl.java:380)\nat com.netflix.curator.framework.imps.BackgroundSyncImpl$1.processResult(BackgroundSyncImpl.java:49)\nat org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:617)\nat org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:506)\n2012-07-07 00:23:07,697 WARN [ConnectionStateManager-0|]@jenkins com.netflix.curator.framework.state.ConnectionStateManager\n=> There are no ConnectionStateListeners registered.\n\n2012-07-07 00:23:07,699 ERROR [Thread-23-EventThread|]@jenkins backtype.storm.zookeeper\n=> Unrecoverable Zookeeper error Background operation retry gave up\n\norg.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\nat org.apache.zookeeper.KeeperException.create(KeeperException.java:90)\nat com.netflix.curator.framework.imps.CuratorFrameworkImpl.processBackgroundOperation(CuratorFrameworkImpl.java:380)\nat com.netflix.curator.framework.imps.BackgroundSyncImpl$1.processResult(BackgroundSyncImpl.java:49)\nat org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:617)\n\nat org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:506)\nAnd here is what we see in Storm dedicated log file (log level: DEBUG):\n\n2012-07-07 00:22:58,306 INFO [main|]@jenkins backtype.storm.daemon.task\n=> Shut down task TLTopology-1-1341620393:31\n\n2012-07-07 00:22:58,306 INFO [main|]@jenkins backtype.storm.messaging.loader\n=> Shutting down receiving-thread: [TLTopology-1-1341620393, 5]\n\n2012-07-07 00:22:58,307 INFO [main|]@jenkins backtype.storm.messaging.loader\n=> Waiting for receiving-thread:[TLTopology-1-1341620393, 5] to die\n\n2012-07-07 00:22:58,307 INFO [Thread-319|]@jenkins backtype.storm.messaging.loader\n=> Receiving-thread:[TLTopology-1-1341620393, 5] received shutdown notice\n\n2012-07-07 00:22:58,307 INFO [main|]@jenkins backtype.storm.messaging.loader\n=> Shutdown receiving-thread: [TLTopology-1-1341620393, 5]\n\n2012-07-07 00:22:58,307 INFO [main|]@jenkins backtype.storm.daemon.worker\n=> Terminating zmq context\n\n2012-07-07 00:22:58,307 INFO [main|]@jenkins backtype.storm.daemon.worker\n=> Waiting for threads to die\n\n2012-07-07 00:22:58,307 INFO [Thread-318|]@jenkins backtype.storm.util\n=> Async loop interrupted!\n\n2012-07-07 00:22:58,309 INFO [main|]@jenkins backtype.storm.daemon.worker\n=> Disconnecting from storm cluster state context\n\n2012-07-07 00:22:58,311 INFO [main|]@jenkins backtype.storm.daemon.worker\n=> Shut down worker TLTopology-1-1341620393 96e12303-4c22-4821-9f3b-3bce2230bf08 5\n\n2012-07-07 00:22:58,311 DEBUG [main|]@jenkins backtype.storm.util\n=> Rmr path /tmp/f308eb0e-2e72-4221-9620-43e15a9c1bdc/workers/16966f32-d0d4-4ee1-a0fe-1d85fc4a478e/heartbeats\n\n2012-07-07 00:22:58,313 DEBUG [main|]@jenkins backtype.storm.util\n=> Removing path /tmp/f308eb0e-2e72-4221-9620-43e15a9c1bdc/workers/16966f32-d0d4-4ee1-a0fe-1d85fc4a478e/pids\n\n2012-07-07 00:22:58,313 DEBUG [main|]@jenkins backtype.storm.util\n=> Removing path /tmp/f308eb0e-2e72-4221-9620-43e15a9c1bdc/workers/16966f32-d0d4-4ee1-a0fe-1d85fc4a478e\n\n2012-07-07 00:22:58,313 INFO [main|]@jenkins backtype.storm.daemon.supervisor\n=> Shut down 96e12303-4c22-4821-9f3b-3bce2230bf08:16966f32-d0d4-4ee1-a0fe-1d85fc4a478e\n\n2012-07-07 00:22:58,314 INFO [main|]@jenkins backtype.storm.daemon.supervisor\n=> Shutting down supervisor 96e12303-4c22-4821-9f3b-3bce2230bf08\n\n2012-07-07 00:22:58,314 INFO [Thread-25|]@jenkins backtype.storm.event\n=> Event manager interrupted\n\n2012-07-07 00:22:58,315 INFO [Thread-26|]@jenkins backtype.storm.event\n=> Event manager interrupted\n\n2012-07-07 00:22:58,318 INFO [main|]@jenkins backtype.storm.testing\n=> Shutting down in process zookeeper\n\n2012-07-07 00:22:58,321 INFO [main|]@jenkins backtype.storm.testing\n=> Done shutting down in process zookeeper\n\n2012-07-07 00:22:58,321 INFO [main|]@jenkins backtype.storm.testing\n=> Deleting temporary path /tmp/0202cf11-6ad7-4dda-94d6-622a63c9f6b6\n\n2012-07-07 00:22:58,321 DEBUG [main|]@jenkins backtype.storm.util\n=> Rmr path /tmp/0202cf11-6ad7-4dda-94d6-622a63c9f6b6\n\n2012-07-07 00:22:58,322 INFO [main|]@jenkins backtype.storm.testing\n=> Deleting temporary path /tmp/ee47e3e3-752f-40a8-b6a9-a197a9dda3de\n\n2012-07-07 00:22:58,323 DEBUG [main|]@jenkins backtype.storm.util\n=> Rmr path /tmp/ee47e3e3-752f-40a8-b6a9-a197a9dda3de\n\n2012-07-07 00:22:58,323 INFO [main|]@jenkins backtype.storm.testing\n=> Deleting temporary path /tmp/ece72b84-357e-4183-aeb5-e0d2dc5d6eca\n\n2012-07-07 00:22:58,323 DEBUG [main|]@jenkins backtype.storm.util\n=> Rmr path /tmp/ece72b84-357e-4183-aeb5-e0d2dc5d6eca\n\n2012-07-07 00:22:58,326 INFO [main|]@jenkins backtype.storm.testing\n=> Deleting temporary path /tmp/f308eb0e-2e72-4221-9620-43e15a9c1bdc\n\n2012-07-07 00:22:58,326 DEBUG [main|]@jenkins backtype.storm.util\n=> Rmr path /tmp/f308eb0e-2e72-4221-9620-43e15a9c1bdc\n\n2012-07-07 00:22:58,534 WARN [Thread-23-EventThread|]@jenkins backtype.storm.cluster\n=> Received event :disconnected::none: with disconnected Zookeeper.\n\n2012-07-07 00:23:07,699 ERROR [Thread-23-EventThread|]@jenkins backtype.storm.zookeeper\n=> Unrecoverable Zookeeper error Background operation retry gave up\n\norg.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\nat org.apache.zookeeper.KeeperException.create(KeeperException.java:90)\nat com.netflix.curator.framework.imps.CuratorFrameworkImpl.processBackgroundOperation(CuratorFrameworkImpl.java:380)\nat com.netflix.curator.framework.imps.BackgroundSyncImpl$1.processResult(BackgroundSyncImpl.java:49)\nat org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:617)\nat org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:506)\n2012-07-07 00:23:07,702 INFO [Thread-23-EventThread|]@jenkins backtype.storm.util\n\n=> Halting process: (\"Unrecoverable Zookeeper error\")\n\n{code}\nIt seems like a threading issue to me personally. I wonder if there is some form of workaround. I also understand that since this is a \"local\" topology issue, this might not receive due attention... However, fundamentally this is what new users would start with when they begin to play with Storm, and, I think, it is important to make this experience positive.\n\nNathan, thank you very much for everything that you're doing.\n\n-Kyrill\n\n----------\ndkincaid: Looking through the shutdown code for local clusters I noticed a comment in the code about a possible race condition. I'm wondering if we could be running into this on our Jenkins server (which we know runs pretty slowly). Is a worker getting restarted before the supervisor can be shutdown?\n\nHere is the function with the comment:\n\n{code}\n(defn kill-local-storm-cluster [cluster-map]\n  (.shutdown (:nimbus cluster-map))\n  (.close (:state cluster-map))\n  (.disconnect (:storm-cluster-state cluster-map))\n  (doseq [s @(:supervisors cluster-map)]\n    (.shutdown-all-workers s)\n    ;; race condition here? will it launch the workers again?\n    (supervisor/kill-supervisor s))\n  (psim/kill-all-processes)\n  (log-message \"Shutting down in process zookeeper\")\n  (zk/shutdown-inprocess-zookeeper (:zookeeper cluster-map))\n  (log-message \"Done shutting down in process zookeeper\")\n  (doseq [t @(:tmp-dirs cluster-map)]\n    (log-message \"Deleting temporary path \" t)\n    (rmr t)\n    ))\n{code}\n\n--------\nkyrill007: Fantastic catch, Dave!!! This exactly what is happening: supervisor begins launching new workers when the other ones are still being shut down. Here is the proof from the logs:\n\n{code}\nShut down process is initiated at 04:37:05,136.\n\n2012-07-11 04:37:05,136 INFO [main|]@jenkins backtype.storm.daemon.nimbus\n  => Shutting down master\n\n2012-07-11 04:37:05,145 INFO [main|]@jenkins backtype.storm.daemon.nimbus\n  => Shut down master\n\n2012-07-11 04:37:05,151 INFO [main|]@jenkins backtype.storm.daemon.supervisor\n  => Shutting down 5c48d4fc-769f-41ef-abd6-f92df60fa543:12eba15d-fb17-4a3c-8e25-1c0266eed04d\n\n2012-07-11 04:37:05,152 INFO [main|]@jenkins backtype.storm.process-simulator\n  => Killing process ea132b37-dc6a-447c-b1de-ac6727c82cef\n\n2012-07-11 04:37:05,152 INFO [main|]@jenkins backtype.storm.daemon.worker\n  => Shutting down worker TLTopology-1-1341981237 5c48d4fc-769f-41ef-abd6-f92df60fa543 1\n\n2012-07-11 04:37:05,152 INFO [main|]@jenkins backtype.storm.daemon.task\n  => Shutting down task TLTopology-1-1341981237:64\n\n2012-07-11 04:37:05,153 INFO [Thread-129|]@jenkins backtype.storm.util\n  => Async loop interrupted!\n\n2012-07-11 04:37:05,180 INFO [main|]@jenkins backtype.storm.daemon.task\n  => Shut down task TLTopology-1-1341981237:64\n\n2012-07-11 04:37:05,180 INFO [main|]@jenkins backtype.storm.daemon.task\n  => Shutting down task TLTopology-1-1341981237:34\nIt continues for a while (we have a lot of workers). Then at 04:37:05,665 we start seeing this:\n\n012-07-11 04:37:05,665 DEBUG [Thread-19|]@jenkins backtype.storm.daemon.supervisor\n  => Assigned tasks: {2 #backtype.storm.daemon.supervisor.LocalAssignment{:storm-id \"TLTopology-1-1341981237\", :task-ids (96 66 36 6 102 72 42 12 108 78 48 18 114 84 54 24 120 90 60 30 126)}, 1 #backtype.storm.daemon.supervisor.LocalAssignment{:storm-id \"TLTopology-1-1341981237\", :task-ids (64 34 4 100 70 40 10 106 76 46 16 112 82 52 22 118 88 58 28 124 94)}, 3 #backtype.storm.daemon.supervisor.LocalAssignment{:storm-id \"TLTopology-1-1341981237\", :task-ids (32 2 98 68 38 8 104 74 44 14 110 80 50 20 116 86 56 26 122 92 62)}}\n\n2012-07-11 04:37:05,665 DEBUG [Thread-19|]@jenkins backtype.storm.daemon.supervisor\n  => Allocated: {\"a724dc19-84ec-46dc-9768-afb73df94237\" [:valid #backtype.storm.daemon.common.WorkerHeartbeat{:time-secs 1341981425, :storm-id \"TLTopology-1-1341981237\", :task-ids #{96 66 36 6 102 72 42 12 108 78 48 18 114 84 54 24 120 90 60 30 126}, :port 2}]}\n\n2012-07-11 04:37:05,665 DEBUG [Thread-19|]@jenkins backtype.storm.util\n  => Making dirs at /tmp/4884ffb5-c6c7-43a9-ac72-e0a5426eea3c/workers/a7f81ea0-a5f6-47de-9a89-47998b1e1639/pids\n\n2012-07-11 04:37:05,666 DEBUG [Thread-19|]@jenkins backtype.storm.util\n  => Making dirs at /tmp/4884ffb5-c6c7-43a9-ac72-e0a5426eea3c/workers/1b5c4c87-4e05-4cab-a580-ae1dabb3fd2e/pids\n\n2012-07-11 04:37:05,666 INFO [main|]@jenkins backtype.storm.daemon.worker\n  => Shut down worker TLTopology-1-1341981237 5c48d4fc-769f-41ef-abd6-f92df60fa543 2\n\n2012-07-11 04:37:05,667 DEBUG [main|]@jenkins backtype.storm.util\n  => Rmr path /tmp/4884ffb5-c6c7-43a9-ac72-e0a5426eea3c/workers/a724dc19-84ec-46dc-9768-afb73df94237/heartbeats\n\n2012-07-11 04:37:05,669 DEBUG [main|]@jenkins backtype.storm.util\n  => Removing path /tmp/4884ffb5-c6c7-43a9-ac72-e0a5426eea3c/workers/a724dc19-84ec-46dc-9768-afb73df94237/pids\n\n2012-07-11 04:37:05,669 DEBUG [main|]@jenkins backtype.storm.util\n  => Removing path /tmp/4884ffb5-c6c7-43a9-ac72-e0a5426eea3c/workers/a724dc19-84ec-46dc-9768-afb73df94237\n\n2012-07-11 04:37:05,669 INFO [main|]@jenkins backtype.storm.daemon.supervisor\n  => Shut down 5c48d4fc-769f-41ef-abd6-f92df60fa543:a724dc19-84ec-46dc-9768-afb73df94237\n\n2012-07-11 04:37:05,669 INFO [main|]@jenkins backtype.storm.daemon.supervisor\n  => Shutting down supervisor 5c48d4fc-769f-41ef-abd6-f92df60fa543\n\n2012-07-11 04:37:05,670 INFO [Thread-18|]@jenkins backtype.storm.event\n  => Event manager interrupted\n\n2012-07-11 04:37:05,670 INFO [Thread-19|]@jenkins backtype.storm.daemon.supervisor\n  => Launching worker with assignment #backtype.storm.daemon.supervisor.LocalAssignment{:storm-id \"TLTopology-1-1341981237\", :task-ids (64 34 4 100 70 40 10 106 76 46 16 112 82 52 22 118 88 58 28 124 94)} for this supervisor 5c48d4fc-769f-41ef-abd6-f92df60fa543 on port 1 with id a7f81ea0-a5f6-47de-9a89-47998b1e1639\n\n2012-07-11 04:37:05,672 INFO [Thread-19|]@jenkins backtype.storm.daemon.worker\n  => Launching worker for TLTopology-1-1341981237 on 5c48d4fc-769f-41ef-abd6-f92df60fa543:1 with id a7f81ea0-a5f6-47de-9a89-47998b1e1639 and conf {\"dev.zookeeper.path\" \"/tmp/dev-storm-zookeeper\", \"topology.fall.back.on.java.serialization\" true, \"zmq.linger.millis\" 0, \"topology.skip.missing.kryo.registrations\" true, \"ui.childopts\" \"-Xmx768m\", \"storm.zookeeper.session.timeout\" 20000, \"nimbus.reassign\" true, \"nimbus.monitor.freq.secs\" 10, \"java.library.path\" \"/usr/local/lib:/opt/local/lib:/usr/lib\", \"storm.local.dir\" \"/tmp/4884ffb5-c6c7-43a9-ac72-e0a5426eea3c\", \"supervisor.worker.start.timeout.secs\" 120, \"nimbus.cleanup.inbox.freq.secs\" 600, \"nimbus.inbox.jar.expiration.secs\" 3600, \"nimbus.host\" \"localhost\", \"storm.zookeeper.port\" 2000, \"transactional.zookeeper.port\" nil, \"transactional.zookeeper.servers\" nil, \"storm.zookeeper.root\" \"/storm\", \"supervisor.enable\" true, \"storm.zookeeper.servers\" [\"localhost\"], \"transactional.zookeeper.root\" \"/transactional\", \"topology.worker.childopts\" nil, \"worker.childopts\" \"-Xmx768m\", \"supervisor.heartbeat.frequency.secs\" 5, \"drpc.port\" 3772, \"supervisor.monitor.frequency.secs\" 3, \"task.heartbeat.frequency.secs\" 3, \"topology.max.spout.pending\" nil, \"storm.zookeeper.retry.interval\" 1000, \"supervisor.slots.ports\" (1 2 3), \"topology.debug\" false, \"nimbus.task.launch.secs\" 120, \"nimbus.supervisor.timeout.secs\" 60, \"topology.message.timeout.secs\" 30, \"task.refresh.poll.secs\" 10, \"topology.workers\" 1, \"supervisor.childopts\" \"-Xmx1024m\", \"nimbus.thrift.port\" 6627, \"topology.stats.sample.rate\" 0.05, \"worker.heartbeat.frequency.secs\" 1, \"nimbus.task.timeout.secs\" 30, \"drpc.invocations.port\" 3773, \"zmq.threads\" 1, \"storm.zookeeper.retry.times\" 5, \"topology.state.synchronization.timeout.secs\" 60, \"supervisor.worker.timeout.secs\" 30, \"nimbus.file.copy.expiration.secs\" 600, \"drpc.request.timeout.secs\" 600, \"storm.local.mode.zmq\" false, \"ui.port\" 8080, \"nimbus.childopts\" \"-Xmx1024m\", \"topology.ackers\" 1, \"storm.cluster.mode\" \"local\", \"topology.optimize\" true, \"topology.max.task.parallelism\" nil}\n\n2012-07-11 04:37:05,675 INFO [Thread-19|]@jenkins backtype.storm.event\n  => Event manager interrupted\n\n2012-07-11 04:37:05,677 INFO [Thread-19-EventThread|]@jenkins backtype.storm.zookeeper\n  => Zookeeper state update: :connected:none\nwhich at the end result in this:\n\n2012-07-11 04:37:06,175 INFO [Thread-19-EventThread|]@jenkins backtype.storm.zookeeper\n  => Zookeeper state update: :disconnected:none\n\n2012-07-11 04:37:06,175 WARN [Thread-22-EventThread|]@jenkins backtype.storm.cluster\n  => Received event :disconnected::none: with disconnected Zookeeper.\n\n2012-07-11 04:37:15,923 ERROR [Thread-22-EventThread|]@jenkins backtype.storm.zookeeper\n  => Unrecoverable Zookeeper error Background operation retry gave up\n\norg.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\n    at org.apache.zookeeper.KeeperException.create(KeeperException.java:90)\n    at com.netflix.curator.framework.imps.CuratorFrameworkImpl.processBackgroundOperation(CuratorFrameworkImpl.java:380)\n    at com.netflix.curator.framework.imps.BackgroundSyncImpl$1.processResult(BackgroundSyncImpl.java:49)\n    at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:613)\n    at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:502)\n2012-07-11 04:37:15,926 INFO [Thread-22-EventThread|]@jenkins backtype.storm.util\n  => Halting process: (\"Unrecoverable Zookeeper error\")\n{code}\n\nDear Nathan,\n\nIf this race condition could somehow be fixed (presumably it is not that hard since we know what the problem is), it would so much appreciated!!!\n",
        "duedate": null,
        "environment": null,
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg",
            "id": "4",
            "name": "Minor",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/4"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12314820&avatarId=21667",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12314820&avatarId=21667",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12314820&avatarId=21667",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12314820&avatarId=21667"
            },
            "id": "12314820",
            "key": "STORM",
            "name": "Apache Storm",
            "projectCategory": {
                "description": "Apache Storm Related",
                "id": "13260",
                "name": "Storm",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13260"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12314820"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xumingming&avatarId=18354",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xumingming&avatarId=18354",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xumingming&avatarId=18354",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xumingming&avatarId=18354"
            },
            "displayName": "James Xu",
            "key": "xumingming",
            "name": "xumingming",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=xumingming",
            "timeZone": "Asia/Shanghai"
        },
        "resolution": null,
        "resolutiondate": null,
        "status": {
            "description": "The issue is open and ready for the assignee to start work on it.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
            "id": "1",
            "name": "Open",
            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
            "statusCategory": {
                "colorName": "blue-gray",
                "id": 2,
                "key": "new",
                "name": "To Do",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
            }
        },
        "subtasks": [],
        "summary": "Intermittent Zookeper errors when shutting down local Topology",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2015-10-09T00:31:08.000+0000",
        "versions": [],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/STORM-131/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/STORM-131/watchers",
            "watchCount": 1
        },
        "workratio": -1
    },
    "id": "12684757",
    "key": "STORM-131",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12684757"
}