[Merged into master and 1.x branch. I'll handle porting back to 1.0.x branch after 1.0.3 vote ends.]