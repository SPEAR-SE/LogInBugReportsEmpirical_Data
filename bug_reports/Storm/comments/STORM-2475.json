[I merged this into master.  I don't think this is likely to be a problem on other branches but if someone else needs it on a separate branch we can merge it there quickly.]