[GitHub user kishorvpatil opened a pull request:

    https://github.com/apache/storm/pull/997

    [STORM-1457] Avoid collecting pending tuples if topology.debug is off

    This would help lower heap memory usage when ```topology.debug``` is off.

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/kishorvpatil/incubator-storm storm1457

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/storm/pull/997.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #997
    
----
commit 0f1b14200f8be1f76408d58e71d02226c262e778
Author: Kishor Patil <kpatil@yahoo-inc.com>
Date:   2016-01-08T19:25:23Z

    Avoid collecting pending tuples if topology.debug is off

----
, Github user revans2 commented on a diff in the pull request:

    https://github.com/apache/storm/pull/997#discussion_r49228894
  
    --- Diff: storm-core/src/clj/backtype/storm/daemon/executor.clj ---
    @@ -572,7 +572,8 @@
                                                (do
                                                  (.put pending root-id [task-id
                                                                         message-id
    -                                                                    {:stream out-stream-id :values values}
    +                                                                    {:stream out-stream-id 
    +                                                                     :values (if (= true (storm-conf TOPOLOGY-DEBUG)) values nil)}
    --- End diff --
    
    I would prefer to avoid calculating if TOPOLOGY-DEBUG is true each time.  This is code on the critical path so if we could do it once at the beginning of the thread function and reuse it, that would be great.
, Github user kishorvpatil commented on a diff in the pull request:

    https://github.com/apache/storm/pull/997#discussion_r49234922
  
    --- Diff: storm-core/src/clj/backtype/storm/daemon/executor.clj ---
    @@ -572,7 +572,8 @@
                                                (do
                                                  (.put pending root-id [task-id
                                                                         message-id
    -                                                                    {:stream out-stream-id :values values}
    +                                                                    {:stream out-stream-id 
    +                                                                     :values (if (= true (storm-conf TOPOLOGY-DEBUG)) values nil)}
    --- End diff --
    
    Agreed. Let me change it.
, Github user kishorvpatil commented on the pull request:

    https://github.com/apache/storm/pull/997#issuecomment-170122524
  
    @revans2  Moved calculation out of critical path.
, Github user revans2 commented on the pull request:

    https://github.com/apache/storm/pull/997#issuecomment-170145804
  
    +1
, Github user asfgit closed the pull request at:

    https://github.com/apache/storm/pull/997
, Thanks [~kishorvpatil],

I merged this into master.]