[The issue seems to be related with the use if a ByteBuffer to store the serialized workerhook.
 The byteBuffer is deserialized two time:
 * On start
 * On Stop

On worker start, the worker retrieves the byte array of the ByteBuffer and the position on the ByteBuffer is then at the end of the ByteBuffer.
 On worker stop, the worker retrieves the byte array of the ByteBuffer but its position is at the end of the bytebuffer.

There multiple way to fix this issue:
 * in worker.clj run-worker-start-hooks, store and reset the Bytebuffer position after the workerhook start.

This is the purpose of my commit: [https://github.com/hummelm/storm/commit/7afeff6d8db4a78250ff8827207e80247b0acd25]

 
 * Add a method to the Utils class to allow the retreiving of a byteArray from byteBuffer without changing the internal position of the byteBuffer and use it in the worker.clj

May be a storm developer can give us an advice on the better way to fix the issue, it is a blocking issue for us and we will be happy to contibute to storm.

 

One thing is strange, the ByteBuffer seems to contain more data than expected, I mean the serialized workerhook is about 106 Bytes and the buffer position is more than 2800.

In any case, the submitted fix is not impacted by this question., Thanks [~hummelm], I merged into master, 1.x for 1.2.2, 1.1.x for 1.1.3, 1.0.x for 1.0.7.]