[GitHub user lujinhong opened a pull request:

    https://github.com/apache/storm/pull/1522

    [STORM-1594] org.apache.storm.tuple.Fields can throw NPE if given invalid field in selector

    fix STORM-1594.

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/lujinhong/storm storm-1594

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/storm/pull/1522.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #1522
    
----
commit bdf4ba5cb10a6af1db20f105f6cda2064b669548
Author: lujinhong <lujinhong2@gmail.com>
Date:   2016-06-27T02:33:28Z

    fix STORM-1594

----
, Github user abhishekagarwal87 commented on a diff in the pull request:

    https://github.com/apache/storm/pull/1522#discussion_r68901523
  
    --- Diff: storm-core/src/jvm/org/apache/storm/tuple/Fields.java ---
    @@ -50,8 +50,12 @@ public Fields(List<String> fields) {
         
         public List<Object> select(Fields selector, List<Object> tuple) {
             List<Object> ret = new ArrayList<>(selector.size());
    -        for(String s: selector) {
    -            ret.add(tuple.get(_index.get(s)));
    --- End diff --
    
    You can replace _index.get(s) with fieldIndex(s) which throws IllegalArgumentException.
, Github user lujinhong commented on a diff in the pull request:

    https://github.com/apache/storm/pull/1522#discussion_r68908757
  
    --- Diff: storm-core/src/jvm/org/apache/storm/tuple/Fields.java ---
    @@ -50,8 +50,12 @@ public Fields(List<String> fields) {
         
         public List<Object> select(Fields selector, List<Object> tuple) {
             List<Object> ret = new ArrayList<>(selector.size());
    -        for(String s: selector) {
    -            ret.add(tuple.get(_index.get(s)));
    --- End diff --
    
    yes, it is a better idea.
, Github user abhishekagarwal87 commented on the issue:

    https://github.com/apache/storm/pull/1522
  
    Thank you @lujinhong. I am +1 pending travis. Please squash the commits once travis is passed.
, Github user HeartSaVioR commented on the issue:

    https://github.com/apache/storm/pull/1522
  
    +1 Travis error is unrelated.
    @lujinhong Could you squash the commits, or if you mind I can do that for merging step. Let me know which way do you prefer.
, Github user abellina commented on the issue:

    https://github.com/apache/storm/pull/1522
  
    Looks good @lujinhong. Thanks!
, Github user asfgit closed the pull request at:

    https://github.com/apache/storm/pull/1522
, Thanks [~lujinhong], I merged into master, 1.x, 1.0.x branches., Github user revans2 commented on the issue:

    https://github.com/apache/storm/pull/1522
  
    @HeartSaVioR looks like one of the test failures was related.
    
    https://issues.apache.org/jira/browse/STORM-2022
, Github user HeartSaVioR commented on the issue:

    https://github.com/apache/storm/pull/1522
  
    @revans2 Yes I missed that. My bad. Thanks for finding.
]