[GitHub user revans2 opened a pull request:

    https://github.com/apache/incubator-storm/pull/257

    STORM-497: don't modify the mapping while the someone could be reading it.

    

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/revans2/incubator-storm STORM-497

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/incubator-storm/pull/257.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #257
    
----
commit f259f1da288171a9393fb500150d034ccca0d146
Author: Robert (Bobby) Evans <evans@yahoo-inc.com>
Date:   2014-09-17T13:07:42Z

    STORM-497: don't modify the mapping while the someone could be reading it.

----
, Github user ptgoetz commented on the pull request:

    https://github.com/apache/storm/pull/257#issuecomment-57559023
  
    +1
, Github user HeartSaVioR commented on the pull request:

    https://github.com/apache/storm/pull/257#issuecomment-57566732
  
    I have some comments about it.
    
    1. Could we use RWLock to getMessageQueueId()? Maybe we could avoid copying entire map if it plays well.
    2. If there're some contention about synchronized (this), first thread can set queueId and return it, but other threads cannot get queueId because there're no else state from ```queueId = taskToQueueId.get(task);``` inside of synchronized.
, Github user clockfly commented on the pull request:

    https://github.com/apache/storm/pull/257#issuecomment-61579721
  
    @HeartSaVioR,
    
    The performance is not a concern, since taskToQueueId will only be modified for a few times.
    
    +1 for the patch
, Github user HeartSaVioR commented on the pull request:

    https://github.com/apache/storm/pull/257#issuecomment-61584109
  
    @clockfly @revans2 
    I've found that I've misunderstand this patch. Comment 2 is wrong, sorry about it.
    Regarding comment 1, if performance is not a concern, it's not a problem.
    So finally, looks good to me. :)
, Github user asfgit closed the pull request at:

    https://github.com/apache/storm/pull/257
, commited at cb53d478448544ee18d258bb4ce1951c99a8ed87.
 

]