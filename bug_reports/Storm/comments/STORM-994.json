[In Utils.java method downloadFromMaster leaks connections to supervisors when code is downloaded from nimbus :

{code}
        NimbusClient client = NimbusClient.getConfiguredClient(conf);
{code}

creates a new client object everytime but never closed., GitHub user fmazoyer opened a pull request:

    https://github.com/apache/storm/pull/697

    STORM-994 Close download clients and channels to avoid resource leaks

    This pull request to fix STORM-994 to avoid resource leaks between nimbus and supervisors.
    Could you please review ?
    Thanks

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/fmazoyer/storm STORM-994

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/storm/pull/697.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #697
    
----
commit f2e3ea0eb411547802cc87a95a9b4a8f56cd9d10
Author: fmazoyer <frantz.mazoyer@altran.com>
Date:   2015-08-25T12:57:59Z

    STORM-994 Close download clients and channels to avoid resource leaks

----
, Github user HeartSaVioR commented on a diff in the pull request:

    https://github.com/apache/storm/pull/697#discussion_r37985872
  
    --- Diff: storm-core/src/jvm/backtype/storm/utils/Utils.java ---
    @@ -359,23 +359,34 @@ public static Object getSetComponentObject(ComponentObject obj) {
     
         public static void downloadFromMaster(Map conf, String file, String localFile) throws AuthorizationException, IOException, TException {
             NimbusClient client = NimbusClient.getConfiguredClient(conf);
    -        download(client, file, localFile);
    +        try {
    --- End diff --
    
    Indentation seems mixed.
, Github user HeartSaVioR commented on a diff in the pull request:

    https://github.com/apache/storm/pull/697#discussion_r37985888
  
    --- Diff: storm-core/src/jvm/backtype/storm/utils/Utils.java ---
    @@ -359,23 +359,34 @@ public static Object getSetComponentObject(ComponentObject obj) {
     
         public static void downloadFromMaster(Map conf, String file, String localFile) throws AuthorizationException, IOException, TException {
             NimbusClient client = NimbusClient.getConfiguredClient(conf);
    -        download(client, file, localFile);
    +        try {
    +        	download(client, file, localFile);
    +        } finally {
    +        	client.close();
    +        }
         }
     
         public static void downloadFromHost(Map conf, String file, String localFile, String host, int port) throws IOException, TException, AuthorizationException {
             NimbusClient client = new NimbusClient (conf, host, port, null);
    -        download(client, file, localFile);
    +        try {
    +        	download(client, file, localFile);
    --- End diff --
    
    Indentation seems mixed.
, Github user HeartSaVioR commented on the pull request:

    https://github.com/apache/storm/pull/697#issuecomment-135036696
  
    Looks fine overall. +1
, Could this manifest itself by nimbus failing due to running out of Thrift Server threads?  Like this:

2015-08-26 19:38:49 b.s.s.a.ThriftServer [ERROR] ThriftServer is being stopped due to: java.util.concurrent.RejectedExecutionException: Task org.apache.thrift7.server.TThreadPoolServer$WorkerProcess@450ad086 rejected from java.util.concurrent.ThreadPoolExecutor@490030d3[Running, pool size = 64, active threads = 64, queued tasks = 0, completed tasks = 258649]
java.util.concurrent.RejectedExecutionException: Task org.apache.thrift7.server.TThreadPoolServer$WorkerProcess@450ad086 rejected from java.util.concurrent.ThreadPoolExecutor@490030d3[Running, pool size = 64, active threads = 64, queued tasks = 0, completed tasks = 258649], Github user asfgit closed the pull request at:

    https://github.com/apache/storm/pull/697
, Thanks, [~fmazoyer] for finding missed spot.
I merged into master and 0.10.x-branch., My pleasure :-)
Thanks for merging.]