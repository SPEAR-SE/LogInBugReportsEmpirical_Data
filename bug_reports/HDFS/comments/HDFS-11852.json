[I think {{FSNamesystem.commitOrCompleteLastBlock()}} should make sure the block is committed instead of letting {{blockManager.commitOrCompleteLastBlock()}} possibly return false., This issue happens because decommissioning replica is not considered as live in {{countNodes()}}. When the only replica is in the decommissioning node, the block cannot be completed.  
Looks like it has been fixed in HDFS-11499.
, Thank you for the pointer Kihwal!

In our case, the only replica available was on the decomissioning node. I'm guessing one of the other datanodes may have been decommissioned successfully and a second failed perhaps. In that case, HDFS-11499 will likely not recover the under-replicated block. However it would reduce the likelihood of reaching that state, so I agree with closing this JIRA as a duplicate of HDFS-11499.]