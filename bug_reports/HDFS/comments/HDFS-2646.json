[The attached patch fixes 2 of the findbug issues.

The following findbug issues are false positives:

{code}
UL	org.apache.hadoop.lib.service.instrumentation.InstrumentationService.getToAdd(String, String, Class, Lock, Map) does not release lock on all paths

ST	Write to static field org.apache.hadoop.fs.http.server.HttpFSServerWebApp.SERVER from instance method org.apache.hadoop.fs.http.server.HttpFSServerWebApp.destroy()
{code}

The first one may be due to the fact that if/else logic is too complex for findbug to follow.

The second one, the HttpFSServerWebApp() class is effectively a singleton in the WebApp, thus assignment of a static var in an instance method is OK.

The attached patch bumps up the findbug count for these 2 false positives.
, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12507030/HDFS-2646.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/1693//console

This message is automatically generated., Run test-patch locally, the findbug warnings have been reduced to 2. These 2 are the ones explained above, the patch increments the findbugs count to account for them.

{code}
...
Summary

Warning Type	Number
Multithreaded correctness Warnings	1
Dodgy Warnings	1
Total	2
Warnings

Click on a warning row to see full context information.

Multithreaded correctness Warnings

Code	Warning
UL	org.apache.hadoop.lib.service.instrumentation.InstrumentationService.getToAdd(String, String, Class, Lock, Map) does not release lock on all paths
Dodgy Warnings

Code	Warning
ST	Write to static field org.apache.hadoop.fs.http.server.HttpFSServerWebApp.SERVER from instance method org.apache.hadoop.fs.http.server.HttpFSServerWebApp.destroy()
...
{code}

, Hi Alejandro,
Thanks for fixing them.
One suggestion:
  can we add this invalid findbugs details in \dev-support\findbugsExcludeFile.xml.

for eaxmple: \hadoop-hdfs-project\hadoop-hdfs\dev-support\findbugsExcludeFile.xml.

If we just upping the count may con't track exact find bugs. Because later if we fix/ remove this two findbug problems and introduce two valid findbug will not be reported by test patch right? \findbugsExcludeFile.xml can track bug type, package,class,method,field name mappings. 

Thanks
Uma, Uma, got the idea, but still I'm not able to get this work, I've tried adding the 2 exceptions to hadoop-hdfs-project/dev-support and to hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support but I'm still getting the warnings. Any idea? Thxs., Hi Alejandro,

  I did following two steps, 
     1) added hadoop-project-dist as a parent project in httpfs pom.xml file
          {code}
   <parent>
    <groupId>org.apache.hadoop</groupId>
    <artifactId>hadoop-project-dist</artifactId>
    <version>0.24.0-SNAPSHOT</version>
    <relativePath>../../hadoop-project-dist</relativePath>
  </parent>
{code}
    2) added /hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
     
  It worked out for me. I think the problem due to inheritance levels. But i can not say this is 100% correct way. Since you are the expert in this area, you can vlidate and check.



Thanks
Uma
, using hadoop-project-dist may break the packaging as it makes certain assumptions (but it gives me a hint on what to do, thxs), Patch using findbugs exclude file, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12508029/HDFS-2646.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 javadoc.  The javadoc tool appears to have generated 20 warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.

    -1 release audit.  The applied patch generated 1 release audit warnings (more than the trunk's current 0 warnings).

    -1 core tests.  The patch failed these unit tests:
                  org.apache.hadoop.hdfs.TestFileAppend2
                  org.apache.hadoop.hdfs.TestDatanodeDeath

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/1730//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-HDFS-Build/1730//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt
Findbugs warnings: https://builds.apache.org/job/PreCommit-HDFS-Build/1730//artifact/trunk/hadoop-hdfs-project/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/1730//console

This message is automatically generated., no tests added/edited, this patch fixes & excludes findbugs warnings.
findbugs warning not related.
release audit warning not avail, cannot evaluate.
testcases failures not related., +1 lgtm, Integrated in Hadoop-Hdfs-trunk-Commit #1534 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1534/])
    HDFS-2646. Hadoop HttpFS introduced 4 findbug warnings. (tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221572
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, committed to trunk and branch-0.23, Integrated in Hadoop-Common-trunk-Commit #1461 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/1461/])
    HDFS-2646. Hadoop HttpFS introduced 4 findbug warnings. (tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221572
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Integrated in Hadoop-Common-0.23-Commit #314 (See [https://builds.apache.org/job/Hadoop-Common-0.23-Commit/314/])
    Merge -r 1221571:1221572 from trunk to branch. FIXES: HDFS-2646

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221576
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Integrated in Hadoop-Hdfs-0.23-Commit #303 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Commit/303/])
    Merge -r 1221571:1221572 from trunk to branch. FIXES: HDFS-2646

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221576
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Integrated in Hadoop-Mapreduce-trunk-Commit #1483 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/1483/])
    HDFS-2646. Hadoop HttpFS introduced 4 findbug warnings. (tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221572
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Integrated in Hadoop-Mapreduce-0.23-Commit #325 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Commit/325/])
    Merge -r 1221571:1221572 from trunk to branch. FIXES: HDFS-2646

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221576
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Integrated in Hadoop-Hdfs-trunk #901 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/901/])
    HDFS-2646. Hadoop HttpFS introduced 4 findbug warnings. (tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221572
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Integrated in Hadoop-Hdfs-0.23-Build #114 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/114/])
    Merge -r 1221571:1221572 from trunk to branch. FIXES: HDFS-2646

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221576
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Integrated in Hadoop-Mapreduce-0.23-Build #135 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Build/135/])
    Merge -r 1221571:1221572 from trunk to branch. FIXES: HDFS-2646

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221576
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Integrated in Hadoop-Mapreduce-trunk #934 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/934/])
    HDFS-2646. Hadoop HttpFS introduced 4 findbug warnings. (tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221572
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/dev-support/findbugsExcludeFile.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/lang/XException.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs-httpfs/src/main/java/org/apache/hadoop/lib/wsrs/InputStreamEntity.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
]