[bq. The datanode process was still alive and continued to send heartbeat to the namenode, but it could not response any command to this node
[~Tao Jie]: Do you mean you were not able to login to this bad node and kill the datanode process ?, [~shahrs87], yes , in this case, when the datanode began to be panic(maybe kernal bug or hardware failure), the node lost connection to the Ambari and we could not login to this node. 
Everything returned to normal once we restarted the bad node. We are trying to handle this case automatic, so we attempt to mark the bad datanode as dead by the monitoring system(Ambari)  when this case happen again., In the attached patch, we add an option in dfsadmin:
{{hdfs dfsadmin -shutdownDatanode <datanode_host:ipc_port> force}} 
When the option "force" is set, the dfsadmin would send a request to the namenode and mark the datanode as dead immediately.]