[Hi [~aderen],
Thanks for reporting the issue and providing a patch. The fix makes sense to me.
Could you add a unit test to reproduce the scenario that you're trying to fix?, HDFS-9313 probably fixed this as a workaround. And HDFS-9314 is filed to improve this.

Closed as duplicated. Be free to reopen if you disagree., Thanks [~walter.k.su] for the reference. This should be the same as HDFS-9314, will follow up from there.]