[Safe mode is a Namenode state in which it does not accept changes to the name space (read-only) .
http://hadoop.apache.org/core/docs/r0.20.0/commands_manual.html#dfsadmin

But when namenode is entered in safemode manually  , Chown ,chgrp , chmod operations are allowed which makes changes in namespace and edit logs .
, -setQuota and -setSpaceQuota is also allowed ., This patch prevents execution of chown  , chmod , chgrp , and quota commands when namenode is in safemode .  
{code}
  [exec] 
     [exec] There appear to be 492 release audit warnings before the patch and 492 release audit warnings after applying the patch.
     [exec] 
     [exec] 
     [exec] 
     [exec] 
     [exec] +1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 50 new or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec] 
     [exec]     +1 Eclipse classpath. The patch retains Eclipse classpath integrity.
     [exec] 
     [exec]     +1 release audit.  The applied patch does not increase the total number of release audit warnings.
     [exec] 
     [exec] 
     [exec] 
     [exec] 
     [exec] ======================================================================
     [exec] ======================================================================
     [exec]     Finished build.
     [exec] ======================================================================
     [exec] ======================================================================
     [exec] 
     [exec] 

BUILD SUCCESSFUL
Total time: 26 minutes 19 seconds


{code}, I think safemode checking should be done before permission checking since safemode checking is much simpler than permission., Thanks for comments Nicholas . Uploading new patch to as per Nicholas's comments ., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12410018/HADOOP-5942v2.patch
  against trunk revision 782083.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 50 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    -1 contrib tests.  The patch failed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/477/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/477/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/477/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/477/console

This message is automatically generated., Deleted discarded patches and attached corrected updated patch fixing errors in TestDFSConf.xml  .  , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12410266/HADOOP-5942v2.patch
  against trunk revision 783982.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 50 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    -1 contrib tests.  The patch failed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/493/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/493/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/493/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/493/console

This message is automatically generated., Contrib. test  failures are not related to changes made in this patch . , +1, Attaching patch created for  Hadoop 20 branch ., Attaching patch created for Hadoop 20 branch. , I think you do not need the changes in {{FsShellPermissions}}, where you fix one typo and introduce {{split("\n")[0]}} to {{getMessage()}}.
{{split()}} extracts the first line of the exception. But you use SubstringComparator in testConf.xml, which should match the shorter string with the longer one, right?
The typo should be fixed separately.
If you decide to stick to the changes in {{FsShellPermissions}} you will need to split the patch into two, since -testConf.xml- is in different project common.
I meant FsShellPermissions.java is in common, not testConf.xml., Attaching Patch . , Thanks for  the comments and reviewing  Konstantin . 
I have removed changes made in FsShellPermissions.java and updated this patch for hadoop-hdfs  . 
As per our discussion I will create new Jira to fix stack trace issue .
, Uploading patch created against trunk. 

This patch passed *ant test-patch*


{noformat}
 [exec] 
     [exec] 
     [exec] 
     [exec] +1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 50 new or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec] 
     [exec]     +1 release audit.  The applied patch does not increase the total number of release audit warnings.
     [exec] 
     [exec] 
     [exec] 
     [exec] 
     [exec] ======================================================================
     [exec] ======================================================================
     [exec]     Finished build.
     [exec] ======================================================================
     [exec] ======================================================================
     [exec] 
     [exec] 

BUILD SUCCESSFUL
Total time: 12 minutes 58 seconds

{noformat}, +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12426164/HDFS-185-1.patch
  against trunk revision 883930.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 50 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/124/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/124/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/124/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/124/console

This message is automatically generated., I just committed this. Thank you Ravi., Integrated in Hadoop-Hdfs-trunk-Commit #140 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/140/])
    . Disallow chown, chgrp, chmod, setQuota, and setSpaceQuota when name-node is in safemode. Contributed by Ravi Phulari.
, Integrated in Hdfs-Patch-h2.grid.sp2.yahoo.net #83 (See [http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/83/])
    , Integrated in Hadoop-Hdfs-trunk #170 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk/170/])
    , Integrated in Hdfs-Patch-h5.grid.sp2.yahoo.net #148 (See [http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/148/])
    , Attaching patch for Yahoo! Hadoop 20.100 branch.]