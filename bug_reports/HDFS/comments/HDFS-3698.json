[Here's a patch which addresses the issue. Mostly this is just changing the test case, but I also discovered a potential infinite recursion in the case of HSFTP. This patch fixes that as well.

I tested this patch by ensuring that TestHftpFileSystem passes on branch-1 with this patch applied., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12537442/HDFS-3698.patch
  against trunk revision .

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/2883//console

This message is automatically generated., Looks good to me. +1, +1  lgtm as well, Thanks a lot for the reviews, Eli and Todd. I've just committed this to branch-1., reopening as the same issue is seen in branch-1.1, I merged the patch to branch 1.1, Thanks guys., Closed upon release of Hadoop-1.1.0.]