[Allowing clients to renew leases past the soft limit is acceptable. The lease soft limit is used by lease recovery and the way it works guarantees that no two writers are writing to the same file or block.  When lease recovery is triggered by create() the file is recreated, so any activity on the old RBW block won't interfere with the new file. If append() causes a lease recovery, a block recovery is forced against the last RBW block and until it is done client gets RecoveryInProgressException.  As a part of block recovery, existing writers are terminated and a new generation number is stamped on the block, so any existing client won't be able to write any longer.  A client explicitly calling recoverLease() also works similarly.

, {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12569238/hdfs-4495.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3969//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3969//console

This message is automatically generated., +1 Looks like a small reasonable change.  Minor nit is test mentions "has beeb" instead of "has been".  This should also go into 23, so please add an equivalent patch., I fixed the typo and posted the 0.23 version of patch., {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12569256/hdfs-4495.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3970//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3970//console

This message is automatically generated., +1, I've committed this to trunk, branch-2 and branch-0.23., Integrated in Hadoop-trunk-Commit #3358 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/3358/])
    HDFS-4495. Allow client-side lease renewal to be retried beyond soft-limit.  Contributed by Kihwal Lee (Revision 1445965)

     Result = SUCCESS
kihwal : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445965
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestLease.java
, Integrated in Hadoop-Yarn-trunk #127 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/127/])
    HDFS-4495. Allow client-side lease renewal to be retried beyond soft-limit.  Contributed by Kihwal Lee (Revision 1445965)

     Result = SUCCESS
kihwal : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445965
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestLease.java
, Integrated in Hadoop-Hdfs-0.23-Build #525 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/525/])
    HDFS-4495. Allow client-side lease renewal to be retried beyond soft-limit.  Contributed by Kihwal Lee (Revision 1445969)

     Result = SUCCESS
kihwal : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445969
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestLease.java
, Integrated in Hadoop-Hdfs-trunk #1316 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1316/])
    HDFS-4495. Allow client-side lease renewal to be retried beyond soft-limit.  Contributed by Kihwal Lee (Revision 1445965)

     Result = FAILURE
kihwal : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445965
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestLease.java
, Integrated in Hadoop-Mapreduce-trunk #1344 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1344/])
    HDFS-4495. Allow client-side lease renewal to be retried beyond soft-limit.  Contributed by Kihwal Lee (Revision 1445965)

     Result = SUCCESS
kihwal : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445965
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestLease.java
]