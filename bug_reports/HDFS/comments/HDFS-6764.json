[This was prominently observed on a HA standby due to HDFS-6763.  Quota recalcs caused all DNs to heartbeat in the same second.  For a yet unknown reason, HA actives demonstrate a similar rhythmic clumping heartbeats but not to the same degree., Darker colors are the raw data of heartbeats per 0.5s.  The lighter lines are a rolling 1s average which makes the rhythmic behavior of the active (light blue) easier to see., It seems to make sense to skip a heartbeat interval if the NN took too long to respond to the previous heartbeat.  Adding a random factor (even only a few milliseconds) is probably also a good idea.  Seems like we should also have a metric on the DN for how many heartbeats took longer than the expected heartbeat interval... I took a look at the MXBean / MBean stuff but couldn't find anything like that, Great minds think alike.  Skipping missed intervals + entropy is exactly what Nathan and I considered as the solution.  We haven't had a chance to verify.  The entropy required is probably an random delay for the first heartbeat.  That'll spread out DNs that all connected and blocked while the NN is blocked during something like lengthy BR processing.

The more interesting part of the puzzle, which the aforementioned changes will probably mask/fix, is what causes heartbeats to an active to clump together in a semi-rhythmic cycle?  I suspect full BRs but I think I saw a similar jagged pattern on another cluster...  Will double check when I have time., Moving bugs out of previously closed releases into the next minor release 2.8.0.]