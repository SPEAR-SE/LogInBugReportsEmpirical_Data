[[~vincent he]  
{noformat}
dfs.namenode.checkpoint.edits.dir is suffixed with nameserviceId
{noformat}
 do you mean property is suffixed with namespaceId or value of the property is suffixed with nameserviceId?

dfs.namenode.shared.edits.dir.mycluster or dfs.namenode.shared.edits.dir=qjournal://y124.l42scl.hortonworks.com:8485/mycluster ?, Hi [~vincent he]
I have tried to setup HA cluster.
I am able to successfully start/stop journal nodes using start-dfs.sh/stop-dfs.sh


Could you please provide more info on this, and steps to reproduce the issue.
, bq. dfs.namenode.shared.edits.dir.mycluster or dfs.namenode.shared.edits.dir=qjournal://y124.l42scl.hortonworks.com:8485/mycluster ?

The former.
In my situation, [^hdfs-site.xml]
{noformat}
  <property>
    <name>dfs.namenode.shared.edits.dir.ns1</name>
    <value>qjournal://hadoop3-0-0-01:8485;hadoop3-0-0-02:8485;hadoop3-0-0-03:8485;/ns1</value>
  </property>
{noformat}

{noformat}
root@hadoop3-0-0-01:/opt/hadoop# sbin/stop-dfs.sh
root@hadoop3-0-0-01:/opt/hadoop# jps
11648 Jps
2625 NodeManager
2299 ResourceManager
583 JournalNode
{noformat}
The JournalNode is still alive after sbin/stop-dfs.sh.

I have a investigate, maybe it's line 103 in sbin/stop-dfs.sh does not get the value in this situation.
sbin/start-dfs.sh has the same problem.

{noformat}
100 #---------------------------------------------------------
101 # quorumjournal nodes (if any)
102 
103 SHARED_EDITS_DIR=$("${HADOOP_HDFS_HOME}/bin/hdfs" getconf -confKey dfs.namenode.shared.edits.dir 2>&-)
104 
105 case "${SHARED_EDITS_DIR}" in
106   qjournal://*)
{noformat}

, HI [~wenxin he]
Thanks for info. 
https://hadoop.apache.org/docs/r2.7.1/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html
According to this link, it should be setup as
<property>
  <name>dfs.namenode.shared.edits.dir</name>
  <value>qjournal://node1.example.com:8485;node2.example.com:8485;node3.example.com:8485/mycluster</value>
</property>


I have not tried, the way suffixing, but i think this dfs.namenode.shared.edits.dir is not nameservice specific key.

Let me look in more in to code and get back. , One more question from your configuration 
<property>
    <name>dfs.nameservices</name>
    <value>ns1,ns2</value>
  </property>

Here you having two values, this is for federation right, where we give nameserviceIds.

Where as in HA we provide, logical name for our service, it should have one value only right?
like 
<property>
    <name>dfs.nameservices</name>
    <value>mycluster</value>
  </property>

so that we access our cluster like hdfs://mycluster//

Let me know if I am missing something here?
, Updated the patch to get journal node list correctly.
Added a getConf -journalnodes to get list of journal nodes. Refer [https://issues.apache.org/jira/browse/HDFS-12486], | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 19s{color} | {color:blue} Docker mode activated. {color} |
|| || || || {color:brown} Prechecks {color} ||
| {color:blue}0{color} | {color:blue} shelldocs {color} | {color:blue}  0m  5s{color} | {color:blue} Shelldocs was not available. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
|| || || || {color:brown} trunk Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 14m 27s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 57s{color} | {color:green} trunk passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 51s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} shellcheck {color} | {color:green}  0m  0s{color} | {color:green} The patch generated 0 new + 4 unchanged - 2 fixed = 4 total (was 6) {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 50s{color} | {color:green} hadoop-hdfs in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 16s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 18m 40s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:71bbb86 |
| JIRA Issue | HDFS-12375 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12887967/HDFS-12375.01.patch |
| Optional Tests |  asflicense  mvnsite  unit  shellcheck  shelldocs  |
| uname | Linux d0db8a93fae4 3.13.0-129-generic #178-Ubuntu SMP Fri Aug 11 12:48:20 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 7bbeacb |
| shellcheck | v0.4.6 |
|  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/21226/testReport/ |
| modules | C: hadoop-hdfs-project/hadoop-hdfs U: hadoop-hdfs-project/hadoop-hdfs |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/21226/console |
| Powered by | Apache Yetus 0.6.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, LGTM +1 (non-binding), [~bharatviswa] I have committed HDFS-12486, can you please verify that this patch works correctly with the latest top of the trunk changes. I can commit once I hear back from you.
, [~anu] I have tested the start-dfs.sh/stop-dfs.sh and was able to start/stop journalnodes with the latest trunk changes.

, Thank you for the confirmation. I will commit this shortly.
, [~wenxin he] [~ajayydv] Thanks for reviews and comments. 
[~bharatviswa] Thanks for the contributing the patch. I have committed this to the tunk., SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #12962 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/12962/])
HDFS-12375. Fail to start/stop journalnodes using (aengineer: rev 415e5a157a2c97835be02db0d155404273c7713d)
* (edit) hadoop-hdfs-project/hadoop-hdfs/src/main/bin/stop-dfs.sh
* (edit) hadoop-hdfs-project/hadoop-hdfs/src/main/bin/start-dfs.sh
, [~anu] Thank You for review and committing the patch.]