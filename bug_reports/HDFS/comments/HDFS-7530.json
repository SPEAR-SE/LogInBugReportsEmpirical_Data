[The .001 patch adds code to allow renaming an EZ root as well as a test for this.
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12687561/HDFS-7530.001.patch
  against trunk revision a97a1e7.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.cli.TestCryptoAdminCLI

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9054//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9054//console

This message is automatically generated., Hey Charles, patch looks basically good, just a few comments:

* Looks like we should fix that CLI test. The description reads "Test failure of renaming a non-EZ file from an EZ" which doesn't quite make sense either. Not sure what the intent was, but might be worth adding a new CLI test too.
* Also would be good to have explanatory text for the assertTrue.

+1 pending though, thanks., [~andrew.wang],

Thank you for the review. The .002 patch fixes the failing test. It turns out that that CLI test was testing exactly what this patch is for so I just modified the description and the expected output to reflect success rather than failure. I also added the message to the assertTrue. As you know, Jenkins will continue to fail the TestCryptoAdminCLI since test-patch.sh will not apply the testCryptoConf.xml file.
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12687763/HDFS-7530.002.patch
  against trunk revision e996a1b.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.blockmanagement.TestDatanodeManager
                  org.apache.hadoop.hdfs.server.namenode.ha.TestRetryCacheWithHA
                  org.apache.hadoop.hdfs.TestDecommission

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9058//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9058//console

This message is automatically generated., The test failures appear to be unrelated., Hey Charles, note that Colin actually fixed binary diff application in HADOOP-10926. You just need to generate the diff with git and without --no-prefix. Doesn't matter here though since xml is text.

For the CLI test, can we add an "ls" at the end so we can check the rename? An empty substring comparator is never going to trigger. I think that the existing test is supposed to test renaming an EZ file to a non-EZ, could we add that too?

Thanks!, [~andrew.wang],

Good points. I think that .003 addresses them.

Charles
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12687861/HDFS-7530.003.patch
  against trunk revision 9937eef.

    {color:red}-1 patch{color}.  Trunk compilation may be broken.

Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9066//console

This message is automatically generated., Patch changes looks good, I'll rekick Jenkins and commit if it comes back clean., Thanks for the review and the kick in the head to Mr. Jenkins. , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12687861/HDFS-7530.003.patch
  against trunk revision 9937eef.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestDecommission
                  org.apache.hadoop.hdfs.server.namenode.ha.TestRetryCacheWithHA

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9068//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9068//console

This message is automatically generated., Ran tests locally. TestDecom still failed but is true for me unrelated to this patch. Committed to trunk and branch-2, thanks for the contribution Charles., FAILURE: Integrated in Hadoop-trunk-Commit #6753 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6753/])
HDFS-7530. Allow renaming of encryption zone roots. Contributed by Charles Lamb. (wang: rev b0b9084433d5e80131429e6e76858b099deb2dda)
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testCryptoConf.xml
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EncryptionZoneManager.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #46 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/46/])
HDFS-7530. Allow renaming of encryption zone roots. Contributed by Charles Lamb. (wang: rev b0b9084433d5e80131429e6e76858b099deb2dda)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testCryptoConf.xml
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EncryptionZoneManager.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java
, FAILURE: Integrated in Hadoop-Yarn-trunk #780 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/780/])
HDFS-7530. Allow renaming of encryption zone roots. Contributed by Charles Lamb. (wang: rev b0b9084433d5e80131429e6e76858b099deb2dda)
* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testCryptoConf.xml
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EncryptionZoneManager.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1978 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1978/])
HDFS-7530. Allow renaming of encryption zone roots. Contributed by Charles Lamb. (wang: rev b0b9084433d5e80131429e6e76858b099deb2dda)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EncryptionZoneManager.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testCryptoConf.xml
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #43 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/43/])
HDFS-7530. Allow renaming of encryption zone roots. Contributed by Charles Lamb. (wang: rev b0b9084433d5e80131429e6e76858b099deb2dda)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EncryptionZoneManager.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testCryptoConf.xml
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #47 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/47/])
HDFS-7530. Allow renaming of encryption zone roots. Contributed by Charles Lamb. (wang: rev b0b9084433d5e80131429e6e76858b099deb2dda)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EncryptionZoneManager.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testCryptoConf.xml
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1997 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1997/])
HDFS-7530. Allow renaming of encryption zone roots. Contributed by Charles Lamb. (wang: rev b0b9084433d5e80131429e6e76858b099deb2dda)
* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testCryptoConf.xml
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/EncryptionZoneManager.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Adding 2.6.5 to the target versions. We are looking to backport this as part of the 2.6.5 release. This is needed to fix the unit test added to 2.6.5 as part of HDFS-9688.

[~sjlee0] I have tested the cherry-pick from branch-2.7 and it is clean, other than changes.txt. I also ran {{TestNestedEncryptionZones}} and {{TestEncryptionZones}} and both passed.]