[\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  17m  4s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | tests included |   0m  0s | The patch doesn't appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. |
| {color:green}+1{color} | javac |   7m 42s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 37s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 23s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m 22s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 21s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 33s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   2m 28s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | native |   3m  4s | Pre-build of native portion |
| {color:red}-1{color} | hdfs tests | 157m 53s | Tests failed in hadoop-hdfs. |
| | | 201m 31s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.hdfs.web.TestWebHdfsFileSystemContract |
|   | hadoop.hdfs.TestDistributedFileSystem |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12745417/HDFS-8779.01.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / edcaae4 |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/11711/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/11711/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf901.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/11711/console |


This message was automatically generated., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  16m 55s | Findbugs (version 3.0.0) appears to be broken on trunk. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | tests included |   0m  0s | The patch doesn't appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. |
| {color:green}+1{color} | javac |   7m 39s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 43s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 22s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   2m  1s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 37s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 32s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   4m 28s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | native |   3m  1s | Pre-build of native portion |
| {color:red}-1{color} | hdfs tests | 160m 48s | Tests failed in hadoop-hdfs. |
| {color:green}+1{color} | hdfs tests |   0m 28s | Tests passed in hadoop-hdfs-client. |
| | | 207m 37s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.hdfs.TestDistributedFileSystem |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12745448/HDFS-8779.02.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / edcaae4 |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/11714/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| hadoop-hdfs-client test log | https://builds.apache.org/job/PreCommit-HDFS-Build/11714/artifact/patchprocess/testrun_hadoop-hdfs-client.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/11714/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf900.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/11714/console |


This message was automatically generated., Hi [~walter.k.su], is it possible to add a test for this? Otherwise looks good :), Sorry, I can't. The JSON data is just a string in HTTP body. How WebUI shows depends on thr behavior of browsers. How browser parses the string into JavaScript object.

Upload test screenshots with chrome/ie11/firefox., Upon thinking about it more, I'm worried about compatibility issues with WebHDFS. We're changing the type of blockId from number to string.

I'm guessing that the Java WebHdfsFileSystem implementation somehow already avoids the JS MAX_SAFE_INTEGER issue, else we would have seen some issues back when we were using random block IDs. We need to maintain compatibility both with old WebHdfsFileSystem implementations as well as out-of-tree WebHDFS clients.

Could you do a little more digging on this front? Thanks Walter., Uploaded 03 patch. I replace the response body before parsing it to json.
03 patch tested in chrome/ie11/firefox., \\
\\
| (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |   0m  0s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | release audit |   0m 18s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| | |   0m 22s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12745764/HDFS-8779.03.patch |
| Optional Tests |  |
| git revision | trunk / ee36f4f |
| Java | 1.7.0_55 |
| uname | Linux asf904.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/11735/console |


This message was automatically generated., Is it possible to bring in a dedicated library like https://github.com/sidorares/json-bigint instead of putting hacks into the JSON string? It looks much cleaner.

bq. I'm guessing that the Java WebHdfsFileSystem implementation somehow already avoids the JS MAX_SAFE_INTEGER issue...

I don't see why there are related. As pointed out in the description, in Java MAX_LONG equals to 2^63 - 1 while in JavaScript MAX_SAFE_INTEGER is only 2^53 - 1. JavaScript can represent numbers that are larger than 2^53 -1, but most likely with the loss of precisions., Yea, so like I said WebHdfsFileSystem's JSON parser does not have the 2^53-1 limitation...that was an aside to my concern about compatibility, which I think is accurate., Thanks [~wheat9] for the idea.
json-bigint doesn't have a front-end version. The author gives a browserify version in [here|http://stackoverflow.com/questions/18755125/node-js-is-there-any-proper-way-to-parse-json-with-large-numbers-long-bigint]
The file is up to 79kb.

Since both [BigNumber|https://github.com/MikeMcl/bignumber.js] and [JSON-js|https://github.com/douglascrockford/JSON-js] have a front-end version. I re-create the file using the idea of json-bigint:

I simply add 2 lines to JSON-js library ( that's how json-bigint does):
{code}
+                if (string.length > 15)
+                   return new BigNumber(string);
{code}
{{patch-to-json-parse.txt}} shows that. I didn't change anything to {{BigNumber}}.

Uploaded 04 patch, tested in chrome/ie11/firefox. I still prefer 03 patch because it's simple. Both works for me., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |   0m  0s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | release audit |   0m 13s | The applied patch generated 2 release audit warnings. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| | |   0m 16s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12746254/HDFS-8779.04.patch |
| Optional Tests |  |
| git revision | trunk / df1e8ce |
| Release Audit | https://builds.apache.org/job/PreCommit-HDFS-Build/11761/artifact/patchprocess/patchReleaseAuditProblems.txt |
| Java | 1.7.0_55 |
| uname | Linux asf904.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/11761/console |


This message was automatically generated., Seems like we run out of options:
1. change JsonString from server side. (01, 02 patch)
2. hack JsonString from client side. (03 patch)
3. hack Json Parser(04 patch) (It's impossible to hack browser' Json Parser. You have to hack a parser library.)
4. hack JavaScript Engine.

#1 is the best way but is incompatible.  I think server side has a bad design in the first place. We have to add a workaround at client side, just like HDFS-8388. I think #3,#4 is very inappropriate. So, [~wheat9]. could you reconsider #2 approach again? in 03 patch., I'm +1 on the 03 patch, seems like the cleanest and least intrusive change on the table. [~wheat9] I'll commit in a while unless you have more comments., -1 on the 03 patch.

For 04 patch the javascript needs to be minimized. Or it might make sense to create a browsified version of our own., I'll upload a patch to demonstrate the idea later today., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |   0m  0s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | release audit |   0m 13s | The applied patch generated 1 release audit warnings. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| | |   0m 16s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12753070/HDFS-8779.005.patch |
| Optional Tests |  |
| git revision | trunk / cbb2495 |
| Release Audit | https://builds.apache.org/job/PreCommit-HDFS-Build/12204/artifact/patchprocess/patchReleaseAuditProblems.txt |
| Java | 1.7.0_55 |
| uname | Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/12204/console |


This message was automatically generated., The v06 patch is based on the idea of the v4 patch except that:

* Use the recursive JSON parser from https://github.com/douglascrockford/JSON-js
* Wrap big integers as a simple BigNumber class without any arithmetic operations.
* Only wrap big integers if necessary. It's wrapped in a {{try..catch}} clause. The idea is from https://github.com/datalanche/json-bignum., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  15m 22s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | tests included |   0m  0s | The patch doesn't appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. |
| {color:green}+1{color} | javac |   7m 57s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m 11s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 23s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 27s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 32s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | native |   3m  8s | Pre-build of native portion |
| {color:red}-1{color} | hdfs tests | 162m 12s | Tests failed in hadoop-hdfs. |
| | | 201m 15s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.hdfs.server.blockmanagement.TestBlockManager |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12753072/HDFS-8779.006.patch |
| Optional Tests | javadoc javac unit |
| git revision | trunk / cbb2495 |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/12205/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/12205/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf900.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/12205/console |


This message was automatically generated., Thanks [~wheat9] for keep exploring 3rd-party library. I've tested with 3 browsers, and the 006 patch LGTM. Let me assign this to you. I'll update the screenshot of the result.
Also thanks [~andrew.wang] for keep an eye on this all the time., +1 on the 006 patch, I've committed the patch to trunk and branch-2. Thanks everybody for the contributions and reviews., SUCCESS: Integrated in Hadoop-trunk-Commit #8625 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8625/])
HDFS-8779. WebUI fails to display block IDs that are larger than 2^53 - (wheat9: rev aa299ecd5e5d0fab6a50dd02e58fb0b4c1804e92)
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.html
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/static/json-bignum.js
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.js
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
, FAILURE: Integrated in Hadoop-Yarn-trunk #1259 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/1259/])
HDFS-8779. WebUI fails to display block IDs that are larger than 2^53 - (wheat9: rev aa299ecd5e5d0fab6a50dd02e58fb0b4c1804e92)
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.html
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/static/json-bignum.js
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.js
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #524 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/524/])
HDFS-8779. WebUI fails to display block IDs that are larger than 2^53 - (wheat9: rev aa299ecd5e5d0fab6a50dd02e58fb0b4c1804e92)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/static/json-bignum.js
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.js
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.html
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2471 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2471/])
HDFS-8779. WebUI fails to display block IDs that are larger than 2^53 - (wheat9: rev aa299ecd5e5d0fab6a50dd02e58fb0b4c1804e92)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.js
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/static/json-bignum.js
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.html
, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #535 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/535/])
HDFS-8779. WebUI fails to display block IDs that are larger than 2^53 - (wheat9: rev aa299ecd5e5d0fab6a50dd02e58fb0b4c1804e92)
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/static/json-bignum.js
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.js
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.html
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #491 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/491/])
HDFS-8779. WebUI fails to display block IDs that are larger than 2^53 - (wheat9: rev aa299ecd5e5d0fab6a50dd02e58fb0b4c1804e92)
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.js
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/static/json-bignum.js
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.html
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2429 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2429/])
HDFS-8779. WebUI fails to display block IDs that are larger than 2^53 - (wheat9: rev aa299ecd5e5d0fab6a50dd02e58fb0b4c1804e92)
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.html
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/hdfs/explorer.js
* hadoop-hdfs-project/hadoop-hdfs/src/main/webapps/static/json-bignum.js
]