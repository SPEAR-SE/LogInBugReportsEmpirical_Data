[Hi [~daryn], are you working on this Jira? If not, I would like to take it up., Sure, go ahead and assign to yourself.  If I don't assign to myself unless I have free cycles.  Even though my responses are often delayed, please let me review your patch., Sure.. Thanks Daryn., Hi [~daryn],

This is my understanding of the problem. Please correct me if I am wrong.

BPServiceActor obtains the writeLock before processing each command and releases it after. During the processing of a single command, the other actor would not be able to register or process heartbeats.

If we remove the write lock held during command processing, then command processing would no longer be asynchronous. Not sure if this opens up the possibility of creating anomalies in the datanode. 

bq. The worst case scenario for processing commands while holding the lock is re-registration. The actor will loop, catching and logging exceptions, leaving the other actor blocked for an non-deterministic (possibly infinite) amount of time.

The re-registration process itself does not acquire the write lock to register Datanode right? (It needs the write lock to check that the new registration info is consistent with the storage). 
Can you please elaborate on how the actor would go into a loop, catching and logging exceptions?]