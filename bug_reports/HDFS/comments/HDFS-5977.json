[There are two cases here:

# If the user is upgrading from a version that uses the old fsimage, NN will use the old loader to load the fsimage, which has handled the flag already.
# For future upgrades, I think that this mechanism is no longer required. For example, currently the NN has already reserved {{.reserved}} in the namespace. What we need to do here is to regulate ourselves to put special names into {{.reserved}}. Making this assumption explicit eliminates the needs of renaming during upgrades, therefore the whole workflow for upgrades can be simplified., Hi Haohui, I had the same thought and agree in spirit, but if you look at the comment history on HDFS-5709, [~sureshms] had some concerns about adding more reserved paths beyond our current two. We agreed to implement a more general solution for this reason.

I agree that we don't need to implement this for the PB loader until we add another reserved path, but I filed this JIRA so "-renameReserved" isn't forgotten about in the future., bq. For future upgrades, I think that this mechanism is no longer required.
I think this mechanism may be required, as not everything can start with /.reserved. I think we should address this issue. We should also do another code review to ensure all the previous relevant fsimage related mechanism is available in protobuf based fsimage solution as well., Thanks [~andrew.wang] and [~sureshms] for the info. Let me resolve this jira as later and keep it around. We can reopen this jira if we need to add another reserved path.]