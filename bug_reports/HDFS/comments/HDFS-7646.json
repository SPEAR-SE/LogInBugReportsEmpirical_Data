[Do we have copy-on-truncate?  We discussed this earlier; see [~shv]'s [commnet|https://issues.apache.org/jira/browse/HDFS-3107?focusedCommentId=14189216&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14189216]., In place truncate is disabled during upgrades. NN will do copy on truncate until upgrade is finalized or rolled back. This is reflected in the design doc of HDFS-3107, and there is a unit test verifying that., Yes, you're right.  Sorry.  I can see that {{shouldCopyOnTruncate}} will return true if the upgrade has not yet been finalized.]