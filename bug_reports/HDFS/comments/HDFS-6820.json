[Hmm, good find.  You can fix this problem by calling fsync on the directory that contains both files after the first rename (but before the second).  Unfortunately, this requires JNI.]