[I think at least we could upgrade each volume parallel?

I tried upgrading from 2.5.0 to 2.7.1. It spent more than 20 minutes on a 3T * 11 datanode... If parallel, the halt time could reduce to 2 minutes I think?

Thanks., I tried to make {{DataStorage.addStorageLocations}} run parallelly but I found it is difficult.

There are some properties in {{DataStorage}}(inherit from {{StorageInfo}}) which will be updated when loading {{StorageDirectory}}, such as {{layoutVersion}}, so it may have side effect when changing the code from sequential to parallel even if I use lock everywhere to protect these properties.

I do not get the point why we need a {{layoutVersion}} in {{DataStorage}}? As far as I know, {{DataStorage}} is only a container of {{StorageDirectory}} or {{BlockPoolSliceStorage}} if federation is enabled. So what does the {{layoutVersion}} in {{DataStorage}} mean? Is there any history reason for keeping it?

Thanks., HDFS-8578, is also related to upgrade in parallel., Since HDFS-8578 is resolved now, can we close this as duplicate?, +1, Resolved as dup of HDFS-8578.
Feel free to re-open if it doesnt serve the purpose.]