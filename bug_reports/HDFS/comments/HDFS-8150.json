[[~kihwal]  I would like to work on this issue. If you have already started working on this issue , please feel free to assign to you., Attached an initial patch. 
Please review., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  14m 38s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | javac |   7m 29s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 33s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 22s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   3m 57s | There were no new checkstyle issues. |
| {color:green}+1{color} | install |   1m 33s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 33s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   3m  2s | The patch does not introduce any new Findbugs (version 2.0.3) warnings. |
| {color:green}+1{color} | native |   3m 19s | Pre-build of native portion |
| {color:red}-1{color} | hdfs tests | 185m 26s | Tests failed in hadoop-hdfs. |
| | | 230m  1s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.hdfs.server.namenode.snapshot.TestSnapshotFileLength |
|   | hadoop.hdfs.TestGetFileChecksum |
| Timed out tests | org.apache.hadoop.hdfs.server.blockmanagement.TestDatanodeManager |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12728782/HDFS-8150.1.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 99fe03e |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/10430/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/10430/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf903.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/10430/console |


This message was automatically generated., Attaching the patch after fixing testcase failure.
Please review., Thanks [~andreina] for taking this issue. I agree with you that DFSClient should throw exception if the file is under construction. Some comments:
{code}
+   if (blockLocations.isUnderConstruction()) {
+     throw new IOException("Fail to get block MD5, since file " + src + " is under construction ");
+   }
{code}
1. Would you throw the exception when refreching block locations as well?
2. For "block MD5", I'm thinking "checksum" is sufficient. We can get block MD5 checksum from finalized blocks even if the file is under construction.
3. nit: Would you remove unnecessarily whitespace after "construction"?
4. nit: The line is longer than 80 characters.

{code}
-import static org.junit.Assert.assertEquals;
-import static org.junit.Assert.assertThat;
+import static org.junit.Assert.*;
{code}
5. nit: Would you please avoid using * for import?, Thanks [~ajisakaa] for reviewing .
Updated the patch as per the comments.
Please review., +1 for latest patch.

Jenkins has already run on latest patch. But failed to comment back to Jira.
{noformat}-1 overall

| Vote |           Subsystem |  Runtime   | Comment
============================================================================
|   0  |          pre-patch  |  14m 33s   | Pre-patch trunk compilation is 
|      |                     |            | healthy.
|  +1  |            @author  |  0m 0s     | The patch does not contain any 
|      |                     |            | @author tags.
|  +1  |     tests included  |  0m 0s     | The patch appears to include 2 new 
|      |                     |            | or modified test files.
|  +1  |              javac  |  7m 28s    | There were no new javac warning 
|      |                     |            | messages.
|  +1  |            javadoc  |  9m 37s    | There were no new javadoc warning 
|      |                     |            | messages.
|  +1  |      release audit  |  0m 23s    | The applied patch does not increase 
|      |                     |            | the total number of release audit
|      |                     |            | warnings.
|  -1  |         checkstyle  |  2m 12s    | The applied patch generated 2 new 
|      |                     |            | checkstyle issues (total was 327,
|      |                     |            | now 327).
|  -1  |         whitespace  |  0m 0s     | The patch has 1 line(s) that end in 
|      |                     |            | whitespace. Use git apply
|      |                     |            | --whitespace=fix.
|  +1  |            install  |  1m 33s    | mvn install still works. 
|  +1  |    eclipse:eclipse  |  0m 33s    | The patch built with 
|      |                     |            | eclipse:eclipse.
|  +1  |           findbugs  |  3m 4s     | The patch does not introduce any 
|      |                     |            | new Findbugs (version 2.0.3)
|      |                     |            | warnings.
|  +1  |             native  |  3m 12s    | Pre-build of native portion 
|  -1  |         hdfs tests  |  165m 2s   | Tests failed in hadoop-hdfs. 
|      |                     |  207m 43s  | 


             Reason | Tests
 Failed unit tests  |  hadoop.tracing.TestTraceAdmin 
                    |  hadoop.hdfs.server.namenode.TestFileTruncate 


|| Subsystem || Report/Notes ||
============================================================================
| Patch URL | http://issues.apache.org/jira/secure/attachment/12731378/HDFS-8150.3.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / f26700f |
| checkstyle |  /home/jenkins/jenkins-slave/workspace/PreCommit-HDFS-Build/patchprocess/diffcheckstylehadoop-hdfs.txt |
| whitespace | /home/jenkins/jenkins-slave/workspace/PreCommit-HDFS-Build/patchprocess/whitespace.txt |
| hadoop-hdfs test log | /home/jenkins/jenkins-slave/workspace/PreCommit-HDFS-Build/patchprocess/testrun_hadoop-hdfs.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/10862/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf902.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |


============================================================================
============================================================================
                          Adding comment to JIRA
============================================================================
============================================================================


Unable to log in to server: https://issues.apache.org/jira/rpc/soap/jirasoapservice-v2 with user: hadoopqa.
 Cause: com.atlassian.jira.rpc.exception.RemoteAuthenticationException: Attempt to log in user 'hadoopqa' failed. The maximum number of failed login attempts has been reached. Please log into the application through the web interface to reset the number of failed login attempts.
Unable to log in to server: https://issues.apache.org/jira/rpc/soap/jirasoapservice-v2 with user: hadoopqa.
 Cause: com.atlassian.jira.rpc.exception.RemoteAuthenticationException: Attempt to log in user 'hadoopqa' failed. The maximum number of failed login attempts has been reached. Please log into the application through the web interface to reset the number of failed login attempts.
{noformat}

checkstyle and test failures are unrelated to patch.

Will commit soon., Committed to trunk and branch-2.

Thanks [~kihwal] for reporting.
Thanks [~andreina] for contribution,
and Thanks [~ajisakaa] for help in review., FAILURE: Integrated in Hadoop-trunk-Commit #7831 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/7831/])
HDFS-8150. Make getFileChecksum fail for blocks under construction (Contributed by J.Andreina) (vinayakumarb: rev def9136e0259e118e6fd7b656260765d28ac9ae6)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotFileLength.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestGetFileChecksum.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Yarn-trunk #927 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/927/])
HDFS-8150. Make getFileChecksum fail for blocks under construction (Contributed by J.Andreina) (vinayakumarb: rev def9136e0259e118e6fd7b656260765d28ac9ae6)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotFileLength.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestGetFileChecksum.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
, SUCCESS: Integrated in Hadoop-Yarn-trunk-Java8 #196 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/196/])
HDFS-8150. Make getFileChecksum fail for blocks under construction (Contributed by J.Andreina) (vinayakumarb: rev def9136e0259e118e6fd7b656260765d28ac9ae6)
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotFileLength.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestGetFileChecksum.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #195 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/195/])
HDFS-8150. Make getFileChecksum fail for blocks under construction (Contributed by J.Andreina) (vinayakumarb: rev def9136e0259e118e6fd7b656260765d28ac9ae6)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestGetFileChecksum.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotFileLength.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2125 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2125/])
HDFS-8150. Make getFileChecksum fail for blocks under construction (Contributed by J.Andreina) (vinayakumarb: rev def9136e0259e118e6fd7b656260765d28ac9ae6)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestGetFileChecksum.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotFileLength.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #185 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/185/])
HDFS-8150. Make getFileChecksum fail for blocks under construction (Contributed by J.Andreina) (vinayakumarb: rev def9136e0259e118e6fd7b656260765d28ac9ae6)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotFileLength.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestGetFileChecksum.java
, SUCCESS: Integrated in Hadoop-Mapreduce-trunk #2143 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2143/])
HDFS-8150. Make getFileChecksum fail for blocks under construction (Contributed by J.Andreina) (vinayakumarb: rev def9136e0259e118e6fd7b656260765d28ac9ae6)
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotFileLength.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestGetFileChecksum.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
]