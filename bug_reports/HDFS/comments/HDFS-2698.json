[This is because NN calles {{FSImage.rollFSImage()}} with {{renewCheckpoint}} parameter set to {{true}} unconditionally., One line fix, but important for checkpoint performance.
This is laso mentioned in the [comment|https://issues.apache.org/jira/browse/HDFS-903?focusedCommentId=13036705&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13036705] for HADOOP-903. , Same fix plus a modification to TestBackupNode, which tests the condition.
The test succeeds with the patch and fails without., Isnt this same as [https://issues.apache.org/jira/browse/HDFS-2007] ?, Yes. It's a duplicate. Should have searched before filing. Do you mind checking the patch?, Patch looks good to me., This is specific for 0.22 as trunk doesn't have rollFSImage() and no checkpoint time., +1 patch looks correct., I ran tests. All passed., I just committed this to branch 0.22, Integrated in Hadoop-Hdfs-22-branch #123 (See [https://builds.apache.org/job/Hadoop-Hdfs-22-branch/123/])
    HDFS-2698. BackupNode is downloading image from NameNode for every checkpoint. Contributed by Konstantin Shvachko.

shv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1225340
Files : 
* /hadoop/common/branches/branch-0.22/hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.22/hdfs/src/java/org/apache/hadoop/hdfs/server/namenode/FSImage.java
* /hadoop/common/branches/branch-0.22/hdfs/src/test/hdfs/org/apache/hadoop/hdfs/server/namenode/TestBackupNode.java
, Integrated in Hadoop-Hdfs-22-branch #124 (See [https://builds.apache.org/job/Hadoop-Hdfs-22-branch/124/])
    HDFS-2698. BackupNode is downloading image from NameNode for every checkpoint. Contributed by Konstantin Shvachko.

shv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1225340
Files : 
* /hadoop/common/branches/branch-0.22/hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.22/hdfs/src/java/org/apache/hadoop/hdfs/server/namenode/FSImage.java
* /hadoop/common/branches/branch-0.22/hdfs/src/test/hdfs/org/apache/hadoop/hdfs/server/namenode/TestBackupNode.java
]