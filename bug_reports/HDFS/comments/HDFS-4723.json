[Hi, Andrew. I met the same problem as you in HDFS-4709. But I construct a clean Configuration object before each unit test begins, it runs well., Using a new clean configuration object works. I added the additional configuration setting to make sure 3 xceivers are always available anyway, but it can be removed. Also the wait for replication can make what the problem is a bit more clear, if it fails, if there is a write pipeline problem during the test file creation.]