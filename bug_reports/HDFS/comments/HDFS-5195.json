[Relevant JNI documentation is here:

http://docs.oracle.com/javase/6/docs/technotes/guides/jni/spec/functions.html#GetDirectBufferAddress, Here is a patch to check for a null return value.  While I was in this area, I also fixed a potential file handle leak in the test code., mlock and munlock are able to handle {{NULL}} pointers on their own, without any assistance from us.  They will simply fail with {{ENOMEM}}.  

I do agree that it's helpful to print out a special error message in this case to let the user know that JNI access to direct buffers is not available.  However, I would rather not put the check in like you have it here, since it's an extra "if" statement we have to execute all the time, even though 99.9999% of the time it does nothing.  Let's add the check after mlock or munlock fails., bq. Let's add the check after mlock or munlock fails.

Sounds good.  Here is a new patch., +1 for the patch; thanks Chris, I committed this to the HDFS-4949 branch.  Thanks for the review, Colin.]