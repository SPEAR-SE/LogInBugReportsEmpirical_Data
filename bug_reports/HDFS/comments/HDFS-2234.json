[Patch attached. Also converts the test to junit4., Please combine this into HDFS-2235. The updates to the tests should be with the code change., It will, HDFS-2335 will enable one of the lines in this patch. Most of this change isn't HDFS-2235 specific, it refactors the test to junit4 and adds a bunch of tests that already pass (are not addressed by HDFS-2235). If you feel strongly happy to combine them, normally people request these types of changes be pulled out of fixes which is why I filed a separate jira. ]