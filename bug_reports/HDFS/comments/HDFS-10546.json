[I just realized this duplicates HDFS-10353, which fixed the problem in trunk.  We just need to cherry-pick that patch down to branch-2 and branch-2.8.  I'll cover it over there.]