[Attach a simple fix. This is a test only fix., +1 for the patch.  I'll commit this and merge down to branch-2.1-beta., Correction: we need to wait for a Jenkins +1 first., Retriggering Jenkins., Hudson is not posting results because of a failure in the Jenkins job, visible at the end of the log here:

https://builds.apache.org/job/PreCommit-HDFS-Build/4833/consoleText

There is an I/O error trying to delete a Hudson script file.  I don't see how this could be related to this one-line patch in test code.  I'll investigate a bit further., [~chuanliu] Thanks for catching this. When I added that code, I meant @Before and @After as @BeforeClass and @AfterClass. Should we give that a shot?, I changed @BeforeClass and @AfterClass to @Before and @After to enable testRetryCacheRebuild. I should check the cleanup method more carefully at that time. Thanks for the fix Chuan!, bq. When I added that code, I meant @Before and @After as @BeforeClass and @AfterClass. Should we give that a shot?

Yes, could you please try that Chuan?  This would have a side benefit of making test runs faster, because it won't need to bootstrap a whole new {{MiniDFSCluster}} at the start of each test., Thanks, [~sureshms]! I just tried that. Without shutting down the cluster for each test case, the testRetryCacheRebuild fails at the first assert -- {{assertEquals(14, cacheSet.size());}}. I think this is because we have some cache from previous test runs since the cluster is still the old cluster. So shutting down the cluster for each test case may be a more robust approach for this unit test.
{noformat}
testRetryCacheRebuild(org.apache.hadoop.hdfs.server.namenode.TestNamenodeRetryCache)  Time elapsed: 3400 sec  <<< FAILURE!
java.lang.AssertionError: expected:<14> but was:<37>
        at org.junit.Assert.fail(Assert.java:93)
        at org.junit.Assert.failNotEquals(Assert.java:647)
        at org.junit.Assert.assertEquals(Assert.java:128)
        at org.junit.Assert.assertEquals(Assert.java:472)
        at org.junit.Assert.assertEquals(Assert.java:456)
        at org.apache.hadoop.hdfs.server.namenode.TestNamenodeRetryCache.testRetryCacheRebuild(TestNamenodeRetryCache.java:387)
{noformat}
, Thanks for trying it, Chuan.  That makes sense.

I'm still tracking down the Jenkins issue but will try to get this patch committed for you soon., {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12598297/HDFS-5100-trunk.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/4835//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/4835//console

This message is automatically generated., I've committed this to trunk, branch-2, and branch-2.1-beta.  Thanks for the fix, Chuan., SUCCESS: Integrated in Hadoop-trunk-Commit #4277 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/4277/])
HDFS-5100. TestNamenodeRetryCache fails on Windows due to incorrect cleanup. Contributed by Chuan Liu. (cnauroth: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1514573)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestNamenodeRetryCache.java
, SUCCESS: Integrated in Hadoop-Yarn-trunk #303 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/303/])
HDFS-5100. TestNamenodeRetryCache fails on Windows due to incorrect cleanup. Contributed by Chuan Liu. (cnauroth: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1514573)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestNamenodeRetryCache.java
, SUCCESS: Integrated in Hadoop-Hdfs-trunk #1493 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1493/])
HDFS-5100. TestNamenodeRetryCache fails on Windows due to incorrect cleanup. Contributed by Chuan Liu. (cnauroth: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1514573)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestNamenodeRetryCache.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1520 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1520/])
HDFS-5100. TestNamenodeRetryCache fails on Windows due to incorrect cleanup. Contributed by Chuan Liu. (cnauroth: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1514573)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestNamenodeRetryCache.java
]