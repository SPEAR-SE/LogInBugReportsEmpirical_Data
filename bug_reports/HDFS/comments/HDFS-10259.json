[Probably HADOOP-12022 should be backported., Rebased the patch in HADOOP-12022 to branch-2., Closing this as dup of HADOOP-12022.]