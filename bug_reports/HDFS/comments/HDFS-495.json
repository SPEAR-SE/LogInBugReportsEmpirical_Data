[Absolutely right. This fix is posted as part of patch attached to HDFS-200, Is it possible for you to post this patch and a unit test (instead of waiting for HDFS-200)? Thanks.  Here is a page that describes how to write unit tests : http://wiki.apache.org/hadoop/HowToContribute, Sorry, I see this just now. 

I will give the patch next week., This bug has been fixed in the latest trunk.  we should cancel the issue., Thanks Ruyue for taking a look at this issue., Fixing the problem for y20, since everything else is already fixed.]