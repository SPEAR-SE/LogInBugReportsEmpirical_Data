[This is a regression w.r.t Hadoop 1.0 which does let you create >1 MiniDFSCluster in the same JVM, bq. There are several unit tests that create and start more than one MiniDFSCluster at the same time.
Since you have already done this analysis, can you please add information about the tests that are creating multiple MiniDFSClusters. , One of the tests that instantiate a second instance of MiniDFSCluster invalidating storage directory for the first one is TestHDFSTrash. This test succeed only if testTrash() runs before testTrashEnabledClientSide()or testTrashEnabledServerSide(). I'll file a separate bug once I fix this one. Please assign HDFS-3892 to me., Vlad, added you as a contributor and assigned the jira to you., The patch affects public API of MiniDFSCluster class. I verified that HDFS tests compile and run. In case tests in other sub-projects also depend on modified API they need to be patched as well., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12544337/HDFS-3892.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 16 new or modified test files.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestReplication

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3160//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3160//console

This message is automatically generated., Fix for NPE in TestReplication, +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12544342/HDFS-3892.patch.1
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 16 new or modified test files.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3161//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3161//console

This message is automatically generated., This patch has been renamed for test-patch processing for the bug bash., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12729953/HDFS-3892.01.patch |
| Optional Tests | javac unit findbugs checkstyle |
| git revision | trunk / 6ae2a0d |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/10718/console |


This message was automatically generated.]