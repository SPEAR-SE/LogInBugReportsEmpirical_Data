[This is a *real* problem that we have faced on our clusters's too. , +1.  I've just been too lazy to file a bug. :) , Operational note: We decommission nodes a lot (like, one or more per day). Whenever we detect a failed component on a node that is going to necessitate someone taking it down for repairs, we decommission as a preventative measure, because our SiteOps team could do the repair at any time after that. Occasionally I have seen nodes take hours or days or more to decommission, if they are unlucky recipients of a block from a file from some very long-running job.

IIRC it's not just NN restarts that are a problem, DN restarts also have the same problem because when the DN comes up it will be denied communication by NN and immediately shut down, even if it hasn't finished decom'ing. Then you have to un-exclude and re-exclude to get the blocks flowing again. But at least there with manual intervention you can get your blocks back.]