[Fixing together with HADOOP-5872.

1. allowing to set quota even if the current usage goes over the quota.
2. creating two separate exception for NameSpace and DiskSpace quota (both extending QuotaExceededException)., cool!  thanks!, Suggested wording for the namespace quota:
The NameSpace quota (maximum allowed number of files) of directory /test is exceeded: quota=2 file count=3

For disk quota:
 The DiskSpace quota of /test is exceeded:  quota=45000 diskspace count=70656

I will also modify TestQuota and TestHDFSCLI tests ., For the diskspace quota, is it worth putting the numbers into MB, GB, etc for human consumption? On a large cluster with a large quota the formatted number would probably be more easily groked.
, implemented all of the above., Hi Boris, NameSpace quota not only counts files but also directories.  It counts all "names".
{code}
+      return "The NameSpace quota (maximum allowed number of files)" + ...
{code}
, The patch looks good. A few comments apart from Nicholas comment above.

# Need to makes sure help for command line quota commands and documentation user guide reflect the new behaviour.
# In the Exception message, it might be better to replace "diskspace count=" with something like "diskspace consumed=". "count" might confuse users.
# Currently {{FSDirectory.updateCountForInodeWithQuota()}} warns when a directory exceeds quota. The warning text implies it is a software error (or corruption in the image) since it is not expected. The wording in the warning could be changed to be less severe.
, Implemented most of the comments.
(left warning, but changed the wording)., I think you forgot to fix 'hdfs dfsadmin -help' for these commands., changed dfsadmin help, +1., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12409707/HADOOP-5862.patch
  against trunk revision 781816.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 13 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/463/console

This message is automatically generated., synced with trunk to fix the patch, Running test-patch on Friday, June 12, 09     
[exec] 
     [exec] 
     [exec] +1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 14 new or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec] 
     [exec]     +1 Eclipse classpath. The patch retains Eclipse classpath integrity.
     [exec] 
     [exec]     +1 release audit.  The applied patch does not increase the total number of release audit warnings.
     [exec] 
     [exec] 
     [exec] 
     [exec] 
     [exec] ======================================================================
     [exec] ======================================================================
     [exec]     Finished build.
     [exec] ======================================================================
     [exec] ======================================================================
     [exec] 
, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12410042/HADOOP-5862.patch
  against trunk revision 785065.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 14 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.

    -1 release audit.  The applied patch generated 495 release audit warnings (more than the trunk's current 494 warnings).

    -1 core tests.  The patch failed core unit tests.

    -1 contrib tests.  The patch failed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/504/testReport/
Release audit warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/504/artifact/trunk/patchprocess/releaseAuditDiffWarnings.txt
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/504/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/504/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/504/console

This message is automatically generated., resynced with trunk,    [exec] /home/sureshms/tools/buildtools/ant/apache-ant-1.7.1/bin/ant -Dversion=PATCH-HADOOP-5862-1.patch -Djava5.home=/usr/releng/tools/java/jdk1.5.0_06 -Dforrest.home=/home/ndaley/tools/forrest/latest -DHadoopPatchProcess= releaseaudit > ../scratch_dir//patchReleaseAuditWarnings.txt 2>&1
     [exec] 
     [exec] 
     [exec] There appear to be 499 release audit warnings before the patch and 499 release audit warnings after applying the patch.
     [exec] 
     [exec] 
     [exec] 
     [exec] 
     [exec] +1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 14 new or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec] 
     [exec]     +1 Eclipse classpath. The patch retains Eclipse classpath integrity.
     [exec] 
     [exec]     +1 release audit.  The applied patch does not increase the total number of release audit warnings.
     [exec] 
     [exec] 
     [exec] 
     [exec] 
, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12411135/HADOOP-5862-1.patch
  against trunk revision 786278.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 14 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    -1 contrib tests.  The patch failed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/537/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/537/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/537/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/537/console

This message is automatically generated., patch for HDFS trunk., I just committed this to trunk. Thanks Boris!]