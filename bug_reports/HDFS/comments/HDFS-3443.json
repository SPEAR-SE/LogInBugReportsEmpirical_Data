[I think, StandBy node not initialized completely and ZKFC gave the call for transitioning to active. At this point We have the FSNameSystem write lock only for starting activeServices. So, parallelly starting activeServices also can go ahead. By this time, editLogTailer might not have been initialized sompletely. Hence thrwing NPE.

I think we should block the active initialization until it completes standby initialization. should have lock here?
or since there wont be any FSNameSystem updations for standby locking may not be require here. So, just having null check should be fine?, I think it makes sense we should lock the FSN lock while we're starting active services at startup -- ie we should write-lock everything, start the RPC server, wait until initialization is all done, then unlock., Just to clarify, this is a bug with HA in general, not specifically auto failover, right? i.e. if a user manually triggered failover as the NN was starting up, the same problem would occur, I think., Yes, You are right. We can trigger this manually as well. But this will trigger mostly with Automatic failover.
Since you are planning the merge, I will prepare patch on trunk it-self directly. I think, I can move this to top level issue. 
, I could not covert to parent issue. 

Cause:
java.lang.ClassNotFoundException: org.apache.jsp.secure.views.issue.convertissuetosubtask_002dselectparentandtype_jsp , Thanks, Uma. Mind filing a JIRA in the "INFRA" project for the failure to convert to top-level? The JIRA upgrade last week probably broke it., Now I could move this to top-level issue.., Hey Amith. Are you planning on working on this? Happy to review., Yes Todd working on it, will provide patch soon, Hi Todd

There is a need to apply lock on FSNameSystem so I refactored the code as described.

I divided initialize() method to 2 different methods

1. initializeNamesystem() 
2. startCommonServices()

initializeNamesystem() contain the creation of RPC server + FSNameSystem

startCommonServices() will start the services


I tryed to write a Test for the same but I couldn't

I manually verified the working of patch like

1. Start the NN server stop the execution of NameNode.main() in state.prepareToEnterState().
2. I issued transitionToActive manually now this call is blocked due to lock
3. when the NN is fully started then RPC call execute and NN started in Active state, QA didnt pick the patch attaching again, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12530906/HDFS-3443_1.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/2589//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/2589//console

This message is automatically generated., Hi Todd can u review the patch :), Cancelling the patch, as the patch handles the inheritance wrongly. It will break the BNN functionality., I have one more option to solve this without breaking the inheritance for BackupNode.

How about creating EditLogTailer instance inside constructor of FSNameSystem, because this is used in both StandBy and Active states. We will start/stop the thread only in Standby as usual.
{code}this.tailerThread = new EditLogTailerThread(){code}
Above initialization we will do in EditLogTrailer#start().

Since *editLogTrailer* is the only object which is initialized in standby state, and also used in active state. So always order should be maintained. After above suggested fix, maintaining the order not required.
, It seems that trunk still has this bug.  How about adding a boolean for indicating namenode starting up so that NameNodeRpcServer could refuse all operations?, Hi [~amithdk], are you still working on this issue?  If not, I am happy to pick this up., Attached the rebased patch.
Includes Amit's work along with moving of editLogTrailer initialization to constructor., bq. How about adding a boolean for indicating namenode starting up so that NameNodeRpcServer could refuse all operations?
Option is good. currently I think only transition RPCs will have problem, which should be after this patch.
Remaining all requests will anyway will be rejected since the initial state will be STANDBY.

am I right?, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12692158/HDFS-3443-003.patch
  against trunk revision 6464a89.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestParallelShortCircuitRead
                  org.apache.hadoop.fs.contract.hdfs.TestHDFSContractMkdir
                  org.apache.hadoop.hdfs.server.namenode.TestAllowFormat
                  org.apache.hadoop.hdfs.server.namenode.TestCheckPointForSecurityTokens
                  org.apache.hadoop.hdfs.TestBlockStoragePolicy
                  org.apache.hadoop.hdfs.server.datanode.TestRefreshNamenodes
                  org.apache.hadoop.hdfs.server.namenode.ha.TestBootstrapStandbyWithQJM
                  org.apache.hadoop.hdfs.TestEncryptedTransfer
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotMetrics
                  org.apache.hadoop.hdfs.TestDFSInotifyEventInputStream
                  org.apache.hadoop.hdfs.TestSnapshotCommands
                  org.apache.hadoop.hdfs.TestFileLengthOnClusterRestart
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshottableDirListing
                  org.apache.hadoop.hdfs.TestRead
                  org.apache.hadoop.fs.contract.hdfs.TestHDFSContractRootDirectory
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestUpdatePipelineWithSnapshots
                  org.apache.hadoop.hdfs.TestBlocksScheduledCounter
                  org.apache.hadoop.hdfs.server.namenode.TestDiskspaceQuotaUpdate
                  org.apache.hadoop.cli.TestHDFSCLI
                  org.apache.hadoop.hdfs.TestDFSPermission
                  org.apache.hadoop.hdfs.server.namenode.TestCheckpoint
                  org.apache.hadoop.hdfs.TestDFSUpgradeFromImage
                  org.apache.hadoop.hdfs.TestReplaceDatanodeOnFailure
                  org.apache.hadoop.hdfs.tools.TestGetGroups
                  org.apache.hadoop.hdfs.server.namenode.TestStartup
                  org.apache.hadoop.hdfs.server.namenode.TestNameNodeRetryCacheMetrics
                  org.apache.hadoop.hdfs.TestDFSStorageStateRecovery
                  org.apache.hadoop.hdfs.server.namenode.TestFSImageWithXAttr
                  org.apache.hadoop.hdfs.TestMultiThreadedHflush
                  org.apache.hadoop.fs.contract.hdfs.TestHDFSContractRename
                  org.apache.hadoop.hdfs.TestDFSClientFailover
                  org.apache.hadoop.hdfs.TestBlockReaderLocal
                  org.apache.hadoop.cli.TestCacheAdminCLI
                  org.apache.hadoop.hdfs.server.mover.TestMover
                  org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestRbwSpaceReservation
                  org.apache.hadoop.hdfs.server.blockmanagement.TestOverReplicatedBlocks
                  org.apache.hadoop.hdfs.server.namenode.ha.TestInitializeSharedEdits
                  org.apache.hadoop.hdfs.server.namenode.web.resources.TestWebHdfsDataLocality
                  org.apache.hadoop.hdfs.server.namenode.TestNameNodeRecovery
                  org.apache.hadoop.hdfs.server.namenode.ha.TestFailureOfSharedDir
                  org.apache.hadoop.hdfs.TestLeaseRecovery2
                  org.apache.hadoop.fs.loadGenerator.TestLoadGenerator
                  org.apache.hadoop.hdfs.server.namenode.TestFSImageWithAcl
                  org.apache.hadoop.hdfs.server.namenode.TestLargeDirectoryDelete
                  org.apache.hadoop.hdfs.TestWriteConfigurationToDFS
                  org.apache.hadoop.fs.TestFcHdfsSetUMask
                  org.apache.hadoop.hdfs.TestPread
                  org.apache.hadoop.hdfs.server.namenode.TestFSEditLogLoader
                  org.apache.hadoop.hdfs.server.datanode.TestFsDatasetCacheRevocation
                  org.apache.hadoop.hdfs.server.namenode.ha.TestQuotasWithHA
                  org.apache.hadoop.hdfs.crypto.TestHdfsCryptoStreams
                  org.apache.hadoop.fs.viewfs.TestViewFsFileStatusHdfs
                  org.apache.hadoop.hdfs.server.namenode.TestCommitBlockSynchronization
                  org.apache.hadoop.hdfs.server.datanode.TestReadOnlySharedStorage
                  org.apache.hadoop.hdfs.tools.offlineImageViewer.TestOfflineImageViewerForAcl
                  org.apache.hadoop.hdfs.web.TestHttpsFileSystem
                  org.apache.hadoop.hdfs.TestDFSAddressConfig
                  org.apache.hadoop.tracing.TestTracingShortCircuitLocalRead
                  org.apache.hadoop.hdfs.server.namenode.ha.TestBootstrapStandby
                  org.apache.hadoop.hdfs.server.namenode.TestFSDirectory
                  org.apache.hadoop.hdfs.server.datanode.TestIncrementalBlockReports
                  org.apache.hadoop.tracing.TestTracing
                  org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestInterDatanodeProtocol
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestNestedSnapshots
                  org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestLazyPersistFiles
                  org.apache.hadoop.hdfs.TestParallelRead
                  org.apache.hadoop.hdfs.TestRestartDFS
                  org.apache.hadoop.hdfs.TestParallelShortCircuitReadNoChecksum
                  org.apache.hadoop.hdfs.server.blockmanagement.TestSequentialBlockId
                  org.apache.hadoop.hdfs.TestDFSOutputStream
                  org.apache.hadoop.hdfs.server.blockmanagement.TestNameNodePrunesMissingStorages
                  org.apache.hadoop.hdfs.TestSetTimes
                  org.apache.hadoop.hdfs.server.blockmanagement.TestHeartbeatHandling
                  org.apache.hadoop.hdfs.TestParallelShortCircuitLegacyRead
                  org.apache.hadoop.net.TestNetworkTopology
                  org.apache.hadoop.hdfs.server.blockmanagement.TestPendingInvalidateBlock
                  org.apache.hadoop.hdfs.server.blockmanagement.TestBlockTokenWithDFS
                  org.apache.hadoop.hdfs.TestDatanodeDeath
                  org.apache.hadoop.hdfs.server.blockmanagement.TestReplicationPolicyConsiderLoad
                  org.apache.hadoop.hdfs.server.namenode.ha.TestDelegationTokensWithHA
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover
                  org.apache.hadoop.hdfs.tools.offlineEditsViewer.TestOfflineEditsViewer
                  org.apache.hadoop.fs.TestFcHdfsCreateMkdir
                  org.apache.hadoop.hdfs.server.namenode.TestDeadDatanode
                  org.apache.hadoop.hdfs.server.namenode.ha.TestNNHealthCheck
                  org.apache.hadoop.hdfs.TestHFlush
                  org.apache.hadoop.hdfs.server.namenode.ha.TestFailoverWithBlockTokensEnabled
                  org.apache.hadoop.hdfs.TestFetchImage
                  org.apache.hadoop.hdfs.server.namenode.ha.TestDNFencingWithReplication
                  org.apache.hadoop.hdfs.server.namenode.ha.TestDNFencing
                  org.apache.hadoop.hdfs.TestDFSRollback
                  org.apache.hadoop.hdfs.TestDFSUpgrade
                  org.apache.hadoop.fs.TestFcHdfsPermission
                  org.apache.hadoop.hdfs.TestClientBlockVerification
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotBlocksMap
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeVolumeFailureToleration
                  org.apache.hadoop.hdfs.server.namenode.TestNamenodeRetryCache
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeExit
                  org.apache.hadoop.hdfs.server.datanode.TestFsDatasetCache
                  org.apache.hadoop.hdfs.server.datanode.TestBlockHasMultipleReplicasOnSameDN
                  org.apache.hadoop.hdfs.TestMissingBlocksAlert
                  org.apache.hadoop.hdfs.server.namenode.TestNNThroughputBenchmark
                  org.apache.hadoop.hdfs.server.namenode.ha.TestHAMetrics
                  org.apache.hadoop.hdfs.TestQuota
                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithEncryptedTransfer
                  org.apache.hadoop.hdfs.TestFileCreationEmpty
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotDeletion
                  org.apache.hadoop.hdfs.server.namenode.ha.TestEditLogTailer
                  org.apache.hadoop.hdfs.server.namenode.TestStorageRestore
                  org.apache.hadoop.hdfs.server.namenode.TestSaveNamespace
                  org.apache.hadoop.hdfs.server.namenode.TestParallelImageWrite
                  org.apache.hadoop.hdfs.tools.TestDebugAdmin
                  org.apache.hadoop.hdfs.server.datanode.TestDiskError
                  org.apache.hadoop.hdfs.TestPersistBlocks
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestRenameWithSnapshots
                  org.apache.hadoop.hdfs.server.namenode.ha.TestEditLogsDuringFailover
                  org.apache.hadoop.hdfs.server.namenode.TestNameEditsConfigs
                  org.apache.hadoop.hdfs.server.namenode.TestNameNodeRpcServer
                  org.apache.hadoop.hdfs.server.namenode.TestSnapshotPathINodes
                  org.apache.hadoop.hdfs.server.namenode.TestFavoredNodesEndToEnd
                  org.apache.hadoop.hdfs.tools.offlineImageViewer.TestOfflineImageViewer
                  org.apache.hadoop.hdfs.shortcircuit.TestShortCircuitCache
                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithNodeGroup
                  org.apache.hadoop.hdfs.server.datanode.TestDnRespectsBlockReportSplitThreshold
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotNameWithInvalidCharacters
                  org.apache.hadoop.hdfs.TestModTime
                  org.apache.hadoop.hdfs.server.blockmanagement.TestBlockManager
                  org.apache.hadoop.hdfs.server.namenode.ha.TestXAttrsWithHA
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeMultipleRegistrations
                  org.apache.hadoop.hdfs.TestSetrepIncreasing
                  org.apache.hadoop.hdfs.TestGetBlocks
                  org.apache.hadoop.hdfs.TestDFSStartupVersions
                  org.apache.hadoop.hdfs.TestDatanodeBlockScanner
                  org.apache.hadoop.hdfs.TestReadWhileWriting
                  org.apache.hadoop.hdfs.TestRenameWhileOpen
                  org.apache.hadoop.hdfs.server.namenode.TestDefaultBlockPlacementPolicy
                  org.apache.hadoop.fs.viewfs.TestViewFsWithXAttrs
                  org.apache.hadoop.tools.TestJMXGet
                  org.apache.hadoop.hdfs.shortcircuit.TestShortCircuitLocalRead
                  org.apache.hadoop.hdfs.TestHDFSFileSystemContract
                  org.apache.hadoop.hdfs.TestFileAppend4
                  org.apache.hadoop.TestGenericRefresh
                  org.apache.hadoop.hdfs.server.namenode.TestAddBlock
                  org.apache.hadoop.hdfs.TestDataTransferKeepalive
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeMetrics
                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithHANameNodes
                  org.apache.hadoop.security.TestPermissionSymlinks
                  org.apache.hadoop.hdfs.server.namenode.ha.TestRetryCacheWithHA
                  org.apache.hadoop.hdfs.server.namenode.TestINodeFile
                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithSaslDataTransfer
                  org.apache.hadoop.hdfs.TestFileAppend2
                  org.apache.hadoop.hdfs.TestSetrepDecreasing
                  org.apache.hadoop.hdfs.server.namenode.ha.TestGetGroupsWithHA
                  org.apache.hadoop.hdfs.server.namenode.TestProcessCorruptBlocks
                  org.apache.hadoop.hdfs.security.TestDelegationTokenForProxyUser
                  org.apache.hadoop.hdfs.server.namenode.TestAuditLogs
                  org.apache.hadoop.hdfs.TestInjectionForSimulatedStorage
                  org.apache.hadoop.hdfs.server.namenode.TestFsck
                  org.apache.hadoop.fs.contract.hdfs.TestHDFSContractDelete
                  org.apache.hadoop.hdfs.TestLocalDFS
                  org.apache.hadoop.hdfs.server.namenode.TestListCorruptFileBlocks
                  org.apache.hadoop.hdfs.server.namenode.TestSecondaryNameNodeUpgrade
                  org.apache.hadoop.hdfs.TestCrcCorruption
                  org.apache.hadoop.hdfs.TestListFilesInFileContext
                  org.apache.hadoop.hdfs.server.namenode.TestNameNodeAcl
                  org.apache.hadoop.hdfs.TestDataTransferProtocol
                  org.apache.hadoop.hdfs.TestConnCache
                  org.apache.hadoop.hdfs.web.TestWebHdfsWithAuthenticationFilter
                  org.apache.hadoop.hdfs.TestGetFileChecksum
                  org.apache.hadoop.hdfs.server.blockmanagement.TestBlocksWithNotEnoughRacks
                  org.apache.hadoop.hdfs.TestFileAppend
                  org.apache.hadoop.hdfs.TestReservedRawPaths
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeRollingUpgrade
                  org.apache.hadoop.TestRefreshCallQueue
                  org.apache.hadoop.hdfs.TestDisableConnCache
                  org.apache.hadoop.hdfs.server.datanode.TestIncrementalBrVariations
                  org.apache.hadoop.cli.TestXAttrCLI
                  org.apache.hadoop.hdfs.server.namenode.TestMetadataVersionOutput
                  org.apache.hadoop.hdfs.TestParallelShortCircuitReadUnCached
                  org.apache.hadoop.hdfs.TestDecommission
                  org.apache.hadoop.fs.TestUrlStreamHandler
                  org.apache.hadoop.hdfs.server.namenode.TestNameNodeMXBean
                  org.apache.hadoop.hdfs.server.namenode.TestValidateConfigurationSettings
                  org.apache.hadoop.hdfs.TestSeekBug
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeVolumeFailure
                  org.apache.hadoop.hdfs.security.token.block.TestBlockToken
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSetQuotaWithSnapshot
                  org.apache.hadoop.fs.TestEnhancedByteBufferAccess
                  org.apache.hadoop.hdfs.TestHDFSServerPorts
                  org.apache.hadoop.hdfs.TestDFSFinalize
                  org.apache.hadoop.hdfs.TestDFSMkdirs
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotRename
                  org.apache.hadoop.hdfs.TestDFSClientExcludedNodes
                  org.apache.hadoop.hdfs.server.namenode.TestFSNamesystem
                  org.apache.hadoop.hdfs.server.datanode.TestTransferRbw
                  org.apache.hadoop.hdfs.server.namenode.TestAuditLogger
                  org.apache.hadoop.hdfs.TestRollingUpgrade
                  org.apache.hadoop.hdfs.server.namenode.TestLeaseManager
                  org.apache.hadoop.hdfs.server.namenode.TestFSImage
                  org.apache.hadoop.hdfs.server.balancer.TestBalancer
                  org.apache.hadoop.hdfs.server.datanode.TestNNHandlesBlockReportPerStorage
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeInitStorage
                  org.apache.hadoop.fs.viewfs.TestViewFileSystemWithXAttrs
                  org.apache.hadoop.hdfs.server.namenode.TestEditLog
                  org.apache.hadoop.fs.TestHDFSFileContextMainOperations
                  org.apache.hadoop.hdfs.TestSafeMode
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestXAttrWithSnapshot
                  org.apache.hadoop.hdfs.server.namenode.TestBackupNode
                  org.apache.hadoop.hdfs.TestDatanodeLayoutUpgrade
                  org.apache.hadoop.hdfs.server.namenode.ha.TestStandbyCheckpoints
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeHotSwapVolumes
                  org.apache.hadoop.hdfs.server.namenode.TestFileContextAcl
                  org.apache.hadoop.hdfs.server.namenode.ha.TestStandbyBlockManagement
                  org.apache.hadoop.hdfs.server.namenode.TestAclConfigFlag
                  org.apache.hadoop.hdfs.TestWriteRead
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotFileLength
                  org.apache.hadoop.hdfs.tools.TestDFSAdminWithHA
                  org.apache.hadoop.hdfs.web.TestWebHdfsTokens
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotDiffReport
                  org.apache.hadoop.hdfs.server.namenode.TestMetaSave
                  org.apache.hadoop.fs.contract.hdfs.TestHDFSContractAppend
                  org.apache.hadoop.hdfs.server.namenode.ha.TestStateTransitionFailure
                  org.apache.hadoop.hdfs.TestHdfsAdmin
                  org.apache.hadoop.fs.contract.hdfs.TestHDFSContractOpen
                  org.apache.hadoop.hdfs.server.datanode.TestMultipleNNDataBlockScanner
                  org.apache.hadoop.hdfs.server.namenode.TestGenericJournalConf
                  org.apache.hadoop.hdfs.TestFileCreation
                  org.apache.hadoop.hdfs.TestDatanodeRegistration
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshot
                  org.apache.hadoop.hdfs.server.mover.TestStorageMover
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestAclWithSnapshot
                  org.apache.hadoop.hdfs.TestClientReportBadBlock
                  org.apache.hadoop.hdfs.server.namenode.TestAddBlockRetry
                  org.apache.hadoop.hdfs.TestDistributedFileSystem
                  org.apache.hadoop.tracing.TestTraceAdmin
                  org.apache.hadoop.hdfs.server.namenode.TestSecurityTokenEditLog
                  org.apache.hadoop.hdfs.server.namenode.TestBlockUnderConstruction
                  org.apache.hadoop.hdfs.TestFileCorruption
                  org.apache.hadoop.hdfs.server.namenode.TestHDFSConcat
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeMXBean
                  org.apache.hadoop.hdfs.web.TestWebHdfsFileSystemContract
                  org.apache.hadoop.hdfs.server.datanode.TestBlockReplacement
                  org.apache.hadoop.hdfs.TestClose
                  org.apache.hadoop.hdfs.server.namenode.metrics.TestNameNodeMetrics
                  org.apache.hadoop.hdfs.TestAbandonBlock
                  org.apache.hadoop.hdfs.TestDFSShell
                  org.apache.hadoop.hdfs.server.namenode.ha.TestHAFsck
                  org.apache.hadoop.hdfs.server.datanode.TestBlockRecovery
                  org.apache.hadoop.hdfs.TestDatanodeConfig
                  org.apache.hadoop.hdfs.server.namenode.TestNNStorageRetentionFunctional
                  org.apache.hadoop.hdfs.TestLeaseRecovery
                  org.apache.hadoop.hdfs.server.datanode.TestTriggerBlockReport
                  org.apache.hadoop.hdfs.tools.TestDFSAdmin
                  org.apache.hadoop.hdfs.server.namenode.ha.TestFailureToReadEdits
                  org.apache.hadoop.hdfs.TestWriteBlockGetsBlockLengthHint
                  org.apache.hadoop.hdfs.server.blockmanagement.TestRBWBlockInvalidation
                  org.apache.hadoop.hdfs.server.namenode.TestFsLimits
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPendingCorruptDnMessages
                  org.apache.hadoop.fs.viewfs.TestViewFsHdfs
                  org.apache.hadoop.hdfs.TestFSInputChecker
                  org.apache.hadoop.fs.contract.hdfs.TestHDFSContractConcat
                  org.apache.hadoop.hdfs.server.namenode.TestFileLimit
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotListing
                  org.apache.hadoop.fs.viewfs.TestViewFileSystemAtHdfsRoot
                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithMultipleNameNodes
                  org.apache.hadoop.hdfs.TestDFSShellGenericOptions
                  org.apache.hadoop.hdfs.TestHDFSTrash
                  org.apache.hadoop.hdfs.server.datanode.TestCachingStrategy
                  org.apache.hadoop.hdfs.TestSmallBlock
                  org.apache.hadoop.hdfs.web.TestWebHDFSAcl
                  org.apache.hadoop.cli.TestCryptoAdminCLI
                  org.apache.hadoop.hdfs.TestFileCreationDelete
                  org.apache.hadoop.hdfs.server.namenode.ha.TestLossyRetryInvocationHandler
                  org.apache.hadoop.hdfs.tools.TestDFSHAAdminMiniCluster
                  org.apache.hadoop.hdfs.server.namenode.TestClusterId
                  org.apache.hadoop.hdfs.TestReplication
                  org.apache.hadoop.hdfs.server.namenode.ha.TestHAAppend
                  org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestScrLazyPersistFiles
                  org.apache.hadoop.cli.TestAclCLI
                  org.apache.hadoop.fs.viewfs.TestViewFileSystemWithAcls
                  org.apache.hadoop.hdfs.server.namenode.TestEditLogAutoroll
                  org.apache.hadoop.fs.TestSymlinkHdfsFileContext
                  org.apache.hadoop.hdfs.TestIsMethodSupported
                  org.apache.hadoop.hdfs.server.namenode.TestNameNodeResourceChecker
                  org.apache.hadoop.hdfs.server.namenode.TestTransferFsImage
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestINodeFileUnderConstructionWithSnapshot
                  org.apache.hadoop.hdfs.server.namenode.ha.TestDFSUpgradeWithHA
                  org.apache.hadoop.hdfs.server.namenode.TestEditLogRace
                  org.apache.hadoop.hdfs.TestFileAppendRestart
                  org.apache.hadoop.fs.TestSymlinkHdfsFileSystem
                  org.apache.hadoop.hdfs.TestFileAppend3
                  org.apache.hadoop.hdfs.server.namenode.TestFileContextXAttr
                  org.apache.hadoop.hdfs.TestDatanodeReport
                  org.apache.hadoop.hdfs.TestMiniDFSCluster
                  org.apache.hadoop.hdfs.TestPipelines
                  org.apache.hadoop.hdfs.server.namenode.TestDecommissioningStatus
                  org.apache.hadoop.hdfs.server.namenode.ha.TestHASafeMode
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestDisallowModifyROSnapshot
                  org.apache.hadoop.hdfs.web.TestWebHdfsWithMultipleNameNodes
                  org.apache.hadoop.hdfs.qjournal.TestSecureNNWithQJM
                  org.apache.hadoop.hdfs.server.namenode.metrics.TestNNMetricFilesInGetListingOps
                  org.apache.hadoop.hdfs.TestBlockReaderFactory
                  org.apache.hadoop.hdfs.server.namenode.TestNamenodeCapacityReport
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotReplication
                  org.apache.hadoop.hdfs.server.blockmanagement.TestReplicationPolicyWithNodeGroup
                  org.apache.hadoop.hdfs.server.namenode.ha.TestStandbyIsHot
                  org.apache.hadoop.hdfs.server.namenode.TestFileTruncate
                  org.apache.hadoop.hdfs.TestRollingUpgradeRollback
                  org.apache.hadoop.hdfs.TestFSOutputSummer
                  org.apache.hadoop.hdfs.TestBlockReaderLocalLegacy
                  org.apache.hadoop.hdfs.server.namenode.TestFSImageWithSnapshot
                  org.apache.hadoop.hdfs.server.namenode.ha.TestDFSZKFailoverController
                  org.apache.hadoop.hdfs.TestFsShellPermission
                  org.apache.hadoop.fs.viewfs.TestViewFsWithAcls
                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeVolumeFailureReporting
                  org.apache.hadoop.hdfs.server.blockmanagement.TestPendingReplication
                  org.apache.hadoop.hdfs.server.namenode.ha.TestHAStateTransitions
                  org.apache.hadoop.hdfs.TestEncryptionZones
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestCheckpointsWithSnapshots
                  org.apache.hadoop.fs.TestResolveHdfsSymlink
                  org.apache.hadoop.hdfs.server.blockmanagement.TestUnderReplicatedBlocks
                  org.apache.hadoop.hdfs.server.namenode.TestXAttrConfigFlag
                  org.apache.hadoop.hdfs.TestFileConcurrentReader
                  org.apache.hadoop.hdfs.server.blockmanagement.TestNodeCount
                  org.apache.hadoop.fs.viewfs.TestViewFsDefaultValue
                  org.apache.hadoop.hdfs.web.TestWebHDFSForHA
                  org.apache.hadoop.hdfs.TestAppendDifferentChecksum
                  org.apache.hadoop.hdfs.TestEncryptionZonesWithHA
                  org.apache.hadoop.hdfs.server.namenode.TestCacheDirectives
                  org.apache.hadoop.hdfs.server.namenode.TestCreateEditsLog
                  org.apache.hadoop.hdfs.server.namenode.TestFSNamesystemMBean
                  org.apache.hadoop.hdfs.server.namenode.ha.TestHarFileSystemWithHA
                  org.apache.hadoop.hdfs.TestFileStatus
                  org.apache.hadoop.hdfs.web.TestWebHDFSXAttr
                  org.apache.hadoop.hdfs.server.namenode.TestNameNodeXAttr
                  org.apache.hadoop.hdfs.server.blockmanagement.TestReplicationPolicy
                  org.apache.hadoop.hdfs.server.datanode.TestHSync
                  org.apache.hadoop.hdfs.protocol.datatransfer.sasl.TestSaslDataTransfer
                  org.apache.hadoop.hdfs.server.datanode.TestStorageReport
                  org.apache.hadoop.fs.viewfs.TestViewFileSystemHdfs
                  org.apache.hadoop.hdfs.TestParallelUnixDomainRead
                  org.apache.hadoop.hdfs.tools.TestStoragePolicyCommands
                  org.apache.hadoop.hdfs.TestDFSRemove
                  org.apache.hadoop.hdfs.TestBalancerBandwidth
                  org.apache.hadoop.fs.viewfs.TestViewFsAtHdfsRoot
                  org.apache.hadoop.hdfs.server.datanode.TestNNHandlesCombinedBlockReport
                  org.apache.hadoop.hdfs.server.datanode.TestDeleteBlockPool
                  org.apache.hadoop.hdfs.TestDFSClientRetries
                  org.apache.hadoop.hdfs.server.blockmanagement.TestComputeInvalidateWork
                  org.apache.hadoop.hdfs.TestListFilesInDFS
                  org.apache.hadoop.hdfs.server.namenode.TestHostsFiles
                  org.apache.hadoop.hdfs.qjournal.TestNNWithQJM
                  org.apache.hadoop.hdfs.TestFileCreationClient
                  org.apache.hadoop.hdfs.TestRollingUpgradeDowngrade
                  org.apache.hadoop.fs.contract.hdfs.TestHDFSContractCreate
                  org.apache.hadoop.fs.permission.TestStickyBit
                  org.apache.hadoop.hdfs.web.TestFSMainOperationsWebHdfs
                  org.apache.hadoop.hdfs.TestEncryptionZonesWithKMS
                  org.apache.hadoop.fs.TestSymlinkHdfsDisable
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestOpenFilesWithSnapshot
                  org.apache.hadoop.hdfs.TestDFSRename
                  org.apache.hadoop.hdfs.server.namenode.TestDeleteRace
                  org.apache.hadoop.hdfs.TestLease
                  org.apache.hadoop.security.TestRefreshUserMappings
                  org.apache.hadoop.hdfs.TestLargeBlock
                  org.apache.hadoop.fs.TestGlobPaths
                  org.apache.hadoop.hdfs.server.namenode.TestFsckWithMultipleNameNodes
                  org.apache.hadoop.hdfs.server.namenode.TestEditLogJournalFailures
                  org.apache.hadoop.hdfs.server.namenode.TestNameNodeRespectsBindHostKeys
                  org.apache.hadoop.hdfs.security.TestDelegationToken
                  org.apache.hadoop.hdfs.TestClientProtocolForPipelineRecovery
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotStatsMXBean
                  org.apache.hadoop.security.TestPermission
                  org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestWriteToReplica
                  org.apache.hadoop.hdfs.server.datanode.TestDirectoryScanner
                  org.apache.hadoop.hdfs.web.TestWebHDFS
                  org.apache.hadoop.hdfs.server.namenode.TestSecondaryWebUi
                  org.apache.hadoop.fs.contract.hdfs.TestHDFSContractSeek
                  org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestDatanodeRestart
                  org.apache.hadoop.fs.shell.TestHdfsTextCommand
                  org.apache.hadoop.hdfs.TestBlockMissingException

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9216//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9216//console

This message is automatically generated., > ... Remaining all requests will anyway will be rejected since the initial state will be STANDBY. ...

Some methods such as saveNamespace() and refreshNodes are OperationCategory.UNCHECKED operations so that standby nn should serve them.

Some other methods such as blockReceivedAndDeleted(), refreshUserToGroupsMappings() and addSpanReceiver() do not check OperationCategory.  Some of them probably are bugs., {quote}Some methods such as saveNamespace() and refreshNodes are OperationCategory.UNCHECKED operations so that standby nn should serve them.
Some other methods such as blockReceivedAndDeleted(), refreshUserToGroupsMappings() and addSpanReceiver() do not check OperationCategory. Some of them probably are bugs.{quote}
All these will be processed once all the services (common and state specific) are started, because after this patch everything starts under same lock.
So I feel not a problem., Fixed tests, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12693012/HDFS-3443-004.patch
  against trunk revision 24315e7.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.namenode.TestStartup
                  org.apache.hadoop.hdfs.server.namenode.TestBackupNode
                  org.apache.hadoop.hdfs.server.namenode.TestFsLimits

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9262//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9262//console

This message is automatically generated., Fixed More tests, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12693066/HDFS-3443-005.patch
  against trunk revision 19cbce3.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.blockmanagement.TestDatanodeManager
                  org.apache.hadoop.hdfs.server.namenode.TestBackupNode
                  org.apache.hadoop.hdfs.server.namenode.ha.TestRetryCacheWithHA

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9266//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9266//console

This message is automatically generated., > All these will be processed once all the services (common and state specific) are started, because after this patch everything starts under same lock.

Hi Vinay, I do not oppose the idea of using lock.  But it seems not easy to get it right as some unit tests still failing.  Also, it will be harder for changing the code later on.  Why not adding a boolean for indicating namenode starting up?  It looks like a straightforward solution to me., bq. Hi Vinay, I do not oppose the idea of using lock. But it seems not easy to get it right as some unit tests still failing. Also, it will be harder for changing the code later on. Why not adding a boolean for indicating namenode starting up? It looks like a straightforward solution to me.
Thanks for the clarification [~szetszwo]. I am fine with using boolean option.
I will try to post a patch with the boolean changes soon., attaching patch for the inclusion of boolean check for every RPC in NameNode., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12693217/HDFS-3443-006.patch
  against trunk revision 5a6c084.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover
                  org.apache.hadoop.hdfs.server.namenode.TestFileTruncate

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9274//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9274//console

This message is automatically generated., Above failures are unrelated., Thanks Vinay.  Some comments on the patch:
- NameNode.started should be volatile or use AtomicBoolean.
- Need to add checkNNStartup() for the rpc methods below.
-* getGroupsForUser(String)
-* refresh(String, String[])
-* refreshCallQueue()
-* refreshSuperUserGroupsConfiguration()
-* refreshUserToGroupsMappings()
, Attached the changes for AtomicBoolean for {{NameNode.started}}, {quote}Need to add checkNNStartup() for the rpc methods below.
getGroupsForUser(String)
refresh(String, String[])
refreshCallQueue()
refreshSuperUserGroupsConfiguration()
refreshUserToGroupsMappings(){quote}
I have intentionally didnt add check to these. Because except refreshCallQueue(), all are RPCs for static datastructure updates. Not really relevant to NameNode instance. So NameNode startup doesn't really matters for these. {{refreshCallQueue()}} also doesn't really do anything specific to NameNode it only refreshes RPC server's call queue. 
And some don't have {{throws}} clause for throwing exception in their signature and these protocols are from hadoop-common. So don't want to messup those.

is that fine with you?, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12693518/HDFS-3443-007.patch
  against trunk revision 6b17eb9.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.namenode.ha.TestRetryCacheWithHA
                  org.apache.hadoop.hdfs.server.balancer.TestBalancer

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9289//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9289//console

This message is automatically generated., > I have intentionally didnt add check to these. ... is that fine with you?

Sure, let's leave them unchecked for the moment.  We may add checkNNStartup() later on if necessary., +1 patch looks good, FAILURE: Integrated in Hadoop-trunk-Commit #6904 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6904/])
HDFS-3443. Fix NPE when namenode transition to active during startup by adding checkNNStartup() in NameNodeRpcServer.  Contributed by Vinayakumar B (szetszwo: rev db334bb8625da97c7e518cbcf477530c7ba7001e)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeRpcServer.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNode.java
, I have committed this.  Thanks, Vinay!, Thanks [~szetszwo] for reviews and commit, Updated the title as per CHANGES.txt
, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #81 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/81/])
HDFS-3443. Fix NPE when namenode transition to active during startup by adding checkNNStartup() in NameNodeRpcServer.  Contributed by Vinayakumar B (szetszwo: rev db334bb8625da97c7e518cbcf477530c7ba7001e)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeRpcServer.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNode.java
, FAILURE: Integrated in Hadoop-Yarn-trunk #815 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/815/])
HDFS-3443. Fix NPE when namenode transition to active during startup by adding checkNNStartup() in NameNodeRpcServer.  Contributed by Vinayakumar B (szetszwo: rev db334bb8625da97c7e518cbcf477530c7ba7001e)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeRpcServer.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNode.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2013 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2013/])
HDFS-3443. Fix NPE when namenode transition to active during startup by adding checkNNStartup() in NameNodeRpcServer.  Contributed by Vinayakumar B (szetszwo: rev db334bb8625da97c7e518cbcf477530c7ba7001e)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNode.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeRpcServer.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #78 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/78/])
HDFS-3443. Fix NPE when namenode transition to active during startup by adding checkNNStartup() in NameNodeRpcServer.  Contributed by Vinayakumar B (szetszwo: rev db334bb8625da97c7e518cbcf477530c7ba7001e)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNode.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeRpcServer.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #82 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/82/])
HDFS-3443. Fix NPE when namenode transition to active during startup by adding checkNNStartup() in NameNodeRpcServer.  Contributed by Vinayakumar B (szetszwo: rev db334bb8625da97c7e518cbcf477530c7ba7001e)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNode.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeRpcServer.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2032 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2032/])
HDFS-3443. Fix NPE when namenode transition to active during startup by adding checkNNStartup() in NameNodeRpcServer.  Contributed by Vinayakumar B (szetszwo: rev db334bb8625da97c7e518cbcf477530c7ba7001e)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNode.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeRpcServer.java
, Note: Even though this is listed as a "2.6.1-candidate" it is actually already checked into branch-2.6.]