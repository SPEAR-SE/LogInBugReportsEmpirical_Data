[Thanks [~xyao] for reporting this, I will take a look at this later., {{CryptoOutputStream}} is not thread-safe as it declares. To make it work transparently for HBase, I need to change it to thread-safe., We should take a more general fix and instead move the synchronization to FSDataOutputStream, as suggested in HADOOP-11708, [~xyao] could you test the patch over on HADOOP-11710 to see if it fixes the problem for you?, As discussed in HADOOP-11708, I +1 for changing CryptoOutputStream to behave the same as HDFS.
We could not make DFSOutputStream or CryptOutputStream synchronized for all methods, that would affect performance, in most cases, applications should handle the synchronization, so it's enough we keep the same behave as HDFS.

Sorry that I could not get time working on this JIRA in the past two days for personal reason. Since Sean Busbey has a patch in HADOOP-11710, I would mark this as duplicated.]