[I have attached the initial patch which refines the xattrs permissions.
User.* - can be decided by regular file permissions and for sticky bit dirs, owner and super user can write xattrs.
trusted.* - allowed only for super users. , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12651853/RefinedPermissions-HDFS-6556.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestBlockReaderFactory
                  org.apache.hadoop.hdfs.server.namenode.snapshot.TestXAttrWithSnapshot

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7202//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7202//console

This message is automatically generated., TestXAttrWithSnapshot failure is related to this patch. I will fix it in next patch!, Attached the patch which fixes the TestXAttrWithSnapshot failure., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12651880/RefinedPermissions-HDFS-6556-1.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.TestGenericRefresh
                  org.apache.hadoop.hdfs.server.namenode.TestCacheDirectives

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7204//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7204//console

This message is automatically generated., Thanks Uma, nice work. Then for user and trusted namespace xattrs, they are in line with linux.
I have two small comments:
{code}
-    FSPermissionChecker pc = getPermissionChecker();
-    XAttrPermissionFilter.checkPermissionForApi(pc, xAttr);
+    final FSPermissionChecker pc = isPermissionEnabled ? getPermissionChecker()
+        : null;
+    if (pc != null) {
+      XAttrPermissionFilter.checkPermissionForApi(pc, xAttr);
+    }
{code}
I think we don't need this modification. {{getPermissionChecker()}} will always create a {{FSPermissionChecker}}, even without permission enabled, it can be used to check the super. Then it's in line with other places in {{FSNameSystem}} where {{FSPermissionChecker pc = getPermissionChecker();}} is used.

{code}
-    if (xAttr.getNameSpace() == XAttr.NameSpace.USER || 
-        (xAttr.getNameSpace() == XAttr.NameSpace.TRUSTED && 
-        pc.isSuperUser())) {
+    if (xAttr.getNameSpace() == XAttr.NameSpace.USER) {
       return;
     }
+    
+    if(xAttr.getNameSpace() == XAttr.NameSpace.TRUSTED){
+      pc.checkSuperuserPrivilege();
+      return;
+    }
{code}
This may be not necessary, indeed {{pc.checkSuperuserPrivilege()}} will check the super and throw exception, but the exception is not clear, I'd prefer original one., Thanks a lot Yi for the review. Initially why I changed that permissionChecker to initialize only on enabling isEnablePermissions is, trusted also should check super user only on enabling permissions. But Now I realized that Trusted.* is depending on kind of user and user.* is depending on file permissions. So, as isEnablePermissions flag is for file permissions, user.* only should care about it but not trusted.*. I modified it to older code. For second comment, as we wanted to show the xattr info in message, lets keep the xattr included message., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12652235/refinedPermissions-HDFS-6556-2.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestCrcCorruption

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7226//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7226//console

This message is automatically generated., Thanks Uma for the update, it's OK for me.  
BTW, the test failure is not related., Thanks a lot, Yi for the review.

[~andrew.wang] or [~cnauroth] , do you want to take a look ? If any of you +1,   I can go for commit. , Hi, [~umamaheswararao].  The patch looks good.  I have one minor suggestion.  I see this code block is repeated in {{FSNamesystem#setXAttrInt}} and {{FSNamesystem#removeXAttr}}:

{code}
      if (isPermissionEnabled && xAttr.getNameSpace() == XAttr.NameSpace.USER) {
        if (isStickyBitDirectory(src)) {
          if (!pc.isSuperUser()) {
            checkOwner(pc, src);
          }
        } else {
          checkPathAccess(pc, src, FsAction.WRITE);
        }
      }
{code}

We could remove the {{isStickyBitDirectory}} method and instead add a method named something like {{checkXAttrChangeAccess}} that fully encapsulates all of the above logic.  This would reduce code duplication.  What do you think?, Thanks a lot, [~cnauroth] for the review!
Attached a patch which should address your suggestion., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12652803/refinedPermissions-HDFS-6556-3.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.namenode.TestNameNodeHttpServer

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7239//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7239//console

This message is automatically generated., Above test failure should be unrelated to this patch., +1 for the patch.  Thanks, Uma!  Yi, thank you for code reviewing., SUCCESS: Integrated in Hadoop-trunk-Commit #5795 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/5795/])
HDFS-6556. Refine XAttr permissions. Contributed by Uma Maheswara Rao G. (umamahesh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1606320)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/fs/XAttr.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/XAttrPermissionFilter.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSShell.java
, Thanks a lot, Chris and Yi for the code reviews!
I have just committed this to trunk and branch-2., FAILURE: Integrated in Hadoop-Mapreduce-trunk #1815 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1815/])
HDFS-6556. Refine XAttr permissions. Contributed by Uma Maheswara Rao G. (umamahesh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1606320)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/fs/XAttr.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/XAttrPermissionFilter.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSShell.java
, FAILURE: Integrated in Hadoop-Yarn-trunk #598 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/598/])
HDFS-6556. Refine XAttr permissions. Contributed by Uma Maheswara Rao G. (umamahesh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1606320)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/fs/XAttr.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/XAttrPermissionFilter.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSShell.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1789 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1789/])
HDFS-6556. Refine XAttr permissions. Contributed by Uma Maheswara Rao G. (umamahesh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1606320)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/fs/XAttr.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/XAttrPermissionFilter.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSShell.java
]