[This should have been fixed by HDFS-7005.  If not and this patch supersedes that one, please remove the duplicate code., Yeah, this looks like a duplicate.  Any objections to marking this as a duplicate of HDFS-7005?]