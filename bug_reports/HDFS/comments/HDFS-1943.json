[patch to fix it., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12479293/HDFS-1943.patch
  against trunk revision 1103970.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these core unit tests:
                  org.apache.hadoop.hdfs.TestDFSStorageStateRecovery
                  org.apache.hadoop.hdfs.TestFileConcurrentReader
                  org.apache.hadoop.tools.TestJMXGet

    +1 contrib tests.  The patch passed contrib unit tests.

    +1 system test framework.  The patch passed system test framework compile.

Test results: https://builds.apache.org/hudson/job/PreCommit-HDFS-Build/531//testReport/
Findbugs warnings: https://builds.apache.org/hudson/job/PreCommit-HDFS-Build/531//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/hudson/job/PreCommit-HDFS-Build/531//console

This message is automatically generated., +1 to this patch. , +1, It's not a good idea to run the dn as root, but this shouldn't be the way it's prevented.  Unit test failures can't be related.  Committing., Committed to trunk.  Resolving.  Thanks, Wei!, Integrated in Hadoop-Hdfs-trunk-Commit #685 (See [https://builds.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/685/])
    , Integrated in Hadoop-Hdfs-trunk #678 (See [https://builds.apache.org/hudson/job/Hadoop-Hdfs-trunk/678/])
    HDFS-1943. Fail to start datanode while start-dfs.sh is executed by root user. Contributed by Wei Yongjun.

jghoman : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1127706
Files : 
* /hadoop/hdfs/trunk/bin/hdfs
* /hadoop/hdfs/trunk/CHANGES.txt
, Integrated in Hadoop-Hdfs-22-branch #90 (See [https://builds.apache.org/job/Hadoop-Hdfs-22-branch/90/])
    HDFS-1943. fail to start datanode while start-dfs.sh is executed by root user. Contributed by Wei Yongjun.

cos : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1176682
Files : 
* /hadoop/common/branches/branch-0.22/hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.22/hdfs/bin/hdfs
, Reopened for back-port to 0.20.205.1, per request from Roman Shaposhnik., This would seem to be the appropriate back-port of the one-line patch.  

Roman, can you test it please?, Matt, this works for me. Please go ahead and commit., Committed to branch-0.20-security and branch-0.20-security-205.]