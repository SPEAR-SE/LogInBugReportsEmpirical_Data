[Attached patch 001. Please review and advice, thanks.
The fix is to copy the AclFeature from the temporary root variable to {{rootDir}} of FSDirectory.
Added a test case to simulate the scenario of loading root directory's ACL from FsImage., [~xiaochen], thank you very much.  Nice catch!  The patch makes sense to me.  I'll give it a closer review tomorrow., Thank you [~cnauroth] for looking at this. I look forward to the reviews., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  18m 51s | Pre-patch trunk has 1 extant Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   8m  2s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m 23s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 25s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m 22s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 28s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 34s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   2m 27s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | native |   3m 14s | Pre-build of native portion |
| {color:green}+1{color} | hdfs tests |  51m  8s | Tests passed in hadoop-hdfs. |
| | |  98m  0s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12767705/HDFS-9273.001.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 0c4af0f |
| Pre-patch Findbugs warnings | https://builds.apache.org/job/PreCommit-HDFS-Build/13101/artifact/patchprocess/trunkFindbugsWarningshadoop-hdfs.html |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/13101/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/13101/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf900.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/13101/console |


This message was automatically generated., The Findbugs warning is not relevant., Hi [~xiaochen].  The patch looks good.  I think the test can be simplified a bit by calling the {{restart(fs, true)}} helper function, like some of the existing tests in the suite., Thanks [~cnauroth] for the review!
You are absolutely right. Attached patch 002 to address the comment., Patch v002 looks great.  I verified that the new test fails before applying the bug fix and then passes after applying it.  +1, pending a fresh Jenkins run., Thanks very much Chris for verifying the fix locally., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  22m 36s | Pre-patch trunk has 1 extant Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |  10m  9s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  12m 13s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 26s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m 39s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 38s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 37s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   2m 49s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | native |   3m 36s | Pre-build of native portion |
| {color:red}-1{color} | hdfs tests |  54m 36s | Tests failed in hadoop-hdfs. |
| | | 110m 26s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.hdfs.server.blockmanagement.TestNodeCount |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12767866/HDFS-9273.002.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 25f8f80 |
| Pre-patch Findbugs warnings | https://builds.apache.org/job/PreCommit-HDFS-Build/13116/artifact/patchprocess/trunkFindbugsWarningshadoop-hdfs.html |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/13116/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/13116/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf901.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/13116/console |


This message was automatically generated., I have committed this to trunk and branch-2.  [~xiaochen], thank you for contributing the fix., Thanks a lot Chris for reviewing and committing!, FAILURE: Integrated in Hadoop-trunk-Commit #8685 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8685/])
HDFS-9273. ACLs on root directory may be lost after NN restart. (cnauroth: rev 1b525a9c32fabd8919c80717a58afbfa7fdce27e)
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSImageWithAcl.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatPBINode.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Yarn-trunk #1302 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/1302/])
HDFS-9273. ACLs on root directory may be lost after NN restart. (cnauroth: rev 1b525a9c32fabd8919c80717a58afbfa7fdce27e)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSImageWithAcl.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatPBINode.java
, SUCCESS: Integrated in Hadoop-Yarn-trunk-Java8 #581 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/581/])
HDFS-9273. ACLs on root directory may be lost after NN restart. (cnauroth: rev 1b525a9c32fabd8919c80717a58afbfa7fdce27e)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatPBINode.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSImageWithAcl.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2513 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2513/])
HDFS-9273. ACLs on root directory may be lost after NN restart. (cnauroth: rev 1b525a9c32fabd8919c80717a58afbfa7fdce27e)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSImageWithAcl.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatPBINode.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #566 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/566/])
HDFS-9273. ACLs on root directory may be lost after NN restart. (cnauroth: rev 1b525a9c32fabd8919c80717a58afbfa7fdce27e)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatPBINode.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSImageWithAcl.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #524 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/524/])
HDFS-9273. ACLs on root directory may be lost after NN restart. (cnauroth: rev 1b525a9c32fabd8919c80717a58afbfa7fdce27e)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatPBINode.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSImageWithAcl.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2461 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2461/])
HDFS-9273. ACLs on root directory may be lost after NN restart. (cnauroth: rev 1b525a9c32fabd8919c80717a58afbfa7fdce27e)
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSImageWithAcl.java
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageFormatPBINode.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, Should this fix be included in the 2.6 / 2.7 maintenance releases? Losing ACL on restart seems pretty serious. Ping [~vinodkv] and [~sjlee0] too., bq. Should this fix be included in the 2.6 / 2.7 maintenance releases? Losing ACL on restart seems pretty serious.
Tentatively adding for 2.6.3 and 2.7.2.

[~xiaochen], [~cnauroth], know if this is this a long standing bug or broken recently?, FWIW I think it's a long-standing bug., Yes, it's long-standing, so good to bring it into the maintenance lines.  Thanks for identifying it, Andrew., Thanks Andrew for identifying this. Also thanks Chirs and Andrew for the quick response.
bq.  it's a long-standing bug.
+1 (non-binding), +1 SGTM, Backported this to 2.6.3 and 2.7.2., FAILURE: Integrated in Hadoop-trunk-Commit #8940 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8940/])
HDFS-9273. Moving to 2.6.3 CHANGES section to reflect the backport. (vinodkv: rev 9676774e233fa532c36e1ad18a41016d15be9f35)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, ABORTED: Integrated in Hadoop-Hdfs-trunk-Java8 #676 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/676/])
HDFS-9273. Moving to 2.6.3 CHANGES section to reflect the backport. (vinodkv: rev 9676774e233fa532c36e1ad18a41016d15be9f35)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
]