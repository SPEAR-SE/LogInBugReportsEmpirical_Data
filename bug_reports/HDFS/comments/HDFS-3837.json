[Patch attached. Rather than cast bpReg to DatanodeID let's just the methods DatanodeRegistration overrides from DatanodeID (but just calls the parent method anyway)., I had created HDFS-3836 for this. +1 for the patch., Integrated in Hadoop-Common-trunk-Commit #2618 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2618/])
    HDFS-3837. Fix DataNode.recoverBlock findbugs warning. Contributed by Eli Collins (Revision 1376129)

     Result = SUCCESS
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376129
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java
, Integrated in Hadoop-Hdfs-trunk-Commit #2682 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2682/])
    HDFS-3837. Fix DataNode.recoverBlock findbugs warning. Contributed by Eli Collins (Revision 1376129)

     Result = SUCCESS
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376129
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java
, Integrated in Hadoop-Mapreduce-trunk-Commit #2648 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2648/])
    HDFS-3837. Fix DataNode.recoverBlock findbugs warning. Contributed by Eli Collins (Revision 1376129)

     Result = FAILURE
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376129
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java
, Thanks Suresh.  Arg, accidentally committed before test patch came back. I'll keep an eye on the subsequent run., Integrated in Hadoop-Hdfs-trunk #1143 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1143/])
    HDFS-3837. Fix DataNode.recoverBlock findbugs warning. Contributed by Eli Collins (Revision 1376129)

     Result = FAILURE
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376129
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java
, Working on HDFS-3850 for the follow up., Re-opening this one, reverted the previous patch will post a new one., Integrated in Hadoop-Hdfs-trunk-Commit #2695 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2695/])
    Revert HDFS-3837. Fix DataNode.recoverBlock findbugs warning. (Revision 1376701)

     Result = SUCCESS
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376701
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java
, Integrated in Hadoop-Common-trunk-Commit #2631 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2631/])
    Revert HDFS-3837. Fix DataNode.recoverBlock findbugs warning. (Revision 1376701)

     Result = SUCCESS
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376701
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java
, Integrated in Hadoop-Mapreduce-trunk-Commit #2659 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2659/])
    Revert HDFS-3837. Fix DataNode.recoverBlock findbugs warning. (Revision 1376701)

     Result = FAILURE
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376701
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java
, Integrated in Hadoop-Hdfs-trunk #1144 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1144/])
    Revert HDFS-3837. Fix DataNode.recoverBlock findbugs warning. (Revision 1376701)

     Result = FAILURE
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376701
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java
, Integrated in Hadoop-Mapreduce-trunk #1175 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1175/])
    Revert HDFS-3837. Fix DataNode.recoverBlock findbugs warning. (Revision 1376701)
HDFS-3837. Fix DataNode.recoverBlock findbugs warning. Contributed by Eli Collins (Revision 1376129)

     Result = FAILURE
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376701
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1376129
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeRegistration.java
, Patch attached.

- Casts the registration to DatanodeID to avoid the warning wrt equals
- Adds an equals javadoc 
- Adds comments equals and hash methods that override DataNodeID and call back to be more explicit, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12542333/hdfs-3837.txt
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestHftpDelegationToken

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3092//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-HDFS-Build/3092//artifact/trunk/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3092//console

This message is automatically generated., Seems to me the findbugs is not fixed by the new patch or is it Jenkins error. 

Fixing this issue quickly will help. Currently all Jenkins reports have findbugs -1 for precommit tests.

{noformat}
Call to equals() comparing different types in 
org.apache.hadoop.hdfs.server.datanode.DataNode.recoverBlock(BlockRecoveryCommand$RecoveringBlock)
Bug type EC_UNRELATED_TYPES (click for details) 
In class org.apache.hadoop.hdfs.server.datanode.DataNode
In method org.apache.hadoop.hdfs.server.datanode.DataNode.recoverBlock(BlockRecoveryCommand$RecoveringBlock)
Actual type org.apache.hadoop.hdfs.protocol.DatanodeInfo
Expected org.apache.hadoop.hdfs.server.protocol.DatanodeRegistration
Value loaded from id
Value loaded from bpReg
org.apache.hadoop.hdfs.server.protocol.DatanodeRegistration.equals(Object) used to determine equality
At DataNode.java:[line 1869]
{noformat}, The findbugs warning seems bogus - "This method calls equals(Object) on two references of different class types with no common subclasses. Therefore, the objects being compared are unlikely to be members of the same class at runtime".  Both DatanodeInfo and DatanodeRegistration extend DatanodeID so they  both share the equals implementation.

Anyway, I'll put the relevant code back (cast the array) since this fixes the findbugs warning is is fine (just more verbose).

{code}
-    DatanodeID[] datanodeids = rBlock.getLocations();
+    DatanodeInfo[] targets = rBlock.getLocations();
+    DatanodeID[] datanodeids = (DatanodeID[])targets;
{code}

Updated patch, includes the comments as well so it's clear both classes are using the same equals method., If this is a findbugs issue, why not just add this to findbugs exclude?, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12542780/hdfs-3837.txt
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestHftpDelegationToken
                  org.apache.hadoop.hdfs.server.namenode.metrics.TestNameNodeMetrics

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3108//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3108//console

This message is automatically generated., I investigated some more and confirmed findbugs isn't searching back far enough for the common subclass. Eg if I swap variables in the equals call I get:

{noformat}
org.apache.hadoop.hdfs.protocol.DatanodeInfo.equals(Object) used to determine equality
org.apache.hadoop.hdfs.server.common.JspHelper$NodeRecord.equals(Object) used to determine equality
org.apache.hadoop.hdfs.server.blockmanagement.DatanodeDescriptor.equals(Object) used to determine equality
At DataNode.java:[line 1871]
{noformat}

It stops at DatanodeDescriptor#equals even though this calls super.equals (DatanodeInfo) which calls super.equals (DatanodeID). Just like the current warning stops at DatanodeRegistration#equals which calls super.equals (DatanodeID).

It would be better (and findbugs wouldn't choke) if the various classes that extend DatanodeID have a member instead. I looked at this for HDFS-3237 and it required a ton of changes that probably aren't worth it.

Given this I'll update the patch per your suggestion Surresh to ignore the warning in DataNode#recoverBlock., Updated patch attached., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12542897/hdfs-3837.txt
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestHftpDelegationToken
                  org.apache.hadoop.hdfs.server.namenode.metrics.TestNameNodeMetrics
                  org.apache.hadoop.hdfs.web.TestWebHDFS
                  org.apache.hadoop.hdfs.TestPersistBlocks

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3117//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3117//console

This message is automatically generated., Other than findbugs exclude, rest of the changes do not seem necessary or adds value. My preference is to undo it. However I do not feel strongly about this.

+1 for the patch., No problem, can always do cleanup in another change. Updated patch just does adds an exclude.

Thanks for the reviews Suresh., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12543132/hdfs-3837.txt
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.blockmanagement.TestBlocksWithNotEnoughRacks
                  org.apache.hadoop.hdfs.TestHftpDelegationToken

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3125//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3125//console

This message is automatically generated., I've committed this and merged to branch-2., Integrated in Hadoop-Hdfs-trunk #1151 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1151/])
    HDFS-3837. Fix DataNode.recoverBlock findbugs warning. Contributed by Eli Collins (Revision 1379172)

     Result = FAILURE
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1379172
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/dev-support/findbugsExcludeFile.xml
, Integrated in Hadoop-Mapreduce-trunk #1182 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1182/])
    HDFS-3837. Fix DataNode.recoverBlock findbugs warning. Contributed by Eli Collins (Revision 1379172)

     Result = SUCCESS
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1379172
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/dev-support/findbugsExcludeFile.xml
]