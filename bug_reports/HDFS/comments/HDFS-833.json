[Stacktrace

java.io.IOException: Cannot lock storage /grid/0/hudson/hudson-slave/workspace/Hadoop-Hdfs-trunk/trunk/build/test/data/dfs/name1. The directory is already locked.
	at org.apache.hadoop.hdfs.server.common.Storage$StorageDirectory.lock(Storage.java:524)
	at org.apache.hadoop.hdfs.server.namenode.FSImage.format(FSImage.java:1278)
	at org.apache.hadoop.hdfs.server.namenode.FSImage.format(FSImage.java:1301)
	at org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:1126)
	at org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:175)
	at org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:280)
	at org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:132)
	at org.apache.hadoop.hdfs.server.datanode.TestDiskError.testReplicationError(TestDiskError.java:92)
, Stacktrace of the related test:

{noformat}
java.io.IOException: Cannot lock storage ./Hadoop-HDFS/build/test/data/dfs/name1. The directory is already locked.
	at org.apache.hadoop.hdfs.server.common.Storage$StorageDirectory.lock(Storage.java:524)
	at org.apache.hadoop.hdfs.server.namenode.FSImage.format(FSImage.java:1278)
	at org.apache.hadoop.hdfs.server.namenode.FSImage.format(FSImage.java:1301)
	at org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:1126)
	at org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:175)
	at org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:280)
	at org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:132)
	at org.apache.hadoop.hdfs.server.namenode.TestFsck.testFsckError(TestFsck.java:354)
{noformat}
, TestDatanodeBlockScanner failed with this same error here:

http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/112/testReport/org.apache.hadoop.hdfs/TestDatanodeBlockScanner/testDatanodeBlockScanner/

{noformat}
2010-02-04 07:08:23,803 INFO  common.Storage (Storage.java:lock(523)) - Cannot lock storage /grid/0/hudson/hudson-slave/workspace/Hdfs-Patch-h2.grid.sp2.yahoo.net/trunk/build/test/data/dfs/name1. The directory is already locked.
{noformat}
though with no stack trace - the test eventually failed with a FileNotFoundException:

{noformat}
java.io.FileNotFoundException: http://localhost:53291/blockScannerReport?listblocks
	at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1288)
	at org.apache.hadoop.hdfs.DFSTestUtil.urlGet(DFSTestUtil.java:286)
	at org.apache.hadoop.hdfs.TestDatanodeBlockScanner.waitForVerification(TestDatanodeBlockScanner.java:70)
	at org.apache.hadoop.hdfs.TestDatanodeBlockScanner.testDatanodeBlockScanner(TestDatanodeBlockScanner.java:129)
{noformat}

(I assume because the NN got in a bad state due to locked storage), This appears to have been fixed in the interim.  Despite multiple test runs, I can't reproduce.  Closing.]