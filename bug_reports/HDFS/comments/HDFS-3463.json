[Attaching log from Jenkins build for HDFS-3368 where two tests failed because of that:
TestDatanodeBlockScanner.testBlockCorruptionRecoveryPolicy1
TestBlocksWithNotEnoughRacks.testCorruptBlockRereplicatedAcrossRacks, TestDatanodeBlockScanner.testBlockCorruptionRecoveryPolicy1 failed because DFSTestUtil.waitCorruptReplicas() reads some file 50 times and checks if the corruption is detected after each read. In the run that time was enough for the DN to restart, but not enough for NN to detect the corruption.
I see fifty "Waiting for 1 corrupt replicas", which means all 50 reads have been done, but don't see "NameSystem.addToCorruptReplicasMap:" in the log indicating that corruption was not detected., Hey Konstantin, this seems like a duplicate of HDFS-3266. Do you agree?, Agreed, these are the same. Thanks for pointing out. Feel free to close one.]