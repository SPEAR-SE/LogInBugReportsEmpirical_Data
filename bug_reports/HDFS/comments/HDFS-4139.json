[This might be related to the fact that {{rw}} still shows up in {{/proc/mounts}}:

{noformat}
$ grep fuse /proc/mounts 
none /sys/fs/fuse/connections fusectl rw,relatime 0 0
fuse_dfs /export/hdfs fuse.fuse_dfs rw,relatime,user_id=0,group_id=0,default_permissions,allow_other 0 0
{noformat}, Yes, currently we're implementing our own half-baked ro mode.  We should just use the kernel for this-- when the mount is in read-only mode, it automatically intercepts all write operations before they even get to us., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12552560/HDFS-4139.001.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3462//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3462//console

This message is automatically generated., The change seems legit. Please update with manual testing results. +1 once that's done., I tested this manually with some attempts to truncate a file, or otherwise modify the file system.  The kernel did the correct thing.  Also the FS now shows up under /proc/mounts as ro., bq. I tested this manually with some attempts to truncate a file, or otherwise modify the file system. The kernel did the correct thing.

What errno did you get? Easiest to just paste a terminal session showing the commands and error output.

bq. Also the FS now shows up under /proc/mounts as ro.

That's good, but again, please post the actual output.

Having the test commands and observed results in the bug history makes it easier for future testers to reproduce your testing., {code}
cmccabe@keter:~/hadoop3> CLASSPATH="/home/cmccabe/conf:$CLASSPATH" LIBHDFS_OPTS="-Xcheck:jni -Xcheck:nabounds" ./hadoop-hdfs-project/hadoop-hdfs/target/native/main/native/fuse-dfs/fuse_dfs -obig_writes -oro dfs://localhost:6000 /mnt/tmp/ -f
cmccabe@keter:~/conf> cat /proc/mounts | grep fuse_dfs
fuse_dfs /mnt/tmp fuse.fuse_dfs ro,nosuid,nodev,relatime,user_id=1014,group_id=100,default_permissions,allow_other 0 0
cmccabe@keter:~/conf> ls -l /mnt/tmp/foo2
-rw-r--r-- 1 cmccabe 99 47 Nov 12 11:42 /mnt/tmp/foo2
cmccabe@keter:~/conf> echo hi > /mnt/tmp/foo2
-bash: /mnt/tmp/foo2: Read-only file system
cmccabe@keter:~/conf> sudo chown root /mnt/tmp/foo2
root's password:
chown: changing ownership of `/mnt/tmp/foo2': Read-only file system
{code}, You can remove the read_only field from dfs_context now right?, Hi Eli,

I can't remove the read_only field, since that is how I determine if someone passed {{\-oro}} on the command-line., That's options#read_only, not dfs_context#read_only. I'm pretty sure the latter is dead code., yeah, you're right-- we can get rid of the entry in dfs_context_struct.  It's good to do this, because otherwise it would be misleading in the case where {{\-r}} was specified., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12553239/HDFS-4139.002.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.balancer.TestBalancer

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3492//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3492//console

This message is automatically generated., test failure is unrelated-- this has nothing to do with the balancer., +1
, I've committed this and merged to branch-2. Thanks Colin!, Integrated in Hadoop-trunk-Commit #3014 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/3014/])
    HDFS-4139. fuse-dfs RO mode still allows file truncation. Contributed by Colin Patrick McCabe (Revision 1409088)

     Result = SUCCESS
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1409088
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_context_handle.h
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_dfs.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_mkdir.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_rename.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_rmdir.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_unlink.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_init.c
, Integrated in Hadoop-Yarn-trunk #36 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/36/])
    HDFS-4139. fuse-dfs RO mode still allows file truncation. Contributed by Colin Patrick McCabe (Revision 1409088)

     Result = SUCCESS
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1409088
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_context_handle.h
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_dfs.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_mkdir.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_rename.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_rmdir.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_unlink.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_init.c
, Integrated in Hadoop-Hdfs-trunk #1226 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1226/])
    HDFS-4139. fuse-dfs RO mode still allows file truncation. Contributed by Colin Patrick McCabe (Revision 1409088)

     Result = FAILURE
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1409088
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_context_handle.h
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_dfs.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_mkdir.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_rename.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_rmdir.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_unlink.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_init.c
, Integrated in Hadoop-Mapreduce-trunk #1257 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1257/])
    HDFS-4139. fuse-dfs RO mode still allows file truncation. Contributed by Colin Patrick McCabe (Revision 1409088)

     Result = FAILURE
eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1409088
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_context_handle.h
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_dfs.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_mkdir.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_rename.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_rmdir.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_impls_unlink.c
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/native/fuse-dfs/fuse_init.c
]