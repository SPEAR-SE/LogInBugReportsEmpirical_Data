[this issue will be fixed in the trunk as part of HADOOP-5859., > this issue will be fixed in the trunk as part of HADOOP-5859.
I meant only the locking part (processDatanodeError will not hold the dataQueue lock). However, if DataStreamer#run is 
stuck in processDatanodeError forever, eventually dataQueue will be full and writeChunk will hang., I'm going to close this as stale. I suspect this issue has gone away with the two fixes referenced.]