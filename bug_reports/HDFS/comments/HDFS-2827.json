[I did not debug the issue yet. When i am testing some HA flows, met this issue.
This is looks like some path construction issue in windows. 
Currently marked it as Major. Once i confirm that this issue is fine in Linux, then i will make it as minor., Hey Uma, I confirmed that this issue does exist on Linux as well, but in doing so I also confirmed that this is not specific to the HA branch or the Standby NN. As such, I'm going to convert this to a top-level issue.

I'll attach a patch in a moment with a test case that demonstrates the issue., Test which demonstrates the issue., Thanks a lot Aaron for digging into it.
{quote}
but in doing so I also confirmed that this is not specific to the HA branch or the Standby NN. As such, I'm going to convert this to a top-level issue.
{quote}
Agree. I just filed it in HA branch because i was doing some HA flows test. This is causing checkpointing failure.

Will take a look into it.

Thanks
Uma, Here is a simple patch to handle this issue.
One extra path separator will be appended when source path parent is root directory. When forming the destination directory, substring is creating the problem due to this extra path separator., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12511688/HDFS-2827.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    -1 javadoc.  The javadoc tool appears to have generated 21 warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed unit tests in .

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/1803//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-HDFS-Build/1803//artifact/trunk/hadoop-hdfs-project/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/1803//console

This message is automatically generated., findbugs and javadoc warnings are unrelated to this patch!, Aaron, could you please take a look?, +1 good catch., Nicholas, can you give me a day to review this before commit? I'd like to take a look but don't have the time right this moment. , Integrated in Hadoop-Hdfs-trunk-Commit #1695 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1695/])
    HDFS-2827.  When the parent of a directory is the root, renaming the directory results in leases updated incorrectly.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238700
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, Integrated in Hadoop-Common-trunk-Commit #1623 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/1623/])
    HDFS-2827.  When the parent of a directory is the root, renaming the directory results in leases updated incorrectly.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238700
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, I have committed the patch to trunk and 0.23.  Thanks, Uma!
----
Hi Aaron, sorry that I did not see you message earlier.  You can still review it and, if you find any problem, please feel free to revert it.

BTW, the patch is available for more than a week and Uma has particularly asked you to take a look ..., Integrated in Hadoop-Common-0.23-Commit #452 (See [https://builds.apache.org/job/Hadoop-Common-0.23-Commit/452/])
    svn merge -c 1238700 from trunk for HDFS-2827.

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238709
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, bq. Hi Aaron, sorry that I did not see you message earlier. You can still review it and, if you find any problem, please feel free to revert it.

No biggie. I'll take a look now.

bq. BTW, the patch is available for more than a week and Uma has particularly asked you to take a look ...

Yea, Uma also emailed me offline and I told him I would take a look at it, but it wasn't my highest priority at the moment because of some deadlines I had yesterday. Hence, I had intended to look today. I probably should've said that on this JIRA. :), Integrated in Hadoop-Hdfs-0.23-Commit #443 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Commit/443/])
    svn merge -c 1238700 from trunk for HDFS-2827.

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238709
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, Aaron, thanks for your understanding.  :), Integrated in Hadoop-Mapreduce-trunk-Commit #1640 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/1640/])
    HDFS-2827.  When the parent of a directory is the root, renaming the directory results in leases updated incorrectly.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238700
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, Integrated in Hadoop-Mapreduce-0.23-Commit #467 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Commit/467/])
    svn merge -c 1238700 from trunk for HDFS-2827.

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238709
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, Integrated in Hadoop-Hdfs-trunk #943 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/943/])
    HDFS-2827.  When the parent of a directory is the root, renaming the directory results in leases updated incorrectly.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238700
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, Integrated in Hadoop-Hdfs-0.23-Build #156 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/156/])
    svn merge -c 1238700 from trunk for HDFS-2827.

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238709
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, Integrated in Hadoop-Mapreduce-0.23-Build #178 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Build/178/])
    svn merge -c 1238700 from trunk for HDFS-2827.

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238709
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, Integrated in Hadoop-Mapreduce-trunk #976 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/976/])
    HDFS-2827.  When the parent of a directory is the root, renaming the directory results in leases updated incorrectly.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1238700
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestSaveNamespace.java
, Hey Uma, I've elected not to revert the patch as-committed, since it does indeed fix the bug at hand. But, in reviewing the patch, I've come up with a number of ideas for how LeaseManager#changeLease and FSNamesystem#unprotectedChangeLease can be improved. I've filed them in this JIRA: HDFS-2875. If you would like to take up this work, that'd be great. Otherwise, hopefully someone else will improve this code when they've got some time., Sure i will take a look in some time.
And Thanks alot for taking alook. So, i am marking it as fixed., Hi Knostantin, this should be the bug in 0.22 as well.
Please check, if its worth to put in that version as well. I can post the patch., Patch for branch-1 attached. Is a straightforward backport of the trunk patch., +1, the branch-1 patch looks good to me., {noformat} 
     [exec] 
     [exec] -1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 6 new or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     -1 findbugs.  The patch appears to introduce 7 new Findbugs (version 1.3.9) warnings.
     [exec]
{noformat} 

findbugs are HADOOP-7847., Thanks for the review ATM, I've committed this to branch-1., Forgot to mention, the findbugs warnings are HADOOP-7847.]