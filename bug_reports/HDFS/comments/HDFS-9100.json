[Assigning to [~caseyjbrotherton] since he is working on it. Thanks Casey.
, Still testing in my lab.  A unit test with multiple networks is difficult.
Will change to patch-available once I finished testing, Created a multi-node cluster with multi-homed networks.

Created one of the nodes with only one ip address, on the subnet
that was not the primary network of the other hosts in the cluster.

Verified that without appropriate configuration, the lone node 
could not send data to datanodes.

Confirmed that changing dfs.client.use.datanode.hostname allowed the 
lone node to put and read from the datanodes.

Placed data within the HDFS cluster in an unbalanced way.  ( dfs.replication=1 on one datanode, 
with minimal data spread across two datanodes with dfs.replication=2)

Running the balancer from the lone node causes these errors:
15/09/23 06:07:04 WARN balancer.Dispatcher: Failed to move blk_1073742600_1776 with size=4128368 from 10.17.74.156:50010:DISK to 10.17.74.158:50010:DISK through 10.17.74.156:50010: Network is unreachable

After the changes, the balancer worked.  The logging still showed the IP address.
15/09/23 06:05:38 INFO balancer.Dispatcher: Successfully moved blk_1073742139_1315 with size=4128368 from 10.17.74.156:50010:DISK to 10.17.74.158:50010:DISK through 10.17.74.156:50010

This did not test a large environment, where blocks were moved by proxy, although I don't believe that would cause any problems.
, \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  17m 55s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | tests included |   0m  0s | The patch doesn't appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. |
| {color:red}-1{color} | javac |   7m 58s | The applied patch generated  2  additional warning messages. |
| {color:green}+1{color} | javadoc |  10m 12s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 25s | The applied patch does not increase the total number of release audit warnings. |
| {color:red}-1{color} | checkstyle |   1m 25s | The applied patch generated  1 new checkstyle issues (total was 46, now 47). |
| {color:red}-1{color} | whitespace |   0m  0s | The patch has 1  line(s) that end in whitespace. Use git apply --whitespace=fix. |
| {color:green}+1{color} | install |   1m 31s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 35s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   2m 32s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | native |   3m 20s | Pre-build of native portion |
| {color:red}-1{color} | hdfs tests | 193m 30s | Tests failed in hadoop-hdfs. |
| | | 239m 27s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.hdfs.server.namenode.TestFileTruncate |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12761884/HDFS-9100.000.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / a2c76e5 |
| javac | https://builds.apache.org/job/PreCommit-HDFS-Build/12622/artifact/patchprocess/diffJavacWarnings.txt |
| checkstyle |  https://builds.apache.org/job/PreCommit-HDFS-Build/12622/artifact/patchprocess/diffcheckstylehadoop-hdfs.txt |
| whitespace | https://builds.apache.org/job/PreCommit-HDFS-Build/12622/artifact/patchprocess/whitespace.txt |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/12622/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/12622/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf909.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/12622/console |


This message was automatically generated., Fixed the whitespace, and line length, and deprecation change, \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  18m 17s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | tests included |   0m  0s | The patch doesn't appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. |
| {color:green}+1{color} | javac |   8m  0s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m  3s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 23s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m 24s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 27s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 32s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   2m 35s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | native |   3m 14s | Pre-build of native portion |
| {color:red}-1{color} | hdfs tests | 126m 36s | Tests failed in hadoop-hdfs. |
| | | 172m 34s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.hdfs.server.namenode.TestSecondaryWebUi |
|   | hadoop.hdfs.TestHFlush |
| Timed out tests | org.apache.hadoop.hdfs.server.namenode.TestSnapshotPathINodes |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12762042/HDFS-9100.001.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 06d1c90 |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/12651/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/12651/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf903.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/12651/console |


This message was automatically generated., Hello
hdfs tests were related to hflush, and secondary namenode webui.  Both of which I didn't change.

Should I re-publish the patch to see if those tests resolve?

Thanks,
Casey, Hi [~caseyjbrotherton],

Thanks for the patch and the cluster testing. The patch looks good to me, two very minor cosmetic comments:

1. Change order of the following two lines:
{code}
import org.apache.hadoop.hdfs.client.HdfsClientConfigKeys;
import org.apache.hadoop.hdfs.DistributedFileSystem;
{code}

2. When a line is wrapped, the indention of the newline need to be 4 spaces per
the coding guideline, like:
{code}
            NetUtils.createSocketAddr(target.getDatanodeInfo().
                getXferAddr(Dispatcher.this.connectToDnViaHostname)),
                HdfsConstants.READ_TIMEOUT);
{code}

Thanks.
, Thank you for the review, [~yzhangal]

I have made the changes and uploaded a new patch file., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12764163/HDFS-9100.002.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 151fca5 |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/12727/console |


This message was automatically generated., I am sorry, the failure appears to be due to changes with HDFS-8053.

Will reapply the patch, and run tests tonight., Thanks [~caseyjbrotherton].  +1 on rev3 pending jenkins test.
, \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  18m 13s | Pre-patch trunk has 1 extant Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | tests included |   0m  0s | The patch doesn't appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. |
| {color:green}+1{color} | javac |   8m  5s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m 12s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 24s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m 24s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 27s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 34s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   2m 28s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | native |   3m 18s | Pre-build of native portion |
| {color:red}-1{color} | hdfs tests | 168m  1s | Tests failed in hadoop-hdfs. |
| | | 214m 10s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.hdfs.server.datanode.TestDirectoryScanner |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12764250/HDFS-9100.003.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 715dbdd |
| Pre-patch Findbugs warnings | https://builds.apache.org/job/PreCommit-HDFS-Build/12741/artifact/patchprocess/trunkFindbugsWarningshadoop-hdfs.html |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/12741/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/12741/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf903.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/12741/console |


This message was automatically generated., Patch is limited to Dispatcher.java 

pre-patch concerns shows something with:
org.apache.hadoop.hdfs.server.datanode.DirectoryScanner

Test log failure was with:
org.apache.hadoop.hdfs.server.datanode.TestDirectoryScanner

Not sure what the issue is.  

, Sorry for the delay, will commit momentarily.
, FAILURE: Integrated in Hadoop-trunk-Commit #8558 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8558/])
HDFS-9100. HDFS Balancer does not respect (yzhang: rev 1037ee580f87e6bf13155834c36f26794381678b)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Dispatcher.java
, I committed to trunk and branch-2. Thanks Casey for the contribution!
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #446 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/446/])
HDFS-9100. HDFS Balancer does not respect (yzhang: rev 1037ee580f87e6bf13155834c36f26794381678b)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Dispatcher.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2416 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2416/])
HDFS-9100. HDFS Balancer does not respect (yzhang: rev 1037ee580f87e6bf13155834c36f26794381678b)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Dispatcher.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #481 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/481/])
HDFS-9100. HDFS Balancer does not respect (yzhang: rev 1037ee580f87e6bf13155834c36f26794381678b)
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Dispatcher.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
, SUCCESS: Integrated in Hadoop-Yarn-trunk #1211 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/1211/])
HDFS-9100. HDFS Balancer does not respect (yzhang: rev 1037ee580f87e6bf13155834c36f26794381678b)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Dispatcher.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #473 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/473/])
HDFS-9100. HDFS Balancer does not respect (yzhang: rev 1037ee580f87e6bf13155834c36f26794381678b)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Dispatcher.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2386 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2386/])
HDFS-9100. HDFS Balancer does not respect (yzhang: rev 1037ee580f87e6bf13155834c36f26794381678b)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/balancer/Dispatcher.java
]