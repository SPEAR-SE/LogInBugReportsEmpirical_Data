[Thanks for reporting the issue Syed! Could you please detail when you noticed this issue? Perhaps steps to reproduce it (if you have them)? This line in BlockReceiver.java
{noformat}
185      if (isDatanode) { //replication or move
186        replicaHandler = datanode.data.createTemporary(storageType, block);
187      } else {
{noformat}
 was recently modified as https://issues.apache.org/jira/browse/HDFS-7496 . [~eddyxu] Do you have any ideas?, when under replicated blocks are transferring from source to destination datanode, and the destination is stopped while replicating the block, then this issue has been occured., Thanks a lot for reporting this, [~syedakram]. It looks like {{datanode.data}} has not been initialized yet before receiving WRITE_BLOCK requests.

Did you see this particular DN restarts at that time?, It was fixed in HDFS-9574.]