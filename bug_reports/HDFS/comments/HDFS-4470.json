[The impacted tests are: {{TestFileLengthOnClusterRestart}}, {{TestLargeBlock}}, {{TestListFilesInDFS}}, and {{TestRBWBlockInvalidation}}., The attached patch changes the root directory used by these tests to "/tmp/<test name>".  This prevents accidentally using an invalid ':' due to the Windows drive spec.  (See jiras HADOOP-8487 and HDFS-4260 for prior discussion and justification of this approach.)

This patch can apply to trunk and then merge to branch-trunk-win.
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12568112/HDFS-4470.1.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 5 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestQuota
                  org.apache.hadoop.cli.TestHDFSCLI

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3948//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3948//console

This message is automatically generated., The test failures are unrelated, and I suspect that they're resolved now that HDFS-4468 has been committed.  Resubmitting to Jenkins., The patch looks good. 
One minor comment: In TestListFiles, the method getTestDir() doesn't really return the test directory. Since setTestPaths() sets TEST_DIR, why not let getTestDir() checks if TEST_DIR is set. If not, it returns the default, otherwise just returns TEST_DIR. In that way, other tests can call getTestDir() to get the correct test directory. , {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12568263/HDFS-4470.1.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 5 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3953//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3953//console

This message is automatically generated., It is a very bad idea to place test data under /tmp like in /tmp/TestLargeBlock. This files are not deleted by clean target and will cause non-deterministic behaviour for tests. The idea with test.build.data property was to keep all data generated by tests under build/ or target/.
I have seen some late tests use /tmp. Lets not multiply this with this changes., It's true for local file system that cleanup can be a headache, and it doesn't have this problem as long as "/tmp" is in HDFS. , {quote}
It is a very bad idea to place test data under /tmp like in /tmp/TestLargeBlock. This files are not deleted by clean target and will cause non-deterministic behaviour for tests.

It's true for local file system that cleanup can be a headache, and it doesn't have this problem as long as "/tmp" is in HDFS.
{quote}

Yes, just to confirm, this patch does not change anything about the local file system paths used either for local file system testing or HDFS's workspace.  Running {{TestListFiles}} still uses a directory under test.build.data.  Running {{TestListFilesInDFS}}, the {{MiniDFSCluster}} instance still uses a directory under test.build.data for its working directory.  All of this still gets cleaned up by running "mvn clean".  The only thing that has changed is the HDFS file paths, because HDFS would reject a path like "C:\foo\bar".

{quote}
In TestListFiles, the method getTestDir() doesn't really return the test directory.
{quote}

Thanks for the feeback.  Here is an updated patch that changes getTestDir to return TEST_DIR.  The static initialization block guarantees that TEST_DIR always starts with a default value that uses test.build.data, so there is no need for an additional null check.  Does the new patch look good?
, {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12568307/HDFS-4470.2.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 5 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3955//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3955//console

This message is automatically generated., HDFS paths are not an issue. Looking at TestListFiles I thought this was about local. 
Indeed {{getBaseDirectory()}} is intended for local fs, so your changes make sense. I'd add the {{hdfs://}} prefix to make it explicit.
The patch looks good to me. +1, +1, the new patch looks good., I committed the patch to branch-2.

Thank you Chris. Also thanks to Konstantin and Brandon for the reviews., Integrated in Hadoop-trunk-Commit #3342 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/3342/])
    HDFS-4470. Several HDFS tests attempt file operations on invalid HDFS paths when running on Windows. Contributed by Chris Nauroth. (Revision 1443744)

     Result = SUCCESS
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1443744
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestListFiles.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestFileLengthOnClusterRestart.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestLargeBlock.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestListFilesInDFS.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/blockmanagement/TestRBWBlockInvalidation.java
, Integrated in Hadoop-Yarn-trunk #121 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/121/])
    HDFS-4470. Several HDFS tests attempt file operations on invalid HDFS paths when running on Windows. Contributed by Chris Nauroth. (Revision 1443744)

     Result = SUCCESS
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1443744
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestListFiles.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestFileLengthOnClusterRestart.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestLargeBlock.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestListFilesInDFS.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/blockmanagement/TestRBWBlockInvalidation.java
, Integrated in Hadoop-Hdfs-trunk #1310 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1310/])
    HDFS-4470. Several HDFS tests attempt file operations on invalid HDFS paths when running on Windows. Contributed by Chris Nauroth. (Revision 1443744)

     Result = FAILURE
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1443744
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestListFiles.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestFileLengthOnClusterRestart.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestLargeBlock.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestListFilesInDFS.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/blockmanagement/TestRBWBlockInvalidation.java
, Integrated in Hadoop-Mapreduce-trunk #1338 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1338/])
    HDFS-4470. Several HDFS tests attempt file operations on invalid HDFS paths when running on Windows. Contributed by Chris Nauroth. (Revision 1443744)

     Result = FAILURE
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1443744
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestListFiles.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestFileLengthOnClusterRestart.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestLargeBlock.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestListFilesInDFS.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/blockmanagement/TestRBWBlockInvalidation.java
]