[The first deletion at 251_107_213 is recorded at ExcessReplicateMap. So it does not count as a valid replica. NN still keeps it in blocksMap since NN has not received confirmation from the datanode yet.

Were the following four deletions caused by the deletion of the file? When deleting a file, NN deletes all replicas belonged to this file no matter if they are already scheduled to delete or not. I think this is a safe solution since NN has not heard any confirmation yet so NN is not sure if the replicas are indeed deleted or not., All I meant to say is that what's described in this jira is the expected behavior of dfs. It does not cause any data lose except for some harmless deletion warnings at datanodes. One improvement we could do is to make the deletion confirmation back to NN sooner. Currently it waits for the next block report to send the confirmation back. But in between a block deletion is scheduled to remove and the deletion confirmation comes back, the reported issue is likely to happen., One more note: excluding excessive replicas when counting live replicas are fixed at HADOOP-4643. If nobody against it, I will mark this issue as "not fixed"., Hairong,

If this is fixed by HADOOP-4643, can it be marked closed, or is it still a possible issue for those logs?

I'm not sure what the last message of yours meant by "not fixed". Perhaps it was "now fixed"?, Anyway, this issue is "Not A Problem" anymore.  Resolving ...]