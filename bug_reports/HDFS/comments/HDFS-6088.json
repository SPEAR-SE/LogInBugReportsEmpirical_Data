[It will be nice though if NN knows what's going on, so that block placement policy can avoid picking the full nodes.  DN could include its "free block count" in heartbeat., Any chance we could determine this automatically based on heap size? Would be nice to avoid having yet another config that users have to set., bq. Would be nice to avoid having yet another config that users have to set.
I agree.

I was looking at the heap usage of a DN. It looks like the heap usage has dropped considerably since we moved to use GSet for block map. So much so that the automatically defined GSet capacity doesn't seem to be sufficient. For example, I brought up a DN with about 62K blocks with the max heap set to 1GB.  The GSet was created for 524,288 entries.  

Looking at the heap usage, each block takes up about 315 bytes. Other parts take up less than 50MB. In any case, 315 * 524288 = 157MB.  Even if other parts take up more than expected, the node can easily store 4X of this. But storing 2M entries in the small GSet is not ideal., There are other things that can make DN run out of memory very easily.  We will probably address these issues in the next major release where many old dependencies can be updated.]