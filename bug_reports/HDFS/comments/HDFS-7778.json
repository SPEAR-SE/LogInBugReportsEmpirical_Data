[Update the patch to rename {{FsVolumeListTest}} and add it back to branch-2.

[~cnauroth] Would you mind to take a review of this?

Thank you so much!, Seems that there is more conflicts on branch-2 than simply adding the Test.

I am working on it now. I will let you know once the conflicts being resolved, [~cnauroth]. 
, Thanks for filing this jira.  The trunk patch looks good to me.

On branch-2, I suspect the conflict is related to HDFS-7430, which only targeted 3.0.0., Revised branch-2 patch. I did following changes:

1. Use {{git diff trunk -- **/FsVolumeList.java}} and etc to backport all diffs related to {{FsVolumeReference}} to branch-2 {{FsVolumeList/FsDatasetImpl/TestFsVolumeList/TestFsDatasetImpl}}.
2. Add the following line:

{code:title=FsVolumeList#addVolume()}
    IOUtils.cleanup(null, ref);
    FsDatasetImpl.LOG.info("Added new volume: " +
        ref.getVolume().getStorageID());
{code}

Since in trunk, the reference will be released in the block scanner., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12698182/HDFS-7778-branch2.000.patch
  against trunk revision 50625e6.

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9545//console

This message is automatically generated., I'm reattaching the same trunk patch, so that it gets picked up as the one with the newest timestamp for Jenkins., Hi [~eddyxu].  I think I'm fully caught up now on why there are differences between trunk and branch-2.  The branch-2 patch you posted is pulling in a piece of HDFS-7430.  That one was committed to trunk only.  I see a comment in there that the intention was to let it bake in trunk for a week or two before merging to branch-2.  I'm going to ask now if it's time to proceed with that merge.

I'd like to suggest that we put this jira on hold while we figure out the timing of the HDFS-7430 merge.  Then, I expect you'll be able to put together test-only patches (maybe even the same patch for trunk and branch-2) to do the test suite renaming.  After that, I'd proceed with rebasing HDFS-7604, again hopefully without requiring separate patches for each branch.

I'd prefer not to commit the current branch-2 patch posted here, because pulling in just a small piece of HDFS-7430 would create a confusing situation later for the full merge of HDFS-7430.

Thanks for your help on this!, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12698170/HDFS-7778-trunk.000.patch
  against trunk revision f80c988.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The following test timeouts occurred in hadoop-hdfs-project/hadoop-hdfs:

org.apache.hadoop.hdfs.web.TestWebHDFSAcl

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9544//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9544//console

This message is automatically generated., [~cnauroth] Sure. It is no problem at all. I will wait HDFS-7430 merge then., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12698233/HDFS-7778-trunk.000.patch
  against trunk revision 67efab9.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.balancer.TestBalancer

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/9551//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/9551//console

This message is automatically generated., +1 for the trunk patch.  HDFS-7430 just completed the merge to branch-2, so I went ahead and committed this to trunk, and then merged down to branch-2 so that the test is in that branch too.  [~eddyxu], thanks for the help!, FAILURE: Integrated in Hadoop-trunk-Commit #7111 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/7111/])
HDFS-7778. Rename FsVolumeListTest to TestFsVolumeList and commit it to branch-2. Contributed by Lei (Eddy) Xu. (cnauroth: rev 2efb2347a969ecff75934cd10f2432eade1d77dc)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/FsVolumeListTest.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsVolumeList.java
, Thank you so much for committing this, [~cnauroth]!, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #104 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/104/])
HDFS-7778. Rename FsVolumeListTest to TestFsVolumeList and commit it to branch-2. Contributed by Lei (Eddy) Xu. (cnauroth: rev 2efb2347a969ecff75934cd10f2432eade1d77dc)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/FsVolumeListTest.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsVolumeList.java
, FAILURE: Integrated in Hadoop-Yarn-trunk #838 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/838/])
HDFS-7778. Rename FsVolumeListTest to TestFsVolumeList and commit it to branch-2. Contributed by Lei (Eddy) Xu. (cnauroth: rev 2efb2347a969ecff75934cd10f2432eade1d77dc)
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/FsVolumeListTest.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsVolumeList.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2036 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2036/])
HDFS-7778. Rename FsVolumeListTest to TestFsVolumeList and commit it to branch-2. Contributed by Lei (Eddy) Xu. (cnauroth: rev 2efb2347a969ecff75934cd10f2432eade1d77dc)
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsVolumeList.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/FsVolumeListTest.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #105 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/105/])
HDFS-7778. Rename FsVolumeListTest to TestFsVolumeList and commit it to branch-2. Contributed by Lei (Eddy) Xu. (cnauroth: rev 2efb2347a969ecff75934cd10f2432eade1d77dc)
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/FsVolumeListTest.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsVolumeList.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2055 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2055/])
HDFS-7778. Rename FsVolumeListTest to TestFsVolumeList and commit it to branch-2. Contributed by Lei (Eddy) Xu. (cnauroth: rev 2efb2347a969ecff75934cd10f2432eade1d77dc)
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/FsVolumeListTest.java
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsVolumeList.java
, SUCCESS: Integrated in Hadoop-Hdfs-trunk-Java8 #97 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/97/])
HDFS-7778. Rename FsVolumeListTest to TestFsVolumeList and commit it to branch-2. Contributed by Lei (Eddy) Xu. (cnauroth: rev 2efb2347a969ecff75934cd10f2432eade1d77dc)
* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsVolumeList.java
* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/FsVolumeListTest.java
]