[+1, Assigning to Sam Rash, since I just made the patch based on his comment., ah, I didn't see but apparently Sam also posted a unit test here: https://issues.apache.org/jira/secure/attachment/12444747/checkLeases-fix-unit-test-1.txt

(should commit the unit test too), Here's a patch including the new unit test. Slightly edited the unit test to add synchronization around the checkLeases call - my build has assertions enabled, and it was throwing the assertion that internalReleaseLeaseOne was called w/o the FSN lock., Sam/Todd : can you pl comment on whether this bug exists in Hadoop trunk?, I think it does not - it looks like it was a regression caused by HDFS-200 in branch 20 append., Patch for 20-security., +1 for the patch. I committed it to 0.20-security branch., Closed upon release of 0.20.205.0]