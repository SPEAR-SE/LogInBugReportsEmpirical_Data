[I think should be replaced by exitIfNoStreams().
{code}
+        if (editStreams.isEmpty()) {
+          throw new IOException("no editlog streams");
+        }
{code}
Patch looks good other then that., * address Nicholas' comment (use exitIfNoStreams more consistently)

* add new unit test in TestStorageDirectoryFailure, +1 the new patch looks good.

Could you run "test-patch" and all unit tests?, Mind updating the calls to updateRemovedDirs(sd, null) to use your new method w/o 2nd param?  No need to re-run test-patch for this.

Otherwise +1, looks great. Nice find btw!, I re-ran all unit tests with this change and saw no more than the usual failures (TestCLI, TestFileAppend4, etc.).

I tried to run the test-patch script, but there seem to be a lot of environment setup issues at the moment., * use the one-argument form of FsImage#updateRemovedDirs where appropriate, I ran testpatch (sorry for the delay) and got the expected 8 warnings.  (see HADOOP-7847).  So it looks good.

C., +1  Nice work Colin!, I've committed this to branch-1 and merged for 1.0.3., Closed upon release of Hadoop-1.0.3.]