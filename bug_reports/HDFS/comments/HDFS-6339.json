[This is expected.

Upgrade/rollback with HA was not supported until 2.4. So If you are rolling back from 2.4 HA to a previous version, some manual steps are needed.  In this case, rollback needs to be done with HA off. It means that the shared edits need to be copied to non-HA name.dir or edits.dir depending on your config. If the HA NN was configured to also store edits locally, it is a bit easier.  After successfully rolling back, HA can be re-enabled by initializing shared edits dir and bootstrapping standby.  2NN does not have to persist any state, so you can safely delete the temporary files.

bq. I fixed this by deleting the JN data directory.
I assume the NN had all edits locally. Otherwise there can be data loss.  Other than this, your procedure seems okay.

In the future, please use mailing lists for the inquiries of this kind.
, Thanks a lot for your reply [~kihwal].

I was testing both cases/paths:
(non-HA, 2.2.0) -> (non-HA, 2.4.0) -> (non-HA 2.2.0)
(HA, 2.2.0) -> (HA, 2.4.0) -> (non-HA, 2.2.0) -> (HA, 2.2.0)

The issue with 2NN was noticed in cases 1. I guess I was mainly confused by the fact that start-dfs.sh does not fromat the 2NN during rollback.


Thanks for confirming my procedure. And I will use the mailing list for future questions but since you have the context here, I was hoping you could answer one more questions. In what cases, will NN not have all edits locally? Should they be available at edits.dir?]