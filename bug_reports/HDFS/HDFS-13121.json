{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zvenczel&avatarId=33404",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zvenczel&avatarId=33404",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zvenczel&avatarId=33404",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zvenczel&avatarId=33404"
            },
            "displayName": "Zsolt Venczel",
            "key": "zvenczel",
            "name": "zvenczel",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zvenczel",
            "timeZone": "Europe/Budapest"
        },
        "components": [{
            "id": "12312928",
            "name": "hdfs-client",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12312928"
        }],
        "created": "2018-02-08T01:50:02.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Gang Xie",
            "key": "xiegang112",
            "name": "xiegang112",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=xiegang112",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2018-05-16T14:01:48.038+0000",
        "customfield_12310222": "1_*:*_1_*:*_8420575503_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_4439413938",
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "5.0",
        "customfield_12310320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i3pxef:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Jul 06 22:03:11 UTC 2018",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "Recently, we hit an issue that the DFSClient throws NPE. The case is that, the app process exceeds the limit of the max open file. In the case, the libhadoop never throw and exception but return null to the request of fds. But requestFileDescriptors use the returned fds directly without any check and then NPE. \r\n\r\n \r\n\r\nWe need add a sanity check here of null pointer.\r\n\r\n \r\n\r\nprivate ShortCircuitReplicaInfo requestFileDescriptors(DomainPeer peer,\r\n Slot slot) throws IOException {\r\n ShortCircuitCache cache = clientContext.getShortCircuitCache();\r\n final DataOutputStream out =\r\n new DataOutputStream(new BufferedOutputStream(peer.getOutputStream()));\r\n SlotId slotId = slot == null ? null : slot.getSlotId();\r\n new Sender(out).requestShortCircuitFds(block, token, slotId, 1,\r\n failureInjector.getSupportsReceiptVerification());\r\n DataInputStream in = new DataInputStream(peer.getInputStream());\r\n BlockOpResponseProto resp = BlockOpResponseProto.parseFrom(\r\n PBHelperClient.vintPrefixed(in));\r\n DomainSocket sock = peer.getDomainSocket();\r\n failureInjector.injectRequestFileDescriptorsFailure();\r\n switch (resp.getStatus()) {\r\n case SUCCESS:\r\n byte buf[] = new byte[1];\r\n FileInputStream[] fis = new FileInputStream[2];\r\n {color:#d04437}sock.recvFileInputStreams(fis, buf, 0, buf.length);{color}\r\n ShortCircuitReplica replica = null;\r\n try {\r\n ExtendedBlockId key =\r\n new ExtendedBlockId(block.getBlockId(), block.getBlockPoolId());\r\n if (buf[0] == USE_RECEIPT_VERIFICATION.getNumber()) {\r\n LOG.trace(\"Sending receipt verification byte for slot {}\", slot);\r\n sock.getOutputStream().write(0);\r\n }\r\n {color:#d04437}replica = new ShortCircuitReplica(key, fis[0], fis[1], cache,{color}\r\n{color:#d04437} Time.monotonicNow(), slot);{color}",
        "duedate": null,
        "environment": null,
        "fixVersions": [
            {
                "archived": false,
                "description": "",
                "id": "12342772",
                "name": "3.2.0",
                "released": false,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342772"
            },
            {
                "archived": false,
                "description": "3.1.1 release",
                "id": "12342983",
                "name": "3.1.1",
                "releaseDate": "2018-08-07",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342983"
            },
            {
                "archived": false,
                "description": "",
                "id": "12343021",
                "name": "3.0.4",
                "released": false,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12343021"
            }
        ],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg",
            "id": "4",
            "name": "Minor",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/4"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094"
            },
            "id": "12310942",
            "key": "HDFS",
            "name": "Hadoop HDFS",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310942"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Gang Xie",
            "key": "xiegang112",
            "name": "xiegang112",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=xiegang112",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2018-07-06T22:03:11.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "NPE when request file descriptors when SC read",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2018-07-06T22:03:11.000+0000",
        "versions": [{
            "archived": false,
            "description": "3.0.0 GA release",
            "id": "12341433",
            "name": "3.0.0",
            "releaseDate": "2017-12-13",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12341433"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HDFS-13121/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HDFS-13121/watchers",
            "watchCount": 7
        },
        "workratio": -1
    },
    "id": "13137023",
    "key": "HDFS-13121",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13137023"
}