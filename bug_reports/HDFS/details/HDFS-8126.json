{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12820081","self":"https://issues.apache.org/jira/rest/api/2/issue/12820081","key":"HDFS-8126","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2015-04-10T17:19:51.442+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Apr 10 18:25:54 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_16440418_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-04-10T18:47:08.544+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8126/watchers","watchCount":3,"isWatching":false},"created":"2015-04-10T14:13:08.168+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":"hdfs ,fsck ","customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325255","id":"12325255","description":"2.3.0 release","name":"2.3.0","archived":false,"released":true,"releaseDate":"2014-02-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-11-24T19:35:18.851+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"hadoop fsck does not correctly check for corrupt blocks for a file until we try to read that file.\n\nTest steps (Followed on Cloudera CDH5.1 single node VM and Hortonworks HDP2.2 single node VM ) : \n1. Uploaded a files \"test.txt\" to /user/abc/test.txt on HDFS\n2. Ran \"hadoop fsck  /user/abc/test.txt -files -blocks \" command to check file integrity and retrieve block id.\n3. Search for the block file location  at linux filesystem level.\n4. Manually edit the block file.\n5. Re-run the fsck command \"hadoop fsck /user/abc/test.txt\".\n6. At this stage , FSCK still shows that files in HEALTHY state.\n7. Waited for more than 30 sec to re-run FSCK test and still shows healthy state.\n8. Try to read file \"hadoop fs -cat /user/abc/test.txt\" . Thsi command failes with an error of mis-match in checksum (as expected).\n9. re-run FSCK. Now FSCK show that 1 block is corrupt.\n10. Manually edit the file and restore to previous state.\n11. Try to cat file. It works.\n12. Run FSCK test. Still fails\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"hadoop fsck does not correctly check for corrupt blocks for a file","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pradeep_bhadani","name":"pradeep_bhadani","key":"pradeep_bhadani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pradeep Bhadani","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pradeep_bhadani","name":"pradeep_bhadani","key":"pradeep_bhadani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pradeep Bhadani","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820081/comment/14489697","id":"14489697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pradeep_bhadani","name":"pradeep_bhadani","key":"pradeep_bhadani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pradeep Bhadani","active":true,"timeZone":"Europe/London"},"body":"By Looking at source code of method : FSNamesystem.listCorruptFileBlocks(String path, String[] cookieTab) , it do not seems that this method try to check checksum of each block.\nPlease correct me if my understanding is wrong.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pradeep_bhadani","name":"pradeep_bhadani","key":"pradeep_bhadani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pradeep Bhadani","active":true,"timeZone":"Europe/London"},"created":"2015-04-10T14:16:02.777+0000","updated":"2015-04-10T14:16:02.777+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820081/comment/14489954","id":"14489954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello [~pradeep_bhadani].  It sounds like this is working as designed.\n\nThe fsck command does not directly verify the checksum of each block.  This would be an extremely costly operation in a large cluster with many blocks.  Instead, checksum verification occurs asynchronous of the fsck command.  This can happen either when a client attempts to read the block (as you observed in your test case) or the background block scanner thread running on each DataNode detects an invalid checksum.  The corrupt status is then recorded in the NameNode.  When the fsck command runs, it's just reporting on the state of known corrupt blocks from the NameNode.\n\nUnder default configuration, the background block scanner thread does its own checksum verification on a block every 3 weeks, so in the test case you described, the block scanner would not have had an opportunity to detect this.  However, when you attempted to read the file, this triggered an immediate checksum verification during the read, which then reported the checksum failure to the NameNode.\n\nIf this explanation makes sense, would you please close the issue?  If you still think you're seeing a bug in fsck, can you provide more details?  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-10T17:19:51.442+0000","updated":"2015-04-10T17:19:51.442+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820081/comment/14490067","id":"14490067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pradeep_bhadani","name":"pradeep_bhadani","key":"pradeep_bhadani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pradeep Bhadani","active":true,"timeZone":"Europe/London"},"body":"It make sense to run block scanner every 3weeks as it is costly operation.\n\nFSCK takes 3week old block scanner report to say about Healthiness of current state of cluster  which might not be correct (as in my test case).\n\nSo  when we prepare for cluster upgrade,  FSCK command is not enough to say that current state of system is healthy.\n\nWe can close this ticket as this was the expected behavior of FSCK..\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pradeep_bhadani","name":"pradeep_bhadani","key":"pradeep_bhadani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pradeep Bhadani","active":true,"timeZone":"Europe/London"},"created":"2015-04-10T18:25:54.354+0000","updated":"2015-04-10T18:25:54.354+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8126/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2d3qv:"}}