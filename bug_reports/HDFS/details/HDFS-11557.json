{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13057980","self":"https://issues.apache.org/jira/rest/api/2/issue/13057980","key":"HDFS-11557","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-03-27T18:32:27.553+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Mar 31 18:24:15 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-11557/watchers","watchCount":6,"isWatching":false},"created":"2017-03-21T18:42:30.534+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12333995","id":"12333995","description":"2.7.3 release","name":"2.7.3","archived":false,"released":true,"releaseDate":"2016-08-25"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-03-31T18:24:15.851+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12329603","id":"12329603","name":"hdfs"}],"timeoriginalestimate":null,"description":"To reproduce, create a directory without read and/or execute permissions (i.e. 0666, 0333, or 0222), then call delete on it with can_recurse=True. Note that the delete succeeds even though the client is unable to check for emptiness and, therefore, cannot otherwise know that any/all children are deletable.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Empty directories may be recursively deleted without being listable","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15943800","id":"15943800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~dmtucker],\n\nThis issue looks interesting. Have you got any updates on this? Do you mind I work on it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-27T18:32:27.553+0000","updated":"2017-03-27T18:32:27.553+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15945705","id":"15945705","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"body":"[~vagarychen], please, by all means! I have nothing substantial to add at the moment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-28T18:41:18.622+0000","updated":"2017-03-28T18:41:18.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15945954","id":"15945954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~dmtucker],\n\nAfter checking into the code, it turns out that if the use is a super user, the code will simply bypass the permission check. So I wonder does this issue happen if the user is not a super user?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-28T21:00:17.264+0000","updated":"2017-03-28T21:00:17.264+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15946049","id":"15946049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"body":"Indeed, I am able to reproduce with an internal Snakebite-like client and with the regular client:\n\n{code:none}\n>>> import pydoofus\n>>> super = pydoofus.namenode.v9.Client('namenode', 8020, auth={'effective_user': 'hdfs'})\n>>> client = pydoofus.namenode.v9.Client('namenode', 8020, auth={'effective_user': 'nobody'})\n>>> super.mkdirs('/test', 0777)\nTrue\n>>> client.mkdirs('/test/empty', 0222)\nTrue\n>>> client.get_listing('/test/empty')\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/usr/lib/python2.7/site-packages/pydoofus/namenode/v9.py\", line 666, in get_listing\n    self.invoke('getListing', request, response)\n  File \"/usr/lib/python2.7/site-packages/pydoofus/namenode/v9.py\", line 490, in invoke\n    blob = self.channel.receive()\n  File \"/usr/lib/python2.7/site-packages/pydoofus/namenode/v9.py\", line 310, in receive\n    raise exceptions.create_exception(err_type, err_msg, call_id, err_code)\npydoofus.exceptions.AccessControlException: ERROR_APPLICATION: Permission denied: user=nobody, access=READ_EXECUTE, inode=\"/test/empty\":nobody:supergroup:d-w--w--w-\n        at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:319)\n        at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:219)\n        at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:190)\n        at org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkPermission(FSDirectory.java:1728)\n        at org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkPermission(FSDirectory.java:1712)\n        at org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkPathAccess(FSDirectory.java:1686)\n        at org.apache.hadoop.hdfs.server.namenode.FSDirStatAndListingOp.getListingInt(FSDirStatAndListingOp.java:76)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getListing(FSNamesystem.java:4486)\n        at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getListing(NameNodeRpcServer.java:999)\n        at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.getListing(ClientNamenodeProtocolServerSideTranslatorPB.java:634)\n        at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)\n        at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:616)\n        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:982)\n        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2049)\n        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2045)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:415)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1698)\n        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2043)\n\n>>> client.delete('/test/empty', can_recurse=True)\nTrue\n{code}\n\n{code:none}\n[hdfs@rketcherside-hdponlynext-1 ~]$ hdfs dfs -mkdir /test\n[hdfs@rketcherside-hdponlynext-1 ~]$ hdfs dfs -chmod 777 /test\n[hdfs@rketcherside-hdponlynext-1 ~]$ hdfs dfs -ls /\nFound 9 items\ndrwxrwxrwx   - yarn   hadoop          0 2017-03-27 10:20 /app-logs\ndrwxr-xr-x   - hdfs   hdfs            0 2017-03-27 10:20 /apps\ndrwxr-xr-x   - yarn   hadoop          0 2017-03-27 10:20 /ats\ndrwxr-xr-x   - hdfs   hdfs            0 2017-03-27 10:20 /hdp\ndrwxr-xr-x   - mapred hdfs            0 2017-03-27 10:20 /mapred\ndrwxrwxrwx   - mapred hadoop          0 2017-03-27 10:20 /mr-history\ndrwxrwxrwx   - hdfs   hdfs            0 2017-03-28 14:55 /test\ndrwxrwxrwx   - hdfs   hdfs            0 2017-03-28 09:21 /tmp\ndrwxr-xr-x   - hdfs   hdfs            0 2017-03-28 09:21 /user\n\n[ambari-qa@rketcherside-hdponlynext-1 ~]$ hdfs dfs -mkdir /test/empty\n[ambari-qa@rketcherside-hdponlynext-1 ~]$ hdfs dfs -chmod 222 /test/empty\n[ambari-qa@rketcherside-hdponlynext-1 ~]$ hdfs dfs -ls /test/empty\nls: Permission denied: user=ambari-qa, access=READ_EXECUTE, inode=\"/test/empty\":ambari-qa:hdfs:d-w--w--w-\n[ambari-qa@rketcherside-hdponlynext-1 ~]$ hdfs dfs -rm -r /test/empty\n17/03/28 14:57:45 INFO fs.TrashPolicyDefault: Moved: 'hdfs://rketcherside-hdponlynext-1.west.isilon.com:8020/test/empty' to trash at: hdfs://rketcherside-hdponlynext-1.west.isilon.com:8020/user/ambari-qa/.Trash/Current/test/empty\n[ambari-qa@rketcherside-hdponlynext-1 ~]$ hdfs dfs -ls /test\n[ambari-qa@rketcherside-hdponlynext-1 ~]$ \n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-28T22:01:57.175+0000","updated":"2017-03-28T22:02:55.834+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15946167","id":"15946167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~dmtucker] for showing the steps! Very helpful, I did manage to reproduce the issue following these steps.\n\nAfter checking the code, I think this is because the code is written that, if the directory to be deleted is empty, the permission check is (again) bypassed. I created a file under the directory, it then prevented me from deleting the directory:\n{code}\n$ ./bin/hdfs dfs -ls /test/dir\nls: Permission denied: user=someone2, access=READ_EXECUTE, inode=\"/test/dir\":someone2:supergroup:d-w--w--w-\n$ ./bin/hdfs dfs -chmod 777 /test/dir\n$ ./bin/hdfs dfs -touchz /test/dir/file\n$ ./bin/hdfs dfs -chmod 222 /test/dir\n$ ./bin/hdfs dfs -ls /test/dir\nls: Permission denied: user=someone2, access=READ_EXECUTE, inode=\"/test/dir\":someone2:supergroup:d-w--w--w-\n$ ./bin/hdfs dfs -rm -r /test/dir\nrm: Permission denied: user=someone2, access=ALL, inode=\"/test/dir\":someone2:supergroup:d-w--w--w-\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-28T23:18:33.853+0000","updated":"2017-03-28T23:18:33.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15947894","id":"15947894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"body":"[~vagarychen], so this is a feature, not a bug?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-29T21:09:07.527+0000","updated":"2017-03-29T21:09:07.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15949564","id":"15949564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~dmtucker], I'm no expert on this code path, but given that it looks like delete dir is the only place where ignoreEmptyDir is set to true, I think this must be intentionally written (which makes this a feature), otherwise there is simply no need to even have this field.\n\n[~wheat9], do you have any comments on this? Since this code is introduced in HDFS-7573 where you are the author.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-30T18:31:42.190+0000","updated":"2017-03-30T18:34:08.683+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15949958","id":"15949958","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~dmtucker] I did another quick, I think this is consistent to the POSIX syntax. Specifically, if you just do the same thing on any POSIX OS, it would have the same behavior of bypassing the permission check for empty directory. In this case, this is definitely a feature I think.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-30T22:13:15.470+0000","updated":"2017-03-30T22:13:15.470+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15950374","id":"15950374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"body":"[~vagarychen], I believe macOS is POSIX-compliant, and this is what I see on my MacBook Pro:\n\n{code:none}\ndavid@macbook:/tmp $ ls -ld .\ndrwxrwxrwt  12 root  wheel  408 Mar 30 22:46 .\ndavid@macbook:/tmp $ mkdir foo\ndavid@macbook:/tmp $ chmod 222 foo\ndavid@macbook:/tmp $ ls -l foo\nls: foo: Permission denied\ndavid@macbook:/tmp $ rm -r foo\nrm: foo: Permission denied\ndavid@macbook:/tmp $ rmdir foo\ndavid@macbook:/tmp $ \n{code}\n\nFWIW, I have observed similar behavior on OneFS.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmtucker","name":"dmtucker","key":"dmtucker","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Tucker","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-31T05:59:23.101+0000","updated":"2017-03-31T06:00:34.341+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057980/comment/15951442","id":"15951442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"body":"Interesting to see there seems to be a difference between \"rm -r\" and \"rmdir\"...But it seem to work in my CentOS environment....\n{code}\n[testuser@c6401 ~]$ mkdir test/empty\n[testuser@c6401 ~]$ chmod 222 test/empty\n[testuser@c6401 ~]$ ls test/empty/\nls: cannot open directory test/empty/: Permission denied\n[testuser@c6401 ~]$ rm -r test/empty/\n[testuser@c6401 ~]$ ls test/\n{code}\nSo I guess this behaviour might be undefined even for Linux systems...I tracked the code a bit further, this behaviour in HDFS has been there for several years, changing this might cause compatibility issues. Also this should not cause any security concerns because this happens only when the directory is already empty. So I would prefer to just leave it like what it is now, and just be aware of this behaviour.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-31T18:24:15.851+0000","updated":"2017-03-31T18:24:15.851+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-11557/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3cldj:"}}