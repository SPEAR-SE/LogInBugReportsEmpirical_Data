{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12821551","self":"https://issues.apache.org/jira/rest/api/2/issue/12821551","key":"HDFS-8161","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-04-30T15:57:41.498+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 17 04:06:05 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8161/watchers","watchCount":17,"isWatching":false},"created":"2015-04-16T15:23:16.247+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327181","id":"12327181","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"issuelinks":[{"id":"12422322","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12422322","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12822958","key":"HDFS-8221","self":"https://issues.apache.org/jira/rest/api/2/issue/12822958","fields":{"summary":"HDFS have two Standby NNs because ActiveStandbyElectorLock ephemeralOwner in ZK is different with the sessionId stored in ZKFC","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12422472","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12422472","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12823637","key":"ZOOKEEPER-2175","self":"https://issues.apache.org/jira/rest/api/2/issue/12823637","fields":{"summary":"Checksum validation for malformed packets needs to handle.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-08-17T04:06:05.336+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12317907","id":"12317907","name":"auto-failover","description":"Automatic failover"}],"timeoriginalestimate":null,"description":"Suspected Scenario:\n================\nStart cluster with three Nodes.\nReboot Machine where ZKFC is not running..( Here Active Node ZKFC should open session with this ZK )\n\nNow  ZKFC ( Active NN's ) session expire and try re-establish connection with another ZK...Bythe time  ZKFC ( StndBy NN's ) will try to fence old active and create the active Breadcrumb and Makes SNN to active state..\n\nBut immediately it fence to standby state.. ( Here is the doubt)\n\nHence both will be in standby state..","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12725889","id":"12725889","filename":"ACTIVEBreadcumb and StandbyElector.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-16T15:34:51.660+0000","size":699,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12725889/ACTIVEBreadcumb+and+StandbyElector.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Both Namenodes are in standby State","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/14498164","id":"14498164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":" *{color:blue}ACTIVE NAMENODE ZKFC :{color}* \n======================\n\n{noformat}\n2015-04-16 11:32:36,872 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-SendThread(ZKHOST-212:24002) | Client session timed out, have not heard from server in 30015ms for sessionid 0x154cb2b3e4746ace, closing socket connection and attempting reconnect | org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1120)\n2015-04-16 11:32:36,974 | INFO  | Health Monitor for NameNode at IP-114/IP.114:25000-EventThread | Session disconnected. Entering neutral mode... | org.apache.hadoop.ha.ActiveStandbyElector.processWatchEvent(ActiveStandbyElector.java:558)\n2015-04-16 11:32:37,632 | INFO  | Health Monitor for NameNode at IP-114/IP.114:25000-SendThread(HOST-114:24002) | Client will use GSSAPI as SASL mechanism. | org.apache.zookeeper.client.ZooKeeperSaslClient$1.run(ZooKeeperSaslClient.java:285)\n2015-04-16 11:32:37,633 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-SendThread(HOST-114:24002) | Opening socket connection to server HOST-114/IP.114:24002. Will attempt to SASL-authenticate using Login Context section 'Client' | org.apache.zookeeper.ClientCnxn$SendThread.logStartConnect(ClientCnxn.java:999)\n2015-04-16 11:32:37,634 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-SendThread(HOST-114:24002) | Socket connection established to HOST-114/IP.114:24002, initiating session | org.apache.zookeeper.ClientCnxn$SendThread.primeConnection(ClientCnxn.java:854)\n2015-04-16 11:32:37,635 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-SendThread(HOST-114:24002) | Unable to reconnect to ZooKeeper service, session 0x154cb2b3e4746ace has expired, closing socket connection | org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1118)\n2015-04-16 11:32:37,636 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-EventThread | Session expired. Entering neutral mode and rejoining... | org.apache.hadoop.ha.ActiveStandbyElector.processWatchEvent(ActiveStandbyElector.java:568)\n2015-04-16 11:32:37,636 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-EventThread | Trying to re-establish ZK session | org.apache.hadoop.ha.ActiveStandbyElector.reJoinElection(ActiveStandbyElector.java:670)\n2015-04-16 11:32:37,639 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-EventThread | Initiating client connection, connectString=ZKHOST-212:24002,HOST-114:24002,HOST-117:24002 sessionTimeout=45000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@2127d120 | org.apache.zookeeper.ZooKeeper.<init>(ZooKeeper.java:438)\n2015-04-16 11:32:37,641 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-SendThread(HOST-117:24002) | Client will use GSSAPI as SASL mechanism. | org.apache.zookeeper.client.ZooKeeperSaslClient$1.run(ZooKeeperSaslClient.java:285)\n2015-04-16 11:32:37,642 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-SendThread(HOST-117:24002) | Opening socket connection to server HOST-117/IP.117:24002. Will attempt to SASL-authenticate using Login Context section 'Client' | org.apache.zookeeper.ClientCnxn$SendThread.logStartConnect(ClientCnxn.java:999)\n2015-04-16 11:32:37,642 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-SendThread(HOST-117:24002) | Socket connection established to HOST-117/IP.117:24002, initiating session | org.apache.zookeeper.ClientCnxn$SendThread.primeConnection(ClientCnxn.java:854)\n2015-04-16 11:32:37,661 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-SendThread(HOST-117:24002) | Session establishment complete on server HOST-117/IP.117:24002, sessionid = 0x174cbd419924047a, negotiated timeout = 45000 | org.apache.zookeeper.ClientCnxn$SendThread.onConnected(ClientCnxn.java:1259)\n2015-04-16 11:32:37,664 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-EventThread | EventThread shut down | org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:512)\n2015-04-16 11:32:37,666 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-EventThread | Session connected. | org.apache.hadoop.ha.ActiveStandbyElector.processWatchEvent(ActiveStandbyElector.java:547)\n2015-04-16 11:32:37,672 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-EventThread | Successfully authenticated to ZooKeeper using SASL. | org.apache.hadoop.ha.ActiveStandbyElector.processWatchEvent(ActiveStandbyElector.java:573)\n2015-04-16 11:32:37,699 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-EventThread | ZK Election indicated that NameNode at HOST-114/IP.114:25000 should become standby | org.apache.hadoop.ha.ZKFailoverController.becomeStandby(ZKFailoverController.java:488)\n2015-04-16 11:32:38,158 | INFO  | Health Monitor for NameNode at HOST-114/IP.114:25000-EventThread | Successfully transitioned NameNode at HOST-114/IP.114:25000 to standby state | org.apache.hadoop.ha.ZKFailoverController.becomeStandby(ZKFailoverController.java:493)\n{noformat}\n\n *{color:blue}STANDBY NAMENODE ZKFC:{color}* \n=========================\n2015-04-16 11:32:54,031 | INFO  | main-EventThread | Checking for any old active which needs to be fenced... | org.apache.hadoop.ha.ActiveStandbyElector.fenceOldActive(ActiveStandbyElector.java:877)\n2015-04-16 11:32:54,045 | INFO  | main-EventThread | Old node exists: 0a096861636c7573746572120232361a0d3136302d3134392d302d31313420a8c30128b7c301 | org.apache.hadoop.ha.ActiveStandbyElector.fenceOldActive(ActiveStandbyElector.java:898)\n2015-04-16 11:32:54,046 | INFO  | main-EventThread | Should fence: NameNode at HOST-114/IP.114:25000 | org.apache.hadoop.ha.ZKFailoverController.doFence(ZKFailoverController.java:517)\n2015-04-16 11:32:54,060 | INFO  | main-EventThread | Successfully transitioned NameNode at HOST-114/IP.114:25000 to standby state without fencing | org.apache.hadoop.ha.ZKFailoverController.doFence(ZKFailoverController.java:523)\n{color:red}\n2015-04-16 11:32:54,060 | INFO  | main-EventThread | Writing znode /hadoop-ha/hacluster/ActiveBreadCrumb to indicate that the local node is the most recent active... | org.apache.hadoop.ha.ActiveStandbyElector.writeBreadCrumbNode(ActiveStandbyElector.java:824)\n2015-04-16 11:32:54,073 | INFO  | main-EventThread | Trying to make NameNode at HOST-117/IP.117:25000 active... | org.apache.hadoop.ha.ZKFailoverController.becomeActive(ZKFailoverController.java:384)\n2015-04-16 11:32:56,066 | INFO  | main-EventThread | Successfully transitioned NameNode at HOST-117/IP.117:25000 to active state | org.apache.hadoop.ha.ZKFailoverController.becomeActive(ZKFailoverController.java:391)\n2015-04-16 11:32:56,070 | INFO  | main-EventThread | ZK Election indicated that NameNode at HOST-117/IP.117:25000 should become standby | org.apache.hadoop.ha.ZKFailoverController.becomeStandby(ZKFailoverController.java:488)\n2015-04-16 11:32:56,637 | INFO  | main-EventThread | Successfully transitioned NameNode at HOST-117/IP.117:25000 to standby state | org.apache.hadoop.ha.ZKFailoverController.becomeStandby(ZKFailoverController.java:493) {color}\n\n\n *Marked in red color which I had doubt..why immediately state changes to active to standby..?* ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-16T15:31:34.210+0000","updated":"2015-04-16T15:31:34.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/14498186","id":"14498186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Attached the Active Breadcumb details..\n\n\nI am thinking , following code needs to be modify...\n\n{code}\n Code code = Code.get(rc);\n    if (isSuccess(code)) {\n      // we successfully created the znode. we are the leader. start monitoring\n      if (becomeActive()) {\n        monitorActiveStatus();\n      } else {\n        reJoinElectionAfterFailureToBecomeActive();\n      }\n      return;\n    }\n\n    if (isNodeExists(code)) {\n      if (createRetryCount == 0) {\n        // znode exists and we did not retry the operation. so a different\n        // instance has created it. become standby and monitor lock.\n        becomeStandby();\n      }\n      // if we had retried then the znode could have been created by our first\n      // attempt to the server (that we lost) and this node exists response is\n      // for the second attempt. verify this case via ephemeral node owner. this\n      // will happen on the callback for monitoring the lock.\n      monitorActiveStatus();\n      return;\n    }\n{code}\n\n\nAny pointers to this issue..?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-16T15:38:00.139+0000","updated":"2015-04-16T15:38:00.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/14502500","id":"14502500","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"AS there is already {{/hadoop-ha/hacluster/ActiveStandbyElectorLock}} exists  with different session id ( It might be created by another ZKFC in same machine or ..)..Hence ZKFC immediately called become standby once after it's written {{/hadoop-ha/hacluster/ActiveBreadCrumb}}...\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-20T08:29:24.060+0000","updated":"2015-04-20T08:29:24.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/14510368","id":"14510368","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"As session id got corrupted and ZKFC received different session id ( described in  ZOOKEEPER-2175 )..It's not able to get the lock on {{/hadoop-ha/hacluster/ActiveStandbyElectorLock}} .. Hence both ZKFC's are not able got lock, both NN's are in standby..\n\nRaised issue in ZK community for checksum validation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-24T02:30:12.657+0000","updated":"2015-04-24T02:30:12.657+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/14521064","id":"14521064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"[~vinayrpet] , [~jnp] and [~arpitagarwal] any thoughts on this..? \nAs there is no checksum verification from the ZK Side and seems to be no one interested in checksum feature in ZK side (since I  did not seen any comment in ZOOKEEPER-2175 ),Can we have some mechanism here..?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-30T07:32:12.762+0000","updated":"2015-04-30T07:32:12.762+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/14521718","id":"14521718","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~brahmareddy], this is excellent debugging.  Thank you for posting the information!\n\nI have commented on ZOOKEEPER-2175.  They suspect their new wire encryption feature would catch a packet corruption issue like this.  I've also proposed a ZooKeeper feature for checksum validation even when wire encryption is not used.  (I think we'd have little motivation to use wire encryption for the HDFS HA use case, since the data we store in the znode isn't a secret.)\n\nMeanwhile, I'm wondering if there is something we can change in Hadoop code to make ourselves more resilient to this.  The HDFS logic in this area is driven by ZooKeeper status code checks like the following in {{ActiveStandbyElector}}:\n\n{code}\n  private static boolean isSuccess(Code code) {\n    return (code == Code.OK);\n  }\n{code}\n\nI'm wondering if we can check for a specific ZooKeeper client status code, and then reconnect our session and retry taking the lock instead of transitioning to standby.  Do you know if there was a particular ZooKeeper status code that you saw when this happened?  Do you have the capability to repro consistently?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-30T15:57:41.498+0000","updated":"2015-04-30T15:57:41.498+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/14522555","id":"14522555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks a lot [~cnauroth] looking into this issue. \n\nYes, we should make ourselves more resilient on this..\n\n{quote}Do you know if there was a particular ZooKeeper status code that you saw when this happened?{quote}\nI am not sure,Status might be \"OK\", same I will confirm..\n{quote}\nDo you have the capability to repro consistently?\n{quote}\nIt's hard to reproduce but I can,I will try on next monday and post..\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-05-01T00:36:02.143+0000","updated":"2015-05-01T00:36:02.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/15229795","id":"15229795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"body":"Any progress? I saw the same issue on 2.7.1. Or any suggestion to fix this issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-07T06:44:09.960+0000","updated":"2016-04-07T06:44:09.960+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/15229865","id":"15229865","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi [~johnjianfang] \n\nThis particular case was caused by ZOOKEEPER-2175.\nIf your case also similar to this, then have to wait till ZOOKEEPER-2175 makes some progress","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-04-07T07:59:59.978+0000","updated":"2016-04-07T07:59:59.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/15243980","id":"15243980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"body":"[~brahmareddy] - was this encountered on virtual machine hosts, or physical ones? Asking because https://tech.vijayp.ca/linux-kernel-bug-delivers-corrupt-tcp-ip-data-to-mesos-kubernetes-docker-containers-4986f88f7a19#.v3hx212ne (H/T [~daisuke.kobayashi])","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-04-16T03:26:22.466+0000","updated":"2016-04-16T03:26:49.072+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/15245051","id":"15245051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Its happened in physical machines.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-04-18T02:04:22.957+0000","updated":"2016-04-18T02:04:22.957+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/15421966","id":"15421966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vincentsmh","name":"vincentsmh","key":"vincentsmh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vincent Huang","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\nEvery time I restart NameNode due to the config change, I hit two standby state. A solution is to delete /hadoop-ha/ha/ActiveBreadCrumb and /hadoop-ha/ha/ActiveStandbyElectorLock in Zookeeper after restarting NameNode.\n\nMaybe you can consider to add the specific zk node deleting in the restarting procedure.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vincentsmh","name":"vincentsmh","key":"vincentsmh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vincent Huang","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-16T00:40:47.514+0000","updated":"2016-08-16T00:40:47.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/15422149","id":"15422149","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"bq. Every time I restart NameNode due to the config change, I hit two standby state.\n\nIdeally this should not happen.. can you look at ZKFC logs..? might be some config missed...Please have look at [here | https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html] for detailed configurations..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-08-16T04:24:46.325+0000","updated":"2016-08-16T04:24:46.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12821551/comment/15423847","id":"15423847","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vincentsmh","name":"vincentsmh","key":"vincentsmh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vincent Huang","active":true,"timeZone":"Etc/UTC"},"body":"Sorry, I forgot to mention the precondition. I had moved one NameNode and zookeeper to the other node (original node is dead) and then restart both NameNode.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vincentsmh","name":"vincentsmh","key":"vincentsmh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vincent Huang","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-17T04:06:05.336+0000","updated":"2016-08-17T04:06:05.336+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8161/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2dcmf:"}}