{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12664945","self":"https://issues.apache.org/jira/rest/api/2/issue/12664945","key":"HDFS-5125","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2013-08-22T00:01:07.039+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 22 18:57:10 UTC 2013","customfield_12310420":"344887","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_65068274_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-08-22T17:59:39.444+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-5125/watchers","watchCount":4,"isWatching":false},"created":"2013-08-21T23:55:11.205+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324809","id":"12324809","description":"2.1.1-beta release","name":"2.1.1-beta","archived":false,"released":true,"releaseDate":"2013-09-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335732","id":"12335732","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"issuelinks":[{"id":"12374219","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12374219","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12664565","key":"HADOOP-9887","self":"https://issues.apache.org/jira/rest/api/2/issue/12664565","fields":{"summary":"globStatus does not correctly handle paths starting with a drive spec on Windows","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12374193","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12374193","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12664565","key":"HADOOP-9887","self":"https://issues.apache.org/jira/rest/api/2/issue/12664565","fields":{"summary":"globStatus does not correctly handle paths starting with a drive spec on Windows","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12374180","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12374180","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"inwardIssue":{"id":"12663898","key":"HADOOP-9877","self":"https://issues.apache.org/jira/rest/api/2/issue/12663898","fields":{"summary":"Fix listing of snapshot directories in globStatus","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-12T18:12:09.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312916","id":"12312916","name":"test"}],"timeoriginalestimate":null,"description":"This test calls the {{CreateEditsLog}} tool, then runs {{globStatus}} on the local file system to find the resulting files before moving them to a directory where a NameNode can start up and read them.  The HADOOP-9877 patch has caused this test to start failing on Windows due to internal calls to {{FileContext#getFileLinkStatus}} rejecting the {{Path}} arguments.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324809","id":"12324809","description":"2.1.1-beta release","name":"2.1.1-beta","archived":false,"released":true,"releaseDate":"2013-09-16"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"345188","customfield_12312823":null,"summary":"TestCreateEditsLog#testCanLoadCreatedEditsLog fails on Windows in globStatus","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747052","id":"13747052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Here is the test failure and stack trace.  I was running with a small code change in {{Path}} to embed the offending URI in the exception message.\n\n{code}\nRunning org.apache.hadoop.hdfs.server.namenode.TestCreateEditsLog\nTests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 2.108 sec <<< FAILURE!\ntestCanLoadCreatedEditsLog(org.apache.hadoop.hdfs.server.namenode.TestCreateEditsLog)  Time elapsed: 1874 sec  <<< ERROR!\norg.apache.hadoop.HadoopIllegalArgumentException: Unsupported name: has scheme but relative path-part, uri = file:/C:\n        at org.apache.hadoop.fs.Path.checkNotSchemeWithRelative(Path.java:67)\n        at org.apache.hadoop.fs.FileContext.getFSofPath(FileContext.java:303)\n        at org.apache.hadoop.fs.FSLinkResolver.resolve(FSLinkResolver.java:85)\n        at org.apache.hadoop.fs.FileContext.getFileLinkStatus(FileContext.java:1129)\n        at org.apache.hadoop.fs.Globber.getFileLinkStatus(Globber.java:70)\n        at org.apache.hadoop.fs.Globber.glob(Globber.java:223)\n        at org.apache.hadoop.fs.FileContext$Util.globStatus(FileContext.java:1908)\n        at org.apache.hadoop.hdfs.server.namenode.TestCreateEditsLog.testCanLoadCreatedEditsLog(TestCreateEditsLog.java:84)\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-21T23:55:50.597+0000","updated":"2013-08-21T23:55:50.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747054","id":"13747054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~decster], would you be able to look at this since it was introduced by HADOOP-9877?  The actual logic of {{TestCreateEditsLog}} is probably less interesting than the way it's using {{globStatus}}, which may indicate that we should add a new unit test in Hadoop Common to try to catch problems with this usage earlier.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-21T23:57:10.933+0000","updated":"2013-08-21T23:57:10.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747060","id":"13747060","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"body":"Sure, thanks for finding this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-08-22T00:01:07.039+0000","updated":"2013-08-22T00:01:07.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747348","id":"13747348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~cnauroth],\n\n{code}\n  private static final Pattern hasDriveLetterSpecifier =\n      Pattern.compile(\"^/?[a-zA-Z]:\");\n\n  private static boolean hasWindowsDrive(String path) {\n    return (WINDOWS && hasDriveLetterSpecifier.matcher(path).find());\n  }\n\n  public boolean isUriPathAbsolute() {\n    int start = hasWindowsDrive(uri.getPath()) ? 3 : 0;\n    return uri.getPath().startsWith(SEPARATOR, start);\n   }\n{code}\n\nI suspect Path.isUriPathAbsolute may be flawed:\n\n1. \"file:/C:\" should be a absolute directory, right? but without ending \"/\", uri.getPath().startsWith(SEPARATOR, start) will yield false\n2. Another issue is probably not relevant to this bug, but still a problem:\n   hasDriveLetterSpecifier allow first \"/\" to be skiped, but the code \"int start = hasWindowsDrive(uri.getPath()) ? 3 : 0;\" always assume first \"/\" exists. \n\nAnyway, I can provide a patch first to try to solve this according my thoughts, but I don't have a windows environment to test this.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-08-22T08:00:12.865+0000","updated":"2013-08-22T08:00:12.865+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747364","id":"13747364","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"body":"Sorry, after reading more related code, it looks like the convention is: \"/C:\" should be relative path and \"/C:/\" should be absolute. \nglobStatus try each component using getFileLinks status without \"/\" suffix, which leads to the exception thrown.\n\nI think this behavior is really confusing in many ways:\n1. if \"/C:\" is relative, which path is it relative to? If it is workingDir, what if working dir is at another drive? For example: \"/D:/foo\".\n2. if \"xxx/foo\" is absolute, we can no longer assume \"xxx\" is absolute.\n\nIs any reason or benefit of making \"/X:\" relative?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-08-22T08:34:54.158+0000","updated":"2013-08-22T08:34:54.158+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747378","id":"13747378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"body":"Looks like the same reason caused HADOOP-9887","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-08-22T08:56:15.442+0000","updated":"2013-08-22T08:56:15.442+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747555","id":"13747555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~cnauroth], can you verify the patch in HADOOP-9887 can fix this test failure?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-08-22T14:26:12.985+0000","updated":"2013-08-22T14:26:12.985+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747725","id":"13747725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Chris Nauroth, can you verify the patch in HADOOP-9887 can fix this test failure?\n\nAh, you're absolutely right.  HADOOP-9887 fixes it.  I really should have thought to try that first, considering I'm the reviewer on HADOOP-9887.  :-)\n\nThank you for investigating, Binglin, and I hope this didn't waste too much of your time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-22T17:59:39.462+0000","updated":"2013-08-22T17:59:39.462+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747737","id":"13747737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Also, just to follow up on some questions:\n\nbq. if \"/C:\" is relative, which path is it relative to? If it is workingDir, what if working dir is at another drive? For example: \"/D:/foo\".\n\n\"/C:\" is relative, because we need to match the behavior of the local file system on Windows.  On Windows, accessing the bare drive specifier accesses the current working directory of the drive, and each drive can have a distinct current working directory.  Since the meaning of \"C:\" or \"D:\" changes as the current working directory changes, the path is considered relative.  See below for a full example of how this works in the shell.\n\nbq. hasDriveLetterSpecifier allow first \"/\" to be skiped, but the code \"int start = hasWindowsDrive(uri.getPath()) ? 3 : 0;\" always assume first \"/\" exists.\n\nWhat is confusing about this is that path strings can enter the {{Path}} class either with or without the leading '/' before the drive spec, so the regex needs to handle both.  Then, after the path string gets translated to a {{URI}} internally, the leading '/' is guaranteed to be in the URI.  I believe the current code in {{Path#isUriPathAbsolute}} is correct, because this code only runs after the internal translation to {{URI}}.\n\n{code}\nC:\\>cd C:\\foo\n\nC:\\foo>dir C:\n Volume in drive C has no label.\n Volume Serial Number is C2FC-F17C\n\n Directory of C:\\foo\n\n08/22/2013  06:00 PM    <DIR>          .\n08/22/2013  06:00 PM    <DIR>          ..\n               0 File(s)              0 bytes\n               2 Dir(s)  14,801,162,240 bytes free\nC:\\foo>cd C:\\bar\n\nC:\\bar>dir C:\n Volume in drive C has no label.\n Volume Serial Number is C2FC-F17C\n\n Directory of C:\\bar\n\n08/22/2013  06:00 PM    <DIR>          .\n08/22/2013  06:00 PM    <DIR>          ..\n               0 File(s)              0 bytes\n               2 Dir(s)  14,801,162,240 bytes free\nC:\\bar>cd D:\\baz\n\nC:\\bar>dir D:\n Volume in drive D is Temporary Storage\n Volume Serial Number is B28B-7C3C\n\n Directory of D:\\baz\n\n08/22/2013  06:00 PM    <DIR>          .\n08/22/2013  06:00 PM    <DIR>          ..\n               0 File(s)              0 bytes\n               2 Dir(s)  298,357,399,552 bytes free\nC:\\bar>cd D:\\buz\n\nC:\\bar>dir D:\n Volume in drive D is Temporary Storage\n Volume Serial Number is B28B-7C3C\n\n Directory of D:\\buz\n\n08/22/2013  06:00 PM    <DIR>          .\n08/22/2013  06:00 PM    <DIR>          ..\n               0 File(s)              0 bytes\n               2 Dir(s)  298,357,399,552 bytes free\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-22T18:13:27.555+0000","updated":"2013-08-22T18:13:27.555+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747759","id":"13747759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"body":"bq. each drive can have a distinct current working directory\nDoes this mean we need more than one curWorkingDirectory to support the right behavior on Windows? But currently the API only support one workingDir.\n\nbq. I believe the current code in Path#isUriPathAbsolute is correct\nThanks for the explanation, I checked the code logic, indeed it is correct, but I think it is still better to eliminate hard coded \"? 3 : 0\"s, right?\nI refactored the code in part of HADOOP-9897.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=decster","name":"decster","key":"decster","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Binglin Chang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-08-22T18:40:12.639+0000","updated":"2013-08-22T18:40:12.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12664945/comment/13747772","id":"13747772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Does this mean we need more than one curWorkingDirectory to support the right behavior on Windows?\n\nNo, there is still one and only one current working directory for the running process, so there is no ambiguity about a relative path like \"dir1\\dir2\\file3\".  The per-drive location is an additional thing that only comes up when you start using paths that contain a drive spec, like \"C:\" or \"D:\", or even \"D:foo.txt\" which means \"foo.txt in whatever is the current folder of D\".  This definitely took me some getting used to when transitioning from Linux.  :-)\n\nbq. I refactored the code in part of HADOOP-9897.\n\nThanks!  That makes sense.  I'll take a look.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-22T18:57:10.591+0000","updated":"2013-08-22T18:57:10.591+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-5125/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1nh3z:"}}