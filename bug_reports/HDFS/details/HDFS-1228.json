{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12467160","self":"https://issues.apache.org/jira/rest/api/2/issue/12467160","key":"HDFS-1228","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2011-03-24T05:35:34.436+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 30 20:26:04 UTC 2014","customfield_12310420":"15915","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_130003319552_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-07-30T20:26:04.597+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1228/watchers","watchCount":4,"isWatching":false},"created":"2010-06-17T04:24:05.083+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315103","id":"12315103","description":"Append/sync support for Hadoop 0.20","name":"0.20-append","archived":true,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-07-30T20:26:04.631+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312927","id":"12312927","name":"datanode"}],"timeoriginalestimate":null,"description":"- Summary: when appending to partial block, if is possible that\nretrial when facing an exception fails due to a checksum mismatch.\nAppend operation is not atomic (either complete or fail completely).\n \n- Setup:\n+ # available datanodes = 2\n+# disks / datanode = 1\n+ # failures = 1\n+ failure type = bad disk\n+ When/where failure happens = (see below)\n \n- Details:\nClient writes 16 bytes to dn1 and dn2. Write completes. So far so good.\nThe meta file now contains: 7 bytes header + 4 byte checksum (CK1 -\nchecksum for 16 byte) Client then appends 16 bytes more, and let assume there is an\nexception at BlockReceiver.receivePacket() at dn2. So the client knows dn2\nis bad. BUT, the append at dn1 is complete (i.e the data portion and checksum portion\nhas been made to disk to the corresponding block file and meta file), meaning that the\nchecksum file at dn1 now contains 7 bytes header + 4 byte checksum (CK2 - this is\nchecksum for 32 byte data). Because dn2 has an exception, client calls recoverBlock and\nstarts append again to dn1. dn1 receives 16 byte data, it verifies if the pre-computed\ncrc (CK2) matches what we recalculate just now (CK1), which obviously does not match.\nHence an exception and retrial fails.\n \n- a similar bug has been reported at\nhttps://issues.apache.org/jira/browse/HDFS-679\nbut here, it manifests in different context.\n\nThis bug was found by our Failure Testing Service framework:\nhttp://www.eecs.berkeley.edu/Pubs/TechRpts/2010/EECS-2010-98.html\nFor questions, please email us: Thanh Do (thanhdo@cs.wisc.edu) and \nHaryadi Gunawi (haryadi@eecs.berkeley.edu)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"113403","customfield_12312823":null,"summary":"CRC does not match when retrying appending a partial block","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thanhdo","name":"thanhdo","key":"thanhdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thanhdo&avatarId=22565","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thanhdo&avatarId=22565","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thanhdo&avatarId=22565","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thanhdo&avatarId=22565"},"displayName":"Thanh Do","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thanhdo","name":"thanhdo","key":"thanhdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thanhdo&avatarId=22565","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thanhdo&avatarId=22565","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thanhdo&avatarId=22565","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thanhdo&avatarId=22565"},"displayName":"Thanh Do","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467160/comment/13010564","id":"13010564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeepp","name":"sandeepp","key":"sandeepp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sandeep","active":true,"timeZone":"Etc/UTC"},"body":"Please check the scenario where CRC Comparision fails:\n======================================================\n1)create a file of 512bytes 2)now try appending some more content to the file\n3)just append 2 bytes and call sync  4)Again append 2 more bytes and call syn\nBut this time sync will fail throwing this exception\n\n2011-03-12 20:28:37,671 ERROR datanode.DataNode (DataXceiver.java:run(131)) - DatanodeRegistration(10.18.52.116:50010, storageID=DS-1547254589-10.18.52.116-50010-1299941311942, infoPort=50075, ipcPort=50020):DataXceiver\njava.io.IOException: Partial CRC 3835263025 does not match value computed the  last time file was closed 2082103828\n\tat org.apache.hadoop.hdfs.server.datanode.BlockReceiver.computePartialChunkCrc(BlockReceiver.java:692)\n\tat org.apache.hadoop.hdfs.server.datanode.BlockReceiver.setBlockPosition(BlockReceiver.java:632)\n\tat org.apache.hadoop.hdfs.server.datanode.BlockReceiver.receivePacket(BlockReceiver.java:400)\n\tat org.apache.hadoop.hdfs.server.datanode.BlockReceiver.receiveBlock(BlockReceiver.java:533)\n\tat org.apache.hadoop.hdfs.server.datanode.DataXceiver.writeBlock(DataXceiver.java:358)\n\tat org.apache.hadoop.hdfs.server.datanode.DataXceiver.run(DataXceiver.java:103)\n\tat java.lang.Thread.run(Thread.java:619)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeepp","name":"sandeepp","key":"sandeepp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sandeep","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-24T05:35:34.436+0000","updated":"2011-03-24T05:35:34.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467160/comment/13010565","id":"13010565","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeepp","name":"sandeepp","key":"sandeepp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sandeep","active":true,"timeZone":"Etc/UTC"},"body":"Correction for the above comment:\n=================================\nWe should create a file of 1)create a file of 513 bytes (it should not be a multiple of 512)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeepp","name":"sandeepp","key":"sandeepp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sandeep","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-24T05:48:07.943+0000","updated":"2011-03-24T05:48:07.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467160/comment/13031198","id":"13031198","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ram_krish","name":"ram_krish","key":"ram_krish","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ramkrishna.s.vasudevan","active":true,"timeZone":"Asia/Kolkata"},"body":"I have created the patch for the same.\n\nI would like to submit\nKindly let me know if i can go forward","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ram_krish","name":"ram_krish","key":"ram_krish","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ramkrishna.s.vasudevan","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-05-10T14:03:59.830+0000","updated":"2011-05-10T14:03:59.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467160/comment/14079910","id":"14079910","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"body":"append got overhauled in 2.x. Closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"created":"2014-07-30T20:26:04.626+0000","updated":"2014-07-30T20:26:04.626+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1228/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jrlz:"}}