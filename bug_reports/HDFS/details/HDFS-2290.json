{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12520221","self":"https://issues.apache.org/jira/rest/api/2/issue/12520221","key":"HDFS-2290","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314241","id":"12314241","description":"","name":"0.22.0","archived":false,"released":true,"releaseDate":"2011-12-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315571","id":"12315571","description":"","name":"0.23.0","archived":false,"released":true,"releaseDate":"2011-11-11"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-08-26T16:43:36.094+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Sep 25 13:23:11 UTC 2011","customfield_12310420":"1805","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_213989762_*|*_1_*:*_1_*:*_2320030442_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-09-24T15:20:43.146+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-2290/watchers","watchCount":12,"isWatching":false},"created":"2011-08-26T07:27:03.010+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["blockmanagement","replication"],"customfield_12312333":null,"customfield_12310230":"replication, block managmenet","customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314241","id":"12314241","description":"","name":"0.22.0","archived":false,"released":true,"releaseDate":"2011-12-10"}],"issuelinks":[{"id":"12353248","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12353248","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12559116","key":"HDFS-3493","self":"https://issues.apache.org/jira/rest/api/2/issue/12559116","fields":{"summary":"Invalidate excess corrupted blocks as long as minimum replication is satisfied","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-03-16T17:44:42.272+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"A block has one replica marked as corrupt and two good ones. countNodes() correctly detects that there are only 2 live replicas, and fsck reports the block as under-replicated. But ReplicationMonitor never schedules replication of good replicas.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12495260","id":"12495260","filename":"HDFS-2290_0.22.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-20T19:17:08.278+0000","size":13566,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12495260/HDFS-2290_0.22.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12495162","id":"12495162","filename":"HDFS-2290_022.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-19T23:11:28.475+0000","size":13615,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12495162/HDFS-2290_022.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12494708","id":"12494708","filename":"HDFS-2290_022.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-15T21:57:56.157+0000","size":13337,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12494708/HDFS-2290_022.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12496300","id":"12496300","filename":"HDFS-2290_trunk.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-23T18:27:24.928+0000","size":13751,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12496300/HDFS-2290_trunk.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12496065","id":"12496065","filename":"HDFS-2290_trunk.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-09-22T03:51:38.173+0000","size":13757,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12496065/HDFS-2290_trunk.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"52974","customfield_12312823":null,"summary":"Block with corrupt replica is not getting replicated","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13091657","id":"13091657","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"h3. Steps to reproduce:\n- Start a cluster with 3 DataNodes. I run it on one box, and I accelerate block reports, so that each DN sends them every 3 minutes. \n- Create several files.\n- Open data-node storage directory {{data/current/finalised}}, which holds block files and remove file blk_*.meta for one of the blocks.\n- The block will be reported to the NameNode as corrupt.\n- Run fsck or -metasave to see the block is under-replicated. And this never changes. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-26T07:36:37.307+0000","updated":"2011-08-26T07:36:37.307+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13091668","id":"13091668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"*The correct behavior* should be that NN replicates the block using one of the good replica, and then deletes the corrupt replica. So there are 2 steps:\n# replicating a good replica\n# deleting the corrupt replica when the block is fully replicated\n\nReplication is handled by ReplicationMonitor, which replicates blocks from {{neededReplications}} list. It seems that while processing corrupt replicas we somehow miss to put them into {{neededReplications}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-26T07:57:36.049+0000","updated":"2011-08-26T07:57:36.049+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13091865","id":"13091865","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Hasn't this always been the case, that if there's a machine with a corrupt replica, it shouldn't be a target for the new replica? That is to say, the DN can't accept a new replica of the same block before it has deleted the old one?\n\nIf you start a 4th DN in the cluster, does replication proceed?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2011-08-26T16:43:36.094+0000","updated":"2011-08-26T16:43:36.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13091887","id":"13091887","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Good point. Let me try that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-26T17:22:14.222+0000","updated":"2011-08-26T17:22:14.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13092134","id":"13092134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Two things.\n# Setting replication to 2 for the corrupt file on 3-node cluster in a hope that the corrupt replica will be removed and I'll set replication back to 3. fsck shows healthy file, but NN does not even try to delete the corrupt replica. The DN keeps reporting the corrupt replica, and when I set replication back to 3, I end up where I started. \nThe general problem seems to be that NN does not schedule deletion of corrupt replicas when you lower the replication of the block.\n# Starting 4th DN. Replication is triggered as expected, and then removal of the corrupt replica is scheduled, but the latter fails with the following exception:\n{code}\n11/08/26 16:19:38 WARN datanode.DataNode: Unexpected error trying to delete block blk_-4767793772698703708_1816. BlockInfo not found in volumeMap.\n11/08/26 16:19:38 WARN datanode.DataNode: Error processing datanode Command\njava.io.IOException: Error in deleting blocks.\n\tat org.apache.hadoop.hdfs.server.datanode.FSDataset.invalidate(FSDataset.java:1681)\n\tat org.apache.hadoop.hdfs.server.datanode.DataNode.processCommand(DataNode.java:1021)\n\tat org.apache.hadoop.hdfs.server.datanode.DataNode.processCommand(DataNode.java:983)\n\tat org.apache.hadoop.hdfs.server.datanode.DataNode.offerService(DataNode.java:920)\n\tat org.apache.hadoop.hdfs.server.datanode.DataNode.run(DataNode.java:1439)\n\tat java.lang.Thread.run(Unknown Source){code}\n{code}\nI think DN can ignore the absence of metadata file if it is deleting it anyways.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-26T23:38:43.268+0000","updated":"2011-08-26T23:38:43.268+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13092138","id":"13092138","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Actually, in case (2) it does not get to deletion of meta-file. The block is not in the volume map, but it is still reported by DN on block reports.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-26T23:50:00.465+0000","updated":"2011-08-26T23:50:00.465+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13092145","id":"13092145","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Bumping this to blocker. Nice find - I'm surprised we don't have more tests for this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2011-08-27T00:17:00.099+0000","updated":"2011-08-27T00:17:00.099+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13104804","id":"13104804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"There is a bug in BlockManager (NameNode) which prevents the namenode from adding the corrupt block to the list of blocks of be invalidated. \n\nThe following snippet is from BlockManager.markBlockAsCorrupt () \n\n   if (countNodes(storedBlock).liveReplicas() > inode.getReplication()) { \n      // the block is over-replicated so invalidate the replicas immediately \n      invalidateBlock(storedBlock, node); \n    } else { \n      // add the block to neededReplication \n      updateNeededReplications(storedBlock, -1, 0); \n    } \n\nIf the replication factor for the file is 2 and the number of good replicas is 2, the above condition still will NOT invalidate the block. This condition should be changed to \n\n if (countNodes(storedBlock).liveReplicas() >= inode.getReplication()) { ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-14T19:25:49.370+0000","updated":"2011-09-14T19:25:49.370+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13104806","id":"13104806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"Once the above change is made, the NN will replicate the block and if the block is replicated, then DN will get the command to delete the corrupt replica. The Deletion by DN will still fail with the exception specified in the previous comments. This is because the generationstamp of the block is 0 on datanode and will be different from the generationstamp send by the NN. \n\nOne way to fix will be to NOT compare the generationstamp since the block is corrupt anyway.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-14T19:26:51.056+0000","updated":"2011-09-14T19:26:51.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13104830","id":"13104830","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"Even if  BlockManager.markBlockAsCorrupt () is fixed in the way mentioned above,  there is still a special case in which the NN will not invalidate the block.\n\nTo reproduce this, \nset the replication factor for the file to 2. \ncorrupt the block by removing metafile from one of DNs. The block will not be removed since number of good replicas is less than the replication factor.\nset the replication factor for the file to 1. \nThe block is still not removed. \n\nThis bug is caused by the following statement in BlockManager.invalidateBlock()\n\n   // Check how many copies we have of the block. If we have at least one\n    // copy on a live node, then we can delete it.\n    int count = countNodes(blk).liveReplicas();\n    if (count > 1) {\n      addToInvalidates(blk, dn);\n\nThe bug can be fixed by changing the condition to (count >= 1).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-14T19:51:29.802+0000","updated":"2011-09-14T19:51:29.802+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13105721","id":"13105721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch for the bug","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-15T21:57:56.195+0000","updated":"2011-09-15T21:57:56.195+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13105724","id":"13105724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"The patch contains the Fixes to BlockManager as mentioned in the comments. The bug is reproduced in a slightly different way in which the block is corrupted by changing the contents and not by deleting the meta file.  This way of corruption allows the datanode to remove the corrupt block when asked by the namenode. \nThe patch also contains a a test class which 4 unit tests testing the various scenarios for handling corrupt replicas.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-15T22:01:59.216+0000","updated":"2011-09-15T22:01:59.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13108186","id":"13108186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"The patch looks good. Couple things on the test\n# Hould be jnuit 4 format\n# Please use DFSConfigKeys constants instead of direct config names.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-19T22:01:06.136+0000","updated":"2011-09-19T22:01:06.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13108218","id":"13108218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"Converted test to junit 4 format\nUses DFSConfigKeys instead of constants","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-19T23:11:28.509+0000","updated":"2011-09-19T23:11:28.509+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13108277","id":"13108277","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 looks good. Could you please run test-patch and test targets and post the results here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-20T00:26:11.409+0000","updated":"2011-09-20T00:26:11.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13108943","id":"13108943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"Attached the new patch with the correct naming conventions. \n\nRan the test-patch. The result is below:\n\n     [exec] +1 overall.  \n     [exec] \n     [exec]     +1 @author.  The patch does not contain any @author tags.\n     [exec] \n     [exec]     +1 tests included.  The patch appears to include 2 new or modified tests.\n     [exec] \n     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.\n     [exec] \n     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n     [exec] \n     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n     [exec] \n     [exec]     +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n     [exec] \n     [exec]     +1 system test framework.  The patch passed system test framework compile.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-20T19:17:08.347+0000","updated":"2011-09-20T19:17:08.347+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13108965","id":"13108965","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"I just committed this to 0.22 branch. Thank you Benoy.\nNeed to check if we have the same problem with trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-20T19:52:52.870+0000","updated":"2011-09-20T19:52:52.870+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13109041","id":"13109041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-22-branch #88 (See [https://builds.apache.org/job/Hadoop-Hdfs-22-branch/88/])\n    HDFS-2290. Block with corrupt replica is not getting replicated. Contributed by Benoy Antony.\n\nshv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1173324\nFiles : \n* /hadoop/common/branches/branch-0.22/hdfs/CHANGES.txt\n* /hadoop/common/branches/branch-0.22/hdfs/src/java/org/apache/hadoop/hdfs/server/namenode/BlockManager.java\n* /hadoop/common/branches/branch-0.22/hdfs/src/test/hdfs/org/apache/hadoop/hdfs/server/namenode/TestProcessCorruptBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-20T22:35:06.881+0000","updated":"2011-09-20T22:35:06.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13109120","id":"13109120","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Unblocking for 0.22","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-21T00:11:33.976+0000","updated":"2011-09-21T00:11:33.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13109125","id":"13109125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"It doesn't seem like we should be able to commit bugfixes to a branch without going through trunk first, unless there's justification that the implementation in trunk. Given that the replication code is basically the same, I think this requires further investigation to prevent trunk being a regression from 0.22.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2011-09-21T00:19:39.147+0000","updated":"2011-09-21T00:19:39.147+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13109126","id":"13109126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"bq. unless there's justification that the implementation in trunk\ner... \"that the implementation in trunk is different enough to avoid the bug\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2011-09-21T00:20:39.711+0000","updated":"2011-09-21T00:20:39.711+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13109514","id":"13109514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"body":"I can see this issue exists in trunk as well.\n\nI just rebased the patch to trunk and verified.\n\nFollowing test-cases (provided in patch) are failing without the fix.\n{code}\ntestWhenDecreasingReplication\ntestWithReplicationFactorAsOne\n{code}\n\nAfter fix, all the test-cases are passing. So IMO this issue needs to be fixed in trunk as well.\n\nThis is just an attempt to fix the issue in trunk as well. Thanks to Binoy and Konstantin for the patch. I can upload the patch for trunk if it is fine with you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-09-21T14:00:41.076+0000","updated":"2011-09-21T14:00:41.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13109549","id":"13109549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"body":"I can see one minor problem with testcode.\n\nAlways we are trying to restart datanode-0 only.\n\n{code}\n+  private void corruptBlock(MiniDFSCluster cluster, FileSystem fs,\n+      final Path fileName, int dnIndex, Block block) throws IOException {\n+    // corrupt the block on datanode dnIndex\n+    // the indexes change once the nodes are restarted.\n+    // But the datadirectory will not change\n+    assertTrue(cluster.corruptReplica(block.getBlockName(), dnIndex));\n+\n+    DataNodeProperties dnProps = cluster.stopDataNode(0);\n{code}\n\n*Should it be*\n{code}\n+    DataNodeProperties dnProps = cluster.stopDataNode(dnIndex);\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-09-21T14:57:47.645+0000","updated":"2011-09-21T14:57:47.645+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13112306","id":"13112306","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"body":"Updated the patch for trunk.\n\nChanges\n=======\n1) Rebased the patch to trunk.\n2) Corrected one test method as mentioned in my previous comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-09-22T03:55:52.553+0000","updated":"2011-09-22T03:55:52.553+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13112343","id":"13112343","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12496065/HDFS-2290_trunk.patch\n  against trunk revision .\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed these unit tests:\n                  org.apache.hadoop.hdfs.TestDfsOverAvroRpc\n                  org.apache.hadoop.hdfs.server.namenode.TestProcessCorruptBlocks\n                  org.apache.hadoop.hdfs.server.blockmanagement.TestHost2NodesMap\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/1278//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/1278//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-22T05:45:56.981+0000","updated":"2011-09-22T05:45:56.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13112413","id":"13112413","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"body":"TestHost2NodesMap failures - I will correct as part of HDFS-2346.\nTestDfsOverAvroRpc - failures are irrelavant to the current issue. Will be fixed as part of HDFS-2298.\n\nTestProcessCorruptBlocks - I am analyzing the failure.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-09-22T08:40:51.123+0000","updated":"2011-09-22T08:40:51.123+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13112440","id":"13112440","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"body":"TestProcessCorruptBlocks - Failure seems to be a timing issue.\nWe are trying to restart the Datanode and expecting the block reporting to complete in 3 seconds. This may not succeed all the times.\n\nThis test is always passing in local dev env. I'm able to recur the failures in local environment with less sleep time (1 second).\n\nAny suggestion to improve the test-case apart from increasing the sleep time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-09-22T09:27:10.983+0000","updated":"2011-09-22T09:27:10.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13112606","id":"13112606","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnvijoe","name":"johnvijoe","key":"johnvijoe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John George","active":true,"timeZone":"America/Los_Angeles"},"body":"What one of the other tests does is to sleep in a while loop for about 20 times, each time \"sleeping\" for a second and checking if it got the expected results. This way, the test was not sleeping for more time than necessary. If there is a better way, I am all ears as well...\n{code}\n+      while (tries++ < 20) {\n+        try {\n+          Thread.sleep(1000);\n+          if (checkFile(fileSys, file1, replicas, null, numDatanodes) == null) {\n+            break;\n+          }\n+        } catch (InterruptedException ie) {\n+        }\n+      }\n+      cleanupFile(fileSys, file1);\n+      assertTrue(\"Checked if node was recommissioned \" + tries + \" times.\",\n+         tries < 20);\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnvijoe","name":"johnvijoe","key":"johnvijoe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John George","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-22T14:11:57.642+0000","updated":"2011-09-22T14:11:57.642+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13112709","id":"13112709","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"Regarding the change in test :\n\n  // corrupt the block on datanode dnIndex\n+    // the indexes change once the nodes are restarted.\n+    // But the datadirectory will not change\n+    assertTrue(cluster.corruptReplica(block.getBlockName(), dnIndex));\n+\n+    DataNodeProperties dnProps = cluster.stopDataNode(0);\n\nThis is correct since   cluster.stopDataNode(0);  removes the first node so that the node at index 1 moves to index 0.\ncluster.restartDataNode ()   adds the new node (previously 0th node)  at the end of the list.\n\nI also indicated this in the comments. (\"the indexes change once the nodes are restarted. But the datadirectory will not change\") But looks like , they were not clear.\n\nThis could be the reason for failure in trunk.  John's suggestion seems to be better than  sleeping hard for 3 seconds.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-22T16:48:58.554+0000","updated":"2011-09-22T16:48:58.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13113161","id":"13113161","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"body":"{quote}\nThis is correct since cluster.stopDataNode(0); removes the first node so that the node at index 1 moves to index 0.\ncluster.restartDataNode () adds the new node (previously 0th node) at the end of the list.\n{quote}\n\nSorry for my misinterpretation. I will correct it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-09-23T05:18:57.198+0000","updated":"2011-09-23T05:18:57.198+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13113637","id":"13113637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"Uploading the corrected patch for the trunk. \nThe change was to stop the 0th datanode.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-23T18:27:24.982+0000","updated":"2011-09-23T18:27:24.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13113741","id":"13113741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12496300/HDFS-2290_trunk.patch\n  against trunk revision .\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed these unit tests:\n                  org.apache.hadoop.hdfs.TestDfsOverAvroRpc\n                  org.apache.hadoop.hdfs.server.blockmanagement.TestHost2NodesMap\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/1284//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/1284//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-23T20:21:29.127+0000","updated":"2011-09-23T20:21:29.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13113979","id":"13113979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"body":"Test failures are irrelevant to this patch as mentioned in my earlier comments.\n\nTestHost2NodesMap failures - Will be corrected as part of HDFS-2346. Patch already available.\nTestDfsOverAvroRpc - Will be fixed as part of HDFS-2298.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lakshman","name":"lakshman","key":"lakshman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laxman","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-09-24T14:09:47.046+0000","updated":"2011-09-24T14:09:47.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13113992","id":"13113992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Common-trunk-Commit #947 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/947/])\n    HDFS-2290. Block with corrupt replica is not getting replicated. Contributed by Benoy Antony.\n\nshv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1175175\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestProcessCorruptBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-24T15:13:15.318+0000","updated":"2011-09-24T15:13:15.318+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13113993","id":"13113993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-trunk-Commit #1025 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1025/])\n    HDFS-2290. Block with corrupt replica is not getting replicated. Contributed by Benoy Antony.\n\nshv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1175175\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestProcessCorruptBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-24T15:13:49.297+0000","updated":"2011-09-24T15:13:49.297+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13113995","id":"13113995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"I just committed this. Thank you Benoy and Laxman.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-24T15:20:43.155+0000","updated":"2011-09-24T15:20:43.155+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13113998","id":"13113998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Mapreduce-trunk-Commit #965 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/965/])\n    HDFS-2290. Block with corrupt replica is not getting replicated. Contributed by Benoy Antony.\n\nshv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1175175\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestProcessCorruptBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-24T15:30:16.894+0000","updated":"2011-09-24T15:30:16.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13114229","id":"13114229","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-0.23-Build #20 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/20/])\n    HDFS-2290. Block with corrupt replica is not getting replicated. Contributed by Benoy Antony.\n\nshv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1175176\nFiles : \n* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestProcessCorruptBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-25T12:48:25.255+0000","updated":"2011-09-25T12:48:25.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13114240","id":"13114240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Mapreduce-0.23-Build #25 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Build/25/])\n    HDFS-2290. Block with corrupt replica is not getting replicated. Contributed by Benoy Antony.\n\nshv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1175176\nFiles : \n* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestProcessCorruptBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-25T13:13:23.344+0000","updated":"2011-09-25T13:13:23.344+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13114245","id":"13114245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Mapreduce-trunk #841 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/841/])\n    HDFS-2290. Block with corrupt replica is not getting replicated. Contributed by Benoy Antony.\n\nshv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1175175\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestProcessCorruptBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-25T13:20:03.187+0000","updated":"2011-09-25T13:20:03.187+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520221/comment/13114252","id":"13114252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-trunk #811 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/811/])\n    HDFS-2290. Block with corrupt replica is not getting replicated. Contributed by Benoy Antony.\n\nshv : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1175175\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestProcessCorruptBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-25T13:23:11.137+0000","updated":"2011-09-25T13:23:11.137+0000"}],"maxResults":41,"total":41,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-2290/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i09fon:"}}