{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12754749","self":"https://issues.apache.org/jira/rest/api/2/issue/12754749","key":"HDFS-7392","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-11-13T05:25:50.922+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 23 02:17:07 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7392/watchers","watchCount":6,"isWatching":false},"created":"2014-11-12T12:55:29.094+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peschd","name":"peschd","key":"peschd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Pesch","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-01-23T02:17:07.983+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"}],"timeoriginalestimate":null,"description":"In some specific circumstances, org.apache.hadoop.hdfs.DistributedFileSystem.open(invalid URI) never timeouts and last forever.\n\nWhat are specific circumstances:\n1) HDFS URI (hdfs://share.example.com:8020/someDir/someFile.txt) should point to valid IP address but without name node service running on it.\n2) There should be at least 2 IP addresses for such a URI. See output below:\n{quote}\n[~/proj/quickbox]$ nslookup share.example.com\nServer:         127.0.1.1\nAddress:        127.0.1.1#53\n\nshare.example.com canonical name = internal-realm-share-example-com-1234.us-east-1.elb.amazonaws.com.\nName:   internal-realm-share-example-com-1234.us-east-1.elb.amazonaws.com\nAddress: 192.168.1.223\nName:   internal-realm-share-example-com-1234.us-east-1.elb.amazonaws.com\nAddress: 192.168.1.65\n{quote}\nIn such a case the org.apache.hadoop.ipc.Client.Connection.updateAddress() returns sometimes true (even if address didn't actually changed see img. 1) and the timeoutFailures counter is set to 0 (see img. 2). The maxRetriesOnSocketTimeouts (45) is never reached and connection attempt is repeated forever.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12681065","id":"12681065","filename":"1.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-12T12:56:29.314+0000","size":135405,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12681065/1.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12681066","id":"12681066","filename":"2.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-12T12:56:29.321+0000","size":105495,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12681066/2.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12688045","id":"12688045","filename":"HDFS-7392.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-18T14:48:00.651+0000","size":1870,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12688045/HDFS-7392.diff"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"org.apache.hadoop.hdfs.DistributedFileSystem open invalid URI forever","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14209299","id":"14209299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"[~vacekf], I can't get exact issue from your description, do you get issue in real environment?  If so, you can write the repro steps in comments. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-11-13T05:25:50.922+0000","updated":"2014-11-13T05:25:50.922+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14209554","id":"14209554","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"body":"All you need to reproduce this bug is FQDN which can be resolved to two IP addresses, like share.meck.com for me. I'm attaching nslookup output to show that share.merck.com is resolved to 54.40.29.65 and 59.40.29.223 \n\nName node service must not be installed on this machine.\n\nThen try to open any HDFS file on such a node like hdfs.open(\"hdfs://share.merck.com/some-dir/some-file.txt\")\n\n{quote}\n[~/proj/quickbox]$ nslookup share.merck.com                                                       \nServer:         127.0.1.1\nAddress:        127.0.1.1#53\n\nshare.merck.com canonical name = internal-gicprg-share-merck-com-1538706884.us-east-1.elb.amazonaws.com.\nName:   internal-gicprg-share-merck-com-1538706884.us-east-1.elb.amazonaws.com\nAddress: 54.40.29.223\nName:   internal-gicprg-share-merck-com-1538706884.us-east-1.elb.amazonaws.com\nAddress: 54.40.29.65\n{quote}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-13T10:03:09.904+0000","updated":"2014-11-13T10:03:09.904+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14218175","id":"14218175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"body":"Yi: Do you still need more clarification? Contact me, please.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-19T17:23:18.763+0000","updated":"2014-11-19T17:23:18.763+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14218889","id":"14218889","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"[~vacekf], I get the issue from your description now. I think it is an issue from the code logic, and now I try to reproduce it in my local env and go to confirm it.\n\nI repeat the issue here: the issue (client open the URI in dead loop) occurs when you use client to access HDFS, but you fill a wrong filesystem URI and there is no namenode in the host corresponding to that URI, and the FQDN of that host can be resolved to two IP addresses. Is that right?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-11-20T02:01:36.597+0000","updated":"2014-11-20T02:09:54.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14218893","id":"14218893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"BTW, I see you leave the JIRA unassigned, not sure you just report the issue, or you want to fix but don't have right to assign to yourself?\nIf I confirm it's indeed an issue, please let me know if you want to fix yourself, or I could help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-11-20T02:06:13.849+0000","updated":"2014-11-20T02:06:13.849+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14218931","id":"14218931","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Confirm that It's indeed an issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-11-20T03:15:18.373+0000","updated":"2014-11-20T03:15:18.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14219353","id":"14219353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"body":"I guess, that I can fix the issue myself, but I have not hatoop development toolchain installed to run all the integration tasks like testing and so. So if it can help you, I can send you proposed java patch. We need to have it fixed ASAP, so please make decision yourself, what will be the best to fix it in shortest term. I'll simply do my best to help you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-20T13:14:48.002+0000","updated":"2014-11-20T13:14:48.002+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14250253","id":"14250253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"body":"I'm too bussy to implement promissed patch so I'm adding part of log to show what is wrong with connection timeout. Please let me know if it helped.\n\nFanda\n\nEverlasting attempt to open nonexisting hdfs uri hdfs://share.merck.com/OneLevelHeader.xlsx\n\nopening path: /OneLevelHeader.xlsx ...\nDEBUG [main] (Client.java:426) - The ping interval is 60000 ms.\nDEBUG [main] (Client.java:695) - Connecting to share.merck.com/54.40.29.223:8020\n INFO [main] (Client.java:814) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 0 time(s); maxRetries=45\n WARN [main] (Client.java:568) - Address change detected. Old: share.merck.com/54.40.29.223:8020 New: share.merck.com/54.40.29.65:8020\n INFO [main] (Client.java:814) - Retrying connect to server: share.merck.com/54.40.29.65:8020. Already tried 0 time(s); maxRetries=45\n INFO [main] (Client.java:814) - Retrying connect to server: share.merck.com/54.40.29.65:8020. Already tried 1 time(s); maxRetries=45\n WARN [main] (Client.java:568) - Address change detected. Old: share.merck.com/54.40.29.65:8020 New: share.merck.com/54.40.29.223:8020\n INFO [main] (Client.java:814) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 0 time(s); maxRetries=45\n INFO [main] (Client.java:814) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 1 time(s); maxRetries=45","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-17T18:19:15.112+0000","updated":"2014-12-17T18:19:15.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14251420","id":"14251420","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"body":"Problem can be solved by different implementation of SecurityUtils.StandardHostResolver.getByName(String host)\n\nCurrent implementation\n{code}\n  interface HostResolver {\n    InetAddress getByName(String host) throws UnknownHostException;    \n  }\n  \n/**\n   * Uses standard java host resolution\n   */\n  static class StandardHostResolver implements HostResolver {\n    @Override\n    public InetAddress getByName(String host) throws UnknownHostException {\n      return InetAddress.getByName(host);\n    }\n  }\n{code}\n\nProper implementation should be like\n{code}\n  interface HostResolver {\n    InetAddress[] getByName(String host) throws UnknownHostException;    \n  }\n  \n  /**\n   * Uses standard java host resolution\n   */\n  static class StandardHostResolver implements HostResolver {\n    @Override\n    public InetAddress[] getByName(String host) throws UnknownHostException {\n      return InetAddress.getAllByName(host);\n    }\n  }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-18T09:27:48.745+0000","updated":"2014-12-18T09:27:48.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14251637","id":"14251637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"body":"Please ignore my previous proposal, it will not work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-18T13:19:08.389+0000","updated":"2014-12-18T13:19:08.389+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14251739","id":"14251739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"body":"Finaly, I've created promissed patch. It is attached as HDFS-7392.diff . It is not a final solution of course, but it is working and I hope that it brings a light to the problem we are facing on. Yi, please contact me if you need more info or explanation.\n\nregards\n\nFanda","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-18T14:47:32.736+0000","updated":"2014-12-18T14:47:32.736+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14251741","id":"14251741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"body":"I'm also attaching a log whent the patch is applied.\n\n{code}\nDEBUG [main] (Client.java:697) - Connecting to share.merck.com/54.40.29.65:8020\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.65:8020. Already tried 1 time(s); maxRetries=45\n WARN [main] (Client.java:564) - Address change detected. Old: share.merck.com/54.40.29.65:8020 New: share.merck.com/54.40.29.223:8020\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 2 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 1 time(s); maxRetries=45\n WARN [main] (Client.java:564) - Address change detected. Old: share.merck.com/54.40.29.223:8020 New: share.merck.com/54.40.29.65:8020\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.65:8020. Already tried 2 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.65:8020. Already tried 3 time(s); maxRetries=45\n WARN [main] (Client.java:564) - Address change detected. Old: share.merck.com/54.40.29.65:8020 New: share.merck.com/54.40.29.223:8020\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 4 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 3 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 4 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 5 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 6 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 7 time(s); maxRetries=45\n WARN [main] (Client.java:564) - Address change detected. Old: share.merck.com/54.40.29.223:8020 New: share.merck.com/54.40.29.65:8020\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.65:8020. Already tried 8 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.65:8020. Already tried 5 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.65:8020. Already tried 6 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.65:8020. Already tried 7 time(s); maxRetries=45\n WARN [main] (Client.java:564) - Address change detected. Old: share.merck.com/54.40.29.65:8020 New: share.merck.com/54.40.29.223:8020\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 8 time(s); maxRetries=45\n INFO [main] (Client.java:816) - Retrying connect to server: share.merck.com/54.40.29.223:8020. Already tried 9 time(s); maxRetries=45\n{code} ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vacekf","name":"vacekf","key":"vacekf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frantisek Vacek","active":true,"timeZone":"Etc/UTC"},"created":"2014-12-18T14:50:36.967+0000","updated":"2014-12-18T14:50:36.967+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14285681","id":"14285681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peschd","name":"peschd","key":"peschd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Pesch","active":true,"timeZone":"Etc/UTC"},"body":"Hi Yi\nYes we are getting it in real environment. Otherwise we would not bother to create a major issue. We had a process blocked on this for several days. Frantisek already suggested a viable solution for this problem. Unfortunately Frantisek has left our company. How we could help you to make a progress in fixing this issue?\nBest Regards\nDaniel ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peschd","name":"peschd","key":"peschd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Pesch","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-21T14:34:09.890+0000","updated":"2015-01-21T14:34:09.890+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14285682","id":"14285682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peschd","name":"peschd","key":"peschd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Pesch","active":true,"timeZone":"Etc/UTC"},"body":"Hi Yi\nYes we are getting it in real environment. Otherwise we would not bother to create a major issue. We had a process blocked on this for several days. Frantisek already suggested a viable solution for this problem. Unfortunately Frantisek has left our company. How we could help you to make a progress in fixing this issue?\nBest Regards\nDaniel ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peschd","name":"peschd","key":"peschd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Pesch","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-21T14:34:44.981+0000","updated":"2015-01-21T14:34:44.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14286987","id":"14286987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"[~peschd], I think this issue is not important, the reasons are:\n*1.* You connect to an incorrect fs uri, if you connect to a correct one, then there is no issue.\n*2.* Even for an incorrect fs uri, indeed it will retry again and again in the specific environment you described, but you can see the failure from log.\n\nCould you tell me whether this blocks your usage and you are not able to use an correct fs uri? I think this issue is mostly caused by you use an incorrect fs uri.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-01-22T05:43:18.693+0000","updated":"2015-01-22T05:47:10.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14287141","id":"14287141","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peschd","name":"peschd","key":"peschd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Pesch","active":true,"timeZone":"Etc/UTC"},"body":"We are not blocked by his bug and we are able to connect correct URIs.\n\nIn my honest opinion this issue is still important and could be easily fixed because:\n1. The code is simply wrong. If you connect to wrong URI it should fail and not get into infinite loop. \n2. You will not find anything useful in the logs. You need to debug it to find the root cause by yourself.\n3. We already spend the effort to found the root cause and provided the fix.  \n\n\n\n\n\n\n\n \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peschd","name":"peschd","key":"peschd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Pesch","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-22T09:08:17.960+0000","updated":"2015-01-22T09:08:17.960+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14288424","id":"14288424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"I think we should fix this bug since the failure count does not work when a host name is resolved to more than one address.\n\nWill review the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-22T23:18:11.360+0000","updated":"2015-01-22T23:18:11.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14288508","id":"14288508","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks Daniel. Agree with [~szetszwo]'s suggestion that we need to fix.\nI assign the JIRA to you, since you guys take time investigating the cause and provider a fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-01-23T00:48:26.000+0000","updated":"2015-01-23T00:48:26.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12754749/comment/14288606","id":"14288606","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"{code}\n+          if(server != null) {\n+            Short s = timeoutFailuresByAddress.get(server);\n+            if(s != null)\n+              timeoutFailures = s.shortValue();\n+            timeoutFailures++;\n+            timeoutFailuresByAddress.put(server, timeoutFailures);\n           }\n-          handleConnectionTimeout(timeoutFailures++,\n+          updateAddress();\n+          handleConnectionTimeout(timeoutFailures,\n{code}\n- Could server be null?  It seems impossible so that we should omit the null check.\n- Before the patch, timeoutFailures is incremented after handleConnectionTimeout(..).  We need to keep the order.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-23T02:17:07.983+0000","updated":"2015-01-23T02:17:07.983+0000"}],"maxResults":19,"total":19,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7392/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i22a33:"}}