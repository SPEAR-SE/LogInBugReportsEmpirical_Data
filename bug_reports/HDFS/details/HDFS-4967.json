{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12656777","self":"https://issues.apache.org/jira/rest/api/2/issue/12656777","key":"HDFS-4967","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2013-07-09T03:51:38.131+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 10 02:42:50 UTC 2013","customfield_12310420":"337000","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_82111846_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-07-10T02:23:19.735+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4967/watchers","watchCount":7,"isWatching":false},"created":"2013-07-09T03:34:47.911+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335732","id":"12335732","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"issuelinks":[{"id":"12371767","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12371767","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12639495","key":"HDFS-4645","self":"https://issues.apache.org/jira/rest/api/2/issue/12639495","fields":{"summary":"Move from randomly generated block ID to sequentially generated block ID","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-12T18:11:47.078+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12316609","id":"12316609","name":"ha","description":"High Availability"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"There are two name nodes, one is active, another acts as standby name node. QJM Ha  configured.\n\nAfter HDFS-4645 committed in the trunk, then the following error showed during name node start:\n\n\n{code}\n2013-07-09 11:28:45,394 FATAL org.apache.hadoop.hdfs.server.namenode.NameNode: Exception in namenode join\njava.lang.IllegalStateException: Cannot skip to less than the current value (=1073741824), where newValue=0\n        at org.apache.hadoop.util.SequentialNumber.skipTo(SequentialNumber.java:58)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.setLastAllocatedBlockId(FSNamesystem.java:5124)\n        at org.apache.hadoop.hdfs.server.namenode.FSImageFormat$Loader.load(FSImageFormat.java:278)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:809)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:798)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImageFile(FSImage.java:653)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:623)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverTransitionRead(FSImage.java:260)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFSImage(FSNamesystem.java:719)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFromDisk(FSNamesystem.java:552)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.loadNamesystem(NameNode.java:401)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:435)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:607)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:592)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:1172)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.main(NameNode.java:1238)\n2013-07-09 11:28:45,397 INFO org.apache.hadoop.util.ExitUtil: Exiting with status 1\n{code}\n\n\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"337323","customfield_12312823":null,"summary":"Generate block ID sequentially cannot work with QJM HA","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13702864","id":"13702864","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for reporting this issue. [~arpitagarwal] while fixing this issue, we should add a unit test for this condition to make sure we catch this type of issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-09T03:51:38.131+0000","updated":"2013-07-09T03:51:38.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13702921","id":"13702921","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for reporting Fengdong! I am taking a look.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-09T05:00:52.954+0000","updated":"2013-07-09T05:00:52.954+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13702937","id":"13702937","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"[~azuryy] Was this an upgrade or a freshly formatted cluster? I am not sure how we got an image with a zero {{LastAllocatedBlockId}}. I'll see if I can repro it.\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-09T05:28:16.393+0000","updated":"2013-07-09T05:28:16.393+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13702952","id":"13702952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"Hi Arpit,\n\nI will add some reprduce steps here shortly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-09T05:49:14.922+0000","updated":"2013-07-09T05:49:14.922+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13702961","id":"13702961","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"A quick feedback is that: I upgraded the cluster from 2.0.5-alpha to the trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-09T06:04:36.090+0000","updated":"2013-07-09T06:04:36.090+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13703024","id":"13703024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"Hi Arpit,\n\nI am already have a HA cluster(LayoutVersion=-43), and I don't want to upgrade, because upgrade under HA is complicated. \n\nAFAIK, upgrade under HA cluster including:\n1) stop-dfs\n2) replace core-site.xml hdfs-site.xml with Non-HA xmls.\n3) merge edit logs from standby NN to active NN\n4) start-dfs  -upgrade\n5) stop-dfs\n6) revert core-site.xml and hdfs-site.xml(HA)\n7) initializeSharedEdits\n8) start-dfs\n\nSo, I did some hack in the trunk codes, like following:\n{code}\n-    OPTIMIZE_SNAPSHOT_INODES(-45, -43,\n+    OPTIMIZE_SNAPSHOT_INODES(-43, -43,\n         \"Reduce snapshot inode memory footprint\", false),\n-    SEQUENTIAL_BLOCK_ID(-46, \"Allocate block IDs sequentially and store \" +\n-        \"block IDs in the edits log and image files\");\n+    SEQUENTIAL_BLOCK_ID(-43, -43, \"Allocate block IDs sequentially and store \" +\n+        \"block IDs in the edits log and image files\", false);\n{code}\n\nafter that, I saw the above errors.\n\nbut now, I revert LayoutVersion.java, and upgraded cluster(eight steps I mentions at first)\n\nIt works, no Exceptions.\n\nSo we can close this issue with \"not a problem\". but I want to know:\n\nAm I right for these eight steps during upgrade?(from one HA verson to another HA version, such as from LayoutVersion -43 to -46)\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-09T07:43:11.452+0000","updated":"2013-07-09T07:43:11.452+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13703143","id":"13703143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"\n\nAfter I read the code, I don't think this issue is caused by my 'hack'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-09T10:34:19.181+0000","updated":"2013-07-09T10:34:19.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13703241","id":"13703241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"I want to add more of my further tests:\n\nHDFS-4645 commited version in the trunk is :r1500580 ,then I checked out r1500194 from the trunk, just before HDFS-4645 checked in.\n\nthen I am also do some hack:\n{code}\n--- hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java    (revision 1500194)\n+++ hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java    (working copy)\n@@ -101,7 +101,7 @@\n     SNAPSHOT(-43, \"Support for snapshot feature\"),\n     RESERVED_REL1_3_0(-44, -41,\n         \"Reserved for release 1.3.0\", true, ADD_INODE_ID, SNAPSHOT),\n-    OPTIMIZE_SNAPSHOT_INODES(-45, -43,\n+    OPTIMIZE_SNAPSHOT_INODES(-43, -43,\n         \"Reduce snapshot inode memory footprint\", false);\n{code}\n\nthen I \"start-dfs.sh\", everything looks good to me.\n\nso we cannot close this issue currently.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-09T13:16:07.186+0000","updated":"2013-07-09T13:16:07.186+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13703390","id":"13703390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Fengdong,\n\nThis doesn't look like a good way to force the upgrade. By overriding the image version the namenode will attempt to read fields that do not exist in the image and it will corrupt the namenode state. Even if you don't hit an assertion right away your namenode state is unpredictable.\n\nThe repro steps you specified earlier look mostly correct. Step 3 should not be necessary. You can run the upgrade step offline on a pseudo cluster without changing your production configurations.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-09T15:41:34.546+0000","updated":"2013-07-09T15:41:34.546+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13703569","id":"13703569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Fengdong,\n\n   After your hacking \n{code}\n+    SEQUENTIAL_BLOCK_ID(-43, -43, \"Allocate block IDs sequentially and store \" +\n+        \"block IDs in the edits log and image files\", false);\n{code}\n\n   when loading your old fsimage, the code below will be executed (in FSImageFormat#load):\n{code}\n   if (LayoutVersion.supports(Feature.SEQUENTIAL_BLOCK_ID, imgVersion)) {\n     // read the starting generation stamp for sequential block IDs\n     genstamp = in.readLong();\n{code}\n\n   and actually in your old fsimage, there is no such a long value written in your fsimage. And this causes the error you saw.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-09T18:03:36.508+0000","updated":"2013-07-09T18:03:36.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13704073","id":"13704073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"bq.The repro steps you specified earlier look mostly correct. Step 3 should not be necessary. \nArpit, \nI think step 3 is necessary, otherwise name node complain \"cannot find edlit logs with txid from xxx\"\n\nbq.and actually in your old fsimage, there is no such a long value written in your fsimage. And this causes the error you saw.\nJing,\nyes, this is the root cause. I'll test it futher today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-10T01:06:38.697+0000","updated":"2013-07-10T01:06:38.697+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13704134","id":"13704134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... then I am also do some hack ...\n\nFengdong, we cannot change the layout version number.  Otherwise, your fsimage won't be compatible with trunk.\n\n> So we can close this issue with \"not a problem\". ...\n\nSure, let's close this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-10T02:23:08.780+0000","updated":"2013-07-10T02:23:08.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656777/comment/13704139","id":"13704139","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"bq. The repro steps you specified earlier look mostly correct. Step 3 should not be necessary.\n\nArpit, yes, step 3 is not necessary after I test. but we must do upgrade on the active NN. I added step3 here just because I upgraded on the standby NN last time.\n\n\nLet's close this issue with \"not a problem\". Thanks all.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-10T02:42:50.506+0000","updated":"2013-07-10T02:42:50.506+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4967/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1m4n3:"}}