{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12982053","self":"https://issues.apache.org/jira/rest/api/2/issue/12982053","key":"HDFS-10563","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2016-06-23T14:12:07.211+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jun 23 14:28:37 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_70191213_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-06-23T14:28:56.655+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-10563/watchers","watchCount":7,"isWatching":false},"created":"2016-06-22T18:59:05.536+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329057","id":"12329057","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12333995","id":"12333995","description":"2.7.3 release","name":"2.7.3","archived":false,"released":true,"releaseDate":"2016-08-25"}],"issuelinks":[{"id":"12471288","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12471288","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12902458","key":"HDFS-9198","self":"https://issues.apache.org/jira/rest/api/2/issue/12902458","fields":{"summary":"Coalesce IBR processing in the NN","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-06-23T14:28:56.726+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"Reading through the block reporting code I think I've spotted a case when block reports can silently be dropped and leave thread waiting indefinitely on a FutureTask that never will be executed.\n\nThe BlockReportProcessingThread.enqueue method doesn't return any status on if the enqueuing of the task was successful and does not handle the case when the queue is full and offer return false.\n\nGoing back through the call stack to BlockManager.runBlockOp, which indirectly calls enqueue with a FutureTask and then proceeds to do get() om the task.\n\nSo if the internal queue in the BlockReportingProcessingThread is full, the BR would never be handled and the thread queuing the task would wait indefinitely on the FutureTask that will never be executed.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Block reports could be silently dropped by NN","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sfriberg","name":"sfriberg","key":"sfriberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34056","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34056","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34056","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34056"},"displayName":"Staffan Friberg","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sfriberg","name":"sfriberg","key":"sfriberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34056","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34056","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34056","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34056"},"displayName":"Staffan Friberg","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12982053/comment/15346489","id":"15346489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"bq. does not handle the case when the queue is full and offer return false\n\nFrom {{BlockManager.java}}\n{noformat}\n    void enqueue(Runnable action) throws InterruptedException {\n      if (!queue.offer(action)) {\n        if (!isAlive() && namesystem.isRunning()) {\n          ExitUtil.terminate(1, getName()+\" is not running\");\n        }\n        long now = Time.monotonicNow();\n        if (now - lastFull > 4000) {\n          lastFull = now;\n          LOG.info(\"Block report queue is full\");\n        }\n        queue.put(action);\n      }\n    }\n{noformat}\n\nIf {{queue.offer(action)}} returns false, it will do blocking put.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2016-06-23T14:12:07.211+0000","updated":"2016-06-23T14:12:07.211+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12982053/comment/15346498","id":"15346498","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sfriberg","name":"sfriberg","key":"sfriberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34056","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34056","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34056","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34056"},"displayName":"Staffan Friberg","active":true,"timeZone":"America/Chicago"},"body":"Unless I'm counting {} wrong it looks like the put is inside the if statement.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sfriberg","name":"sfriberg","key":"sfriberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34056","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34056","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34056","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34056"},"displayName":"Staffan Friberg","active":true,"timeZone":"America/Chicago"},"created":"2016-06-23T14:23:17.841+0000","updated":"2016-06-23T14:23:17.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12982053/comment/15346510","id":"15346510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sfriberg","name":"sfriberg","key":"sfriberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34056","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34056","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34056","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34056"},"displayName":"Staffan Friberg","active":true,"timeZone":"America/Chicago"},"body":"Now I see it. Completely missed the !.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sfriberg","name":"sfriberg","key":"sfriberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34056","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34056","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34056","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34056"},"displayName":"Staffan Friberg","active":true,"timeZone":"America/Chicago"},"created":"2016-06-23T14:28:37.162+0000","updated":"2016-06-23T14:28:37.162+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-10563/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2zxbj:"}}