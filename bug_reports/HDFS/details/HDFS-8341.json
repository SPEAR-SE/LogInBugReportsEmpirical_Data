{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12828020","self":"https://issues.apache.org/jira/rest/api/2/issue/12828020","key":"HDFS-8341","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2015-05-09T01:38:43.653+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Sep 18 16:42:33 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_11476463517_*|*_4_*:*_1_*:*_526839459_*|*_5_*:*_2_*:*_3227869","customfield_12312321":null,"resolutiondate":"2015-09-23T13:22:17.939+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8341/watchers","watchCount":4,"isWatching":false},"created":"2015-05-07T14:13:27.126+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327181","id":"12327181","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-09-23T13:22:17.965+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313153","id":"12313153","name":"balancer & mover"}],"timeoriginalestimate":null,"description":"HDFS mover gets stuck looping on a block that fails to move and doesn't migrate the rest of the blocks.\n\nThis is preventing recovery of data from a decomissioning external storage tier used for archive (we've had problems with that proprietary \"hyperscale\" storage product which is why a couple blocks here and there have checksum problems or premature eof as shown below), but this should not prevent moving all the other blocks to recover our data:\n{code}hdfs mover -p /apps/hive/warehouse/<custom_scrubbed>\n15/05/07 14:52:50 INFO mover.Mover: namenodes = {hdfs://nameservice1=[/apps/hive/warehouse/<custom_scrubbed>]}\n15/05/07 14:52:51 INFO balancer.KeyManager: Block token params received from NN: update interval=10hrs, 0sec, token lifetime=10hrs, 0sec\n15/05/07 14:52:51 INFO block.BlockTokenSecretManager: Setting block keys\n15/05/07 14:52:51 INFO balancer.KeyManager: Update block keys every 2hrs, 30mins, 0sec\n15/05/07 14:52:52 INFO block.BlockTokenSecretManager: Setting block keys\n15/05/07 14:52:52 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:52:52 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:52:52 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:52:52 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:52:52 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:52:52 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:52:52 WARN balancer.Dispatcher: Failed to move blk_1075156654_1438349 with size=134217728 from <ip>:1019:ARCHIVE to <ip>:1019:DISK through <ip>:1019: block move is failed: opReplaceBlock BP-120244285-<ip>-1417023863606:blk_1075156654_1438349 received exception java.io.EOFException: Premature EOF: no length prefix available\n<NOW IT STARTS LOOPING ON SAME BLOCK>\n15/05/07 14:53:31 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:53:31 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:53:31 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:53:31 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:53:31 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:53:31 INFO net.NetworkTopology: Adding a new node: /default-rack/<ip>:1019\n15/05/07 14:53:31 WARN balancer.Dispatcher: Failed to move blk_1075156654_1438349 with size=134217728 from <ip>:1019:ARCHIVE to <ip>:1019:DISK through <ip>:1019: block move is failed: opReplaceBlock BP-120244285-<ip>-1417023863606:blk_1075156654_1438349 received exception java.io.EOFException: Premature EOF: no length prefix available\n...<repeat indefinitely>...\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HDFS mover stuck in loop trying to move corrupt block with no other valid replicas, doesn't move rest of other data blocks","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"HDP 2.2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14532730","id":"14532730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"body":"I've done a manually scripted move of blocks under the hood in this scenario... but this functionality is effectively a blocker for hdfs storage tiering.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-07T14:25:55.282+0000","updated":"2015-05-07T14:25:55.282+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14536097","id":"14536097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Are you sure that there are other blocks needed to move?  Mover uses a thread pool and ExecutorService to dispatch block moves.  So it should not stuck with failures.  In other words, if there are failures, it should continue with the rest of the block moves.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-09T01:38:43.653+0000","updated":"2015-05-09T01:38:43.653+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14536366","id":"14536366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=surendrasingh","name":"surendrasingh","key":"surendrasingh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=surendrasingh&avatarId=30759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=surendrasingh&avatarId=30759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=surendrasingh&avatarId=30759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=surendrasingh&avatarId=30759"},"displayName":"Surendra Singh Lilhore","active":true,"timeZone":"Etc/UTC"},"body":"currenlty {{scheduleMoves4Block()}} API will schedule only one replica at a time. If replica scheduled successfully it will return, but here it should continue for next replica.\n\n{code}\n        for (final MLocation ml : locations) {\n          final Source source = storages.getSource(ml);\n          if (ml.storageType == t && source != null) {\n            // try to schedule one replica move.\n            if (scheduleMoveReplica(db, source, diff.expected)) {\n              return true;\n            }\n          }\n        }\n{code}\nNow the problem is, if file have more than one block for example 10 and some problem in moving first replica then {{scheduleMoves4Block()}} API will always schedule first replica in each iteration and it will return. It will keep on doing in all the iteration and other replica's never schedule for move.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=surendrasingh","name":"surendrasingh","key":"surendrasingh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=surendrasingh&avatarId=30759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=surendrasingh&avatarId=30759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=surendrasingh&avatarId=30759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=surendrasingh&avatarId=30759"},"displayName":"Surendra Singh Lilhore","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-09T11:21:21.680+0000","updated":"2015-05-09T11:21:21.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14537733","id":"14537733","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"body":"I had to move several thousand blocks by hand via scripting which was a significant proportion of the total blocks given that I had only put some limited amount of expendible data on the archive tier for testing. Given the dimensions of the data I'm certain it wasn't only successive blocks for one given file.\n\nThe command was looping on the same block, which also implies it never proceeded to try to move the blocks of the other files, hence the large number of blocks left behind and not moved back to the regular disk tier.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-11T08:54:57.661+0000","updated":"2015-05-11T08:54:57.661+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14538625","id":"14538625","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... If replica scheduled successfully it will return, but here it should continue for next replica.\n\nThe reason of returning is that we don't want to move multiple replicas of the same block at once.\n\n> Now the problem is, if file have more than one block for example 10 ... \n\nDo you mean \"a block has more than one replicas for example 10\"?\n\n> ... and some problem in moving first replica then scheduleMoves4Block() API will always schedule first replica in each iteration and it will return.\nThe locations are shuffled so that the first replica is not necessarily the same in each iteration.  Am I missing anything?\n{code}\n//scheduleMoves4Block\n      Collections.shuffle(locations);\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-11T20:50:05.841+0000","updated":"2015-05-11T20:50:05.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14540493","id":"14540493","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=surendrasingh","name":"surendrasingh","key":"surendrasingh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=surendrasingh&avatarId=30759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=surendrasingh&avatarId=30759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=surendrasingh&avatarId=30759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=surendrasingh&avatarId=30759"},"displayName":"Surendra Singh Lilhore","active":true,"timeZone":"Etc/UTC"},"body":"bq. Do you mean \"a block has more than one replicas for example 10\"?\nyes\n\nbq. The locations are shuffled so that the first replica is not necessarily the same in each iteration. Am I missing anything?\n\nOoh sorry I missed it.\n\nBut still problem is there. We don't now how many iteration it will take for moving correct replicas. Whenever corrupt replica comes at first position in shuffled list that iteration will fail.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=surendrasingh","name":"surendrasingh","key":"surendrasingh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=surendrasingh&avatarId=30759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=surendrasingh&avatarId=30759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=surendrasingh&avatarId=30759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=surendrasingh&avatarId=30759"},"displayName":"Surendra Singh Lilhore","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-12T19:03:00.367+0000","updated":"2015-05-12T19:03:00.367+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14540514","id":"14540514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> But still problem is there. ...\n\nThis is only a minor problem which may not be needed to fix.\n\nLet go back to the bug describing this JIRA. Would the Mover stuck or not?  The summary says \"HDFS mover stuck in loop after failing to move block, doesn't move rest of blocks, can't get data back off decommissioning external storage tier as a result\".  Is it still true?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-12T19:11:54.499+0000","updated":"2015-05-12T19:11:54.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14573418","id":"14573418","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Added (Summary & Description may be invalid) to the Summary and changed the priority to minor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-04T19:15:41.238+0000","updated":"2015-06-04T19:15:41.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14802702","id":"14802702","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Resolving as invalid.  Please feel free to reopen if you disagree.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-17T10:07:50.601+0000","updated":"2015-09-17T10:07:50.601+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14802746","id":"14802746","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"body":"[~szetszwo] I believe this ticket is still valid:\n\nThere were holes in the data since that storage tier had replication factor 1 as the replication was supposed to be handled within the proprietary hyperscale storage solution underpinning that tier so there was no point in storing multiple HDFS replicas there. So if a given block's checksum failed, HDFS Mover looped on that block (probably hoping to find other valid block replicas to use but there were no other replicas so it was stuck looping on the one corrupt replica) and never got past that block so it didn't transfer the rest of the data's other blocks.\n\nThis would be the same problem if all replicas were corrupt or if a block was under replicated (which happens often) and the existing replica was corrupt.\n\nSo this jira is still valid - if HDFS Mover can't find a valid/non-corrupt replica then it doesn't proceed to move the rest of the other blocks, which prevented decommissioning of this storage tier. This is the reason I scripted a custom recovery job under the hood of Hadoop since the other blocks were fine and it was leaving a lot of data behind on the external storage tier.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-17T11:01:29.676+0000","updated":"2015-09-17T11:01:29.676+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14804994","id":"14804994","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... So if a given block's checksum failed, HDFS Mover looped on that block ... and never got past that block so it didn't transfer the rest of the data's other blocks.\n\nThis statement seems wrong.  Mover won't loop on the same block according to the code.  Do you have a way to reproduce the bug?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-18T05:23:40.010+0000","updated":"2015-09-18T05:23:40.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14805196","id":"14805196","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"body":"All I can say is what I observed, as per the original code paste showing it looped on the same block number on each run and never got past it.\n\nI've moved on since then and that storage tier was decommissioned anyway so I don't have any way to reproduce it right now. Perhaps a new cluster with a storage tiering with rep factor 1 where the block is intentionally corrupted might be able to reproduce this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-18T08:20:09.948+0000","updated":"2015-09-18T08:20:09.948+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14875802","id":"14875802","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... original code paste showing it looped on the same block number on each run and never got past it.\n\nDo you mean the code posted on [this comment|https://issues.apache.org/jira/browse/HDFS-8341?focusedCommentId=14536366&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14536366]?  It loops on the locations but it will exit after looped all locations.  So \"never got past it\" seems a wrong statement.\n\n[~surendrasingh], could comment on this?\n\n> ... so I don't have any way to reproduce it right now. Perhaps a new cluster with a storage tiering with rep factor 1 where the block is intentionally corrupted might be able to reproduce this.\n\nCould you try to reproduce the problem?  If we cannot reproduce it, we should resolve this JIRA for the moment.  We may reopen this or file a new JIRA in case we see the problem later.\n\nIMO, this bug does not exist.  You may indeed have encountered a similar problem but it might be caused by something else but not the Mover. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-18T15:44:07.969+0000","updated":"2015-09-18T15:44:07.969+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14875829","id":"14875829","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"body":"[~szetszwo] No I meant the original log description at the top which shows\n{code}balancer.Dispatcher: Failed to move blk_1075156654_1438349{code} repeats over and over in the output which is what made me think it was looping on the same block.\n\nThere's only 1 replica for each block... so it's not iterating on locations as the code snippet you are pointing to suggests since there are no other locations to try, but exiting and then restarting at the same block which still has no uncorrupted replicas available, exiting again, restarting at the same block again etc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-18T15:58:38.157+0000","updated":"2015-09-18T15:58:38.157+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14875890","id":"14875890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=surendrasingh","name":"surendrasingh","key":"surendrasingh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=surendrasingh&avatarId=30759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=surendrasingh&avatarId=30759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=surendrasingh&avatarId=30759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=surendrasingh&avatarId=30759"},"displayName":"Surendra Singh Lilhore","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~harisekhon], that is my mistake. The locations are shuffled, so it will not move same replica in each iteration.\nPlease check the [comment|https://issues.apache.org/jira/browse/HDFS-8341?focusedCommentId=14538625&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14538625] given by [~szetszwo].\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=surendrasingh","name":"surendrasingh","key":"surendrasingh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=surendrasingh&avatarId=30759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=surendrasingh&avatarId=30759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=surendrasingh&avatarId=30759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=surendrasingh&avatarId=30759"},"displayName":"Surendra Singh Lilhore","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-18T16:27:43.344+0000","updated":"2015-09-18T16:27:43.344+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14875917","id":"14875917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"body":"[~surendrasingh] it doesn't matter if the block replica locations are shuffled or not when there is only one replica.\n\nThe crux of the problem is not the locations, it's that it exits and tries from the same block again which doesn't have any uncorrupted replicas, so the mover never progresses to the next block.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-18T16:36:17.896+0000","updated":"2015-09-18T16:36:17.896+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12828020/comment/14875924","id":"14875924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... it's that it exits and tries from the same block again  ...\n\nNo, it does not exit.\n\nBTW, which version of Hadoop were you using?  I wonder that you might be using a development version so that you hit this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-18T16:42:33.702+0000","updated":"2015-09-18T16:42:33.702+0000"}],"maxResults":17,"total":17,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8341/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ef8v:"}}