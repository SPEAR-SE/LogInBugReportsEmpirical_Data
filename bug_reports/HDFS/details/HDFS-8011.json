{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12786524","self":"https://issues.apache.org/jira/rest/api/2/issue/12786524","key":"HDFS-8011","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2015-03-30T15:44:52.083+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Dec 16 16:47:36 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_22652028752_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-12-16T16:47:36.166+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8011/watchers","watchCount":7,"isWatching":false},"created":"2015-03-29T12:33:47.457+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325255","id":"12325255","description":"2.3.0 release","name":"2.3.0","archived":false,"released":true,"releaseDate":"2014-02-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-12-16T16:47:36.207+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12316609","id":"12316609","name":"ha","description":"High Availability"}],"timeoriginalestimate":null,"description":"We have seen crash when starting the standby namenode, with fatal errors. Any solutions, workarouds, or ideas would be helpful for us.\n1. Here is the context: \n\tAt begining we have 2 namenodes, take A as active and B as standby. For some resons, namenode A was dead, so namenode B is working as active.\n\tWhen we try to restart A after a minute, it can't work. During this time a lot of files were put to HDFS, and a lot of files were renamed. \n\tNodenode A crashed when \"awaiting reported blocks in safemode\" each time.\n \n2. We can see error log below:\n\t1)2015-03-30  ERROR org.apache.hadoop.hdfs.server.namenode.FSEditLogLoader: Encountered exception on operation CloseOp [length=0, inodeId=0, path=/xxx/_temporary/xxx/part-r-00074.bz2, replication=3, mtime=1427699913947, atime=1427699081161, blockSize=268435456, blocks=[blk_2103131025_1100889495739], permissions=dm:dm:rw-r--r--, clientName=, clientMachine=, opCode=OP_CLOSE, txid=7632753612]\njava.lang.NullPointerException\n        at org.apache.hadoop.hdfs.server.blockmanagement.BlockInfoUnderConstruction.setGenerationStampAndVerifyReplicas(BlockInfoUnderConstruction.java:247)\n        at org.apache.hadoop.hdfs.server.blockmanagement.BlockInfoUnderConstruction.commitBlock(BlockInfoUnderConstruction.java:267)\n        at org.apache.hadoop.hdfs.server.blockmanagement.BlockManager.forceCompleteBlock(BlockManager.java:639)\n        at org.apache.hadoop.hdfs.server.namenode.FSEditLogLoader.updateBlocks(FSEditLogLoader.java:813)\n        at org.apache.hadoop.hdfs.server.namenode.FSEditLogLoader.applyEditLogOp(FSEditLogLoader.java:383)\n        at org.apache.hadoop.hdfs.server.namenode.FSEditLogLoader.loadEditRecords(FSEditLogLoader.java:209)\n        at org.apache.hadoop.hdfs.server.namenode.FSEditLogLoader.loadFSEdits(FSEditLogLoader.java:122)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadEdits(FSImage.java:737)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer.doTailEdits(EditLogTailer.java:227)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer$EditLogTailerThread.doWork(EditLogTailer.java:321)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer$EditLogTailerThread.access$0(EditLogTailer.java:302)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer$EditLogTailerThread$1.run(EditLogTailer.java:296)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:356)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1528)\n        at org.apache.hadoop.security.SecurityUtil.doAsLoginUserOrFatal(SecurityUtil.java:413)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer$EditLogTailerThread.run(EditLogTailer.java:292)\n        \n   2)2015-03-30  FATAL org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer: Unknown error encountered while tailing edits. Shutting down standby N\nN.\njava.io.IOException: Failed to apply edit log operation AddBlockOp [path=/xxx/_temporary/xxx/part-m-00121, penultimateBlock=blk_2102331803_1100888911441, lastBlock=blk_2102661068_1100889009168, RpcClientId=, RpcCallId=-2]: error\nnull\n        at org.apache.hadoop.hdfs.server.namenode.MetaRecoveryContext.editLogLoaderPrompt(MetaRecoveryContext.java:94)\n        at org.apache.hadoop.hdfs.server.namenode.FSEditLogLoader.loadEditRecords(FSEditLogLoader.java:215)\n        at org.apache.hadoop.hdfs.server.namenode.FSEditLogLoader.loadFSEdits(FSEditLogLoader.java:122)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadEdits(FSImage.java:737)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer.doTailEdits(EditLogTailer.java:227)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer$EditLogTailerThread.doWork(EditLogTailer.java:321)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer$EditLogTailerThread.access$0(EditLogTailer.java:302)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer$EditLogTailerThread$1.run(EditLogTailer.java:296)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:356)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1528)\n        at org.apache.hadoop.security.SecurityUtil.doAsLoginUserOrFatal(SecurityUtil.java:413)\n        at org.apache.hadoop.hdfs.server.namenode.ha.EditLogTailer$EditLogTailerThread.run(EditLogTailer.java:292)\n        \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"standby nn can't started","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fj1002817","name":"fj1002817","key":"fj1002817","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fujie","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fj1002817","name":"fj1002817","key":"fj1002817","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fujie","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"centeros 6.2  64bit ","customfield_12313520":null,"customfield_12311020":null,"duedate":"2015-03-29","customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786524/comment/14385747","id":"14385747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fj1002817","name":"fj1002817","key":"fj1002817","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fujie","active":true,"timeZone":"Asia/Shanghai"},"body":"upload the error log .","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fj1002817","name":"fj1002817","key":"fj1002817","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fujie","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-29T12:42:33.027+0000","updated":"2015-03-29T12:42:33.027+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786524/comment/14386886","id":"14386886","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello [~yzhangal].  Do you think this looks like a duplicate of the recent edit log bugs related to delayed block removal (HDFS-6825, HDFS-7414 and HDFS-7707)?  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-30T15:44:52.083+0000","updated":"2015-03-30T15:44:52.083+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786524/comment/14387070","id":"14387070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~fujie] for reporting the issue and [~cnauroth] for bringing it to my attention.\n\nI agree with Chris that it's likely related to HDFS-6825 etc. But to be sure, suggest to find out whether the file this OP_CLOSE tries to close was indeed deleted earlier. What I did before was to look into the edit logs to see if the file itself or its parent are deleted.\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-30T17:46:58.475+0000","updated":"2015-03-30T17:46:58.475+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786524/comment/14388330","id":"14388330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fj1002817","name":"fj1002817","key":"fj1002817","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fujie","active":true,"timeZone":"Asia/Shanghai"},"body":"HDFS-6825 affects version is 2.5.0, but our hadoop version is 2.3.0. So are you sure it is the same issue?\n\n1. I am sure that the file was deleted. And I have some new findings.\n\nSuch as we have \"image-file-1\", \"editlog-file-1\" and \"editlog-file-inprogress\" when start the standby namenode A.\nI found the below behavior of these files:\nstep-1) SNN will load \"image-file-1\" and \"editlog-file-1\" and generate new image file, take it as \"image-file-2\".\nstep-2) SNN will cp \"image-file-2\" to ative namenode.\nstep-3) \"editlog-file-inprogress\" will be renamed to \"editlog-file-2\" and a new \"editlog-file-inprogress\" will be opened.\nstep-4) SNN will load \"editlog-file-2\", at the same time datanode will report heartbeat to both active and standby. \n\nThe crash happends at step-4. We print all the failed files and all of them are in \"editlog-file-2\".\nWe alse have a statistics, 20,000 operations failed in 500,000 operations. Then we parsed \"editlog-file-2\", and got the familar contents\nof failed records. All of them, RPC_CLIENTID is null(blank) , and RPC_CALLID is -2.\n<RECORD>\n    <OPCODE>OP_ADD_BLOCK</OPCODE>\n    <DATA>\n      <TXID>7660428426</TXID>\n      <PATH>/workspace/dm/recommend/VideoQuality/VRII/AppList/data/interactivedata_month/_temporary/1/_temporary/attempt_1427018831005_178665_r_000002_0/part\n-r-00002</PATH>\n      <BLOCK>\n        <BLOCK_ID>2107099231</BLOCK_ID>\n        <NUM_BYTES>0</NUM_BYTES>\n        <GENSTAMP>1100893452304</GENSTAMP>\n      </BLOCK>\n      <RPC_CLIENTID></RPC_CLIENTID>\n      <RPC_CALLID>-2</RPC_CALLID>\n    </DATA>\n  </RECORD>\n\n2. If we restart SNN A again, \"editlog-file-2\" could be loaded correctly just like \"editlog-file-1\" in last restart operation. It's weird.\nDoes the reported heartbeat impact its behavior? But the \"load\" process and \"report\" process should asynchronous, isn't it?\n\nWe are looking forward to you reply.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fj1002817","name":"fj1002817","key":"fj1002817","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fujie","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-31T09:52:14.692+0000","updated":"2015-03-31T09:52:14.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786524/comment/14388332","id":"14388332","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fj1002817","name":"fj1002817","key":"fj1002817","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fujie","active":true,"timeZone":"Asia/Shanghai"},"body":"HDFS-6825 affects version is 2.5.0, but our hadoop version is 2.3.0. So are you sure it is the same issue?\n\n1. I am sure that the file was deleted. And I have some new findings.\n\nSuch as we have \"image-file-1\", \"editlog-file-1\" and \"editlog-file-inprogress\" when start the standby namenode A.\nI found the below behavior of these files:\nstep-1) SNN will load \"image-file-1\" and \"editlog-file-1\" and generate new image file, take it as \"image-file-2\".\nstep-2) SNN will cp \"image-file-2\" to ative namenode.\nstep-3) \"editlog-file-inprogress\" will be renamed to \"editlog-file-2\" and a new \"editlog-file-inprogress\" will be opened.\nstep-4) SNN will load \"editlog-file-2\", at the same time datanode will report heartbeat to both active and standby. \n\nThe crash happends at step-4. We print all the failed files and all of them are in \"editlog-file-2\".\nWe alse have a statistics, 20,000 operations failed in 500,000 operations. Then we parsed \"editlog-file-2\", and got the familar contents\nof failed records. All of them, RPC_CLIENTID is null(blank) , and RPC_CALLID is -2.\n<RECORD>\n    <OPCODE>OP_ADD_BLOCK</OPCODE>\n    <DATA>\n      <TXID>7660428426</TXID>\n      <PATH>/workspace/dm/recommend/VideoQuality/VRII/AppList/data/interactivedata_month/_temporary/1/_temporary/attempt_1427018831005_178665_r_000002_0/part\n-r-00002</PATH>\n      <BLOCK>\n        <BLOCK_ID>2107099231</BLOCK_ID>\n        <NUM_BYTES>0</NUM_BYTES>\n        <GENSTAMP>1100893452304</GENSTAMP>\n      </BLOCK>\n      <RPC_CLIENTID></RPC_CLIENTID>\n      <RPC_CALLID>-2</RPC_CALLID>\n    </DATA>\n  </RECORD>\n\n2. If we restart SNN A again, \"editlog-file-2\" could be loaded correctly just like \"editlog-file-1\" in last restart operation. It's weird.\nDoes the reported heartbeat impact its behavior? But the \"load\" process and \"report\" process should asynchronous, isn't it?\n\nWe are looking forward to you reply.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fj1002817","name":"fj1002817","key":"fj1002817","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fujie","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-31T09:52:19.284+0000","updated":"2015-03-31T09:52:19.284+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786524/comment/14388371","id":"14388371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi [~fujie] Can you attach little more log around above mentioned exceptions.?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-03-31T11:00:10.958+0000","updated":"2015-03-31T11:00:10.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786524/comment/14388618","id":"14388618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~fujie],\n\n\"I am sure that the file was deleted\", if a file was deleted, and it still has an OP_CLOSE in the edit log file, then why \"If we restart SNN A again, \"editlog-file-2\" could be loaded correctly just like \"editlog-file-1\" in last restart operation.\" is indeed mysterious, unless OP_CLOSE silently ignores deleted file.\n\nCan we dump the edit log with oev tool, and see if the involved file in OP_CLOSE operation that throws NPE was deleted (either it OR its parent has an OP_DELETE) before the OP_CLOSE? \n\nWhat it means by \"20,000 operations failed in 500,000 operations\"?  what are the error symptom? As Vinayakumar requested, can we analysze the trace stack of all failures to see if they have the same exception stack? \n\nSince you mentioned one problem OP_ADD_BLOCK, it seems that we are adding block to a deleted file? If it's deleted file, I think it's very likely related to delayed block removal, which relates to \"at the same time datanode will report heartbeat to both active and standby\".\n\nThanks.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-31T14:42:01.617+0000","updated":"2015-03-31T14:42:01.617+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12786524/comment/15060282","id":"15060282","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"It is very likely fixed in the later releases when we fixed similar issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2015-12-16T16:47:36.188+0000","updated":"2015-12-16T16:47:36.188+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8011/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i27i93:"}}