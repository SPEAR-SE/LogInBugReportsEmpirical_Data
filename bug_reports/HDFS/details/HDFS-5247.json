{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12669976","self":"https://issues.apache.org/jira/rest/api/2/issue/12669976","key":"HDFS-5247","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324148","id":"12324148","description":"maintenance release on branch-1.2","name":"1.2.1","archived":false,"released":true,"releaseDate":"2013-08-01"}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-09-24T22:45:22.608+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 16 17:45:31 UTC 2013","customfield_12310420":"349805","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-5247/watchers","watchCount":3,"isWatching":false},"created":"2013-09-23T02:57:55.290+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324148","id":"12324148","description":"maintenance release on branch-1.2","name":"1.2.1","archived":false,"released":true,"releaseDate":"2013-08-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaoyunjiong","name":"zhaoyunjiong","key":"zhaoyunjiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yunjiong zhao","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-10-16T17:45:31.898+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"When one of dfs.name.dir failed, namenode didn't close editlog and unlock the storage:\njava    24764 hadoop   78uW  REG 252,32        0 393219 /volume1/nn/dfs/in_use.lock (deleted)\njava    24764 hadoop  107u   REG 252,32  1155072 393229 /volume1/nn/dfs/current/edits.new (deleted)\njava    24764 hadoop  119u   REG 252,32        0 393238 /volume1/nn/dfs/current/fstime.tmp\njava    24764 hadoop  140u   REG 252,32  1761805 393239 /volume1/nn/dfs/current/edits\n\nIf this dir is limit of space, then restore this storage may fail.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12604511","id":"12604511","filename":"HDFS-5247-branch-1.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaoyunjiong","name":"zhaoyunjiong","key":"zhaoyunjiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yunjiong zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-09-23T03:03:28.053+0000","size":1786,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12604511/HDFS-5247-branch-1.2.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"350103","customfield_12312823":null,"summary":"Namenode should close editlog and unlock storage when removing failed storage dir","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaoyunjiong","name":"zhaoyunjiong","key":"zhaoyunjiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yunjiong zhao","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaoyunjiong","name":"zhaoyunjiong","key":"zhaoyunjiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yunjiong zhao","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12669976/comment/13774262","id":"13774262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaoyunjiong","name":"zhaoyunjiong","key":"zhaoyunjiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yunjiong zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"With this patch after restore storage:\n[root@hd1-31851 ~]# lsof /volume1/\nCOMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME\njava    28831 hadoop   79uW  REG 252,32        0 393224 /volume1/nn/dfs/in_use.lock\njava    28831 hadoop  113u   REG 252,32  1075255 393222 /volume1/nn/dfs/current/edits\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaoyunjiong","name":"zhaoyunjiong","key":"zhaoyunjiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yunjiong zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-09-23T03:03:28.055+0000","updated":"2013-09-23T03:03:28.055+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12669976/comment/13776860","id":"13776860","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Some comments:\nbq. When one of dfs.name.dir failed, namenode didn't close editlog and unlock the storage:\nAre you saying for the failed directory, namenode didn't close editlog and unlock the storage or is it for all the storage directories?\n\nIf it is for the failed storage, if failure is due to a disk going bad, in most of the cases, we may not be able to do these cleanups.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-09-24T22:45:22.608+0000","updated":"2013-09-24T22:45:22.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12669976/comment/13777073","id":"13777073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaoyunjiong","name":"zhaoyunjiong","key":"zhaoyunjiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yunjiong zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm saying for the failed directory.\nOur case is due to no space on that disk. In this case, it need and should close those two files.\nAnd I believe try to close won't make thing worse.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaoyunjiong","name":"zhaoyunjiong","key":"zhaoyunjiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yunjiong zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-09-25T02:13:28.080+0000","updated":"2013-09-25T02:13:28.080+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12669976/comment/13796407","id":"13796407","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks good. Fixes a bug seen in our clusters repeatedly.\n+1.\n\nPlease review and commit.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benoyantony","name":"benoyantony","key":"benoyantony","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benoy Antony","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-16T04:34:00.371+0000","updated":"2013-10-16T04:34:00.371+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12669976/comment/13797045","id":"13797045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"This is a rare enough problem that can be worked around by monitoring the available disk space. This part of the code has been quite brittle. Some of the changes in this area have resulted in more serious bugs and subsequent bug fixes for stabilization. My preference is to leave this as is, since monitoring disk space can avoid this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-16T17:45:31.898+0000","updated":"2013-10-16T17:45:31.898+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-5247/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1obdr:"}}